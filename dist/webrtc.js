(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){ClientConfig={enableHD:false,enableCallControl:true,enableCallTimer:true,enableCallHistory:true,enableFullScreen:true,enableSelfView:true,enableCallStats:true,enableDialpad:true,enableMute:true,enableMessages:true,enableRegistrationIcon:true,enableConnectionIcon:true,enableWindowDrag:true,enableAutoAcceptReInvite:true,enableConnectLocalMedia:true,enableIms:false,enableSettings:false,enableAutoAnswer:false,enableTransfer:true,enableHold:true,pAssertedIdentity:"<sip:webguest@broadsoftlabs.com>",allowOutside:true,disableICE:true,volumeClick:1,volumeDTMF:1,websocketsServers:[{ws_uri:"wss://webrtc-gw.broadsoftlabs.com:8443",weight:0}],stunServer:"64.212.220.81",stunPort:3478,domainFrom:"broadsoftlabs.com",domainTo:"broadsoftlabs.com",endCallURL:false,bandwidthLow:128,bandwidthMed:512,bandwidthHigh:2048,expires:365,debug:false,register:false,encodingResolution:"640x480",displayResolution:"640x480",view:"audioVideo",selfViewLocation:"bl",messageProgress:"Ringing",messageOutsideDomain:"Invalid Destination",messageStarted:"Call Started",messageHold:"Call placed on hold",messageResume:"Call removed from hold",messageEnded:"Call Ended",messageCall:"Performing NAT Tests",messageConnected:"Connected",messageConnectionFailed:"Connection failed",messageUnregistered:"Unregistered",messageRegistered:"Registration successful",messageRegistrationFailed:"Registration failed",messageEmptyDestination:"Invalid Destination",messageGetUserMedia:"Unable to Access Camera and/or Microphone"};module.exports=ClientConfig},{}],2:[function(require,module,exports){(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof exports==="object"){module.exports=factory()}else if(typeof root==="undefined"||root!==Object(root)){throw new Error("templatizer: window does not exist or is not an object")}else{root.templatizer=factory()}})(this,function(){var jade=function(){function e(e){return null!=e&&""!==e}function n(t){return(Array.isArray(t)?t.map(n):t&&"object"==typeof t?Object.keys(t).filter(function(e){return t[e]}):[t]).filter(e).join(" ")}var t={};return t.merge=function r(n,t){if(1===arguments.length){for(var a=n[0],i=1;i<n.length;i++)a=r(a,n[i]);return a}var o=n["class"],s=t["class"];(o||s)&&(o=o||[],s=s||[],Array.isArray(o)||(o=[o]),Array.isArray(s)||(s=[s]),n["class"]=o.concat(s).filter(e));for(var l in t)"class"!=l&&(n[l]=t[l]);return n},t.joinClasses=n,t.cls=function(e,r){for(var a=[],i=0;i<e.length;i++)a.push(r&&r[i]?t.escape(n([e[i]])):n(e[i]));var o=n(a);return o.length?' class="'+o+'"':""},t.style=function(e){return e&&"object"==typeof e?Object.keys(e).map(function(n){return n+":"+e[n]}).join(";"):e},t.attr=function(e,n,r,a){return"style"===e&&(n=t.style(n)),"boolean"==typeof n||null==n?n?" "+(a?e:e+'="'+e+'"'):"":0==e.indexOf("data")&&"string"!=typeof n?(-1!==JSON.stringify(n).indexOf("&")&&console.warn("Since Jade 2.0.0, ampersands (`&`) in data attributes will be escaped to `&amp;`"),n&&"function"==typeof n.toISOString&&console.warn("Jade will eliminate the double quotes around dates in ISO form after 2.0.0")," "+e+"='"+JSON.stringify(n).replace(/'/g,"&apos;")+"'"):r?(n&&"function"==typeof n.toISOString&&console.warn("Jade will stringify dates in ISO form after 2.0.0")," "+e+'="'+t.escape(n)+'"'):(n&&"function"==typeof n.toISOString&&console.warn("Jade will stringify dates in ISO form after 2.0.0")," "+e+'="'+n+'"')},t.attrs=function(e,r){var a=[],i=Object.keys(e);if(i.length)for(var o=0;o<i.length;++o){var s=i[o],l=e[s];"class"==s?(l=n(l))&&a.push(" "+s+'="'+l+'"'):a.push(t.attr(s,l,!1,r))}return a.join("")},t.escape=function(e){var n=String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");return n===""+e?e:n},t.rethrow=function a(e,n,t,r){if(!(e instanceof Error))throw e;if(!("undefined"==typeof window&&n||r))throw e.message+=" on line "+t,e;try{r=r||require("fs").readFileSync(n,"utf8")}catch(i){a(e,null,t)}var o=3,s=r.split("\n"),l=Math.max(t-o,0),f=Math.min(s.length,t+o),o=s.slice(l,f).map(function(e,n){var r=n+l+1;return(r==t?"  > ":"    ")+r+"| "+e}).join("\n");throw e.path=n,e.message=(n||"Jade")+":"+t+"\n"+o+"\n\n"+e.message,e},t}();var templatizer={};templatizer["webrtc"]=function tmpl_webrtc(){return'<div id="unsupported" class="unsupported"></div><div id="whiteboard_unsupported" class="unsupported"></div><div id="screen_sharing_unsupported" class="unsupported">Could not retrieve screen capture. Do you have it enabled?<br/>  Open link to check : <span>chrome://flags/#enable-usermedia-screen-capture</span></div><noscript><div id="javascript_disabled" class="unsupported">JavaScript must be enabled to load the WebRTC client</div></noscript><div id="conversejs"></div><div id="client" class="client"><div class="authPopup fadeable popup"><span>User ID</span><br/><input type="text" value="" class="userid"/><br/><span>Auth User ID</span><br/><input type="text" value="" class="authUserid"/><br/><span>Password</span><br/><input type="password" value="" class="password"/><br/><br/><div class="alert"></div><button type="button" class="authPopupButton button">Sign in</button></div><div class="fileshare-container table"><div class="cell"><div class="file_share fadeable"><span>Share File:</span><br/><input type="file"/><div class="status"></div></div></div></div><div class="main"><div class="errorPopup"></div><div class="callPopup fadeable popup"><span class="incomingCallTitle">Incoming Call</span><span class="incomingCallName"></span><span class="incomingCallUser"></span><div class="table"><div class="cell"><button type="button" class="acceptIncomingCall button">Accept</button><button type="button" class="holdAndAnswerButton button">Hold And Answer</button><button type="button" class="dropAndAnswerButton button">Drop And Answer</button></div><div id="rejectIncomingCallContainer" class="cell"><button type="button" class="rejectIncomingCall button">Reject</button></div></div></div><div class="reInvitePopup fadeable popup"><span class="title">ReInvite</span><br/><br/><span class="incomingCallName"></span><br/><span class="incomingCallUser"></span><br/><br/><button type="button" class="acceptReInviteCall button">Accept</button><button type="button" class="rejectReInviteCall button">Reject</button></div><div class="transferPopup fadeable popup"><div class="title">Transfer</div><div><input type="text" placeholder="To Target" class="transferTarget"/><input type="checkbox" class="transferTypeAttended"/>Attended</div><div class="actions"><button type="button" class="acceptTransfer button">Transfer</button><button type="button" class="rejectTransfer button">Cancel</button></div></div><div class="settingsPopup table collapse fixed fadeable popup"><div class="row"><ul class="tabs"><li><a href="#tab1"><span class="icon-cog"></span>Configure</a></li><li><a href="#tab2"><span class="icon-th"></span>Layout</a></li></ul><div id="tab1"><div class="settingDisplayNameRow row"><span class="cell">Display Name</span><input type="text" value="" class="settingDisplayName cell"/></div><div class="settingAuthenticationUseridRow row"><span class="cell">Auth User ID</span><input type="text" value="" class="settingAuthenticationUserid cell"/></div><div class="settingUseridRow row"><span class="cell">User ID</span><input type="text" value="" class="settingUserid cell"/></div><div class="settingPasswordRow row"><span class="cell">Password</span><input type="password" value="" class="settingPassword cell"/></div><div class="settingHDRow row"><span class="cell">Start in HD</span><input type="checkbox" class="settingHD cell"/><br/></div><div class="settingAutoAnswerRow row"><span class="cell">Auto Answer</span><input type="checkbox" class="settingAutoAnswer cell"/></div><div class="settingBandwidthRow row"><span class="cell">Bandwidth</span><span class="cell"><input type="text" maxlength="4" value="" placeholder="low" class="settingBandwidthLow short"/><input type="text" maxlength="4" value="" placeholder="medium" class="settingBandwidthMed short"/><input type="text" maxlength="4" value="" placeholder="high" class="settingBandwidthHigh short"/></span></div><div class="row"><span class="cell"><a href="" title="Sign In" class="btn sign-in">Sign In</a><a href="" title="Sign Out" class="btn sign-out">Sign Out</a></span></div></div><div id="tab2"><div class="settingSelfViewDisableRow row"><span class="cell">Disable Self View</span><input type="checkbox" class="settingSelfViewDisable cell"/></div><!--<div class="row">\n<span class="cell">Window Zoom</span>\n<input class="settingZoom cell short" type="text" maxlength="4" value=""/>\n</div>\n<div class="row">\n<span class="cell">Self View Window</span>\n<span class="cell">\n<input class="settingLocalVideoTop short" type="text" maxlength="4" value=""/><span> top </span>\n<input class="settingLocalVideoLeft short" type="text" maxlength="4" value=""/><span> left </span>\n</span>\n</div>\n<div class="row">\n<span class="cell">Call History Window</span>\n<span class="cell">\n<input class="settingCallHistoryTop short" type="text" maxlength="4" value=""/><span> top </span>\n<input class="settingCallHistoryLeft short" type="text" maxlength="4" value=""/><span> left </span>\n</span>\n</div>\n<div class="row">\n<span class="cell">Call Stats Window</span>\n<span class="cell">\n<input class="settingCallStatsTop short" type="text" maxlength="4" value=""/><span> top </span>\n<input class="settingCallStatsLeft short" type="text" maxlength="4" value=""/><span> left </span>\n</span>\n</div>\n<div class="row">\n<span class="cell">Page Color</span>\n<input class="settingColor cell" type="color" /><br>\n</div>--><div class="settingResolutionRow"><!-- <span class="cell">Resolution</span>--><div class="row"><span class="settingResolutionTypeRow cell">Mode</span><select class="resolutionTypeSelect cell"></select></div><div class="row"><span class="settingResolutionDisplayRow cell">Resolution</span><span class="cell"><select class="resolutionDisplayStandardSelect resolutionSubType"></select><select class="resolutionDisplayWidescreenSelect resolutionSubType"></select></span></div><div class="row"><span class="settingResolutionEncodingRow cell">Encoding</span><span class="cell"><select class="resolutionEncodingStandardSelect resolutionSubType"></select><select class="resolutionEncodingWidescreenSelect resolutionSubType"></select></span></div></div><div class="row"><span class="cell"><a href="" title="Save Settings" class="btn saveSettings">Save Settings</a><a href="" title="Reset Settings" class="clear">Reset Settings</a></span></div></div></div></div><div class="video"><span class="icon-facetime-video watermark-icon"></span><video autoplay="autoplay" class="remoteVideo"></video><div class="localVideo fadeable"><div class="inner"><video autoplay="autoplay" muted="true"></video></div></div></div><div class="videoBar"><div class="table fixed collapse"><div class="cell leftSpacer"></div><div class="cell cell-selfView"><div class="selfViewDisable icon fadeable"><a href="" title="Disable Self View" class="icon-selfViewDisable"></a></div><div class="selfViewEnable icon fadeable"><a href="" title="Enable Self View" class="icon-selfViewEnable"></a></div></div><div class="cell cell-dialpad"><div class="dialpadIconShow icon fadeable"><a href="" title="Show Dialpad" class="icon-dialpadShow"></a></div><div class="dialpadIconHide icon fadeable"><a href="" title="Hide Dialpad" class="icon-dialpadHide"></a></div></div><div class="cell cell-muteAudio"><div class="icon fadeable muteAudioIcon"><a href="" title="Mute Audio" class="icon-muteAudio"></a></div><div class="icon fadeable unmuteAudioIcon"><a href="" title="Unmute Audio" class="icon-unmuteAudio"></a></div></div><div class="cell cell-hold"><div class="hold icon fadeable"><a href="" title="Hold Call" class="icon-hold"></a></div><div class="resume icon fadeable"><a href="" title="Resume Call" class="icon-resume"></a></div></div><div class="cell cell-hangup"><div class="hangup icon fadeable"><a href="" title="Hangup" class="icon-hangup"></a><div class="subtitle">End Conference</div></div></div><div class="cell cell-transfer"><div class="transfer icon fadeable"><a href="" title="Transfer" class="icon-transfer"></a></div></div><div class="cell cell-shareScreen"><div class="icon fadeable shareScreen"><a href="" title="Share Screen" class="icon-screen-sharing"></a></div><div class="icon fadeable stopShareScreen"><a href="" title="Stop Share Screen" class="icon-screen-sharing-off"></a></div></div><div class="cell cell-timer"><div class="timer fadeable"></div></div><div class="cell cell-settings"><div class="settings icon fadeable"><a href="" title="Settings" class="icon-settings"></a></div></div><div class="cell cell-fullScreen"><div class="fullScreenExpand icon fadeable"><a href="" title="Expand Full Screen" class="icon-fullScreenExpand"></a></div><div class="fullScreenContract icon fadeable"><a href="" title="Contract Full Screen" class="icon-fullScreenContract"></a></div></div><div class="cell rightSpacer"></div></div></div><div class="connected-icon"><span title="Websockets Status" class="icon-link exario"></span></div><div class="registered-icon"><span title="Registered" class="icon-link exario"></span></div><div class="quality1"><span title="Call Quality" class="icon-quality1 exario"></span></div><div class="quality2"><span title="Call Quality" class="icon-quality2 exario"></span></div><div class="quality3"><span title="Call Quality" class="icon-quality3 exario"></span></div><div class="quality4"><span title="Call Quality" class="icon-quality4 exario"></span></div><div class="dialpad fadeable popup"><div class="callControl destination-container"><input type="text" onclick="this.focus();this.select()" class="destination"/><button title="Call History" class="history-button"><i class="icon-clock"></i></button><hr/></div><div class="button-row"><button>1</button><button>2</button><button>3</button></div><div class="button-row"><button>4</button><button>5</button><button>6</button></div><div class="button-row"><button>7</button><button>8</button><button>9</button></div><div class="button-row"><button class="btn-star">*</button><button>0</button><button>#</button></div><div class="dialpad-control-bar"><div class="call main-button"><a href="">Call</a></div></div></div><div class="callHistory"><div class="content"></div><div class="classHistoryActions"><!--<span class="historyBack">\n<a href="" title="Previous" class="icon-arrow-up-thick"></a>\n</span>--><span class="historyClear"><a href="" title="Clear History">Clear</a></span><span class="historyClose"><a href="" title="Close History">Close</a></span><!--<span class="historyForward">\n<a href="" title="Next" class="icon-arrow-down-thick"></a>\n</span>--></div><div class="callHistoryDetails popup"><div id="history-dt-close-container"><span class="historyDetailsClose cell"><a href="" title="Close" class="icon-cancel3"></a></span></div><div class="table"><div class="row"><div class="cell">Resolution In : </div><div class="resolutionIn cell default-color"></div></div><div class="row"><div class="cell">Resolution Out : </div><div class="resolutionOut cell default-color"></div></div><div class="row"><div class="cell">Bitrate In : </div><div class="bitrateIn cell default-color"></div></div><div class="row"><div class="cell">Bitrate Out : </div><div class="bitrateOut cell default-color"></div></div><div class="row"><div class="cell">Frame Rate In : </div><div class="frameRateIn cell default-color"></div></div><div class="row"><div class="cell">Frame Rate Out : </div><div class="frameRateOut cell default-color"></div></div><div class="row"><div class="cell">Audio Lost : </div><div class="audioLostPer cell default-color">%</div></div><div class="row"><div class="cell">Video Out : </div><div class="videoLostPer cell default-color">%</div></div><div class="row"><div class="cell">Jitter : </div><div class="jitter cell default-color"></div></div></div><div class="actions table"><a href="" title="Call" class="callLink cell"></a></div></div></div><div class="callStats"><div class="stats-container"></div><div class="table fixed collapse"><div class="heading"><div class="cell">Video Stats</div><div class="cell">Audio Stats</div></div><div class="row"><div class="cell">Bitrate out: <a href="javascript:;" data-type="video" data-var="kiloBitsSentPerSecond" class="stats-var"></a> kb/s</div><div class="cell">Bitrate out: <a href="javascript:;" data-type="audio" data-var="kiloBitsSentPerSecond" class="stats-var"></a> kb/s</div></div><div class="row"><div class="cell">Bitrate in: <a href="javascript:;" data-type="video" data-var="kiloBitsReceivedPerSecond" class="stats-var"></a> kb/s</div><div class="cell">Bitrate in: <a href="javascript:;" data-type="audio" data-var="kiloBitsReceivedPerSecond" class="stats-var"></a> kb/s</div></div><div class="row"><div class="cell">Lost: <a href="javascript:;" data-type="video" data-var="packetsLost" class="stats-var"></a> packets (<a href="javascript:;" data-type="video" data-var="packetsLostPer" class="stats-var"></a> %)</div><div class="cell">Lost: <a href="javascript:;" data-type="audio" data-var="packetsLost" class="stats-var"></a> packets (<a href="javascript:;" data-type="audio" data-var="packetsLostPer" class="stats-var"></a> %)</div></div><div class="row"><div class="cell">Frame rate out: <a href="javascript:;" data-type="video" data-var="googFrameRateSent" class="stats-var"></a> in: <a href="javascript:;" data-type="video" data-var="googFrameRateReceived" class="stats-var"></a></div><div class="cell">Audio Level out: <a href="javascript:;" data-type="audio" data-var="audioInputLevel" class="stats-var"></a> in: <a href="javascript:;" data-type="audio" data-var="audioOutputLevel" class="stats-var"></a></div></div><div class="row spacer"></div><div class="heading"><div class="cell">Resolution</div><div class="cell">Link</div></div><div class="row"><div class="cell">In: <span data-type="video" data-var="googFrameWidthReceived" class="stats-var"></span> x <span data-type="video" data-var="googFrameHeightReceived" class="stats-var"></span> Out: <span data-type="video" data-var="googFrameWidthSent" class="stats-var"></span> x <span data-type="video" data-var="googFrameHeightSent" class="stats-var"></span></div><div class="cell"><span class="statsDelay">Delay: <a href="javascript:;" data-type="audio" data-var="googRtt" class="stats-var"></a></span> Jitter: <a href="javascript:;" data-type="audio" data-var="googJitterReceived" class="stats-var"></a></div></div><div class="row spacer"></div></div></div><div class="messages"><div class="alert"></div><div class="success"></div><div class="warning"></div><div class="normal"></div></div></div><div class="historyRowSample"><div class="row"><a href="" title="Number" class="hist-destination"></a><span class="hist-direction"></span><span class="hist-date"></span><span class="hist-length"></span><span class="hist-details-arrow icon-angle-right"></span></div></div><div class="whiteboard"><div class="tools"><a href=".simple_sketch" data-tool="marker" class="tooltype">Marker</a><a href=".simple_sketch" data-tool="eraser" class="tooltype">Eraser</a></div><canvas width="600" height="400" class="simple_sketch"></canvas></div><div class="sms"><div class="smsView"><div class="table fixed smsLoginForm"><div class="row"><label class="cell">Name:</label><input type="text" name="name" placeholder="Email or TN" class="cell smsName"/></div><div class="row"><label class="cell">Password:</label><input type="password" name="password" class="cell smsPassword"/></div><div class="row"><div class="cell"></div><input type="button" value="Log In" class="cell smsLogin"/></div></div><div class="smsInbox"><fieldset><legend>Inbox</legend><div class="inner"><div class="table fixed"><div class="row"><div class="cell title status">Status</div><div class="cell title time">Received</div><div class="cell title from">From</div><div class="cell title body">Message</div><div class="cell title actions"></div></div><div class="content"></div></div></div></fieldset></div><div class="smsSendForm"><div><div><span>To</span><input type="text" placeholder="US Phone Number" class="smsSendTo"/><span>Text</span><input type="text" placeholder="Message to Send" class="smsSendBody"/><input type="button" value="Send SMS" class="smsSendButton"/></div></div></div><div id="sample" class="sms-inbox-item sms-inbox-item-sample row"><div class="status cell"></div><div class="time cell"></div><div class="from cell"></div><div class="body cell"><div class="image"><a href="" target="_blank"><span></span><img src=""/></a></div><div class="video"><video controls=""></video></div><div class="audio"><audio controls=""></audio></div><div class="text"></div></div><div class="actions cell"><a href="javascript:;" title="Delete SMS" class="icon-trash"></a></div></div></div><div class="smsStatus"><span class="content"></span></div></div></div>'};return templatizer})},{fs:3}],3:[function(require,module,exports){},{}],4:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],5:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],6:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:7}],7:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){var source=ev.source;if((source===window||source===null)&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],8:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],9:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}
}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":8,_process:7,inherits:5}],10:[function(require,module,exports){exports=module.exports=require("./debug");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;var storage;if(typeof chrome!=="undefined"&&typeof chrome.storage!=="undefined")storage=chrome.storage.local;else storage=window.localStorage;exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if("%%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){storage.removeItem("debug")}else{storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=storage.debug}catch(e){}return r}exports.enable(load())},{"./debug":11}],11:[function(require,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=require("ms");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args=["%o"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match==="%%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if("function"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||"").split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:12}],12:[function(require,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if("string"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){var match=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"h":return n*h;case"minutes":case"minute":case"m":return n*m;case"seconds":case"second":case"s":return n*s;case"ms":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+"d";if(ms>=h)return Math.round(ms/h)+"h";if(ms>=m)return Math.round(ms/m)+"m";if(ms>=s)return Math.round(ms/s)+"s";return ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+" "+name;return Math.ceil(ms/n)+" "+name+"s"}},{}],13:[function(require,module,exports){var utils=require("./utils"),path=require("path"),dirname=path.dirname,extname=path.extname,join=path.join,fs=require("fs"),read=fs.readFileSync;var filters=exports.filters=require("./filters");var cache={};exports.clearCache=function(){cache={}};function filtered(js){return js.substr(1).split("|").reduce(function(js,filter){var parts=filter.split(":"),name=parts.shift(),args=parts.join(":")||"";if(args)args=", "+args;return"filters."+name+"("+js+args+")"})}function rethrow(err,str,filename,lineno){var lines=str.split("\n"),start=Math.max(lineno-3,0),end=Math.min(lines.length,lineno+3);var context=lines.slice(start,end).map(function(line,i){var curr=i+start+1;return(curr==lineno?" >> ":"    ")+curr+"| "+line}).join("\n");err.path=filename;err.message=(filename||"ejs")+":"+lineno+"\n"+context+"\n\n"+err.message;throw err}var parse=exports.parse=function(str,options){var options=options||{},open=options.open||exports.open||"<%",close=options.close||exports.close||"%>",filename=options.filename,compileDebug=options.compileDebug!==false,buf="";buf+="var buf = [];";if(false!==options._with)buf+="\nwith (locals || {}) { (function(){ ";buf+="\n buf.push('";var lineno=1;var consumeEOL=false;for(var i=0,len=str.length;i<len;++i){var stri=str[i];if(str.slice(i,open.length+i)==open){i+=open.length;var prefix,postfix,line=(compileDebug?"__stack.lineno=":"")+lineno;switch(str[i]){case"=":prefix="', escape(("+line+", ";postfix=")), '";++i;break;case"-":prefix="', ("+line+", ";postfix="), '";++i;break;default:prefix="');"+line+";";postfix="; buf.push('"}var end=str.indexOf(close,i);if(end<0){throw new Error('Could not find matching close tag "'+close+'".')}var js=str.substring(i,end),start=i,include=null,n=0;if("-"==js[js.length-1]){js=js.substring(0,js.length-2);consumeEOL=true}if(0==js.trim().indexOf("include")){var name=js.trim().slice(7).trim();if(!filename)throw new Error("filename option is required for includes");var path=resolveInclude(name,filename);include=read(path,"utf8");include=exports.parse(include,{filename:path,_with:false,open:open,close:close,compileDebug:compileDebug});buf+="' + (function(){"+include+"})() + '";js=""}while(~(n=js.indexOf("\n",n)))n++,lineno++;if(js.substr(0,1)==":")js=filtered(js);if(js){if(js.lastIndexOf("//")>js.lastIndexOf("\n"))js+="\n";buf+=prefix;buf+=js;buf+=postfix}i+=end-start+close.length-1}else if(stri=="\\"){buf+="\\\\"}else if(stri=="'"){buf+="\\'"}else if(stri=="\r"){}else if(stri=="\n"){if(consumeEOL){consumeEOL=false}else{buf+="\\n";lineno++}}else{buf+=stri}}if(false!==options._with)buf+="'); })();\n} \nreturn buf.join('');";else buf+="');\nreturn buf.join('');";return buf};var compile=exports.compile=function(str,options){options=options||{};var escape=options.escape||utils.escape;var input=JSON.stringify(str),compileDebug=options.compileDebug!==false,client=options.client,filename=options.filename?JSON.stringify(options.filename):"undefined";if(compileDebug){str=["var __stack = { lineno: 1, input: "+input+", filename: "+filename+" };",rethrow.toString(),"try {",exports.parse(str,options),"} catch (err) {","  rethrow(err, __stack.input, __stack.filename, __stack.lineno);","}"].join("\n")}else{str=exports.parse(str,options)}if(options.debug)console.log(str);if(client)str="escape = escape || "+escape.toString()+";\n"+str;try{var fn=new Function("locals, filters, escape, rethrow",str)}catch(err){if("SyntaxError"==err.name){err.message+=options.filename?" in "+filename:" while compiling ejs"}throw err}if(client)return fn;return function(locals){return fn.call(this,locals,filters,escape,rethrow)}};exports.render=function(str,options){var fn,options=options||{};if(options.cache){if(options.filename){fn=cache[options.filename]||(cache[options.filename]=compile(str,options))}else{throw new Error('"cache" option requires "filename".')}}else{fn=compile(str,options)}options.__proto__=options.locals;return fn.call(options.scope,options)};exports.renderFile=function(path,options,fn){var key=path+":string";if("function"==typeof options){fn=options,options={}}options.filename=path;var str;try{str=options.cache?cache[key]||(cache[key]=read(path,"utf8")):read(path,"utf8")}catch(err){fn(err);return}fn(null,exports.render(str,options))};function resolveInclude(name,filename){var path=join(dirname(filename),name);var ext=extname(name);if(!ext)path+=".ejs";return path}exports.__express=exports.renderFile;if(require.extensions){require.extensions[".ejs"]=function(module,filename){filename=filename||module.filename;var options={filename:filename,client:true},template=fs.readFileSync(filename).toString(),fn=compile(template,options);module._compile("module.exports = "+fn.toString()+";",filename)}}else if(require.registerExtension){require.registerExtension(".ejs",function(src){return compile(src,{})})}},{"./filters":14,"./utils":15,fs:3,path:6}],14:[function(require,module,exports){exports.first=function(obj){return obj[0]};exports.last=function(obj){return obj[obj.length-1]};exports.capitalize=function(str){str=String(str);return str[0].toUpperCase()+str.substr(1,str.length)};exports.downcase=function(str){return String(str).toLowerCase()};exports.upcase=function(str){return String(str).toUpperCase()};exports.sort=function(obj){return Object.create(obj).sort()};exports.sort_by=function(obj,prop){return Object.create(obj).sort(function(a,b){a=a[prop],b=b[prop];if(a>b)return 1;if(a<b)return-1;return 0})};exports.size=exports.length=function(obj){return obj.length};exports.plus=function(a,b){return Number(a)+Number(b)};exports.minus=function(a,b){return Number(a)-Number(b)};exports.times=function(a,b){return Number(a)*Number(b)};exports.divided_by=function(a,b){return Number(a)/Number(b)};exports.join=function(obj,str){return obj.join(str||", ")};exports.truncate=function(str,len,append){str=String(str);if(str.length>len){str=str.slice(0,len);if(append)str+=append}return str};exports.truncate_words=function(str,n){var str=String(str),words=str.split(/ +/);return words.slice(0,n).join(" ")};exports.replace=function(str,pattern,substitution){return String(str).replace(pattern,substitution||"")};exports.prepend=function(obj,val){return Array.isArray(obj)?[val].concat(obj):val+obj};exports.append=function(obj,val){return Array.isArray(obj)?obj.concat(val):obj+val};exports.map=function(arr,prop){return arr.map(function(obj){return obj[prop]})};exports.reverse=function(obj){return Array.isArray(obj)?obj.reverse():String(obj).split("").reverse().join("")};exports.get=function(obj,prop){return obj[prop]};exports.json=function(obj){return JSON.stringify(obj)}},{}],15:[function(require,module,exports){exports.escape=function(html){return String(html).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")}},{}],16:[function(require,module,exports){var grammar=module.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-]*)\/(\d*)(?:\s*\/(\S*))?/,names:["payload","codec","rate","encoding"],format:function(o){return o.encoding?"rtpmap:%d %s/%s/%s":"rtpmap:%d %s/%s"}},{push:"fmtp",reg:/^fmtp:(\d*) (\S*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(o){return o.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(o){return o.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(o){return o.config!=null?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(o){return o.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:(\w*)/,format:"mid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/,format:"%s"},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","generation"],format:function(o){var str="candidate:%s %d %s %d %s %d typ %s";str+=o.raddr!=null?" raddr %s rport %d":"%v%v";if(o.generation!=null){str+=" generation %d"}return str}},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{name:"msidSemantic",reg:/^msid-semantic: (\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{push:"invalid",names:["value"]}]};Object.keys(grammar).forEach(function(key){var objs=grammar[key];objs.forEach(function(obj){if(!obj.reg){obj.reg=/(.*)/}if(!obj.format){obj.format="%s"}})})},{}],17:[function(require,module,exports){var parser=require("./parser");var writer=require("./writer");exports.write=writer;exports.parse=parser.parse;exports.parseFmtpConfig=parser.parseFmtpConfig;exports.parsePayloads=parser.parsePayloads;exports.parseRemoteCandidates=parser.parseRemoteCandidates},{"./parser":18,"./writer":19}],18:[function(require,module,exports){var toIntIfInt=function(v){return String(Number(v))===v?Number(v):v};var attachProperties=function(match,location,names,rawName){if(rawName&&!names){location[rawName]=toIntIfInt(match[1])}else{for(var i=0;i<names.length;i+=1){if(match[i+1]!=null){location[names[i]]=toIntIfInt(match[i+1])}}}};var parseReg=function(obj,location,content){var needsBlank=obj.name&&obj.names;if(obj.push&&!location[obj.push]){location[obj.push]=[]}else if(needsBlank&&!location[obj.name]){location[obj.name]={}}var keyLocation=obj.push?{}:needsBlank?location[obj.name]:location;attachProperties(content.match(obj.reg),keyLocation,obj.names,obj.name);if(obj.push){location[obj.push].push(keyLocation)}};var grammar=require("./grammar");var validLine=RegExp.prototype.test.bind(/^([a-z])=(.*)/);exports.parse=function(sdp){var session={},media=[],location=session;sdp.split("\r\n").filter(validLine).forEach(function(l){var type=l[0];var content=l.slice(2);if(type==="m"){media.push({rtp:[],fmtp:[]});location=media[media.length-1]}for(var j=0;j<(grammar[type]||[]).length;j+=1){var obj=grammar[type][j];if(obj.reg.test(content)){return parseReg(obj,location,content)}}});session.media=media;return session};var fmtpReducer=function(acc,expr){var s=expr.split("=");if(s.length===2){acc[s[0]]=toIntIfInt(s[1])}return acc};exports.parseFmtpConfig=function(str){return str.split(";").reduce(fmtpReducer,{})};exports.parsePayloads=function(str){return str.split(" ").map(Number)};exports.parseRemoteCandidates=function(str){var candidates=[];var parts=str.split(" ").map(toIntIfInt);for(var i=0;i<parts.length;i+=3){candidates.push({component:parts[i],ip:parts[i+1],port:parts[i+2]})}return candidates}},{"./grammar":16}],19:[function(require,module,exports){var grammar=require("./grammar");var formatRegExp=/%[sdv%]/g;var format=function(formatStr){var i=1;var args=arguments;var len=args.length;return formatStr.replace(formatRegExp,function(x){if(i>=len){return x}var arg=args[i];i+=1;switch(x){case"%%":return"%";case"%s":return String(arg);case"%d":return Number(arg);case"%v":return""}})};var makeLine=function(type,obj,location){var str=obj.format instanceof Function?obj.format(obj.push?location:location[obj.name]):obj.format;var args=[type+"="+str];if(obj.names){for(var i=0;i<obj.names.length;i+=1){var n=obj.names[i];if(obj.name){args.push(location[obj.name][n])}else{args.push(location[obj.names[i]])}}}else{args.push(location[obj.name])}return format.apply(null,args)};var defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"];var defaultInnerOrder=["i","c","b","a"];module.exports=function(session,opts){opts=opts||{};if(session.version==null){session.version=0}if(session.name==null){session.name=" "}session.media.forEach(function(mLine){if(mLine.payloads==null){mLine.payloads=""}});var outerOrder=opts.outerOrder||defaultOuterOrder;var innerOrder=opts.innerOrder||defaultInnerOrder;var sdp=[];outerOrder.forEach(function(type){grammar[type].forEach(function(obj){if(obj.name in session){sdp.push(makeLine(type,obj,session))}else if(obj.push in session){session[obj.push].forEach(function(el){sdp.push(makeLine(type,obj,el))})}})});session.media.forEach(function(mLine){sdp.push(makeLine("m",grammar.m[0],mLine));innerOrder.forEach(function(type){grammar[type].forEach(function(obj){if(obj.name in mLine){sdp.push(makeLine(type,obj,mLine))}else if(obj.push in mLine){mLine[obj.push].forEach(function(el){sdp.push(makeLine(type,obj,el))})}})})});return sdp.join("\r\n")+"\r\n"}},{"./grammar":16}],20:[function(require,module,exports){var global=function(){return this}();var WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null;function ws(uri,protocols,opts){var instance;if(protocols){instance=new WebSocket(uri,protocols)}else{instance=new WebSocket(uri)}return instance}if(WebSocket)ws.prototype=WebSocket.prototype},{}],21:[function(require,module,exports){module.exports={name:"exsip",title:"ExSIP",description:"BroadSoft Javascript SIP library",version:"2.0.0",homepage:"http://www.broadsoft.com",author:"BroadSoft, Inc.",contributors:[{url:""}],main:"src/ExSIP.js",repository:{type:"git",url:""},keywords:["sip","websocket","webrtc","library"],dependencies:{"sdp-transform":"0.6.1",ws:"0.4.32"},devDependencies:{nodeunit:"0.9.0",grunt:"0.4.5","grunt-contrib-jshint":"0.10.0","grunt-contrib-concat":"0.5.0","grunt-contrib-nodeunit":"0.4.1","grunt-contrib-uglify":"0.6.0","grunt-contrib-watch":"0.6.1","grunt-contrib-symlink":"0.3.0","grunt-browserify":"3.0.1","grunt-jsdoc":"0.5.7","grunt-notify":">=0.2.6","grunt-bumpx":"0.1.5",pegjs:"0.7.0"},engines:{node:">=0.8"},license:"MIT",scripts:{test:"grunt travis --verbose"}}},{}],22:[function(require,module,exports){var pkg=require("../package.json");var C={USER_AGENT:"BroadSoft WebRTC Client - "+pkg.version,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",BYE:"Terminated",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout",NOT_ACCEPTABLE_ERROR:"Not Acceptable"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488],AUTHENTICATION_ERROR:[401,407],NOT_ACCEPTABLE_ERROR:[606]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",REFER:"REFER",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",SENDONLY:"sendonly",RECVONLY:"recvonly",SENDRECV:"sendrecv",INACTIVE:"inactive",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"ExSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69};module.exports=C},{"../package.json":21}],23:[function(require,module,exports){module.exports=Dialog;var C={STATUS_EARLY:1,STATUS_CONFIRMED:2};Dialog.C=C;
var SIPMessage=require("./SIPMessage");var ExSIP_C=require("./Constants");var Transactions=require("./Transactions");var Utils=require("./Utils");var Dialog_RequestSender=require("./Dialog/RequestSender");function Dialog(owner,message,type,state){var contact;this.uac_pending_reply=false;this.uas_pending_reply=false;this.is_acknowledged=false;this.type=type;if(!message.hasHeader("contact")){return{error:"unable to create a Dialog without Contact header field"}}if(message instanceof SIPMessage.IncomingResponse){state=message.status_code<200?C.STATUS_EARLY:C.STATUS_CONFIRMED}else{state=state||C.STATUS_CONFIRMED}contact=message.parseHeader("contact");if(type==="UAS"){this.id={call_id:message.call_id,local_tag:message.to_tag,remote_tag:message.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}};this.state=state;this.remote_seqnum=message.cseq;this.local_uri=message.parseHeader("to").uri;this.remote_uri=message.parseHeader("from").uri;this.remote_target=contact.uri;this.route_set=message.getHeaders("record-route")}else if(type==="UAC"){this.id={call_id:message.call_id,local_tag:message.from_tag,remote_tag:message.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}};this.state=state;this.local_seqnum=message.cseq;this.local_uri=message.parseHeader("from").uri;this.remote_uri=message.parseHeader("to").uri;this.remote_target=contact.uri;this.route_set=message.getHeaders("record-route").reverse()}this.logger=owner.ua.getLogger("ExSIP.dialog",this.id.toString());this.owner=owner;owner.ua.dialogs[this.id.toString()]=this;this.logger.debug("new "+type+" dialog created with status "+(this.state===C.STATUS_EARLY?"EARLY":"CONFIRMED"))}Dialog.prototype={isUAS:function(){return this.type==="UAS"},isUAC:function(){return this.type==="UAC"},update:function(message,type){this.state=C.STATUS_CONFIRMED;this.logger.debug("dialog "+this.id.toString()+"  changed to CONFIRMED state");if(type==="UAC"){this.route_set=message.getHeaders("record-route").reverse()}},terminate:function(){this.logger.debug("dialog "+this.id.toString()+" deleted");delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(method,extraHeaders,body){var cseq,request;extraHeaders=extraHeaders&&extraHeaders.slice()||[];if(!this.local_seqnum){this.local_seqnum=Math.floor(Math.random()*1e4)}cseq=method===ExSIP_C.CANCEL||method===ExSIP_C.ACK?this.local_seqnum:this.local_seqnum+=1;request=new SIPMessage.OutgoingRequest(method,this.remote_target,this.owner.ua,{cseq:cseq,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},extraHeaders,body);this.logger.debug("createRequest : dialog.request_sender.request.extraHeaders : "+Utils.toString(request.extraHeaders));request.dialog=this;return request},checkInDialogRequest:function(request){var self=this;if(request.method===ExSIP_C.INVITE||request.method===ExSIP_C.UPDATE&&request.body){if(this.uac_pending_reply===true){request.reply(491)}else if(this.uas_pending_reply===true||this.type==="UAS"&&!this.is_acknowledged){var retryAfter=(Math.random()*10|0)+1;request.reply(500,null,["Retry-After:"+retryAfter]);return false}else{this.uas_pending_reply=true;request.server_transaction.on("stateChanged",function stateChanged(e){if(e.sender.state===Transactions.C.STATUS_ACCEPTED||e.sender.state===Transactions.C.STATUS_COMPLETED||e.sender.state===Transactions.C.STATUS_TERMINATED){request.server_transaction.removeListener("stateChanged",stateChanged);self.uas_pending_reply=false;if(self.uac_pending_reply===false){self.owner.onReadyToReinvite()}}})}if(request.hasHeader("contact")){request.server_transaction.on("stateChanged",function(e){if(e.sender.state===Transactions.C.STATUS_ACCEPTED){self.remote_target=request.parseHeader("contact").uri}})}}else if(request.method===ExSIP_C.NOTIFY){if(request.hasHeader("contact")){request.server_transaction.on("stateChanged",function(e){if(e.sender.state===Transactions.C.STATUS_COMPLETED){self.remote_target=request.parseHeader("contact").uri}})}}else if(request.method===ExSIP_C.ACK){this.is_acknowledged=true}if(!this.remote_seqnum){this.remote_seqnum=request.cseq}else if(request.cseq<this.remote_seqnum){if(request.method!==ExSIP_C.ACK){request.reply(500)}return false}else if(request.cseq>this.remote_seqnum){this.remote_seqnum=request.cseq}return true},createRequestSender:function(applicant,method,options){options=options||{};var extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],body=options.body||null,request=this.createRequest(method,extraHeaders,body),request_sender=new Dialog_RequestSender(this,applicant,request);this.logger.debug("dialog.request_sender.request.extraHeaders : "+Utils.toString(request.extraHeaders));return request_sender},sendRequest:function(applicant,method,options){var request_sender=this.createRequestSender(applicant,method,options);request_sender.send()},receiveRequest:function(request){if(!this.checkInDialogRequest(request)){return}this.owner.receiveRequest(request)}}},{"./Constants":22,"./Dialog/RequestSender":24,"./SIPMessage":41,"./Transactions":43,"./Utils":47}],24:[function(require,module,exports){module.exports=DialogRequestSender;var ExSIP_C=require("../Constants");var Transactions=require("../Transactions");var RTCSession=require("../RTCSession");var RequestSender=require("../RequestSender");function DialogRequestSender(dialog,applicant,request){this.dialog=dialog;this.applicant=applicant;this.request=request;this.logger=dialog.owner.ua.getLogger("ExSIP.dialog.requestsender",dialog.id);this.reattempt=false;this.reattemptTimer=null}DialogRequestSender.prototype={send:function(callbacks){var self=this,request_sender=new RequestSender(this,this.dialog.owner.ua);request_sender.send(callbacks);if(this.request.method===ExSIP_C.INVITE&&request_sender.clientTransaction.state!==Transactions.C.STATUS_TERMINATED){this.dialog.uac_pending_reply=true;request_sender.clientTransaction.on("stateChanged",function stateChanged(e){if(e.sender.state===Transactions.C.STATUS_ACCEPTED||e.sender.state===Transactions.C.STATUS_COMPLETED||e.sender.state===Transactions.C.STATUS_TERMINATED){request_sender.clientTransaction.removeListener("stateChanged",stateChanged);self.dialog.uac_pending_reply=false;if(self.dialog.uas_pending_reply===false){self.dialog.owner.onReadyToReinvite()}}})}},onRequestTimeout:function(){this.logger.log("********* onRequestTimeout : ",this.applicant);this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(response){var self=this;this.logger.debug("receiveResponse : "+response);if(response.status_code===408||response.status_code===481){this.applicant.onDialogError(response)}else if(response.method===ExSIP_C.INVITE&&response.status_code===491){if(this.reattempt){this.applicant.receiveResponse(response)}else{this.request.cseq.value=this.dialog.local_seqnum+=1;this.reattemptTimer=setTimeout(function(){if(self.applicant.owner.status!==RTCSession.C.STATUS_TERMINATED){self.reattempt=true;self.request_sender.send()}},this.getReattemptTimeout())}}else{this.applicant.receiveResponse(response)}}}},{"../Constants":22,"../RTCSession":35,"../RequestSender":40,"../Transactions":43}],25:[function(require,module,exports){module.exports=DigestAuthentication;function DigestAuthentication(ua){this.logger=ua.getLogger("ExSIP.digestauthentication");this.username=ua.configuration.authorization_user;this.password=ua.configuration.password;this.cnonce=null;this.nc=0;this.ncHex="00000000";this.response=null}var Utils=require("./Utils");DigestAuthentication.prototype.authenticate=function(request,challenge){this.algorithm=challenge.algorithm;this.realm=challenge.realm;this.nonce=challenge.nonce;this.opaque=challenge.opaque;this.stale=challenge.stale;if(this.algorithm){if(this.algorithm!=="MD5"){this.logger.warn('challenge with Digest algorithm different than "MD5", authentication aborted');return false}}else{this.algorithm="MD5"}if(!this.realm){this.logger.warn("challenge without Digest realm, authentication aborted");return false}if(!this.nonce){this.logger.warn("challenge without Digest nonce, authentication aborted");return false}if(challenge.qop){if(challenge.qop.indexOf("auth")>-1){this.qop="auth"}else if(challenge.qop.indexOf("auth-int")>-1){this.qop="auth-int"}else{this.logger.warn('challenge without Digest qop different than "auth" or "auth-int", authentication aborted');return false}}else{this.qop=null}this.method=request.method;this.uri=request.ruri;this.cnonce=Utils.createRandomToken(12);this.nc+=1;this.updateNcHex();if(this.nc===4294967296){this.nc=1;this.ncHex="00000001"}this.calculateResponse();return true};DigestAuthentication.prototype.calculateResponse=function(){var ha1,ha2;ha1=Utils.calculateMD5(this.username+":"+this.realm+":"+this.password);if(this.qop==="auth"){ha2=Utils.calculateMD5(this.method+":"+this.uri);this.response=Utils.calculateMD5(ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+ha2)}else if(this.qop==="auth-int"){ha2=Utils.calculateMD5(this.method+":"+this.uri+":"+Utils.calculateMD5(this.body?this.body:""));this.response=Utils.calculateMD5(ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+ha2)}else if(this.qop===null){ha2=Utils.calculateMD5(this.method+":"+this.uri);this.response=Utils.calculateMD5(ha1+":"+this.nonce+":"+ha2)}};DigestAuthentication.prototype.toString=function(){var auth_params=[];if(!this.response){throw new Error("response field does not exist, cannot generate Authorization header")}auth_params.push("algorithm="+this.algorithm);auth_params.push('username="'+this.username+'"');auth_params.push('realm="'+this.realm+'"');auth_params.push('nonce="'+this.nonce+'"');auth_params.push('uri="'+this.uri+'"');auth_params.push('response="'+this.response+'"');if(this.opaque){auth_params.push('opaque="'+this.opaque+'"')}if(this.qop){auth_params.push("qop="+this.qop);auth_params.push('cnonce="'+this.cnonce+'"');auth_params.push("nc="+this.ncHex)}return"Digest "+auth_params.join(", ")};DigestAuthentication.prototype.updateNcHex=function(){var hex=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-hex.length)+hex}},{"./Utils":47}],26:[function(require,module,exports){module.exports=EventEmitter;function EventEmitter(){}var LoggerFactory=require("./LoggerFactory");function Event(type,sender,data){this.type=type;this.sender=sender;this.data=data}var logger=(new LoggerFactory).getLogger("ExSIP.eventemitter"),C={MAX_LISTENERS:50};EventEmitter.prototype={initEvents:function(events){var idx,length;if(!this.logger){this.logger=logger}this.maxListeners=C.MAX_LISTENERS;this.events={};this.oneTimeListeners={};length=events.length;for(idx=0;idx<length;idx++){this.events[events[idx]]=[];this.oneTimeListeners[events[idx]]=[]}},checkEvent:function(event){return!!this.events[event]},addListener:function(event,listener){if(listener===undefined){return}else if(typeof listener!=="function"){this.logger.error("listener must be a function");return}else if(!this.checkEvent(event)){this.logger.error("unable to add a listener to a nonexistent event "+event);return}if(this.events[event].length>=this.maxListeners){this.logger.warn("max listeners exceeded for event "+event)}this.events[event].push(listener)},on:function(event,listener){this.addListener(event,listener)},once:function(event,listener){this.on(event,listener);this.oneTimeListeners[event].push(listener)},removeListener:function(event,listener){var events,length,idx=0;if(listener===undefined){return}else if(typeof listener!=="function"){this.logger.error("listener must be a function");return}else if(!this.checkEvent(event)){this.logger.error("unable to remove a listener from a nonexistent event"+event);return}events=this.events[event];length=events.length;while(idx<length){if(events[idx]===listener){events.splice(idx,1)}else{idx++}}},removeAllListener:function(event){if(!this.checkEvent(event)){this.logger.error("unable to remove listeners from a nonexistent event"+event);return}this.events[event]=[];this.oneTimeListeners[event]=[]},setMaxListeners:function(listeners){if(typeof listeners!=="number"||listeners<0){this.logger.error("listeners must be a positive number");return}this.maxListeners=listeners},listeners:function(event){if(!this.checkEvent(event)){this.logger.error("no event "+event);return}return this.events[event]},emit:function(event,sender,data){var listeners,length,e,idx,self=this;if(!this.checkEvent(event)){this.logger.error("unable to emit a nonexistent event"+event);return}this.logger.debug("emitting event "+event);listeners=this.events[event];length=listeners.length;e=new Event(event,sender,data);listeners.map(function(listener){return function(){listener.call(null,e)}}).forEach(function(callback){try{callback()}catch(err){self.logger.error(err.stack)}});for(idx in this.oneTimeListeners[event]){this.removeListener(event,this.oneTimeListeners[event][idx])}this.oneTimeListeners[event]=[]}}},{"./LoggerFactory":31}],27:[function(require,module,exports){var ExSIP={C:require("./Constants"),Exceptions:require("./Exceptions"),Utils:require("./Utils"),UA:require("./UA"),URI:require("./URI"),NameAddrHeader:require("./NameAddrHeader"),Grammar:require("./Grammar"),WebRTC:require("./WebRTC"),RTCSession:require("./RTCSession")};module.exports=ExSIP;var pkg=require("../package.json");Object.defineProperties(ExSIP,{name:{get:function(){return pkg.title}},version:{get:function(){return pkg.version}}})},{"../package.json":21,"./Constants":22,"./Exceptions":28,"./Grammar":29,"./NameAddrHeader":33,"./RTCSession":35,"./UA":45,"./URI":46,"./Utils":47,"./WebRTC":48}],28:[function(require,module,exports){var Exceptions={ConfigurationError:function(){var exception=function(parameter,value){console.trace("----------------------ConfigurationError : "+parameter+", "+value);this.code=1;this.name="CONFIGURATION_ERROR";this.parameter=parameter;this.value=value;this.message=!this.value?"Missing parameter: "+this.parameter:"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"'};exception.prototype=new Error;return exception}(),InvalidStateError:function(){var exception=function(status){console.trace("----------------------InvalidStateError : "+status);this.code=2;this.name="INVALID_STATE_ERROR";this.status=status;this.message="Invalid status: "+status};exception.prototype=new Error;return exception}(),NotSupportedError:function(){var exception=function(message){console.trace("----------------------NotSupportedError : "+message);this.code=3;this.name="NOT_SUPPORTED_ERROR";this.message=message};exception.prototype=new Error;return exception}(),NotReadyError:function(){var exception=function(message){console.trace("----------------------NotReadyError : "+message);this.code=4;this.name="NOT_READY_ERROR";this.message=message};exception.prototype=new Error;return exception}()};module.exports=Exceptions},{}],29:[function(require,module,exports){module.exports=function(){function quote(s){return'"'+s.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var result={parse:function(input,startRule){var parseFunctions={CRLF:parse_CRLF,DIGIT:parse_DIGIT,ALPHA:parse_ALPHA,HEXDIG:parse_HEXDIG,WSP:parse_WSP,OCTET:parse_OCTET,DQUOTE:parse_DQUOTE,SP:parse_SP,HTAB:parse_HTAB,alphanum:parse_alphanum,reserved:parse_reserved,unreserved:parse_unreserved,mark:parse_mark,escaped:parse_escaped,LWS:parse_LWS,SWS:parse_SWS,HCOLON:parse_HCOLON,TEXT_UTF8_TRIM:parse_TEXT_UTF8_TRIM,TEXT_UTF8char:parse_TEXT_UTF8char,UTF8_NONASCII:parse_UTF8_NONASCII,UTF8_CONT:parse_UTF8_CONT,LHEX:parse_LHEX,token:parse_token,token_nodot:parse_token_nodot,separators:parse_separators,word:parse_word,STAR:parse_STAR,SLASH:parse_SLASH,EQUAL:parse_EQUAL,LPAREN:parse_LPAREN,RPAREN:parse_RPAREN,RAQUOT:parse_RAQUOT,LAQUOT:parse_LAQUOT,COMMA:parse_COMMA,SEMI:parse_SEMI,COLON:parse_COLON,LDQUOT:parse_LDQUOT,RDQUOT:parse_RDQUOT,comment:parse_comment,ctext:parse_ctext,quoted_string:parse_quoted_string,quoted_string_clean:parse_quoted_string_clean,qdtext:parse_qdtext,quoted_pair:parse_quoted_pair,SIP_URI_noparams:parse_SIP_URI_noparams,SIP_URI:parse_SIP_URI,uri_scheme:parse_uri_scheme,userinfo:parse_userinfo,user:parse_user,user_unreserved:parse_user_unreserved,password:parse_password,hostport:parse_hostport,host:parse_host,hostname:parse_hostname,domainlabel:parse_domainlabel,toplabel:parse_toplabel,IPv6reference:parse_IPv6reference,IPv6address:parse_IPv6address,h16:parse_h16,ls32:parse_ls32,IPv4address:parse_IPv4address,dec_octet:parse_dec_octet,port:parse_port,uri_parameters:parse_uri_parameters,uri_parameter:parse_uri_parameter,transport_param:parse_transport_param,user_param:parse_user_param,method_param:parse_method_param,ttl_param:parse_ttl_param,maddr_param:parse_maddr_param,lr_param:parse_lr_param,other_param:parse_other_param,pname:parse_pname,pvalue:parse_pvalue,paramchar:parse_paramchar,param_unreserved:parse_param_unreserved,headers:parse_headers,header:parse_header,hname:parse_hname,hvalue:parse_hvalue,hnv_unreserved:parse_hnv_unreserved,Request_Response:parse_Request_Response,Request_Line:parse_Request_Line,Request_URI:parse_Request_URI,absoluteURI:parse_absoluteURI,hier_part:parse_hier_part,net_path:parse_net_path,abs_path:parse_abs_path,opaque_part:parse_opaque_part,uric:parse_uric,uric_no_slash:parse_uric_no_slash,path_segments:parse_path_segments,segment:parse_segment,param:parse_param,pchar:parse_pchar,scheme:parse_scheme,authority:parse_authority,srvr:parse_srvr,reg_name:parse_reg_name,query:parse_query,SIP_Version:parse_SIP_Version,INVITEm:parse_INVITEm,ACKm:parse_ACKm,OPTIONSm:parse_OPTIONSm,BYEm:parse_BYEm,CANCELm:parse_CANCELm,REGISTERm:parse_REGISTERm,SUBSCRIBEm:parse_SUBSCRIBEm,NOTIFYm:parse_NOTIFYm,Method:parse_Method,Status_Line:parse_Status_Line,Status_Code:parse_Status_Code,extension_code:parse_extension_code,Reason_Phrase:parse_Reason_Phrase,Allow_Events:parse_Allow_Events,Call_ID:parse_Call_ID,Contact:parse_Contact,contact_param:parse_contact_param,name_addr:parse_name_addr,display_name:parse_display_name,contact_params:parse_contact_params,c_p_q:parse_c_p_q,c_p_expires:parse_c_p_expires,delta_seconds:parse_delta_seconds,qvalue:parse_qvalue,generic_param:parse_generic_param,gen_value:parse_gen_value,Content_Disposition:parse_Content_Disposition,disp_type:parse_disp_type,disp_param:parse_disp_param,handling_param:parse_handling_param,Content_Encoding:parse_Content_Encoding,Content_Length:parse_Content_Length,Content_Type:parse_Content_Type,media_type:parse_media_type,m_type:parse_m_type,discrete_type:parse_discrete_type,composite_type:parse_composite_type,extension_token:parse_extension_token,x_token:parse_x_token,m_subtype:parse_m_subtype,m_parameter:parse_m_parameter,m_value:parse_m_value,CSeq:parse_CSeq,CSeq_value:parse_CSeq_value,Expires:parse_Expires,Event:parse_Event,event_type:parse_event_type,From:parse_From,from_param:parse_from_param,tag_param:parse_tag_param,Max_Forwards:parse_Max_Forwards,Min_Expires:parse_Min_Expires,Name_Addr_Header:parse_Name_Addr_Header,Proxy_Authenticate:parse_Proxy_Authenticate,challenge:parse_challenge,other_challenge:parse_other_challenge,auth_param:parse_auth_param,digest_cln:parse_digest_cln,realm:parse_realm,realm_value:parse_realm_value,domain:parse_domain,URI:parse_URI,nonce:parse_nonce,nonce_value:parse_nonce_value,opaque:parse_opaque,stale:parse_stale,algorithm:parse_algorithm,qop_options:parse_qop_options,qop_value:parse_qop_value,Proxy_Require:parse_Proxy_Require,Record_Route:parse_Record_Route,rec_route:parse_rec_route,Require:parse_Require,Route:parse_Route,route_param:parse_route_param,Subscription_State:parse_Subscription_State,substate_value:parse_substate_value,subexp_params:parse_subexp_params,event_reason_value:parse_event_reason_value,Subject:parse_Subject,Supported:parse_Supported,To:parse_To,to_param:parse_to_param,Via:parse_Via,via_parm:parse_via_parm,via_params:parse_via_params,via_ttl:parse_via_ttl,via_maddr:parse_via_maddr,via_received:parse_via_received,via_branch:parse_via_branch,response_port:parse_response_port,sent_protocol:parse_sent_protocol,protocol_name:parse_protocol_name,transport:parse_transport,sent_by:parse_sent_by,via_host:parse_via_host,via_port:parse_via_port,ttl:parse_ttl,WWW_Authenticate:parse_WWW_Authenticate,extension_header:parse_extension_header,header_value:parse_header_value,message_body:parse_message_body,stun_URI:parse_stun_URI,stun_scheme:parse_stun_scheme,stun_host_port:parse_stun_host_port,stun_host:parse_stun_host,reg_name:parse_reg_name,stun_unreserved:parse_stun_unreserved,sub_delims:parse_sub_delims,turn_URI:parse_turn_URI,turn_scheme:parse_turn_scheme,turn_transport:parse_turn_transport,uuid_URI:parse_uuid_URI,uuid:parse_uuid,hex4:parse_hex4,hex8:parse_hex8,hex12:parse_hex12};if(startRule!==undefined){if(parseFunctions[startRule]===undefined){throw new Error("Invalid rule name: "+quote(startRule)+".")}}else{startRule="CRLF"}var pos=0;var reportFailures=0;var rightmostFailuresPos=0;var rightmostFailuresExpected=[];function padLeft(input,padding,length){var result=input;var padLength=length-input.length;for(var i=0;i<padLength;i++){result=padding+result}return result}function escape(ch){var charCode=ch.charCodeAt(0);var escapeChar;var length;if(charCode<=255){escapeChar="x";length=2}else{escapeChar="u";length=4}return"\\"+escapeChar+padLeft(charCode.toString(16).toUpperCase(),"0",length)}function matchFailed(failure){if(pos<rightmostFailuresPos){return}if(pos>rightmostFailuresPos){rightmostFailuresPos=pos;rightmostFailuresExpected=[]}rightmostFailuresExpected.push(failure)}function parse_CRLF(){var result0;if(input.substr(pos,2)==="\r\n"){result0="\r\n";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"\\r\\n"')}}return result0}function parse_DIGIT(){var result0;if(/^[0-9]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[0-9]")}}return result0}function parse_ALPHA(){var result0;if(/^[a-zA-Z]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[a-zA-Z]")}}return result0}function parse_HEXDIG(){var result0;if(/^[0-9a-fA-F]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[0-9a-fA-F]")}}return result0}function parse_WSP(){var result0;result0=parse_SP();if(result0===null){result0=parse_HTAB()}return result0}function parse_OCTET(){var result0;if(/^[\0-\xFF]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\0-\\xFF]")}}return result0}function parse_DQUOTE(){var result0;if(/^["]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed('["]')}}return result0}function parse_SP(){var result0;if(input.charCodeAt(pos)===32){result0=" ";pos++}else{result0=null;if(reportFailures===0){matchFailed('" "')}}return result0}function parse_HTAB(){var result0;if(input.charCodeAt(pos)===9){result0="	";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\\t"')}}return result0}function parse_alphanum(){var result0;if(/^[a-zA-Z0-9]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9]")}}return result0}function parse_reserved(){var result0;if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===64){result0="@";pos++}else{result0=null;if(reportFailures===0){matchFailed('"@"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}}}}}}}}}}return result0}function parse_unreserved(){var result0;result0=parse_alphanum();if(result0===null){result0=parse_mark()}return result0}function parse_mark(){var result0;if(input.charCodeAt(pos)===45){result0="-";pos++}else{result0=null;if(reportFailures===0){matchFailed('"-"')}}if(result0===null){if(input.charCodeAt(pos)===95){result0="_";pos++}else{result0=null;if(reportFailures===0){matchFailed('"_"')}}if(result0===null){if(input.charCodeAt(pos)===46){result0=".";pos++}else{result0=null;if(reportFailures===0){matchFailed('"."')}}if(result0===null){if(input.charCodeAt(pos)===33){result0="!";pos++}else{result0=null;if(reportFailures===0){matchFailed('"!"')}}if(result0===null){if(input.charCodeAt(pos)===126){result0="~";pos++}else{result0=null;if(reportFailures===0){matchFailed('"~"')}}if(result0===null){if(input.charCodeAt(pos)===42){result0="*";pos++}else{result0=null;if(reportFailures===0){matchFailed('"*"')}}if(result0===null){if(input.charCodeAt(pos)===39){result0="'";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\'"')}}if(result0===null){if(input.charCodeAt(pos)===40){result0="(";pos++}else{result0=null;if(reportFailures===0){matchFailed('"("')}}if(result0===null){if(input.charCodeAt(pos)===41){result0=")";pos++}else{result0=null;if(reportFailures===0){matchFailed('")"')}}}}}}}}}}return result0}function parse_escaped(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.charCodeAt(pos)===37){result0="%";pos++}else{result0=null;if(reportFailures===0){matchFailed('"%"')}}if(result0!==null){result1=parse_HEXDIG();if(result1!==null){result2=parse_HEXDIG();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,escaped){return escaped.join("")}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_LWS(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;pos2=pos;result0=[];result1=parse_WSP();while(result1!==null){result0.push(result1);result1=parse_WSP()}if(result0!==null){result1=parse_CRLF();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos2}}else{result0=null;pos=pos2}result0=result0!==null?result0:"";if(result0!==null){result2=parse_WSP();if(result2!==null){result1=[];while(result2!==null){result1.push(result2);result2=parse_WSP()}}else{result1=null}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return" "}(pos0)}if(result0===null){pos=pos0}return result0}function parse_SWS(){var result0;result0=parse_LWS();result0=result0!==null?result0:"";return result0}function parse_HCOLON(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=[];result1=parse_SP();if(result1===null){result1=parse_HTAB()}while(result1!==null){result0.push(result1);result1=parse_SP();if(result1===null){result1=parse_HTAB()}}if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return":"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_TEXT_UTF8_TRIM(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result1=parse_TEXT_UTF8char();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_TEXT_UTF8char()}}else{result0=null}if(result0!==null){result1=[];pos2=pos;result2=[];result3=parse_LWS();while(result3!==null){result2.push(result3);result3=parse_LWS()}if(result2!==null){result3=parse_TEXT_UTF8char();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=[];result3=parse_LWS();while(result3!==null){result2.push(result3);result3=parse_LWS()}if(result2!==null){result3=parse_TEXT_UTF8char();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_TEXT_UTF8char(){var result0;if(/^[!-~]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[!-~]")}}if(result0===null){result0=parse_UTF8_NONASCII()}return result0}function parse_UTF8_NONASCII(){var result0;if(/^[\x80-\uFFFF]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\x80-\\uFFFF]")}}return result0}function parse_UTF8_CONT(){var result0;if(/^[\x80-\xBF]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\x80-\\xBF]")}}return result0}function parse_LHEX(){var result0;result0=parse_DIGIT();if(result0===null){if(/^[a-f]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[a-f]")}}}return result0}function parse_token(){var result0,result1;var pos0;pos0=pos;result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}}}}}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')
}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}}}}}}}}else{result0=null}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_token_nodot(){var result0,result1;var pos0;pos0=pos;result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}}}}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}}}}}}}else{result0=null}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_separators(){var result0;if(input.charCodeAt(pos)===40){result0="(";pos++}else{result0=null;if(reportFailures===0){matchFailed('"("')}}if(result0===null){if(input.charCodeAt(pos)===41){result0=")";pos++}else{result0=null;if(reportFailures===0){matchFailed('")"')}}if(result0===null){if(input.charCodeAt(pos)===60){result0="<";pos++}else{result0=null;if(reportFailures===0){matchFailed('"<"')}}if(result0===null){if(input.charCodeAt(pos)===62){result0=">";pos++}else{result0=null;if(reportFailures===0){matchFailed('">"')}}if(result0===null){if(input.charCodeAt(pos)===64){result0="@";pos++}else{result0=null;if(reportFailures===0){matchFailed('"@"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}if(result0===null){if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===92){result0="\\";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\\\\"')}}if(result0===null){result0=parse_DQUOTE();if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0===null){if(input.charCodeAt(pos)===91){result0="[";pos++}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0===null){if(input.charCodeAt(pos)===93){result0="]";pos++}else{result0=null;if(reportFailures===0){matchFailed('"]"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===123){result0="{";pos++}else{result0=null;if(reportFailures===0){matchFailed('"{"')}}if(result0===null){if(input.charCodeAt(pos)===125){result0="}";pos++}else{result0=null;if(reportFailures===0){matchFailed('"}"')}}if(result0===null){result0=parse_SP();if(result0===null){result0=parse_HTAB()}}}}}}}}}}}}}}}}}}return result0}function parse_word(){var result0,result1;var pos0;pos0=pos;result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}if(result1===null){if(input.charCodeAt(pos)===40){result1="(";pos++}else{result1=null;if(reportFailures===0){matchFailed('"("')}}if(result1===null){if(input.charCodeAt(pos)===41){result1=")";pos++}else{result1=null;if(reportFailures===0){matchFailed('")"')}}if(result1===null){if(input.charCodeAt(pos)===60){result1="<";pos++}else{result1=null;if(reportFailures===0){matchFailed('"<"')}}if(result1===null){if(input.charCodeAt(pos)===62){result1=">";pos++}else{result1=null;if(reportFailures===0){matchFailed('">"')}}if(result1===null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1===null){if(input.charCodeAt(pos)===92){result1="\\";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\\\\"')}}if(result1===null){result1=parse_DQUOTE();if(result1===null){if(input.charCodeAt(pos)===47){result1="/";pos++}else{result1=null;if(reportFailures===0){matchFailed('"/"')}}if(result1===null){if(input.charCodeAt(pos)===91){result1="[";pos++}else{result1=null;if(reportFailures===0){matchFailed('"["')}}if(result1===null){if(input.charCodeAt(pos)===93){result1="]";pos++}else{result1=null;if(reportFailures===0){matchFailed('"]"')}}if(result1===null){if(input.charCodeAt(pos)===63){result1="?";pos++}else{result1=null;if(reportFailures===0){matchFailed('"?"')}}if(result1===null){if(input.charCodeAt(pos)===123){result1="{";pos++}else{result1=null;if(reportFailures===0){matchFailed('"{"')}}if(result1===null){if(input.charCodeAt(pos)===125){result1="}";pos++}else{result1=null;if(reportFailures===0){matchFailed('"}"')}}}}}}}}}}}}}}}}}}}}}}}}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}if(result1===null){if(input.charCodeAt(pos)===40){result1="(";pos++}else{result1=null;if(reportFailures===0){matchFailed('"("')}}if(result1===null){if(input.charCodeAt(pos)===41){result1=")";pos++}else{result1=null;if(reportFailures===0){matchFailed('")"')}}if(result1===null){if(input.charCodeAt(pos)===60){result1="<";pos++}else{result1=null;if(reportFailures===0){matchFailed('"<"')}}if(result1===null){if(input.charCodeAt(pos)===62){result1=">";pos++}else{result1=null;if(reportFailures===0){matchFailed('">"')}}if(result1===null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1===null){if(input.charCodeAt(pos)===92){result1="\\";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\\\\"')}}if(result1===null){result1=parse_DQUOTE();if(result1===null){if(input.charCodeAt(pos)===47){result1="/";pos++}else{result1=null;if(reportFailures===0){matchFailed('"/"')}}if(result1===null){if(input.charCodeAt(pos)===91){result1="[";pos++}else{result1=null;if(reportFailures===0){matchFailed('"["')}}if(result1===null){if(input.charCodeAt(pos)===93){result1="]";pos++}else{result1=null;if(reportFailures===0){matchFailed('"]"')}}if(result1===null){if(input.charCodeAt(pos)===63){result1="?";pos++}else{result1=null;if(reportFailures===0){matchFailed('"?"')}}if(result1===null){if(input.charCodeAt(pos)===123){result1="{";pos++}else{result1=null;if(reportFailures===0){matchFailed('"{"')}}if(result1===null){if(input.charCodeAt(pos)===125){result1="}";pos++}else{result1=null;if(reportFailures===0){matchFailed('"}"')}}}}}}}}}}}}}}}}}}}}}}}}}}}else{result0=null}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_STAR(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"*"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_SLASH(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===47){result1="/";pos++}else{result1=null;if(reportFailures===0){matchFailed('"/"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"/"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_EQUAL(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"="}(pos0)}if(result0===null){pos=pos0}return result0}function parse_LPAREN(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===40){result1="(";pos++}else{result1=null;if(reportFailures===0){matchFailed('"("')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"("}(pos0)}if(result0===null){pos=pos0}return result0}function parse_RPAREN(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===41){result1=")";pos++}else{result1=null;if(reportFailures===0){matchFailed('")"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return")"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_RAQUOT(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.charCodeAt(pos)===62){result0=">";pos++}else{result0=null;if(reportFailures===0){matchFailed('">"')}}if(result0!==null){result1=parse_SWS();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return">"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_LAQUOT(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===60){result1="<";pos++}else{result1=null;if(reportFailures===0){matchFailed('"<"')}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"<"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_COMMA(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return","}(pos0)}if(result0===null){pos=pos0}return result0}function parse_SEMI(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return";"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_COLON(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return":"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_LDQUOT(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){result1=parse_DQUOTE();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return'"'}(pos0)}if(result0===null){pos=pos0}return result0}function parse_RDQUOT(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_DQUOTE();if(result0!==null){result1=parse_SWS();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return'"'}(pos0)}if(result0===null){pos=pos0}return result0}function parse_comment(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_LPAREN();if(result0!==null){result1=[];result2=parse_ctext();if(result2===null){result2=parse_quoted_pair();if(result2===null){result2=parse_comment()}}while(result2!==null){result1.push(result2);result2=parse_ctext();if(result2===null){result2=parse_quoted_pair();if(result2===null){result2=parse_comment()}}}if(result1!==null){result2=parse_RPAREN();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_ctext(){var result0;if(/^[!-']/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[!-']")}}if(result0===null){if(/^[*-[]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[*-[]")}}if(result0===null){if(/^[\]-~]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\]-~]")}}if(result0===null){result0=parse_UTF8_NONASCII();if(result0===null){result0=parse_LWS()}}}}return result0}function parse_quoted_string(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){result1=parse_DQUOTE();if(result1!==null){result2=[];result3=parse_qdtext();if(result3===null){result3=parse_quoted_pair()}while(result3!==null){result2.push(result3);result3=parse_qdtext();if(result3===null){result3=parse_quoted_pair()}}if(result2!==null){result3=parse_DQUOTE();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_quoted_string_clean(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){result1=parse_DQUOTE();if(result1!==null){result2=[];result3=parse_qdtext();if(result3===null){result3=parse_quoted_pair()}while(result3!==null){result2.push(result3);result3=parse_qdtext();if(result3===null){result3=parse_quoted_pair()}}if(result2!==null){result3=parse_DQUOTE();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return input.substring(pos-1,offset+1)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_qdtext(){var result0;result0=parse_LWS();if(result0===null){if(input.charCodeAt(pos)===33){result0="!";pos++}else{result0=null;if(reportFailures===0){matchFailed('"!"')}}if(result0===null){if(/^[#-[]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[#-[]")}}if(result0===null){if(/^[\]-~]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\]-~]")}}if(result0===null){result0=parse_UTF8_NONASCII()}}}}return result0}function parse_quoted_pair(){var result0,result1;var pos0;pos0=pos;if(input.charCodeAt(pos)===92){result0="\\";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\\\\"')}}if(result0!==null){if(/^[\0-\t]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[\\0-\\t]")}}if(result1===null){if(/^[\x0B-\f]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[\\x0B-\\f]")}}if(result1===null){if(/^[\x0E-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[\\x0E-]")}}}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_SIP_URI_noparams(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_uri_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_userinfo();result2=result2!==null?result2:"";if(result2!==null){result3=parse_hostport();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){try{data.uri=new URI(data.scheme,data.user,data.host,data.port);delete data.scheme;delete data.user;delete data.host;delete data.host_type;delete data.port}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_SIP_URI(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_uri_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_userinfo();result2=result2!==null?result2:"";if(result2!==null){result3=parse_hostport();if(result3!==null){result4=parse_uri_parameters();if(result4!==null){result5=parse_headers();result5=result5!==null?result5:"";if(result5!==null){result0=[result0,result1,result2,result3,result4,result5]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var header;try{data.uri=new URI(data.scheme,data.user,data.host,data.port,data.uri_params,data.uri_headers);delete data.scheme;delete data.user;delete data.host;delete data.host_type;delete data.port;delete data.uri_params;if(startRule==="SIP_URI"){data=data.uri}}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_uri_scheme(){var result0;var pos0;if(input.substr(pos,3).toLowerCase()==="sip"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"sip"')}}if(result0===null){pos0=pos;if(input.substr(pos,4).toLowerCase()==="sips"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"sips"')}}if(result0!==null){result0=function(offset){data.scheme=uri_scheme.toLowerCase()}(pos0)}if(result0===null){pos=pos0}}return result0}function parse_userinfo(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_user();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_password();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){if(input.charCodeAt(pos)===64){result2="@";pos++}else{result2=null;if(reportFailures===0){matchFailed('"@"')}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.user=decodeURIComponent(input.substring(pos-1,offset))}(pos0)}if(result0===null){pos=pos0}return result0}function parse_user(){var result0,result1;result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_user_unreserved()}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_user_unreserved()}}}}else{result0=null}return result0}function parse_user_unreserved(){var result0;if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}if(result0===null){if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}}}}}}}}return result0}function parse_password(){var result0,result1;var pos0;pos0=pos;result0=[];result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){if(input.charCodeAt(pos)===38){result1="&";pos++}else{result1=null;if(reportFailures===0){matchFailed('"&"')}}if(result1===null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===36){result1="$";pos++}else{result1=null;if(reportFailures===0){matchFailed('"$"')}}if(result1===null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}}}}}}}while(result1!==null){result0.push(result1);result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){if(input.charCodeAt(pos)===38){result1="&";pos++}else{result1=null;if(reportFailures===0){matchFailed('"&"')}}if(result1===null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===36){result1="$";pos++}else{result1=null;if(reportFailures===0){matchFailed('"$"')}}if(result1===null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}}}}}}}}if(result0!==null){result0=function(offset){data.password=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_hostport(){var result0,result1,result2;var pos0,pos1;pos0=pos;result0=parse_host();if(result0!==null){pos1=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_port();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos1}}else{result1=null;pos=pos1}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_host(){var result0;var pos0;pos0=pos;result0=parse_IPv4address();if(result0===null){result0=parse_IPv6reference();if(result0===null){result0=parse_hostname()}}if(result0!==null){result0=function(offset){data.host=input.substring(pos,offset).toLowerCase();return data.host}(pos0)}if(result0===null){pos=pos0}return result0}function parse_hostname(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=[];pos2=pos;result1=parse_domainlabel();if(result1!==null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}while(result1!==null){result0.push(result1);pos2=pos;result1=parse_domainlabel();if(result1!==null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}}if(result0!==null){result1=parse_toplabel();if(result1!==null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}result2=result2!==null?result2:"";if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.host_type="domain";return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_domainlabel(){var result0,result1;if(/^[a-zA-Z0-9_\-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9_\\-]")}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);if(/^[a-zA-Z0-9_\-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9_\\-]")}}}}else{result0=null}return result0}function parse_toplabel(){var result0,result1;if(/^[a-zA-Z0-9_\-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9_\\-]")}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);if(/^[a-zA-Z0-9_\-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9_\\-]")}}}}else{result0=null}return result0}function parse_IPv6reference(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.charCodeAt(pos)===91){result0="[";pos++}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0!==null){result1=parse_IPv6address();if(result1!==null){if(input.charCodeAt(pos)===93){result2="]";pos++}else{result2=null;if(reportFailures===0){matchFailed('"]"')}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.host_type="IPv6";return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_IPv6address(){var result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11,result12;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_h16();
if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){if(input.charCodeAt(pos)===58){result7=":";pos++}else{result7=null;if(reportFailures===0){matchFailed('":"')}}if(result7!==null){result8=parse_h16();if(result8!==null){if(input.charCodeAt(pos)===58){result9=":";pos++}else{result9=null;if(reportFailures===0){matchFailed('":"')}}if(result9!==null){result10=parse_h16();if(result10!==null){if(input.charCodeAt(pos)===58){result11=":";pos++}else{result11=null;if(reportFailures===0){matchFailed('":"')}}if(result11!==null){result12=parse_ls32();if(result12!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11,result12]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_h16();if(result7!==null){if(input.charCodeAt(pos)===58){result8=":";pos++}else{result8=null;if(reportFailures===0){matchFailed('":"')}}if(result8!==null){result9=parse_h16();if(result9!==null){if(input.charCodeAt(pos)===58){result10=":";pos++}else{result10=null;if(reportFailures===0){matchFailed('":"')}}if(result10!==null){result11=parse_ls32();if(result11!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_h16();if(result7!==null){if(input.charCodeAt(pos)===58){result8=":";pos++}else{result8=null;if(reportFailures===0){matchFailed('":"')}}if(result8!==null){result9=parse_ls32();if(result9!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_ls32();if(result7!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_ls32();if(result5!==null){result0=[result0,result1,result2,result3,result4,result5]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_ls32();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_ls32();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){if(input.substr(pos,2)==="::"){result1="::";pos+=2}else{result1=null;if(reportFailures===0){matchFailed('"::"')}}if(result1!==null){result2=parse_h16();if(result2!==null){if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){if(input.charCodeAt(pos)===58){result7=":";pos++}else{result7=null;if(reportFailures===0){matchFailed('":"')}}if(result7!==null){result8=parse_h16();if(result8!==null){if(input.charCodeAt(pos)===58){result9=":";pos++}else{result9=null;if(reportFailures===0){matchFailed('":"')}}if(result9!==null){result10=parse_ls32();if(result10!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){if(input.substr(pos,2)==="::"){result2="::";pos+=2}else{result2=null;if(reportFailures===0){matchFailed('"::"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_h16();if(result7!==null){if(input.charCodeAt(pos)===58){result8=":";pos++}else{result8=null;if(reportFailures===0){matchFailed('":"')}}if(result8!==null){result9=parse_ls32();if(result9!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){if(input.substr(pos,2)==="::"){result3="::";pos+=2}else{result3=null;if(reportFailures===0){matchFailed('"::"')}}if(result3!==null){result4=parse_h16();if(result4!==null){if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){if(input.charCodeAt(pos)===58){result7=":";pos++}else{result7=null;if(reportFailures===0){matchFailed('":"')}}if(result7!==null){result8=parse_ls32();if(result8!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){pos2=pos;if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos2}}else{result3=null;pos=pos2}result3=result3!==null?result3:"";if(result3!==null){if(input.substr(pos,2)==="::"){result4="::";pos+=2}else{result4=null;if(reportFailures===0){matchFailed('"::"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_ls32();if(result7!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){pos2=pos;if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos2}}else{result3=null;pos=pos2}result3=result3!==null?result3:"";if(result3!==null){pos2=pos;if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos2}}else{result4=null;pos=pos2}result4=result4!==null?result4:"";if(result4!==null){if(input.substr(pos,2)==="::"){result5="::";pos+=2}else{result5=null;if(reportFailures===0){matchFailed('"::"')}}if(result5!==null){result6=parse_ls32();if(result6!==null){result0=[result0,result1,result2,result3,result4,result5,result6]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){pos2=pos;if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos2}}else{result3=null;pos=pos2}result3=result3!==null?result3:"";if(result3!==null){pos2=pos;if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos2}}else{result4=null;pos=pos2}result4=result4!==null?result4:"";if(result4!==null){pos2=pos;if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}result5=result5!==null?result5:"";if(result5!==null){if(input.substr(pos,2)==="::"){result6="::";pos+=2}else{result6=null;if(reportFailures===0){matchFailed('"::"')}}if(result6!==null){result7=parse_h16();if(result7!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){pos2=pos;if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos2}}else{result3=null;pos=pos2}result3=result3!==null?result3:"";if(result3!==null){pos2=pos;if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos2}}else{result4=null;pos=pos2}result4=result4!==null?result4:"";if(result4!==null){pos2=pos;if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}result5=result5!==null?result5:"";if(result5!==null){pos2=pos;if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_h16();if(result7!==null){result6=[result6,result7]}else{result6=null;pos=pos2}}else{result6=null;pos=pos2}result6=result6!==null?result6:"";if(result6!==null){if(input.substr(pos,2)==="::"){result7="::";pos+=2}else{result7=null;if(reportFailures===0){matchFailed('"::"')}}if(result7!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}}}}}}}}}}}}}}if(result0!==null){result0=function(offset){data.host_type="IPv6";return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_h16(){var result0,result1,result2,result3;var pos0;pos0=pos;result0=parse_HEXDIG();if(result0!==null){result1=parse_HEXDIG();result1=result1!==null?result1:"";if(result1!==null){result2=parse_HEXDIG();result2=result2!==null?result2:"";if(result2!==null){result3=parse_HEXDIG();result3=result3!==null?result3:"";if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_ls32(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_h16();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){result0=parse_IPv4address()}return result0}function parse_IPv4address(){var result0,result1,result2,result3,result4,result5,result6;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_dec_octet();if(result0!==null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1!==null){result2=parse_dec_octet();if(result2!==null){if(input.charCodeAt(pos)===46){result3=".";pos++}else{result3=null;if(reportFailures===0){matchFailed('"."')}}if(result3!==null){result4=parse_dec_octet();if(result4!==null){if(input.charCodeAt(pos)===46){result5=".";pos++}else{result5=null;if(reportFailures===0){matchFailed('"."')}}if(result5!==null){result6=parse_dec_octet();if(result6!==null){result0=[result0,result1,result2,result3,result4,result5,result6]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.host_type="IPv4";return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_dec_octet(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,2)==="25"){result0="25";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"25"')}}if(result0!==null){if(/^[0-5]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[0-5]")}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){pos0=pos;if(input.charCodeAt(pos)===50){result0="2";pos++}else{result0=null;if(reportFailures===0){matchFailed('"2"')}}if(result0!==null){if(/^[0-4]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[0-4]")}}if(result1!==null){result2=parse_DIGIT();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){pos0=pos;if(input.charCodeAt(pos)===49){result0="1";pos++}else{result0=null;if(reportFailures===0){matchFailed('"1"')}}if(result0!==null){result1=parse_DIGIT();if(result1!==null){result2=parse_DIGIT();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){pos0=pos;if(/^[1-9]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[1-9]")}}if(result0!==null){result1=parse_DIGIT();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){result0=parse_DIGIT()}}}}return result0}function parse_port(){var result0,result1,result2,result3,result4;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_DIGIT();result0=result0!==null?result0:"";if(result0!==null){result1=parse_DIGIT();result1=result1!==null?result1:"";if(result1!==null){result2=parse_DIGIT();result2=result2!==null?result2:"";if(result2!==null){result3=parse_DIGIT();result3=result3!==null?result3:"";if(result3!==null){result4=parse_DIGIT();result4=result4!==null?result4:"";if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,port){port=parseInt(port.join(""));data.port=port;return port}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_uri_parameters(){var result0,result1,result2;var pos0;result0=[];pos0=pos;if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1!==null){result2=parse_uri_parameter();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos0}}else{result1=null;pos=pos0}while(result1!==null){result0.push(result1);pos0=pos;if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1!==null){result2=parse_uri_parameter();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos0}}else{result1=null;pos=pos0}}return result0}function parse_uri_parameter(){var result0;result0=parse_transport_param();if(result0===null){result0=parse_user_param();if(result0===null){result0=parse_method_param();if(result0===null){result0=parse_ttl_param();if(result0===null){result0=parse_maddr_param();if(result0===null){result0=parse_lr_param();if(result0===null){result0=parse_other_param()}}}}}}return result0}function parse_transport_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,10).toLowerCase()==="transport="){result0=input.substr(pos,10);pos+=10}else{result0=null;if(reportFailures===0){matchFailed('"transport="')}}if(result0!==null){if(input.substr(pos,3).toLowerCase()==="udp"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"udp"')}}if(result1===null){if(input.substr(pos,3).toLowerCase()==="tcp"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"tcp"')}}if(result1===null){if(input.substr(pos,4).toLowerCase()==="sctp"){result1=input.substr(pos,4);pos+=4}else{result1=null;if(reportFailures===0){matchFailed('"sctp"')}}if(result1===null){if(input.substr(pos,3).toLowerCase()==="tls"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"tls"')}}if(result1===null){result1=parse_token()}}}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,transport){if(!data.uri_params)data.uri_params={};data.uri_params["transport"]=transport.toLowerCase()}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_user_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,5).toLowerCase()==="user="){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"user="')}}if(result0!==null){if(input.substr(pos,5).toLowerCase()==="phone"){result1=input.substr(pos,5);pos+=5}else{result1=null;if(reportFailures===0){matchFailed('"phone"')}}if(result1===null){if(input.substr(pos,2).toLowerCase()==="ip"){result1=input.substr(pos,2);pos+=2}else{result1=null;if(reportFailures===0){matchFailed('"ip"')}}if(result1===null){result1=parse_token()}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,user){if(!data.uri_params)data.uri_params={};data.uri_params["user"]=user.toLowerCase()}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_method_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,7).toLowerCase()==="method="){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"method="')}}if(result0!==null){result1=parse_Method();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,method){if(!data.uri_params)data.uri_params={};data.uri_params["method"]=method}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_ttl_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,4).toLowerCase()==="ttl="){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"ttl="')}}if(result0!==null){result1=parse_ttl();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,ttl){if(!data.params)data.params={};data.params["ttl"]=ttl}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_maddr_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,6).toLowerCase()==="maddr="){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"maddr="')}}if(result0!==null){result1=parse_host();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,maddr){if(!data.uri_params)data.uri_params={};data.uri_params["maddr"]=maddr}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_lr_param(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;if(input.substr(pos,2).toLowerCase()==="lr"){result0=input.substr(pos,2);pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"lr"')}}if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1!==null){result2=parse_token();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){if(!data.uri_params)data.uri_params={};data.uri_params["lr"]=undefined}(pos0)}if(result0===null){pos=pos0}return result0}function parse_other_param(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_pname();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1!==null){result2=parse_pvalue();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,param,value){if(!data.uri_params)data.uri_params={};if(typeof value==="undefined"){value=undefined}else{value=value[1]}data.uri_params[param.toLowerCase()]=value&&value.toLowerCase()}(pos0,result0[0],result0[1])}if(result0===null){pos=pos0}return result0}function parse_pname(){var result0,result1;var pos0;pos0=pos;result1=parse_paramchar();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_paramchar()}}else{result0=null}if(result0!==null){result0=function(offset,pname){return pname.join("")}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_pvalue(){var result0,result1;var pos0;pos0=pos;result1=parse_paramchar();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_paramchar()}}else{result0=null}if(result0!==null){result0=function(offset,pvalue){return pvalue.join("")}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_paramchar(){var result0;result0=parse_param_unreserved();if(result0===null){result0=parse_unreserved();if(result0===null){result0=parse_escaped()}}return result0}function parse_param_unreserved(){var result0;if(input.charCodeAt(pos)===91){result0="[";pos++}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0===null){if(input.charCodeAt(pos)===93){result0="]";pos++}else{result0=null;if(reportFailures===0){matchFailed('"]"')}}if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";
pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}}}}}}}return result0}function parse_headers(){var result0,result1,result2,result3,result4;var pos0,pos1;pos0=pos;if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0!==null){result1=parse_header();if(result1!==null){result2=[];pos1=pos;if(input.charCodeAt(pos)===38){result3="&";pos++}else{result3=null;if(reportFailures===0){matchFailed('"&"')}}if(result3!==null){result4=parse_header();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos1}}else{result3=null;pos=pos1}while(result3!==null){result2.push(result3);pos1=pos;if(input.charCodeAt(pos)===38){result3="&";pos++}else{result3=null;if(reportFailures===0){matchFailed('"&"')}}if(result3!==null){result4=parse_header();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos1}}else{result3=null;pos=pos1}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_header(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_hname();if(result0!==null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1!==null){result2=parse_hvalue();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,hname,hvalue){hname=hname.join("").toLowerCase();hvalue=hvalue.join("");if(!data.uri_headers)data.uri_headers={};if(!data.uri_headers[hname]){data.uri_headers[hname]=[hvalue]}else{data.uri_headers[hname].push(hvalue)}}(pos0,result0[0],result0[2])}if(result0===null){pos=pos0}return result0}function parse_hname(){var result0,result1;result1=parse_hnv_unreserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped()}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_hnv_unreserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped()}}}}else{result0=null}return result0}function parse_hvalue(){var result0,result1;result0=[];result1=parse_hnv_unreserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped()}}while(result1!==null){result0.push(result1);result1=parse_hnv_unreserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped()}}}return result0}function parse_hnv_unreserved(){var result0;if(input.charCodeAt(pos)===91){result0="[";pos++}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0===null){if(input.charCodeAt(pos)===93){result0="]";pos++}else{result0=null;if(reportFailures===0){matchFailed('"]"')}}if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}}}}}}}return result0}function parse_Request_Response(){var result0;result0=parse_Status_Line();if(result0===null){result0=parse_Request_Line()}return result0}function parse_Request_Line(){var result0,result1,result2,result3,result4;var pos0;pos0=pos;result0=parse_Method();if(result0!==null){result1=parse_SP();if(result1!==null){result2=parse_Request_URI();if(result2!==null){result3=parse_SP();if(result3!==null){result4=parse_SIP_Version();if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Request_URI(){var result0;result0=parse_SIP_URI();if(result0===null){result0=parse_absoluteURI()}return result0}function parse_absoluteURI(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_hier_part();if(result2===null){result2=parse_opaque_part()}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_hier_part(){var result0,result1,result2;var pos0,pos1;pos0=pos;result0=parse_net_path();if(result0===null){result0=parse_abs_path()}if(result0!==null){pos1=pos;if(input.charCodeAt(pos)===63){result1="?";pos++}else{result1=null;if(reportFailures===0){matchFailed('"?"')}}if(result1!==null){result2=parse_query();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos1}}else{result1=null;pos=pos1}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_net_path(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,2)==="//"){result0="//";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"//"')}}if(result0!==null){result1=parse_authority();if(result1!==null){result2=parse_abs_path();result2=result2!==null?result2:"";if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_abs_path(){var result0,result1;var pos0;pos0=pos;if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0!==null){result1=parse_path_segments();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_opaque_part(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_uric_no_slash();if(result0!==null){result1=[];result2=parse_uric();while(result2!==null){result1.push(result2);result2=parse_uric()}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_uric(){var result0;result0=parse_reserved();if(result0===null){result0=parse_unreserved();if(result0===null){result0=parse_escaped()}}return result0}function parse_uric_no_slash(){var result0;result0=parse_unreserved();if(result0===null){result0=parse_escaped();if(result0===null){if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===64){result0="@";pos++}else{result0=null;if(reportFailures===0){matchFailed('"@"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}}}}}}}}}}}return result0}function parse_path_segments(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_segment();if(result0!==null){result1=[];pos1=pos;if(input.charCodeAt(pos)===47){result2="/";pos++}else{result2=null;if(reportFailures===0){matchFailed('"/"')}}if(result2!==null){result3=parse_segment();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;if(input.charCodeAt(pos)===47){result2="/";pos++}else{result2=null;if(reportFailures===0){matchFailed('"/"')}}if(result2!==null){result3=parse_segment();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_segment(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=[];result1=parse_pchar();while(result1!==null){result0.push(result1);result1=parse_pchar()}if(result0!==null){result1=[];pos1=pos;if(input.charCodeAt(pos)===59){result2=";";pos++}else{result2=null;if(reportFailures===0){matchFailed('";"')}}if(result2!==null){result3=parse_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;if(input.charCodeAt(pos)===59){result2=";";pos++}else{result2=null;if(reportFailures===0){matchFailed('";"')}}if(result2!==null){result3=parse_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_param(){var result0,result1;result0=[];result1=parse_pchar();while(result1!==null){result0.push(result1);result1=parse_pchar()}return result0}function parse_pchar(){var result0;result0=parse_unreserved();if(result0===null){result0=parse_escaped();if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===64){result0="@";pos++}else{result0=null;if(reportFailures===0){matchFailed('"@"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}}}}}}}}}return result0}function parse_scheme(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_ALPHA();if(result0!==null){result1=[];result2=parse_ALPHA();if(result2===null){result2=parse_DIGIT();if(result2===null){if(input.charCodeAt(pos)===43){result2="+";pos++}else{result2=null;if(reportFailures===0){matchFailed('"+"')}}if(result2===null){if(input.charCodeAt(pos)===45){result2="-";pos++}else{result2=null;if(reportFailures===0){matchFailed('"-"')}}if(result2===null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}}}}}while(result2!==null){result1.push(result2);result2=parse_ALPHA();if(result2===null){result2=parse_DIGIT();if(result2===null){if(input.charCodeAt(pos)===43){result2="+";pos++}else{result2=null;if(reportFailures===0){matchFailed('"+"')}}if(result2===null){if(input.charCodeAt(pos)===45){result2="-";pos++}else{result2=null;if(reportFailures===0){matchFailed('"-"')}}if(result2===null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}}}}}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.scheme=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_authority(){var result0;result0=parse_srvr();if(result0===null){result0=parse_reg_name()}return result0}function parse_srvr(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_userinfo();if(result0!==null){if(input.charCodeAt(pos)===64){result1="@";pos++}else{result1=null;if(reportFailures===0){matchFailed('"@"')}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}result0=result0!==null?result0:"";if(result0!==null){result1=parse_hostport();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}result0=result0!==null?result0:"";return result0}function parse_reg_name(){var result0,result1;result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){if(input.charCodeAt(pos)===36){result1="$";pos++}else{result1=null;if(reportFailures===0){matchFailed('"$"')}}if(result1===null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}if(result1===null){if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1===null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1===null){if(input.charCodeAt(pos)===64){result1="@";pos++}else{result1=null;if(reportFailures===0){matchFailed('"@"')}}if(result1===null){if(input.charCodeAt(pos)===38){result1="&";pos++}else{result1=null;if(reportFailures===0){matchFailed('"&"')}}if(result1===null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}}}}}}}}}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){if(input.charCodeAt(pos)===36){result1="$";pos++}else{result1=null;if(reportFailures===0){matchFailed('"$"')}}if(result1===null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}if(result1===null){if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1===null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1===null){if(input.charCodeAt(pos)===64){result1="@";pos++}else{result1=null;if(reportFailures===0){matchFailed('"@"')}}if(result1===null){if(input.charCodeAt(pos)===38){result1="&";pos++}else{result1=null;if(reportFailures===0){matchFailed('"&"')}}if(result1===null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}}}}}}}}}}}}else{result0=null}return result0}function parse_query(){var result0,result1;result0=[];result1=parse_uric();while(result1!==null){result0.push(result1);result1=parse_uric()}return result0}function parse_SIP_Version(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,3).toLowerCase()==="sip"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"SIP"')}}if(result0!==null){if(input.charCodeAt(pos)===47){result1="/";pos++}else{result1=null;if(reportFailures===0){matchFailed('"/"')}}if(result1!==null){result3=parse_DIGIT();if(result3!==null){result2=[];while(result3!==null){result2.push(result3);result3=parse_DIGIT()}}else{result2=null}if(result2!==null){if(input.charCodeAt(pos)===46){result3=".";pos++}else{result3=null;if(reportFailures===0){matchFailed('"."')}}if(result3!==null){result5=parse_DIGIT();if(result5!==null){result4=[];while(result5!==null){result4.push(result5);result5=parse_DIGIT()}}else{result4=null}if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.sip_version=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_INVITEm(){var result0;if(input.substr(pos,6)==="INVITE"){result0="INVITE";pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"INVITE"')}}return result0}function parse_ACKm(){var result0;if(input.substr(pos,3)==="ACK"){result0="ACK";pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"ACK"')}}return result0}function parse_OPTIONSm(){var result0;if(input.substr(pos,7)==="OPTIONS"){result0="OPTIONS";pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"OPTIONS"')}}return result0}function parse_BYEm(){var result0;if(input.substr(pos,3)==="BYE"){result0="BYE";pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"BYE"')}}return result0}function parse_CANCELm(){var result0;if(input.substr(pos,6)==="CANCEL"){result0="CANCEL";pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"CANCEL"')}}return result0}function parse_REGISTERm(){var result0;if(input.substr(pos,8)==="REGISTER"){result0="REGISTER";pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"REGISTER"')}}return result0}function parse_SUBSCRIBEm(){var result0;if(input.substr(pos,9)==="SUBSCRIBE"){result0="SUBSCRIBE";pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"SUBSCRIBE"')}}return result0}function parse_NOTIFYm(){var result0;if(input.substr(pos,6)==="NOTIFY"){result0="NOTIFY";pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"NOTIFY"')}}return result0}function parse_Method(){var result0;var pos0;pos0=pos;result0=parse_INVITEm();if(result0===null){result0=parse_ACKm();if(result0===null){result0=parse_OPTIONSm();if(result0===null){result0=parse_BYEm();if(result0===null){result0=parse_CANCELm();if(result0===null){result0=parse_REGISTERm();if(result0===null){result0=parse_SUBSCRIBEm();if(result0===null){result0=parse_NOTIFYm();if(result0===null){result0=parse_token()}}}}}}}}if(result0!==null){result0=function(offset){data.method=input.substring(pos,offset);return data.method}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Status_Line(){var result0,result1,result2,result3,result4;var pos0;pos0=pos;result0=parse_SIP_Version();if(result0!==null){result1=parse_SP();if(result1!==null){result2=parse_Status_Code();if(result2!==null){result3=parse_SP();if(result3!==null){result4=parse_Reason_Phrase();if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Status_Code(){var result0;var pos0;pos0=pos;result0=parse_extension_code();if(result0!==null){result0=function(offset,status_code){data.status_code=parseInt(status_code.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_extension_code(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_DIGIT();if(result0!==null){result1=parse_DIGIT();if(result1!==null){result2=parse_DIGIT();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Reason_Phrase(){var result0,result1;var pos0;pos0=pos;result0=[];result1=parse_reserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_UTF8_NONASCII();if(result1===null){result1=parse_UTF8_CONT();if(result1===null){result1=parse_SP();if(result1===null){result1=parse_HTAB()}}}}}}while(result1!==null){result0.push(result1);result1=parse_reserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_UTF8_NONASCII();if(result1===null){result1=parse_UTF8_CONT();if(result1===null){result1=parse_SP();if(result1===null){result1=parse_HTAB()}}}}}}}if(result0!==null){result0=function(offset){data.reason_phrase=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Allow_Events(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_event_type();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_event_type();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_event_type();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Call_ID(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_word();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===64){result1="@";pos++}else{result1=null;if(reportFailures===0){matchFailed('"@"')}}if(result1!==null){result2=parse_word();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Contact(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;result0=parse_STAR();if(result0===null){pos1=pos;result0=parse_contact_param();if(result0!==null){result1=[];pos2=pos;result2=parse_COMMA();if(result2!==null){result3=parse_contact_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_COMMA();if(result2!==null){result3=parse_contact_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}if(result0!==null){result0=function(offset){var idx,length;length=data.multi_header.length;for(idx=0;idx<length;idx++){if(data.multi_header[idx].parsed===null){data=null;break}}if(data!==null){data=data.multi_header}else{data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_contact_param(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_SIP_URI_noparams();if(result0===null){result0=parse_name_addr()}if(result0!==null){result1=[];pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_contact_params();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_contact_params();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var header;if(!data.multi_header)data.multi_header=[];try{header=new NameAddrHeader(data.uri,data.display_name,data.params);delete data.uri;delete data.display_name;delete data.params}catch(e){header=null}data.multi_header.push({possition:pos,offset:offset,parsed:header})}(pos0)}if(result0===null){pos=pos0}return result0}function parse_name_addr(){var result0,result1,result2,result3;var pos0;pos0=pos;result0=parse_display_name();result0=result0!==null?result0:"";if(result0!==null){result1=parse_LAQUOT();if(result1!==null){result2=parse_SIP_URI();if(result2!==null){result3=parse_RAQUOT();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_display_name(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_token();if(result0!==null){result1=[];pos2=pos;result2=parse_LWS();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_LWS();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){result0=parse_quoted_string()}if(result0!==null){result0=function(offset,display_name){display_name=input.substring(pos,offset).trim();if(display_name[0]==='"'){display_name=display_name.substring(1,display_name.length-1)}data.display_name=display_name}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_contact_params(){var result0;result0=parse_c_p_q();if(result0===null){result0=parse_c_p_expires();if(result0===null){result0=parse_generic_param()}}return result0}function parse_c_p_q(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,1).toLowerCase()==="q"){result0=input.substr(pos,1);pos++}else{result0=null;if(reportFailures===0){matchFailed('"q"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_qvalue();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,q){if(!data.params)data.params={};data.params["q"]=q}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_c_p_expires(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,7).toLowerCase()==="expires"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"expires"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_delta_seconds();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,expires){if(!data.params)data.params={};data.params["expires"]=expires}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_delta_seconds(){var result0,result1;var pos0;pos0=pos;result1=parse_DIGIT();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_DIGIT()}}else{result0=null}if(result0!==null){result0=function(offset,delta_seconds){return parseInt(delta_seconds.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_qvalue(){var result0,result1,result2,result3,result4;var pos0,pos1,pos2;pos0=pos;pos1=pos;if(input.charCodeAt(pos)===48){result0="0";pos++}else{result0=null;if(reportFailures===0){matchFailed('"0"')}}if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1!==null){result2=parse_DIGIT();result2=result2!==null?result2:"";if(result2!==null){result3=parse_DIGIT();result3=result3!==null?result3:"";if(result3!==null){result4=parse_DIGIT();result4=result4!==null?result4:"";if(result4!==null){result1=[result1,result2,result3,result4]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return parseFloat(input.substring(pos,offset))}(pos0)}if(result0===null){pos=pos0}return result0}function parse_generic_param(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_token();if(result0!==null){pos2=pos;result1=parse_EQUAL();if(result1!==null){result2=parse_gen_value();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,param,value){if(!data.params)data.params={};if(typeof value==="undefined"){value=undefined}else{value=value[1]}data.params[param.toLowerCase()]=value}(pos0,result0[0],result0[1])}if(result0===null){pos=pos0}return result0}function parse_gen_value(){var result0;result0=parse_token();if(result0===null){result0=parse_host();if(result0===null){result0=parse_quoted_string()}}return result0}function parse_Content_Disposition(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_disp_type();if(result0!==null){result1=[];pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_disp_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_disp_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_disp_type(){var result0;if(input.substr(pos,6).toLowerCase()==="render"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"render"')}}if(result0===null){if(input.substr(pos,7).toLowerCase()==="session"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"session"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="icon"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"icon"')}}if(result0===null){if(input.substr(pos,5).toLowerCase()==="alert"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"alert"')}}if(result0===null){result0=parse_token()}}}}return result0}function parse_disp_param(){var result0;result0=parse_handling_param();if(result0===null){result0=parse_generic_param()}return result0}function parse_handling_param(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,8).toLowerCase()==="handling"){result0=input.substr(pos,8);pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"handling"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){if(input.substr(pos,8).toLowerCase()==="optional"){result2=input.substr(pos,8);pos+=8}else{result2=null;if(reportFailures===0){matchFailed('"optional"')}}if(result2===null){if(input.substr(pos,8).toLowerCase()==="required"){result2=input.substr(pos,8);pos+=8}else{result2=null;if(reportFailures===0){matchFailed('"required"')}}if(result2===null){result2=parse_token()}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Content_Encoding(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Content_Length(){var result0,result1;
var pos0;pos0=pos;result1=parse_DIGIT();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_DIGIT()}}else{result0=null}if(result0!==null){result0=function(offset,length){data=parseInt(length.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Content_Type(){var result0;var pos0;pos0=pos;result0=parse_media_type();if(result0!==null){result0=function(offset){data=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_media_type(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;result0=parse_m_type();if(result0!==null){result1=parse_SLASH();if(result1!==null){result2=parse_m_subtype();if(result2!==null){result3=[];pos1=pos;result4=parse_SEMI();if(result4!==null){result5=parse_m_parameter();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}while(result4!==null){result3.push(result4);pos1=pos;result4=parse_SEMI();if(result4!==null){result5=parse_m_parameter();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}}if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_m_type(){var result0;result0=parse_discrete_type();if(result0===null){result0=parse_composite_type()}return result0}function parse_discrete_type(){var result0;if(input.substr(pos,4).toLowerCase()==="text"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"text"')}}if(result0===null){if(input.substr(pos,5).toLowerCase()==="image"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"image"')}}if(result0===null){if(input.substr(pos,5).toLowerCase()==="audio"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"audio"')}}if(result0===null){if(input.substr(pos,5).toLowerCase()==="video"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"video"')}}if(result0===null){if(input.substr(pos,11).toLowerCase()==="application"){result0=input.substr(pos,11);pos+=11}else{result0=null;if(reportFailures===0){matchFailed('"application"')}}if(result0===null){result0=parse_extension_token()}}}}}return result0}function parse_composite_type(){var result0;if(input.substr(pos,7).toLowerCase()==="message"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"message"')}}if(result0===null){if(input.substr(pos,9).toLowerCase()==="multipart"){result0=input.substr(pos,9);pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"multipart"')}}if(result0===null){result0=parse_extension_token()}}return result0}function parse_extension_token(){var result0;result0=parse_token();if(result0===null){result0=parse_x_token()}return result0}function parse_x_token(){var result0,result1;var pos0;pos0=pos;if(input.substr(pos,2).toLowerCase()==="x-"){result0=input.substr(pos,2);pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"x-"')}}if(result0!==null){result1=parse_token();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_m_subtype(){var result0;result0=parse_extension_token();if(result0===null){result0=parse_token()}return result0}function parse_m_parameter(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_token();if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_m_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_m_value(){var result0;result0=parse_token();if(result0===null){result0=parse_quoted_string()}return result0}function parse_CSeq(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_CSeq_value();if(result0!==null){result1=parse_LWS();if(result1!==null){result2=parse_Method();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_CSeq_value(){var result0,result1;var pos0;pos0=pos;result1=parse_DIGIT();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_DIGIT()}}else{result0=null}if(result0!==null){result0=function(offset,cseq_value){data.value=parseInt(cseq_value.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Expires(){var result0;var pos0;pos0=pos;result0=parse_delta_seconds();if(result0!==null){result0=function(offset,expires){data=expires}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Event(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_event_type();if(result0!==null){result1=[];pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,event_type){data.event=event_type.join("").toLowerCase()}(pos0,result0[0])}if(result0===null){pos=pos0}return result0}function parse_event_type(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token_nodot();if(result0!==null){result1=[];pos1=pos;if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}if(result2!==null){result3=parse_token_nodot();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}if(result2!==null){result3=parse_token_nodot();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_From(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_SIP_URI_noparams();if(result0===null){result0=parse_name_addr()}if(result0!==null){result1=[];pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_from_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_from_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var tag=data.tag;try{data=new NameAddrHeader(data.uri,data.display_name,data.params);if(tag){data.setParam("tag",tag)}}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_from_param(){var result0;result0=parse_tag_param();if(result0===null){result0=parse_generic_param()}return result0}function parse_tag_param(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,3).toLowerCase()==="tag"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"tag"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_token();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,tag){data.tag=tag}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_Max_Forwards(){var result0,result1;var pos0;pos0=pos;result1=parse_DIGIT();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_DIGIT()}}else{result0=null}if(result0!==null){result0=function(offset,forwards){data=parseInt(forwards.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Min_Expires(){var result0;var pos0;pos0=pos;result0=parse_delta_seconds();if(result0!==null){result0=function(offset,min_expires){data=min_expires}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Name_Addr_Header(){var result0,result1,result2,result3,result4,result5,result6;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=[];result1=parse_display_name();while(result1!==null){result0.push(result1);result1=parse_display_name()}if(result0!==null){result1=parse_LAQUOT();if(result1!==null){result2=parse_SIP_URI();if(result2!==null){result3=parse_RAQUOT();if(result3!==null){result4=[];pos2=pos;result5=parse_SEMI();if(result5!==null){result6=parse_generic_param();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}while(result5!==null){result4.push(result5);pos2=pos;result5=parse_SEMI();if(result5!==null){result6=parse_generic_param();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}}if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){try{data=new NameAddrHeader(data.uri,data.display_name,data.params)}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Proxy_Authenticate(){var result0;result0=parse_challenge();return result0}function parse_challenge(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;if(input.substr(pos,6).toLowerCase()==="digest"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"Digest"')}}if(result0!==null){result1=parse_LWS();if(result1!==null){result2=parse_digest_cln();if(result2!==null){result3=[];pos1=pos;result4=parse_COMMA();if(result4!==null){result5=parse_digest_cln();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}while(result4!==null){result3.push(result4);pos1=pos;result4=parse_COMMA();if(result4!==null){result5=parse_digest_cln();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}}if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){result0=parse_other_challenge()}return result0}function parse_other_challenge(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=parse_LWS();if(result1!==null){result2=parse_auth_param();if(result2!==null){result3=[];pos1=pos;result4=parse_COMMA();if(result4!==null){result5=parse_auth_param();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}while(result4!==null){result3.push(result4);pos1=pos;result4=parse_COMMA();if(result4!==null){result5=parse_auth_param();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}}if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_auth_param(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_token();if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_token();if(result2===null){result2=parse_quoted_string()}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_digest_cln(){var result0;result0=parse_realm();if(result0===null){result0=parse_domain();if(result0===null){result0=parse_nonce();if(result0===null){result0=parse_opaque();if(result0===null){result0=parse_stale();if(result0===null){result0=parse_algorithm();if(result0===null){result0=parse_qop_options();if(result0===null){result0=parse_auth_param()}}}}}}}return result0}function parse_realm(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,5).toLowerCase()==="realm"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"realm"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_realm_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_realm_value(){var result0;var pos0;pos0=pos;result0=parse_quoted_string_clean();if(result0!==null){result0=function(offset,realm){data.realm=realm}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_domain(){var result0,result1,result2,result3,result4,result5,result6;var pos0,pos1;pos0=pos;if(input.substr(pos,6).toLowerCase()==="domain"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"domain"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_LDQUOT();if(result2!==null){result3=parse_URI();if(result3!==null){result4=[];pos1=pos;result6=parse_SP();if(result6!==null){result5=[];while(result6!==null){result5.push(result6);result6=parse_SP()}}else{result5=null}if(result5!==null){result6=parse_URI();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos1}}else{result5=null;pos=pos1}while(result5!==null){result4.push(result5);pos1=pos;result6=parse_SP();if(result6!==null){result5=[];while(result6!==null){result5.push(result6);result6=parse_SP()}}else{result5=null}if(result5!==null){result6=parse_URI();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos1}}else{result5=null;pos=pos1}}if(result4!==null){result5=parse_RDQUOT();if(result5!==null){result0=[result0,result1,result2,result3,result4,result5]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_URI(){var result0;result0=parse_absoluteURI();if(result0===null){result0=parse_abs_path()}return result0}function parse_nonce(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,5).toLowerCase()==="nonce"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"nonce"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_nonce_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_nonce_value(){var result0;var pos0;pos0=pos;result0=parse_quoted_string_clean();if(result0!==null){result0=function(offset,nonce){data.nonce=nonce}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_opaque(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,6).toLowerCase()==="opaque"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"opaque"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_quoted_string_clean();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,opaque){data.opaque=opaque}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_stale(){var result0,result1,result2;var pos0,pos1;pos0=pos;if(input.substr(pos,5).toLowerCase()==="stale"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"stale"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){pos1=pos;if(input.substr(pos,4).toLowerCase()==="true"){result2=input.substr(pos,4);pos+=4}else{result2=null;if(reportFailures===0){matchFailed('"true"')}}if(result2!==null){result2=function(offset){data.stale=true}(pos1)}if(result2===null){pos=pos1}if(result2===null){pos1=pos;if(input.substr(pos,5).toLowerCase()==="false"){result2=input.substr(pos,5);pos+=5}else{result2=null;if(reportFailures===0){matchFailed('"false"')}}if(result2!==null){result2=function(offset){data.stale=false}(pos1)}if(result2===null){pos=pos1}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_algorithm(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,9).toLowerCase()==="algorithm"){result0=input.substr(pos,9);pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"algorithm"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){if(input.substr(pos,3).toLowerCase()==="md5"){result2=input.substr(pos,3);pos+=3}else{result2=null;if(reportFailures===0){matchFailed('"MD5"')}}if(result2===null){if(input.substr(pos,8).toLowerCase()==="md5-sess"){result2=input.substr(pos,8);pos+=8}else{result2=null;if(reportFailures===0){matchFailed('"MD5-sess"')}}if(result2===null){result2=parse_token()}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,algorithm){data.algorithm=algorithm.toUpperCase()}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_qop_options(){var result0,result1,result2,result3,result4,result5,result6;var pos0,pos1,pos2;pos0=pos;if(input.substr(pos,3).toLowerCase()==="qop"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"qop"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_LDQUOT();if(result2!==null){pos1=pos;result3=parse_qop_value();if(result3!==null){result4=[];pos2=pos;if(input.charCodeAt(pos)===44){result5=",";pos++}else{result5=null;if(reportFailures===0){matchFailed('","')}}if(result5!==null){result6=parse_qop_value();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}while(result5!==null){result4.push(result5);pos2=pos;if(input.charCodeAt(pos)===44){result5=",";pos++}else{result5=null;if(reportFailures===0){matchFailed('","')}}if(result5!==null){result6=parse_qop_value();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}}if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos1}}else{result3=null;pos=pos1}if(result3!==null){result4=parse_RDQUOT();if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_qop_value(){var result0;var pos0;pos0=pos;if(input.substr(pos,8).toLowerCase()==="auth-int"){result0=input.substr(pos,8);pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"auth-int"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="auth"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"auth"')}}if(result0===null){result0=parse_token()}}if(result0!==null){result0=function(offset,qop_value){data.qop||(data.qop=[]);data.qop.push(qop_value.toLowerCase())}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Proxy_Require(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Record_Route(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_rec_route();if(result0!==null){result1=[];pos2=pos;result2=parse_COMMA();if(result2!==null){result3=parse_rec_route();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_COMMA();if(result2!==null){result3=parse_rec_route();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var idx,length;length=data.multi_header.length;for(idx=0;idx<length;idx++){if(data.multi_header[idx].parsed===null){data=null;break}}if(data!==null){data=data.multi_header}else{data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_rec_route(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_name_addr();if(result0!==null){result1=[];pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var header;if(!data.multi_header)data.multi_header=[];try{header=new NameAddrHeader(data.uri,data.display_name,data.params);delete data.uri;delete data.display_name;delete data.params}catch(e){header=null}data.multi_header.push({possition:pos,offset:offset,parsed:header})}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Require(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Route(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_route_param();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_route_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_route_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_route_param(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_name_addr();if(result0!==null){result1=[];pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Subscription_State(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_substate_value();if(result0!==null){result1=[];pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_subexp_params();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_subexp_params();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_substate_value(){var result0;var pos0;pos0=pos;if(input.substr(pos,6).toLowerCase()==="active"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"active"')}}if(result0===null){if(input.substr(pos,7).toLowerCase()==="pending"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"pending"')}}if(result0===null){if(input.substr(pos,10).toLowerCase()==="terminated"){result0=input.substr(pos,10);pos+=10}else{result0=null;if(reportFailures===0){matchFailed('"terminated"')}}if(result0===null){result0=parse_token()}}}if(result0!==null){result0=function(offset){data.state=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_subexp_params(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,6).toLowerCase()==="reason"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"reason"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_event_reason_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,reason){if(typeof reason!=="undefined")data.reason=reason}(pos0,result0[2])}if(result0===null){pos=pos0}if(result0===null){pos0=pos;pos1=pos;if(input.substr(pos,7).toLowerCase()==="expires"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"expires"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_delta_seconds();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,expires){if(typeof expires!=="undefined")data.expires=expires}(pos0,result0[2])}if(result0===null){pos=pos0}if(result0===null){pos0=pos;pos1=pos;if(input.substr(pos,11).toLowerCase()==="retry_after"){result0=input.substr(pos,11);pos+=11}else{result0=null;if(reportFailures===0){matchFailed('"retry_after"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_delta_seconds();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,retry_after){if(typeof retry_after!=="undefined")data.retry_after=retry_after}(pos0,result0[2])}if(result0===null){pos=pos0}if(result0===null){result0=parse_generic_param()}}}return result0}function parse_event_reason_value(){var result0;if(input.substr(pos,11).toLowerCase()==="deactivated"){result0=input.substr(pos,11);pos+=11}else{result0=null;if(reportFailures===0){matchFailed('"deactivated"')}}if(result0===null){if(input.substr(pos,9).toLowerCase()==="probation"){result0=input.substr(pos,9);pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"probation"')}}if(result0===null){if(input.substr(pos,8).toLowerCase()==="rejected"){result0=input.substr(pos,8);pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"rejected"')}}if(result0===null){if(input.substr(pos,7).toLowerCase()==="timeout"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"timeout"')}}if(result0===null){if(input.substr(pos,6).toLowerCase()==="giveup"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"giveup"')}}if(result0===null){if(input.substr(pos,10).toLowerCase()==="noresource"){result0=input.substr(pos,10);pos+=10}else{result0=null;if(reportFailures===0){matchFailed('"noresource"')}}if(result0===null){if(input.substr(pos,9).toLowerCase()==="invariant"){result0=input.substr(pos,9);pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"invariant"')}}if(result0===null){result0=parse_token()}}}}}}}return result0}function parse_Subject(){var result0;result0=parse_TEXT_UTF8_TRIM();result0=result0!==null?result0:"";return result0}function parse_Supported(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}result0=result0!==null?result0:"";return result0}function parse_To(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_SIP_URI_noparams();if(result0===null){result0=parse_name_addr()}if(result0!==null){result1=[];pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_to_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_to_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var tag=data.tag;try{data=new NameAddrHeader(data.uri,data.display_name,data.params);if(tag){data.setParam("tag",tag)}}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_to_param(){var result0;result0=parse_tag_param();if(result0===null){result0=parse_generic_param()}return result0}function parse_Via(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_via_parm();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_via_parm();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_via_parm();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_via_parm(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;result0=parse_sent_protocol();if(result0!==null){result1=parse_LWS();if(result1!==null){result2=parse_sent_by();if(result2!==null){result3=[];pos1=pos;result4=parse_SEMI();if(result4!==null){result5=parse_via_params();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}while(result4!==null){result3.push(result4);pos1=pos;result4=parse_SEMI();if(result4!==null){result5=parse_via_params();if(result5!==null){result4=[result4,result5]
}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}}if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_via_params(){var result0;result0=parse_via_ttl();if(result0===null){result0=parse_via_maddr();if(result0===null){result0=parse_via_received();if(result0===null){result0=parse_via_branch();if(result0===null){result0=parse_response_port();if(result0===null){result0=parse_generic_param()}}}}}return result0}function parse_via_ttl(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,3).toLowerCase()==="ttl"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"ttl"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_ttl();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_ttl_value){data.ttl=via_ttl_value}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_via_maddr(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,5).toLowerCase()==="maddr"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"maddr"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_host();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_maddr){data.maddr=via_maddr}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_via_received(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,8).toLowerCase()==="received"){result0=input.substr(pos,8);pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"received"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_IPv4address();if(result2===null){result2=parse_IPv6address()}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_received){data.received=via_received}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_via_branch(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,6).toLowerCase()==="branch"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"branch"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_token();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_branch){data.branch=via_branch}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_response_port(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;if(input.substr(pos,5).toLowerCase()==="rport"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"rport"')}}if(result0!==null){pos2=pos;result1=parse_EQUAL();if(result1!==null){result2=[];result3=parse_DIGIT();while(result3!==null){result2.push(result3);result3=parse_DIGIT()}if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){if(typeof response_port!=="undefined")data.rport=response_port.join("")}(pos0)}if(result0===null){pos=pos0}return result0}function parse_sent_protocol(){var result0,result1,result2,result3,result4;var pos0;pos0=pos;result0=parse_protocol_name();if(result0!==null){result1=parse_SLASH();if(result1!==null){result2=parse_token();if(result2!==null){result3=parse_SLASH();if(result3!==null){result4=parse_transport();if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_protocol_name(){var result0;var pos0;pos0=pos;if(input.substr(pos,3).toLowerCase()==="sip"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"SIP"')}}if(result0===null){result0=parse_token()}if(result0!==null){result0=function(offset,via_protocol){data.protocol=via_protocol}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_transport(){var result0;var pos0;pos0=pos;if(input.substr(pos,3).toLowerCase()==="udp"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"UDP"')}}if(result0===null){if(input.substr(pos,3).toLowerCase()==="tcp"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"TCP"')}}if(result0===null){if(input.substr(pos,3).toLowerCase()==="tls"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"TLS"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="sctp"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"SCTP"')}}if(result0===null){result0=parse_token()}}}}if(result0!==null){result0=function(offset,via_transport){data.transport=via_transport}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_sent_by(){var result0,result1,result2;var pos0,pos1;pos0=pos;result0=parse_via_host();if(result0!==null){pos1=pos;result1=parse_COLON();if(result1!==null){result2=parse_via_port();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos1}}else{result1=null;pos=pos1}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_via_host(){var result0;var pos0;pos0=pos;result0=parse_IPv4address();if(result0===null){result0=parse_IPv6reference();if(result0===null){result0=parse_hostname()}}if(result0!==null){result0=function(offset){data.host=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_via_port(){var result0,result1,result2,result3,result4;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_DIGIT();result0=result0!==null?result0:"";if(result0!==null){result1=parse_DIGIT();result1=result1!==null?result1:"";if(result1!==null){result2=parse_DIGIT();result2=result2!==null?result2:"";if(result2!==null){result3=parse_DIGIT();result3=result3!==null?result3:"";if(result3!==null){result4=parse_DIGIT();result4=result4!==null?result4:"";if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_sent_by_port){data.port=parseInt(via_sent_by_port.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_ttl(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_DIGIT();if(result0!==null){result1=parse_DIGIT();result1=result1!==null?result1:"";if(result1!==null){result2=parse_DIGIT();result2=result2!==null?result2:"";if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,ttl){return parseInt(ttl.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_WWW_Authenticate(){var result0;result0=parse_challenge();return result0}function parse_extension_header(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_token();if(result0!==null){result1=parse_HCOLON();if(result1!==null){result2=parse_header_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_header_value(){var result0,result1;result0=[];result1=parse_TEXT_UTF8char();if(result1===null){result1=parse_UTF8_CONT();if(result1===null){result1=parse_LWS()}}while(result1!==null){result0.push(result1);result1=parse_TEXT_UTF8char();if(result1===null){result1=parse_UTF8_CONT();if(result1===null){result1=parse_LWS()}}}return result0}function parse_message_body(){var result0,result1;result0=[];result1=parse_OCTET();while(result1!==null){result0.push(result1);result1=parse_OCTET()}return result0}function parse_stun_URI(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_stun_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_stun_host_port();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_stun_scheme(){var result0;var pos0;pos0=pos;if(input.substr(pos,5).toLowerCase()==="stuns"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"stuns"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="stun"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"stun"')}}}if(result0!==null){result0=function(offset,scheme){data.scheme=scheme}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_stun_host_port(){var result0,result1,result2;var pos0,pos1;pos0=pos;result0=parse_stun_host();if(result0!==null){pos1=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_port();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos1}}else{result1=null;pos=pos1}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_stun_host(){var result0;var pos0;pos0=pos;result0=parse_IPv4address();if(result0===null){result0=parse_IPv6reference();if(result0===null){result0=parse_reg_name()}}if(result0!==null){result0=function(offset,host){data.host=host}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_reg_name(){var result0,result1;var pos0;pos0=pos;result0=[];result1=parse_stun_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_sub_delims()}}while(result1!==null){result0.push(result1);result1=parse_stun_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_sub_delims()}}}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_stun_unreserved(){var result0;result0=parse_ALPHA();if(result0===null){result0=parse_DIGIT();if(result0===null){if(input.charCodeAt(pos)===45){result0="-";pos++}else{result0=null;if(reportFailures===0){matchFailed('"-"')}}if(result0===null){if(input.charCodeAt(pos)===46){result0=".";pos++}else{result0=null;if(reportFailures===0){matchFailed('"."')}}if(result0===null){if(input.charCodeAt(pos)===95){result0="_";pos++}else{result0=null;if(reportFailures===0){matchFailed('"_"')}}if(result0===null){if(input.charCodeAt(pos)===126){result0="~";pos++}else{result0=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}return result0}function parse_sub_delims(){var result0;if(input.charCodeAt(pos)===33){result0="!";pos++}else{result0=null;if(reportFailures===0){matchFailed('"!"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===39){result0="'";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\'"')}}if(result0===null){if(input.charCodeAt(pos)===40){result0="(";pos++}else{result0=null;if(reportFailures===0){matchFailed('"("')}}if(result0===null){if(input.charCodeAt(pos)===41){result0=")";pos++}else{result0=null;if(reportFailures===0){matchFailed('")"')}}if(result0===null){if(input.charCodeAt(pos)===42){result0="*";pos++}else{result0=null;if(reportFailures===0){matchFailed('"*"')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}if(result0===null){if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}}}}}}}}}}}return result0}function parse_turn_URI(){var result0,result1,result2,result3,result4;var pos0,pos1;pos0=pos;result0=parse_turn_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_stun_host_port();if(result2!==null){pos1=pos;if(input.substr(pos,11)==="?transport="){result3="?transport=";pos+=11}else{result3=null;if(reportFailures===0){matchFailed('"?transport="')}}if(result3!==null){result4=parse_transport();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos1}}else{result3=null;pos=pos1}result3=result3!==null?result3:"";if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_turn_scheme(){var result0;var pos0;pos0=pos;if(input.substr(pos,5).toLowerCase()==="turns"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"turns"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="turn"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"turn"')}}}if(result0!==null){result0=function(offset,scheme){data.scheme=scheme}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_turn_transport(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_transport();if(result0!==null){if(input.substr(pos,3).toLowerCase()==="udp"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"udp"')}}if(result1===null){if(input.substr(pos,3).toLowerCase()==="tcp"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"tcp"')}}if(result1===null){result1=[];result2=parse_unreserved();while(result2!==null){result1.push(result2);result2=parse_unreserved()}}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.transport=transport}(pos0)}if(result0===null){pos=pos0}return result0}function parse_uuid_URI(){var result0,result1;var pos0;pos0=pos;if(input.substr(pos,5)==="uuid:"){result0="uuid:";pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"uuid:"')}}if(result0!==null){result1=parse_uuid();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_uuid(){var result0,result1,result2,result3,result4,result5,result6,result7,result8;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_hex8();if(result0!==null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1!==null){result2=parse_hex4();if(result2!==null){if(input.charCodeAt(pos)===45){result3="-";pos++}else{result3=null;if(reportFailures===0){matchFailed('"-"')}}if(result3!==null){result4=parse_hex4();if(result4!==null){if(input.charCodeAt(pos)===45){result5="-";pos++}else{result5=null;if(reportFailures===0){matchFailed('"-"')}}if(result5!==null){result6=parse_hex4();if(result6!==null){if(input.charCodeAt(pos)===45){result7="-";pos++}else{result7=null;if(reportFailures===0){matchFailed('"-"')}}if(result7!==null){result8=parse_hex12();if(result8!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,uuid){data=input.substring(pos+5,offset)}(pos0,result0[0])}if(result0===null){pos=pos0}return result0}function parse_hex4(){var result0,result1,result2,result3;var pos0;pos0=pos;result0=parse_HEXDIG();if(result0!==null){result1=parse_HEXDIG();if(result1!==null){result2=parse_HEXDIG();if(result2!==null){result3=parse_HEXDIG();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_hex8(){var result0,result1;var pos0;pos0=pos;result0=parse_hex4();if(result0!==null){result1=parse_hex4();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_hex12(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_hex4();if(result0!==null){result1=parse_hex4();if(result1!==null){result2=parse_hex4();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function cleanupExpected(expected){expected.sort();var lastExpected=null;var cleanExpected=[];for(var i=0;i<expected.length;i++){if(expected[i]!==lastExpected){cleanExpected.push(expected[i]);lastExpected=expected[i]}}return cleanExpected}function computeErrorPosition(){var line=1;var column=1;var seenCR=false;for(var i=0;i<Math.max(pos,rightmostFailuresPos);i++){var ch=input.charAt(i);if(ch==="\n"){if(!seenCR){line++}column=1;seenCR=false}else if(ch==="\r"||ch==="\u2028"||ch==="\u2029"){line++;column=1;seenCR=true}else{column++;seenCR=false}}return{line:line,column:column}}var URI=require("./URI");var NameAddrHeader=require("./NameAddrHeader");var data={};var result=parseFunctions[startRule]();if(result===null||pos!==input.length){var offset=Math.max(pos,rightmostFailuresPos);var found=offset<input.length?input.charAt(offset):null;var errorPosition=computeErrorPosition();new this.SyntaxError(cleanupExpected(rightmostFailuresExpected),found,offset,errorPosition.line,errorPosition.column);return-1}return data},toSource:function(){return this._source}};result.SyntaxError=function(expected,found,offset,line,column){function buildMessage(expected,found){var expectedHumanized,foundHumanized;switch(expected.length){case 0:expectedHumanized="end of input";break;case 1:expectedHumanized=expected[0];break;default:expectedHumanized=expected.slice(0,expected.length-1).join(", ")+" or "+expected[expected.length-1]}foundHumanized=found?quote(found):"end of input";return"Expected "+expectedHumanized+" but "+foundHumanized+" found."}this.name="SyntaxError";this.expected=expected;this.found=found;this.message=buildMessage(expected,found);this.offset=offset;this.line=line;this.column=column};result.SyntaxError.prototype=Error.prototype;return result}()},{"./NameAddrHeader":33,"./URI":46}],30:[function(require,module,exports){module.exports=Logger;function DateFmt(fstr){this.formatString=fstr;var mthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var zeroPad=function(number){return("0"+number).substr(-2,2)};var dateMarkers={d:["getDate",function(v){return zeroPad(v)}],m:["getMonth",function(v){return zeroPad(v+1)}],n:["getMonth",function(v){return mthNames[v]}],w:["getDay",function(v){return dayNames[v]}],y:["getFullYear"],H:["getHours",function(v){return zeroPad(v)}],M:["getMinutes",function(v){return zeroPad(v)}],S:["getSeconds",function(v){return zeroPad(v)}],i:["toISOString"]};this.format=function(date){var dateTxt=this.formatString.replace(/%(.)/g,function(m,p){var dateMarker=dateMarkers[p];var method=dateMarker[0];var rv=date[method]();if(dateMarker[1]!==null){rv=dateMarker[1](rv)}return rv});return dateTxt}}function Logger(logger,category,label){this.logger=logger;this.category=category;this.label=label;this.fmt=new DateFmt("%m%d/%H%M%S")}Logger.prototype.debug=function(content){this.logger.debug(this.category,this.label,content)};Logger.prototype.log=function(content){this.logger.log(this.category,this.label,content)};Logger.prototype.warn=function(content){this.logger.warn(this.category,this.label,content)};Logger.prototype.error=function(content){this.logger.error(this.category,this.label,content)};Logger.prototype.formatMsg=function(msg){return this.getTime()+" : "+msg};Logger.prototype.getTime=function(){return this.getTimeFor(new Date)};Logger.prototype.getTimeFor=function(date){return this.fmt.format(date)}},{}],31:[function(require,module,exports){module.exports=LoggerFactory;var Logger=require("./Logger");function LoggerFactory(){var logger,levels={error:0,warn:1,log:2,debug:3},level=1,builtinEnabled=true,connector=null;this.loggers={};logger=this.getLogger("ExSIP.loggerfactory");Object.defineProperties(this,{builtinEnabled:{get:function(){return builtinEnabled},set:function(value){if(typeof value==="boolean"){builtinEnabled=value}else{logger.error('invalid "builtinEnabled" parameter value: '+JSON.stringify(value))}}},level:{get:function(){return level},set:function(value){if(value>=0&&value<=3){level=value}else if(value>3){level=3}else if(levels.hasOwnProperty(value)){level=levels[value]}else{logger.error('invalid "level" parameter value: '+JSON.stringify(value))}}},connector:{get:function(){return connector},set:function(value){if(value===null||value===""||value===undefined){connector=null}else if(typeof value==="function"){connector=value}else{logger.error('invalid "connector" parameter value: '+JSON.stringify(value))}}}})}LoggerFactory.prototype.print=function(target,category,label,content){var prefix=[];prefix.push(new Date);prefix.push(category);if(label){prefix.push(label)}prefix.push("");if(typeof content==="string"){target.call(console,prefix.join(" | ")+content)}else{target.call(console,content)}};LoggerFactory.prototype.debug=function(category,label,content){if(this.level===3){if(this.builtinEnabled){this.print(console.info,category,label,content)}if(this.connector){this.connector("debug",category,label,content)}}};LoggerFactory.prototype.log=function(category,label,content){if(this.level>=2){if(this.builtinEnabled){this.print(console.log,category,label,content)}if(this.connector){this.connector("log",category,label,content)}}};LoggerFactory.prototype.warn=function(category,label,content){if(this.level>=1){if(this.builtinEnabled){this.print(console.warn,category,label,content)}if(this.connector){this.connector("warn",category,label,content)}}};LoggerFactory.prototype.error=function(category,label,content){if(this.builtinEnabled){this.print(console.error,category,label,content)}if(this.connector){this.connector("error",category,label,content)}};LoggerFactory.prototype.getLogger=function(category,label){var logger;if(label&&this.level===1){return new Logger(this,category,label)}else if(this.loggers[category]){return this.loggers[category]}else{logger=new Logger(this,category);this.loggers[category]=logger;return logger}}},{"./Logger":30}],32:[function(require,module,exports){module.exports=Message;function Message(ua){this.ua=ua;this.logger=ua.getLogger("ExSIP.message");this.data={}}var ExSIP_C=require("./Constants");var EventEmitter=require("./EventEmitter");var SIPMessage=require("./SIPMessage");var Utils=require("./Utils");var RequestSender=require("./RequestSender");var Transactions=require("./Transactions");var Exceptions=require("./Exceptions");Message.prototype=new EventEmitter;Message.prototype.isDebug=function(){return this.ua.isDebug()};Message.prototype.send=function(target,body,options){var request_sender,event,contentType,eventHandlers,extraHeaders,events=["succeeded","failed"],originalTarget=target;if(target===undefined||body===undefined){throw new TypeError("Not enough arguments")}target=this.ua.normalizeTarget(target);if(!target){throw new TypeError("Invalid target: "+originalTarget)}this.initEvents(events);options=options||{};extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[];eventHandlers=options.eventHandlers||{};contentType=options.contentType||"text/plain";this.content_type=contentType;for(event in eventHandlers){this.on(event,eventHandlers[event])}this.closed=false;this.ua.applicants[this]=this;extraHeaders.push("Content-Type: "+contentType);this.request=new SIPMessage.OutgoingRequest(ExSIP_C.MESSAGE,target,this.ua,null,extraHeaders);if(body){this.request.body=body;this.content=body}else{this.content=null}request_sender=new RequestSender(this,this.ua);this.newMessage("local",this.request);request_sender.send()};Message.prototype.receiveResponse=function(response){var cause;if(this.closed){return}switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):delete this.ua.applicants[this];this.emit("succeeded",this,{originator:"remote",response:response});break;default:delete this.ua.applicants[this];cause=Utils.sipErrorCause(response.status_code);this.emit("failed",this,{originator:"remote",response:response,cause:cause});break}};Message.prototype.onRequestTimeout=function(){if(this.closed){return}this.emit("failed",this,{originator:"system",cause:ExSIP_C.causes.REQUEST_TIMEOUT})};Message.prototype.onTransportError=function(){if(this.closed){return}this.emit("failed",this,{originator:"system",cause:ExSIP_C.causes.CONNECTION_ERROR})};Message.prototype.close=function(){this.closed=true;delete this.ua.applicants[this]};Message.prototype.init_incoming=function(request){var transaction;this.request=request;this.content_type=request.getHeader("Content-Type");if(request.body){this.content=request.body}else{this.content=null}this.newMessage("remote",request);transaction=this.ua.transactions.nist[request.via_branch];if(transaction&&(transaction.state===Transactions.C.STATUS_TRYING||transaction.state===Transactions.C.STATUS_PROCEEDING)){request.reply(200)}};Message.prototype.accept=function(options){options=options||{};var extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],body=options.body;if(this.direction!=="incoming"){throw new Exceptions.NotSupportedError('"accept" not supported for outgoing Message')}this.request.reply(200,null,extraHeaders,body)};Message.prototype.reject=function(options){options=options||{};var status_code=options.status_code||480,reason_phrase=options.reason_phrase,extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],body=options.body;if(this.direction!=="incoming"){throw new Exceptions.NotSupportedError('"reject" not supported for outgoing Message')}if(status_code<300||status_code>=700){throw new TypeError("Invalid status_code: "+status_code)}this.request.reply(status_code,reason_phrase,extraHeaders,body)};Message.prototype.newMessage=function(originator,request){var message=this,event_name="newMessage";if(originator==="remote"){message.direction="incoming";message.local_identity=request.to;message.remote_identity=request.from}else if(originator==="local"){message.direction="outgoing";message.local_identity=request.from;message.remote_identity=request.to}message.ua.emit(event_name,message.ua,{originator:originator,message:message,request:request})}},{"./Constants":22,"./EventEmitter":26,"./Exceptions":28,"./RequestSender":40,"./SIPMessage":41,"./Transactions":43,"./Utils":47}],33:[function(require,module,exports){module.exports=NameAddrHeader;var URI=require("./URI");var Grammar=require("./Grammar");function NameAddrHeader(uri,display_name,parameters){var param;if(!uri||!(uri instanceof URI)){throw new TypeError('missing or invalid "uri" parameter')}this.uri=uri;this.parameters={};for(param in parameters){this.setParam(param,parameters[param])}Object.defineProperties(this,{display_name:{get:function(){return display_name},set:function(value){display_name=value===0?"0":value}}})}NameAddrHeader.prototype={setParam:function(key,value){if(key){this.parameters[key.toLowerCase()]=typeof value==="undefined"||value===null?null:value.toString()}},getParam:function(key){if(key){return this.parameters[key.toLowerCase()]}},hasParam:function(key){if(key){return this.parameters.hasOwnProperty(key.toLowerCase())&&true||false}},deleteParam:function(parameter){var value;parameter=parameter.toLowerCase();if(this.parameters.hasOwnProperty(parameter)){value=this.parameters[parameter];delete this.parameters[parameter];return value}},clearParams:function(){this.parameters={}},clone:function(){return new NameAddrHeader(this.uri.clone(),this.display_name,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var body,parameter;body=this.display_name||this.display_name===0?'"'+this.display_name+'" ':"";body+="<"+this.uri.toString()+">";for(parameter in this.parameters){body+=";"+parameter;if(this.parameters[parameter]!==null){body+="="+this.parameters[parameter]}}return body}};NameAddrHeader.parse=function(name_addr_header){name_addr_header=Grammar.parse(name_addr_header,"Name_Addr_Header");if(name_addr_header!==-1){return name_addr_header}else{return undefined}}},{"./Grammar":29,"./URI":46}],34:[function(require,module,exports){var Parser={};module.exports=Parser;var sdp_transform=require("sdp-transform");var Grammar=require("./Grammar");var SIPMessage=require("./SIPMessage");function getHeader(data,headerStart){var start=headerStart,end=0,partialEnd=0;if(data.substring(start,start+2).match(/(^\r\n)/)){return-2}while(end===0){partialEnd=data.indexOf("\r\n",start);if(partialEnd===-1){return partialEnd}if(!data.substring(partialEnd+2,partialEnd+4).match(/(^\r\n)/)&&data.charAt(partialEnd+2).match(/(^\s+)/)){start=partialEnd+2}else{end=partialEnd}}return end}function parseHeader(message,data,headerStart,headerEnd){var header,idx,length,parsed,hcolonIndex=data.indexOf(":",headerStart),headerName=data.substring(headerStart,hcolonIndex).trim(),headerValue=data.substring(hcolonIndex+1,headerEnd).trim();switch(headerName.toLowerCase()){case"via":case"v":message.addHeader("via",headerValue);if(message.getHeaders("via").length===1){parsed=message.parseHeader("Via");if(parsed){message.via=parsed;message.via_branch=parsed.branch}}else{parsed=0}break;case"from":case"f":message.setHeader("from",headerValue);parsed=message.parseHeader("from");if(parsed){message.from=parsed;message.from_tag=parsed.getParam("tag")}break;case"to":case"t":message.setHeader("to",headerValue);parsed=message.parseHeader("to");if(parsed){message.to=parsed;message.to_tag=parsed.getParam("tag")}break;case"record-route":parsed=Grammar.parse(headerValue,"Record_Route");if(parsed===-1){parsed=undefined}length=parsed.length;for(idx=0;idx<length;idx++){header=parsed[idx];message.addHeader("record-route",headerValue.substring(header.possition,header.offset));message.headers["Record-Route"][message.getHeaders("record-route").length-1].parsed=header.parsed}break;case"call-id":case"i":message.setHeader("call-id",headerValue);parsed=message.parseHeader("call-id");if(parsed){message.call_id=headerValue}break;case"contact":case"m":parsed=Grammar.parse(headerValue,"Contact");if(parsed===-1){parsed=undefined}length=parsed.length;for(idx=0;idx<length;idx++){header=parsed[idx];message.addHeader("contact",headerValue.substring(header.possition,header.offset));message.headers.Contact[message.getHeaders("contact").length-1].parsed=header.parsed}break;case"content-length":case"l":message.setHeader("content-length",headerValue);
parsed=message.parseHeader("content-length");break;case"content-type":case"c":message.setHeader("content-type",headerValue);parsed=message.parseHeader("content-type");break;case"cseq":message.setHeader("cseq",headerValue);parsed=message.parseHeader("cseq");if(parsed){message.cseq=parsed.value}if(message instanceof SIPMessage.IncomingResponse){message.method=parsed.method}break;case"max-forwards":message.setHeader("max-forwards",headerValue);parsed=message.parseHeader("max-forwards");break;case"www-authenticate":message.setHeader("www-authenticate",headerValue);parsed=message.parseHeader("www-authenticate");break;case"proxy-authenticate":message.setHeader("proxy-authenticate",headerValue);parsed=message.parseHeader("proxy-authenticate");break;default:message.setHeader(headerName,headerValue);parsed=0}if(parsed===undefined){return{error:'error parsing header "'+headerName+'"'}}else{return true}}Parser.parseMessage=function(data,ua){var message,firstLine,contentLength,bodyStart,parsed,headerStart=0,headerEnd=data.indexOf("\r\n"),logger=ua.getLogger("ExSIP.parser");if(headerEnd===-1){logger.warn("no CRLF found, not a SIP message, discarded");return}firstLine=data.substring(0,headerEnd);parsed=Grammar.parse(firstLine,"Request_Response");if(parsed===-1){logger.warn('error parsing first line of SIP message: "'+firstLine+'"');return}else if(!parsed.status_code){message=new SIPMessage.IncomingRequest(ua);message.method=parsed.method;message.ruri=parsed.uri}else{message=new SIPMessage.IncomingResponse(ua);message.status_code=parsed.status_code;message.reason_phrase=parsed.reason_phrase}message.data=data;headerStart=headerEnd+2;while(true){headerEnd=getHeader(data,headerStart);if(headerEnd===-2){bodyStart=headerStart+2;break}else if(headerEnd===-1){parsed.error("malformed message");return}parsed=parseHeader(message,data,headerStart,headerEnd);if(parsed!==true){logger.error(parsed.error);return}headerStart=headerEnd+2}if(message.hasHeader("content-length")){contentLength=message.getHeader("content-length");message.body=data.substr(bodyStart,contentLength)}else{message.body=data.substring(bodyStart)}return message};Parser.parseSDP=sdp_transform.parse;Parser.writeSDP=sdp_transform.write;Parser.parseFmtpConfig=sdp_transform.parseFmtpConfig;Parser.parsePayloads=sdp_transform.parsePayloads;Parser.parseRemoteCandidates=sdp_transform.parseRemoteCandidates},{"./Grammar":29,"./SIPMessage":41,"sdp-transform":17}],35:[function(require,module,exports){module.exports=RTCSession;var C={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9,STATUS_REFER_SENT:10,STATUS_BYE_SENT:11};RTCSession.C=C;var ExSIP_C=require("./Constants");var EventEmitter=require("./EventEmitter");var Exceptions=require("./Exceptions");var Parser=require("./Parser");var Utils=require("./Utils");var Timers=require("./Timers");var UA=require("./UA");var WebRTC=require("./WebRTC");var SIPMessage=require("./SIPMessage");var Dialog=require("./Dialog");var RequestSender=require("./RequestSender");var RTCSession_RTCMediaHandler=require("./RTCSession/RTCMediaHandler");var RTCSession_DTMF=require("./RTCSession/DTMF");function RTCSession(ua){var events=["connecting","progress","failed","accepted","confirmed","ended","newDTMF","hold","held","resumed","unhold","muted","unmuted","started","onReInvite"];this.ua=ua;this.setStatus(C.STATUS_NULL);this.dialog=null;this.earlyDialogs={};this.rtcMediaHandler=null;this.receiveResponse=this.receiveInviteResponse;this.is_confirmed=false;this.late_sdp=false;this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null};this.data={};this.dtmf=new RTCSession_DTMF(this);this.isOnHold=false;this.audioMuted=false;this.videoMuted=false;this.local_hold=false;this.remote_hold=false;this.start_time=null;this.pending_actions={actions:[],length:function(){return this.actions.length},isPending:function(name){var idx=0,length=this.actions.length;for(idx;idx<length;idx++){if(this.actions[idx].name===name){return true}}return false},shift:function(){return this.actions.shift()},push:function(name){this.actions.push({name:name})},pop:function(name){var idx=0,length=this.actions.length;for(idx;idx<length;idx++){if(this.actions[idx].name===name){this.actions.splice(idx,1)}}}};this.data={};this.initEvents(events)}RTCSession.prototype=new EventEmitter;RTCSession.prototype.terminate=function(options){options=options||{};var cancel_reason,status_code=options.status_code,reason_phrase=options.reason_phrase,extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],body=options.body;if(this.status===C.STATUS_TERMINATED){throw new Exceptions.InvalidStateError(this.status)}this.logger.log("terminate with status : "+this.status);switch(this.status){case C.STATUS_NULL:case C.STATUS_INVITE_SENT:case C.STATUS_1XX_RECEIVED:this.logger.debug("canceling RTCSession");if(status_code&&(status_code<200||status_code>=700)){throw new TypeError("Invalid status_code: "+status_code)}else if(status_code){reason_phrase=reason_phrase||ExSIP_C.REASON_PHRASE[status_code]||"";cancel_reason="SIP ;cause="+status_code+' ;text="'+reason_phrase+'"'}if(this.status===C.STATUS_NULL){this.isCanceled=true;this.cancelReason=cancel_reason}else if(this.status===C.STATUS_INVITE_SENT){if(this.received_100){this.logger.debug("canceling after received 100 response");if(typeof this.request.cancel==="undefined"){this.sendBye(options);this.ended("local",null,ExSIP_C.causes.BYE)}else{this.isCanceled=true;this.logger.log("terminate on 100 - setting isCanceled = true",this.ua);this.request.cancel(cancel_reason)}}else{this.isCanceled=true;this.cancelReason=cancel_reason}}else if(this.status===C.STATUS_1XX_RECEIVED){this.isCanceled=true;this.logger.log("terminate on 1xx - setting isCanceled = true");this.request.cancel(cancel_reason)}this.setStatus(C.STATUS_CANCELED);this.failed("local",null,ExSIP_C.causes.CANCELED);break;case C.STATUS_WAITING_FOR_ANSWER:this.logger.log("rejecting RTCSession with 486 Busy Here",this.ua);this.request.reply(486);this.failed("local",null,ExSIP_C.causes.REJECTED);break;case C.STATUS_ANSWERED:this.logger.debug("rejecting RTCSession");status_code=status_code||480;if(status_code<300||status_code>=700){throw new TypeError("Invalid status_code: "+status_code)}this.request.reply(status_code,reason_phrase,extraHeaders,body);this.failed("local",null,ExSIP_C.causes.REJECTED);break;case C.STATUS_WAITING_FOR_ACK:case C.STATUS_REFER_SENT:case C.STATUS_CONFIRMED:this.logger.debug("terminating RTCSession");this.sendBye(options);return}this.close()};RTCSession.prototype.answer=function(options){options=options||{};var idx,length,sdp,remoteDescription,hasAudio=false,hasVideo=false,self=this,request=this.request,extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],mediaConstraints=options.mediaConstraints||{},mediaStream=options.mediaStream||null,sdpCreationSucceeded=function(body){var replySucceeded=function(){self.setStatus(C.STATUS_WAITING_FOR_ACK);self.setInvite2xxTimer(request,body);self.setACKTimer();self.accepted("local")},replyFailed=function(){self.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)};request.reply(200,null,extraHeaders,body,replySucceeded,replyFailed)},sdpCreationFailed=function(){if(self.status===C.STATUS_TERMINATED){return}self.failed("system",null,ExSIP_C.causes.WEBRTC_ERROR)};this.data=options.data||{};if(this.direction!=="incoming"){throw new Exceptions.NotSupportedError('"answer" not supported for outgoing RTCSession')}else if(this.status!==C.STATUS_WAITING_FOR_ANSWER){throw new Exceptions.InvalidStateError(this.status)}this.setStatus(C.STATUS_ANSWERED);if(!this.createDialog(request,"UAS")){request.reply(500,"Missing Contact header field");return}clearTimeout(this.timers.userNoAnswerTimer);extraHeaders.unshift("Contact: "+self.contact);remoteDescription=this.rtcMediaHandler.peerConnection.remoteDescription||{};sdp=Parser.parseSDP(remoteDescription.sdp||"");if(!(sdp.media instanceof Array)){sdp.media=[sdp.media||[]]}idx=sdp.media.length;while(idx--){if(sdp.media[idx].type==="audio"&&(sdp.media[idx].direction==="sendrecv"||sdp.media[idx].direction==="recvonly")){hasAudio=true}if(sdp.media[idx].type==="video"&&(sdp.media[idx].direction==="sendrecv"||sdp.media[idx].direction==="recvonly")){hasVideo=true}}if(mediaStream&&mediaConstraints.audio===false){length=mediaStream.getAudioTracks().length;for(idx=0;idx<length;idx++){mediaStream.removeTrack(mediaStream.getAudioTracks()[idx])}}if(mediaStream&&mediaConstraints.video===false){length=mediaStream.getVideoTracks().length;for(idx=0;idx<length;idx++){mediaStream.removeTrack(mediaStream.getVideoTracks()[idx])}}if(mediaConstraints.audio===undefined){mediaConstraints.audio=hasAudio}if(mediaConstraints.video===undefined){mediaConstraints.video=hasVideo}this.getUserMedia(mediaConstraints,sdpCreationSucceeded,sdpCreationFailed,{isAnswer:true,remoteSdp:request.body})};RTCSession.prototype.sendDTMF=function(tones,options){var duration,interToneGap;options=options||{};duration=options.duration||null;interToneGap=options.interToneGap||null;if(tones===undefined){throw new TypeError("Not enough arguments")}if(this.status!==C.STATUS_CONFIRMED&&this.status!==C.STATUS_WAITING_FOR_ACK){throw new Exceptions.InvalidStateError(this.status)}if(typeof tones==="number"){tones=tones.toString()}if(!tones||typeof tones!=="string"||!tones.match(/^[0-9A-D#*,]+$/i)){throw new TypeError("Invalid tones: "+tones)}if(duration&&!Utils.isDecimal(duration)){throw new TypeError("Invalid tone duration: "+duration)}else if(!duration){duration=RTCSession_DTMF.C.DEFAULT_DURATION}else if(duration<RTCSession_DTMF.C.MIN_DURATION){this.logger.warn('"duration" value is lower than the minimum allowed, setting it to '+RTCSession_DTMF.C.MIN_DURATION+" milliseconds");duration=RTCSession_DTMF.C.MIN_DURATION}else if(duration>RTCSession_DTMF.C.MAX_DURATION){this.logger.warn('"duration" value is greater than the maximum allowed, setting it to '+RTCSession_DTMF.C.MAX_DURATION+" milliseconds");duration=RTCSession_DTMF.C.MAX_DURATION}else{duration=Math.abs(duration)}options.duration=duration;if(interToneGap&&!Utils.isDecimal(interToneGap)){throw new TypeError("Invalid interToneGap: "+interToneGap)}else if(!interToneGap){interToneGap=RTCSession_DTMF.C.DEFAULT_INTER_TONE_GAP}else if(interToneGap<RTCSession_DTMF.C.MIN_INTER_TONE_GAP){this.logger.warn('"interToneGap" value is lower than the minimum allowed, setting it to '+RTCSession_DTMF.C.MIN_INTER_TONE_GAP+" milliseconds");interToneGap=RTCSession_DTMF.C.MIN_INTER_TONE_GAP}else{interToneGap=Math.abs(interToneGap)}this.dtmf.send(tones,options)};RTCSession.prototype.rejectReInvite=function(options){options=options||{};this.logger.log("rejecting re-INVITE");this.request.reply(488)};RTCSession.prototype.acceptReInvite=function(options){options=options||{};var self=this,extraHeaders=options.extraHeaders||[];this.logger.log("accepting re-INVITE");var replySucceeded=function(){var timeout=Timers.T1;self.setStatus(C.STATUS_WAITING_FOR_ACK);self.timers.invite2xxTimer=setTimeout(function invite2xxRetransmission(){if(self.status!==C.STATUS_WAITING_FOR_ACK){return}self.request.reply(200,null,extraHeaders,self.rtcMediaHandler.peerConnection.localDescription.sdp);if(timeout<Timers.T2){timeout=timeout*2;if(timeout>Timers.T2){timeout=Timers.T2}}self.timers.invite2xxTimer=setTimeout(invite2xxRetransmission,timeout)},timeout);self.timers.ackTimer=setTimeout(function(){if(self.status===C.STATUS_WAITING_FOR_ACK){self.logger.log("no ACK received")}},Timers.TIMER_H);self.started("local",undefined,true)};var replyFailed=function(){self.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)};var connectSuccess=function(){self.logger.debug("onMessage success");self.request.reply(200,null,extraHeaders,self.rtcMediaHandler.peerConnection.localDescription.getSdp({additionalSdp:self.rtcMediaHandler.peerConnection.remoteUnsupportedMedia}),replySucceeded,replyFailed)};var connectFailed=function(e){self.logger.warn("invalid SDP");self.logger.warn(e);self.request.reply(488)};this.initialRemoteSdp=this.initialRemoteSdp||self.rtcMediaHandler.peerConnection.remoteDescription.sdp;var sdp=this.request.body;if(sdp.length===0){this.logger.debug("empty sdp")}this.reconnectRtcMediaHandler(connectSuccess,connectFailed,{isAnswer:true,remoteSdp:sdp,isReconnect:true})};RTCSession.prototype.reconnectRtcMediaHandler=function(connectSuccess,connectFailed,options){var self=this;options=options||{};var localMedia=options.localMedia||this.rtcMediaHandler.localMedia;options.createOfferConstraints=options.createOfferConstraints||this.rtcMediaHandler.createOfferConstraints;this.rtcMediaHandler.close(!!options.localMedia);this.initRtcMediaHandler(options);this.rtcMediaHandler.localMedia=localMedia;this.rtcMediaHandler.createOfferConstraints=options.createOfferConstraints;this.connectRtcMediaHandler(localMedia,function(){self.started("local",undefined,true);connectSuccess()},connectFailed,options)};RTCSession.prototype.isReadyToReinvite=function(){if(!this.rtcMediaHandler.isReady()){return}if(this.dialog.uac_pending_reply===true||this.dialog.uas_pending_reply===true){return false}else{return true}};RTCSession.prototype.mute=function(options){options=options||{audio:true,video:false};var audioMuted=false,videoMuted=false;if(this.audioMuted===false&&options.audio){audioMuted=true;this.audioMuted=true;this.toogleMuteAudio(true)}if(this.videoMuted===false&&options.video){videoMuted=true;this.videoMuted=true;this.toogleMuteVideo(true)}if(audioMuted===true||videoMuted===true){this.onmute({audio:audioMuted,video:videoMuted})}};RTCSession.prototype.unmute=function(options){options=options||{audio:true,video:true};var audioUnMuted=false,videoUnMuted=false;if(this.audioMuted===true&&options.audio){audioUnMuted=true;this.audioMuted=false;if(this.local_hold===false){this.toogleMuteAudio(false)}}if(this.videoMuted===true&&options.video){videoUnMuted=true;this.videoMuted=false;if(this.local_hold===false){this.toogleMuteVideo(false)}}if(audioUnMuted===true||videoUnMuted===true){this.onunmute({audio:audioUnMuted,video:videoUnMuted})}};RTCSession.prototype.isMuted=function(){return{audio:this.audioMuted,video:this.videoMuted}};RTCSession.prototype.setInvite2xxTimer=function(request,body){var self=this,timeout=Timers.T1;this.timers.invite2xxTimer=setTimeout(function invite2xxRetransmission(){if(self.status!==C.STATUS_WAITING_FOR_ACK){return}request.reply(200,null,["Contact: "+self.contact],body);if(timeout<Timers.T2){timeout=timeout*2;if(timeout>Timers.T2){timeout=Timers.T2}}self.timers.invite2xxTimer=setTimeout(invite2xxRetransmission,timeout)},timeout)};RTCSession.prototype.setACKTimer=function(){var self=this;this.timers.ackTimer=setTimeout(function(){if(self.status===C.STATUS_WAITING_FOR_ACK){self.logger.debug("no ACK received, terminating the call");clearTimeout(self.timers.invite2xxTimer);self.sendBye();self.ended("remote",null,ExSIP_C.causes.NO_ACK)}},Timers.TIMER_H)};RTCSession.prototype.getLocalStreams=function(){try{if(this.rtcMediaHandler.peerConnection.localStreams){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.localStreams||[]}else{return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getLocalStreams()||[]}}catch(ex){return[]}};RTCSession.prototype.getRemoteStreams=function(){try{if(this.rtcMediaHandler.peerConnection.remoteStreams){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.remoteStreams||[]}else{return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getRemoteStreams()||[]}}catch(ex){return[]}};RTCSession.prototype.initRtcMediaHandler=function(options){options=options||{};var constraints=options.RTCConstraints||this.ua.rtcConstraints()||{optional:[{DtlsSrtpKeyAgreement:"true"}]};this.rtcMediaHandler=new RTCSession_RTCMediaHandler(this,{constraints:constraints,stun_servers:options.stun_servers,turn_servers:options.turn_servers})};RTCSession.prototype.init_incoming=function(request){var expires,self=this,contentType=request.getHeader("Content-Type"),waitForAnswer=function(){self.setStatus(C.STATUS_WAITING_FOR_ANSWER);self.timers.userNoAnswerTimer=setTimeout(function(){request.reply(408);self.failed("local",null,ExSIP_C.causes.NO_ANSWER)},self.ua.configuration.no_answer_timeout);if(expires){self.timers.expiresTimer=setTimeout(function(){if(self.status===C.STATUS_WAITING_FOR_ANSWER){request.reply(487);self.failed("system",null,ExSIP_C.causes.EXPIRES)}},expires)}self.newRTCSession("remote",request);request.reply(180,null,["Contact: "+self.contact]);self.progress("local",null)};if(request.body&&contentType!=="application/sdp"){request.reply(415);return}this.setStatus(C.STATUS_INVITE_RECEIVED);this.from_tag=request.from_tag;this.id=request.call_id+this.from_tag;this.request=request;this.contact=this.ua.contact.toString();this.logger=this.ua.getLogger("rtcsession",this.id);this.ua.sessions[this.id]=this;if(request.hasHeader("expires")){expires=request.getHeader("expires")*1e3}request.to_tag=Utils.newTag();if(!this.createDialog(request,"UAS",true)){request.reply(500,"Missing Contact header field");return}this.initRtcMediaHandler();if(request.body){this.rtcMediaHandler.onMessage("offer",request.body,waitForAnswer,function(e){self.logger.warn("invalid SDP");self.logger.warn(e);request.reply(488)})}else{this.late_sdp=true;waitForAnswer()}};RTCSession.prototype.connect=function(target,options){var self=this;options=options||{};this.data=options.data||{};this.initRtcMediaHandler(options);this.connectLocalMedia(target,options,function(){self.sendInviteRequest(target,options)},function(){})};RTCSession.prototype.close=function(){var idx;if(this.status===C.STATUS_TERMINATED){return}this.logger.debug("closing INVITE session "+this.id);if(this.rtcMediaHandler){this.rtcMediaHandler.close()}for(idx in this.timers){clearTimeout(this.timers[idx])}if(this.dialog){this.dialog.terminate();delete this.dialog}for(idx in this.earlyDialogs){this.earlyDialogs[idx].terminate();delete this.earlyDialogs[idx]}this.setStatus(C.STATUS_TERMINATED);delete this.ua.sessions[this.id]};RTCSession.prototype.createDialog=function(message,type,early){var dialog,early_dialog,local_tag=type==="UAS"?message.to_tag:message.from_tag,remote_tag=type==="UAS"?message.from_tag:message.to_tag,id=message.call_id+local_tag+remote_tag;early_dialog=this.earlyDialogs[id];if(early){if(early_dialog){return true}else{early_dialog=new Dialog(this,message,type,Dialog.C.STATUS_EARLY);if(early_dialog.id){this.earlyDialogs[id]=early_dialog;return true}else{this.failed("remote",message,ExSIP_C.causes.INTERNAL_ERROR);return false}}}else{if(early_dialog){early_dialog.update(message,type);this.dialog=early_dialog;delete this.earlyDialogs[id];return true}dialog=new Dialog(this,message,type);if(dialog.id){this.to_tag=message.to_tag;this.dialog=dialog;return true}else{this.failed("remote",message,ExSIP_C.causes.INTERNAL_ERROR);return false}}};RTCSession.prototype.connectRtcMediaHandler=function(stream,creationSucceeded,creationFailed,options){this.rtcMediaHandler.connect(stream,creationSucceeded,creationFailed,options);this.dtmf.enableDtmfSender(stream,this.rtcMediaHandler.peerConnection)};RTCSession.prototype.sendData=function(data){this.rtcMediaHandler.sendData(data)};RTCSession.prototype.getUserMedia=function(constraints,creationSucceeded,creationFailed,options){var self=this;var userMediaSucceeded=function(stream){self.ua.localMedia=stream;self.connectRtcMediaHandler(stream,creationSucceeded,creationFailed,options)};var userMediaFailed=function(){if(self.status===C.STATUS_TERMINATED){return}self.failed("local",null,ExSIP_C.causes.USER_DENIED_MEDIA_ACCESS)};if(this.ua.reuseLocalMedia()&&this.ua.localMedia){this.rtcMediaHandler.localMedia=this.ua.localMedia;userMediaSucceeded(this.ua.localMedia)}else{this.rtcMediaHandler.getUserMedia(userMediaSucceeded,userMediaFailed,constraints)}};RTCSession.prototype.sendInviteRequest=function(target,options,inviteSuccessCallback,inviteFailureCallback){options=options||{};options.status=C.STATUS_INVITE_SENT;options.sdp=this.rtcMediaHandler.peerConnection.localDescription.sdp;options.target=target;this.sendRequest(ExSIP_C.INVITE,options,{success:inviteSuccessCallback,failure:inviteFailureCallback})};RTCSession.prototype.createOutgoingRequestSender=function(target,method,options){options=options||{};var event,requestParams,iceServers,originalTarget=target,eventHandlers=options.eventHandlers||{},extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],stun_servers=options.stun_servers||null,turn_servers=options.turn_servers||null;if(stun_servers){iceServers=UA.configuration_check.optional.stun_servers(stun_servers);if(!iceServers){throw new TypeError("Invalid stun_servers: "+stun_servers)}else{stun_servers=iceServers}}if(turn_servers){iceServers=UA.configuration_check.optional.turn_servers(turn_servers);if(!iceServers){throw new TypeError("Invalid turn_servers: "+turn_servers)}else{turn_servers=iceServers}}if(target===undefined){throw new TypeError("Not enough arguments")}if(!WebRTC.isSupported){throw new Exceptions.NotSupportedError("WebRTC not supported")}target=this.ua.normalizeTarget(target);if(!target){throw new TypeError("Invalid target: "+originalTarget)}if(this.status!==C.STATUS_NULL){throw new Exceptions.InvalidStateError(this.status)}for(event in eventHandlers){this.on(event,eventHandlers[event])}this.from_tag=Utils.newTag();this.anonymous=options.anonymous||false;this.isCanceled=false;requestParams={from_tag:this.from_tag};this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:true});if(this.anonymous){requestParams.from_display_name="Anonymous";requestParams.from_uri="sip:anonymous@anonymous.invalid";extraHeaders.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString());extraHeaders.push("Privacy: id")}extraHeaders.push("Contact: "+this.contact);extraHeaders.push("Allow: "+Utils.getAllowedMethods(this.ua));this.request=new SIPMessage.OutgoingRequest(method,target,this.ua,requestParams,extraHeaders);this.id=this.request.call_id+this.from_tag;this.logger=this.ua.getLogger("rtcsession",this.id);this.ua.sessions[this.id]=this;this.newRTCSession("local",this.request);return new RequestSender(this,this.ua)};RTCSession.prototype.sendReferRequest=function(sessionToTransfer,options){this.sessionToTransfer=sessionToTransfer;options=options||{};options.status=C.STATUS_REFER_SENT;options.target=sessionToTransfer.dialog.remote_target;this.sendRequest(ExSIP_C.REFER,options)};RTCSession.prototype.sendNotifyRequest=function(options,successCallback,failureCallback){options=options||{};var extraHeaders=["Content-Type: message/sipfrag","Subscription-State: "+(options.subscriptionState||"active;expires=60"),"Event: refer"];options=Utils.merge_options({extraHeaders:extraHeaders},options);this.sendRequest(ExSIP_C.NOTIFY,options,{success:successCallback,failure:failureCallback})};RTCSession.prototype.isStarted=function(){return this.start_time!==null};RTCSession.prototype.isHeld=function(){return this.isOnHold};RTCSession.prototype.held=function(){this.isOnHold=true;this.emit("held",this)};RTCSession.prototype.resumed=function(){this.isOnHold=false;this.emit("resumed",this)};RTCSession.prototype.hold=function(inviteSuccessCallback,inviteFailureCallback){var self=this;this.changeSession({audioMode:ExSIP_C.INACTIVE,audioPort:"0",videoMode:ExSIP_C.INACTIVE,videoPort:"0"},function(){self.held();if(inviteSuccessCallback){inviteSuccessCallback()}},inviteFailureCallback)};RTCSession.prototype.unhold=function(inviteSuccessCallback,inviteFailureCallback){var self=this;this.changeSession({audioMode:ExSIP_C.SENDRECV,videoMode:ExSIP_C.SENDRECV},function(){self.resumed();if(inviteSuccessCallback){inviteSuccessCallback()}},inviteFailureCallback)};RTCSession.prototype.changeSession=function(sdpOptions,inviteSuccessCallback,inviteFailureCallback){var self=this;this.logger.debug("changeSession : "+JSON.stringify(sdpOptions));this.reconnectRtcMediaHandler(function(){self.logger.debug("changeSession : reconnectRtcMediaHandler : success");self.receiveResponse=self.receiveReinviteResponse;self.reinviteSucceeded=inviteSuccessCallback;self.reinviteFailed=inviteFailureCallback;self.sendInviteRequest(undefined,undefined)},function(){self.logger.error("Could not change local mode")},sdpOptions)};RTCSession.prototype.receiveInviteResponse=function(response){var cause,dialog,session=this;if(this.dialog&&(response.status_code>=200&&response.status_code<=299)){if(this.dialog.id.call_id===response.call_id&&this.dialog.id.local_tag===response.from_tag&&this.dialog.id.remote_tag===response.to_tag){this.sendRequest(ExSIP_C.ACK);return}else{dialog=new Dialog(this,response,"UAC");if(dialog.error!==undefined){this.logger.error(dialog.error);return}dialog.sendRequest({owner:{status:C.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},ExSIP_C.ACK);dialog.sendRequest({owner:{status:C.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},ExSIP_C.BYE);return}}if(this.isCanceled){this.isCanceled=false;if(response.status_code>=100&&response.status_code<200){this.request.cancel(this.cancelReason)}else if(response.status_code>=200&&response.status_code<299){this.acceptAndTerminate(response)}return}if(this.status!==C.STATUS_INVITE_SENT&&this.status!==C.STATUS_1XX_RECEIVED){return}switch(true){case/^100$/.test(response.status_code):this.received_100=true;break;case/^1[0-9]{2}$/.test(response.status_code):this.received_100=true;if(this.status!==C.STATUS_INVITE_SENT&&this.status!==C.STATUS_1XX_RECEIVED){break}if(!response.to_tag){this.logger.warn("1xx response received without to tag");break}if(response.hasHeader("contact")){if(!this.createDialog(response,"UAC",true)){break}}this.setStatus(C.STATUS_1XX_RECEIVED);this.progress("remote",response);if(!response.body){break}this.rtcMediaHandler.onMessage("pranswer",response.body,function(){},function(e){session.logger.warn(e);session.earlyDialogs[response.call_id+response.from_tag+response.to_tag].terminate()});break;case/^2[0-9]{2}$/.test(response.status_code):this.setStatus(C.STATUS_CONFIRMED);if(!response.body){this.acceptAndTerminate(response,400,ExSIP_C.causes.MISSING_SDP);this.failed("remote",response,ExSIP_C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(response,"UAC")){break}this.rtcMediaHandler.onMessage("answer",response.body,function(){session.accepted("remote",response);session.sendRequest(ExSIP_C.ACK);session.confirmed("local",null)},function(e){session.logger.warn(e);session.acceptAndTerminate(response,488,"Not Acceptable Here");session.failed("remote",response,ExSIP_C.causes.BAD_MEDIA_DESCRIPTION)});break;default:cause=Utils.sipErrorCause(response.status_code);this.failed("remote",response,cause)}};RTCSession.prototype.createDialog=function(message,type,early){var dialog,early_dialog,local_tag=type==="UAS"?message.to_tag:message.from_tag,remote_tag=type==="UAS"?message.from_tag:message.to_tag,id=message.call_id+local_tag+remote_tag;early_dialog=this.earlyDialogs[id];if(early){if(early_dialog){return true}else{early_dialog=new Dialog(this,message,type,Dialog.C.STATUS_EARLY);if(early_dialog.error){this.logger.error(dialog.error);this.failed("remote",message,ExSIP_C.causes.INTERNAL_ERROR);return false}else{this.earlyDialogs[id]=early_dialog;return true}}}else{if(early_dialog){early_dialog.update(message,type);this.dialog=early_dialog;delete this.earlyDialogs[id];return true}dialog=new Dialog(this,message,type);if(dialog.error){this.logger.error(dialog.error);this.failed("remote",message,ExSIP_C.causes.INTERNAL_ERROR);return false}else{this.to_tag=message.to_tag;this.dialog=dialog;return true}}};RTCSession.prototype.receiveReinvite=function(request){var sdp,idx,direction,self=this,contentType=request.getHeader("Content-Type"),hold=false,createSdp=function(onSuccess,onFailure){if(self.late_sdp){self.rtcMediaHandler.createOffer(onSuccess,onFailure)}else{self.rtcMediaHandler.createAnswer(onSuccess,onFailure)}},answer=function(){createSdp(function(body){request.reply(200,null,["Contact: "+self.contact],body,function(){self.setStatus(C.STATUS_WAITING_FOR_ACK);self.setInvite2xxTimer(request,body);self.setACKTimer();if(self.remote_hold===true&&hold===false){self.onunhold("remote")}else if(self.remote_hold===false&&hold===true){self.onhold("remote")}})},function(){request.reply(500)})};if(request.body){if(contentType!=="application/sdp"){this.logger.warn("invalid Content-Type");request.reply(415);return}sdp=Parser.parseSDP(request.body);for(idx=0;idx<sdp.media.length;idx++){direction=sdp.direction||sdp.media[idx].direction||"sendrecv";if(direction==="sendonly"||direction==="inactive"){hold=true}}this.rtcMediaHandler.onMessage("offer",request.body,answer,function(e){self.logger.error(e);request.reply(488)})}else{this.late_sdp=true;answer()}};RTCSession.prototype.receiveUpdate=function(request){var sdp,idx,direction,self=this,contentType=request.getHeader("Content-Type"),hold=true;if(!request.body){request.reply(200);return}if(contentType!=="application/sdp"){this.logger.warn("invalid Content-Type");request.reply(415);return}sdp=Parser.parseSDP(request.body);for(idx=0;idx<sdp.media.length;idx++){direction=sdp.direction||sdp.media[idx].direction||"sendrecv";if(direction!=="sendonly"&&direction!=="inactive"){hold=false}}this.rtcMediaHandler.onMessage("offer",request.body,function(){self.rtcMediaHandler.createAnswer(function(body){request.reply(200,null,["Contact: "+self.contact],body,function(){if(self.remote_hold===true&&hold===false){self.onunhold("remote")}else if(self.remote_hold===false&&hold===true){self.onhold("remote")}})},function(){request.reply(500)})},function(e){self.logger.error(e);request.reply(488)})};RTCSession.prototype.receiveRequest=function(request){var contentType,self=this;if(request.method===ExSIP_C.CANCEL){if(this.status===C.STATUS_WAITING_FOR_ANSWER||this.status===C.STATUS_ANSWERED){this.setStatus(C.STATUS_CANCELED);this.request.reply(487);this.failed("remote",request,ExSIP_C.causes.CANCELED)}}else{switch(request.method){case ExSIP_C.ACK:if(this.status===C.STATUS_WAITING_FOR_ACK){clearTimeout(this.timers.ackTimer);clearTimeout(this.timers.invite2xxTimer);this.setStatus(C.STATUS_CONFIRMED);if(request.body.length>0){this.logger.log("set remoteDescription for late offer ACK");this.rtcMediaHandler.onMessage(self.rtcMediaHandler.getSetRemoteLocationType(),request.body,function(){self.logger.log("late offer remoteDescription success");self.started("local",undefined,true)},function(){self.logger.log("late offer remoteDescription failure")})}}break;case ExSIP_C.BYE:if(this.status===C.STATUS_CONFIRMED){request.reply(200);this.ended("remote",request,ExSIP_C.causes.BYE)}else if(this.status===C.STATUS_INVITE_RECEIVED){request.reply(200);this.request.reply(487,"BYE Received");this.ended("remote",request,ExSIP_C.causes.BYE)}else{request.reply(403,"Wrong Status")}break;case ExSIP_C.INVITE:if(this.status===C.STATUS_CONFIRMED){this.logger.debug("re-INVITE received");this.request=request;if(!request.body||request.body.length===0){this.acceptReInvite();return}var description=new WebRTC.RTCSessionDescription({type:"offer",sdp:request.body});var oldDescription=this.rtcMediaHandler.peerConnection.remoteDescription;var audioAdd=description.hasActiveAudio()&&(!oldDescription||!oldDescription.hasActiveAudio());var videoAdd=description.hasActiveVideo()&&(!oldDescription||!oldDescription.hasActiveVideo());if(audioAdd||videoAdd){this.ua.emit("onReInvite",this.ua,{session:this,request:request,audioAdd:audioAdd,videoAdd:videoAdd})}else{this.acceptReInvite()}}else{request.reply(403,"Wrong Status")
}break;case ExSIP_C.INFO:if(this.status===C.STATUS_CONFIRMED||this.status===C.STATUS_WAITING_FOR_ACK||this.status===C.STATUS_INVITE_RECEIVED||this.status===C.STATUS_ANSWERED){contentType=request.getHeader("content-type");if(contentType&&contentType.match(/^application\/dtmf-relay/i)){new RTCSession_DTMF(this).init_incoming(request)}else if(contentType&&contentType.match(/^application\/media_control\+xml/i)){request.reply(200);this.started("local",undefined,true)}else{request.reply(415)}}else{this.logger.debug("Wrong Status : "+this.status);request.reply(403,"Wrong Status")}break;case ExSIP_C.UPDATE:if(this.status===C.STATUS_CONFIRMED){this.logger.debug("UPDATE received");this.receiveUpdate(request)}else{request.reply(403,"Wrong Status")}break;case ExSIP_C.REFER:if(this.status===C.STATUS_CONFIRMED){this.ua.processRefer(this,request)}break;case ExSIP_C.NOTIFY:if(this.status===C.STATUS_REFER_SENT){request.reply(200);this.logger.log("received NOTIFY with body : "+request.body);var status=parseInt(request.body.match(/SIP\/2.0\s(.*)\s/)[1],10);this.logger.log("NOTIFY status : "+status);if(!this.sessionToTransfer){this.logger.warn("no transferred session for REFER session : "+this.id);return}if(status>=200&&status<=299){this.logger.log("terminate transferred session : "+this.sessionToTransfer.id);this.sessionToTransfer.terminate()}else if(status>=400&&status<=699){this.logger.warn("resuming session : "+this.sessionToTransfer.id);this.sessionToTransfer.unhold(function(){self.logger.log("resumed session : "+self.sessionToTransfer.id)})}}break;default:request.reply(501)}}};RTCSession.prototype.setStatus=function(status){if(this.logger){this.logger.debug("setStatus : "+Object.keys(C)[status])}else{console.log("setStatus : "+Object.keys(C)[status])}this.status=status};RTCSession.prototype.supports=function(name){var supported=this.request.getHeader("Supported");return supported!==undefined&&supported.indexOf(name)!==-1};RTCSession.prototype.sendACK=function(){this.sendRequest(ExSIP_C.ACK)};RTCSession.prototype.sendBye=function(options){var self=this;options=options||{};options.extraHeaders=options.extraHeaders||[];var reason,status_code=options.status_code,reason_phrase=options.reason_phrase||ExSIP_C.REASON_PHRASE[status_code]||"",body=options.body;if(status_code&&(status_code<200||status_code>=700)){throw new TypeError("Invalid status_code: "+status_code)}else if(status_code){reason="SIP ;cause="+status_code+'; text="'+reason_phrase+'"';options.extraHeaders.push("Reason: "+reason)}options.sdp=body;options.status=C.STATUS_BYE_SENT;var callbacks={success:function(){self.sendACK();self.ended("local",null,ExSIP_C.causes.BYE)}};this.logger.log("sendBye : "+callbacks);this.sendRequest(ExSIP_C.BYE,options,callbacks)};RTCSession.prototype.sendRequest=function(method,options,requestCallbacks){var request_sender;options=options||{};if(this.dialog){this.logger.debug("sendRequest : dialog : "+method);request_sender=this.dialog.createRequestSender(this,method,options)}else{this.logger.debug("sendRequest : createOutgoingRequestSender : "+method+", "+JSON.stringify(options));request_sender=this.createOutgoingRequestSender(options.target,method,options)}if(!request_sender){return}if(options.status){this.setStatus(options.status)}request_sender.request.body=options.sdp;var hasSdp=request_sender.request.body&&request_sender.request.body.length>0;if(!Utils.containsHeader(request_sender.request.extraHeaders,"Content-Type")&&hasSdp){request_sender.request.extraHeaders.push("Content-Type: application/sdp")}this.logger.debug("request_sender.request.extraHeaders : "+Utils.toString(request_sender.request.extraHeaders));request_sender.send(requestCallbacks)};RTCSession.prototype.onTransportError=function(){if(this.status!==C.STATUS_TERMINATED){if(this.status===C.STATUS_CONFIRMED){this.ended("system",null,ExSIP_C.causes.CONNECTION_ERROR)}else{this.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)}}};RTCSession.prototype.connectLocalMedia=function(target,options,success,failure){var self=this;this.receiveResponse=this.receiveInviteResponse;var mediaConstraints=options.mediaConstraints||{audio:true,video:true};this.getUserMedia(mediaConstraints,function(){self.logger.log("getUserMedia succeeded");success()},function(){self.logger.log("getUserMedia failed");self.failed("local",null,ExSIP_C.causes.WEBRTC_ERROR);failure()},options)};RTCSession.prototype.sendReinvite=function(options){options=options||{};var self=this,extraHeaders=options.extraHeaders||[],eventHandlers=options.eventHandlers||{},mangle=options.mangle||null;if(eventHandlers.succeeded){this.reinviteSucceeded=eventHandlers.succeeded}else{this.reinviteSucceeded=function(){}}if(eventHandlers.failed){this.reinviteFailed=eventHandlers.failed}else{this.reinviteFailed=function(){}}extraHeaders.push("Contact: "+this.contact);extraHeaders.push("Content-Type: application/sdp");this.receiveResponse=this.receiveReinviteResponse;this.rtcMediaHandler.createOffer(function(body){if(mangle){body=mangle(body)}self.dialog.sendRequest(self,ExSIP_C.INVITE,{extraHeaders:extraHeaders,body:body})},function(){if(self.isReadyToReinvite()){self.onReadyToReinvite()}self.reinviteFailed()})};RTCSession.prototype.receiveReinviteResponse=function(response){var self=this,contentType=response.getHeader("Content-Type");if(this.status===C.STATUS_TERMINATED){return}switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):this.setStatus(C.STATUS_CONFIRMED);this.sendRequest(ExSIP_C.ACK);if(!response.body){this.reinviteFailed();break}else if(contentType!=="application/sdp"){this.reinviteFailed();break}this.rtcMediaHandler.onMessage("answer",response.body,function(){if(self.reinviteSucceeded){self.reinviteSucceeded()}},function(){if(self.reinviteFailed){self.reinviteFailed()}});break;default:if(this.reinviteFailed){this.reinviteFailed()}}};RTCSession.prototype.acceptAndTerminate=function(response,status_code,reason_phrase){var extraHeaders=[];if(status_code){reason_phrase=reason_phrase||ExSIP_C.REASON_PHRASE[status_code]||"";extraHeaders.push("Reason: SIP ;cause="+status_code+'; text="'+reason_phrase+'"')}if(this.dialog||this.createDialog(response,"UAC")){this.sendRequest(ExSIP_C.ACK);this.sendBye()}this.setStatus(C.STATUS_TERMINATED)};RTCSession.prototype.toogleMuteAudio=function(mute){var streamIdx,trackIdx,tracks,localStreams=this.getLocalStreams();for(streamIdx in localStreams){tracks=localStreams[streamIdx].getAudioTracks();for(trackIdx in tracks){tracks[trackIdx].enabled=!mute}}};RTCSession.prototype.toogleMuteVideo=function(mute){var streamIdx,trackIdx,tracks,localStreams=this.getLocalStreams();for(streamIdx in localStreams){tracks=localStreams[streamIdx].getVideoTracks();for(trackIdx in tracks){tracks[trackIdx].enabled=!mute}}};RTCSession.prototype.onTransportError=function(){if(this.status!==C.STATUS_TERMINATED){if(this.status===C.STATUS_CONFIRMED){this.ended("system",null,ExSIP_C.causes.CONNECTION_ERROR)}else{this.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)}}};RTCSession.prototype.onRequestTimeout=function(){if(this.status!==C.STATUS_TERMINATED){if(this.status===C.STATUS_CONFIRMED){this.ended("system",null,ExSIP_C.causes.REQUEST_TIMEOUT)}else{this.ua.reconnect();this.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)}}};RTCSession.prototype.onDialogError=function(response){if(this.status!==C.STATUS_TERMINATED){if(this.status===C.STATUS_CONFIRMED){this.ended("remote",response,ExSIP_C.causes.DIALOG_ERROR)}else{this.failed("remote",response,ExSIP_C.causes.DIALOG_ERROR)}}};RTCSession.prototype.newRTCSession=function(originator,request){var session=this,event_name="newRTCSession";if(originator==="remote"){session.direction="incoming";session.local_identity=request.to;session.remote_identity=request.from}else if(originator==="local"){session.direction="outgoing";session.local_identity=request.from;session.remote_identity=request.to}session.ua.emit(event_name,session.ua,{originator:originator,session:session,request:request})};RTCSession.prototype.connecting=function(request){var session=this,event_name="connecting";session.emit(event_name,session,{request:request})};RTCSession.prototype.progress=function(originator,response){var session=this,event_name="progress";session.emit(event_name,session,{originator:originator,response:response||null})};RTCSession.prototype.accepted=function(originator,message){var session=this,event_name="accepted";session.start_time=new Date;session.emit(event_name,session,{originator:originator,response:message||null})};RTCSession.prototype.started=function(originator,message){var session=this,event_name="started";session.start_time=new Date;session.emit(event_name,session,{originator:originator,response:message||null})};RTCSession.prototype.confirmed=function(originator,ack){var session=this,event_name="confirmed";this.is_confirmed=true;session.emit(event_name,session,{originator:originator,ack:ack||null})};RTCSession.prototype.ended=function(originator,message,cause){var session=this,event_name="ended";session.end_time=new Date;session.close();session.emit(event_name,session,{originator:originator,message:message||null,cause:cause})};RTCSession.prototype.failed=function(originator,message,cause){var session=this,event_name="failed";session.close();session.emit(event_name,session,{originator:originator,message:message||null,cause:cause})};RTCSession.prototype.onhold=function(originator){if(originator==="local"){this.local_hold=true}else{this.remote_hold=true}this.emit("hold",this,{originator:originator})};RTCSession.prototype.onunhold=function(originator){if(originator==="local"){this.local_hold=false}else{this.remote_hold=false}this.emit("unhold",this,{originator:originator})};RTCSession.prototype.onmute=function(options){this.emit("muted",this,{audio:options.audio,video:options.video})};RTCSession.prototype.onunmute=function(options){this.emit("unmuted",this,{audio:options.audio,video:options.video})};RTCSession.prototype.onReadyToReinvite=function(){var action=this.pending_actions.length()>0?this.pending_actions.shift():null;if(!action){return}if(action.name==="hold"){this.hold()}else if(action.name==="unhold"){this.unhold()}}},{"./Constants":22,"./Dialog":23,"./EventEmitter":26,"./Exceptions":28,"./Parser":34,"./RTCSession/DTMF":36,"./RTCSession/RTCMediaHandler":38,"./RequestSender":40,"./SIPMessage":41,"./Timers":42,"./UA":45,"./Utils":47,"./WebRTC":48}],36:[function(require,module,exports){module.exports=DTMF;var C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};DTMF.C=C;var EventEmitter=require("../EventEmitter");var Exceptions=require("../Exceptions");var RTCSession=require("../RTCSession");var Utils=require("../Utils");function DTMF(session){var events=["succeeded","failed"];this.sendTimeoutId=null;this.queuedDTMFs=[];this.session=session;this.direction=null;this.tone=null;this.duration=null;this.interToneGap=null;this.dtmfSender=null;this.logger=this.session.ua.getLogger("rtcsession.dtmf",session.id);this.initEvents(events)}DTMF.prototype=new EventEmitter;DTMF.prototype.send=function(tone,options){var event,eventHandlers,extraHeaders;if(tone===undefined){throw new TypeError("Not enough arguments")}this.direction="outgoing";if(this.session.status!==RTCSession.C.STATUS_CONFIRMED&&this.session.status!==RTCSession.C.STATUS_WAITING_FOR_ACK){throw new Exceptions.InvalidStateError(this.session.status)}options=options||{};extraHeaders=options.extraHeaders?options.extraHeaders.slice():[];eventHandlers=options.eventHandlers||{};if(typeof tone==="string"){tone=tone.toUpperCase()}else if(typeof tone==="number"){tone=tone.toString()}else{throw new TypeError("Invalid tone: "+tone)}if(!tone.match(/^[0-9A-D#*,]+$/i)){throw new TypeError("Invalid tone: "+tone)}else{this.tone=tone}for(event in eventHandlers){this.on(event,eventHandlers[event])}this.queueTone(this.tone,options.duration,options.interToneGap)};DTMF.prototype.processQueuedDTMFs=function(){var self=this;if(this.queuedDTMFs.length===0){return}if(!this.dtmfSender.canInsertDTMF){this.logger.log("DTMF Sender cannot insert DTMF - trying again after timeout",this.session.ua);this.sendTimeoutId=setTimeout(function(){self.processQueuedDTMFs()},1e3);return}var tones="";var durationSum=0;var interToneGapSum=0;for(var i=0;i<this.queuedDTMFs.length;i++){var dtmf=this.queuedDTMFs[i];tones+=dtmf.tone;durationSum+=dtmf.duration;interToneGapSum+=dtmf.interToneGap}var duration=durationSum/this.queuedDTMFs.length;var interToneGap=interToneGapSum/this.queuedDTMFs.length;this.logger.log("sending DTMF with tones "+tones+", duration "+duration+", gap "+interToneGap);this.dtmfSender.insertDTMF(tones,duration,interToneGap)};DTMF.prototype.queueTone=function(tone,duration,interToneGap){this.logger.log("Queue tone : "+tone);clearTimeout(this.sendTimeoutId);this.queuedDTMFs.push({tone:tone,duration:duration,interToneGap:interToneGap});var self=this;this.sendTimeoutId=setTimeout(function(){self.processQueuedDTMFs()},2*duration)};DTMF.prototype.onDTMFSent=function(tone){if(!tone){return}this.logger.log("Sent Dtmf tone: "+tone.tone);for(var i=0;i<this.queuedDTMFs.length;i++){var dtmf=this.queuedDTMFs[i];if(tone.tone===dtmf.tone){this.queuedDTMFs.splice(i,1);this.logger.log("removing from queued tones - remaining queue: 	"+Utils.toString(this.queuedDTMFs));break}else if(dtmf.tone.indexOf(tone.tone)!==-1){dtmf.tone=dtmf.tone.replace(tone.tone,"");this.queuedDTMFs[i]=dtmf;this.logger.log("removing from queued tones as contained - remaining queue: 	"+Utils.toString(this.queuedDTMFs));break}}this.session.emit("newDTMF",this.session,{originator:"local",dtmf:this,tone:tone.tone})};DTMF.prototype.enableDtmfSender=function(localstream,peerConnection){var self=this;this.logger.debug("enableDtmfSender : "+localstream);if(localstream!==null){var local_audio_track=localstream.getAudioTracks()[0];this.dtmfSender=peerConnection.createDTMFSender(local_audio_track);this.logger.log("Created DTMF Sender with canInsertDTMF : "+this.dtmfSender.canInsertDTMF);this.dtmfSender.ontonechange=function(tone){self.onDTMFSent(tone)};this.processQueuedDTMFs()}else{this.logger.error("No Local Stream to create DTMF Sender")}};DTMF.prototype.receiveResponse=function(response){var cause;switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):this.emit("succeeded",this,{originator:"remote",response:response});break;default:cause=Utils.sipErrorCause(response.status_code);this.emit("failed",this,{originator:"remote",response:response,cause:cause});break}};DTMF.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:C.causes.REQUEST_TIMEOUT})};DTMF.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:C.causes.CONNECTION_ERROR})};DTMF.prototype.init_incoming=function(request){var body,reg_tone=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,reg_duration=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming";this.request=request;request.reply(200);if(request.body){body=request.body.split("\r\n");if(body.length===2){if(reg_tone.test(body[0])){this.tone=body[0].replace(reg_tone,"$2")}if(reg_duration.test(body[1])){this.duration=parseInt(body[1].replace(reg_duration,"$2"),10)}}}if(!this.tone||!this.duration){this.logger.warn("invalid INFO DTMF received, discarded")}else{this.session.emit("newDTMF",this.session,{originator:"remote",dtmf:this,request:request})}}},{"../EventEmitter":26,"../Exceptions":28,"../RTCSession":35,"../Utils":47}],37:[function(require,module,exports){module.exports=DataChannel;var EventEmitter=require("../EventEmitter");function DataChannel(session,peerConnection){this.session=session;this.peerConnection=peerConnection;this.sendChannel=null;this.receiveChannel=null;this.chunkLength=6e4;this.dataReceived=[];this.logger=session.ua.getLogger("ExSIP.rtcsession.datachannel",session.id);this.initSendChannel()}DataChannel.prototype=new EventEmitter;DataChannel.prototype.isDebug=function(){return this.session.ua.isDebug()};DataChannel.prototype.close=function(){if(this.sendChannel){this.sendChannel.close()}if(this.receiveChannel){this.receiveChannel.close()}};DataChannel.prototype.send=function(data){this.sendInChunks(data);this.logger.log("Sent Data: "+data,this.session.ua);this.session.emit("dataSent",this,{data:data})};DataChannel.prototype.sendInChunks=function(data){var text=null,last=false,self=this;if(data.length>this.chunkLength){text=data.slice(0,this.chunkLength)}else{text=data;last=true}this.sendChannel.send(text+(last?"\n":""));if(!last){var remainingDataURL=data.slice(text.length);window.setTimeout(function(){self.sendInChunks(remainingDataURL)},50)}};DataChannel.prototype.initSendChannel=function(){var self=this;try{this.sendChannel=this.peerConnection.createDataChannel("sendDataChannel",null);this.logger.log("Created send data channel",this.session.ua);var onSendChannelStateChange=function(){var readyState=self.sendChannel.readyState;this.logger.log("Send channel state is: "+readyState,self.session.ua)};this.sendChannel.onopen=onSendChannelStateChange;this.sendChannel.onclose=onSendChannelStateChange;var receiveChannelCallback=function(event){this.logger.log("Receive Channel Callback",self.session.ua);self.receiveChannel=event.channel;var onReceiveChannelStateChange=function(){var readyState=self.receiveChannel.readyState;this.logger.log("Receive channel state is: "+readyState,self.session.ua)};var onReceiveMessageCallback=function(event){this.logger.log("Received Message : "+event.data,self.session.ua);if(event.data.indexOf("\n")!==-1){self.dataReceived.push(event.data.replace("\n",""));var data=self.dataReceived.join("");self.dataReceived=[];self.session.emit("dataReceived",self,{data:data})}else{self.dataReceived.push(event.data)}};self.receiveChannel.onmessage=onReceiveMessageCallback;self.receiveChannel.onopen=onReceiveChannelStateChange;self.receiveChannel.onclose=onReceiveChannelStateChange};this.peerConnection.ondatachannel=receiveChannelCallback}catch(e){this.emit("failed",this,{cause:"Failed to create data channel"});self.logger.error("Create Data channel failed with exception: "+e.message)}}},{"../EventEmitter":26}],38:[function(require,module,exports){module.exports=RTCMediaHandler;var ExSIP_C=require("../Constants");var WebRTC=require("../WebRTC");var Utils=require("../Utils");var DataChannel=require("./DataChannel");function RTCMediaHandler(session,constraints){constraints=constraints||{};this.logger=session.ua.getLogger("ExSIP.rtcsession.rtcmediahandler",session.id);this.logger.log("constraints : "+Utils.toString(constraints),session.ua);this.session=session;this.localMedia=null;this.peerConnection=null;this.createOfferConstraints=null;this.dataChannel=null;this.ready=true;this.init(constraints)}RTCMediaHandler.prototype={isReady:function(){return this.ready},copy:function(rtcMediaHandler){var self=this;var streamAdditionSucceeded=function(){};var streamAdditionFailed=function(){if(self.session.status===ExSIP_C.STATUS_TERMINATED){return}self.session.failed("local",null,ExSIP_C.causes.WEBRTC_ERROR)};var description=new WebRTC.RTCSessionDescription({type:this.getSetLocalDescriptionType(),sdp:rtcMediaHandler.peerConnection.localDescription.sdp});this.setLocalDescription(description);this.addStream(rtcMediaHandler.localMedia,streamAdditionSucceeded,streamAdditionFailed)},connect:function(stream,connectSucceeded,connectFailed,options){var self=this;options=options||{};this.logger.log("connect with isAnswer : "+options.isAnswer+" and remoteSdp : "+options.remoteSdp,self.session.ua);var setLocalDescription=function(callback){self.setLocalDescription(options.localDescription,callback||connectSucceeded,connectFailed)};var setRemoteDescription=function(successCallback){self.onMessage(self.getSetRemoteLocationType(),options.remoteSdp,successCallback||connectSucceeded,function(e){self.logger.error("setRemoteDescription failed");self.logger.error(Utils.toString(e));connectFailed()})};var createAnswer=function(){self.createAnswer(connectSucceeded,connectFailed,options.mediaConstraints)};var createOffer=function(){self.createOffer(function(sdp){if(options.remoteSdp&&options.remoteSdp!==""){setRemoteDescription(connectSucceeded)}else{connectSucceeded(sdp)}},connectFailed,options.createOfferConstraints,options)};var streamAdditionSucceeded=function(){var hasRemoteSdp=options.remoteSdp&&options.remoteSdp.length>0;var isRemote=options.isAnswer&&hasRemoteSdp;self.logger.log("isRemote : "+isRemote+", isAnswer : "+options.isAnswer+", hasRemoteSdp :"+hasRemoteSdp,self.session.ua);if(isRemote){if(options.localDescription){setRemoteDescription(setLocalDescription)}else{setRemoteDescription(createAnswer)}}else{if(options.remoteSdp){setLocalDescription(setRemoteDescription)}else{createOffer()}}};var streamAdditionFailed=function(){if(self.session.status===ExSIP_C.STATUS_TERMINATED){return}self.session.failed("local",null,ExSIP_C.causes.WEBRTC_ERROR);connectFailed()};this.addStream(stream,streamAdditionSucceeded,streamAdditionFailed)},createOffer:function(onSuccess,onFailure,constraints,options){var self=this;options=options||{};function onSetLocalDescriptionSuccess(){if(self.peerConnection.iceGatheringState==="complete"&&(self.peerConnection.iceConnectionState==="connected"||self.peerConnection.iceConnectionState==="completed")){self.ready=true;onSuccess(self.peerConnection.localDescription.sdp)}else{self.onIceCompleted=function(){self.onIceCompleted=undefined;self.ready=true;onSuccess(self.peerConnection.localDescription.sdp)}}}this.ready=false;this.createOfferConstraints=constraints;this.logger.log("createOffer with createOfferConstraints : "+Utils.toString(this.createOfferConstraints),this.session.ua);this.peerConnection.createOffer(function(sessionDescription){if(options.videoMode){sessionDescription.setVideoMode(options.videoMode)}if(options.videoPort){sessionDescription.setVideoPort(options.videoPort)}if(options.audioMode){sessionDescription.setAudioMode(options.audioMode)}if(options.audioPort){sessionDescription.setAudioPort(options.audioPort)}self.setLocalDescription(sessionDescription,onSetLocalDescriptionSuccess,function(e){self.ready=true;onFailure(e)})},function(e){self.ready=true;self.logger.error("unable to create offer");self.logger.error(e);onFailure(e)},constraints)},getRemoteDescriptionSdp:function(){return this.peerConnection.remoteDescription?this.peerConnection.remoteDescription.sdp:undefined},createAnswer:function(onSuccess,onFailure,constraints){var self=this;function onSetLocalDescriptionSuccess(){if(self.peerConnection.iceGatheringState==="complete"&&(self.peerConnection.iceConnectionState==="connected"||self.peerConnection.iceConnectionState==="completed")){self.ready=true;onSuccess(self.peerConnection.localDescription.sdp)}else{self.onIceCompleted=function(){self.onIceCompleted=undefined;self.ready=true;onSuccess(self.peerConnection.localDescription.sdp)}}}this.ready=false;constraints=constraints||this.createOfferConstraints;this.logger.log("createAnswer with constraints : "+constraints,this.session.ua);this.peerConnection.createAnswer(function(sessionDescription){self.setLocalDescription(sessionDescription,onSetLocalDescriptionSuccess,function(e){self.ready=true;onFailure(e)})},function(e){self.ready=true;self.logger.error("unable to create answer");self.logger.error(e);onFailure(e)},constraints)},setLocalDescription:function(sessionDescription,onSuccess,onFailure){var self=this;this.peerConnection.setLocalDescription(sessionDescription,onSuccess,function(e){self.logger.error("unable to set local description");self.logger.error(e);onFailure(e)})},addStream:function(stream,onSuccess,onFailure,constraints){try{this.logger.log("add stream : "+Utils.toString(stream),this.session.ua);this.peerConnection.addStream(stream,constraints)}catch(e){this.logger.error("error adding stream");this.logger.error(e);onFailure();return}onSuccess()},clearStreams:function(){if(!this.localMedia){return}if(this.removeStream(this.localMedia)){this.localMedia=null}return},removeStream:function(stream){try{this.logger.log("remove stream : "+Utils.toString(stream),this.session.ua);this.peerConnection.removeStream(stream)}catch(e){this.logger.error("error removing stream");this.logger.error(e);return false}return true},getSetLocalDescriptionType:function(){var state=this.peerConnection.signalingState;if(state==="stable"||state==="have-local-offer"){return"offer"}else if(state==="have-remote-offer"||state==="have-local-pr-answer"){return"answer"}else{this.logger.error("state "+state+" not implemented - returning offer");return"offer"}},getSetRemoteLocationType:function(){var state=this.peerConnection.signalingState;if(state==="stable"||state==="have-remote-offer"){return"offer"}else if(state==="have-local-offer"||state==="have-remote-pr-answer"){return"answer"}else{this.logger.error("state "+state+" not implemented - returning offer");return"offer"}},sendData:function(data){if(this.dataChannel){this.dataChannel.send(data)}else{this.logger.error("datachannel is not enabled - see UA.configuration.enable_datachannel")}},init:function(options){options=options||{};var idx,length,server,self=this,servers=[],constraints=options.constraints||{},stun_servers=options.stun_servers||null,turn_servers=options.turn_servers||null,config=this.session.ua.configuration;if(!stun_servers){stun_servers=config.stun_servers}if(!turn_servers){turn_servers=config.turn_servers}if(stun_servers.length>0){servers.push({url:stun_servers})}length=turn_servers.length;for(idx=0;idx<length;idx++){server=turn_servers[idx];servers.push({url:server.urls,username:server.username,credential:server.credential})}this.peerConnection=new WebRTC.RTCPeerConnection({iceServers:servers},constraints);this.peerConnection.onaddstream=function(e){self.logger.debug("stream added: "+e.stream.id)};this.peerConnection.onremovestream=function(e){self.logger.debug("stream removed: "+e.stream.id)};this.peerConnection.onicecandidate=function(e){if(e.candidate&&self.session.ua.rtcMediaHandlerOptions.enableICE){self.logger.debug("ICE candidate received: "+e.candidate.candidate)}else if(self.onIceCompleted!==undefined){self.logger.log("onIceCompleted with ready : "+self.ready+" and candidate : "+Utils.toString(e.candidate),self.session.ua);if(!self.ready&&e.candidate){self.onIceCompleted()}}};this.peerConnection.oniceconnectionstatechange=function(){self.logger.debug('ICE connection state changed to "'+this.iceConnectionState+'"');if(this.iceConnectionState==="failed"){self.session.terminate({cause:ExSIP_C.causes.RTP_TIMEOUT,status_code:200,reason_phrase:ExSIP_C.causes.RTP_TIMEOUT})}};this.peerConnection.onstatechange=function(){self.logger.debug('PeerConnection state changed to "'+this.readyState+'"')};if(self.session.ua.configuration.enable_datachannel){this.dataChannel=new DataChannel(this.session,this.peerConnection)}},close:function(stopLocalMedia){this.logger.debug("closing PeerConnection");if(this.peerConnection){if(this.peerConnection.signalingState!=="closed"){this.logger.log("closing PeerConnection",this.session.ua);this.peerConnection.close()}if(stopLocalMedia){if(this.localMedia){this.logger.log("stopping local media "+Utils.toString(this.localMedia),this.session.ua);this.localMedia.stop()}}}},getUserMedia:function(onSuccess,onFailure,constraints){var self=this;this.logger.debug("requesting access to local media");WebRTC.getUserMedia(constraints,function(stream){self.logger.debug("got local media stream");self.localMedia=stream;onSuccess(stream)},function(e){self.logger.error("unable to get user media");self.logger.error(e);onFailure()})},onMessage:function(type,body,onSuccess,onFailure){var self=this;var description=new WebRTC.RTCSessionDescription({type:type,sdp:body});if(this.session.ua.rtcMediaHandlerOptions.videoBandwidth){description.setVideoBandwidth(this.session.ua.rtcMediaHandlerOptions.videoBandwidth);this.logger.log("Modifying SDP with videoBandwidth : "+this.session.ua.rtcMediaHandlerOptions.videoBandwidth)}if(this.peerConnection){if(!description.sdp){this.logger.log("empty sdp on setRemoteDescription - calling success");onSuccess();return}var unsupportedMedia=description.removeUnsupportedMedia();if(unsupportedMedia){this.logger.log("removed unsupported media : "+unsupportedMedia);this.peerConnection.remoteUnsupportedMedia=unsupportedMedia}this.logger.log("peerConnection.setRemoteDescription : description : "+Utils.toString(description));this.logger.log("peerConnection.setRemoteDescription for type "+description.type+" : "+description.sdp);this.peerConnection.setRemoteDescription(description,onSuccess,function(e){self.logger.log("----------setRemoteDescription with error : "+JSON.stringify(e));onFailure(e)})}}}},{"../Constants":22,"../Utils":47,"../WebRTC":48,"./DataChannel":37}],39:[function(require,module,exports){module.exports=Registrator;var Utils=require("./Utils");var ExSIP_C=require("./Constants");var SIPMessage=require("./SIPMessage");var RequestSender=require("./RequestSender");function Registrator(ua,transport){var reg_id=1;this.logger=ua.getLogger("ExSIP.registrator");this.ua=ua;this.transport=transport;this.registrar=ua.configuration.registrar_server;this.expires=ua.configuration.register_expires;this.call_id=Utils.createRandomToken(22);this.cseq=0;this.to_uri=ua.configuration.uri;this.registrationTimer=null;this.registered=false;this.contact=this.ua.contact.toString();this.contact+=";+sip.ice";this.extraHeaders=[];this.extraContactParams="";if(reg_id){this.contact+=";reg-id="+reg_id;this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"'}}Registrator.prototype={setExtraHeaders:function(extraHeaders){if(!extraHeaders instanceof Array){extraHeaders=[]}this.extraHeaders=extraHeaders.slice()},setExtraContactParams:function(extraContactParams){if(!extraContactParams instanceof Object){extraContactParams={}}this.extraContactParams="";for(var param_key in extraContactParams){var param_value=extraContactParams[param_key];this.extraContactParams+=";"+param_key;if(param_value){this.extraContactParams+="="+param_value}}},register:function(){var request_sender,cause,extraHeaders,self=this;extraHeaders=this.extraHeaders.slice();extraHeaders.push("Contact: "+this.contact+";expires="+this.expires+this.extraContactParams);extraHeaders.push("Expires: "+this.expires);this.request=new SIPMessage.OutgoingRequest(ExSIP_C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},extraHeaders);request_sender=new RequestSender(this,this.ua);this.receiveResponse=function(response){var contact,expires,contacts=response.getHeaders("contact").length;if(response.cseq!==this.cseq){return}if(this.registrationTimer!==null){clearTimeout(this.registrationTimer);this.registrationTimer=null}switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):if(response.hasHeader("expires")){expires=response.getHeader("expires")}if(!contacts){this.logger.warn("no Contact header in response to REGISTER, response ignored");break}while(contacts--){contact=response.parseHeader("contact",contacts);if(contact.uri.user===this.ua.contact.uri.user){expires=contact.getParam("expires");break}else{contact=null}}if(!contact){this.logger.warn("no Contact header pointing to us, response ignored");break}if(!expires){expires=this.expires}this.registrationTimer=setTimeout(function(){self.registrationTimer=null;self.register()},expires*1e3-3e3);if(contact.hasParam("temp-gruu")){this.ua.contact.temp_gruu=contact.getParam("temp-gruu").replace(/"/g,"")}if(contact.hasParam("pub-gruu")){this.ua.contact.pub_gruu=contact.getParam("pub-gruu").replace(/"/g,"")}if(!this.registered){this.registered=true;this.ua.emit("registered",this.ua,{response:response})}break;case/^423$/.test(response.status_code):if(response.hasHeader("min-expires")){this.expires=response.getHeader("min-expires");this.register()}else{this.logger.warn("423 response received for REGISTER without Min-Expires");
this.registrationFailure(response,ExSIP_C.causes.SIP_FAILURE_CODE)}break;default:cause=Utils.sipErrorCause(response.status_code);this.registrationFailure(response,cause)}};this.onRequestTimeout=function(){this.registrationFailure(null,ExSIP_C.causes.REQUEST_TIMEOUT)};this.onTransportError=function(){this.registrationFailure(null,ExSIP_C.causes.CONNECTION_ERROR)};request_sender.send()},unregister:function(options){var extraHeaders;if(!this.registered){this.logger.debug("already unregistered");return}options=options||{};this.registered=false;if(this.registrationTimer!==null){clearTimeout(this.registrationTimer);this.registrationTimer=null}extraHeaders=this.extraHeaders.slice();if(options.all){extraHeaders.push("Contact: *"+this.extraContactParams);extraHeaders.push("Expires: 0");this.request=new SIPMessage.OutgoingRequest(ExSIP_C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},extraHeaders)}else{extraHeaders.push("Contact: "+this.contact+";expires=0"+this.extraContactParams);extraHeaders.push("Expires: 0");this.request=new SIPMessage.OutgoingRequest(ExSIP_C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},extraHeaders)}var request_sender=new RequestSender(this,this.ua);this.receiveResponse=function(response){var cause;switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):this.unregistered(response);break;default:cause=Utils.sipErrorCause(response.status_code);this.unregistered(response,cause)}};this.onRequestTimeout=function(){this.unregistered(null,ExSIP_C.causes.REQUEST_TIMEOUT)};this.onTransportError=function(){this.unregistered(null,ExSIP_C.causes.CONNECTION_ERROR)};request_sender.send()},registrationFailure:function(response,cause){this.ua.emit("registrationFailed",this.ua,{response:response||null,cause:cause});if(this.registered){this.registered=false;this.ua.emit("unregistered",this.ua,{response:response||null,cause:cause})}},unregistered:function(response,cause){this.registered=false;this.ua.emit("unregistered",this.ua,{response:response||null,cause:cause||null})},onTransportConnected:function(){this.register()},onTransportClosed:function(){if(this.registrationTimer!==null){clearTimeout(this.registrationTimer);this.registrationTimer=null}if(this.registered){this.registered=false;this.ua.emit("unregistered",this.ua)}},close:function(){if(this.registered){this.unregister()}}}},{"./Constants":22,"./RequestSender":40,"./SIPMessage":41,"./Utils":47}],40:[function(require,module,exports){module.exports=RequestSender;var ExSIP_C=require("./Constants");var UA=require("./UA");var DigestAuthentication=require("./DigestAuthentication");var Transactions=require("./Transactions");function RequestSender(applicant,ua){this.logger=ua.getLogger("ExSIP.requestsender");this.ua=ua;this.applicant=applicant;this.method=applicant.request.method;this.request=applicant.request;this.credentials=null;this.challenged=false;this.staled=false;if(ua.status===UA.C.STATUS_USER_CLOSED&&(this.method!==ExSIP_C.BYE||this.method!==ExSIP_C.ACK)){this.onTransportError()}}RequestSender.prototype={send:function(callbacks){this.callbacks=callbacks||{};this.logger.log("callbacks : "+this.callbacks);switch(this.method){case"INVITE":this.clientTransaction=new Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.logger.log("******************** onRequestTimeout : "+this.applicant);this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(response){var cseq,challenge,authorization_header_name,status_code=response.status_code;this.logger.log("receiveResponse: callbacks : "+this.callbacks);if(status_code===401||status_code===407){if(response.status_code===401){challenge=response.parseHeader("www-authenticate");authorization_header_name="authorization"}else{challenge=response.parseHeader("proxy-authenticate");authorization_header_name="proxy-authorization"}if(!challenge){this.logger.warn(response.status_code+" with wrong or missing challenge, cannot authenticate");this.applicant.receiveResponse(response);return}if(!this.challenged||!this.staled&&challenge.stale===true){if(!this.credentials){this.credentials=new DigestAuthentication(this.ua)}if(!this.credentials.authenticate(this.request,challenge)){this.applicant.receiveResponse(response);return}this.challenged=true;if(challenge.stale){this.staled=true}if(response.method===ExSIP_C.REGISTER){cseq=this.applicant.cseq+=1}else if(this.request.dialog){cseq=this.request.dialog.local_seqnum+=1}else{cseq=this.request.cseq+1;this.request.cseq=cseq}this.request.setHeader("cseq",cseq+" "+this.method);this.request.setHeader(authorization_header_name,this.credentials.toString());this.send()}else{this.applicant.receiveResponse(response)}}else{this.applicant.receiveResponse(response)}switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):if(this.callbacks.success){this.callbacks.success()}break;default:if(this.callbacks.failure){this.callbacks.failure(response)}break}}}},{"./Constants":22,"./DigestAuthentication":25,"./Transactions":43,"./UA":45}],41:[function(require,module,exports){module.exports={OutgoingRequest:OutgoingRequest,IncomingRequest:IncomingRequest,IncomingResponse:IncomingResponse};var ExSIP_C=require("./Constants");var Utils=require("./Utils");var NameAddrHeader=require("./NameAddrHeader");var Grammar=require("./Grammar");function OutgoingRequest(method,ruri,ua,params,extraHeaders,body){var to,from,call_id,cseq;params=params||{};this.logger=ua.getLogger("ExSIP.sipmessage");this.logger.debug("OutgoingRequest.extraHeaders : "+method+", "+ruri+", "+extraHeaders);if(!method||!ruri||!ua){return null}this.ua=ua;this.headers={};this.method=method;this.ruri=ruri;this.body=body;this.extraHeaders=extraHeaders&&extraHeaders.slice()||[];this.logger.debug("OutgoingRequest.extraHeaders 2 : "+this.extraHeaders);if(params.route_set){this.setHeader("route",params.route_set)}else if(ua.configuration.use_preloaded_route){this.setHeader("route",ua.transport.server.sip_uri)}this.setHeader("via","");this.setHeader("max-forwards",ExSIP_C.MAX_FORWARDS);to=params.to_display_name||params.to_display_name===0?'"'+params.to_display_name+'" ':"";var toUri=params.to_uri||ruri;to+="<"+(ua.configuration.enable_ims&&toUri.isPhoneNumber()&&toUri.toString().indexOf(";user=phone")===-1?toUri+";user=phone":toUri)+">";to+=params.to_tag?";tag="+params.to_tag:"";this.to=new NameAddrHeader.parse(to);this.setHeader("to",to);var fromName;if(params.from_display_name||params.from_display_name===0){fromName='"'+params.from_display_name+'" '}else if(ua.configuration.display_name){fromName='"'+ua.configuration.display_name+'" '}else{fromName=""}var fromUri=params.from_uri||ua.configuration.uri;fromName+="<"+(ua.configuration.enable_ims&&fromUri.isPhoneNumber()&&fromUri.toString().indexOf(";user=phone")===-1?fromUri+";user=phone":fromUri)+">";var fromTag=";tag="+(params.from_tag||Utils.newTag());from=fromName+fromTag;this.from=new NameAddrHeader.parse(from);this.setHeader("from",from);call_id=params.call_id||ua.configuration.exsip_id+Utils.createRandomToken(15);this.call_id=call_id;this.setHeader("call-id",call_id);cseq=params.cseq||Math.floor(Math.random()*1e4);this.cseq=cseq;this.setHeader("cseq",cseq+" "+method);if(ua.configuration.enable_ims){this.setHeader("P-Asserted-Identity",fromName)}else if(ua.configuration.p_asserted_identity){this.setHeader("P-Asserted-Identity",ua.configuration.p_asserted_identity)}}OutgoingRequest.prototype={setHeader:function(name,value){this.headers[Utils.headerize(name)]=value instanceof Array?value:[value]},getHeader:function(name){var regexp,idx,length=this.extraHeaders.length,header=this.headers[Utils.headerize(name)];if(header){if(header[0]){return header[0]}}else{regexp=new RegExp("^\\s*"+name+"\\s*:","i");for(idx=0;idx<length;idx++){header=this.extraHeaders[idx];if(regexp.test(header)){return header.substring(header.indexOf(":")+1).trim()}}}return},getHeaders:function(name){var idx,length,regexp,header=this.headers[Utils.headerize(name)],result=[];if(header){length=header.length;for(idx=0;idx<length;idx++){result.push(header[idx])}return result}else{length=this.extraHeaders.length;regexp=new RegExp("^\\s*"+name+"\\s*:","i");for(idx=0;idx<length;idx++){header=this.extraHeaders[idx];if(regexp.test(header)){result.push(header.substring(header.indexOf(":")+1).trim())}}return result}},hasHeader:function(name){var regexp,idx,length=this.extraHeaders.length;if(this.headers[Utils.headerize(name)]){return true}else{regexp=new RegExp("^\\s*"+name+"\\s*:","i");for(idx=0;idx<length;idx++){if(regexp.test(this.extraHeaders[idx])){return true}}}return false},toString:function(){var msg="",header,length,idx,supported=[];msg+=this.method+" "+(this.ua.configuration.enable_ims&&this.ruri.isPhoneNumber()?this.ruri+";user=phone":this.ruri)+" SIP/2.0\r\n";for(header in this.headers){length=this.headers[header].length;for(idx=0;idx<length;idx++){msg+=header+": "+this.headers[header][idx]+"\r\n"}}length=this.extraHeaders.length;for(idx=0;idx<length;idx++){msg+=this.extraHeaders[idx].trim()+"\r\n"}switch(this.method){case ExSIP_C.REGISTER:supported.push("path","gruu");break;case ExSIP_C.INVITE:if(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu){supported.push("gruu")}break}supported.push("outbound");if(!this.hasHeader("Allow")){msg+="Allow: "+ExSIP_C.ALLOWED_METHODS+"\r\n"}if(!this.hasHeader("Supported")){msg+="Supported: "+supported+"\r\n"}msg+="User-Agent: "+ExSIP_C.USER_AGENT+"\r\n";if(this.body){length=Utils.str_utf8_length(this.body);msg+="Content-Length: "+length+"\r\n\r\n";msg+=this.body}else{msg+="Content-Length: 0\r\n\r\n"}return msg}};function IncomingMessage(){this.data=null;this.headers=null;this.method=null;this.via=null;this.via_branch=null;this.call_id=null;this.cseq=null;this.from=null;this.from_tag=null;this.to=null;this.to_tag=null;this.body=null}IncomingMessage.prototype={addHeader:function(name,value){var header={raw:value};name=Utils.headerize(name);if(this.headers[name]){this.headers[name].push(header)}else{this.headers[name]=[header]}},getHeader:function(name){var header=this.headers[Utils.headerize(name)];if(header){if(header[0]){return header[0].raw}}else{return}},getHeaders:function(name){var idx,length,header=this.headers[Utils.headerize(name)],result=[];if(!header){return[]}length=header.length;for(idx=0;idx<length;idx++){result.push(header[idx].raw)}return result},hasHeader:function(name){return this.headers[Utils.headerize(name)]?true:false},parseHeader:function(name,idx){var header,value,parsed;name=Utils.headerize(name);idx=idx||0;if(!this.headers[name]){this.logger.log('header "'+name+'" not present');return}else if(idx>=this.headers[name].length){this.logger.log('not so many "'+name+'" headers present');return}header=this.headers[name][idx];value=header.raw;if(header.parsed){return header.parsed}parsed=Grammar.parse(value,name.replace(/-/g,"_"));if(parsed===-1){this.headers[name].splice(idx,1);this.logger.warn('error parsing "'+name+'" header field with value "'+value+'"');return}else{header.parsed=parsed;return parsed}},s:function(name,idx){return this.parseHeader(name,idx)},setHeader:function(name,value){var header={raw:value};this.headers[Utils.headerize(name)]=[header]}};function IncomingRequest(ua){this.logger=ua.getLogger("ExSIP.sipmessage");this.ua=ua;this.headers={};this.ruri=null;this.transport=null;this.server_transaction=null}IncomingRequest.prototype=new IncomingMessage;IncomingRequest.prototype.reply=function(code,reason,extraHeaders,body,onSuccess,onFailure){var rr,vias,length,idx,response,supported=[],to=this.getHeader("To"),r=0,v=0;code=code||null;reason=reason||null;if(!code||(code<100||code>699)){throw new TypeError("Invalid status_code: "+code)}else if(reason&&typeof reason!=="string"&&!(reason instanceof String)){throw new TypeError("Invalid reason_phrase: "+reason)}reason=reason||ExSIP_C.REASON_PHRASE[code]||"";extraHeaders=extraHeaders&&extraHeaders.slice()||[];response="SIP/2.0 "+code+" "+reason+"\r\n";if(this.method===ExSIP_C.INVITE&&code>100&&code<=200){rr=this.getHeaders("record-route");length=rr.length;for(r;r<length;r++){response+="Record-Route: "+rr[r]+"\r\n"}}vias=this.getHeaders("via");length=vias.length;for(v;v<length;v++){response+="Via: "+vias[v]+"\r\n"}if(!this.to_tag&&code>100){to+=";tag="+Utils.newTag()}else if(this.to_tag&&!this.s("to").hasParam("tag")){to+=";tag="+this.to_tag}response+="To: "+to+"\r\n";response+="From: "+this.getHeader("From")+"\r\n";response+="Call-ID: "+this.call_id+"\r\n";response+="CSeq: "+this.cseq+" "+this.method+"\r\n";length=extraHeaders.length;for(idx=0;idx<length;idx++){response+=extraHeaders[idx].trim()+"\r\n"}switch(this.method){case ExSIP_C.INVITE:if(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu){supported.push("gruu")}break}supported.push("outbound");if(this.method===ExSIP_C.OPTIONS){response+="Allow: "+ExSIP_C.ALLOWED_METHODS+"\r\n";response+="Accept: "+ExSIP_C.ACCEPTED_BODY_TYPES+"\r\n"}else if(code===405){response+="Allow: "+ExSIP_C.ALLOWED_METHODS+"\r\n"}else if(code===415){response+="Accept: "+ExSIP_C.ACCEPTED_BODY_TYPES+"\r\n"}response+="Supported: "+supported+"\r\n";if(body){length=Utils.str_utf8_length(body);if(!this.hasHeader("Content-Type")){response+="Content-Type: application/sdp\r\n"}response+="Content-Length: "+length+"\r\n\r\n";response+=body}else{response+="Content-Length: "+0+"\r\n\r\n"}this.server_transaction.receiveResponse(code,response,onSuccess,onFailure)};IncomingRequest.prototype.reply_sl=function(code,reason){var to,response,v=0,vias=this.getHeaders("via"),length=vias.length;code=code||null;reason=reason||null;if(!code||(code<100||code>699)){throw new TypeError("Invalid status_code: "+code)}else if(reason&&typeof reason!=="string"&&!(reason instanceof String)){throw new TypeError("Invalid reason_phrase: "+reason)}reason=reason||ExSIP_C.REASON_PHRASE[code]||"";response="SIP/2.0 "+code+" "+reason+"\r\n";for(v;v<length;v++){response+="Via: "+vias[v]+"\r\n"}to=this.getHeader("To");if(!this.to_tag&&code>100){to+=";tag="+Utils.newTag()}else if(this.to_tag&&!this.s("to").hasParam("tag")){to+=";tag="+this.to_tag}response+="To: "+to+"\r\n";response+="From: "+this.getHeader("From")+"\r\n";response+="Call-ID: "+this.call_id+"\r\n";response+="CSeq: "+this.cseq+" "+this.method+"\r\n";response+="Content-Length: "+0+"\r\n\r\n";this.transport.send(response)};function IncomingResponse(ua){this.logger=ua.getLogger("ExSIP.sipmessage");this.headers={};this.status_code=null;this.reason_phrase=null}IncomingResponse.prototype=new IncomingMessage},{"./Constants":22,"./Grammar":29,"./NameAddrHeader":33,"./Utils":47}],42:[function(require,module,exports){var T1=500,T2=4e3,T4=5e3;var Timers={T1:T1,T2:T2,T4:T4,TIMER_B:64*T1,TIMER_D:0*T1,TIMER_F:64*T1,TIMER_H:64*T1,TIMER_I:0*T1,TIMER_J:0*T1,TIMER_K:0*T4,TIMER_L:64*T1,TIMER_M:64*T1,PROVISIONAL_RESPONSE_INTERVAL:6e4};module.exports=Timers},{}],43:[function(require,module,exports){module.exports={C:null,NonInviteClientTransaction:NonInviteClientTransaction,InviteClientTransaction:InviteClientTransaction,AckClientTransaction:AckClientTransaction,NonInviteServerTransaction:NonInviteServerTransaction,InviteServerTransaction:InviteServerTransaction,checkTransaction:checkTransaction};var C={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};module.exports.C=C;var ExSIP_C=require("./Constants");var EventEmitter=require("./EventEmitter");var Timers=require("./Timers");function NonInviteClientTransaction(request_sender,request,transport){var via,via_transport,events=["stateChanged"];this.type=C.NON_INVITE_CLIENT;this.transport=transport;this.id="z9hG4bK"+Math.floor(Math.random()*1e7);this.request_sender=request_sender;this.request=request;this.logger=request_sender.ua.getLogger("ExSIP.transaction.nict",this.id);if(request_sender.ua.configuration.hack_via_tcp){via_transport="TCP"}else if(request_sender.ua.configuration.hack_via_ws){via_transport="WS"}else{via_transport=transport.server.scheme}via="SIP/2.0/"+via_transport;via+=" "+request_sender.ua.configuration.via_host+";branch="+this.id;this.request.setHeader("via",via);this.request_sender.ua.newTransaction(this);this.initEvents(events)}NonInviteClientTransaction.prototype=new EventEmitter;NonInviteClientTransaction.prototype.stateChanged=function(state){this.state=state;this.emit("stateChanged",this)};NonInviteClientTransaction.prototype.send=function(){var tr=this;this.stateChanged(C.STATUS_TRYING);this.F=setTimeout(function(){tr.timer_F()},Timers.TIMER_F);if(!this.transport.send(this.request)){this.onTransportError()}};NonInviteClientTransaction.prototype.onTransportError=function(){this.logger.debug("transport error occurred, deleting non-INVITE client transaction "+this.id);clearTimeout(this.F);clearTimeout(this.K);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);this.request_sender.onTransportError()};NonInviteClientTransaction.prototype.timer_F=function(){this.logger.debug("Timer F expired for non-INVITE client transaction "+this.id);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);this.request_sender.onRequestTimeout()};NonInviteClientTransaction.prototype.timer_K=function(){this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this)};NonInviteClientTransaction.prototype.receiveResponse=function(response){var tr=this,status_code=response.status_code;if(status_code<200){switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_PROCEEDING);this.request_sender.receiveResponse(response);break}}else{switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_COMPLETED);clearTimeout(this.F);if(status_code===408){this.request_sender.onRequestTimeout()}else{this.request_sender.receiveResponse(response)}this.K=setTimeout(function(){tr.timer_K()},Timers.TIMER_K);break;case C.STATUS_COMPLETED:break}}};function InviteClientTransaction(request_sender,request,transport){var via,tr=this,via_transport,events=["stateChanged"];this.type=C.INVITE_CLIENT;this.transport=transport;this.id="z9hG4bK"+Math.floor(Math.random()*1e7);this.request_sender=request_sender;this.request=request;this.logger=request_sender.ua.getLogger("ExSIP.transaction.ict",this.id);this.logger.log("******************** request_sender : "+request_sender);if(request_sender.ua.configuration.hack_via_tcp){via_transport="TCP"}else if(request_sender.ua.configuration.hack_via_ws){via_transport="WS"}else{via_transport=transport.server.scheme}via="SIP/2.0/"+via_transport;via+=" "+request_sender.ua.configuration.via_host+";branch="+this.id;this.request.setHeader("via",via);this.request_sender.ua.newTransaction(this);this.request.cancel=function(reason){tr.cancel_request(tr,reason)};this.initEvents(events)}InviteClientTransaction.prototype=new EventEmitter;InviteClientTransaction.prototype.stateChanged=function(state){this.state=state;this.emit("stateChanged",this)};InviteClientTransaction.prototype.send=function(){var tr=this;this.stateChanged(C.STATUS_CALLING);this.B=setTimeout(function(){tr.timer_B()},Timers.TIMER_B);if(!this.transport.send(this.request)){this.onTransportError()}};InviteClientTransaction.prototype.onTransportError=function(){this.logger.debug("transport error occurred, deleting INVITE client transaction "+this.id);clearTimeout(this.B);clearTimeout(this.D);clearTimeout(this.M);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);if(this.state!==C.STATUS_ACCEPTED){this.request_sender.onTransportError()}};InviteClientTransaction.prototype.timer_M=function(){this.logger.debug("Timer M expired for INVITE client transaction "+this.id);if(this.state===C.STATUS_ACCEPTED){clearTimeout(this.B);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this)}};InviteClientTransaction.prototype.timer_B=function(){this.logger.debug("Timer B expired for INVITE client transaction "+this.id);if(this.state===C.STATUS_CALLING){this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);this.logger.debug("InviteClientTransaction.timer_B : "+this.request_sender);this.request_sender.onRequestTimeout()}};InviteClientTransaction.prototype.timer_D=function(){this.logger.debug("Timer D expired for INVITE client transaction "+this.id);clearTimeout(this.B);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this)};InviteClientTransaction.prototype.sendACK=function(response){var tr=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n";this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n";if(this.request.headers.Route){this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"}this.ack+="To: "+response.getHeader("to")+"\r\n";this.ack+="From: "+this.request.headers.From.toString()+"\r\n";this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n";this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0];this.ack+=" ACK\r\n";this.ack+="Content-Length: 0\r\n\r\n";this.D=setTimeout(function(){tr.timer_D()},Timers.TIMER_D);this.transport.send(this.ack)};InviteClientTransaction.prototype.cancel_request=function(tr,reason){var request=tr.request;this.cancel=ExSIP_C.CANCEL+" "+request.ruri+" SIP/2.0\r\n";this.cancel+="Via: "+request.headers.Via.toString()+"\r\n";if(this.request.headers.Route){this.cancel+="Route: "+request.headers.Route.toString()+"\r\n"}this.cancel+="To: "+request.headers.To.toString()+"\r\n";this.cancel+="From: "+request.headers.From.toString()+"\r\n";this.cancel+="Call-ID: "+request.headers["Call-ID"].toString()+"\r\n";this.cancel+="CSeq: "+request.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n";if(reason){this.cancel+="Reason: "+reason+"\r\n"}this.cancel+="Content-Length: 0\r\n\r\n";if(this.state===C.STATUS_PROCEEDING){this.transport.send(this.cancel)}};InviteClientTransaction.prototype.receiveResponse=function(response){var tr=this,status_code=response.status_code;if(status_code>=100&&status_code<=199){this.logger.debug("received 1xx : "+this.state);switch(this.state){case C.STATUS_CALLING:this.stateChanged(C.STATUS_PROCEEDING);this.request_sender.receiveResponse(response);break;case C.STATUS_PROCEEDING:this.request_sender.receiveResponse(response);break}}else if(status_code>=200&&status_code<=299){switch(this.state){case C.STATUS_CALLING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_ACCEPTED);this.M=setTimeout(function(){tr.timer_M()},Timers.TIMER_M);this.request_sender.receiveResponse(response);break;case C.STATUS_ACCEPTED:this.request_sender.receiveResponse(response);break}}else if(status_code>=300&&status_code<=699){switch(this.state){case C.STATUS_CALLING:case C.STATUS_PROCEEDING:this.state=C.STATUS_COMPLETED;this.sendACK(response);if(status_code===503){var options={code:503,reason:"Service Unavailable",retryCallback:function(transport){transport.ua.once("connected",function(e){if(transport===e.data.transport){tr.send()}})}};this.request_sender.ua.onTransportError(this.request_sender.ua.transport,options)}else{this.request_sender.receiveResponse(response)}break;case C.STATUS_COMPLETED:this.sendACK(response);break}}};function AckClientTransaction(request_sender,request,transport){var via,via_transport;this.transport=transport;this.id="z9hG4bK"+Math.floor(Math.random()*1e7);this.request_sender=request_sender;this.request=request;this.logger=request_sender.ua.getLogger("ExSIP.transaction.nict",this.id);if(request_sender.ua.configuration.hack_via_tcp){via_transport="TCP"}else if(request_sender.ua.configuration.hack_via_ws){via_transport="WS"}else{via_transport=transport.server.scheme}via="SIP/2.0/"+via_transport;via+=" "+request_sender.ua.configuration.via_host+";branch="+this.id;this.request.setHeader("via",via)}AckClientTransaction.prototype=new EventEmitter;AckClientTransaction.prototype.send=function(){if(!this.transport.send(this.request)){this.onTransportError()}};AckClientTransaction.prototype.onTransportError=function(){this.logger.debug("transport error occurred, for an ACK client transaction "+this.id);this.request_sender.onTransportError()};function NonInviteServerTransaction(request,ua){var events=["stateChanged"];this.type=C.NON_INVITE_SERVER;this.id=request.via_branch;this.request=request;this.transport=request.transport;this.ua=ua;this.last_response="";request.server_transaction=this;this.logger=ua.getLogger("ExSIP.transaction.nist",this.id);this.state=C.STATUS_TRYING;ua.newTransaction(this);this.initEvents(events)}NonInviteServerTransaction.prototype=new EventEmitter;NonInviteServerTransaction.prototype.stateChanged=function(state){this.state=state;this.emit("stateChanged",this)};NonInviteServerTransaction.prototype.timer_J=function(){this.logger.debug("Timer J expired for non-INVITE server transaction "+this.id);this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)};NonInviteServerTransaction.prototype.onTransportError=function(){if(!this.transportError){this.transportError=true;this.logger.debug("transport error occurred, deleting non-INVITE server transaction "+this.id);clearTimeout(this.J);this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)}};NonInviteServerTransaction.prototype.receiveResponse=function(status_code,response,onSuccess,onFailure){var tr=this;if(status_code===100){switch(this.state){case C.STATUS_TRYING:this.stateChanged(C.STATUS_PROCEEDING);if(!this.transport.send(response)){this.onTransportError()}break;case C.STATUS_PROCEEDING:this.last_response=response;if(!this.transport.send(response)){this.onTransportError();if(onFailure){onFailure()}}else if(onSuccess){onSuccess()}break}}else if(status_code>=200&&status_code<=699){switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_COMPLETED);this.last_response=response;if(Timers.TIMER_J===0){tr.timer_J()}else{this.J=setTimeout(function(){tr.timer_J()},Timers.TIMER_J)}if(!this.transport.send(response)){this.onTransportError();if(onFailure){onFailure()}}else if(onSuccess){onSuccess()}break;case C.STATUS_COMPLETED:break}}};function InviteServerTransaction(request,ua){var events=["stateChanged"];this.type=C.INVITE_SERVER;this.id=request.via_branch;this.request=request;this.transport=request.transport;this.ua=ua;this.last_response="";request.server_transaction=this;this.logger=ua.getLogger("ExSIP.transaction.ist",this.id);this.state=C.STATUS_PROCEEDING;ua.newTransaction(this);this.resendProvisionalTimer=null;request.reply(100);this.initEvents(events)}InviteServerTransaction.prototype=new EventEmitter;InviteServerTransaction.prototype.stateChanged=function(state){this.state=state;this.emit("stateChanged",this)};InviteServerTransaction.prototype.timer_H=function(){this.logger.debug("Timer H expired for INVITE server transaction "+this.id);if(this.state===C.STATUS_COMPLETED){this.logger.log("transactions","ACK for INVITE server transaction was never received, call will be terminated")}this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)};InviteServerTransaction.prototype.timer_I=function(){this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)};InviteServerTransaction.prototype.timer_L=function(){this.logger.debug("Timer L expired for INVITE server transaction "+this.id);if(this.state===C.STATUS_ACCEPTED){this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)}};InviteServerTransaction.prototype.onTransportError=function(){if(!this.transportError){this.transportError=true;this.logger.debug("transport error occurred, deleting INVITE server transaction "+this.id);if(this.resendProvisionalTimer!==null){clearInterval(this.resendProvisionalTimer);this.resendProvisionalTimer=null}clearTimeout(this.L);clearTimeout(this.H);clearTimeout(this.I);this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)}};InviteServerTransaction.prototype.resend_provisional=function(){if(!this.transport.send(this.last_response)){this.onTransportError()}};InviteServerTransaction.prototype.receiveResponse=function(status_code,response,onSuccess,onFailure){var tr=this;if(status_code>=100&&status_code<=199){switch(this.state){case C.STATUS_PROCEEDING:if(!this.transport.send(response)){this.onTransportError()}this.last_response=response;break}}if(status_code>100&&status_code<=199&&this.state===C.STATUS_PROCEEDING){if(this.resendProvisionalTimer===null){this.resendProvisionalTimer=setInterval(function(){tr.resend_provisional()},Timers.PROVISIONAL_RESPONSE_INTERVAL)}}else if(status_code>=200&&status_code<=299){switch(this.state){case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_ACCEPTED);this.last_response=response;this.L=setTimeout(function(){tr.timer_L()},Timers.TIMER_L);if(this.resendProvisionalTimer!==null){clearInterval(this.resendProvisionalTimer);this.resendProvisionalTimer=null}case C.STATUS_ACCEPTED:if(!this.transport.send(response)){this.onTransportError();if(onFailure){onFailure()}}else if(onSuccess){onSuccess()}break}}else if(status_code>=300&&status_code<=699){switch(this.state){case C.STATUS_PROCEEDING:if(this.resendProvisionalTimer!==null){clearInterval(this.resendProvisionalTimer);this.resendProvisionalTimer=null}if(!this.transport.send(response)){this.onTransportError();if(onFailure){onFailure()}}else{this.stateChanged(C.STATUS_COMPLETED);this.H=setTimeout(function(){tr.timer_H()},Timers.TIMER_H);if(onSuccess){onSuccess()}}break}}};function checkTransaction(ua,request){var tr;switch(request.method){case ExSIP_C.INVITE:tr=ua.transactions.ist[request.via_branch];if(tr){switch(tr.state){case C.STATUS_PROCEEDING:tr.transport.send(tr.last_response);break;case C.STATUS_ACCEPTED:break}console.log("checkTransaction failed for INVITE request and server transaction in state : "+tr.state);return true}break;case ExSIP_C.ACK:tr=ua.transactions.ist[request.via_branch];if(tr){if(tr.state===C.STATUS_ACCEPTED){return false}else if(tr.state===C.STATUS_COMPLETED){tr.state=C.STATUS_CONFIRMED;tr.I=setTimeout(function(){tr.timer_I()},Timers.TIMER_I);return true}}else{return false}break;case ExSIP_C.CANCEL:tr=ua.transactions.ist[request.via_branch];if(tr){request.reply_sl(200);if(tr.state===C.STATUS_PROCEEDING){return false}else{console.log("checkTransaction failed for CANCEL request and server transaction in state : "+tr.state);return true}}else{request.reply_sl(481);console.log("checkTransaction failed for CANCEL request and no server transaction");return true}break;default:console.log("***************** nist : ",Object.keys(ua.transactions.nist));tr=ua.transactions.nist[request.via_branch];if(tr){switch(tr.state){case C.STATUS_TRYING:break;case C.STATUS_PROCEEDING:case C.STATUS_COMPLETED:tr.transport.send(tr.last_response);break}console.log("checkTransaction failed for non invite server transaction in state : "+tr.state);return true}break}}},{"./Constants":22,"./EventEmitter":26,"./Timers":42}],44:[function(require,module,exports){(function(global){module.exports=Transport;var C={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};Transport.C=C;var ExSIP_C=require("./Constants");var Parser=require("./Parser");var UA=require("./UA");var SIPMessage=require("./SIPMessage");var sanityCheck=require("./sanityCheck");var WebSocket;var isNode=false;if(global.WebSocket){WebSocket=global.WebSocket}else{WebSocket=require("ws");isNode=true}function Transport(ua,server){this.logger=ua.getLogger("ExSIP.transport");this.ua=ua;this.ws=null;this.server=server;
this.reconnection_attempts=0;this.closed=false;this.connected=false;this.reconnectTimer=null;this.lastTransportError={};if(isNode){this.ws_options=this.ua.configuration.node_ws_options;this.ws_options.protocol="sip";this.ws_options.headers={"User-Agent":ExSIP_C.USER_AGENT}}}Transport.prototype={send:function(msg){var message=msg.toString();if(this.ws&&this.readyState()===WebSocket.OPEN){if(this.ua.configuration.trace_sip===true){this.logger.debug("sending WebSocket message:\n\n"+message+"\n")}this.ws.send(message);return true}else{this.logger.warn("unable to send message, WebSocket is not open");return false}},readyState:function(){return this.ws.readyState},disconnect:function(){if(this.ws){clearTimeout(this.reconnectTimer);this.closed=true;this.logger.debug("closing WebSocket "+this.server.ws_uri);this.ws.close()}if(this.reconnectTimer!==null){clearTimeout(this.reconnectTimer);this.reconnectTimer=null;this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason})}},connect:function(){var transport=this;if(this.ws&&(this.readyState()===WebSocket.OPEN||this.readyState()===WebSocket.CONNECTING)){this.logger.log("WebSocket "+this.server.ws_uri+" is already connected");return false}if(this.ws){this.ws.close()}this.logger.log("connecting to WebSocket "+this.server.ws_uri);this.ua.onTransportConnecting(this,this.reconnection_attempts===0?1:this.reconnection_attempts);try{if(!isNode){this.ws=new WebSocket(this.server.ws_uri,"sip");this.ws.binaryType="arraybuffer"}else{this.ws=new WebSocket(this.server.ws_uri,this.ws_options)}this.ua.usedServers.push(this.server);this.ws.onopen=function(){transport.onOpen()};this.ws.onclose=function(e){transport.onClose(e)};this.ws.onmessage=function(e){transport.onMessage(e)};this.ws.onerror=function(e){transport.onError(e)}}catch(e){this.logger.warn("error connecting to WebSocket "+this.server.ws_uri+": "+e);this.lastTransportError.code=null;this.lastTransportError.reason=e.message;this.ua.onTransportError(this)}},onOpen:function(){this.connected=true;this.logger.debug("WebSocket "+this.server.ws_uri+" connected");if(this.reconnectTimer!==null){clearTimeout(this.reconnectTimer);this.reconnectTimer=null}this.reconnection_attempts=0;this.closed=false;this.ua.onTransportConnected(this)},onClose:function(e){var connected_before=this.connected;this.connected=false;this.lastTransportError.code=e.code;this.lastTransportError.reason=e.reason;this.logger.debug("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")");if(e.wasClean===false){this.logger.warn("WebSocket abrupt disconnection")}if(connected_before===true){this.ua.onTransportClosed(this);if(!this.closed){this.reConnect()}else{this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason})}}else{this.ua.onTransportError(this)}},onMessage:function(e){var message,transaction,data=e.data;if(data==="\r\n"){if(this.ua.configuration.trace_sip===true){this.logger.debug("received WebSocket message with CRLF Keep Alive response")}return}else if(typeof data!=="string"){try{data=String.fromCharCode.apply(null,new Uint8Array(data))}catch(evt){this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded");return}if(this.ua.configuration.trace_sip===true){this.logger.debug("received WebSocket binary message:\n\n"+data+"\n")}}else{this.logger.log("onMessage : "+this.ua.configuration.trace_sip);if(this.ua.configuration.trace_sip===true){this.logger.debug("received WebSocket text message:\n\n"+data+"\n")}}message=Parser.parseMessage(data,this.ua);if(!message){return}if(this.ua.status===UA.C.STATUS_USER_CLOSED&&message instanceof SIPMessage.IncomingRequest){return}if(!sanityCheck(message,this.ua,this)){return}if(message instanceof SIPMessage.IncomingRequest){message.transport=this;this.ua.receiveRequest(message)}else if(message instanceof SIPMessage.IncomingResponse){switch(message.method){case ExSIP_C.INVITE:transaction=this.ua.transactions.ict[message.via_branch];if(transaction){transaction.receiveResponse(message)}break;case ExSIP_C.ACK:break;default:transaction=this.ua.transactions.nict[message.via_branch];if(transaction){transaction.receiveResponse(message)}break}}},onError:function(e){this.logger.warn("WebSocket connection error: "+e)},reConnect:function(){var transport=this;this.reconnection_attempts+=1;if(this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection){this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.ws_uri);this.ua.onTransportError(this)}else{this.logger.log("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"+" (reconnection timeout "+this.ua.configuration.ws_server_reconnection_timeout+")");if(this.ua.configuration.ws_server_reconnection_timeout===0){transport.connect()}else{this.reconnectTimer=setTimeout(function(){transport.connect();transport.reconnectTimer=null},this.ua.configuration.ws_server_reconnection_timeout*1e3)}}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Constants":22,"./Parser":34,"./SIPMessage":41,"./UA":45,"./sanityCheck":49,ws:20}],45:[function(require,module,exports){module.exports=UA;var C={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};UA.C=C;var ExSIP_C=require("./Constants");var LoggerFactory=require("./LoggerFactory");var EventEmitter=require("./EventEmitter");var Registrator=require("./Registrator");var RTCSession=require("./RTCSession");var Message=require("./Message");var Transport=require("./Transport");var Transactions=require("./Transactions");var Transactions=require("./Transactions");var Utils=require("./Utils");var WebRTC=require("./WebRTC");var Exceptions=require("./Exceptions");var URI=require("./URI");var Grammar=require("./Grammar");var Utils=require("./Utils");function UA(configuration){var events=["connecting","connected","disconnected","newTransaction","transactionDestroyed","registered","unregistered","registrationFailed","newRTCSession","newMessage","onReInvite"];this.log=new LoggerFactory;this.logger=this.getLogger("ua");this.usedServers=[];this.rtcMediaHandlerOptions={};this.cache={credentials:{}};this.configuration={};this.dynConfiguration={};this.dialogs={};this.applicants={};this.sessions={};this.transport=null;this.contact=null;this.status=C.STATUS_INIT;this.error=null;this.transactions={nist:{},nict:{},ist:{},ict:{}};this.data={};this.transportRecoverAttempts=0;this.transportRecoveryTimer=null;Object.defineProperties(this,{transactionsCount:{get:function(){var type,transactions=["nist","nict","ist","ict"],count=0;for(type in transactions){count+=Object.keys(this.transactions[transactions[type]]).length}return count}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}});if(configuration===undefined){throw new TypeError("Not enough arguments")}if(configuration.log){if(configuration.log.hasOwnProperty("builtinEnabled")){this.log.builtinEnabled=configuration.log.builtinEnabled}if(configuration.log.hasOwnProperty("level")){this.log.level=configuration.log.level}if(configuration.log.hasOwnProperty("connector")){this.log.connector=configuration.log.connector}}try{this.loadConfig(configuration);this.initEvents(events)}catch(e){this.status=C.STATUS_NOT_READY;this.error=C.CONFIGURATION_ERROR;throw e}this._registrator=new Registrator(this)}UA.prototype=new EventEmitter;UA.prototype.isDebug=function(){return this.configuration.trace_sip===true};UA.prototype.isRegistered=function(){if(this._registrator&&this._registrator.registered){return true}else{return false}};UA.prototype.isConnected=function(){if(this.transport){return this.transport.connected}else{return false}};UA.prototype.transfer=function(transferTarget,sessionToTransfer,options){var self=this;this.logger.log("transfer : "+transferTarget+" : options : "+Utils.toString(options));transferTarget=Utils.normalizeTarget(transferTarget,this.configuration.hostport_params);if(!transferTarget){sessionToTransfer.failed("local",null,ExSIP_C.causes.INVALID_TARGET);this.logger.warn("invalid transfer target");return}var holdFailed=function(){self.logger.log("transfer : hold failed")};var holdSuccess=function(){self.logger.log("transfer : hold success - sending refer to transferee");self.sendReferBasic(sessionToTransfer,transferTarget,options)};self.logger.log("transfer : holding session to transfer");sessionToTransfer.hold(holdSuccess,holdFailed)};UA.prototype.attendedTransfer=function(transferTarget,sessionToTransfer,options){var self=this;this.logger.log("attended transfer : "+transferTarget+" : options : "+Utils.toString(options));transferTarget=Utils.normalizeTarget(transferTarget,this.configuration.hostport_params);if(!transferTarget){this.logger.warn("invalid transfer target");sessionToTransfer.failed("local",null,ExSIP_C.causes.INVALID_TARGET);return}var targetSession=self.newSession(options);targetSession.rtcMediaHandler.copy(sessionToTransfer.rtcMediaHandler);var holdTargetSuccess=function(){self.logger.log("transfer : hold target success - sending attended refer");self.sendReferAttended(sessionToTransfer,targetSession,transferTarget,options)};var holdTargetFailed=function(){self.logger.log("transfer : hold target failed")};var sendTargetInviteSuccess=function(){self.logger.log("transfer : send invite to target success - putting target on hold");targetSession.hold(holdTargetSuccess,holdTargetFailed)};var sendTargetInviteFailed=function(response){self.logger.log("transfer : send invite to target failed - sending basic refer");if(response.status_code===420){self.sendReferBasic(sessionToTransfer,transferTarget,options)}};var holdFailed=function(){self.logger.log("transfer : hold failed")};var holdSuccess=function(){self.logger.log("transfer : hold success - sending invite to target");targetSession.sendInviteRequest(transferTarget,{extraHeaders:["Require: replaces"]},sendTargetInviteSuccess,sendTargetInviteFailed)};self.logger.log("transfer : holding session to transfer");sessionToTransfer.hold(holdSuccess,holdFailed)};UA.prototype.sendReferAttended=function(sessionToTransfer,targetSession,transferTarget,options){var referSession=this.getReferSession(sessionToTransfer,options);options=this.getReferOptions(sessionToTransfer,targetSession,options);var referTo="<"+transferTarget.toString()+"?Replaces="+targetSession.dialog.id.call_id+"%3Bto-tag%3D"+targetSession.dialog.id.remote_tag+"%3Bfrom-tag%3D"+targetSession.dialog.id.local_tag+">";options.extraHeaders.push("Refer-To: "+referTo);referSession.sendReferRequest(sessionToTransfer,options)};UA.prototype.processRefer=function(sessionToTransfer,referRequest){var self=this;referRequest.reply(202);var notifySuccess=function(){self.logger.log("Notify successful")};var notifyFailure=function(){self.logger.log("Notify failed")};sessionToTransfer.sendNotifyRequest({sdp:"SIP/2.0 100 Trying"},notifySuccess,notifyFailure)};UA.prototype.sendReferBasic=function(sessionToTransfer,transferTarget,options){var referSession=this.getReferSession(sessionToTransfer,options);options=this.getReferOptions(sessionToTransfer,sessionToTransfer,options);options.extraHeaders.push("Refer-To: <"+transferTarget+">");this.logger.debug("refer options : "+JSON.stringify(options));referSession.sendReferRequest(sessionToTransfer,options)};UA.prototype.getReferOptions=function(sessionToTransfer,targetDialogSession,options){options=options||{};options.extraHeaders=options.extraHeaders||[];if(sessionToTransfer.supports("tdialog")){options.extraHeaders.push("Require: tdialog");var localTag=targetDialogSession.dialog.isUAS()?targetDialogSession.dialog.id.remote_tag:targetDialogSession.dialog.id.local_tag;var remoteTag=targetDialogSession.dialog.isUAS()?targetDialogSession.dialog.id.local_tag:targetDialogSession.dialog.id.remote_tag;var targetDialog=targetDialogSession.dialog.id.call_id+";local-tag="+localTag+";remote-tag="+remoteTag;options.extraHeaders.push("Target-Dialog: "+targetDialog)}return options};UA.prototype.getReferSession=function(sessionToTransfer,options){if(sessionToTransfer.supports("tdialog")){return this.newSession(options)}else{this.logger.warn("tdialog not supported - sending refer in same session : "+sessionToTransfer.id,this);return sessionToTransfer}};UA.prototype.newSession=function(options){var session=new RTCSession(this);session.initRtcMediaHandler(options);return session};UA.prototype.getUserMedia=function(options,success,failure,force){if(!force&&this.localMedia){return this.localMedia}if(this.localMedia){this.logger.log("stopping existing local media stream",this);this.localMedia.stop()}this.logger.log("options : "+Utils.toString(options),this);var self=this;var constraints=options.mediaConstraints||{audio:true,video:true};WebRTC.getUserMedia(constraints,function(stream){self.logger.log("got local media stream",self);self.localMedia=stream;success(stream)},function(e){self.logger.error("unable to get user media");self.logger.error(e);failure(e)})};UA.prototype.stop=function(){var session,applicant,ua=this;this.logger.log("user requested closure...");this.dynConfiguration={};if(this.status===C.STATUS_USER_CLOSED){this.logger.warn("UA already closed");return}clearTimeout(this.transportRecoveryTimer);if(this._registrator){this.logger.debug("closing registrator");this._registrator.close()}var num_sessions=Object.keys(this.sessions).length;for(session in this.sessions){this.logger.log("closing session "+session,this);this.sessions[session].terminate()}for(applicant in this.applicants){this.applicants[applicant].close()}this.status=C.STATUS_USER_CLOSED;if(this.nistTransactionsCount===0&&this.nictTransactionsCount===0&&num_sessions===0){ua.transport.disconnect()}else{setTimeout(function(){ua.transport.disconnect()},2e3)}};UA.prototype.reconnect=function(){this.logger.debug("************** reconnect");this.stop();this.status=C.STATUS_INIT;this.start()};UA.prototype.start=function(){var server;this.logger.debug("user requested startup... : ",this.status);if(this.status===C.STATUS_INIT){server=this.getNextWsServer({force:true});this.transport=new Transport(this,server);this.transport.connect()}else if(this.status===C.STATUS_USER_CLOSED){this.logger.log("resuming");this.status=C.STATUS_READY;this.transport.connect()}else if(this.status===C.STATUS_READY){this.logger.log("UA is in READY status, not resuming")}else{this.logger.error("Connection is down. Auto-Recovery system is trying to connect")}this.dynConfiguration.register=this.configuration.register};UA.prototype.register=function(){this.dynConfiguration.register=true;this._registrator.register()};UA.prototype.unregister=function(options){this.dynConfiguration.register=false;this._registrator.unregister(options)};UA.prototype.registrator=function(){return this._registrator};UA.prototype.isRegistered=function(){if(this._registrator.registered){return true}else{return false}};UA.prototype.isConnected=function(){if(this.transport){return this.transport.connected}else{return false}};UA.prototype.call=function(target,options){var session;session=new RTCSession(this);session.connect(target,options);return session};UA.prototype.sendMessage=function(target,body,options){var message;message=new Message(this);message.send(target,body,options)};UA.prototype.normalizeTarget=function(target){return Utils.normalizeTarget(target,this.configuration.hostport_params)};UA.prototype.setRtcMediaHandlerOptions=function(rtcMediaHandlerOptions){this.rtcMediaHandlerOptions=rtcMediaHandlerOptions};UA.prototype.rtcConstraints=function(){return this.rtcMediaHandlerOptions?this.rtcMediaHandlerOptions.RTCConstraints:false};UA.prototype.reuseLocalMedia=function(){return this.rtcMediaHandlerOptions?this.rtcMediaHandlerOptions.reuseLocalMedia:false};UA.prototype.saveCredentials=function(credentials){this.cache.credentials[credentials.realm]=this.cache.credentials[credentials.realm]||{};this.cache.credentials[credentials.realm][credentials.uri]=credentials};UA.prototype.getCredentials=function(request){var realm,credentials;realm=request.ruri.host;if(this.cache.credentials[realm]&&this.cache.credentials[realm][request.ruri]){credentials=this.cache.credentials[realm][request.ruri];credentials.method=request.method}return credentials};UA.prototype.getLogger=function(category,label){return this.log.getLogger(category,label)};UA.prototype.onTransportClosed=function(transport){var type,idx,length,client_transactions=["nict","ict","nist","ist"];transport.server.status=Transport.C.STATUS_DISCONNECTED;this.logger.log("connection state set to "+Transport.C.STATUS_DISCONNECTED,this);length=client_transactions.length;for(type=0;type<length;type++){for(idx in this.transactions[client_transactions[type]]){this.transactions[client_transactions[type]][idx].onTransportError()}}if(!this.contact.pub_gruu){this.closeSessionsOnTransportError()}};UA.prototype.onTransportError=function(transport,options){options=options||{};if(this.status===C.STATUS_USER_CLOSED){return}this.logger.log("transport "+transport.server.ws_uri+" failed | connection state set to "+Transport.C.STATUS_ERROR,this);transport.server.status=Transport.C.STATUS_ERROR;this.closeSessionsOnTransportError();if(!this.error||this.error!==C.NETWORK_ERROR){this.status=C.STATUS_NOT_READY;this.error=C.NETWORK_ERROR}this.recoverTransport(options);var data=Utils.merge_options({transport:transport,code:transport.lastTransportError.code,reason:transport.lastTransportError.reason},options);this.emit("disconnected",this,data)};UA.prototype.onTransportConnected=function(transport){this.transport=transport;this.transportRecoverAttempts=0;transport.server.status=Transport.C.STATUS_READY;this.logger.log("connection state set to "+Transport.C.STATUS_READY,this);if(this.status===C.STATUS_USER_CLOSED){return}this.status=C.STATUS_READY;this.error=null;this.emit("connected",this,{transport:transport});if(this.dynConfiguration.register){if(this._registrator){this._registrator.onTransportConnected()}else{this._registrator=new Registrator(this,transport);this.register()}}else if(!this._registrator){this._registrator=new Registrator(this,transport)}};UA.prototype.onTransportConnecting=function(transport,attempts){this.emit("connecting",this,{transport:transport,attempts:attempts})};UA.prototype.newTransaction=function(transaction){this.transactions[transaction.type][transaction.id]=transaction;this.emit("newTransaction",this,{transaction:transaction})};UA.prototype.destroyTransaction=function(transaction){delete this.transactions[transaction.type][transaction.id];this.emit("transactionDestroyed",this,{transaction:transaction})};UA.prototype.receiveRequest=function(request){var dialog,session,message,method=request.method;if(request.ruri.user!==this.configuration.uri.user&&request.ruri.user!==this.contact.uri.user){this.logger.warn("Request-URI ("+request.ruri.user+") does not point to us ("+this.configuration.uri.user+")",this);if(request.method!==ExSIP_C.ACK){request.reply_sl(404)}return}if(request.ruri.scheme===ExSIP_C.SIPS){request.reply_sl(416);return}if(Transactions.checkTransaction(this,request)){this.logger.warn("Check Transaction failed",this);return}if(method===ExSIP_C.INVITE){new Transactions.InviteServerTransaction(request,this)}else if(method!==ExSIP_C.ACK&&method!==ExSIP_C.CANCEL){new Transactions.NonInviteServerTransaction(request,this)}if(method===ExSIP_C.OPTIONS){request.reply(200)}else if(method===ExSIP_C.MESSAGE){if(!this.checkEvent("newMessage")||this.listeners("newMessage").length===0){request.reply(405);return}message=new Message(this);message.init_incoming(request)}else if(method===ExSIP_C.INVITE){if(!this.checkEvent("newRTCSession")||this.listeners("newRTCSession").length===0){request.reply(405);return}}if(!request.to_tag){switch(method){case ExSIP_C.INVITE:if(WebRTC.isSupported){this.logger.debug("INVITE received",this);session=new RTCSession(this);session.init_incoming(request)}else{this.logger.warn("INVITE received but WebRTC is not supported",this);request.reply(488)}break;case ExSIP_C.BYE:request.reply(481);break;case ExSIP_C.CANCEL:session=this.findSession(request);if(session){session.receiveRequest(request)}else{this.logger.warn("received CANCEL request for a non existent session",this)}break;case ExSIP_C.ACK:break;default:request.reply(405);break}}else{dialog=this.findDialog(request);if(dialog){dialog.receiveRequest(request)}else if(method===ExSIP_C.NOTIFY){session=this.findSession(request);if(session){this.logger.log("received NOTIFY request for session : "+session.id,this);session.receiveRequest(request)}else{this.logger.warn("received NOTIFY request for a non existent session",this);this.logger.log("request : "+(request.call_id+"-"+request.from_tag+"-"+request.to_tag),this);this.logger.log("sessions : "+Object.keys(this.sessions),this);request.reply(481,"Subscription does not exist")}}else{if(method!==ExSIP_C.ACK){request.reply(481)}}}};UA.prototype.findSession=function(request){var sessionIDa=request.call_id+request.from_tag,sessionA=this.sessions[sessionIDa],sessionIDb=request.call_id+request.to_tag,sessionB=this.sessions[sessionIDb];if(sessionA){return sessionA}else if(sessionB){return sessionB}else{return null}};UA.prototype.findDialog=function(request){var id=request.call_id+request.from_tag+request.to_tag,dialog=this.dialogs[id];if(dialog){return dialog}else{id=request.call_id+request.to_tag+request.from_tag;dialog=this.dialogs[id];if(dialog){return dialog}else{return null}}};UA.prototype.getNextWsServer=function(options){options=options||{};if(options.force&&this.usedServers.length>=this.configuration.ws_servers.length){this.usedServers=[]}var candidates=[];var totalWeight=0;for(var i=0;i<this.configuration.ws_servers.length;i++){var server=this.configuration.ws_servers[i];if(server.status===Transport.C.STATUS_READY&&this.usedServers.indexOf(server)===-1){candidates.push(server);totalWeight+=server.weight||1}}var weightedServers=[];for(var j=0;j<candidates.length;j++){var candidate=candidates[j];for(var k=0;k<(candidate.weight||1);k++){weightedServers.push(candidate)}}var randomNumber=Math.floor(Math.random()*totalWeight);var index=Math.min(randomNumber,weightedServers.length-1);return weightedServers[index]};UA.prototype.closeSessionsOnTransportError=function(){var idx;for(idx in this.sessions){this.sessions[idx].onTransportError()}this._registrator.onTransportClosed()};UA.prototype.loadConfig=function(configuration){var parameter,value,checked_value,hostport_params,registrar_server,settings={via_host:Utils.createRandomToken(12)+".invalid",password:null,register_expires:600,register:true,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,use_preloaded_route:false,no_answer_timeout:60,stun_servers:["stun:stun.l.google.com:19302"],turn_servers:[],trace_sip:false,hack_via_tcp:false,hack_via_ws:false,hack_ip_in_contact:false,enable_datachannel:false,enable_ims:false,p_asserted_identity:null,node_ws_options:{}};for(parameter in UA.configuration_check.mandatory){if(!configuration.hasOwnProperty(parameter)){throw new Exceptions.ConfigurationError(parameter)}else{value=configuration[parameter];checked_value=UA.configuration_check.mandatory[parameter].call(this,value);if(checked_value!==undefined){settings[parameter]=checked_value}else{throw new Exceptions.ConfigurationError(parameter,value)}}}for(parameter in UA.configuration_check.optional){if(configuration.hasOwnProperty(parameter)){value=configuration[parameter];if(Utils.isEmpty(value)){continue}checked_value=UA.configuration_check.optional[parameter].call(this,value);if(checked_value!==undefined){settings[parameter]=checked_value}else{throw new Exceptions.ConfigurationError(parameter,value)}}}if(settings.connection_recovery_max_interval<settings.connection_recovery_min_interval){throw new Exceptions.ConfigurationError("connection_recovery_max_interval",settings.connection_recovery_max_interval)}if(settings.display_name===0){settings.display_name="0"}if(!settings.instance_id){settings.instance_id=Utils.newUUID()}settings.exsip_id=Utils.createRandomToken(5);hostport_params=settings.uri.clone();hostport_params.user=null;settings.hostport_params=hostport_params.toString().replace(/^sip:/i,"");if(!settings.authorization_user){settings.authorization_user=settings.uri.user}if(!settings.registrar_server){registrar_server=settings.uri.clone();registrar_server.user=null;settings.registrar_server=registrar_server}settings.no_answer_timeout=settings.no_answer_timeout*1e3;if(settings.hack_ip_in_contact){settings.via_host=Utils.getRandomTestNetIP()}value=configuration.stun_servers;if(value instanceof Array&&value.length===0){settings.stun_servers=[]}this.contact={pub_gruu:null,temp_gruu:null,uri:new URI("sip",Utils.createRandomToken(8),settings.via_host,null,{transport:"ws"}),toString:function(options){options=options||{};var anonymous=options.anonymous||null,outbound=options.outbound||null,contact="<";if(anonymous){contact+=this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws"}else{contact+=this.pub_gruu||this.uri.toString()}if(outbound&&(anonymous?!this.temp_gruu:!this.pub_gruu)){contact+=";ob"}contact+=">";return contact}};for(parameter in settings){UA.configuration_skeleton[parameter].value=settings[parameter]}Object.defineProperties(this.configuration,UA.configuration_skeleton);for(parameter in settings){UA.configuration_skeleton[parameter].value=""}this.logger.debug("configuration parameters after validation:");for(parameter in settings){switch(parameter){case"uri":case"registrar_server":this.logger.debug("· "+parameter+": "+settings[parameter]);break;case"password":this.logger.debug("· "+parameter+": "+"NOT SHOWN");break;default:this.logger.debug("· "+parameter+": "+JSON.stringify(settings[parameter]))}}return};UA.prototype.retry=function(nextRetry,server,callback){var self=this;var retryCallback=function(){var transport=new Transport(self,server);if(callback){callback(transport)}};if(nextRetry===0){retryCallback()}else{setTimeout(retryCallback,nextRetry*1e3)}};UA.prototype.recoverTransport=function(options){var idx,length,k,nextRetry,count,server;options=options||{};count=this.transportRecoverAttempts;length=this.configuration.ws_servers.length;for(idx=0;idx<length;idx++){this.configuration.ws_servers[idx].status=Transport.C.STATUS_READY}server=this.getNextWsServer();if(options.code===503&&!server){delete options.retryAfter;this.logger.log("non-failover on 503 error - skipping recoverTransport",this);return}var maxTransportRecoveryAttempts=this.configuration.max_transport_recovery_attempts;if(typeof maxTransportRecoveryAttempts!=="undefined"&&count>=parseInt(maxTransportRecoveryAttempts,10)){delete options.retryAfter;this.logger.log("recover attempts "+count+" exceed max transport recovery attempts "+maxTransportRecoveryAttempts+" - skipping recoverTransport");return}if(server){this.logger.log("failover - new connection attempt with "+server.ws_uri);this.retry(0,server,options.retryCallback);return}if(options.retryAfter){nextRetry=options.retryAfter}else{k=Math.floor(Math.random()*Math.pow(2,count)+1);nextRetry=k*this.configuration.connection_recovery_min_interval;if(nextRetry>this.configuration.connection_recovery_max_interval){this.logger.log("time for next connection attempt exceeds connection_recovery_max_interval, resetting counter",this);nextRetry=this.configuration.connection_recovery_min_interval;count=0}}server=this.getNextWsServer({force:true});this.transportRecoverAttempts=count+1;this.logger.log("resetting ws server list - next connection attempt in "+nextRetry+" seconds to "+server.ws_uri+" : "+this.transportRecoverAttempts);this.retry(nextRetry,server,options.retryCallback)};UA.configuration_skeleton=function(){var idx,parameter,skeleton={},parameters=["exsip_id","ws_server_max_reconnection","ws_server_reconnection_timeout","hostport_params","uri","ws_servers","authorization_user","connection_recovery_max_interval","connection_recovery_min_interval","max_transport_recovery_attempts","display_name","hack_via_tcp","hack_via_ws","hack_ip_in_contact","instance_id","no_answer_timeout","node_ws_options","password","register_expires","registrar_server","stun_servers","trace_sip","turn_servers","use_preloaded_route","enable_datachannel","enable_ims","p_asserted_identity","via_core_value","via_host"];for(idx in parameters){parameter=parameters[idx];skeleton[parameter]={value:"",writable:false,configurable:false}}skeleton.register={value:"",writable:true,configurable:false};return skeleton}();UA.configuration_check={mandatory:{uri:function(uri){var parsed;if(!/^sip:/i.test(uri)){uri=ExSIP_C.SIP+":"+uri}parsed=URI.parse(uri);if(!parsed){return}else if(!parsed.user){return}else{return parsed}},ws_servers:function(ws_servers){var idx,length,url;if(typeof ws_servers==="string"){ws_servers=[{ws_uri:ws_servers}]}else if(ws_servers instanceof Array){length=ws_servers.length;for(idx=0;idx<length;idx++){if(typeof ws_servers[idx]==="string"){ws_servers[idx]={ws_uri:ws_servers[idx]}}}}else{return}if(ws_servers.length===0){return false}length=ws_servers.length;for(idx=0;idx<length;idx++){if(!ws_servers[idx].ws_uri){this.logger.error('missing "ws_uri" attribute in ws_servers parameter');return}if(ws_servers[idx].weight&&!Number(ws_servers[idx].weight)){this.logger.error('"weight" attribute in ws_servers parameter must be a Number');return}url=Grammar.parse(ws_servers[idx].ws_uri,"absoluteURI");if(url===-1){this.logger.error('invalid "ws_uri" attribute in ws_servers parameter: '+ws_servers[idx].ws_uri);return}else if(url.scheme!=="wss"&&url.scheme!=="ws"){this.logger.error("invalid URI scheme in ws_servers parameter: "+url.scheme);return}else{ws_servers[idx].sip_uri="<sip:"+url.host+(url.port?":"+url.port:"")+";transport=ws;lr>";if(!ws_servers[idx].weight){ws_servers[idx].weight=0}ws_servers[idx].status=0;ws_servers[idx].scheme=url.scheme.toUpperCase()}}return ws_servers}},optional:{authorization_user:function(authorization_user){if(Grammar.parse('"'+authorization_user+'"',"quoted_string")===-1){return}else{return authorization_user}},connection_recovery_max_interval:function(connection_recovery_max_interval){var value;if(Utils.isDecimal(connection_recovery_max_interval)){value=Number(connection_recovery_max_interval);if(value>0){return value}}},connection_recovery_min_interval:function(connection_recovery_min_interval){var value;if(Utils.isDecimal(connection_recovery_min_interval)){value=Number(connection_recovery_min_interval);if(value>=0){return value}}},display_name:function(display_name){if(Grammar.parse('"'+display_name+'"',"display_name")===-1){return}else{return display_name}},hack_via_tcp:function(hack_via_tcp){if(typeof hack_via_tcp==="boolean"){return hack_via_tcp}},hack_via_ws:function(hack_via_ws){if(typeof hack_via_ws==="boolean"){return hack_via_ws}},hack_ip_in_contact:function(hack_ip_in_contact){if(typeof hack_ip_in_contact==="boolean"){return hack_ip_in_contact}},enable_ims:function(enable_ims){if(typeof enable_ims==="boolean"){return enable_ims}},ws_server_reconnection_timeout:function(ws_server_reconnection_timeout){var value;if(Utils.isDecimal(ws_server_reconnection_timeout)){value=Number(ws_server_reconnection_timeout);if(value>=0){return value}}},max_transport_recovery_attempts:function(max_transport_recovery_attempts){var value;if(Utils.isDecimal(max_transport_recovery_attempts)){value=Number(max_transport_recovery_attempts);if(value>=0){return value}}},p_asserted_identity:function(p_asserted_identity){return String(p_asserted_identity)
},enable_datachannel:function(enable_datachannel){if(typeof enable_datachannel==="boolean"){return enable_datachannel}},instance_id:function(instance_id){if(/^uuid:/i.test(instance_id)){instance_id=instance_id.substr(5)}if(Grammar.parse(instance_id,"uuid")===-1){return}else{return instance_id}},no_answer_timeout:function(no_answer_timeout){var value;if(Utils.isDecimal(no_answer_timeout)){value=Number(no_answer_timeout);if(value>0){return value}}},node_ws_options:function(node_ws_options){return typeof node_ws_options==="object"?node_ws_options:{}},password:function(password){return String(password)},register:function(register){if(typeof register==="boolean"){return register}},register_expires:function(register_expires){var value;if(Utils.isDecimal(register_expires)){value=Number(register_expires);if(value>0){return value}}},registrar_server:function(registrar_server){var parsed;if(!/^sip:/i.test(registrar_server)){registrar_server=ExSIP_C.SIP+":"+registrar_server}parsed=URI.parse(registrar_server);if(!parsed){return}else if(parsed.user){return}else{return parsed}},stun_servers:function(stun_servers){var idx,length,stun_server;if(typeof stun_servers==="string"){stun_servers=[stun_servers]}else if(!(stun_servers instanceof Array)){return}length=stun_servers.length;for(idx=0;idx<length;idx++){stun_server=stun_servers[idx];if(!/^stuns?:/.test(stun_server)){stun_server="stun:"+stun_server}if(Grammar.parse(stun_server,"stun_URI")===-1){return}else{stun_servers[idx]=stun_server}}return stun_servers},trace_sip:function(trace_sip){if(typeof trace_sip==="boolean"){return trace_sip}},turn_servers:function(turn_servers){var idx,idx2,length,length2,turn_server,url;if(!turn_servers instanceof Array){turn_servers=[turn_servers]}length=turn_servers.length;for(idx=0;idx<length;idx++){turn_server=turn_servers[idx];if(turn_server.server){turn_server.urls=[turn_server.server]}if(turn_server.password){turn_server.credential=[turn_server.password]}if(!turn_server.urls||!turn_server.username||!turn_server.credential){return}if(!(turn_server.urls instanceof Array)){turn_server.urls=[turn_server.urls]}length2=turn_server.urls.length;for(idx2=0;idx2<length2;idx2++){url=turn_server.urls[idx2];if(!/^turns?:/.test(url)){url="turn:"+url}if(Grammar.parse(url,"turn_URI")===-1){return}}}return turn_servers},use_preloaded_route:function(use_preloaded_route){if(typeof use_preloaded_route==="boolean"){return use_preloaded_route}}}}},{"./Constants":22,"./EventEmitter":26,"./Exceptions":28,"./Grammar":29,"./LoggerFactory":31,"./Message":32,"./RTCSession":35,"./Registrator":39,"./Transactions":43,"./Transport":44,"./URI":46,"./Utils":47,"./WebRTC":48}],46:[function(require,module,exports){module.exports=URI;var ExSIP_C=require("./Constants");var Utils=require("./Utils");var Grammar=require("./Grammar");function URI(scheme,user,host,port,parameters,headers){var param,header;if(!host){throw new TypeError('missing or invalid "host" parameter')}scheme=scheme||ExSIP_C.SIP;this.parameters={};this.headers={};for(param in parameters){this.setParam(param,parameters[param])}for(header in headers){this.setHeader(header,headers[header])}Object.defineProperties(this,{scheme:{get:function(){return scheme},set:function(value){scheme=value.toLowerCase()}},user:{get:function(){return user},set:function(value){user=value}},host:{get:function(){return host},set:function(value){host=value.toLowerCase()}},port:{get:function(){return port},set:function(value){port=value===0?value:parseInt(value,10)||null}}})}URI.prototype={setParam:function(key,value){if(key){this.parameters[key.toLowerCase()]=typeof value==="undefined"||value===null?null:value.toString().toLowerCase()}},getParam:function(key){if(key){return this.parameters[key.toLowerCase()]}},hasParam:function(key){if(key){return this.parameters.hasOwnProperty(key.toLowerCase())&&true||false}},deleteParam:function(parameter){var value;parameter=parameter.toLowerCase();if(this.parameters.hasOwnProperty(parameter)){value=this.parameters[parameter];delete this.parameters[parameter];return value}},clearParams:function(){this.parameters={}},setHeader:function(name,value){this.headers[Utils.headerize(name)]=value instanceof Array?value:[value]},getHeader:function(name){if(name){return this.headers[Utils.headerize(name)]}},hasHeader:function(name){if(name){return this.headers.hasOwnProperty(Utils.headerize(name))&&true||false}},deleteHeader:function(header){var value;header=Utils.headerize(header);if(this.headers.hasOwnProperty(header)){value=this.headers[header];delete this.headers[header];return value}},clearHeaders:function(){this.headers={}},isPhoneNumber:function(){return this.user&&this.user.match(/^\+?\d+$/)!==null},clone:function(){return new URI(this.scheme,this.user,this.host,this.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toString:function(){var header,parameter,idx,uri,headers=[];uri=this.scheme+":";if(this.user){uri+=Utils.escapeUser(this.user)+"@"}uri+=this.host;if(this.port||this.port===0){uri+=":"+this.port}for(parameter in this.parameters){uri+=";"+parameter;if(this.parameters[parameter]!==null){uri+="="+this.parameters[parameter]}}for(header in this.headers){for(idx in this.headers[header]){headers.push(header+"="+this.headers[header][idx])}}if(headers.length>0){uri+="?"+headers.join("&")}return uri},toAor:function(show_port){var aor;aor=this.scheme+":";if(this.user){aor+=Utils.escapeUser(this.user)+"@"}aor+=this.host;if(show_port&&(this.port||this.port===0)){aor+=":"+this.port}return aor}};URI.parse=function(uri){uri=Grammar.parse(uri,"SIP_URI");if(uri!==-1){return uri}else{return undefined}}},{"./Constants":22,"./Grammar":29,"./Utils":47}],47:[function(require,module,exports){var Utils={};module.exports=Utils;var ExSIP_C=require("./Constants");var URI=require("./URI");var Grammar=require("./Grammar");Utils.inArray=function(array,el){for(var i=array.length;i--;){if(array[i]===el){return true}}return false};Utils.isEqArrays=function(arr1,arr2){if(arr1===null&&arr2!==null){return false}if(arr1!==null&&arr2===null){return false}if(arr1===null&&arr2===null){return true}if(arr1.length!==arr2.length){return false}for(var i=arr1.length;i--;){if(!this.inArray(arr2,arr1[i])){return false}}return true};Utils.merge_options=function(obj1,obj2){var obj3={};for(var attrname1 in obj1){obj3[attrname1]=obj1[attrname1]}for(var attrname2 in obj2){obj3[attrname2]=obj2[attrname2]}return obj3};Utils.containsHeader=function(headers,name){for(var i=0;i<headers.length;i++){if(headers[i].indexOf(name)!==-1){return true}}return false};Utils.str_utf8_length=function(string){return unescape(encodeURIComponent(string)).length};Utils.toString=function(object){var seen=[];return JSON.stringify(object,function(key,val){if(typeof val==="object"){if(seen.indexOf(val)>=0){return}seen.push(val)}return val})};Utils.isFunction=function(fn){if(fn!==undefined){return Object.prototype.toString.call(fn)==="[object Function]"?true:false}else{return false}};Utils.isDecimal=function(num){return!isNaN(num)&&parseFloat(num)===parseInt(num,10)};Utils.getHeadersFromQuery=function(query){var headers=[];var queryParts=query.split("&");for(var i=0;i<queryParts.length;i++){var parameters=queryParts[i].split("=");headers.push(parameters[0]+": "+decodeURIComponent(parameters[1]))}return headers};Utils.stripSip=function(address){var match=address.match(/<sip\:(.*)\>/);return match?match[1]:address};Utils.isEmpty=function(value){if(value===null||value===""||value===undefined||value instanceof Array&&value.length===0||typeof value==="number"&&isNaN(value)){return true}};Utils.getAllowedMethods=function(ua){var event,allowed=ExSIP_C.ALLOWED_METHODS.toString();for(event in ExSIP_C.EVENT_METHODS){if(ua.checkEvent(event)&&ua.listeners(event).length>0){allowed+=","+ExSIP_C.EVENT_METHODS[event]}}return allowed};Utils.createRandomToken=function(size,base){var i,r,token="";base=base||32;for(i=0;i<size;i++){r=Math.random()*base|0;token+=r.toString(base)}return token};Utils.newTag=function(){return Utils.createRandomToken(10)};Utils.newUUID=function(){var UUID="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==="x"?r:r&3|8;return v.toString(16)});return UUID};Utils.hostType=function(host){if(!host){return}else{host=Grammar.parse(host,"host");if(host!==-1){return host.host_type}}};Utils.normalizeTarget=function(target,domain){var uri,target_array,target_user,target_domain;if(!target){return}else if(target instanceof URI){return target}else if(typeof target==="string"){target_array=target.split("@");switch(target_array.length){case 1:if(!domain){return}target_user=target;target_domain=domain;break;case 2:target_user=target_array[0];target_domain=target_array[1];break;default:target_user=target_array.slice(0,target_array.length-1).join("@");target_domain=target_array[target_array.length-1]}target_user=target_user.replace(/^(sips?|tel):/i,"");if(/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(target_user)){target_user=target_user.replace(/[\-\.\(\)]/g,"")}target=ExSIP_C.SIP+":"+Utils.escapeUser(target_user)+"@"+target_domain;if(uri=URI.parse(target)){return uri}else{return}}else{return}};Utils.escapeUser=function(user){return encodeURIComponent(decodeURIComponent(user)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")};Utils.headerize=function(string){var exceptions={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},name=string.toLowerCase().replace(/_/g,"-").split("-"),hname="",parts=name.length,part;for(part=0;part<parts;part++){if(part!==0){hname+="-"}hname+=name[part].charAt(0).toUpperCase()+name[part].substring(1)}if(exceptions[hname]){hname=exceptions[hname]}return hname};Utils.sipErrorCause=function(status_code){var cause;for(cause in ExSIP_C.SIP_ERROR_CAUSES){if(ExSIP_C.SIP_ERROR_CAUSES[cause].indexOf(status_code)!==-1){return ExSIP_C.causes[cause]}}return ExSIP_C.causes.SIP_FAILURE_CODE};Utils.getRandomTestNetIP=function(){function getOctet(from,to){return Math.floor(Math.random()*(to-from+1)+from)}return"192.0.2."+getOctet(1,254)};Utils.calculateMD5=function(string){function rotateLeft(lValue,iShiftBits){return lValue<<iShiftBits|lValue>>>32-iShiftBits}function addUnsigned(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=lX&2147483648;lY8=lY&2147483648;lX4=lX&1073741824;lY4=lY&1073741824;lResult=(lX&1073741823)+(lY&1073741823);if(lX4&lY4){return lResult^2147483648^lX8^lY8}if(lX4|lY4){if(lResult&1073741824){return lResult^3221225472^lX8^lY8}else{return lResult^1073741824^lX8^lY8}}else{return lResult^lX8^lY8}}function doF(x,y,z){return x&y|~x&z}function doG(x,y,z){return x&z|y&~z}function doH(x,y,z){return x^y^z}function doI(x,y,z){return y^(x|~z)}function doFF(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(doF(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)}function doGG(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(doG(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)}function doHH(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(doH(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)}function doII(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(doI(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)}function convertToWordArray(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWords_temp1=lMessageLength+8;var lNumberOfWords_temp2=(lNumberOfWords_temp1-lNumberOfWords_temp1%64)/64;var lNumberOfWords=(lNumberOfWords_temp2+1)*16;var lWordArray=new Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|string.charCodeAt(lByteCount)<<lBytePosition;lByteCount++}lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|128<<lBytePosition;lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray}function wordToHex(lValue){var wordToHexValue="",wordToHexValue_temp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=lValue>>>lCount*8&255;wordToHexValue_temp="0"+lByte.toString(16);wordToHexValue=wordToHexValue+wordToHexValue_temp.substr(wordToHexValue_temp.length-2,2)}return wordToHexValue}function utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext}var x=[];var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=utf8Encode(string);x=convertToWordArray(string);a=1732584193;b=4023233417;c=2562383102;d=271733878;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=doFF(a,b,c,d,x[k+0],S11,3614090360);d=doFF(d,a,b,c,x[k+1],S12,3905402710);c=doFF(c,d,a,b,x[k+2],S13,606105819);b=doFF(b,c,d,a,x[k+3],S14,3250441966);a=doFF(a,b,c,d,x[k+4],S11,4118548399);d=doFF(d,a,b,c,x[k+5],S12,1200080426);c=doFF(c,d,a,b,x[k+6],S13,2821735955);b=doFF(b,c,d,a,x[k+7],S14,4249261313);a=doFF(a,b,c,d,x[k+8],S11,1770035416);d=doFF(d,a,b,c,x[k+9],S12,2336552879);c=doFF(c,d,a,b,x[k+10],S13,4294925233);b=doFF(b,c,d,a,x[k+11],S14,2304563134);a=doFF(a,b,c,d,x[k+12],S11,1804603682);d=doFF(d,a,b,c,x[k+13],S12,4254626195);c=doFF(c,d,a,b,x[k+14],S13,2792965006);b=doFF(b,c,d,a,x[k+15],S14,1236535329);a=doGG(a,b,c,d,x[k+1],S21,4129170786);d=doGG(d,a,b,c,x[k+6],S22,3225465664);c=doGG(c,d,a,b,x[k+11],S23,643717713);b=doGG(b,c,d,a,x[k+0],S24,3921069994);a=doGG(a,b,c,d,x[k+5],S21,3593408605);d=doGG(d,a,b,c,x[k+10],S22,38016083);c=doGG(c,d,a,b,x[k+15],S23,3634488961);b=doGG(b,c,d,a,x[k+4],S24,3889429448);a=doGG(a,b,c,d,x[k+9],S21,568446438);d=doGG(d,a,b,c,x[k+14],S22,3275163606);c=doGG(c,d,a,b,x[k+3],S23,4107603335);b=doGG(b,c,d,a,x[k+8],S24,1163531501);a=doGG(a,b,c,d,x[k+13],S21,2850285829);d=doGG(d,a,b,c,x[k+2],S22,4243563512);c=doGG(c,d,a,b,x[k+7],S23,1735328473);b=doGG(b,c,d,a,x[k+12],S24,2368359562);a=doHH(a,b,c,d,x[k+5],S31,4294588738);d=doHH(d,a,b,c,x[k+8],S32,2272392833);c=doHH(c,d,a,b,x[k+11],S33,1839030562);b=doHH(b,c,d,a,x[k+14],S34,4259657740);a=doHH(a,b,c,d,x[k+1],S31,2763975236);d=doHH(d,a,b,c,x[k+4],S32,1272893353);c=doHH(c,d,a,b,x[k+7],S33,4139469664);b=doHH(b,c,d,a,x[k+10],S34,3200236656);a=doHH(a,b,c,d,x[k+13],S31,681279174);d=doHH(d,a,b,c,x[k+0],S32,3936430074);c=doHH(c,d,a,b,x[k+3],S33,3572445317);b=doHH(b,c,d,a,x[k+6],S34,76029189);a=doHH(a,b,c,d,x[k+9],S31,3654602809);d=doHH(d,a,b,c,x[k+12],S32,3873151461);c=doHH(c,d,a,b,x[k+15],S33,530742520);b=doHH(b,c,d,a,x[k+2],S34,3299628645);a=doII(a,b,c,d,x[k+0],S41,4096336452);d=doII(d,a,b,c,x[k+7],S42,1126891415);c=doII(c,d,a,b,x[k+14],S43,2878612391);b=doII(b,c,d,a,x[k+5],S44,4237533241);a=doII(a,b,c,d,x[k+12],S41,1700485571);d=doII(d,a,b,c,x[k+3],S42,2399980690);c=doII(c,d,a,b,x[k+10],S43,4293915773);b=doII(b,c,d,a,x[k+1],S44,2240044497);a=doII(a,b,c,d,x[k+8],S41,1873313359);d=doII(d,a,b,c,x[k+15],S42,4264355552);c=doII(c,d,a,b,x[k+6],S43,2734768916);b=doII(b,c,d,a,x[k+13],S44,1309151649);a=doII(a,b,c,d,x[k+4],S41,4149444226);d=doII(d,a,b,c,x[k+11],S42,3174756917);c=doII(c,d,a,b,x[k+2],S43,718787259);b=doII(b,c,d,a,x[k+9],S44,3951481745);a=addUnsigned(a,AA);b=addUnsigned(b,BB);c=addUnsigned(c,CC);d=addUnsigned(d,DD)}var temp=wordToHex(a)+wordToHex(b)+wordToHex(c)+wordToHex(d);return temp.toLowerCase()}},{"./Constants":22,"./Grammar":29,"./URI":46}],48:[function(require,module,exports){var WebRTC={};module.exports=WebRTC;var ExSIP_C=require("./Constants");var Utils=require("./Utils");if(typeof navigator!=="undefined"&&navigator.webkitGetUserMedia){WebRTC.getUserMedia=navigator.webkitGetUserMedia.bind(navigator)}else if(typeof navigator!=="undefined"&&navigator.mozGetUserMedia){WebRTC.getUserMedia=navigator.mozGetUserMedia.bind(navigator)}else if(typeof navigator!=="undefined"&&navigator.getUserMedia){WebRTC.getUserMedia=navigator.getUserMedia.bind(navigator)}if(typeof webkitRTCPeerConnection!=="undefined"){WebRTC.RTCPeerConnection=webkitRTCPeerConnection}else if(typeof mozRTCPeerConnection!=="undefined"){WebRTC.RTCPeerConnection=mozRTCPeerConnection}else if(typeof RTCPeerConnection!=="undefined"){WebRTC.RTCPeerConnection=RTCPeerConnection}else{console.log("WebRTC.RTCPeerConnection undefined");WebRTC.RTCPeerConnection=function(options,constraints){this.options=options;this.constraints=constraints}}if(typeof RTCIceCandidate!=="undefined"){WebRTC.RTCIceCandidate=RTCIceCandidate}else{console.log("WebRTC.RTCIceCandidate undefined");WebRTC.RTCIceCandidate=function(){}}if(typeof webkitRTCSessionDescription!=="undefined"){WebRTC.RTCSessionDescription=webkitRTCSessionDescription}else if(typeof mozRTCSessionDescription!=="undefined"){WebRTC.RTCSessionDescription=mozRTCSessionDescription}else if(typeof RTCSessionDescription!=="undefined"){WebRTC.RTCSessionDescription=RTCSessionDescription}else{console.log("WebRTC.RTCSessionDescription undefined");WebRTC.RTCSessionDescription=function(options){options=options||{};this.sdp=options.sdp;this.type=options.type}}WebRTC.RTCSessionDescription.prototype.getSdp=function(options){options=options||{};var sdp=this.sdp;if(options.additionalSdp){sdp+=options.additionalSdp}return sdp};WebRTC.RTCSessionDescription.prototype.getUnsupportedMedias=function(){var slideMedias=this.getSlidesMedias();var inactiveApplicationMedias=this.getApplicationMedias("0 RTP/SAVPF");var unsupportedMedias=slideMedias.concat(inactiveApplicationMedias);return unsupportedMedias};WebRTC.RTCSessionDescription.prototype.removeUnsupportedMedia=function(){var unsupportedMedias=this.getUnsupportedMedias();for(var i=0;i<unsupportedMedias.length;i++){this.sdp=this.sdp.replace(unsupportedMedias[i],"");console.warn("removing unsupported media from sdp : "+unsupportedMedias[i])}return unsupportedMedias.join("")};WebRTC.RTCSessionDescription.prototype.getSlidesMedias=function(){var slideMedia=this.getVideoMedias("a=content:slides");return slideMedia};WebRTC.RTCSessionDescription.prototype.getVideoMedias=function(filter){return this.getMedias("video",filter)};WebRTC.RTCSessionDescription.prototype.getApplicationMedias=function(filter){return this.getMedias("application",filter)};WebRTC.RTCSessionDescription.prototype.getMedias=function(type,filter){var regex=new RegExp("(m="+type+"(?:(?!m=)[\\s\\S])*)","mig");var match;var results=[];while((match=regex.exec(this.sdp))!==null){var media=match.pop();if(!filter||media.indexOf(filter)!==-1){results.push(media)}}return results};WebRTC.RTCSessionDescription.prototype.getAudioIcePwd=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=ice-pwd:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideoIcePwd=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=ice-pwd:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioIceUfrag=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=ice-ufrag:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideoIceUfrag=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=ice-ufrag:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getCandidates=function(media){var regex=new RegExp("a=candidate:(.*)","ig");var matches;var result=[];while((matches=regex.exec(media))!==null){result.push(matches[matches.length-1])}return result};WebRTC.RTCSessionDescription.prototype.getAudioCandidates=function(){var audio=this.getAudio();return audio?this.getCandidates(audio):null};WebRTC.RTCSessionDescription.prototype.getVideoCandidates=function(){var video=this.getVideo();return video?this.getCandidates(video):null};WebRTC.RTCSessionDescription.prototype.getConnection=function(){var match=this.sdp.match(/v=(?:(?!m=)[\s\S])*c=(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudio=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideo=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioConnection=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*c=(.*)/im);return match!==null?match[match.length-1]:this.getConnection()};WebRTC.RTCSessionDescription.prototype.getVideoConnection=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*c=(.*)/im);return match!==null?match[match.length-1]:this.getConnection()};WebRTC.RTCSessionDescription.prototype.hasVideo=function(){return this.sdp.match(/m=video/)!==null};WebRTC.RTCSessionDescription.prototype.hasAudio=function(){return this.sdp.match(/m=audio/)!==null};WebRTC.RTCSessionDescription.prototype.videoPort=function(){var match=this.sdp.match(/m=video\s(\d*)\s/);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.audioPort=function(){var match=this.sdp.match(/m=audio\s(\d*)\s/);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioMedia=function(){var match=this.sdp.match(/m=audio\s(.*)/);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideoMedia=function(){var match=this.sdp.match(/m=video\s(.*)/);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioCodecs=function(){var audioMedia=this.getAudioMedia();return this.getCodecs(audioMedia)};WebRTC.RTCSessionDescription.prototype.getVideoCodecs=function(){var videoMedia=this.getVideoMedia();return this.getCodecs(videoMedia)};WebRTC.RTCSessionDescription.prototype.getCodecs=function(media){if(!media){return null}var mediaParts=media.split(" ");return mediaParts.splice(2)};WebRTC.RTCSessionDescription.prototype.getAudioCodecRtpmap=function(codec){var regex=new RegExp("m=audio(?:(?!m=)[\\s\\S])*a=rtpmap:"+codec+"(.*)","mi");var match=this.sdp.match(regex);return match!==null?match[match.length-1].trim():null};WebRTC.RTCSessionDescription.prototype.getVideoCodecRtpmap=function(codec){var regex=new RegExp("m=video(?:(?!m=)[\\s\\S])*a=rtpmap:"+codec+"(.*)","mi");var match=this.sdp.match(regex);return match!==null?match[match.length-1].trim():null};WebRTC.RTCSessionDescription.prototype.getAudioCodecFmtp=function(codec){var regex=new RegExp("m=audio(?:(?!m=)[\\s\\S])*a=fmtp:"+codec+"(.*)","mi");var match=this.sdp.match(regex);return match!==null?match[match.length-1].trim():null};WebRTC.RTCSessionDescription.prototype.getVideoCodecFmtp=function(codec){var regex=new RegExp("m=video(?:(?!m=)[\\s\\S])*a=fmtp:"+codec+"(.*)","mi");var match=this.sdp.match(regex);return match!==null?match[match.length-1].trim():null};WebRTC.RTCSessionDescription.prototype.getAudioFingerprint=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=fingerprint:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideoFingerprint=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=fingerprint:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioRtcp=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=rtcp:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideoRtcp=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=rtcp:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.removeVideoFingerprint=function(){if(this.getVideoFingerprint()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(a=fingerprint:.*\r\n)/im,"$1")}};WebRTC.RTCSessionDescription.prototype.removeAudioFingerprint=function(){if(this.getAudioFingerprint()){this.sdp=this.sdp.replace(/(m=audio(?:(?!m=)[\s\S])*)(a=fingerprint:.*\r\n)/im,"$1")}};WebRTC.RTCSessionDescription.prototype.hasActiveVideo=function(){var videoPort=this.videoPort()||0;var videoConnection=this.getVideoConnection()||"";return this.hasVideo()&&videoPort>0&&videoConnection.indexOf("0.0.0.0")===-1};WebRTC.RTCSessionDescription.prototype.hasActiveAudio=function(){var audioPort=this.audioPort()||0;var audioConnection=this.getAudioConnection()||"";return this.hasAudio()&&audioPort>0&&audioConnection.indexOf("0.0.0.0")===-1};WebRTC.RTCSessionDescription.prototype.getVideoBandwidth=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*b=.*:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.setVideoBandwidth=function(videoBandwidth){if(this.getVideoBandwidth()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(b=.*)/im,"$1b=AS:"+videoBandwidth)}else{this.sdp=this.sdp.replace(/(m=video.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\nb=AS:"+videoBandwidth)}};WebRTC.RTCSessionDescription.prototype.setVideoMode=function(mode){if(this.getVideoMode()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(a=(sendrecv|sendonly|recvonly|inactive))/im,"$1a="+mode)}else{this.sdp=this.sdp.replace(/(m=video.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\na="+mode)}};WebRTC.RTCSessionDescription.prototype.setVideoPort=function(port){this.sdp=this.sdp.replace(/(m=video\s)(\d*)(\s)/i,"$1"+port+"$3")};WebRTC.RTCSessionDescription.prototype.getVideoMode=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=(sendrecv|sendonly|recvonly|inactive)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.setAudioMode=function(mode){if(this.getAudioMode()){this.sdp=this.sdp.replace(/(m=audio(?:(?!m=)[\s\S])*)(a=(sendrecv|sendonly|recvonly|inactive))/im,"$1a="+mode)}else{this.sdp=this.sdp.replace(/(m=audio.*(:?(?!m=)[\s\S])*(c=IN\s+IP4.*)?)/,"$1\r\na="+mode)}};WebRTC.RTCSessionDescription.prototype.setAudioPort=function(port){this.sdp=this.sdp.replace(/(m=audio\s)(\d*)(\s)/i,"$1"+port+"$3")};WebRTC.RTCSessionDescription.prototype.setAudioConnection=function(audioConnection){if(this.getAudioConnection()){this.sdp=this.sdp.replace(/(m=audio(?:(?!m=)[\s\S])*)(c=.*)/im,"$1c="+audioConnection)}else{this.sdp=this.sdp.replace(/(m=audio.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\nc="+audioConnection)}};WebRTC.RTCSessionDescription.prototype.setVideoConnection=function(videoConnection){if(this.getVideoConnection()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(c=.*)/im,"$1c="+videoConnection)}else{this.sdp=this.sdp.replace(/(m=video.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\nc="+videoConnection)}};WebRTC.RTCSessionDescription.prototype.setAudioRtcp=function(audioRtcp){if(this.getAudioRtcp()){this.sdp=this.sdp.replace(/(m=audio(?:(?!m=)[\s\S])*)(a=rtcp:.*)/im,"$1a=rtcp:"+audioRtcp)}else{this.sdp=this.sdp.replace(/(m=audio.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\na=rtcp:"+audioRtcp)}};WebRTC.RTCSessionDescription.prototype.setVideoRtcp=function(videoRtcp){if(this.getVideoRtcp()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(a=rtcp:.*)/im,"$1a=rtcp:"+videoRtcp)}else{this.sdp=this.sdp.replace(/(m=video.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\na=rtcp:"+videoRtcp)}};WebRTC.RTCSessionDescription.prototype.getAudioMode=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=(sendrecv|sendonly|recvonly|inactive)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.isActive=function(){if(this.hasAudio()&&this.audioPort()!=="0"&&this.getAudioMode()!==ExSIP_C.INACTIVE){return true}if(this.hasVideo()&&this.videoPort()!=="0"&&this.getVideoMode()!==ExSIP_C.INACTIVE){return true}return false};WebRTC.RTCSessionDescription.prototype.mediaChanges=function(otherSdp){var mediaChanges=[];if(this.hasAudio()!==otherSdp.hasAudio()){mediaChanges.push("audio has changed")}if(this.hasVideo()!==otherSdp.hasVideo()){mediaChanges.push("video has changed")}if(this.audioPort()!==otherSdp.audioPort()){mediaChanges.push("audio port has changed : "+this.audioPort()+" - "+otherSdp.audioPort())}if(this.videoPort()!==otherSdp.videoPort()){mediaChanges.push("video port has changed : "+this.videoPort()+" - "+otherSdp.videoPort())}if(this.getAudioConnection()!==otherSdp.getAudioConnection()){mediaChanges.push("audio connection has changed : "+this.getAudioConnection()+" - "+otherSdp.getAudioConnection())}if(this.getVideoConnection()!==otherSdp.getVideoConnection()){mediaChanges.push("video connection has changed : "+this.getVideoConnection()+" - "+otherSdp.getVideoConnection())}var audioCodecs=this.getAudioCodecs();if(!Utils.isEqArrays(audioCodecs,otherSdp.getAudioCodecs())){mediaChanges.push("audio codecs has changed : "+audioCodecs+" - "+otherSdp.getAudioCodecs())}var videoCodecs=this.getVideoCodecs();if(!Utils.isEqArrays(videoCodecs,otherSdp.getVideoCodecs())){mediaChanges.push("video codecs has changed : "+videoCodecs+" - "+otherSdp.getVideoCodecs())}if(audioCodecs){for(var i=0;i<audioCodecs.length;i++){if(this.getAudioCodecRtpmap(audioCodecs[i])!==otherSdp.getAudioCodecRtpmap(audioCodecs[i])){mediaChanges.push("audio codec rtpmap for "+audioCodecs[i]+" has changed : "+this.getAudioCodecRtpmap(audioCodecs[i])+" - "+otherSdp.getAudioCodecRtpmap(audioCodecs[i]))}}}if(videoCodecs){for(var j=0;j<videoCodecs.length;j++){if(this.getVideoCodecRtpmap(videoCodecs[j])!==otherSdp.getVideoCodecRtpmap(videoCodecs[j])){mediaChanges.push("video codec rtpmap for "+videoCodecs[j]+" has changed : "+this.getVideoCodecRtpmap(videoCodecs[j])+" - "+otherSdp.getVideoCodecRtpmap(videoCodecs[j]))}}}return mediaChanges};if(WebRTC.RTCPeerConnection&&WebRTC.RTCPeerConnection.prototype){if(!WebRTC.RTCPeerConnection.prototype.getLocalStreams){WebRTC.RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams};WebRTC.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams}}WebRTC.RTCPeerConnection.prototype.isIceCandidateReady=function(candidate){return candidate}}if(WebRTC.getUserMedia&&WebRTC.RTCPeerConnection&&WebRTC.RTCSessionDescription){WebRTC.isSupported=true}else{WebRTC.isSupported=false}},{"./Constants":22,"./Utils":47}],49:[function(require,module,exports){module.exports=sanityCheck;var ExSIP_C=require("./Constants");var SIPMessage=require("./SIPMessage");var Utils=require("./Utils");var logger,message,ua,transport,requests=[],responses=[],all=[];requests.push(rfc3261_8_2_2_1);requests.push(rfc3261_16_3_4);requests.push(rfc3261_18_3_request);requests.push(rfc3261_8_2_2_2);responses.push(rfc3261_8_1_3_3);responses.push(rfc3261_18_3_response);all.push(minimumHeaders);function sanityCheck(m,u,t){var len,pass;message=m;ua=u;transport=t;logger=ua.getLogger("ExSIP.sanitycheck");len=all.length;while(len--){pass=all[len](message);if(pass===false){return false}}if(message instanceof SIPMessage.IncomingRequest){len=requests.length;while(len--){pass=requests[len](message);if(pass===false){return false}}}else if(message instanceof SIPMessage.IncomingResponse){len=responses.length;while(len--){pass=responses[len](message);if(pass===false){return false}}}return true}function rfc3261_8_2_2_1(){if(message.s("to").uri.scheme!=="sip"){logger.warn("Scheme ("+message.s("to").uri.scheme+") is not sip. Dropping the request",ua);reply(416);return false}}function rfc3261_16_3_4(){if(!message.to_tag){if(message.call_id.substr(0,5)===ua.configuration.exsip_id){logger.warn("Call_id ("+message.call_id+") is same as exsip ("+ua.configuration.exsip_id+"). Dropping the request",ua);reply(482);return false}}}function rfc3261_18_3_request(){var len=Utils.str_utf8_length(message.body),contentLength=message.getHeader("content-length");if(len<contentLength){logger.warn("Message body length ("+len+") is lower than the value in Content-Length header field ("+contentLength+"). Dropping the request",ua);
reply(400);return false}}function rfc3261_8_2_2_2(){var tr,idx,fromTag=message.from_tag,call_id=message.call_id,cseq=message.cseq;if(message.to_tag){return}if(message.method===ExSIP_C.INVITE){if(ua.transactions.ist[message.via_branch]){return false}else{for(idx in ua.transactions.ist){tr=ua.transactions.ist[idx];if(tr.request.from_tag===fromTag&&tr.request.call_id===call_id&&tr.request.cseq===cseq){reply(482);return false}}}}else{if(ua.transactions.nist[message.via_branch]){return false}else{for(idx in ua.transactions.nist){tr=ua.transactions.nist[idx];if(tr.request.from_tag===fromTag&&tr.request.call_id===call_id&&tr.request.cseq===cseq){reply(482);return false}}}}}function rfc3261_8_1_3_3(){if(message.getHeaders("via").length>1){logger.warn("More than one Via header field present in the response. Dropping the response");return false}}function rfc3261_18_3_response(){var len=Utils.str_utf8_length(message.body),contentLength=message.getHeader("content-length");if(len<contentLength){logger.warn("Message body length is lower than the value in Content-Length header field. Dropping the response");return false}}function minimumHeaders(){var mandatoryHeaders=["from","to","call_id","cseq","via"],idx=mandatoryHeaders.length;while(idx--){if(!message.hasHeader(mandatoryHeaders[idx])){logger.warn("Missing mandatory header field : "+mandatoryHeaders[idx]+". Dropping the response");return false}}}function reply(status_code){var to,response="SIP/2.0 "+status_code+" "+ExSIP_C.REASON_PHRASE[status_code]+"\r\n",vias=message.getHeaders("via"),length=vias.length,idx=0;for(idx;idx<length;idx++){response+="Via: "+vias[idx]+"\r\n"}to=message.getHeader("To");if(!message.to_tag){to+=";tag="+Utils.newTag()}response+="To: "+to+"\r\n";response+="From: "+message.getHeader("From")+"\r\n";response+="Call-ID: "+message.call_id+"\r\n";response+="CSeq: "+message.cseq+" "+message.method+"\r\n";response+="\r\n";transport.send(response)}},{"./Constants":22,"./SIPMessage":41,"./Utils":47}],50:[function(require,module,exports){module.exports=Authentication;var events=require("./EventBus");function Authentication(element,options){this.popup=element;this.okButton=this.popup.find(".authPopupButton");this.userIdInput=this.popup.find("input.userid");this.authUserIdInput=this.popup.find("input.authUserid");this.passwordInput=this.popup.find("input.password");this.alert=this.popup.find(".alert");this.visible=false;this.options=options||{};this.registerListeners()}Authentication.prototype={registerListeners:function(){var self=this;events.on("registrationFailed",function(e){var statusCode=e.data.response.status_code;if(statusCode===403&&self.options.settingsUserId()&&!self.options.settingsPassword()||self.options.configurationRegister){self.setVisible(true)}});this.okButton.bind("click",function(){var userId=self.userIdInput.val();if(!userId){self.alert.text("Invalid User ID").fadeIn(10).fadeOut(4e3);return}var authUserId=self.authUserIdInput.val();var password=self.passwordInput.val();self.setVisible(false);self.options.onAuthenticate({userId:userId,authenticationUserId:authUserId,password:password});events.once("registered",function(){if(authUserId&&self.options.settingsUserId()!==authUserId){self.options.settingsAuthenticationUserId(authUserId)}self.options.settingsUserId(userId);self.options.settingsPassword(password)})});this.popup.bind("keypress",function(e){if(e.which===13){self.okButton.click()}})},show:function(){this.setVisible(true)},setVisible:function(visible){this.visible=visible;this.authUserIdInput.val(this.options.settingsAuthenticationUserId());this.userIdInput.val(this.options.settingsUserId());events.emit("viewChanged")}}},{"./EventBus":55}],51:[function(require,module,exports){module.exports=Client;var styles='.bdsft-reset{font-size:14px;font:normal normal 14px Open Sans,Arial,sans-serif}.bdsft-reset div,.bdsft-reset span,.bdsft-reset applet,.bdsft-reset object,.bdsft-reset iframe,.bdsft-reset h1,.bdsft-reset h2,.bdsft-reset h3,.bdsft-reset h4,.bdsft-reset h5,.bdsft-reset h6,.bdsft-reset p,.bdsft-reset blockquote,.bdsft-reset pre,.bdsft-reset a,.bdsft-reset abbr,.bdsft-reset acronym,.bdsft-reset address,.bdsft-reset big,.bdsft-reset cite,.bdsft-reset code,.bdsft-reset del,.bdsft-reset dfn,.bdsft-reset em,.bdsft-reset img,.bdsft-reset ins,.bdsft-reset kbd,.bdsft-reset q,.bdsft-reset s,.bdsft-reset samp,.bdsft-reset small,.bdsft-reset strike,.bdsft-reset strong,.bdsft-reset sub,.bdsft-reset sup,.bdsft-reset tt,.bdsft-reset var,.bdsft-reset b,.bdsft-reset u,.bdsft-reset i,.bdsft-reset center,.bdsft-reset dl,.bdsft-reset dt,.bdsft-reset dd,.bdsft-reset ol,.bdsft-reset ul,.bdsft-reset li,.bdsft-reset fieldset,.bdsft-reset form,.bdsft-reset div.form,.bdsft-reset label,.bdsft-reset legend,.bdsft-reset table,.bdsft-reset caption,.bdsft-reset tbody,.bdsft-reset tfoot,.bdsft-reset thead,.bdsft-reset tr,.bdsft-reset th,.bdsft-reset td,.bdsft-reset article,.bdsft-reset aside,.bdsft-reset canvas,.bdsft-reset details,.bdsft-reset figcaption,.bdsft-reset figure,.bdsft-reset footer,.bdsft-reset header,.bdsft-reset hgroup,.bdsft-reset menu,.bdsft-reset nav,.bdsft-reset section,.bdsft-reset summary,.bdsft-reset time,.bdsft-reset mark,.bdsft-reset audio,.bdsft-reset video,.bdsft-reset button,.bdsft-reset textarea,.bdsft-reset input{font-size:100%;font:normal normal 100% Open Sans,Arial,sans-serif}.bdsft-reset,.bdsft-reset div,.bdsft-reset span,.bdsft-reset applet,.bdsft-reset object,.bdsft-reset iframe,.bdsft-reset h1,.bdsft-reset h2,.bdsft-reset h3,.bdsft-reset h4,.bdsft-reset h5,.bdsft-reset h6,.bdsft-reset p,.bdsft-reset blockquote,.bdsft-reset pre,.bdsft-reset a,.bdsft-reset abbr,.bdsft-reset acronym,.bdsft-reset address,.bdsft-reset big,.bdsft-reset cite,.bdsft-reset code,.bdsft-reset del,.bdsft-reset dfn,.bdsft-reset em,.bdsft-reset img,.bdsft-reset ins,.bdsft-reset kbd,.bdsft-reset q,.bdsft-reset s,.bdsft-reset samp,.bdsft-reset small,.bdsft-reset strike,.bdsft-reset strong,.bdsft-reset sub,.bdsft-reset sup,.bdsft-reset tt,.bdsft-reset var,.bdsft-reset b,.bdsft-reset u,.bdsft-reset i,.bdsft-reset center,.bdsft-reset dl,.bdsft-reset dt,.bdsft-reset dd,.bdsft-reset ol,.bdsft-reset ul,.bdsft-reset li,.bdsft-reset fieldset,.bdsft-reset form,.bdsft-reset div.form,.bdsft-reset label,.bdsft-reset legend,.bdsft-reset table,.bdsft-reset caption,.bdsft-reset tbody,.bdsft-reset tfoot,.bdsft-reset thead,.bdsft-reset tr,.bdsft-reset th,.bdsft-reset td,.bdsft-reset article,.bdsft-reset aside,.bdsft-reset canvas,.bdsft-reset details,.bdsft-reset figcaption,.bdsft-reset figure,.bdsft-reset footer,.bdsft-reset header,.bdsft-reset hgroup,.bdsft-reset menu,.bdsft-reset nav,.bdsft-reset section,.bdsft-reset summary,.bdsft-reset time,.bdsft-reset mark,.bdsft-reset audio,.bdsft-reset video,.bdsft-reset button,.bdsft-reset textarea,.bdsft-reset input{font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal;alignment-adjust:auto;alignment-baseline:baseline;-webkit-animation:none 0 ease 0 1 normal;-moz-animation:none 0 ease 0 1 normal;-ms-animation:none 0 ease 0 1 normal;animation:none 0 ease 0 1 normal;-webkit-animation-play-state:running;-moz-play-state:running;-ms-animation-play-state:running;animation-play-state:running;appearance:normal;azimuth:center;backface-visibility:visible;background:none 0 0 auto repeat scroll padding-box transparent;background-color:transparent;background-image:none;baseline-shift:baseline;binding:none;bleed:6pt;bookmark-label:content();bookmark-level:none;bookmark-state:open;bookmark-target:none;border:0 none transparent;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;bottom:auto;box-align:stretch;box-decoration-break:slice;box-direction:normal;box-flex:0;box-flex-group:1;box-lines:single;box-ordinal-group:1;box-orient:inline-axis;box-pack:start;-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;break-after:auto;break-before:auto;break-inside:auto;caption-side:top;clear:none;clip:auto;color:inherit;color-profile:auto;-webkit-column-count:auto;-webkit-column-fill:balance;-webkit-column-gap:normal;-webkit-column-rule:medium medium #1f1f1f;-webkit-column-span:1;-webkit-column-width:auto;-webkit-columns:auto auto;-moz-column-count:auto;-moz-column-fill:balance;-moz-column-gap:normal;-moz-column-rule:medium medium #1f1f1f;-moz-column-span:1;-moz-column-width:auto;-moz-columns:auto auto;column-count:auto;column-fill:balance;column-gap:normal;column-rule:medium medium #1f1f1f;column-span:1;column-width:auto;columns:auto auto;content:normal;counter-increment:none;counter-reset:none;crop:auto;cursor:auto;direction:ltr;display:inline;dominant-baseline:auto;drop-initial-after-adjust:text-after-edge;drop-initial-after-align:baseline;drop-initial-before-adjust:text-before-edge;drop-initial-before-align:caps-height;drop-initial-size:auto;drop-initial-value:initial;elevation:level;empty-cells:show;fit:fill;fit-position:0;float:none;float-offset:0;grid-columns:none;grid-rows:none;hanging-punctuation:none;height:auto;hyphenate-after:auto;hyphenate-before:auto;hyphenate-character:auto;hyphenate-lines:no-limit;hyphenate-resource:none;hyphens:manual;icon:auto;image-orientation:auto;image-rendering:auto;image-resolution:normal;inline-box-align:last;left:auto;line-height:inherit;line-stacking:inline-line-height exclude-ruby consider-shifts;list-style:disc outside none;margin:0;marks:none;marquee-direction:forward;marquee-loop:1;marquee-play-count:1;marquee-speed:normal;marquee-style:scroll;max-height:none;max-width:none;min-height:0;min-width:0;move-to:normal;nav-down:auto;nav-index:auto;nav-left:auto;nav-right:auto;nav-up:auto;opacity:1;orphans:2;outline:invert none medium;outline-offset:0;overflow:visible;overflow-style:auto;padding:0;page:auto;page-break-after:auto;page-break-before:auto;page-break-inside:auto;page-policy:start;perspective:none;perspective-origin:50% 50%;position:static;presentation-level:0;punctuation-trim:none;quotes:none;rendering-intent:auto;resize:none;right:auto;rotation:0;rotation-point:50% 50%;ruby-align:auto;ruby-overhang:none;ruby-position:before;ruby-span:none;size:auto;string-set:none;table-layout:auto;top:auto;-webkit-transform:none;-moz-transform:none;transform:none;-webkit-transform-origin:50% 50%;-moz-transform-origin:50% 50%;-o-transform-origin:50% 50%;transform-origin:50% 50% 0;transform-style:flat;-webkit-transition:all 0 ease 0;-moz-transition:all 0 ease 0;-o-transition:all 0 ease 0;transition:all 0 ease 0;unicode-bidi:normal;vertical-align:baseline;white-space:normal;white-space-collapse:collapse;widows:2;width:auto;word-break:normal;word-spacing:normal;word-wrap:normal;z-index:auto;text-align:start}.bdsft-reset address,.bdsft-reset blockquote,.bdsft-reset dd,.bdsft-reset div,.bdsft-reset dl,.bdsft-reset dt,.bdsft-reset fieldset,.bdsft-reset form,.bdsft-reset div.form,.bdsft-reset frame,.bdsft-reset frameset,.bdsft-reset h1,.bdsft-reset h2,.bdsft-reset h3,.bdsft-reset h4,.bdsft-reset h5,.bdsft-reset h6,.bdsft-reset noframes,.bdsft-reset ol,.bdsft-reset p,.bdsft-reset ul,.bdsft-reset center,.bdsft-reset dir,.bdsft-reset hr,.bdsft-reset menu,.bdsft-reset pre,.bdsft-reset article,.bdsft-reset aside,.bdsft-reset canvas,.bdsft-reset details,.bdsft-reset figcaption,.bdsft-reset figure,.bdsft-reset footer,.bdsft-reset header,.bdsft-reset hgroup,.bdsft-reset nav,.bdsft-reset section,.bdsft-reset summary{display:block}.bdsft-reset li{display:list-item}.bdsft-reset table{display:table}.bdsft-reset tr{display:table-row}.bdsft-reset thead{display:table-header-group}.bdsft-reset tbody{display:table-row-group}.bdsft-reset tfoot{display:table-footer-group}.bdsft-reset col{display:table-column}.bdsft-reset colgroup{display:table-column-group}.bdsft-reset td,.bdsft-reset th{display:table-cell}.bdsft-reset caption{display:table-caption}.bdsft-reset input,.bdsft-reset select{display:inline-block}.bdsft-reset b,.bdsft-reset strong,.bdsft-reset strong>*{font-weight:bold}.bdsft-reset textarea,.bdsft-reset input{cursor:text}.bdsft-reset textarea .bdsft-reset textarea::-webkit-input-placeholder,.bdsft-reset input .bdsft-reset textarea::-webkit-input-placeholder,.bdsft-reset textarea .bdsft-reset input::-webkit-input-placeholder,.bdsft-reset input .bdsft-reset input::-webkit-input-placeholder{background-color:inherit;color:inherit;font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-size:100%;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;font:normal normal 100% Open Sans,Arial,sans-serif;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal}.bdsft-reset textarea .bdsft-reset textarea:-moz-placeholder,.bdsft-reset input .bdsft-reset textarea:-moz-placeholder,.bdsft-reset textarea .bdsft-reset input:-moz-placeholder,.bdsft-reset input .bdsft-reset input:-moz-placeholder{background-color:inherit;color:inherit;font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-size:100%;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;font:normal normal 100% Open Sans,Arial,sans-serif;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal}.bdsft-reset textarea .bdsft-reset textarea::-moz-placeholder,.bdsft-reset input .bdsft-reset textarea::-moz-placeholder,.bdsft-reset textarea .bdsft-reset input::-moz-placeholder,.bdsft-reset input .bdsft-reset input::-moz-placeholder{background-color:inherit;color:inherit;font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-size:100%;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;font:normal normal 100% Open Sans,Arial,sans-serif;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal}.bdsft-reset textarea .bdsft-reset textarea:-ms-input-placeholder,.bdsft-reset input .bdsft-reset textarea:-ms-input-placeholder,.bdsft-reset textarea .bdsft-reset input:-ms-input-placeholder,.bdsft-reset input .bdsft-reset input:-ms-input-placeholder{background-color:inherit;color:inherit;font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-size:100%;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;font:normal normal 100% Open Sans,Arial,sans-serif;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal}.bdsft-reset input[type=checkbox],.bdsft-reset input[type=radio]{cursor:default}.bdsft-reset a,.bdsft-reset a *,.bdsft-reset a span,.bdsft-reset button,.bdsft-reset button *,.bdsft-reset button span,.bdsft-reset input[type=submit],.bdsft-reset input[type=reset]{cursor:pointer}.bdsft-reset a:link,.bdsft-reset a:visited,.bdsft-reset a:hover,.bdsft-reset a:active{color:inherit;background:transparent;text-shadow:none}.bdsft-reset button::-moz-focus-inner{border:0;padding:0}.bdsft-reset *[class^=\'bdsft-icon\']{font-family:FontAwesome!important}@font-face{font-family:\'Exario-Icon-Fonts\';src:url("../fonts/Exario-Icon-Fonts.eot?") format("embedded-opentype")}@font-face{font-family:\'Exario-Icon-Fonts\';src:url("data:application/font-woff;base64,d09GRgABAAAAACxIAAsAAAAAK/wAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAABCAAAAGAAAABgCCL8u2NtYXAAAAFoAAAAVAAAAFTmQODcZ2FzcAAAAbwAAAAIAAAACAAAABBnbHlmAAABxAAAJwwAACcM1Zkoz2hlYWQAACjQAAAANgAAADYBntqxaGhlYQAAKQgAAAAkAAAAJAPkAhRobXR4AAApLAAAANAAAADQYQAFvmxvY2EAACn8AAAAagAAAGrdaNOKbWF4cAAAKmgAAAAgAAAAIABCALduYW1lAAAqiAAAAZ8AAAGfRUsFcXBvc3QAACwoAAAAIAAAACAAAwAAAAMCAAGQAAUAAAFMAWYAAABHAUwBZgAAAPUAGQCEAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAQAAA5gUB4P/g/+AB4AAgAAAAAQAAAAAAAAAAAAAAIAAAAAAAAgAAAAMAAAAUAAMAAQAAABQABABAAAAADAAIAAIABAABACDgLeYF//3//wAAAAAAIOAA5gT//f//AAH/4yAEGi4AAwABAAAAAAAAAAAAAAAAAAEAAf//AA8AAQAAAAAAAAAAAAIAADc5AQAAAAABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAg/+ABxwHgABAAAAU+AScuAQcVJzcVNhYXFgYHAX0VEw0OVlTAwGRyERInNSAnWicnMgJ/wMB8Ak08O4k5AAEAOf/gAeAB4AAQAAABNRcHNSYGBwYWFy4BNz4BFwEgwMBUVg4NExU1JxIRcmQBZHzAwH8CMicnWic5iTs8TQIAAAAADQAA/+ACAAHgAAMABwALABMAGwAfACMAJwArADMANwA7AEMAABMhFSEHMxUjETMVIwM1IzUjFTM1AxUzNTM1MzUHMxUjETMVIwEzFSMjMxUjNxUzFTMVMzUDMxUjOwEVIzcVIxUjFTM1gAEA/wAgICAgICAgIGBgICAgICAgICABYCAgICAgICAgIIAgICAgIEAgIGABQMAgIAFAIP6gICBgIAHgYCAgIEAg/sAgAYAgIIAgICBg/oAgICAgICBgAAAAAA0AAP/gAgAB4AADAAsADwAXABsAHwAjACsALwAzADcAPwBDAAA3MxUjNRUzFTMVMzUHMxUjExUjFSMVMzUnMxUjOwEVIxchFSEBNSM1IxUzNSczFSM3MxUjETMVIycVMzUzNTM1BzMVIyAgICAgIIAgIGAgIGCAICAgICBgAQD/AAFAICBgICAgICAgICBgICAgICAgICBgICAgYGAgAeAgICBgICAgYMABACAgYCBAIEAg/kAggGAgICBAIAAAAAQAKwALAcABtQAKAA8AFAAZAAABFSMVIxUjFSERIwMjNTMVMyMRMxEzIxEzEQErVlVVAZWVQEBAVUBAVUBAAbVVVVaqAar+gKurAQD/AAFW/qoAAAMAKwALAcABtQAKAA8AFAAAARUjFSMVIxUhESMTIxEzETMjETMRAStWVVUBlZUVQEBVQEABtVVVVqoBqv6AAQD/AAFW/qoAAAIAKwALAcABtQAKAA8AAAEVIxUjFSMVIREjEyMRMxEBK1ZVVQGVlWpAQAG1VVVWqgGq/oABVv6qAAAAAAEAKwALAcABtQAKAAABFSMVIxUjFSERIwErVlVVAZWVAbVVVVaqAaoAAAAABAAr//UBwAHLABsAKQAuAEkAAAEHIyIGBw4BHQEUFhceATsBFzoBMREqASMqASMDIyImPQE0Njc+ATsBFRcnNTcRExUeARceARUUBgcOAQcVPgE3PgE1NCYnLgEnARBVVQ4VCAgICAgIFQ5VVRAgCAsFBQsIZUUJCAICAgYFRWpVVVYQEQQEAQEEBBEQGCAKCgkJCgogGAHLawwJChkNew0YCAkKawHW/sAMCXsECgMEBapWVqpW/qoBFi0DDAgIEgsKEwgIDAMsAxMODiMTEyMODhMEAAAAAwAr//UB0wHLAAoAMwA4AAAlFScHHwEWNhU1BwcwNDE1NDY3PgE3FxU3NTcVNzUGJgcmBicHJw4BBw4BHQEUFhceARc3BycBFwEBK0geC1YQHyrAAQICBwRFFVYqCAsEBQsIVlUNFggHCQECAQQCISIeAYoe/nbGkEccAWoBAQH8KygCfAMLAgUEAQFCFC9VLipFAQEBAQEBbAEBCwoJGgx8BAsDBggEIo0fAYod/nQAAAAAAwARAEECAAGAADQARQBOAAABIyIGDwE1NCYnLgEjISIGBw4BHQEUFhceATMhMjY3PgE9ARceATsBMjY3PgE9ATQmJy4BIwEiJj0BNDYzITIWHQEUBiMhJSMnMSc1NzMVAeEOBgsEKggGBhEK/tsKEQYHBwcHBhEKASUKEQYGCCoECwYOBgwEBAUFBAQMBv5fBwkJBwElBwkJB/7bAaEPPhBODwFxBAQnEgkQBgYHBwYGEAnoCRAGBQcHBQYQCRInBAQEBAQLBugGCwQEBP7tCAboBgkJBugGCA46D1dI6AACAAD/4AIAAeAAOQBzAAABJy4BIyIGDwEOARUUFh8BHgEXNy4BLwEuATU0Nj8BPgEzMhYfAR4BFRQGDwEeARceAQc3PgE1NCYnBy4BJwceAR8BHgEVFAYPAQ4BIyImLwEuATU0Nj8BLgEnLgE3Bw4BFRQWHwEeATMyNj8BPgE1NCYvAQHdAhItFxctEW4REhIRAgMHAygEBgMCCgkJCm0JGQwNGAkCCgoKCjEDBQIBAgFNERISEaEDBwMoBAYDAgoJCQptCRkMDRgJAgoKCgoxAwUCAQIBTRESEhECEi0XFy0RbhESEhECAbsCERISEW0SLRcXLRICAgYCKAIFAwIJGA0NGAltCgoKCgIJGA0MGQkyCBAICBEJTREtFxctEp0CBgIoAgUDAgkYDQ0YCW0KCgoKAgkYDQwZCTIIEAgIEQlNES0XFy0SAhESEhFtEi0XFy0SAgAAAAQAAwAAAf8BwgA8AE0AhACPAAATPgEXHgEXFjY3PgE3PgEnLgEnJjY3PgEjIiYHDgEHDgEHDgEHBhYHBiYHDgEHBhQXMBYXHgE3PgE3NiY3FyYiDwEGFB8BHgE/AT4BLwElJgYHDgEHDgEHBiYnLgE1JjY3PgE3NiYHDgEHBhQVDgEPARc3PgE3PgEXFjY3PgE3PgE3NCYnAQYUHwEWNj8BJwdQCREICREKAwUCASQCAQICAg0EEiMZGioKCzsGDRoNDRYIFBIBBgEKCw8HAw4CAwIhAgIKAwMOAQIBCJICBQMlAgLUBAsEGQQBA9MBGwEIAgMRBQIIBgcQCwsIAQUBBBICAQQHBzsGAwEHCyIiKwMMBwYPCA8ZCQoOBQUEAQEB/kkEBBgEDAR9JoMBMAcCAwQQCwMEAQIgAQEEAwIQBhclDg0PAQEBCwgHEAUOEAEFFAoJBAUDCgMCBwMkAwICAwMLAQIXBg4DAiACBgLyBAEEFQMMBPRnCgEEBBsIBAkDAwEICA0FBgkEBx8DAgoDAx8YDBcLCxYKJCgoBAcCAgICAwIEBQ8KCBkNDBYE/qIECwQYBAIFeyx/AAQAAgAcAgEBlQBcAHIAhQCNAAA3LgEvATcnLgEnJjQ1PAE3PgE3PgE3NgQXHgEfATc+ATEyFh8BBxU3PgE3PgE3NjIXHgEXFhQdAQcOAQcOASMiJicuAScuATEwBhUUBgcOAQcGIisBBw4BMTAmJzE3PgEnJiQHDgEHDgEXFRceATMyNjcxFzI2NzY0PQEHDgEHBhYzMjY3MTc1Iw8BFzM1DQIEAgMiBwIGAQMDAgcEBQoHCgEvBQMHAgcVCQ0BBQMHLwYDDggJCwMGGAYFDAEBAwMFBAUGCwkIAwIQCgkOAQUFBA4JBEtNlBYJDgMCy28qAgT+0AQCAwECAQEFAgQBAVxAlgIDAQKHOFEBAyJiRz8CdhJMAU0SIAIFAgMcBwMIAwchW1siBgUJBAMFAQIBAgEEAgQRCAoFAwgoHAUDDQYJCQECAgINBQJKMXgHBAUCAwEBAQEOCAkMBwUKEAYGCAIBEwcLAgK/XCUBAgECAQMCAyhTeQQCAkw2gAQCAyRLbXEuRAECAQEBgXVHWkl1AAAAAQAA/+AB4AHAADYAACUOAQcOASMiJicuAScuAScuATU0Njc+ATc2JicuASMiBjEUFhceARceARceATMwNjU0JicuAQcBYAwOBgYODAwYDAwYDAwXCQkLCwkJFwwMEhISKgwYSBYTEi4XF0QkJUQYYB8VFSsMoAwXCQkLCwkJFwwMGAwMGAwMDgYGDgwMKxUVH2AYRCUkRBcXLhITFkgYDCoSEhIMAAAAAQAAAGECAAFAAFYAACUeARcOAQcOAScuASc+ATc2NCcuAScuASMiBgcOAQcOARceAQcWBgcGJicuATcmNjU+ATc+ATcyIjM+ATc+ATMjMiIzIjIxMzIWFx4BFyIyIx4BFx4BFQH9AgEBAQMGBzIZHCgBAQUDAQkHFgsOGxAOHQwNFAkHAgMBBwEBKhobMAkEBQEBAwIEBQMOCAEBAQ0mGBtDLgECAQIBAgEsRRkaJA8BAQEKDAUDBsAKGAsLEwUJCAICExIJDwgHEAkJCQMCAQECAwkJCRAHCA8JEhMCAggJBRMLCxgKBw8HCBEKDRcJCQoKCQkXDQoRCAcPBwAAAAkAAP/gAeABwAAEAAkADgATABgAHQAiACcALAAAJRUzNSMjFTM1IyMVMzUjJRUzNSMjFTM1IyMVMzUjJRUzNSMjFTM1IyMVMzUjAYBgYMBgYMBgYAGAYGDAYGDAYGABgGBgwGBgwGBgQGBgYGBgYMBgYGBgYGDAYGBgYGBgAAAAAgAA/+ACAAHgABgAHwAAASIGBw4BFRQWFx4BMzI2Nz4BNTQmJy4BIwMnNxc3FwcBADVdIyMoKCMjXTU1XSMjKCgjI101MGovO7kX0AHgKCMjXTU1XSMjKCgjI101NV0jIyj+YIoxS5cX8AAABwAg/+AB4AHgAEIAUQBgAG8AfgCNALQAAAUhIiY9ASMiJj0BNDY7ATUjIiY9ATQ2OwE1IyImPQE0NjsBNSMiJj0BNDY7ATUjIiY9ATQ2OwE1NDYzITIWFREUBiMBIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMlNCYnLgEnPgE3IzI2PQE0JisBIgYdARQWMyMeARcOAQcOAR0BMzUB0P6gBwkwBwkJBzAwBwkJBzAwBwkJBzAwBwkJBzAwBwkJBzAJBwFgBwkJB/6QIAcJCQcgBwkJByAHCQkHIAcJCQcgBwkJByAHCQkHIAcJCQcgBwkJByAHCQkHIAcJCQcBIAwLCh0RAgICBwcJCQcgBwkJBwcCAgIRHQoLDMAgCQcQCQcgBwkgCQcgBwkgCQcgBwkgCQcgBwkgCQcgBwkQBwkJB/4gBwkB0AkHBwkJBwcJYAkHBwkJBwcJYAkHBwkJBwcJYAkHBwkJBwcJYAkHBwkJBwcJYgoPBAUGAQEDAQkHYAcJCQdgBwkBAwEBBgUFDgoSEgAEACD/4AHgAeAABAAJAA4AJwAAEzMRIxE7AREjETsBESMRJRUzERQWFx4BMyEyNjc+ATURMzUjNSMVI4BAQGBAQGBAQP7gIAsJCRcMAQAMFwkJCyCAwIABQP7gASD+4AEg/uABIGBA/sAMFwkJCwsJCRcMAUBAQEAAAAAABAADACAB+wGgAGIAewCUAK0AACUyNjc+ATU0JicuASMiBgcOAQcuAScuAScuAScuASczHgEXHgEzMjY3PgE1NCYnLgEjIgYHDgEHIy4BJy4BIyIGBw4BFRQWFx4BMzI2Nz4BNx4BFx4BFx4BFx4BFx4BFx4BMxEyFhceARUUBgcOASMiJicuATU0Njc+ATMFNDY3PgEzMhYXHgEVFAYHDgEjIiYnLgE1BTQ2Nz4BMzIWFx4BFRQGBw4BIyImJy4BNQGzDxoKCgsLCgoaDwsUCAkNBBYcCQoMBwMHBAQLB3sEDggJFAsPGgoKCwsKChoPCxQJCA4E5AQNCQgVCw8aCgkMDAkKGg8LFAkIDgQWHAkJDQYHEQ8QMCYEDQkIFQsJDwYFBwcFBg8JCA8GBgYGBgYPCP5vBgYFEAgJDwYFBwcFBg8JCBAFBgYBaAYGBg8ICQ8GBQcHBQYPCQgPBgYGIAsKChoPDxoKCgsGBgUQCQIQDQ0iFAoWCgsVCgoQBgYGCwoKGg8PGgoKCwYGBhAJCRAGBgYLCgoaDw8aCgoLBgYFEAkCEA0NIhQVLhQUHQQJEQYFBwFiBwYFDwkJDwUGBwcGBQ8JCQ8FBgcqCQ8FBgcHBgUPCQkPBQYHBwYFDwnwCQ8FBgcHBgUPCQkPBQYHBwYFDwkAAAAAAgB4ADMBiAGaABoANQAAASIGBw4BFREUFhceATMyNjc+ATURNCYnLgEjIyIGBw4BFREUFhceATMyNjc+ATURNCYnLgEjAVoKEQYGBwcGBhEKCREGBggIBgYRCbQJEQYGCAgGBhEJChEGBgcHBgYRCgGaBAMEDQr+3AkNBAQDAwQEDQkBJAoNBAMEBAMEDQr+3AkNBAQDAwQEDQkBJAoNBAMEAAABALMATwGzAX4AFQAAJScuAQcOARURFBYXFjY/ARQ2NTQmNQGr2wYKBAQFBQQECgbbCAj0iAMCAwELB/74BwsBBAMCiQEJBAcHAQAAAQAg/+ABxwHgABAAAAU+AScuAQcVJzcVNhYXFgYHAX0VEw0OVlTAwGRyERInNSAnWicnMgJ/wMB8Ak08O4k5AAEAOf/gAeAB4AAQAAABNRcHNSYGBwYWFy4BNz4BFwEgwMBUVg4NExU1JxIRcmQBZHzAwH8CMicnWic5iTs8TQIAAAAADQAA/+ACAAHgAAMABwALABMAGwAfACMAJwArADMANwA7AEMAABMhFSEHMxUjETMVIwM1IzUjFTM1AxUzNTM1MzUHMxUjETMVIwEzFSMjMxUjNxUzFTMVMzUDMxUjOwEVIzcVIxUjFTM1gAEA/wAgICAgICAgIGBgICAgICAgICABYCAgICAgICAgIIAgICAgIEAgIGABQMAgIAFAIP6gICBgIAHgYCAgIEAg/sAgAYAgIIAgICBg/oAgICAgICBgAAAAAA0AAP/gAgAB4AADAAsADwAXABsAHwAjACsALwAzADcAPwBDAAA3MxUjNRUzFTMVMzUHMxUjExUjFSMVMzUnMxUjOwEVIxchFSEBNSM1IxUzNSczFSM3MxUjETMVIycVMzUzNTM1BzMVIyAgICAgIIAgIGAgIGCAICAgICBgAQD/AAFAICBgICAgICAgICBgICAgICAgICBgICAgYGAgAeAgICBgICAgYMABACAgYCBAIEAg/kAggGAgICBAIAAAAAQAKwALAcABtQAKAA8AFAAZAAABFSMVIxUjFSERIwMjNTMVMyMRMxEzIxEzEQErVlVVAZWVQEBAVUBAVUBAAbVVVVaqAar+gKurAQD/AAFW/qoAAAMAKwALAcABtQAKAA8AFAAAARUjFSMVIxUhESMTIxEzETMjETMRAStWVVUBlZUVQEBVQEABtVVVVqoBqv6AAQD/AAFW/qoAAAIAKwALAcABtQAKAA8AAAEVIxUjFSMVIREjEyMRMxEBK1ZVVQGVlWpAQAG1VVVWqgGq/oABVv6qAAAAAAEAKwALAcABtQAKAAABFSMVIxUjFSERIwErVlVVAZWVAbVVVVaqAaoAAAAABAAr//UBwAHLABsAKQAuAEkAAAEHIyIGBw4BHQEUFhceATsBFzoBMREqASMqASMDIyImPQE0Njc+ATsBFRcnNTcRExUeARceARUUBgcOAQcVPgE3PgE1NCYnLgEnARBVVQ4VCAgICAgIFQ5VVRAgCAsFBQsIZUUJCAICAgYFRWpVVVYQEQQEAQEEBBEQGCAKCgkJCgogGAHLawwJChkNew0YCAkKawHW/sAMCXsECgMEBapWVqpW/qoBFi0DDAgIEgsKEwgIDAMsAxMODiMTEyMODhMEAAAAAwAr//UB0wHLAAoAMwA4AAAlFScHHwEWNhU1BwcwNDE1NDY3PgE3FxU3NTcVNzUGJgcmBicHJw4BBw4BHQEUFhceARc3BycBFwEBK0geC1YQHyrAAQICBwRFFVYqCAsEBQsIVlUNFggHCQECAQQCISIeAYoe/nbGkEccAWoBAQH8KygCfAMLAgUEAQFCFC9VLipFAQEBAQEBbAEBCwoJGgx8BAsDBggEIo0fAYod/nQAAAAAAwARAEECAAGAADQARQBOAAABIyIGDwE1NCYnLgEjISIGBw4BHQEUFhceATMhMjY3PgE9ARceATsBMjY3PgE9ATQmJy4BIwEiJj0BNDYzITIWHQEUBiMhJSMnMSc1NzMVAeEOBgsEKggGBhEK/tsKEQYHBwcHBhEKASUKEQYGCCoECwYOBgwEBAUFBAQMBv5fBwkJBwElBwkJB/7bAaEPPhBODwFxBAQnEgkQBgYHBwYGEAnoCRAGBQcHBQYQCRInBAQEBAQLBugGCwQEBP7tCAboBgkJBugGCA46D1dI6AACAAD/4AIAAeAAOQBzAAABJy4BIyIGDwEOARUUFh8BHgEXNy4BLwEuATU0Nj8BPgEzMhYfAR4BFRQGDwEeARceAQc3PgE1NCYnBy4BJwceAR8BHgEVFAYPAQ4BIyImLwEuATU0Nj8BLgEnLgE3Bw4BFRQWHwEeATMyNj8BPgE1NCYvAQHdAhItFxctEW4REhIRAgMHAygEBgMCCgkJCm0JGQwNGAkCCgoKCjEDBQIBAgFNERISEaEDBwMoBAYDAgoJCQptCRkMDRgJAgoKCgoxAwUCAQIBTRESEhECEi0XFy0RbhESEhECAbsCERISEW0SLRcXLRICAgYCKAIFAwIJGA0NGAltCgoKCgIJGA0MGQkyCBAICBEJTREtFxctEp0CBgIoAgUDAgkYDQ0YCW0KCgoKAgkYDQwZCTIIEAgIEQlNES0XFy0SAhESEhFtEi0XFy0SAgAAAAQAAwAAAf8BwgA8AE0AhACPAAATPgEXHgEXFjY3PgE3PgEnLgEnJjY3PgEjIiYHDgEHDgEHDgEHBhYHBiYHDgEHBhQXMBYXHgE3PgE3NiY3FyYiDwEGFB8BHgE/AT4BLwElJgYHDgEHDgEHBiYnLgE1JjY3PgE3NiYHDgEHBhQVDgEPARc3PgE3PgEXFjY3PgE3PgE3NCYnAQYUHwEWNj8BJwdQCREICREKAwUCASQCAQICAg0EEiMZGioKCzsGDRoNDRYIFBIBBgEKCw8HAw4CAwIhAgIKAwMOAQIBCJICBQMlAgLUBAsEGQQBA9MBGwEIAgMRBQIIBgcQCwsIAQUBBBICAQQHBzsGAwEHCyIiKwMMBwYPCA8ZCQoOBQUEAQEB/kkEBBgEDAR9JoMBMAcCAwQQCwMEAQIgAQEEAwIQBhclDg0PAQEBCwgHEAUOEAEFFAoJBAUDCgMCBwMkAwICAwMLAQIXBg4DAiACBgLyBAEEFQMMBPRnCgEEBBsIBAkDAwEICA0FBgkEBx8DAgoDAx8YDBcLCxYKJCgoBAcCAgICAwIEBQ8KCBkNDBYE/qIECwQYBAIFeyx/AAQAAgAcAgEBlQBcAHIAhQCNAAA3LgEvATcnLgEnJjQ1PAE3PgE3PgE3NgQXHgEfATc+ATEyFh8BBxU3PgE3PgE3NjIXHgEXFhQdAQcOAQcOASMiJicuAScuATEwBhUUBgcOAQcGIisBBw4BMTAmJzE3PgEnJiQHDgEHDgEXFRceATMyNjcxFzI2NzY0PQEHDgEHBhYzMjY3MTc1Iw8BFzM1DQIEAgMiBwIGAQMDAgcEBQoHCgEvBQMHAgcVCQ0BBQMHLwYDDggJCwMGGAYFDAEBAwMFBAUGCwkIAwIQCgkOAQUFBA4JBEtNlBYJDgMCy28qAgT+0AQCAwECAQEFAgQBAVxAlgIDAQKHOFEBAyJiRz8CdhJMAU0SIAIFAgMcBwMIAwchW1siBgUJBAMFAQIBAgEEAgQRCAoFAwgoHAUDDQYJCQECAgINBQJKMXgHBAUCAwEBAQEOCAkMBwUKEAYGCAIBEwcLAgK/XCUBAgECAQMCAyhTeQQCAkw2gAQCAyRLbXEuRAECAQEBgXVHWkl1AAAAAQAA/+AB4AHAADYAACUOAQcOASMiJicuAScuAScuATU0Njc+ATc2JicuASMiBjEUFhceARceARceATMwNjU0JicuAQcBYAwOBgYODAwYDAwYDAwXCQkLCwkJFwwMEhISKgwYSBYTEi4XF0QkJUQYYB8VFSsMoAwXCQkLCwkJFwwMGAwMGAwMDgYGDgwMKxUVH2AYRCUkRBcXLhITFkgYDCoSEhIMAAAAAQAAAGECAAFAAFYAACUeARcOAQcOAScuASc+ATc2NCcuAScuASMiBgcOAQcOARceAQcWBgcGJicuATcmNjU+ATc+ATcyIjM+ATc+ATMjMiIzIjIxMzIWFx4BFyIyIx4BFx4BFQH9AgEBAQMGBzIZHCgBAQUDAQkHFgsOGxAOHQwNFAkHAgMBBwEBKhobMAkEBQEBAwIEBQMOCAEBAQ0mGBtDLgECAQIBAgEsRRkaJA8BAQEKDAUDBsAKGAsLEwUJCAICExIJDwgHEAkJCQMCAQECAwkJCRAHCA8JEhMCAggJBRMLCxgKBw8HCBEKDRcJCQoKCQkXDQoRCAcPBwAAAAkAAP/gAeABwAAEAAkADgATABgAHQAiACcALAAAJRUzNSMjFTM1IyMVMzUjJRUzNSMjFTM1IyMVMzUjJRUzNSMjFTM1IyMVMzUjAYBgYMBgYMBgYAGAYGDAYGDAYGABgGBgwGBgwGBgQGBgYGBgYMBgYGBgYGDAYGBgYGBgAAAAAgAA/+ACAAHgABgAHwAAASIGBw4BFRQWFx4BMzI2Nz4BNTQmJy4BIwMnNxc3FwcBADVdIyMoKCMjXTU1XSMjKCgjI101MGovO7kX0AHgKCMjXTU1XSMjKCgjI101NV0jIyj+YIoxS5cX8AAABwAg/+AB4AHgAEIAUQBgAG8AfgCNALQAAAUhIiY9ASMiJj0BNDY7ATUjIiY9ATQ2OwE1IyImPQE0NjsBNSMiJj0BNDY7ATUjIiY9ATQ2OwE1NDYzITIWFREUBiMBIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMlNCYnLgEnPgE3IzI2PQE0JisBIgYdARQWMyMeARcOAQcOAR0BMzUB0P6gBwkwBwkJBzAwBwkJBzAwBwkJBzAwBwkJBzAwBwkJBzAJBwFgBwkJB/6QIAcJCQcgBwkJByAHCQkHIAcJCQcgBwkJByAHCQkHIAcJCQcgBwkJByAHCQkHIAcJCQcBIAwLCh0RAgICBwcJCQcgBwkJBwcCAgIRHQoLDMAgCQcQCQcgBwkgCQcgBwkgCQcgBwkgCQcgBwkgCQcgBwkQBwkJB/4gBwkB0AkHBwkJBwcJYAkHBwkJBwcJYAkHBwkJBwcJYAkHBwkJBwcJYAkHBwkJBwcJYgoPBAUGAQEDAQkHYAcJCQdgBwkBAwEBBgUFDgoSEgAEACD/4AHgAeAABAAJAA4AJwAAEzMRIxE7AREjETsBESMRJRUzERQWFx4BMyEyNjc+ATURMzUjNSMVI4BAQGBAQGBAQP7gIAsJCRcMAQAMFwkJCyCAwIABQP7gASD+4AEg/uABIGBA/sAMFwkJCwsJCRcMAUBAQEAAAAAABAADACAB+wGgAGIAewCUAK0AACUyNjc+ATU0JicuASMiBgcOAQcuAScuAScuAScuASczHgEXHgEzMjY3PgE1NCYnLgEjIgYHDgEHIy4BJy4BIyIGBw4BFRQWFx4BMzI2Nz4BNx4BFx4BFx4BFx4BFx4BFx4BMxEyFhceARUUBgcOASMiJicuATU0Njc+ATMFNDY3PgEzMhYXHgEVFAYHDgEjIiYnLgE1BTQ2Nz4BMzIWFx4BFRQGBw4BIyImJy4BNQGzDxoKCgsLCgoaDwsUCAkNBBYcCQoMBwMHBAQLB3sEDggJFAsPGgoKCwsKChoPCxQJCA4E5AQNCQgVCw8aCgkMDAkKGg8LFAkIDgQWHAkJDQYHEQ8QMCYEDQkIFQsJDwYFBwcFBg8JCA8GBgYGBgYPCP5vBgYFEAgJDwYFBwcFBg8JCBAFBgYBaAYGBg8ICQ8GBQcHBQYPCQgPBgYGIAsKChoPDxoKCgsGBgUQCQIQDQ0iFAoWCgsVCgoQBgYGCwoKGg8PGgoKCwYGBhAJCRAGBgYLCgoaDw8aCgoLBgYFEAkCEA0NIhQVLhQUHQQJEQYFBwFiBwYFDwkJDwUGBwcGBQ8JCQ8FBgcqCQ8FBgcHBgUPCQkPBQYHBwYFDwnwCQ8FBgcHBgUPCQkPBQYHBwYFDwkAAAAAAgB4ADMBiAGaABoANQAAASIGBw4BFREUFhceATMyNjc+ATURNCYnLgEjIyIGBw4BFREUFhceATMyNjc+ATURNCYnLgEjAVoKEQYGBwcGBhEKCREGBggIBgYRCbQJEQYGCAgGBhEJChEGBgcHBgYRCgGaBAMEDQr+3AkNBAQDAwQEDQkBJAoNBAMEBAMEDQr+3AkNBAQDAwQEDQkBJAoNBAMEAAABALMATwGzAX4AFQAAJScuAQcOARURFBYXFjY/ARQ2NTQmNQGr2wYKBAQFBQQECgbbCAj0iAMCAwELB/74BwsBBAMCiQEJBAcHAQAAAwAAAEACAAGAABgAWwB0AAABIgYHDgEHHgEXHgEzMjY3PgE3LgEnLgEjFx4BFx4BFw4BBw4BBw4BBw4BIyImJy4BJy4BJy4BJz4BNz4BNz4BNw4BBw4BFRQWFx4BMzI2Nz4BNTQmJy4BJx4BFwcUBgcOASMiJicuATU0Njc+ATMyFhceARUBACpNISE1EhI1ISFNKipNISE1EhI1ISFNKn4MFAoJEQcHEQkKFAwOHhAQIRERIRAQHg4MFAoJEQcHEQkKFAwBAwICAwEBARQREi4bGy4SERQBAQEDAgIDAX4IBgcRCgoRBwYICAYHEQoKEQcGCAGAFxUVOyQkOxUVFxcVFTskJDsVFRdVBxEJChULCxUKCREHCQ4FBAUFBAUOCQcRCQoVCwsVCgkRBwECAQULBQYLBhsuEhEUFBESLhsGCwYFCwUBAgEYChEHBggIBgcRCgoRBwYICAYHEQoAAAUAAAAAAgAB4AAsAEAAWgBuAIsAAAEeARceARcOAQcOAQcuAScuASc3HgEXNhY3FjY3PgE3PgE3PgE3LgEnLgEnNwcGJgcmIic3FhQXBhYHFgYHDgEHEw8BLgEjLgEnDgEHDgEHHgEXHgEXBx8BAScFHgEXHgEXBy4BJy4BJz4BNz4BFwc+ATc+ATcwNjMOARUGFAceARceARcHLgEnLgEnAaQPGgwLFQcRNiAiTCsLGAoMFQwoBg0FCAwHECIPER0PCxUJChAICA8KCBUKIqMFCAUDCQOcAgIBAgEBFRATLRzhHG0LFAwKGAorTCIgNhEHFQoMGRBcARoBxgH+8QgRBQgHAjcIEAQHBQEBBwcGEgmYBhIICxMNBAEBBAIBAQMEAgsFHAsTCgcRBgFMChkMDx0RIzwUFhYBAQEDAQYDKAMBAgECAQEGAwYNCgYSCAsUDAoVCAsPCCLIAQIBAgKcAwkDBQgFGi8REhMBAV4BbQMGAwEBARYWFDwjER0ODBkKWxoBAcYanAEFBwQQCDcCBwgFEQgLEAgFCQFiChYJChAIAwQMBAcKBwoWCQsRCRwGEQgKEwwAAQAAAAEAAKNDYFZfDzz1AAsCAAAAAADQP0z6AAAAANA/TPoAAP/gAgEB4AAAAAgAAgAAAAAAAAABAAAB4P/gAAACAAAA//8CAQABAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAEAAAACAAAgAgAAOQIAAAACAAAAAgAAKwIAACsCAAArAgAAKwIAACsCAAArAgAAEQIAAAACAAADAgAAAgIAAAACAAAAAgAAAAIAAAACAAAgAgAAIAIAAAMCAAB4AgAAswIAACACAAA5AgAAAAIAAAACAAArAgAAKwIAACsCAAArAgAAKwIAACsCAAARAgAAAAIAAAMCAAACAgAAAAIAAAACAAAAAgAAAAIAACACAAAgAgAAAwIAAHgCAACzAgAAAAIAAAAAAAAAAAoAFAAeAD4AYADCASIBTAFwAY4BpAIQAmoC2gOGBGQFLgWCBgIGQgZ4B1oHmAiUCOYJDAksCU4JsAoQCjoKXgp8CpIK/gtYC8gMdA1SDhwOcA7wDzAPZhBIEIYRghHUEfoSqhOGAAAAAQAAADQAtQANAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABACIAAAABAAAAAAACAA4AjQABAAAAAAADACIAOAABAAAAAAAEACIAmwABAAAAAAAFABYAIgABAAAAAAAGABEAWgABAAAAAAAKADQAvQADAAEECQABACIAAAADAAEECQACAA4AjQADAAEECQADACIAOAADAAEECQAEACIAmwADAAEECQAFABYAIgADAAEECQAGACIAawADAAEECQAKADQAvQBFAHgAYQByAGkAbwAtAEkAYwBvAG4ALQBGAG8AbgB0AHMAVgBlAHIAcwBpAG8AbgAgADEALgAwAEUAeABhAHIAaQBvAC0ASQBjAG8AbgAtAEYAbwBuAHQAc0V4YXJpby1JY29uLUZvbnRzAEUAeABhAHIAaQBvAC0ASQBjAG8AbgAtAEYAbwBuAHQAcwBSAGUAZwB1AGwAYQByAEUAeABhAHIAaQBvAC0ASQBjAG8AbgAtAEYAbwBuAHQAcwBGAG8AbgB0ACAAZwBlAG4AZQByAGEAdABlAGQAIABiAHkAIABJAGMAbwBNAG8AbwBuAC4AAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=") format("woff"),url("data:application/x-font-ttf;base64,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") format("truetype"),url("../fonts/Exario-Icon-Fonts.svg#Exario-Icon-Fonts") format("svg");font-weight:normal;font-style:normal}body{background-color:#fff;margin:0;font-family:\'Open Sans\',Arial,sans-serif;-webkit-font-smoothing:antialiased!important}.callControl{display:none;position:relative;left:0;top:0;height:75px;color:#666;font-family:arial;font-size:18px;font-weight:bold;height:auto;display:block}.callControl input{background:#333;border:1px solid #3c3c3c;color:#d3d3d3;font-family:arial;font-size:18px;padding:0;border-radius:0;width:171px;line-height:30px;padding-left:8px;padding-right:35px}.callControl input:focus{outline:0}.main{position:relative;top:0;left:0;width:100%}.main:-webkit-full-screen-ancestor:not(iframe){position:absolute!important;top:0;left:0;right:0;bottom:0;width:100%;height:100%}.client{position:relative;top:0;left:0}.client.r1280x720{width:1280px}.client.r960x720{width:960px}.client .table{display:table;width:100%}.client .fixed{table-layout:fixed}.client .collapse{border-collapse:collapse}.client .cell{display:table-cell}.client .heading{display:table-row;font-weight:bold}.client .row{display:table-row;margin:0}.client .group{display:table-row-group}.client .fadeable{opacity:0;display:block;z-index:-1;backface-visibility:hidden}.client .fileshare-container{display:none}.client .icon-cog4:before{content:"\\f163"}.client::-webkit-scrollbar{width:8px}.client::-webkit-scrollbar-track,.client::-webkit-scrollbar-thumb{background:#272727}.client::-webkit-scrollbar-track:window-inactive,.client::-webkit-scrollbar-thumb:window-inactive{background:#272727}.client.view-centered{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);backface-visibility:hidden}.client.r640x360,.client.r640x480{width:640px}.client.r320x180,.client.r320x240{width:320px}.full-screen-expanded.client{width:100%!important;height:100%!important}.full-screen-expanded .video{padding-bottom:0;bottom:40px;position:absolute;height:auto!important}.full-screen-expanded .videoBar{top:auto!important;bottom:0;position:absolute}.full-screen-expanded .main{height:100%}.video{position:relative;top:0;left:0;width:100%;height:auto}.video:-webkit-full-screen{position:absolute;height:100%;border:0;z-index:1}.widescreen .video{padding-bottom:56.25%}.standard .video{padding-bottom:75%}.remoteVideo{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background-color:#191414;border-radius:4px;border:2px solid #ddd;box-shadow:0 0 10px #000;border-radius:0;border:0;box-shadow:0 0 1px rgba(0,0,0,0.05);background:#000;background:-moz-linear-gradient(top,#181818 0,#494949 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,#181818),color-stop(100%,#494949));background:-webkit-linear-gradient(top,#181818 0,#494949 100%);background:-o-linear-gradient(top,#181818 0,#494949 100%);background:-ms-linear-gradient(top,#181818 0,#494949 100%);background:linear-gradient(to bottom,#181818 0,#494949 100%);overflow:hidden}.localVideo{display:none;position:absolute;top:auto;left:0;bottom:0;right:auto;width:25%;height:25%;background-color:transparent;z-index:99}.localVideo video{border-radius:0;box-shadow:none;background:#292929;border:1px solid #3c3c3c;cursor:move;width:100%;height:100%;position:absolute}.localVideo .inner{margin:5px;position:absolute;top:0;bottom:0;right:0;left:0}:-webkit-full-screen .remoteVideo{z-index:1}:-webkit-full-screen .localVideo{z-index:2}:-webkit-full-screen .remoteVideo,:-webkit-full-screen .localVideo{border:0;border-radius:0}.videoBar{display:none;position:relative;top:0;left:0;width:100%;height:40px;background:#000;background-image:-ms-linear-gradient(center top,#404040,#000);background-image:linear-gradient(to bottom,#404040,#000);background-image:-webkit-linear-gradient(#404040,#000);background-image:-moz-linear-gradient(top,#404040,#000);border-radius:4px;border:2px solid #ddd;box-shadow:0 0 10px #000;margin-top:5px;background-image:none;border-radius:0;border:0;box-shadow:none;margin-top:0;background:#292929;border-top:1px solid #3c3c3c}.videoBar .icon{display:none;z-index:10;margin:0 2.5px;position:absolute}.videoBar .table{height:100%;margin:6px;margin:0}.videoBar .cell{position:relative;top:0;left:0;width:35px;width:36px}.videoBar .cell .icon{width:100%;text-align:center;margin-top:10px;margin-right:0;margin-left:0}.videoBar .cell .icon a{margin:0}.videoBar .cell:first-child{padding:0}.videoBar span{color:#808080}.videoBar .unmuteAudio{margin-top:-1px}.videoBar .leftSpacer{width:8px}.videoBar .cell-hangup{width:42px}.videoBar .subtitle{display:none}.videoBar .cell-timer{position:relative;top:0;left:0;width:auto}.videoBar .rightSpacer{width:8px}.icon-call,.icon-hangup,.icon-fullScreenExpand,.icon-fullScreenContract,.icon-selfViewDisable,.icon-selfViewEnable,.icon-muteAudio,.icon-unmuteAudio,.icon-link.exario,.icon-dialpadShow,.icon-dialpadHide,.icon-quality1.exario,.icon-quality2.exario,.icon-quality3.exario,.icon-quality4.exario,.icon-settings,.icon-ok,.icon-history,.icon-trash,.icon-left,.icon-right,.icon-transfer,.icon-hold,.icon-resume,.icon-screen-sharing,.icon-screen-sharing-off{font-family:\'Exario-Icon-Fonts\';speak:none;text-decoration:none;margin:0 .35em 0 0;font-size:25px}.icon-link.exario,.icon-quality1.exario,.icon-quality2.exario,.icon-quality3.exario,.icon-quality4.exario{font-family:\'Exario-Icon-Fonts\'!important;font-size:20px!important}.call{display:none;position:absolute;z-index:10;top:25px;left:265px;display:block;position:static;top:auto;left:auto}.icon-call:before{content:"\\e00e";color:#3b9e3b}.icon-call:hover:before{content:"\\e00e";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-hangup:before{content:"\\e00f";color:#f00}.icon-hangup:hover:before{content:"\\e00f";color:#f00}.hangup,.fullScreen,.selfView,.muteAudioIcon,.dialpadIcon,.messages{top:0;left:0}.icon-fullScreenExpand:before{content:"\\e002";color:#fff}.icon-fullScreenExpand:hover:before{content:"\\e002";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-fullScreenContract:before{content:"\\e003";color:#fff}.icon-fullScreenContract:hover:before{content:"\\e003";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-selfViewDisable:before{content:"\\e00a";color:#fff}.icon-selfViewDisable:hover:before{content:"\\e00a";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-selfViewEnable:before{content:"\\e00d";color:#fff}.icon-selfViewEnable:hover:before{content:"\\e00d";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-muteAudio:before{content:"\\e008";color:#fff}.icon-muteAudio:hover:before{content:"\\e008";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-unmuteAudio:before{content:"\\e009";color:#fff}.icon-unmuteAudio:hover:before{content:"\\e009";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-dialpadShow:before{content:"\\e010";color:#fff}.icon-dialpadShow:hover:before{content:"\\e010";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-dialpadHide:before{content:"\\e010";color:#fff}.icon-dialpadHide:hover:before{content:"\\e010";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.quality1{display:none;position:absolute;z-index:10;top:13px;left:15px}.icon-quality1.exario:before{content:"\\e007";color:#0f0;opacity:.4}.quality2{display:none;position:absolute;z-index:10;top:13px;left:15px}.icon-quality2.exario:before{content:"\\e006";color:#ff0;opacity:.4}.quality3{display:none;position:absolute;z-index:10;top:13px;left:15px}.icon-quality3.exario:before{content:"\\e005";color:#f90;opacity:.4}.quality4{display:none;position:absolute;z-index:10;top:13px;left:15px}.icon-quality4.exario:before{content:"\\e004";color:#f00;opacity:.4}#videoBar #settings{width:auto;background-color:transparent}.icon-settings:before{content:"\\e00c";color:#fff;opacity:.4;opacity:1}.icon-settings:hover:before{content:"\\e00c";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-ok:before{content:"\\e011";color:#0f0}.icon-ok:hover:before{content:"\\e011";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-history:before{content:"\\e012";color:#fff;opacity:.4}.icon-history:hover:before{content:"\\e012";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-trash:before{content:"\\e013";color:#f00}.icon-trash:hover:before{content:"\\e013";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-left:before{content:"\\e000";color:#0f0}.icon-left:hover:before{content:"\\e000";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-right:before{content:"\\e001";color:#0f0}.icon-right:hover:before{content:"\\e001";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-transfer:before{content:"\\e014";color:#fff}.icon-transfer:hover:before{content:"\\e014";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-hold:before{content:"\\e015";color:#fff}.icon-hold:hover:before{content:"\\e015";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-resume:before{content:"\\e016";color:#fff}.icon-resume:hover:before{content:"\\e016";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-screen-sharing:before{content:"\\e604";color:#fff}.icon-screen-sharing:hover:before{content:"\\e604";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.icon-screen-sharing-off:before{content:"\\e605";color:#fff}.icon-screen-sharing-off:hover:before{content:"\\e605";color:<%= iconHightlightColor %>}color:<%= iconHightlightColor %>;.button:active{color:#04aff0;background:-webkit-gradient(linear,left top,right bottom,from(#7cdd07),to(#faa51a));background:linear-gradient(to bottom left,#7cdd07,#faa51a)}.button:hover{box-shadow:0 0 10px #999}.icon-link.exario:before{content:"\\e00b"}.callPopup,.reInvitePopup,.transferPopup,.callHistoryDetails,.authPopup{display:none;background:#333;padding:10px;border:2px solid #ddd;float:left;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;box-shadow:0 0 10px #999;border-radius:3px;font-size:14px;line-height:18px;z-index:100}.callPopup,.reInvitePopup{width:170px;height:137px}.transferPopup{color:#fff;width:280px;height:60px}.transferTarget{width:200px}.popup .actions{text-align:right}.popup .title{font-weight:bold;font-size:16px;color:#fff}.callPopup{padding:0;background:#292929;border:1px solid #3c3c3c;box-shadow:none;width:220px;border-radius:0;height:168px}.callPopup span{color:#999;font-size:22px}.callPopup .incomingCallTitle{display:block;padding:8px;font-size:18px;font-weight:bold;background:#3c3c3c;margin-bottom:18px;color:#e4e4e4}.callPopup .acceptIncomingCall{background:#3da005;border:0;border-radius:20px;padding:5px 10px;font-size:14px;color:#fff;margin-left:12px}.callPopup #rejectIncomingCallContainer button{background:#f00;border:0;border-radius:20px;padding:5px 10px;font-size:14px;color:#fff;margin-right:12px}.ui-widget-content.ui-dialog{display:none;color:#999;font-size:22px;background:#333;padding:10px;border:2px solid #ddd;box-shadow:0 0 10px #999;border-radius:3px;z-index:99}.no-close .ui-dialog-titlebar-close{display:none}.settingsPopup{display:none;background:#333;padding:2px;border:2px solid #ddd;position:absolute;top:5px;left:5px;overflow-x:hidden;overflow-y:scroll;width:435;height:180;box-shadow:0 0 10px #999;border-radius:3px;font-size:20px;line-height:28px;z-index:99;border:1px solid #3c3c3c;background:#292929;border-radius:0;box-shadow:none;bottom:40px;right:0;top:auto;left:auto;width:304px!important;font-size:14px;height:276px;overflow:hidden}.settingsPopup span{color:#999;font-size:20px;font-size:14px}.settingsPopup [type="checkbox"]{width:18;height:18;vertical-align:middle}.settingsPopup .short{width:36px}.settingsPopup input{background:#333;border:1px solid #414141;color:#eee;padding-left:5px;line-height:22px;font-size:13px}.settingsPopup .tabs span{margin-right:5px;color:#fff}.settingsPopup .btn{background:#04aff0;color:#fff;padding:5px 10px;text-decoration:none;border-radius:20px;margin-left:9px;margin-top:15px;font-weight:700;text-align:center}.settingsPopup .btn:hover{background:#017ead}.settingsPopup .clear{color:#04aff0;margin-left:10px;text-decoration:none;font-weight:700}.settingsPopup .clear:hover{color:#017ead}.authPopup{width:210px;height:200px}.authPopup span{color:#999;font-size:14px;line-height:18px}.authPopup input{background:#666;border-bottom:1px solid #333;border-left:1px solid #000;border-right:1px solid #333;border-top:1px solid #000;color:#fff;border-radius:3px;font-family:arial;font-size:16px;padding:6px 6px 4px;width:200px}.authPopup button{border-color:#999;border-width:1px;border-radius:4px;color:#333;cursor:pointer;padding:6px 6px 4px;margin-top:10px;font-size:12px;width:200px}.authPopup #alert{font-size:20px;text-align:center;color:#f00}.dialpad{padding:15px;background:#292929;border:1px solid #3c3c3c;display:none;position:absolute;bottom:40px;right:auto;width:170px;top:auto;left:0;letter-spacing:5px;z-index:100;box-sizing:content-box;height:228px;padding-left:14px}.dialpad button{color:#333;opacity:.8;font-family:arial;font-size:20px;width:30px;border-color:#000;border-width:1px;border-radius:4px;border-spacing:5em;font-weight:bold;line-height:33px;margin:.1em;border-top-style:outset;cursor:pointer;color:#b3b3b3;background:0;border-radius:0;font-weight:normal;padding:0;margin:0;border:0;width:50px}.dialpad button:active{color:#04aff0;background:-webkit-gradient(linear,left top,left bottom,from(#f47a20),to(#faa51a));background:linear-gradient(to left bottom,#f47a20,#faa51a)}.dialpad button:hover{box-shadow:1px 1px 20px #999;background:#3a3a3a;box-shadow:none}.dialpad button:focus{outline:0}.dialpad button span{display:block;font-size:8px;text-align:center;font-weight:bold;margin-top:-13px;color:#2d7b99}.dialpad .history-button{font-size:16px!important;padding-top:5px;padding-bottom:5px;outline:0;position:absolute;right:4px;top:5px;width:25px}.dialpad .history-button.active{color:#04aff0}.connected-icon{display:none;position:absolute;top:13px;right:5px}.registered-icon{display:none;position:absolute;top:13px;right:40px}.timer{display:none;position:absolute;top:3px;left:0;width:100%;text-align:center;font-family:arial;font-size:16px;top:11px}.timer{color:<%= timerColor %>}color:<%= infoMessageColor %>;color:<%= successMessageColor %>;color:<%= successMessageColor %>;color:<%= alertMessageColor %>;.callStats{display:none;position:absolute;top:10px;color:#666;left:660px;width:400px;padding:2px;border-radius:4px;border:2px solid #ddd;box-shadow:0 0 10px #999;color <%= statsColor %>top:auto;bottom:40px;right:0;left:auto}color <%= statsColor %>.callStats .statsVideo{position:absolute;white-space:pre-wrap;color:#0082ff;left:10px;font-family:arial;font-size:18px;text-decoration:none}.callStats .statsAudio{position:absolute;white-space:pre-wrap;color:#0082ff;left:260px;float:left;font-family:arial;font-size:18px;text-decoration:none}.callStats a{color:#2ba6cb}.callStats .spacer{height:15px}.callStats .statsDelay{display:none}.unsupported{position:absolute;top:240px;left:30px;width:600px;background-color:#191414;text-align:center;display:none;color:#fff;z-index:10}#whiteboard_unsupported,#screen_sharing_unsupported{position:relative;top:0;left:0;margin:10px;background:#f00}#screen_sharing_unsupported{display:none}#screen_sharing_unsupported span{text-decoration:underline}.stats-table-container,.stats-graph-sub-container{display:none}.stats0-selected .kiloBitsSentPerSecond-video,.stats1-selected .kiloBitsSentPerSecond-audio,.stats2-selected .kiloBitsReceivedPerSecond-video,.stats3-selected .kiloBitsReceivedPerSecond-audio,.stats4-selected .packetsLost-video,.stats5-selected .packetsLostPer-video,.stats6-selected .packetsLost-audio,.stats7-selected .packetsLostPer-audio,.stats8-selected .googFrameRateSent-video,.stats9-selected .googFrameRateReceived-video,.stats10-selected .audioOutputLevel-audio,.stats11-selected .audioInputLevel-audio,.stats12-selected .googFrameWidthReceived-video,.stats13-selected .googFrameHeightReceived-video,.stats14-selected .googFrameWidthSent-video,.stats15-selected .googFrameHeightSent-video,.stats16-selected .googRtt-audio,.stats17-selected .googJitterReceived-audio{display:block}.client .row:before,.client .row:after{display:none}.stats-graph-sub-container canvas{width:100%}.resolutionSubType{display:none}.enable-file-share .fileshare-container{display:table}.holdAndAnswerButton,.dropAndAnswerButton,.acceptIncomingCall{display:none}.started .holdAndAnswerButton,.started .dropAndAnswerButton,.client:not(.started) .acceptIncomingCall{display:inline-block}.started .watermark-icon{display:none;transform:none;box-shadow:0 0 1px rgba(0,0,0,0.05)}.started .remoteVideo{box-shadow:0 0 1px rgba(0,0,0,0.1)}.connected .watermark-icon{box-shadow:0 0 1px rgba(0,0,0,0.05)}.enable-mute.unmuted.started .muteAudioIcon,.enable-mute.muted.started .unmuteAudioIcon,.enable-full-screen.full-screen-contracted .fullScreenExpand,.enable-full-screen.full-screen-expanded .fullScreenContract,.enable-self-view.self-view-enabled .selfViewDisable,.enable-self-view.self-view-disabled .selfViewEnable,.enable-self-view.self-view-enabled .localVideo,.enable-settings .settings,.enable-dialpad.dialpad-shown .dialpadIconHide,.enable-dialpad.dialpad-hidden .dialpadIconShow,.started .hangup,.calling .hangup,.enable-call-control.connected .call,.enable-transfer.started .transfer,.enable-timer.started .timer,.client:not(.held).enable-hold.started .hold,.enable-hold.started.held .resume,.enable-screen-sharing.screen-sharing-off .shareScreen,.enable-screen-sharing.screen-sharing .stopShareScreen,.enable-file-share.started .file_share{transition:all 1s linear;opacity:1;z-index:20}.enable-transfer.started.transfer-visible .transferPopup,.client:not(.disconnected).auth-visible .authPopup,.reInvite .reInvitePopup,.enable-dialpad.dialpad-shown .dialpad,.enable-settings.settings-shown .settingsPopup,.incomingCall .callPopup{transition:all 1s linear;opacity:1;z-index:100}.enable-screen-sharing.screen-sharing .shareScreen,.enable-screen-sharing.screen-sharing-off .stopShareScreen,.enable-mute.connected .muteAudioIcon,.enable-mute.disconnected .muteAudioIcon,.enable-mute.connected .unmuteAudioIcon,.enable-mute.disconnected .unmuteAudioIcon,.enable-mute.muted .muteAudioIcon,.enable-mute.unmuted .unmuteAudioIcon,.enable-full-screen.full-screen-expanded .fullScreenExpand,.enable-full-screen.full-screen-contracted .fullScreenContract,.enable-self-view.self-view-disabled .selfViewDisable,.enable-self-view.self-view-enabled .selfViewEnable,.enable-self-view.self-view-disabled .localVideo,.enable-settings.settings-hidden .settingsPopup,.enable-dialpad.dialpad-hidden .dialpadIconHide,.enable-dialpad.dialpad-shown .dialpadIconShow,.enable-dialpad.dialpad-hidden .dialpad,.connected .hangup,.disconnected .hangup,.client:not(.connected) .call,.enable-transfer.connected .transfer,.enable-transfer.disconnected .transfer,.enable-transfer.transfer-hidden .transferPopup,.client.disconnected .authPopup,.client.auth-hidden .authPopup,.reInvite-done .reInvitePopup,.client.held .hold,.client:not(.started) .hold,.client:not(.held) .resume,.client:not(.started) .resume,.client:not(.started) .timer,.client:not(.started) .file_share{transition:all 1s linear;opacity:0;z-index:-1}.sign-in,.sign-out{display:none}.client:not(.registered) .sign-in,.client.registered .sign-out{display:block}.client:not(.enable-mute) .cell-muteAudio,.client:not(.enable-transfer) .cell-transfer,.client:not(.enable-hold) .cell-hold,.client:not(.enable-timer) .cell-timer,.client:not(.enable-full-screen) .cell-fullScreen,.client:not(.enable-self-view) .cell-selfView,.client:not(.enable-settings) .cell-settings,.client:not(.enable-dialpad) .cell-dialpad,.client:not(.enable-shareScreen) .cell-shareScreen,.client:not(.enable-call-control) .callControl{display:none!important}.historyRowSample{display:none}.callLink{text-align:left;background:#6f6f6f;float:left;padding:6px 10px 6px 10px;text-decoration:none;font-weight:bold;color:#fff!important;border-radius:50px;font-size:14px!important}.view-audioOnly .video,.view-audioOnly .fullScreenExpand,.view-audioOnly .fullScreenContract,.view-audioOnly .selfViewDisable,.view-audioOnly .selfViewEnable,.view-audioOnly .quality1,.view-audioOnly .quality2,.view-audioOnly .quality3,.view-audioOnly .quality4,.view-audioOnly .cell-fullScreen,.view-audioOnly .cell-selfView{display:none!important}.client.view-audioOnly,.view-audioOnly .videoBar{display:inline-block;width:auto}.view-audioOnly .videoBar .table{table-layout:auto;width:auto}.view-audioOnly .cell-hangup{width:35px!important}.view-audioOnly .timer{position:relative;margin-right:10px}.view-audioOnly .messages{left:10px!important;top:48px!important;font-weight:bold;font-size:14px}.view-audioOnly .dialpad{top:45px}.view-conference .selfViewDisable,.view-conference .selfViewEnable{text-align:right!important}.view-conference .fullScreenExpand,.view-conference .fullScreenContract{text-align:left!important}.view-conference .cell-hangup{width:30px!important;top:2px}.view-conference .videoBar .cell .hangup{margin-top:0;width:140px;background-color:#f00;border-radius:5px;margin-left:10px;height:36px;line-height:14px}.view-conference .hangup .subtitle{display:block!important;font-size:14px;color:#fff}.view-conference .icon-hangup:before,.view-conference .icon-hangup:hover:before{color:#fff!important}@font-face{font-family:\'bsl_icons\';src:url("../fonts/bsl_icons.eot?") format("embedded-opentype")}@font-face{font-family:\'bsl_icons\';src:url("data:application/font-woff;base64,d09GRk9UVE8AACYcAAoAAAAAJdQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABDRkYgAAAA9AAAIRQAACEUOV3yhE9TLzIAACIIAAAAYAAAAGAOkhLWY21hcAAAImgAAAEkAAABJCRZIRxnYXNwAAAjjAAAAAgAAAAIAAAAEGhlYWQAACOUAAAANgAAADYCFTuzaGhlYQAAI8wAAAAkAAAAJAgCBC9obXR4AAAj8AAAALgAAAC4oWYIlm1heHAAACSoAAAABgAAAAYALlAAbmFtZQAAJLAAAAFLAAABS8VkKhxwb3N0AAAl/AAAACAAAAAgAAMAAAEABAQAAQEBCmJzbF9pY29ucwABAgABADr4HAL4GwP4GAQeCgAJd/+Lix4KAAl3/4uLDAeLS/rU+lQFHQAAAXIPHQAAAXcRHQAAAAkdAAAhCxIALwEBChMVFxofJCkuMzg9QkdMUVZbYGVqb3R5foOIjZKXnKGmq7C1ur/Eyc7T2N3i5+xic2xfaWNvbnNic2xfaWNvbnN1MHUxdTIwdUU2MDB1RTYwMXVFNjAydUU2MkN1RTYzNHVFNkJCdUU2QzB1RTZDMXVFNkMydUU2QzN1RTZEOHVFNkQ5dUU2REF1RTZEQnVFNkRDdUVEM0J1RUVCM3VGMTYydUYxNjN1RjE2N3VGMTcwdUYxNzF1RjE3MnVGMTdGdUYxODZ1RjFCOXVGMUZFdUYyQzd1RjJDOXVGMkNGdUYyRDR1RjM0QnVGMzcxdUYzQTR1RjQ1Q3VGNDY1dUY0Nzd1RjRCQnVGNUE0dUY1QTV1RjVBQnVGNUFDAAACAYkALAAuAgABAAQABwAKAA0AgwEcA6wEAgR1BJQFdgYUBnQGngbgBwQHNwexCA0KzQ1YDsUQahFlEcUSpRSCFQAWcRfQGDMYpxlCGbQaIRq/G0kb6BxLHKcdIR1bHaQd5x5vHzT+lA7+lA7+lA78lA76jfgUFZNUkT9ybmJb+5mLi+uLu7arYrtiukOMOos6i0OKYlxiW7Zri1uLK/uZi2K7cqiR15PCCJGwmrO9vouLi4uLi9bR9wXE94aMCIuLBYyLjYuMi4yLjYuMiwiLiwX3hor3BVLWRYuLi4uLi71YmmORZggO+jr38hVV6Kv3C+nBCCb3QwVvemmBZ4sgizTji/cACPtdiwWLaoJpemxVLvsMay7BCCb7QgWoeqRznWzBLmr7Cy5VCPD7QgWom6yVrov2i+I0jPsACPddiwWLrJOtnanB6PcLq+lVCO/3QwVum3OjeaoI/Dr7ARX7B4sv54v3B4v3B+fn9weL9weL5y+L+weL+wcvL/sHiwgO97n3ghWL+wIFi3yFfoGAgIB+hnyLCPtLiwV8i36QgJaAloaYi5oIi/cCBYuakJiWlpaVmJGaiwj3S4sFmouYhZaBlYCRfot8CIv3uBWL+wEFi3uFfoGBgIB+hnyLCPtLiwV8i36QgJaAlYaYi5sIi/cBBYubkJeWlpaWmJCaiwj3S4sFmouYhpaAlYCRf4t7CPgB+7gVi/sCBYt8hn6AgIGAfoZ7iwj7SosFe4t+kIGWgJaGmIuaCIv3AgWLmpCYlpaVlZiRm4sI90qLBZuLmIWVgZaAkH6LfAj8AfjdFYv7AgWLfIV+gYCAgX6FfIsI+0uLBXyLfpGAlYCWhpiLmgiL9wIFi5qQmJaWlpWYkZqLCPdLiwWai5iFloGVgJF+i3wI+AH7uRWL+wEFi3uGfoCBgYB+hnuLCPtKiwV7i36QgZaAlYaYi5sIi/cBBYubkJeWlpWWmJCbiwj3SosFm4uYhpWAloCQf4t7CPgC+7gVi/sCBYt8hn6AgICAfoZ8iwj7S4sFfIt+kICWgZaFmIuaCIv3AgWLmpGYlZaWlZiRmosI90uLBZqLmIWWgZaAkH6LfAj8AvjdFYv7AgWLfIZ+gICBgX6Fe4sI+0qLBXuLfpGBlYCWhpiLmgiL9wIFi5qQmJaWlZWYkZuLCPdKiwWbi5iFlYGWgJB+i3wI+AL7uRWL+wEFi3uGfoCBgIB+hnyLCPtLiwV8i36QgJaBlYWYi5sIi/cBBYubkZeVlpaWmJCaiwj3S4sFmouYhpaAloCQf4t7CIv3uRWL+wIFi3yGfoCAgIF+hXyLCPtLiwV8i36RgJWBloWYi5oIi/cCBYuakZiVlpaVmJGaiwj3S4sFmouYhZaBloCQfot8CA75VPfUFUtLi0tLi0uLS8tLy0vLS8uLy4vLy4vLy8vL+1T3VEuLS4v7FPtUi4uL+xT3GPuX9xD7EfcR+xD3l/sY9xSLCIuL91T3FIvLi8v7VPdUS0sIDvkn92cV+2f3Zov3r/cUi4v7efdB+0IF+4H5JxX7r4v7eft5i/uvi/uv93n7efevi/evi/d593mL96+L96/7efd5+6+LCIv+FBX7aIv7QPdAi/doi/do90D3QPdoi/doi/dA+0CL+2iL+2j7QPtA+2iLCA73FPnUFffUi4v9lPvUiwX4VPmUFffUi4v9lPvUiwUOy/oOsRV/i36QgpR4noupnp7j47v3CIv3EIv3EFv3CDPjeJ6LqZ6enp6pi5549SHF+yCL+yqL+ypR+yAhIQiCgn6Gf4sI+z7lFX6Lf5CClXidi6qenfcX9xeL92r7F/cXeJ2Lqp6dnZ6qi5143Tq4+wGL+weL+wde+wE5OoKBf4Z/iwj7P+YVf4t+kIKUeJ6LqZ6e3NyL9xg63Hiei6menp6eqYueePcK+wuL+1T7CvsLgoJ+hn+LCPso+SoVpaWggotnCIv90AWLZ3aCcaUI+4X3hfs0i4v4FPc0i/eF94UFDvlk9xQVfot/kIKVeJ2Lqp6d9xf3F4v3avsX9xd4nYuqnp2dnqqLnXjdOrj7AYv7B4v7B177ATk6goF/hn+LCPs/5hV/i36QgpR4noupnp7c3Iv3GDrceJ6LqZ6enp6pi5549wr7C4v7VPsK+wuCgn6Gf4sI+yj5KhWlpaCCi2cIi/3QBYtndoJxpQj7hfeF+zSLi/gU9zSL94X3hQUO+Ln3bxV/i36QgpR4noupnp7c3Iv3GDrceJ6LqZ6enp6pi5549wr7C4v7VPsK+wuCgn6Gf4sI+yj5KhWlpaCCi2cIi/3QBYtndoJxpQj7hfeF+zSLi/gU9zSL94X3hQUO+CX6BRWlpaCCi2cIi/3QBYtndoJxpQj7hfeF+zSLi/gU9zSL94X3hQUOi/pUFYv+lPqUi4v6lP6UiwX6VP5UFf4Ui4v6FPoUi4v+FAX7VPl0FfvU+9T7VPdU+xT7FPfU+9T4VPhU+xT3FAUOi/pUFYv+lPqUi4v6lP6UiwX6VP5UFf4Ui4v6FPoUi4v+FAUOi/pUFYv+lPqUi4v6lP6UiwX6VP5UFf4Ui4v6FPoUi4v+FAX9VPlUFfiUi4v8lPyUiwUO+JT6VBX7r4v7eft5i/uvi/uv93n7efevi/evi/d593mL96+L96/7efd5+6+LCIv+FBX7aIv7QPdAi/doi/do90D3QPdoi/doi/dA+0CL+2iL+2j7QPtA+2iLCPtU+BQVi/Xh4fWL9YvhNYshiyE1NSGLIYs14Yv1CA74lPpUFfuvi/t5+3mL+6+L+6/3eft596+L96+L93n3eYv3r4v3r/t593n7r4sIi/4UFftoi/tA90CL92iL92j3QPdA92iL92iL90D7QIv7aIv7aPtA+0D7aIsIDvoL92UV+xyLBXiLe5J+mH6YhJuLngiL0AWLnpKbmJiYmJuSnosI9xyLBZ6LnISYfph+knuLeAiLRgWLeIR7fn5+fnqEeIsIi/elFfsciwV4i3uSfph+mISbi54Ii9AFi56Sm5iYmJibkp6LCPcciwWei5yEmH6YfpJ7i3gIi0YFi3iEe35+fn56hHiLCIv3pRX7HIsFeIt7kn6YfpiEm4ueCIvQBYuekpuYmJiYm5Keiwj3HIsFnouchJh+mH6Se4t4CItGBYt4hHt+fn5+eoR4iwj76f3HFfsciwV4i3qSfph+mISbi54Ii9AFi56Sm5iYmJickp6LCPcciwWei5uEmH6YfpJ7i3gIi0YFi3iEe35+fn57hHiLCIv3pRX7HIsFeIt6kn6YfpiEm4ueCIvQBYuekpuYmJiYnJKeiwj3HIsFnoubhJh+mH6Se4t4CItGBYt4hHt+fn5+e4R4iwiL96UV+xyLBXiLepJ+mH6YhJuLngiL0AWLnpKbmJiYmJySnosI9xyLBZ6Lm4SYfph+knuLeAiLRgWLeIR7fn5+fnuEeIsIi/elFfsciwV4i3qSfph+mISbi54Ii9AFi56Sm5iYmJickp6LCPcciwWei5uEmH6YfpJ7i3gIi0YFi3iEe35+fn57hHiLCPvp/LYV+x2LBXiLe5J+mH6YhJuLngiL0AWLnpKbmJiYmJuSnosI9x2LBZ6Lm4SYfph+knuLeAiLRgWLeIR7fn5+fnuEeIsIi/elFfsdiwV4i3uSfph+mISbi54Ii9AFi56Sm5iYmJibkp6LCPcdiwWei5uEmH6YfpJ7i3gIi0YFi3iEe35+fn57hHiLCIv3pRX7HYsFeIt7kn6YfpiEm4ueCIvQBYuekpuYmJiYm5Keiwj3HYsFnoubhJh+mH6Se4t4CItGBYt4hHt+fn5+e4R4iwgO+lRLFfsUiwV6i3yRfph+mIWai5wIi/cUBYuckZqYmJiYmpGciwj3FIsFnIuahZh+mH6RfIt6CIv7FAWLeYV8f39+fnyFeYsIi/gUFfsUiwV6i3yRfph+l4Wai50Ii/cUBYudkZqYmJiXmpGciwj3FIsFnIuahZh/mH6RfIt5CIv7FAWLeYV8f39+fnyFeYsIi/gUFfsUiwV6i3yRfph+mIWai5wIi/cUBYudkZqYmJiXmpGciwj3FIsFnIuahZh/mH6RfIt5CIv7FAWLeoV8f35+fnyFeYsI/BT9lBX7FIsFeYt8kX+YfpiFmoucCIv3FAWLnJGamJiYmJqRnIsI9xSLBZ2LmoWYfpd+kXyLegiL+xQFi3mFfH9/fn58hXmLCIv4FBX7FIsFeYt8kX+YfpeFmoudCIv3FAWLnZGamJiYl5qRnIsI9xSLBZ2LmoWYf5d+kXyLeQiL+xQFi3mFfH9/fn58hXmLCIv4FBX7FIsFeYt8kX+YfpiFmoucCIv3FAWLnZGamJiYl5qRnIsI9xSLBZ2LmoWYf5d+kXyLeQiL+xQFi3qFfH9+fn58hXmLCPwU/ZQV+xSLBXqLfJF+mH6YhZqLnAiL9xQFi5yRmpiYmJiakZyLCPcUiwWci5qFmH6YfpF8i3oIi/sUBYt5hXx/f35+fIV5iwiL+BQV+xSLBXqLfJF+mH6XhZqLnQiL9xQFi52RmpiYmJeakZyLCPcUiwWci5qFmH+YfpF8i3kIi/sUBYt5hXx/f35+fIV5iwiL+BQV+xSLBXqLfJF+mH6YhZqLnAiL9xQFi52RmpiYmJeakZyLCPcUiwWci5qFmH+YfpF8i3kIi/sUBYt6hXx/fn5+fIV5iwgO9yb3FBWL+wIFi4aKh4eHiIiGiYaLCPsCiwWGi4eNh46Ij4mPi5AIi/cCBYuQjZCOjo+Pj4yQiwj3AosFkIuQio6Hj4iMhouGCPdw1BWL+0sFi4aJh4iHh4iHiYWLCPsBiwWFi4eNiI6Hj4mPi5AIi/dLBYuQjZCPjo6Pj4yRiwj3AYsFkYuPio+HjoiNhouGCPdv9yYVi/vdBYuGiYeIh4iIhomGiwj7AosFhouGjYiOiI+Jj4uQCIv33QWLkY2Pjo+OjpCNkIsI9wKLBZCLkImOiI6HjYeLhQj3cPdwFYv8uQWLhomHh4eIiIeJhYsI+wGLBYWLh42HjoiPiY+LkAiL+LkFi5CNkI6Oj46PjZGLCPcBiwWRi4+JjoiPiI2Gi4YI92/3uBWL/d0Fi4aJh4iHh4iHiYaLCPsCiwWGi4aNiI6Hj4qPi5AIi/ndBYuRjI+Pj46OkI2Qiwj3AosFkIuPiY+IjoeNh4uFCA77Jvjd+EsVi7N9rm6nb6homWOLYotpfW5ub299aItji2KZaaduqG+tfbSLs4uumaenqKiZrYu0CPe5yRWL+xMFi4eJhoiHiIeHiIeLCCF7BYR2g3qEfZh4n3Cnao+GjYeLhouGiYaHh4F9eHdwcG9wen2Ci4eLho2Fjgg8yQV7gnmEeYWFV4ZohniIgISGgIsI+xOLBYaLho2HjoeOiY+LkAh79AV4kXqSe5MIO04Fh4iGiYaLhYuGjYePW7dsq3yfiI+KkIuQi4+NkI6PkJOVl5mdmJyWmJKVgJ6DnoaeCCOaBYaMh42Ij4iPiZCLkAiL9xIFi5CNj46Qjo+OjY+MCPabBZCdkpyVnXygdqZyqYeQiZCLj4uPjY+OkJWZnp+np6amnZmUi5CLj4mQhwjaTgWck5yTnZCRv5GvkJ6OlZGRlosI9xOLBZGLj4mPiI+IjYeMhgibIQWehZyEmoMI3MgFj4+PjZGLkIuQiY+HvV6qapl4jYiNhouGi4eJhoiHhYOCfn16fXqBfYSClXiTeJF5CPN7BZCKj4mOh46HjYaLhggO+yb4lPkUFYv7lAWLhomGiIiHh4eKhosI+0uLBYaLhoyIj4eOipCLkAiLsAWLkIyPj4+OjpCNkIsI9xSLi/ddBYuQjZCOjo6PkIyQiwiwiwWQi4+Kj4eOiI2Gi4YI94L7XRWLw32/b7tvumWxXKdbp1eZU4tSi1d9XG9bb2Zlb1xvW31Xi1OLUplXp1ynW7Bmu28Ium+/fcSLw4u/mbunuqexsKe7p7qZv4vECPcUixWLO3dCZEhkR1VWSGRIZEF3PIs7i0KfSLJHslbAZM9kznfUi9uL2p/Vss6yzsDBz7IIzrLUn9uL2ovVd85kzmTBVbJIskifQYs8CA783fhL+YIVi/0CBYuBh4OEg4SEgoeBi4GLg4+Ekgj7U/dT+ymLBYGLgo6EkoSTh5OLlQiL93AFi5SPlJKSkpOUjpWLCPcpi/dT91IFkpOTjpWLlYuUiJKDkoSPg4uBCA78AvhL+YIVi/0CBYuBh4OEg4SEgoeBi4GLg4+Ekgj7U/dT+ymLBYGLgo6EkoSTh5OLlQiL93AFi5SPlJKSkpOUjpWLCPcpi/dT91IFkpOTjpWLlYuUiJKDkoSPg4uBCPdv+8sVi26DcHtye3J1eXGBh4mGioWLgouCjoSSg5KIlIuVi5ONkpCRj5CRkJGPko+Rj5KQCJGQkZKPk5CUjZaLmIuYiZaGk4eUhZKFkISPhZCEj4WPhZCHkIaRiZGLk4uWjpOTkgiSkpSPlIuRi5CKj4mlgaF5m3KbcpNwi24IDkL4S/mCFYv9AgWLgYeDhIOEhIKHgYuBi4OPhJII+1P3U/spiwWBi4KOhJKEk4eTi5UIi/dwBYuUj5SSkpKTlI6Viwj3KYv3U/dSBZKTk46Vi5WLlIiSg5KEj4OLgQj3b/vLFYtug3B7cntydXlxgYeJhoqFi4KLgo6EkoOSiJSLlYuTjZKQkY+QkZCRj5KPkY+SkAiRkJGSj5OQlI2Wi5iLmImWhpOHlIWShZCEj4WQhI+Fj4WQh5CGkYmRi5OLlo6Tk5IIkpKUj5SLkYuQio+JpYGheZtym3KTcItuCPcnixWLUXpVa1lrWmBnVXWGiYeKhouBi4KOhJOEkoeUi5SLmpKXmpKhlpmUk5CnoKGlm6oIm6qSrIuui66ErHuqe6p1pW+fg5F9lHWWfJKElouai5WPlJKSkpKUj5WLkIuPipCJCMF1tmerWatanFWLUQj3JosVizNzO1pBW0JLVTpohoqGioaLgYuDjoSSg5OIk4uVi5mSlpqUjoyPjZGOkY2PjY6NCJyUm5WZlbmusLalv6a/mMKLxYvFfsJwv3G/ZrZdrn2Ve5R6lYiMh42FjoWNh42IjQh8lISWi5mLlI6Uk5KSk5OOlYuQi5CKkIncactVu0G8QqM6izQIDvqU+YIVi/0CBYt7hIB8hIaJhoqGi4GLg4+Ekgj7e/d7iywFi117ZWtqa2tke16LCPwmiwVdi2Sba6trrHuxi7kIi/gmBYu4m7Krq6urspy5iwj4JosFuIuyeqtrq2ubZIteCIst93v3eQWSk5OOlYuQi5CKkImahZKAi3sIDkL5ufgWFYv7KAWLXXpla2pra2R7XosI/G+LBV2LZJtrq2use7GLuQiL+G8Fi7ibsqurq6yym7mLCPcliwWQi5CJjoePiI2Gi4aLgYaFgYltgXKAdn6HiYiLiYsIS4sFcYt2gnl5eXmCdYtyCIv8bwWLcpR1nXmdeaCCpYsI+G+LBaSLoZSdnZydlKGLpAiL9w4Fi5KPkZKPlZCWkpWUkZGRjJOIk4iPhYuECPcb968V+2/7bwWEg4KIgYuGi4eMho18kYOWi5sIi/cCMIsF+w+LN3JgWV1XfTGc+xSMgoiFgoeIiomKiYuFi4aOh5CHkIeRh5KHkYOYgZ+AnoGeg54Ig52EoYSkhaSHoougi56MnIybjZuNnY+dj52RnJGakpqUm5ablpuYmZqXmpedl6CWCKCWo5Slk6aSqZGuj62PsI60iwjmi4v3AQWLm5OXmpGQjY+MkIuVi5OHk4QI92/7bwWSg4+Di4GLgYeChIQIDvtv+bn3hhWLgYl+h3qHeod+h4KDeHR3ZHVneGiBaIuBi4GMgYyBjICOf45/j4KNhY6FjYCPfJAIfJGCjoeNZphpm26dWqlZtFe/V79ivm27eal7rH2wio+IlIWahZuIlYiRiZGJlIeXCIiXiJaKlYqVipWLlYuula6er6CyoKKek5SPmI+cj5uPmY2Vi5CLj4qOipKJlXyYcQiQg5CBk36SfZF/koCRgZGAkIKMiY+HkIORg4+EjoWNho2Fi4aLg4WCgH+AgICBfoEIfoF/gYCBgYCFgouEi4iMh42GjYWNiIyIjIiOh4+Ej4WNh4uKqFetXrBmsGa4ar9uCIyKj4mRh5GHkIiOio2Kj4mQiZGJj4qOi5KLlJGWlpWVlZeVmJSYlpeWlZeWlJGTiwiQi5GJkImRiJGHk4WThpCIjYmUhpWFloWWhZeEmYSYg5WGkoemfZqBjYSMiYyHi4UIDv0m9+j4JhWLhomHh4cI+577ngWHh4eJhouGi4eNh48IbqcFh4+JkIuQi5CNj4+PCPd193T7dfd1BYePiY+LkIuQjY+PjwioqAWPj4+MkIuQi4+Kj4cI9577nwWPiI2Gi4YIDviU+fQV+3qL+077Tov7eov7evdO+073eov3eov3TvdOi/d6i/d6+073Tvt6iwj3fPu+FfvD+8MFg4N/i4OTCIWRi4v7O/c8BYOTi5eTkwi0tAWTk5eLk4MI9wr7C/eM94wFk5OXi5ODCLRiBZODi3+DgwgO+JSrFft6i/tO906L93qL93r3TvdO93qL93qL9077Tov7eov7evtO+077eosI91P4rRWTk4uYg5MIYLUFg5N/i4ODCPsM+wz7DfcMBYOTf4uDgwhgYQWEg4t+koMI9w37DPsN+wwFhIOLfpKDCLZhBZODl4uTkwj3DfcM9wz7DAWTg5eLk5MItrUFk5OLmIOTCPsN9wz3DfcMBQ74hPnkFft6i/tO+06L+3qL+3r3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") format("woff"),url("data:application/x-font-ttf;base64,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") format("truetype"),url("../fonts/bsl_icons.svg#bsl_icons") format("svg");font-weight:normal;font-style:normal}.client [class^="icon-"],.client [class*=" icon-"]{font-family:\'bsl_icons\';speak:none;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-dialpad:before,.icon-dialpadShow:before,.icon-dialpadShow:hover:before,.icon-dialpadHide:before,.icon-dialpadHide:hover:before{content:"\\ed3b"}.icon-grid3:before{content:"\\eeb3"}.icon-phone:before{content:"\\e62c"}.icon-phone-hang-up:before,.icon-hangup:before,.icon-hangup:hover:before{content:"\\e600"}.icon-clock:before{content:"\\e634"}.client .icon-cog:before,.icon-settings:before,.icon-settings:hover:before{content:"\\e601"}.icon-pause2:before,.icon-resume:before,.icon-resume:hover:before,.icon-hold:before,.icon-hold:hover:before{content:"\\e6bb"}.icon-volume-high:before{content:"\\e6c0"}.icon-volume-medium:before,.icon-unmuteAudio:before,.icon-unmuteAudio:hover:before{content:"\\e6c1"}.icon-volume-low:before{content:"\\e6c2"}.icon-volume-mute:before,.icon-muteAudio:before,.icon-muteAudio:hover:before{content:"\\e6c3"}.icon-checkbox-checked:before{content:"\\e6d8"}.icon-checkbox-unchecked:before{content:"\\e6d9"}.icon-checkbox-partial:before{content:"\\e6da"}.icon-radio-checked:before{content:"\\e6db"}.icon-radio-unchecked:before{content:"\\e6dc"}.icon-arrow-up-thick:before{content:"\\f5a4"}.icon-arrow-down-thick:before{content:"\\f5a5"}.icon-delete:before{content:"\\f5ab"}.icon-delete-outline:before{content:"\\f5ac"}.icon-checkmark6:before{content:"\\f2c7"}.icon-cancel3:before{content:"\\f2c9"}.icon-notice:before{content:"\\f2cf"}.icon-warning2:before{content:"\\f2d4"}.icon-grid5:before{content:"\\f34b"}.icon-resize4:before,.icon-fullScreenContract:before,.icon-fullScreenContract:hover:before,.icon-fullScreenExpand:before,.icon-fullScreenExpand:hover:before{content:"\\f371"}.icon-info8:before{content:"\\f3a4"}.icon-th:before{content:"\\e602"}.icon-signal2:before{content:"\\f162"}.icon-time:before{content:"\\f167"}.icon-volume-off:before{content:"\\f170"}.icon-volume-down:before{content:"\\f171"}.icon-volume-up:before{content:"\\f172"}.icon-facetime-video:before,.icon-selfViewEnable:before,.icon-selfViewEnable:hover:before,.icon-selfViewDisable:before,.icon-selfViewDisable:hover:before{content:"\\f17f"}.icon-share5:before,.icon-transfer:before,.icon-transfer:hover:before{content:"\\f186"}.icon-phone5:before{content:"\\f1b9"}.icon-angle-right:before{content:"\\f1fe"}.icon-logout:before{content:"\\f45c"}.icon-cross4:before{content:"\\f465"}.icon-history2:before{content:"\\f477"}.icon-arrow-right10:before{content:"\\f4bb"}.selfView-bl .localVideo{top:auto;bottom:0;left:0;right:auto}.selfView-tl .localVideo{top:0;bottom:auto;left:0;right:auto}.selfView-tr .localVideo{top:0;bottom:auto;left:auto!important;right:0}.selfView-br .localVideo{top:auto;bottom:0;left:auto!important;right:0}.selfView-1x .localVideo{width:25%;height:25%}.selfView-2x .localVideo{width:50%;height:50%}.videoBar .icon,.videoBar a{font-size:20px;color:#808080;text-decoration:none}.icon{cursor:pointer}color:<%= iconHightlightColor %>;.settingsPopup input,.settingsPopup select{margin-left:14px}.messages{position:absolute;font-family:arial;text-align:left;width:auto;font-size:12px;bottom:auto;top:10px;left:10px}.videoBar .hold,.videoBar .resume{margin-top:-1px}.hangup a.icon-phone-hang-up{color:#f90007;font-size:24px}.watermark-icon{position:absolute;top:50%;left:50%;backface-visibility:hidden;transform:translate(-50%,-50%);color:rgba(255,255,255,0.08);z-index:1;font-size:265px;text-align:center;width:100%}.callStats{background-color:#292929;border-radius:0;border:1px solid #3c3c3c;box-shadow:none;color:#999;z-index:200;padding:10px}.stats-container{margin-bottom:18px}.dialpad-control-bar{margin-top:6px}.dialpad-control-bar .main-button{background:#3da005;border-radius:14px;width:70px;padding:5px;margin:0 auto}.dialpad-control-bar a{color:#fff;text-decoration:none;text-align:center;width:100%;display:inline-block;font-size:14px;font-weight:700;letter-spacing:1}.dialpad-control-bar a span{margin-right:5px}.destination-container hr{border:0;border-bottom:1px solid #3c3c3c}.selfViewEnable a,.dialpadIconHide a,.unmuteAudio a,.fullScreenContract a{color:#04aff0!important}.destination::-webkit-input-placeholder{color:#04aff0;font-style:italic;padding-left:5px;font-weight:400}.default-color{color:#2ba6cb}ul.tabs{width:250px;padding-left:0}.tabs~div p,.tabs~div h3{margin-bottom:15px;color:#999;font-size:14px}.tabs ~ div{padding:10px;margin-bottom:10px}.tabs li{list-style:none;display:inline}.tabs a{padding:5px 10px;display:inline-block;background:#494949;color:#fff;text-decoration:none}.tabs a.active{background:#04aff0;color:#fff}.cell-selfView,.settings{margin-top:12px!important}.cell-selfView .icon-settings,.settings .icon-settings{margin:0;font-size:18px;color:#fff}.settingsPopup .saveSettings,.settingsPopup .clear{display:inline-block}.whiteboard{display:none;position:absolute;top:40px;left:378px}.whiteboard canvas{border-radius:4px;border:2px solid #ddd;box-shadow:0 0 10px #999}.sms{display:none;position:absolute;top:10px;right:10px}.sms .smsView{padding:10px;border-radius:4px;border:2px solid #ddd;box-shadow:0 0 10px #999}.sms .smsLoginForm{width:250px}.sms .smsSendForm{width:600px;display:none}.sms .smsSendBody{width:339px}.sms .smsInbox{width:600px;display:none}.sms .smsInbox .inner{max-height:250px;overflow:auto}.sms .smsInbox .cell{padding:5px}.sms .smsInbox .from{width:100px}.sms .smsInbox .status{width:50px}.sms .smsInbox .time{width:135px}.sms .smsInbox .body{word-wrap:break-word}.sms .smsInbox .body>div{display:none}.sms .smsInbox .sms-inbox-item.image .body .image span{margin-right:5px}.sms .smsInbox .actions{width:15px}.sms .smsInbox .icon-trash{font-size:15px}.sms .smsStatus{display:none;text-align:right}.sms .smsStatus .content{text-align:right;border:1px solid #c3c3c3;background-color:#e3e2e2;font-size:70%;padding:1px 3px;border-top:0;margin-right:15px;border-bottom-right-radius:4px;border-bottom-left-radius:4px}.sms .smsStatus.error{color:#f00}.sms .smsInbox .sms-inbox-item.text .body .text,.sms .smsInbox .sms-inbox-item.image .body .image,.sms .smsInbox .sms-inbox-item.video .body .video,.sms .smsInbox .sms-inbox-item.audio .body .audio{display:block}.sms .smsInbox .sms-inbox-item.audio .body .audio audio,.sms .smsInbox .sms-inbox-item.video .body .video video{width:100%}.simple_sketch{background-color:#fff}.tools{padding-bottom:10px}.tools a{border:1px solid #000;height:30px;line-height:30px;padding:0 10px;vertical-align:middle;text-align:center;text-decoration:none;display:inline-block;color:#000;font-weight:bold}.tools a.selected{border-color:#f00;border-width:3px}[id$="sample"]{display:none!important}#javascript_disabled{display:block;background-color:#fff;color:#000}#rejectIncomingCallContainer{text-align:right}.smsInbox .content{display:table-row-group}.btn-star{font-size:30px;vertical-align:middle}.incomingCallName,.incomingCallUser{display:block;margin-left:10px;margin-bottom:18px}a.disabled{pointer-events:none;cursor:default;background-color:#999;opacity:.5}.callHistory{display:none;position:absolute;width:200px;height:258px;right:auto;left:200px;bottom:40px;top:auto;background:#292929;overflow:hidden;background-color:#292929;border-radius:0;border:1px solid #3c3c3c;box-shadow:none;color:#999;z-index:200;padding:0}.callHistory .rowSpace{padding:.5em}.callHistory .actions{margin-top:12px}.callHistory .content{padding:16px 0 10px 0;height:68%;width:200px;overflow:auto;margin-bottom:10px}.history-row:hover,.history-row.active{background:#353535}.history-row{cursor:pointer}position relative .row{display:block;margin:0;position:relative;height:46px}position relative .row .hist-direction{position:absolute;color:#3da005;left:3px;font-family:arial;font-size:18px;top:6px}position relative .row .hist-direction .icon-arrow-down-thick{color:#e9651d}position relative .row .hist-destination{position:absolute;color:#b3b3b3;left:25px;font-family:arial;font-size:18px;text-decoration:none;top:6px}position relative .row .hist-date{position:absolute;color:#0082ff;left:20px;font-family:arial;font-size:10px;position:absolute;color:#b3b3b3;left:26px;font-family:arial;font-size:10px;top:29px}position relative .row .hist-length{position:absolute;color:#0082ff;left:205px;font-family:arial;font-size:10px;position:absolute;color:#b3b3b3;left:104px;font-family:arial;font-size:10px;top:29px}.hist-details-arrow{position:absolute;right:8px;font-size:16px;top:14px}.classHistoryActions{padding-top:2px}.historyClear a{text-decoration:none;color:#fff;font-size:14px;font-weight:700;background:#6f6f6f;border-radius:20px;padding:5px 10px;margin-left:15px}.historyClear a:hover{background:#4e4e4e}.historyClose a{color:#04aff0;font-size:14px;font-weight:700;text-decoration:none;margin-left:8px}.historyClose a:hover{color:#017ead}.callHistoryDetails{background:#fff;width:194px;height:auto;border:0;clear:both;top:0;bottom:-1;left:201px;right:auto;box-shadow:none;border-radius:0;background:#292929;border:1px solid #3c3c3c;border-top:0;overflow:auto}.callHistoryDetails .historyDetailsClose{text-align:right;margin-top:10px;text-align:right;margin-top:10px;display:inline-block!important;height:26px;margin-top:0}.callHistoryDetails .historyDetailsClose .icon-ok{margin:0}.callHistoryDetails .historyDetailsClose a{text-decoration:none;outline-color:rgba(0,0,0,0);color:#aaa;font-size:18px}.callHistoryDetails .table{font-size:13px}.callHistoryDetails .table padding-left 8px #history-dt-close-container{text-align:right}';
var templates=require("../js/templates");var ejs=require("ejs");var events=require("./EventBus");var debug=require("debug")("client");var debugerror=require("debug")("client:ERROR");debugerror.log=console.warn.bind(console);var Configuration=require("./Configuration");var SIPStack=require("./SIPStack");var Video=require("./Video");var Sound=require("./Sound");var XMPP=require("./XMPP");var SMS=require("./SMS");var Settings=require("./Settings");var Stats=require("./Stats");var Timer=require("./Timer");var History=require("./History");var Transfer=require("./Transfer");var Whiteboard=require("./Whiteboard");var FileShare=require("./FileShare");var Authentication=require("./Authentication");var Icon=require("./Icon");var WebRTC_C=require("./Constants");var Utils=require("./Utils");var ExSIP=require("exsip");var ClientConfig=require("../js/client-config.js.default");function Client(config,element){this.config=config;if(element){this.appendTo($(element))}}Client.prototype={setup:function(){var self=this;this.main=this.client.find(".main");this.muteAudioIcon=this.client.find(".muteAudioIcon");this.unmuteAudioIcon=this.client.find(".unmuteAudioIcon");this.hangup=this.client.find(".hangup");this.callControl=this.client.find(".callControl");this.destination=this.callControl.find("input.destination");this.callButton=this.client.find(".call");this.reInvitePopup=this.client.find(".reInvitePopup");this.acceptReInviteCall=this.client.find(".acceptReInviteCall");this.rejectReInviteCall=this.client.find(".rejectReInviteCall");this.messages=this.client.find(".messages");this.callPopup=this.client.find(".callPopup");this.incomingCallName=this.callPopup.find(".incomingCallName");this.incomingCallUser=this.callPopup.find(".incomingCallUser");this.acceptIncomingCall=this.callPopup.find(".acceptIncomingCall");this.rejectIncomingCall=this.callPopup.find(".rejectIncomingCall");this.holdAndAnswerButton=this.callPopup.find(".holdAndAnswerButton");this.dropAndAnswerButton=this.callPopup.find(".dropAndAnswerButton");this.errorPopup=this.client.find(".errorPopup");this.fullScreenExpandIcon=this.client.find(".fullScreenExpand");this.fullScreenContractIcon=this.client.find(".fullScreenContract");this.dialpadShowIcon=this.client.find(".dialpadIconShow");this.dialpadHideIcon=this.client.find(".dialpadIconHide");this.dialpad=this.client.find(".dialpad");this.dialpadButtons=this.client.find(".dialpad button");this.selfViewEnableIcon=this.client.find(".selfViewEnable");this.selfViewDisableIcon=this.client.find(".selfViewDisable");this.connected=this.client.find(".connected-icon");this.registered=this.client.find(".registered-icon");this.historyClose=this.client.find(".historyClose");this.callHistory=this.client.find(".callHistory");this.callStats=this.client.find(".callStats");this.shareScreen=this.client.find(".shareScreen");this.stopShareScreen=this.client.find(".stopShareScreen");this.screenSharingUnsupported=this.client.find(".screen_sharing_unsupported");this.config=this.config||Utils.clone(ClientConfig);this.configuration=new Configuration(this.config);this.sipStack=new SIPStack(this.configuration);this.sound=new Sound(this.sipStack,this.configuration);this.video=new Video(this.client.find(".video"),this.sipStack,{onPlaying:function(){self.validateUserMediaResolution()}});this.xmpp=new XMPP(this);this.sms=new SMS(this,this.client.find(".sms"),this.sound);this.settings=new Settings(this,this.configuration,this.sound,this.sipStack);this.stats=new Stats(this,this.sipStack,this.configuration);this.timer=new Timer(this,this.stats,this.configuration);this.history=new History(this,this.sound,this.stats,this.sipStack,this.configuration);this.transfer=new Transfer(this,this.sound,this.sipStack,this.configuration);this.whiteboard=new Whiteboard(this,this.client.find(".whiteboard"),this.sipStack);this.fileShare=new FileShare(this,this.client.find(".file_share"),this.sipStack);this.authentication=new Authentication(this.client.find(".authPopup"),{onAuthenticate:function(data){self.sipStack.init(data)},configurationRegister:self.configuration.register,settingsUserId:self.settings.userId,settingsAuthenticationUserId:self.settings.authenticationUserId,settingsPassword:self.settings.password});this.hold=new Icon(this.client.find(".hold"),this.sound);this.resume=new Icon(this.client.find(".resume"),this.sound);this.fullScreen=false;this.selfViewEnabled=true;this.dialpadShown=false;this.isScreenSharing=false;this.configuration.setSettings(this.settings);this.registerListeners();this.init()},appendTo:function(parent){this.updateCss();this.wrapper=$("<div/>",{"class":"webrtc-wrapper"});parent.append(this.wrapper);var renderData={};var html=ejs.render(templates.webrtc(),renderData);this.wrapper.html(html);this.client=this.wrapper.find(".client");this.setup()},updateCss:function(styleData){this.styleData=styleData||{};var cssData=$.extend({},WebRTC_C.STYLES,WebRTC_C.FONTS,this.styleData);var cssStr=ejs.render(styles,cssData);if($("#webrtc_css").length===0){$("<style type='text/css' id='webrtc_css'>"+cssStr+"</style>").appendTo("head")}else{$("#webrtc_css").text(cssStr)}},init:function(){var self=this;var unsupported=Utils.compatibilityCheck(this);if(unsupported){$("#unsupported").html(unsupported).show()}var whiteboardUnsupported=Utils.whiteboardCompabilityCheck();if(whiteboardUnsupported){$("#whiteboard_unsupported").html(whiteboardUnsupported).show()}if(this.configuration.enableWindowDrag){$(function(){self.video.localHolder.draggable({snap:".remoteVideo,.videoBar",containment:".main",snapTolerance:200,stop:function(event,ui){self.settings.updateViewPositions()}})})}this.updateClientClass();$.cookie.raw=true;window.onbeforeunload=function(e){self.endCall({rtcSession:"all"});return null};this.onLoad()},showErrorPopup:function(error){window.alert(error)},guiStart:function(){this.main.css("zoom",this.configuration.size);this.main.css("-moz-transform","scale("+this.configuration.size+")");if($.cookie("settingWindowPosition")){var windowPositions=$.cookie("settingWindowPosition").split("|");for(var i=0;i<windowPositions.length;++i){var elementPosition=windowPositions[i].split("-");this.client.find(elementPosition[0]).css("top",elementPosition[1]);this.client.find(elementPosition[0]).css("left",elementPosition[2])}}this.client.find(".remoteVideo, .videoBar").fadeIn(1e3);if(this.configuration.enableCallControl){this.callControl.fadeIn(1e3)}else{this.callControl.fadeOut(1e3)}},find:function(selector){return this.client.find(selector)},message:function(text,level){if(!this.configuration.enableMessages){return}var messageEl=this.messages.find("."+level);messageEl.stop(true,true).fadeOut();messageEl.text(text).fadeIn(10).fadeOut(1e4)},validateDestination:function(destination){if(destination.indexOf("sip:")===-1){destination="sip:"+destination}if(!this.configuration.allowOutside&&!new RegExp("[.||@]"+this.configuration.domainTo).test(destination)){this.message(this.configuration.messageOutsideDomain,"alert");return false}if(destination.indexOf("@")===-1){destination=destination+"@"+this.configuration.domainTo}var domain=destination.substring(destination.indexOf("@"));if(domain.indexOf(".")===-1){destination=destination+"."+this.configuration.domainTo}return destination.replace(/,[0-9A-D#*,]+/,"")},callUri:function(destinationToValidate){if(this.sipStack.getCallState()!==SIPStack.C.STATE_CONNECTED){debug("Already in call with state : "+this.sipStack.getCallState());return}if(destinationToValidate===""){this.message(this.configuration.messageEmptyDestination,"alert");return}var destination=this.validateDestination(destinationToValidate);if(destination===false){debug("destination is not valid : "+destinationToValidate);return}debug("calling destination : "+destination);this.message(this.configuration.messageCall,"success");this.sipStack.call(destination)},setClientConfig:function(clientConfig){var connectionChanged=this.configuration.websocketsServers[0].ws_uri!==clientConfig.websocketsServers[0].ws_uri;jQuery.extend(this.config,clientConfig);jQuery.extend(this.configuration,this.config);this.guiStart();this.updateClientClass();if(connectionChanged){this.sipStack.init()}},endCall:function(options){options=options||{};var rtcSession=options.rtcSession;if(rtcSession==="all"){this.sipStack.terminateSessions()}else if(rtcSession){this.sipStack.terminateSession(rtcSession)}else{this.sipStack.terminateSession()}this.setEvent(null);this.sound.pause();this.video.updateSessionStreams();this.guiStart();this.timer.stop();this.checkEndCallURL()},checkEndCallURL:function(){if(this.configuration.endCallURL&&!this.configuration.disabled){window.location=this.configuration.endCallURL}},onLoad:function(){var self=this;debug("onLoad");this.sipStack.init();if(!this.configuration.enableConnectLocalMedia&&this.configuration.destination){events.once("connected",function(e){self.callUri(self.configuration.destination)})}this.guiStart()},pressDTMF:function(digit){if(digit.length!==1){return}if(this.sipStack.isStarted()){this.destination.val(this.destination.val()+digit);this.sound.playClick();this.sipStack.sendDTMF(digit)}},resumeCall:function(){var self=this;this.resume.disable();var enable=function(){self.resume.enable()};this.sipStack.unhold(enable,enable)},hideSelfView:function(){this.selfViewEnabled=false;this.updateClientClass()},stopFullScreen:function(){if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}this.fullScreen=false;this.updateClientClass()},showSelfView:function(){this.selfViewEnabled=true;this.updateClientClass()},showFullScreen:function(){if(this.client[0].webkitRequestFullScreen){this.client[0].webkitRequestFullScreen()}this.fullScreen=true;this.updateClientClass()},muteAudio:function(){this.sound.setMuted(true)},unmuteAudio:function(){this.sound.setMuted(false)},showDialpad:function(){this.dialpadShown=true;this.updateClientClass()},hideDialpad:function(){this.dialpadShown=false;this.updateClientClass()},toggleDialpad:function(flag){this.dialpadShown=flag;this.updateClientClass()},updateFullScreen:function(){this.fullScreen=document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen;this.updateClientClass()},holdCall:function(){var self=this;this.hold.disable();var enable=function(){self.hold.enable()};this.sipStack.hold(enable,enable)},getRemoteUser:function(rtcSession){return rtcSession.remote_identity.uri.user||rtcSession.remote_identity.uri.host},enableScreenSharing:function(enabled){var self=this;this.isScreenSharing=enabled;this.updateClientClass();if(enabled){var onShareScreenSuccess=function(localMedia){localMedia.onended=function(){self.enableScreenSharing(false)}};var onShareScreenFailure=function(e){if(e){self.screenSharingUnsupported.show()}self.enableScreenSharing(false)};self.sipStack.reconnectUserMedia(onShareScreenSuccess,onShareScreenFailure)}else{self.sipStack.reconnectUserMedia()}},registerListeners:function(){var self=this;events.on("viewChanged",function(e){self.updateClientClass()});events.on("ended",function(e){self.message(self.configuration.messageEnded.replace("{0}",self.getRemoteUser(e.sender)),"normal");self.history.persistCall(e.sender);self.endCall({rtcSession:e.sender})});events.on("resumed",function(e){self.onSessionStarted(e.sender);self.message(self.configuration.messageResume.replace("{0}",self.getRemoteUser(e.sender)),"success")});events.on("started",function(e){self.onSessionStarted(e.sender);var dtmfTones=Utils.parseDTMFTones(self.configuration.destination);if(dtmfTones&&e.data&&!e.data.isReconnect){debug("DTMF tones found in destination - sending DTMF tones : "+dtmfTones);self.sipStack.sendDTMF(dtmfTones)}delete self.configuration.destination;if(e.data&&!e.data.isReconnect){self.message(self.configuration.messageStarted.replace("{0}",self.getRemoteUser(e.sender)),"success");self.timer.start()}});events.on("held",function(e){self.message(self.configuration.messageHold.replace("{0}",self.getRemoteUser(e.sender)),"success")});events.on("disconnected",function(e){if(self.configuration.enableConnectionIcon){self.connected.removeClass("success");self.connected.addClass("alert").fadeIn(100)}var msg=self.configuration.messageConnectionFailed;if(e.data&&e.data.reason){msg=e.data.reason}if(e.data&&e.data.retryAfter){msg+=" - Retrying in "+e.data.retryAfter+" seconds"}self.message(msg,"alert");self.endCall()});events.on("failed",function(e){var error=e.data.cause;self.message(error,"alert");if(error==="User Denied Media Access"){self.showErrorPopup("WebRTC was not able to access your microphone/camera!")}else if(error===ExSIP.C.causes.CANCELED){self.setEvent("incomingCall-done")}self.sound.pause();self.endCall({rtcSession:e.sender})});events.on("progress",function(e){self.message(self.configuration.messageProgress,"normal");self.sound.playDtmfRingback()});events.on("message",function(e){self.message(e.text,e.level)});events.on("registrationFailed",function(e){self.updateClientClass();if(self.configuration.enableRegistrationIcon){self.registered.addClass("alert").fadeIn(100)}var statusCode=e.data.response.status_code;var msg=statusCode;if(statusCode===403){msg="403 Authentication Failure"}self.message(self.configuration.messageRegistrationFailed.replace("{0}",msg),"alert")});events.on("registered",function(e){self.updateClientClass();if(self.configuration.enableRegistrationIcon){self.registered.removeClass("alert");self.registered.addClass("success").fadeIn(10).fadeOut(3e3)}self.message(self.configuration.messageRegistered,"success")});events.on("unregistered",function(e){self.updateClientClass();self.message(self.configuration.messageUnregistered||"Unregistered","success")});events.on("connected",function(e){if(self.configuration.enableConnectionIcon){self.connected.removeClass("alert");self.connected.addClass("success").fadeIn(10).fadeOut(3e3)}self.message(self.configuration.messageConnected,"success");self.sipStack.updateUserMedia(function(){if(self.configuration.destination){self.callUri(self.configuration.destination)}})});events.on("incomingCall",function(evt){var incomingCallName=evt.data.request.from.display_name;var incomingCallUser=evt.data.request.from.uri.user;self.message("Incoming Call","success");self.setEvent("incomingCall");self.incomingCallName.text(incomingCallName);self.incomingCallUser.text(incomingCallUser);Utils.rebindListeners("click",[self.rejectIncomingCall,self.acceptIncomingCall,self.holdAndAnswerButton,self.dropAndAnswerButton],function(e){e.preventDefault();self.incomingCallHandler($(this),evt.data.session)});self.sound.playRingtone()});events.on("reInvite",function(e){self.setEvent("reInvite");var incomingCallName=e.data.request.from.display_name;var incomingCallUser=e.data.request.from.uri.user;var title=e.data.audioAdd?"Adding Audio":"Adding Video";self.message(title,"success");self.reInvitePopup.find(".incomingCallName").text(incomingCallName);self.reInvitePopup.find(".incomingCallUser").text(incomingCallUser);self.reInvitePopup.find(".title").text(title);self.acceptReInviteCall.off("click");self.acceptReInviteCall.on("click",function(){self.setEvent("reInvite-done");e.data.session.acceptReInvite()});self.rejectReInviteCall.off("click");self.rejectReInviteCall.on("click",function(){self.setEvent("reInvite-done");e.data.session.rejectReInvite()})});events.on("newDTMF",function(e){var digit=e.data.tone;debug("DTMF sent : "+digit);if(!digit){return}var file=null;if(digit==="*"){file="star"}else if(digit==="#"){file="pound"}else{file=digit}self.sound.playDtmfTone(file)});this.shareScreen.bind("click",function(e){e.preventDefault();self.sound.playClick();self.enableScreenSharing(true)});this.stopShareScreen.bind("click",function(e){e.preventDefault();self.sound.playClick();self.enableScreenSharing(false)});this.callButton.bind("click",function(e){e.preventDefault();self.sound.playClick();self.callUri(self.destination.val())});this.hangup.bind("click",function(e){e.preventDefault();self.sound.playClick();self.endCall();if(self.fullScreen){self.fullScreenContractIcon.click()}});this.fullScreenExpandIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.showFullScreen()});this.fullScreenContractIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.stopFullScreen()});$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(e){self.updateFullScreen()});this.selfViewDisableIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.hideSelfView()});this.selfViewEnableIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.showSelfView()});$(".history-button").bind("click",function(e){e.preventDefault();self.history.toggle()});$(".button-row button").bind("click",function(e){e.preventDefault();var destinationStr=$("#destination").val();$("#destination").val(destinationStr+this.firstChild.nodeValue)});this.hold.onClick(function(e){self.holdCall()});this.resume.onClick(function(e){self.resumeCall()});this.muteAudioIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.muteAudio()});this.unmuteAudioIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.unmuteAudio()});this.dialpadShowIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.showDialpad();self.destination.focus();self.settings.toggleSettings(false)});this.dialpadHideIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.hideDialpad();self.history.historyToggled=true;self.history.toggle()});this.historyClose.bind("click",function(e){e.preventDefault();self.sound.playClick();self.history.toggle()});this.dialpadButtons.bind("click",function(e){self.processDigitInput(e.target.textContent)});this.destination.keypress(function(e){if(e.keyCode===13){e.preventDefault();self.callUri(self.destination.val())}});$(".video").bind("click",function(e){var $target=$(e.target);var dialpad=$target.closest(".dialpad").length;var history=$target.closest(".callHistory").length;var details=$target.closest(".callHistoryDetails").length;if(dialpad===0||history===0||details===0){self.history.historyToggled=true;self.history.toggle()}});$(document).unbind("keypress").bind("keypress",function(e){});$(document).unbind("keydown").bind("keydown",function(event){var isModifier=event.altKey;if(isModifier){if(self.transfer.targetInput.is(event.target)){return}if(event.which===83){self.stats.toggle()}else if(event.which===84){self.sms.toggle()}else if(event.which===87){self.whiteboard.toggle()}else if(event.which===72){self.history.toggle()}return}if(self.dialpadShown){var doPrevent=false;if(event.keyCode===8){var d=event.srcElement||event.target;if(d.tagName.toUpperCase()==="INPUT"&&(d.type.toUpperCase()==="TEXT"||d.type.toUpperCase()==="PASSWORD"||d.type.toUpperCase()==="FILE"||d.type.toUpperCase()==="EMAIL")||d.tagName.toUpperCase()==="TEXTAREA"){doPrevent=d.readOnly||d.disabled}else{doPrevent=true;self.destination.trigger("keydown",event);self.destination.putCursorAtEnd()}}if(doPrevent){event.preventDefault();return}}var digit=String.fromCharCode(event.which);self.processDigitInput(digit,event)})},processDigitInput:function(digit,event){if(!this.sipStack.isStarted()&&this.dialpadShown){if(event&&this.destination.is(event.target)){return}this.destination.val(this.destination.val()+digit);this.destination.putCursorAtEnd()}else if(digit.match(/^[0-9A-D#*,]+$/i)){this.pressDTMF(digit)}},onSessionStarted:function(sender){debug("setting active session to "+sender.id);this.sipStack.activeSession=sender;this.video.updateSessionStreams(sender);this.client.find(".stats-container").attr("id",this.sipStack.getSessionId()+"-1");this.sound.pause()},incomingCallHandler:function(source,session){this.setEvent("incomingCall-done");this.sound.pause();if(source.is(this.acceptIncomingCall)){this.sipStack.answer(session)}else if(source.is(this.dropAndAnswerButton)){this.sipStack.terminateSession();this.sipStack.answer(session)}else if(source.is(this.holdAndAnswerButton)){this.sipStack.holdAndAnswer(session)}else if(source.is(this.rejectIncomingCall)){this.sipStack.terminateSession(session)}},setEvent:function(event){this.event=event;this.updateClientClass()},validateUserMediaResolution:function(){var encodingWidth=this.settings.getResolutionEncodingWidth();var encodingHeight=this.settings.getResolutionEncodingHeight();var videoWidth=this.video.localWidth();var videoHeight=this.video.localHeight();debug("validating video resolution "+videoWidth+","+videoHeight+" to match selected encoding "+encodingWidth+","+encodingHeight);if(!videoWidth&&!videoHeight){return}if(encodingWidth!==videoWidth||encodingHeight!==videoHeight){var msg="Video resolution "+videoWidth+","+videoHeight+" does not match selected encoding "+encodingWidth+","+encodingHeight;debugerror(msg)}},setAudioOnlyOfferAndRec:function(audioOnly){this.configuration.audioOnly=audioOnly;this.configuration.offerToReceiveVideo=!audioOnly;this.sipStack.updateUserMedia()},setAudioOnly:function(audioOnly){this.configuration.audioOnly=audioOnly;this.configuration.offerToReceiveVideo=true;this.sipStack.updateUserMedia()},asScript:function(){var self=this;var script='<script src="'+self.src+'" ';var dataStrs=Object.keys(self.styleData).filter(function(key){var value=self.styleData[key];var defaultValue=WebRTC_C.STYLES[key];return!!value&&value!==defaultValue}).map(function(key){var value=self.styleData[key];return"data-"+key.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+"='"+value+"'"});script+=dataStrs.join(" ");var config=$.extend({},this.config);Object.keys(config).forEach(function(key){var value=config[key];var defaultValue=ClientConfig[key];if(!value&&!defaultValue){delete config[key];return}if(Array.isArray(value)){value=JSON.stringify(value);defaultValue=JSON.stringify(defaultValue)}else{value=value+"";defaultValue=defaultValue+""}if(value===defaultValue){delete config[key]}});script+=">\n"+JSON.stringify(config,undefined,2)+"\n</script>";return script},updateClientClass:function(){var classes=["client"];classes.push("r"+this.configuration.getResolutionDisplay());classes.push(this.configuration.isWidescreen()?"widescreen":"standard");var callState=this.sipStack.getCallState();if(callState){classes.push(callState)}if(this.sipStack.isRegistered()){classes.push("registered")}if(this.event){classes.push(this.event)}if(this.configuration.enableMute){classes.push("enable-mute")}if(this.configuration.enableShareScreen){classes.push("enable-shareScreen")}if(this.configuration.enableCallControl){classes.push("enable-call-control")}if(this.configuration.enableTransfer){classes.push("enable-transfer")}if(this.configuration.enableHold){classes.push("enable-hold")}if(this.configuration.enableCallTimer){classes.push("enable-timer")}if(this.configuration.enableSettings){classes.push("enable-settings")}if(this.configuration.enableFullScreen){classes.push("enable-full-screen")}if(this.configuration.enableSelfView){classes.push("enable-self-view")}if(this.configuration.enableDialpad){classes.push("enable-dialpad")}var views=this.configuration.getViews();if(views&&views.length>0){views.map(function(view){classes.push("view-"+view)})}if(this.configuration.enableScreenSharing){classes.push("enable-screen-sharing")}if(this.configuration.enableFileShare){classes.push("enable-file-share")}if(this.configuration.selfViewSize){classes.push("selfView-"+this.configuration.selfViewSize)}if(this.configuration.selfViewLocation){classes.push("selfView-"+this.configuration.selfViewLocation)}if(this.sound.muted){classes.push("muted")}else{classes.push("unmuted")}if(this.settings.toggled){classes.push("settings-shown")}else{classes.push("settings-hidden")}if(this.selfViewEnabled){classes.push("self-view-enabled")}else{classes.push("self-view-disabled")}if(this.dialpadShown){classes.push("dialpad-shown")}else{classes.push("dialpad-hidden")}if(this.fullScreen){classes.push("full-screen-expanded")}else{classes.push("full-screen-contracted")}if(this.isScreenSharing){classes.push("screen-sharing")}else{classes.push("screen-sharing-off")}if(this.transfer.visible){classes.push("transfer-visible")}else{classes.push("transfer-hidden")}if(this.authentication.visible){classes.push("auth-visible")}else{classes.push("auth-hidden")}this.client.attr("class",classes.join(" "))}}},{"../js/client-config.js.default":1,"../js/templates":2,"./Authentication":50,"./Configuration":52,"./Constants":53,"./EventBus":55,"./FileShare":56,"./History":57,"./Icon":58,"./SIPStack":59,"./SMS":60,"./Settings":62,"./Sound":63,"./Stats":64,"./Timer":65,"./Transfer":66,"./Utils":67,"./Video":68,"./Whiteboard":70,"./XMPP":71,debug:10,ejs:13,exsip:27}],52:[function(require,module,exports){module.exports=Configuration;var Flags={enableHD:1,enableCallControl:2,enableCallTimer:4,enableCallHistory:8,enableFullScreen:16,enableSelfView:32,enableCallStats:64,enableDialpad:128,enableMute:256,enableMessages:512,enableRegistrationIcon:1024,enableConnectionIcon:2048,enableWindowDrag:4096,enableSettings:8192,enableAutoAnswer:16384,enableAutoAcceptReInvite:32768,enableConnectLocalMedia:65536,enableTransfer:131072,enableHold:262144,enableIms:524288};Configuration.Flags=Flags;var events=require("./EventBus");var debug=require("debug")("configuration");var Utils=require("./Utils");var WebRTC_C=require("./Constants");var ExSIP=require("exsip");function Configuration(configObj){debug("window.location.search : "+window.location.search);debug("configuration options : "+ExSIP.Utils.toString(configObj));jQuery.extend(this,configObj);if(Utils.getSearchVariable("disableMessages")){this.enableMessages=false}this.destination=this.destination||Utils.getSearchVariable("destination");this.networkUserId=this.networkUserId||Utils.getSearchVariable("networkUserId");this.hd=Utils.getSearchVariable("hd")==="true"||$.cookie("settingHD");this.audioOnly=Utils.getSearchVariable("audioOnly")==="true";this.sipDisplayName=this.displayName||Utils.getSearchVariable("name")||$.cookie("settingDisplayName");if(this.sipDisplayName){this.sipDisplayName=this.sipDisplayName.replace(/%20/g," ")}this.maxCallLength=Utils.getSearchVariable("maxCallLength");this.size=Utils.getSearchVariable("size")||$.cookie("settingSize")||1;this.color=Utils.colorNameToHex(Utils.getSearchVariable("color"))||$.cookie("settingColor");this.offerToReceiveVideo=true;var features=Utils.getSearchVariable("features");if(features){this.setClientConfigFlags(parseInt(features,10))}this.bodyBackgroundColor=$("body").css("backgroundColor")}Configuration.prototype={getClientConfigFlags:function(){var flags=0;for(var flag in Flags){var value=Flags[flag];if(this[flag]){flags|=value}}return flags},setClientConfigFlags:function(flags){for(var flag in Flags){var value=Flags[flag];if(flags&value){this[flag]=true}else{this[flag]=false}}},isAudioOnlyView:function(){var views=this.getViews();return views.indexOf("audioOnly")!==-1},getViews:function(){var view=Utils.getSearchVariable("view");var views=[];if(this.view){$.merge(views,this.view.split(" "))}if(view){$.merge(views,view.split(" "))}return $.unique(views)},getBackgroundColor:function(){return this.color||this.bodyBackgroundColor},getPassword:function(){return $.cookie("settingPassword")},isAutoAnswer:function(){return this.settings.settingAutoAnswer.is(":checked")},getDTMFOptions:function(){return{duration:WebRTC_C.DEFAULT_DURATION,interToneGap:WebRTC_C.DEFAULT_INTER_TONE_GAP}},getExSIPOptions:function(){var options={mediaConstraints:{audio:true,video:this.getVideoConstraints()},createOfferConstraints:{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:!this.isAudioOnlyView()&&this.offerToReceiveVideo}}};return options},getMediaConstraints:function(){if(this.client.isScreenSharing){return{video:{mandatory:{chromeMediaSource:"screen"}}}}else{return{audio:true,video:this.getVideoConstraints()}}},getVideoConstraints:function(){if(this.isAudioOnlyView()||this.audioOnly){return false}else{var constraints=this.getResolutionConstraints();return constraints?constraints:true}},getResolutionConstraints:function(){if(this.hd===true){return{mandatory:{minWidth:1280,minHeight:720}}}else{var width=this.settings.getResolutionEncodingWidth();var height=this.settings.getResolutionEncodingHeight();if(width&&height){if(height<=480){return{mandatory:{maxWidth:width,maxHeight:height}}}else{return{mandatory:{minWidth:width,minHeight:height}}}}else{return false}}},getExSIPConfig:function(data){data=data||{};var userid=data.userId||$.cookie("settingUserId")||this.networkUserId||Utils.randomUserid();var sip_uri=encodeURI(userid);if(sip_uri.indexOf("@")===-1){sip_uri=sip_uri+"@"+this.domainFrom}var config={uri:sip_uri,authorization_user:data.authenticationUserId||$.cookie("settingAuthenticationUserId")||userid,ws_servers:this.websocketsServers,stun_servers:"stun:"+this.stunServer+":"+this.stunPort,trace_sip:this.debug,enable_ims:this.enableIms,p_asserted_identity:this.pAssertedIdentity,enable_datachannel:this.enableWhiteboard||this.enableFileShare};if(this.sipDisplayName){config.display_name=this.sipDisplayName}if($.cookie("settingUserId")||this.register){config.register=true;config.password=data.password||$.cookie("settingPassword")}else{config.register=false}return config},getRtcMediaHandlerOptions:function(){var options={reuseLocalMedia:this.enableConnectLocalMedia,videoBandwidth:this.settings.getBandwidth(),disableICE:this.disableICE,RTCConstraints:{optional:[],mandatory:{}}};return options},setSettings:function(settings){this.settings=settings},isDebug:function(){return this.debug===true},isHD:function(){return this.enableHD===true&&this.hd===true},isWidescreen:function(){return this.isHD()||this.settings.resolutionType.val()===WebRTC_C.WIDESCREEN},setResolutionDisplay:function(resolutionDisplay){this.hd=false;this.settings.setResolutionDisplay(resolutionDisplay);events.emit("viewChanged")},getResolutionDisplay:function(){return this.isHD()?WebRTC_C.R_1280x720:this.settings.getResolutionDisplay()}}},{"./Constants":53,"./EventBus":55,"./Utils":67,debug:10,exsip:27}],53:[function(require,module,exports){var C={WIDESCREEN:"widescreen",STANDARD:"standard",R_1280x720:"1280x720",R_640x360:"640x360",R_320x180:"320x180",R_960x720:"960x720",R_640x480:"640x480",R_320x240:"320x240",DEFAULT_DURATION:500,DEFAULT_INTER_TONE_GAP:200,TEMPLATES:"$TEMPLATES$",CSS:"$CSS$",MEDIA:"$MEDIA$",FONTS:"$FONTS$",STYLES:{iconHightlightColor:"#00adef",infoMessageColor:"#999999",successMessageColor:"#00FF00",warningMessageColor:"#FFFF00",alertMessageColor:"#FF0000",statsColor:"#999999",timerColor:"#FFFFFF"}};C.DEFAULT_RESOLUTION_ENCODING=C.R_640x480;C.DEFAULT_RESOLUTION_DISPLAY=C.R_640x480;C.RESOLUTION_TYPES={standard:C.STANDARD,widescreen:C.WIDESCREEN};C.STANDARD_RESOLUTIONS={"960 x 720":C.R_960x720,"640 x 480":C.R_640x480,"320 x 240":C.R_320x240};C.WIDESCREEN_RESOLUTIONS={"1280 x 720":C.R_1280x720,"640 x 360":C.R_640x360,"320 x 180":C.R_320x180};module.exports=C},{}],54:[function(require,module,exports){module.exports=DateFormat;var C={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],mthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};C.zeroPad=function(number){return("0"+number).substr(-2,2)};C.dateMarkers={d:["getDate",function(v){return C.zeroPad(v)}],m:["getMonth",function(v){return C.zeroPad(v+1)}],n:["getMonth",function(v){return C.mthNames[v]}],w:["getDay",function(v){return C.dayNames[v]}],y:["getFullYear"],H:["getHours",function(v){return C.zeroPad(v)}],M:["getMinutes",function(v){return C.zeroPad(v)}],S:["getSeconds",function(v){return C.zeroPad(v)}],i:["toISOString"]};DateFormat.C=C;function DateFormat(fstr){this.formatString=fstr}DateFormat.prototype={format:function(date){var dateTxt=this.formatString.replace(/%(.)/g,function(m,p){var dateMarker=C.dateMarkers[p];var method=dateMarker[0];var rv=date[method]();if(dateMarker[1]!==null){rv=dateMarker[1](rv)}return rv});return dateTxt}}},{}],55:[function(require,module,exports){(function(global){var util=require("util");var events=require("events");function EventBus(){events.EventEmitter.call(this)
}util.inherits(EventBus,events.EventEmitter);global.WEBRTC_EVENTBUS=global.WEBRTC_EVENTBUS||new EventBus;module.exports=global.WEBRTC_EVENTBUS}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{events:4,util:9}],56:[function(require,module,exports){module.exports=FileShare;var C={ACTION_REQUEST:"request",ACTION_REPLY:"reply",ACTION_SEND:"send",ACTION_RECEIVED:"received"};FileShare.C=C;var events=require("./EventBus");var debug=require("debug")("fileshare");var Utils=require("./Utils");function FileShare(element,sipStack){this.ui=element;this.fileInput=this.ui.find('input[type="file"]');this.status=this.ui.find(".status");this.requests={};this.toggled=false;this.sipStack=sipStack;this.registerListeners()}FileShare.prototype={registerListeners:function(){var self=this;this.fileInput.on("change",$.proxy(this.handleFileSelect,this));events.on("dataReceived",function(e){var data=e.data,match;var regex=/^fileshare:([^:]*):([^:]*):?/;if(!!(match=data.match(regex))){var fileName=match.pop();var action=match.pop();data=data.replace(regex,"");self.process(action,fileName,data)}})},process:function(action,fileName,data){if(action===C.ACTION_REQUEST){var accept=window.confirm("User wants to share the file "+fileName+" with you. Do you want to receive it?");this.replyRequest(accept,fileName)}else if(action===C.ACTION_REPLY){if(data==="true"){var fileData=this.requests[fileName];this.sendFile(fileData,fileName)}else{this.updateStatus("rejected request for "+fileName);delete this.requests[fileName]}}else if(action===C.ACTION_SEND){this.receivedFile(data,fileName)}else if(action===C.ACTION_RECEIVED){this.updateStatus(fileName+" transferred successfully");delete this.requests[fileName]}},handleFileSelect:function(evt){var file=evt.target.files[0];if(file){var reader=new FileReader;reader.onload=$.proxy(this.requestSend,this);reader.readAsDataURL(file)}else{alert("Failed to load file")}},requestSend:function(e){var data=e.target.result;var file=this.fileInput.val();var fileName=this.fileName(file);this.requests[fileName]=data;this.updateStatus("requesting sending file "+fileName+" ...");this.send(C.ACTION_REQUEST,fileName)},replyRequest:function(accept,fileName){if(accept){this.updateStatus("receiving file "+fileName+" ...")}this.send(C.ACTION_REPLY,fileName,accept)},receivedFile:function(data,fileName){this.updateStatus("received file "+fileName);var blob=Utils.dataURItoBlob(data);window.saveAs(blob,fileName);this.send(C.ACTION_RECEIVED,fileName)},sendFile:function(data,fileName){this.updateStatus("sending file "+fileName+" ...");this.send(C.ACTION_SEND,fileName,data)},send:function(action,fileName,data){var dataString="fileshare:"+action+":"+fileName;if(data){dataString+=":"+data}this.sipStack.sendData(dataString)},updateStatus:function(status){debug(status,this.client.configuration);this.status.text(status)},fileName:function(file){return file.split("\\").pop()}}},{"./EventBus":55,"./Utils":67,debug:10}],57:[function(require,module,exports){module.exports=History;var Utils=require("./Utils");var SIPStack=require("./SIPStack");function History(client,sound,stats,sipStack,configuration){this.callHistory=client.find(".callHistory");this.content=this.callHistory.find(".content");this.historyForward=this.callHistory.find(".historyForward");this.historyBack=this.callHistory.find(".historyBack");this.callHistoryDetails=this.callHistory.find(".callHistoryDetails");this.historyDetailsClose=this.callHistory.find(".historyDetailsClose");this.resolutionIn=this.callHistory.find(".resolutionIn");this.resolutionOut=this.callHistory.find(".resolutionOut");this.bitrateIn=this.callHistory.find(".bitrateIn");this.bitrateOut=this.callHistory.find(".bitrateOut");this.frameRateIn=this.callHistory.find(".frameRateIn");this.frameRateOut=this.callHistory.find(".frameRateOut");this.audioLostPer=this.callHistory.find(".audioLostPer");this.videoLostPer=this.callHistory.find(".videoLostPer");this.jitter=this.callHistory.find(".jitter");this.historyClear=this.callHistory.find(".historyClear");this.historyCallLink=this.callHistory.find(".callLink");this.historyButton=$(".history-button");this.pageNumber=0;this.historyToggled=false;this.configuration=configuration;this.client=client;this.sound=sound;this.stats=stats;this.sipStack=sipStack;this.callsPerPage=10;this.maxPages=25;this.rows=[];this.registerListeners();this.updateContent()}History.Page=function(number,callsValue){this.number=number;this.calls=this.parseCalls(callsValue)};History.Page.prototype={callsAsString:function(){return this.calls.map(function(call){return call.toString()}).join("~")},parseCalls:function(callsValue){var calls=[];if(callsValue.trim().length>0){var callsArray=callsValue.split("~");for(var i=0;i<callsArray.length;i++){calls.push(new History.Call(callsArray[i]))}}return calls}};History.Call=function(value){var values=value?value.split("|"):[];this.startTime=values[0];this.destination=values[1];this.direction=values[2];this.resolutionIn=values[3];this.resolutionOut=values[4];this.bitrateIn=values[5];this.bitrateOut=values[6];this.frameRateIn=values[7];this.frameRateOut=values[8];this.audioLostPer=values[9];this.videoLostPer=values[10];this.jitter=values[11];this.length=values[12]};History.Call.prototype={startDate:function(){var date=new Date;date.setTime(this.startTime);return date.toLocaleString()},destinationWithoutSip:function(){return this.destination.replace(/sip:([^@]+)@.+/,"$1")},toString:function(){var values=[this.startTime,this.destination,this.direction,this.resolutionIn,this.resolutionOut,this.bitrateIn,this.bitrateOut,this.frameRateIn,this.frameRateOut,this.audioLostPer,this.videoLostPer,this.jitter,this.length];return values.join("|")}};History.prototype={pages:function(){var pages=[];for(var i=0;i<localStorage.length;i++){var key=localStorage.key(i);var regex=new RegExp(/page_(.*)/g);var match=regex.exec(key);if(match!==null&&match.length>1){var value=localStorage.getItem(key);var page=new History.Page(parseInt(match[1],10),value);pages.push(page)}}pages.sort(function(page1,page2){return page2.number-page1.number});return pages},updateButtonsVisibility:function(){var pages=this.pages();var pagesCount=pages?pages.length-1:0;if(this.pageNumber<pagesCount){this.historyForward.show()}else{this.historyForward.hide()}if(this.pageNumber>0){this.historyBack.show()}else{this.historyBack.hide()}},updateContent:function(){this.content.html("");this.rows=[];this.updateButtonsVisibility();var calls=this.getAllCalls();var startPos=this.callsPerPage*this.pageNumber;for(var i=startPos;i<startPos+this.callsPerPage&&i<calls.length;i++){var row=this.client.find(".historyRowSample").clone();row.attr("id","");row.attr("class","history-row");var call=calls[i];row.bind("click",this.callDetailsHandler(call));row.find(".historyCall").text(this.pageNumber*10+i+1);row.find(".hist-destination").text(call.destinationWithoutSip());row.find(".hist-direction").append("<i class='icon-arrow-"+call.direction+"-thick'></i>");row.find(".hist-date").text(Utils.formatDateTime(call.startDate()));row.find(".hist-length").text(call.length);this.rows.push(row);row.appendTo(this.content)}},getAllCalls:function(){var pages=this.pages();var calls=[];for(var i=0;i<pages.length;i++){calls=calls.concat(pages[i].calls)}return calls},callDetailsHandler:function(call){var self=this;return function(e){e.preventDefault();self.resolutionIn.text(call.resolutionIn);self.resolutionOut.text(call.resolutionOut);self.bitrateIn.text(call.bitrateIn);self.bitrateOut.text(call.bitrateOut);self.frameRateIn.text(call.frameRateIn);self.frameRateOut.text(call.frameRateOut);self.audioLostPer.text(call.audioLostPer);self.videoLostPer.text(call.videoLostPer);self.jitter.text(call.jitter);self.historyCallLink.attr("data-destination",call.destinationWithoutSip());self.historyCallLink.text("Call "+call.destinationWithoutSip());self.callHistoryDetails.fadeIn(100);self.callHistory.css({width:"416px"});$(".history-row").removeClass("active");$(this).addClass("active")}},setPageNumber:function(pageNumber){this.pageNumber=pageNumber;this.updateContent()},registerListeners:function(){var self=this;this.historyForward.bind("click",function(e){e.preventDefault();self.sound.playClick();self.setPageNumber(self.pageNumber+1)});this.historyBack.bind("click",function(e){e.preventDefault();self.sound.playClick();self.setPageNumber(self.pageNumber-1)});this.historyDetailsClose.bind("click",function(e){e.preventDefault();self.callHistoryDetails.fadeOut(100);self.callHistory.css({width:"200px"})});this.historyCallLink.bind("click",function(e){e.preventDefault();if(self.sipStack.getCallState()===SIPStack.C.STATE_CONNECTED){self.sound.playClick();var destination=self.historyCallLink.attr("data-destination");self.client.destination.val(destination);self.client.callUri(destination);self.callHistory.css({width:"200px"});self.callHistory.fadeOut(100)}self.callHistoryDetails.hide()});this.historyClear.bind("click",function(e){e.preventDefault();self.sound.playClick();var pages=self.pages();for(var i=0;i<pages.length;i++){localStorage.removeItem("page_"+pages[i].number)}self.setPageNumber(0)})},persistPage:function(page){var key="page_"+page.number;var value=page.callsAsString();localStorage[key]=value},persistCall:function(rtcSession){if(!this.configuration.enableCallHistory){return}var pages=this.pages();var page=null;if(pages.length>0){page=pages[0]}else{page=new History.Page(0,"")}if(page.calls.length>=this.callsPerPage){if(page.number+1>=this.maxPages){for(var i=0;i<pages.length;i++){var lastPageCall=pages[i].calls.pop();if(i+1<pages.length){pages[i+1].calls.unshift(lastPageCall)}this.persistPage(pages[i])}}else{page=new History.Page(page.number+1,"")}}var call=this.createCall(rtcSession);page.calls.unshift(call);this.persistPage(page);this.updateContent()},createCall:function(rtcSession){var call=new History.Call;var start=rtcSession.start_time;call.startTime=new Date(start).getTime();call.destination=rtcSession.remote_identity.uri;if(rtcSession.direction==="outgoing"){call.direction="up"}else{call.direction="down"}call.resolutionIn=this.stats.getValue("video","googFrameWidthReceived")+"x"+this.stats.getValue("video","googFrameHeightReceived");call.resolutionOut=this.stats.getValue("video","googFrameWidthSent")+"x"+this.stats.getValue("video","googFrameHeightSent");call.bitrateIn=this.stats.getAvg("video","kiloBitsReceivedPerSecond");call.bitrateOut=this.stats.getAvg("video","kiloBitsSentPerSecond");call.frameRateIn=this.stats.getAvg("video","googFrameRateReceived");call.frameRateOut=this.stats.getAvg("video","googFrameRateSent");call.audioLostPer=this.stats.getAvg("audio","packetsLostPer");call.videoLostPer=this.stats.getAvg("video","packetsLostPer");call.jitter=this.stats.getAvg("audio","googJitterReceived");call.length=Utils.format(Math.round(Math.abs((rtcSession.end_time-start)/1e3)));return call},toggle:function(){if(this.configuration.enableCallHistory===true){if(this.historyToggled===false){this.callHistory.fadeIn(100);this.historyClear.fadeIn(100);this.historyButton.addClass("active")}else if(this.historyToggled===true){this.callHistory.fadeOut(100);this.historyClear.fadeOut(100);this.historyButton.removeClass("active")}}this.historyToggled=!this.historyToggled}}},{"./SIPStack":59,"./Utils":67}],58:[function(require,module,exports){module.exports=Icon;function Icon(element,sound){this.element=element;this.sound=sound;this.disabled=false}Icon.prototype={css:function(name){return this.element.css(name)},attr:function(name){return this.element.attr(name)},disable:function(){this.disabled=true},enable:function(){this.disabled=false},onClick:function(handler){var self=this;this.element.bind("click",function(e){e.preventDefault();if(self.disabled){return}self.sound.playClick();handler(e)})}}},{}],59:[function(require,module,exports){module.exports=SIPStack;var C={STATE_CONNECTED:"connected",STATE_DISCONNECTED:"disconnected",STATE_CALLING:"calling",STATE_STARTED:"started",STATE_HELD:"held"};SIPStack.C=C;var ExSIP=require("exsip");var events=require("./EventBus");var debug=require("debug")("sipstack");var debugerror=require("debug")("sipstack:ERROR");debugerror.log=console.warn.bind(console);function SIPStack(configuration){this.configuration=configuration;this.ua=null;this.activeSession=null;this.sessions=[]}SIPStack.prototype={getLocalStreams:function(){return this.activeSession?this.activeSession.getLocalStreams():null},getRemoteStreams:function(){return this.activeSession?this.activeSession.getRemoteStreams():null},getSessionId:function(){return this.activeSession.id.replace(/\./g,"")},terminateSession:function(session){session=session||this.activeSession;if(!session){return}var index=this.sessions.indexOf(session);if(index!==-1){this.sessions.splice(index,index+1)}if(session.status!==ExSIP.RTCSession.C.STATUS_TERMINATED){session.terminate()}if(session===this.activeSession){debug("clearing active session");this.activeSession=null}events.emit("viewChanged",this)},terminateSessions:function(){var allSessions=[];allSessions=allSessions.concat(this.sessions);for(var i=0;i<allSessions.length;i++){this.terminateSession(allSessions[i])}},holdAndAnswer:function(session){var self=this;var firstSession=this.activeSession;session.on("ended",function(){events.emit("message",{text:"Resuming with "+firstSession.remote_identity.uri.user,level:"normal"});debug("incoming call ended - unholding first call");firstSession.unhold(function(){debug("unhold first call successful")})});this.activeSession.hold(function(){debug("hold successful - answering incoming call");self.answer(session)})},answer:function(session){session.answer(this.configuration.getExSIPOptions())},hold:function(successCallback,failureCallback){if(this.activeSession){this.activeSession.hold(successCallback,failureCallback)}},unhold:function(successCallback,failureCallback){if(this.activeSession){this.activeSession.unhold(successCallback,failureCallback)}},reconnectUserMedia:function(successCallback,failureCallback){var self=this;var onUserMediaUpdateSuccess=function(localMedia){debug("reconnect user media successful");if(self.activeSession){self.activeSession.changeSession({localMedia:localMedia},function(){debug("session changed successfully");if(successCallback){successCallback(localMedia)}},failureCallback)}else if(successCallback){successCallback(localMedia)}};this.updateUserMedia(onUserMediaUpdateSuccess,failureCallback)},call:function(destination){var session=this.ua.call(destination,this.configuration.getExSIPOptions());session.on("failed",function(e){events.emit("failed",e.data)});events.emit("calling",session)},sendDTMF:function(digit){this.activeSession.sendDTMF(digit,this.configuration.getDTMFOptions())},isStarted:function(){return this.getCallState()===C.STATE_STARTED},unregister:function(){return this.ua&&this.ua.unregister()},register:function(){return this.ua&&this.ua.register()},isRegistered:function(){return this.ua&&this.ua.isRegistered()},sendData:function(data){if(this.activeSession){this.activeSession.sendData(data)}},transfer:function(transferTarget,isAttended){if(isAttended){this.ua.attendedTransfer(transferTarget,this.activeSession)}else{this.ua.transfer(transferTarget,this.activeSession)}},updateRtcMediaHandlerOptions:function(){if(typeof this.ua==="undefined"){return}this.ua.setRtcMediaHandlerOptions(this.configuration.getRtcMediaHandlerOptions())},getCallState:function(){if(this.sessions.length>0){if(this.sessions.length===1&&!this.sessions[0].isStarted()){return C.STATE_CALLING}else{if(this.activeSession&&this.activeSession.isHeld()){return C.STATE_STARTED+" "+C.STATE_HELD}else{return C.STATE_STARTED}}}else{if(this.ua&&this.ua.isConnected&&this.ua.isConnected()){return C.STATE_CONNECTED}else{return C.STATE_DISCONNECTED}}},updateUserMedia:function(userMediaCallback,failureCallback){var self=this;if(!this.configuration.disabled&&(this.configuration.enableConnectLocalMedia||this.activeSession)){var options=this.configuration.getExSIPOptions();debug("updating user media ...");this.ua.getUserMedia(options,function(localStream){events.emit("userMediaUpdated",localStream);if(self.activeSession){debug("changing active session ...");self.activeSession.changeSession({localMedia:localStream,createOfferConstraints:options.createOfferConstraints},function(){debug("change session succeeded")},function(){debug("change session failed")})}if(userMediaCallback){userMediaCallback(localStream)}},function(e){events.emit("message",{text:self.configuration.messageGetUserMedia||"Get User Media Failed",level:"alert"});if(failureCallback){failureCallback(e)}},true)}},incomingReInvite:function(e){if(this.configuration.enableAutoAcceptReInvite){debug("auto accepting reInvite");e.data.session.acceptReInvite()}else{events.emit("reInvite",e.data)}},incomingCall:function(evt){var session=evt.data.session;if(!this.activeSession&&this.configuration.isAutoAnswer()){session.answer(this.configuration.getExSIPOptions())}else{events.emit("incomingCall",evt)}},init:function(data){try{var self=this;if(this.ua){debug("stopping existing UA");this.ua.stop()}if(this.configuration.disabled){return}this.ua=new ExSIP.UA(this.configuration.getExSIPConfig(data));this.updateRtcMediaHandlerOptions();this.ua.start();this.ua.on("connected",function(e){events.emit("viewChanged");events.emit("connected",e)});this.ua.on("disconnected",function(e){events.emit("viewChanged");events.emit("disconnected",e)});this.ua.on("onReInvite",function(e){debug("incoming onReInvite event");self.incomingReInvite(e)});this.ua.on("newRTCSession",function(e){var session=e.data.session;self.sessions.push(session);events.emit("viewChanged");session.on("progress",function(e){events.emit("progress",e)});session.on("failed",function(e){events.emit("failed",e)});session.on("started",function(e){events.emit("viewChanged",self);events.emit("started",e)});session.on("resumed",function(e){events.emit("viewChanged",self);events.emit("resumed",e)});session.on("held",function(e){events.emit("viewChanged",self);events.emit("held",e)});session.on("ended",function(e){events.emit("ended",e)});session.on("newDTMF",function(e){events.emit("newDTMF",e)});session.on("dataSent",function(e){events.emit("dataSent",e)});session.on("dataReceived",function(e){events.emit("dataReceived",e)});if(e.data.session.direction==="incoming"){self.incomingCall(e)}else{if(!self.activeSession){debug("new active session : "+session.id);self.activeSession=session}}});this.ua.on("registered",function(){events.emit("registered")});this.ua.on("unregistered",function(){events.emit("unregistered")});this.ua.on("registrationFailed",function(e){events.emit("registrationFailed",e)})}catch(e){debugerror("could not init sip stack",e)}}}},{"./EventBus":55,debug:10,exsip:27}],60:[function(require,module,exports){module.exports=SMS;var events=require("./EventBus");var debug=require("debug")("sms");var SMSProvider=require("./SMSProvider");var DateFormat=require("./DateFormat");var Utils=require("./Utils");function SMS(element,sound){this.sound=sound;this.view=element;this.status=element.find(".smsStatus");this.statusContent=this.status.find(".content");this.inbox=element.find(".smsInbox");this.inboxContent=this.inbox.find(".content");this.loginForm=element.find(".smsLoginForm");this.loginLink=element.find(".smsLogin");this.nameInput=element.find(".smsName");this.passwordInput=element.find(".smsPassword");this.sendForm=element.find(".smsSendForm");this.sendTo=element.find(".smsSendTo");this.sendBody=element.find(".smsSendBody");this.sendButton=element.find(".smsSendButton");this.inboxItems=[];this.smsProvider=new SMSProvider;this.toggled=false;this.registerListeners()}SMS.InboxItem=function(sms,message){this.sms=sms;this.message=message;this.cloned=sms.view.find(".sms-inbox-item-sample").clone(false);this.cloned.removeClass("sms-inbox-item-sample");this.cloned.attr("id",message.mid);this.from=this.cloned.find(".from");this.status=this.cloned.find(".status");this.time=this.cloned.find(".time");this.bodyText=this.cloned.find(".body .text");this.bodyImageLink=this.cloned.find(".body .image a");this.bodyImageText=this.cloned.find(".body .image span");this.bodyImageThumbnail=this.cloned.find(".body .image img");this.bodyVideo=this.cloned.find(".body .video video");this.bodyAudio=this.cloned.find(".body .audio audio");this.removeLink=this.cloned.find(".icon-trash");this.dateFormat=new DateFormat("%m/%d/%y %H:%M:%S");this.registerListeners();this.updateContent(message);return this};SMS.InboxItem.prototype={registerListeners:function(){var self=this;this.removeLink.bind("click",function(){self.sms.remove(self.message,self)})},enableActions:function(enable){this.removeLink.attr("disabled",!enable)},updateContent:function(message){var messageType=this.getMessageType(message);this.cloned.addClass(messageType);this.from.text(message.tn);this.status.text(SMS.getStatusAsString(message.status));this.time.text(this.dateFormat.format(new Date(message.time)));var body=message.body.trim();if(messageType==="image"){this.bodyImageLink.attr("href",message.mmscontentlocation);this.bodyImageText.text(body);if(message.mmscontentthumbnail){this.bodyImageThumbnail.attr("src","data:"+message.mmscontentsubtype+";base64,"+message.mmscontentthumbnail)}}else if(messageType==="video"){this.bodyVideo.attr("src",message.mmscontentlocation);this.bodyVideo.text(body)}else if(messageType==="audio"){this.bodyAudio.attr("src",message.mmscontentlocation);this.bodyAudio.text(body)}else{this.bodyText.html(body)}},getMessageType:function(message){if(message.mmscontentsubtype&&message.mmscontentsubtype.indexOf("image/")!==-1){return"image"}else if(message.mmscontentsubtype&&message.mmscontentsubtype.indexOf("video/")!==-1){return"video"}else if(message.mmscontentsubtype&&message.mmscontentsubtype.indexOf("audio/")!==-1){return"audio"}else{return"text"}},remove:function(){this.cloned.remove()},appendTo:function(element){this.cloned.appendTo(element)}};SMS.getStatusAsString=function(status){if(status==="N"){return"New"}else if(status==="U"){return"Unread"}else if(status==="R"){return"Read"}else if(status==="L"){return"Locked"}else if(status==="D"){return"Deleted"}else{throw new Error("Unsupported status : "+status)}};SMS.prototype={registerListeners:function(){var self=this;events.on("smsLoggedIn",function(){self.onLoggedIn()});events.on("smsSent",function(){self.status.hide();self.sendBody.val("");self.sendTo.val("");self.sendButton.attr("disabled",false)});events.on("smsReadAll",function(e){self.status.hide();var messages=e.messages;messages=messages.sort(function(a,b){return b.time-a.time});var incomingMessages=$.grep(messages,function(n){return n.dir==="I"});self.updateInbox(incomingMessages)});this.loginLink.bind("click",function(e){e.preventDefault();self.login(self.nameInput.val(),self.passwordInput.val())});this.passwordInput.bind("keypress",function(e){if(e.keyCode===13){e.preventDefault();self.login(self.nameInput.val(),self.passwordInput.val())}});this.sendButton.bind("click",function(e){e.preventDefault();self.sendSMS()});this.sendBody.bind("keypress",function(e){if(e.keyCode===13){e.preventDefault();self.sendSMS()}})},remove:function(message,inboxItem){var self=this;this.sound.playClick();if(!window.confirm("Do you really want to delete SMS from "+message.tn+"?")){return}this.info("Deleting SMS...");if(inboxItem){inboxItem.enableActions(false)}this.smsProvider.remove([message.mid],function(){self.status.hide();inboxItem.remove()},function(msg){self.error("Deleting SMS failed : "+msg);inboxItem.enableActions(true)})},login:function(name,password){var self=this;this.sound.playClick();this.info("Logging in...");this.smsProvider.login(name,password,function(msg){self.error("Logging failed : "+msg)})},onNotification:function(notifications){var needsRead=false,self=this;if(!notifications){return}for(var i=0;i<notifications.length;i++){if(notifications[i].action==="new-rec"||notifications[i].action==="update"||notifications[i].action==="delete"){needsRead=true;break}}if(needsRead){this.smsProvider.readAll(function(msg){self.error("Fetching SMS failed : "+msg)})}},enableUpdate:function(enable){this.enableUpdate=enable;this.triggerUpdate()},triggerUpdate:function(){var self=this;if(this.enableUpdate&&!this.pendingUpdate){debug("triggering getUpdate");this.pendingUpdate=true;this.smsProvider.getUpdate(function(notifications){self.pendingUpdate=false;self.onNotification(notifications);self.triggerUpdate()},function(){self.pendingUpdate=false;self.error("Technical problems connecting to server - auto refresh disabled")})}},sendSMS:function(){var self=this;this.sound.playClick();var msg=this.validateSendForm();if(msg!==""){this.error(msg);return}this.info("Sending SMS...");this.sendButton.attr("disabled",true);this.smsProvider.sendSMS([this.sendTo.val()],this.sendBody.val(),function(msg){self.sendButton.attr("disabled",false);self.error("Sending SMS failed : "+msg)})},validateSendForm:function(){var to=this.sendTo.val();var msgs=[];if(to===""){msgs.push("Please enter a phone number to send to")}else if(!Utils.isValidUsPstn(to)){msgs.push(to+" not a valid US phone number")}var body=this.sendBody.val();if(body===""){msgs.push("Please enter a text to send")}return msgs.join("\n")},onLoggedIn:function(){var self=this;this.loginForm.hide();this.inbox.show();this.sendForm.show();this.enableUpdate(true);this.smsProvider.readAll(function(msg){self.error("Fetching SMS failed : "+msg)});this.info("Fetching SMS...")},updateInbox:function(messages){this.inboxContent.html("");this.inboxItems=[];for(var i=0;i<messages.length;i++){var inboxItem=new SMS.InboxItem(this,messages[i]);inboxItem.appendTo(this.inboxContent);this.inboxItems.push(inboxItem)}},setStatus:function(msg,type){this.status.show();this.status.attr("class",type);this.statusContent.text(msg)},error:function(msg){this.setStatus(msg,"error")},info:function(msg){this.setStatus(msg,"info")},toggle:function(){if(ClientConfig.enableSMS){if(this.toggled){this.view.fadeOut(100)}else{this.view.fadeIn(100)}this.toggled=!this.toggled}}}},{"./DateFormat":54,"./EventBus":55,"./SMSProvider":61,"./Utils":67,debug:10}],61:[function(require,module,exports){module.exports=SMSProvider;var ExSIP=require("exsip");var events=require("./EventBus");var debug=require("debug")("smsprovider");var debugerror=require("debug")("client:ERROR");debugerror.log=console.warn.bind(console);function SMSProvider(){this.init()}SMSProvider.prototype={send:function(type,restSuffix,jsonData,successCallback,failureCallback,isJsonp){var url="http://"+ClientConfig.smsHost+"/"+ClientConfig.smsUser+"/"+restSuffix;if(this.sessionid){url+=";jsessionid="+this.sessionid}debug("Request to "+url+" : "+ExSIP.Utils.toString(jsonData));$.ajax({crossDomain:true,contentType:type==="GET"?"text/plain":"text/plain",dataType:isJsonp?"jsonp":"json",type:type,url:url,data:type==="GET"?jsonData:JSON.stringify(jsonData)}).done(function(msg){if(msg.status==="empty"||msg.status==="success"||msg.status.code==="0000001"){debug("Response successful : "+ExSIP.Utils.toString(msg));if(successCallback){successCallback(msg)}}else{debugerror("Response failed : "+ExSIP.Utils.toString(msg));if(failureCallback){failureCallback(msg.status.message)}}}).fail(function(jqXHR,textStatus){debugerror("Response error : "+textStatus);if(failureCallback){failureCallback(textStatus)}})},getUpdate:function(onNotification,onFailure){var onSuccess=function(msg){debug("received notification : "+ExSIP.Utils.toString(msg));onNotification(msg.notifications)};var data={fid:this.name,platform:"fmc"};this.send("GET","getUpdate",data,onSuccess,onFailure,false)},sendSMS:function(desttnarray,body,onFailure){var onSuccess=function(msg){debug("sent msg "+msg+" to "+desttnarray);events.emit("smsSent",{desttnarray:desttnarray,body:body})};var data={desttnarray:desttnarray,body:body};this.send("POST","ua/msg/sms/send",data,onSuccess,onFailure)},remove:function(mids,onSuccess,onFailure){var data={mids:mids};this.send("POST","ua/msg/sms/delete",data,function(){debug("Deleted msgs : "+mids);if(onSuccess){onSuccess()}},onFailure)},readAll:function(onFailure){var onSuccess=function(msg){debug("Read all mgs : "+ExSIP.Utils.toString(msg.messages));events.emit("smsReadAll",{messages:msg.messages})};var data=null;this.send("GET","ua/msg/sms/all",data,onSuccess,onFailure)},login:function(name,password,onFailure){var self=this;var onSuccess=function(msg){self.sessionid=msg.sessionid;self.name=name;debug("Logged in "+name+" : "+msg.sessionid);events.emit("smsLoggedIn")};var data={spcode:ClientConfig.smsSpcode,password:password,name:name,platform:"fmc"};this.send("POST","ua/login",data,onSuccess,onFailure)},init:function(){this.registerListeners()},registerListeners:function(){}}},{"./EventBus":55,debug:10,exsip:27}],62:[function(require,module,exports){module.exports=Settings;var events=require("./EventBus");var debug=require("debug")("settings");var debugerror=require("debug")("settings:ERROR");debugerror.log=console.warn.bind(console);var WebRTC_C=require("./Constants");var Utils=require("./Utils");function Settings(client,configuration,sound,sipStack){this.settingsIcon=client.find(".settings");this.settingsUi=client.find(".settingsPopup");this.popup=this.settingsUi;this.localVideoTop=this.settingsUi.find(".settingLocalVideoTop");this.localVideoLeft=this.settingsUi.find(".settingLocalVideoLeft");this.userIdInput=this.settingsUi.find(".settingUserid");this.authenticationUserIdInput=this.settingsUi.find(".settingAuthenticationUserid");this.passwordInput=this.settingsUi.find(".settingPassword");this.saveBtn=this.settingsUi.find(".saveSettings");this.signInBtn=this.settingsUi.find(".sign-in");this.signOutBtn=this.settingsUi.find(".sign-out");this.displayNameInput=this.settingsUi.find(".settingDisplayName");this.resolutionType=this.settingsUi.find(".resolutionTypeSelect");this.resolutionDisplayWidescreen=this.settingsUi.find(".resolutionDisplayWidescreenSelect");this.resolutionDisplayStandard=this.settingsUi.find(".resolutionDisplayStandardSelect");this.resolutionEncodingWidescreen=this.settingsUi.find(".resolutionEncodingWidescreenSelect");this.resolutionEncodingStandard=this.settingsUi.find(".resolutionEncodingStandardSelect");this.bandwidthLowInput=this.settingsUi.find(".settingBandwidthLow");this.bandwidthMedInput=this.settingsUi.find(".settingBandwidthMed");this.bandwidthHighInput=this.settingsUi.find(".settingBandwidthHigh");this.settingDisplayNameRow=this.settingsUi.find(".settingDisplayNameRow");this.settingUseridRow=this.settingsUi.find(".settingUseridRow");this.settingSelfViewDisableRow=this.settingsUi.find(".settingSelfViewDisableRow");this.settingHDRow=this.settingsUi.find(".settingHDRow");this.settingAutoAnswerRow=this.settingsUi.find(".settingAutoAnswerRow");this.settingResolutionTypeRow=this.settingsUi.find(".settingResolutionTypeRow");this.settingResolutionDisplayRow=this.settingsUi.find(".settingResolutionDisplayRow");this.settingResolutionEncodingRow=this.settingsUi.find(".settingResolutionEncodingRow");this.settingResolutionRow=this.settingsUi.find(".settingResolutionRow");this.settingBandwidthRow=this.settingsUi.find(".settingBandwidthRow");this.settingCallHistoryTop=this.settingsUi.find(".settingCallHistoryTop");this.settingCallHistoryLeft=this.settingsUi.find(".settingCallHistoryLeft");this.settingCallStatsTop=this.settingsUi.find(".settingCallStatsTop");this.settingCallStatsLeft=this.settingsUi.find(".settingCallStatsLeft");this.resolutionTypeSelect=this.settingsUi.find(".resolutionTypeSelect");this.settingSelfViewDisable=this.settingsUi.find(".settingSelfViewDisable");this.settingHD=this.settingsUi.find(".settingHD");this.settingSize=this.settingsUi.find(".settingSize");this.settingAutoAnswer=this.settingsUi.find(".settingAutoAnswer");this.colorInput=this.settingsUi.find(".settingColor");this.tabConfigureLink=this.settingsUi.find("[href='#tab1']");this.tabLayoutLink=this.settingsUi.find("[href='#tab2']");
this.clearLink=this.settingsUi.find(".clear");this.configuration=configuration;this.sound=sound;this.client=client;this.sipStack=sipStack;this.toggled=false;this.settingsChanged=false;var self=this;this.cookiesMapper={settingDisplayName:{name:"displayName",initValue:function(){return self.configuration.sipDisplayName||$.cookie("settingDisplayName")},inputSetter:function(val){self.displayNameInput.val(val)},inputGetter:function(){return self.displayNameInput.val()}},settingUserId:{name:"userId",inputSetter:function(val){self.userIdInput.val(val)},inputGetter:function(){return self.userIdInput.val()}},settingPassword:{name:"password",inputSetter:function(val){self.passwordInput.val(val)},inputGetter:function(){return self.passwordInput.val()}},settingAuthenticationUserId:{name:"authenticationUserId",inputSetter:function(val){self.authenticationUserIdInput.val(val)},inputGetter:function(){return self.authenticationUserIdInput.val()}},settingSelfViewDisable:{name:"selfViewDisable",initValue:function(){return $.cookie("settingSelfViewDisable")==="true"},inputSetter:function(val){self.settingSelfViewDisable.prop("checked",val)},inputGetter:function(){return self.settingSelfViewDisable.prop("checked")}},settingHD:{name:"hd",initValue:function(){return $.cookie("settingHD")==="true"},inputSetter:function(val){self.settingHD.prop("checked",val)},inputGetter:function(){return self.settingHD.prop("checked")}},settingBandwidthLow:{name:"bandwidthLow",initValue:function(){return self.configuration.bandwidthLow||$.cookie("settingBandwidthLow")},inputSetter:function(val){self.bandwidthLowInput.val(val)},inputGetter:function(){return self.bandwidthLowInput.val()}},settingBandwidthMed:{name:"bandwidthMed",initValue:function(){return self.configuration.bandwidthMed||$.cookie("settingBandwidthMed")},inputSetter:function(val){self.bandwidthMedInput.val(val)},inputGetter:function(){return self.bandwidthMedInput.val()}},settingBandwidthHigh:{name:"bandwidthHigh",initValue:function(){return self.configuration.bandwidthHigh||$.cookie("settingBandwidthHigh")},inputSetter:function(val){self.bandwidthHighInput.val(val)},inputGetter:function(){return self.bandwidthHighInput.val()}},settingColor:{name:"color",initValue:function(){return self.configuration.getBackgroundColor()},inputSetter:function(val){self.colorInput.val(val||"#ffffff")},inputGetter:function(){return self.colorInput.val()}},settingResolutionDisplay:{name:"resolutionDisplay",initValue:function(){return self.configuration.displayResolution||$.cookie("settingResolutionDisplay")||WebRTC_C.DEFAULT_RESOLUTION_DISPLAY},inputSetter:function(val){self.setResolutionDisplay(val)},inputGetter:function(){return self.getResolutionDisplay()}},settingResolutionEncoding:{name:"resolutionEncoding",initValue:function(){return self.configuration.encodingResolution||$.cookie("settingResolutionEncoding")||WebRTC_C.DEFAULT_RESOLUTION_ENCODING},inputSetter:function(val){self.setResolutionEncoding(val)},inputGetter:function(){return self.getResolutionEncoding()}},settingSize:{name:"size",initValue:function(){return self.configuration.size||$.cookie("settingSize")},inputSetter:function(val){self.settingSize.val(val)},inputGetter:function(){return self.settingSize.val()}},settingAutoAnswer:{name:"autoAnswer",initValue:function(){return $.cookie("settingAutoAnswer")==="true"},inputSetter:function(val){self.settingAutoAnswer.prop("checked",val)},inputGetter:function(){return self.settingAutoAnswer.prop("checked")}},settingWindowPosition:{name:"windowPosition",inputSetter:function(){},inputGetter:function(){return".localVideo"+"-"+self.localVideoTop.val()+"-"+self.localVideoLeft.val()+"|"+".callHistory"+"-"+self.settingCallHistoryTop.val()+"-"+self.settingCallHistoryLeft.val()+"|"+".callStats"+"-"+self.settingCallStatsTop.val()+"-"+self.settingCallStatsLeft.val()}}};function makeAccessor(cookie){var mapping=self.cookiesMapper[cookie];self[mapping.name]=function(value){if(arguments.length===1){mapping.inputSetter(value);if(value){$.cookie(cookie,value,{expires:self.configuration.expires})}else{jQuery.removeCookie(cookie)}}else{return mapping.inputGetter()}}}for(var cookie in this.cookiesMapper){makeAccessor(cookie)}this.registerListeners();this.initUi();this.updateRowVisibility();this.updatePageColor();this.initializeTabs()}Settings.prototype={registerListeners:function(){var self=this;events.on("ended",function(){if(self.settingsChanged){self.reload()}});events.on("registered",function(){self.enableRegistration(true)});events.on("unregistered",function(){self.enableRegistration(true)});events.on("registrationFailed",function(){self.enableRegistration(true)});this.resolutionTypeSelect.bind("change",function(){self.updateResolutionSelectVisibility()});this.settingsIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.toggled=!self.toggled;self.client.updateClientClass();self.client.toggleDialpad(false);self.client.history.historyToggled=true;self.client.history.toggle()});this.colorInput.bind("change",function(){self.updatePageColor()});this.clearLink.on("click",function(e){e.preventDefault();self.resetLayout();events.emit("message",{text:"Settings reset"})});this.signOutBtn.on("click",function(e){e.preventDefault();self.signOut()});this.saveBtn.bind("click",function(e){e.preventDefault();self.save()});this.signInBtn.bind("click",function(e){e.preventDefault();self.signIn()});this.bandwidthLowInput.bind("blur",function(){self.client.sipStack.updateRtcMediaHandlerOptions()});this.bandwidthMedInput.bind("blur",function(){self.client.sipStack.updateRtcMediaHandlerOptions()});this.bandwidthHighInput.bind("blur",function(){self.client.sipStack.updateRtcMediaHandlerOptions()});this.resolutionType.bind("change",function(){self.client.updateClientClass();self.client.sipStack.updateRtcMediaHandlerOptions();self.client.sipStack.updateUserMedia()});this.resolutionDisplayWidescreen.bind("change",function(){self.client.updateClientClass()});this.resolutionDisplayStandard.bind("change",function(){self.client.updateClientClass()});this.resolutionEncodingWidescreen.bind("change",function(){self.client.sipStack.updateRtcMediaHandlerOptions();self.client.sipStack.updateUserMedia()});this.resolutionEncodingStandard.bind("change",function(){self.client.sipStack.updateRtcMediaHandlerOptions();self.client.sipStack.updateUserMedia()})},updateRowVisibility:function(){this.settingAutoAnswerRow.toggle(this.configuration.enableAutoAnswer);this.settingSelfViewDisableRow.toggle(!this.configuration.hasOwnProperty("enableSelfView"));this.settingHDRow.toggle(!this.configuration.hasOwnProperty("enableHD"));this.settingResolutionRow.toggle(!this.configuration.hasOwnProperty("displayResolution")||!this.configuration.hasOwnProperty("encodingResolution"));this.settingResolutionDisplayRow.toggle(!this.configuration.hasOwnProperty("displayResolution"));this.settingResolutionEncodingRow.toggle(!this.configuration.hasOwnProperty("encodingResolution"));this.settingResolutionTypeRow.toggle(!this.configuration.hasOwnProperty("displayResolution")&&!this.configuration.hasOwnProperty("encodingResolution"));this.bandwidthLowInput.toggle(!this.configuration.hasOwnProperty("bandwidthLow"));this.bandwidthMedInput.toggle(!this.configuration.hasOwnProperty("bandwidthMed"));this.bandwidthHighInput.toggle(!this.configuration.hasOwnProperty("bandwidthHigh"));this.settingBandwidthRow.toggle(!this.configuration.hasOwnProperty("bandwidthLow")||!this.configuration.hasOwnProperty("bandwidthMed")||!this.configuration.hasOwnProperty("bandwidthHigh"));this.settingDisplayNameRow.toggle(!this.configuration.hasOwnProperty("displayName"))},getBandwidth:function(){var height=this.getResolutionEncodingHeight();if(height<=240){return this.bandwidthLowInput.val()}else if(height<=480){return this.bandwidthMedInput.val()}else if(height<=720){return this.bandwidthHighInput.val()}},reload:function(){location.reload(0)},updatePageColor:function(){var color=this.configuration.getBackgroundColor();debug("updating page color : "+color);$("body").css("backgroundColor",color||"")},initUi:function(){Utils.addSelectOptions(WebRTC_C.RESOLUTION_TYPES,this.resolutionType);Utils.addSelectOptions(WebRTC_C.STANDARD_RESOLUTIONS,this.resolutionDisplayStandard);Utils.addSelectOptions(WebRTC_C.WIDESCREEN_RESOLUTIONS,this.resolutionDisplayWidescreen);Utils.addSelectOptions(WebRTC_C.STANDARD_RESOLUTIONS,this.resolutionEncodingStandard);Utils.addSelectOptions(WebRTC_C.WIDESCREEN_RESOLUTIONS,this.resolutionEncodingWidescreen);for(var cookie in this.cookiesMapper){var mapping=this.cookiesMapper[cookie];var value=mapping.initValue?mapping.initValue():$.cookie(cookie);mapping.inputSetter(value)}},updateViewPositions:function(){var localVideoPosition=this.client.video.local.position();if(localVideoPosition&&localVideoPosition.top!==0&&localVideoPosition.left!==0){this.localVideoTop.val(localVideoPosition.top);this.localVideoLeft.val(localVideoPosition.left)}var callHistoryPosition=this.client.callHistory.position();if(callHistoryPosition&&callHistoryPosition.top!==0&&callHistoryPosition.left!==0){this.settingCallHistoryTop.val(callHistoryPosition.top);this.settingCallHistoryLeft.val(callHistoryPosition.left)}var callStatsPosition=this.client.callStats.position();if(callStatsPosition&&callStatsPosition.top!==0&&callStatsPosition.left!==0){this.settingCallStatsTop.val(callStatsPosition.top);this.settingCallStatsLeft.val(callStatsPosition.left)}},updateResolutionSelectVisibility:function(){var resolutionType=this.resolutionType.val();this.resolutionDisplayStandard.toggle(resolutionType===WebRTC_C.STANDARD);this.resolutionEncodingStandard.toggle(resolutionType===WebRTC_C.STANDARD);this.resolutionDisplayWidescreen.toggle(resolutionType===WebRTC_C.WIDESCREEN);this.resolutionEncodingWidescreen.toggle(resolutionType===WebRTC_C.WIDESCREEN)},setResolutionDisplay:function(resolution){this.setResolution(resolution,this.resolutionDisplayStandard,this.resolutionDisplayWidescreen)},setResolutionEncoding:function(resolution){this.setResolution(resolution,this.resolutionEncodingStandard,this.resolutionEncodingWidescreen)},setResolution:function(resolution,resolutionStandard,resolutionWidescreen){if(Utils.containsKey(WebRTC_C.STANDARD_RESOLUTIONS,resolution)){this.resolutionType.val(WebRTC_C.STANDARD);resolutionStandard.val(resolution)}else if(Utils.containsKey(WebRTC_C.WIDESCREEN_RESOLUTIONS,resolution)){this.resolutionType.val(WebRTC_C.WIDESCREEN);resolutionWidescreen.val(resolution)}else{debugerror("no resolution type for "+resolution)}this.updateResolutionSelectVisibility()},getResolutionDisplay:function(){return this.getResolution(this.resolutionDisplayStandard,this.resolutionDisplayWidescreen)},getResolutionEncodingWidth:function(){var resolution=this.getResolutionEncoding();if(!$.isBlank(resolution)){var resolutions=resolution.split("x");return parseInt(resolutions[0],10)}},getResolutionEncodingHeight:function(){var resolution=this.getResolutionEncoding();if(!$.isBlank(resolution)){var resolutions=resolution.split("x");return parseInt(resolutions[1],10)}},getResolutionEncoding:function(){return this.getResolution(this.resolutionEncodingStandard,this.resolutionEncodingWidescreen)},getResolution:function(resolutionStandard,resolutionWidescreen){var resolutionType=this.resolutionType.val();if(resolutionType===WebRTC_C.STANDARD){return resolutionStandard.val()}else if(resolutionType===WebRTC_C.WIDESCREEN){return resolutionWidescreen.val()}else{return false}},changed:function(){if(!this.sipStack.activeSession){this.reload()}else{this.settingsChanged=true}},save:function(){this.sound.playClick();this.persist();this.toggled=false;this.client.updateClientClass();this.changed()},enableRegistration:function(enable){this.signInBtn.removeClass("disabled");this.signOutBtn.removeClass("disabled");if(!enable){this.signInBtn.addClass("disabled");this.signOutBtn.addClass("disabled")}},signIn:function(){this.sound.playClick();this.persist();this.sipStack.init();this.enableRegistration(false)},signOut:function(){this.sound.playClick();this.sipStack.unregister();this.clearConfigurationCookies();this.enableRegistration(false)},resetLayout:function(){this.resolutionEncoding(WebRTC_C.DEFAULT_RESOLUTION_ENCODING);this.resolutionDisplay(WebRTC_C.DEFAULT_RESOLUTION_DISPLAY);this.client.updateClientClass()},clearConfigurationCookies:function(){$.removeCookie("settingDisplayName");$.removeCookie("settingUserId");$.removeCookie("settingAuthenticationUserId");$.removeCookie("settingPassword")},clearConfiguration:function(){this.displayName(null);this.userId(null);this.authenticationUserId(null);this.password(null)},clear:function(){for(var cookie in this.cookiesMapper){var mapping=this.cookiesMapper[cookie];this[mapping.name](null)}},persist:function(){for(var cookie in this.cookiesMapper){var mapping=this.cookiesMapper[cookie];$.cookie(cookie,mapping.inputGetter(),{expires:this.configuration.expires})}},toggleSettings:function(flag){this.toggled=flag;this.client.updateClientClass()},initializeTabs:function(){$("ul.tabs").each(function(){var $active,$content,$links=$(this).find("a");$active=$($links.filter('[href="'+location.hash+'"]')[0]||$links[0]);$active.addClass("active");$content=$($active[0].hash);$links.not($active).each(function(){$(this.hash).hide()});$(this).on("click","a",function(e){$active.removeClass("active");$content.hide();$active=$(this);$content=$(this.hash);$active.addClass("active");$content.show();e.preventDefault()})})}}},{"./Constants":53,"./EventBus":55,"./Utils":67,debug:10}],63:[function(require,module,exports){module.exports=Sound;var events=require("./EventBus");var WebRTC_C=require("./Constants");function Sound(sipStack,configuration){this.sipStack=sipStack;this.soundOut=document.createElement("audio");this.soundOut.volume=configuration.volumeClick;this.soundOutDTMF=document.createElement("audio");this.soundOutDTMF.volume=configuration.volumeDTMF;this.muted=false;this.registerListeners()}Sound.prototype={registerListeners:function(){var self=this;events.on("resumed",function(){self.updateLocalAudio()});events.on("started",function(){self.updateLocalAudio()});events.on("userMediaUpdated",function(){self.updateLocalAudio()})},setMuted:function(muted){this.muted=muted;events.emit("viewChanged");this.updateLocalAudio()},updateLocalAudio:function(){this.enableLocalAudio(!this.muted)},enableLocalAudio:function(enabled){var localStreams=this.sipStack.getLocalStreams();if(!localStreams||localStreams.length===0){return}var localMedia=localStreams[0];var localAudio=localMedia.getAudioTracks()[0];localAudio.enabled=enabled},pause:function(){this.soundOut.pause();this.soundOutDTMF.pause()},playDtmfRingback:function(){this.playDtmf("dtmf-ringback",{loop:true})},playRingtone:function(){this.play("ringtone",{loop:true})},playDtmfTone:function(tone){this.playDtmf("dtmf-"+tone)},playClick:function(){this.play("click")},play:function(media,options){this.playTone(this.soundOut,media,options)},playTone:function(audioSource,media,options){if(audioSource.getAttribute("src")===media&&!audioSource.paused){return}options=options||{};audioSource.setAttribute("src",WebRTC_C.MEDIA[media]);if(options.loop){audioSource.setAttribute("loop","true")}else{audioSource.removeAttribute("loop")}audioSource.play()},playDtmf:function(media,options){this.playTone(this.soundOutDTMF,media,options)}}},{"./Constants":53,"./EventBus":55}],64:[function(require,module,exports){module.exports=Stats;function Stats(client,sipStack,configuration){this.ui=client.find(".callStats");this.statsToggled=false;this.sipStack=sipStack;this.configuration=configuration;this.initialize()}Stats.prototype={toggle:function(){if(this.configuration.enableCallStats){if(this.statsToggled===false){this.ui.fadeIn(100)}else if(this.statsToggled===true){this.ui.fadeOut(100)}}this.statsToggled=!this.statsToggled},getReportById:function(reports,id){for(var i=0;i<reports.length;i++){if(reports[i].id===id){return reports[i]}}return null},processStats:function(){var self=this;var peerConnection=this.sipStack.activeSession.rtcMediaHandler.peerConnection;peerConnection.getStats(function(stats){var results=stats.result();var reports=[];for(var i=0;i<results.length;++i){var res=results[i];var report=self.getReportById(reports,res.id);if(!report){report={};report.type=res.type;report.id=res.id}var names=res.names();var values=[];for(var j=0;j<names.length;j++){var name=names[j];if(!name){continue}var value=res.stat(name);values.push(name);values.push(value)}var valueObj={};valueObj.timestamp=res.timestamp;valueObj.values=values;report.stats=valueObj;reports.push(report)}var data={lid:1,pid:self.sipStack.getSessionId(),reports:reports};addStats(data)})},getDataSerie:function(type,label,sessionId){var dataSeries=getDataSeriesByLabel(sessionId||this.sipStack.getSessionId(),type,label);var result;for(var i=0;i<dataSeries.length;i++){var dataSerie=dataSeries[i];if(!result||dataSerie.getAvg()>result.getAvg()){result=dataSerie}}return result},getStatValues:function(type,label,sessionId){var dataSerie=this.getDataSerie(type,label,sessionId);return dataSerie?dataSerie.dataPoints_.map(function(e){return e.value}):null},getStatAvg:function(type,label,sessionId){var dataSerie=this.getDataSerie(type,label,sessionId);return dataSerie?dataSerie.getAvg():null},setSelected:function(id,parentSelector,selected){if(arguments.length===2){selected=true}var className=id.replace(/\d+/g,"");var classes=jQuery.grep($(parentSelector).attr("class").split(" "),function(n){return n.indexOf(className)===-1});if(selected){classes.push(id+"-selected");if(id!==className){classes.push(className+"-selected")}}var classNames=classes.join(" ");$(parentSelector).attr("class",classNames)},getValue:function(type,name){return $('[data-type="'+type+'"][data-var="'+name+'"]').text()},getAvg:function(type,name){return Math.round($('[data-type="'+type+'"][data-var="'+name+'"]').attr("data-avg")*100)/100},initialize:function(){var self=this;$("a.stats-var").click(function(){var index=$(".stats-var").index($(this)[0]);self.setSelected("stats"+index,this.callStats)})}}},{}],65:[function(require,module,exports){module.exports=Timer;var debug=require("debug")("timer");var Utils=require("./Utils");function Timer(client,stats,configuration){this.text=client.find(".timer");this.client=client;this.stats=stats;this.configuration=configuration;this.callTimer=null;this.startTime=null;this.updateText()}Timer.prototype={start:function(){if(this.callTimer){debug("timer "+this.callTimer+" already running");return}var timer=this.runningTimer();this.callTimer=setInterval(timer,1e3);debug("started timer interval : "+this.callTimer)},stop:function(){this.startTime=null;clearInterval(this.callTimer);debug("cleared timer interval : "+this.callTimer);this.callTimer=null;this.updateText()},getSeconds:function(){return Math.round(((new Date).getTime()-(this.startTime||(new Date).getTime()))/1e3)},updateText:function(){var secs=this.getSeconds();this.text.text(Utils.format(secs))},runningTimer:function(){var self=this;this.startTime=(new Date).getTime();return function(){var secs=self.getSeconds();if(self.configuration.maxCallLength&&secs>=self.configuration.maxCallLength){self.client.terminateSessions();self.client.endCall();return}self.updateText();if(self.configuration.enableCallStats&&Utils.isChrome()){self.stats.processStats()}}}}},{"./Utils":67,debug:10}],66:[function(require,module,exports){module.exports=Transfer;function Transfer(client,sound,sipStack,configuration){this.icon=client.find(".transfer");this.popup=client.find(".transferPopup");this.accept=this.popup.find(".acceptTransfer");this.reject=this.popup.find(".rejectTransfer");this.targetInput=this.popup.find(".transferTarget");this.typeAttended=this.popup.find(".transferTypeAttended");this.visible=false;this.client=client;this.sound=sound;this.sipStack=sipStack;this.configuration=configuration;this.registerListeners()}Transfer.prototype={registerListeners:function(){var self=this;this.icon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.setVisible(!self.visible);if(self.visible){self.targetInput.focus()}});this.accept.bind("click",function(e){e.preventDefault();self.sound.playClick();var targetInput=self.targetInput.val();if($.isBlank(targetInput)){self.client.message(self.configuration.messageOutsideDomain,"alert");return}targetInput=self.client.validateDestination(targetInput);self.setVisible(false);self.sipStack.transfer(targetInput,self.typeAttended.is(":checked"))});this.reject.bind("click",function(e){e.preventDefault();self.sound.playClick();self.setVisible(false)})},setVisible:function(visible){this.visible=visible;this.client.updateClientClass()}}},{}],67:[function(require,module,exports){var Utils={clone:function(obj){return JSON.parse(JSON.stringify(obj))},dataURItoBlob:function(dataURI){var byteString=atob(dataURI.split(",")[1]);var mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0];var ab=new ArrayBuffer(byteString.length);var ia=new Uint8Array(ab);for(var i=0;i<byteString.length;i++){ia[i]=byteString.charCodeAt(i)}var blob=new Blob([ab],{type:mimeString});return blob},format:function(seconds){var hrs=Math.floor(seconds/3600);seconds%=3600;var mns=Math.floor(seconds/60);seconds%=60;var formatedDuration=(hrs<10?"0":"")+hrs+":"+(mns<10?"0":"")+mns+":"+(seconds<10?"0":"")+seconds;return formatedDuration},formatDateTime:function(dateStr){var date=new Date(dateStr);var strDate=date.getMonth()+1+"/"+date.getDate();var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var strTime=hours+":"+minutes+" "+ampm;return strDate+" - "+strTime},getSearchVariable:function(variable){var search=decodeURIComponent(window.location.search.substring(1));var vars=search.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]===variable){return pair[1]}}return false},containsKey:function(object,value){return $.inArray(value,$.map(object,function(key){return key}))!==-1},containsValue:function(object,value){return $.inArray(value,$.map(object,function(key,value){return value}))!==-1},addSelectOptions:function(options,selector){$.each(options,function(key,value){$(selector).append($("<option>",{value:value}).text(key))})},randomUserid:function(){var chars="0123456789abcdef";var string_length=10;var userid="";for(var i=0;i<string_length;i++){var rnum=Math.floor(Math.random()*chars.length);userid+=chars.substring(rnum,rnum+1)}return userid},whiteboardCompabilityCheck:function(){var isChrome=this.isChrome();if(!isChrome){return"Chrome is required for whiteboard feature, please go to:<br>"+"<a href='http://chrome.google.com'>http://chrome.google.com</a>"}var major=this.majorVersion();if(isChrome&&major<34){return"Your version of Chrome must be upgraded to at least version 34 in order to be able to use the whiteboard<br>"+"Please go to: <a href='http://chrome.google.com'>http://chrome.google.com</a> or <a href='https://www.google.com/intl/en/chrome/browser/canary.html'>https://www.google.com/intl/en/chrome/browser/canary.html</a>"}},compatibilityCheck:function(client){var isChrome=this.isChrome();var isFirefox=this.isFirefox();if(!isChrome&&!isFirefox){return"Chrome or Firefox is required, please go to:<br>"+"<a href='http://chrome.google.com'>http://chrome.google.com</a> or <a href='http:www.mozilla.org'>http://www.mozilla.org</a>"}var major=this.majorVersion();if(isChrome&&major<25){return"Your version of Chrome must be upgraded to at least version 25<br>"+"Please go to: <a href='http://chrome.google.com'>http://chrome.google.com</a>"}else{if(isFirefox&&major<22){return"Your version of Firefox must be upgraded to at least version 22y<br>"+"Please go to: <a href='http://www.mozilla.org'>http://www.mozilla.org</a>"}client.configuration.enableStats=false}},isValidUsPstn:function(pstn){pstn=pstn.replace(/-/g,"").replace(/\(/g,"").replace(/\)/g,"");return pstn.match(/^1?\d{10}$/)!==null},majorVersion:function(){return detect.parse(navigator.userAgent).browser.major},isChrome:function(){var ua=detect.parse(navigator.userAgent);return/chrom(e|ium)/.test(ua.browser.family.toLowerCase())},isFirefox:function(){var ua=detect.parse(navigator.userAgent);return/firefox/.test(ua.browser.family.toLowerCase())},rebindListeners:function(type,elements,listener){for(var i=0;i<elements.length;i++){this.rebindListener(type,elements[i],listener)}},rebindListener:function(type,element,listener){element.off(type);element.on(type,listener)},colorNameToHex:function(color){if(!color){return false}var colors={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"transparent"};if(typeof colors[color.toLowerCase()]!=="undefined"){return colors[color.toLowerCase()]}return this.isHexColor(color)?color.indexOf("#")!==-1?color:"#"+color:false},isHexColor:function(color){return/(^#?[0-9A-F]{6}$)|(^#?[0-9A-F]{3}$)/i.test(color)},parseDTMFTones:function(destination){if(!destination){return null}var dtmfMatch=destination.match(/,[0-9A-D#*,]+/,"");return dtmfMatch?dtmfMatch[0]:null}};module.exports=Utils},{}],68:[function(require,module,exports){module.exports=Video;var events=require("./EventBus");var debug=require("debug")("video");function Video(element,sipStack,options){this.ui=element;this.local=this.ui.find(".localVideo video");this.localHolder=this.ui.find(".localVideo");this.remote=this.ui.find(".remoteVideo");this.options=options||{};this.sipStack=sipStack;this.registerListeners()}Video.prototype={registerListeners:function(){var self=this;this.local.bind("playing",function(){self.options.onPlaying()});events.on("userMediaUpdated",function(e){self.updateStreams([e&&e.localStream],[])})},updateSessionStreams:function(){this.updateStreams(this.sipStack.getLocalStreams(),this.sipStack.getRemoteStreams())},updateStreams:function(localStreams,remoteStreams){debug("updating video streams");this.setVideoStream(this.local[0],localStreams);this.setVideoStream(this.remote[0],remoteStreams)},localWidth:function(){return this.local[0].videoWidth},localHeight:function(){return this.local[0].videoHeight},setVideoStream:function(video,streams){var hasStream=streams&&streams.length>0&&typeof streams[0]!=="undefined"&&!streams[0].ended;if(video&&video.mozSrcObject!==undefined){if(hasStream){video.mozSrcObject=streams[0];video.play()}else{video.mozSrcObject=null}}else if(video){if(hasStream){video.src=window.URL&&window.URL.createObjectURL(streams[0])||streams[0]}else{video.src=""}}}}},{"./EventBus":55,debug:10}],69:[function(require,module,exports){var Client=require("./Client");var Utils=require("./Utils");var ClientConfig=require("../js/client-config.js.default");var WebRTC={Client:Client,Utils:Utils,Sound:require("./Sound")};module.exports=WebRTC;Object.defineProperties(WebRTC,{version:{get:function(){return"<%= pkg.version %>"}},name:{get:function(){return"<%= pkg.title %>"}}});jQuery.fn.putCursorAtEnd=function(){return this.each(function(){$(this).focus();if(this.setSelectionRange){var len=$(this).val().length*2;this.setSelectionRange(len,len)}else{$(this).val($(this).val())}this.scrollTop=999999})};$.cssHooks.backgroundColor={get:function(elem){var bg=null;if(elem.currentStyle){bg=elem.currentStyle.backgroundColor}else if(window.getComputedStyle){bg=document.defaultView.getComputedStyle(elem,null).getPropertyValue("background-color")}if(bg.search("rgb")===-1||bg==="transparent"){return bg}else{bg=bg.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+).*\)$/);var hex=function(x){return("0"+parseInt(x,10).toString(16)).slice(-2)};return"#"+hex(bg[1])+hex(bg[2])+hex(bg[3])}}};$(document).ready(function(){var nodes=$("script[src*='webrtc-bundle']");if(nodes.length===0){console.error("no <script> with webrtc-bundle.js found");return}window.BroadSoftWebRTC=window.BroadSoftWebRTC||{};window.BroadSoftWebRTC.clients=[];$.each(nodes,function(i,node){node=$(node);if(!node.text()){return}var configData=JSON.parse(node.text());console.log("script config : ",configData);var clientConfig=Utils.clone(ClientConfig);var config=$.extend({},clientConfig,configData);console.log("merged config : ",config);var client=new Client(config,node.parent());var styleData=node.data();if(styleData){client.updateCss(styleData)}client.src=node[0].src;node.remove();window.BroadSoftWebRTC.clients.push(client)})});(function($){$.isBlank=function(obj){return!obj||$.trim(obj)===""}})(jQuery);if(typeof String.prototype.endsWith!=="function"){String.prototype.endsWith=function(suffix){return this.indexOf(suffix,this.length-suffix.length)!==-1}}},{"../js/client-config.js.default":1,"./Client":51,"./Sound":63,"./Utils":67}],70:[function(require,module,exports){module.exports=Whiteboard;var events=require("./EventBus");function Whiteboard(client,element,sipStack){this.whiteboard=element;this.canvas=this.whiteboard.find(".simple_sketch");if(this.canvas[0]&&this.canvas[0].getContext){this.context=this.canvas[0].getContext("2d")}this.toggled=false;this.client=client;this.sipStack=sipStack;this.color="#000";this.size=5;this.tool="marker";this.action=[];this.initCanvas();this.registerListeners();this.updateToolsSelection()}Whiteboard.prototype={registerListeners:function(){var self=this;events.on("dataReceived",function(e){var data=e.data;
var regex=/^whiteboard:/;if(data.match(regex)){data=data.replace(regex,"");var img=new Image;img.onload=function(){self.clear();self.context.drawImage(img,0,0)};img.src=data}})},initCanvas:function(){var self=this;$.each(["#f00","#ff0","#0f0","#0ff","#00f","#f0f","#000","#fff"],function(){self.whiteboard.find(".tools").append("<a href='.simple_sketch' onclick='javascript:;' data-color='"+this+"' style='width: 10px; background: "+this+";'></a> ")});$.each([3,5,10,15],function(){self.whiteboard.find(".tools").append("<a href='.simple_sketch' onclick='javascript:;' data-size='"+this+"' style='background: #ccc'>"+this+"</a> ")});this.canvas.bind("click mousedown mouseup mousemove mouseleave mouseout touchstart touchmove touchend touchcancel",jQuery.proxy(this,"onEvent"));$("body").delegate('a[href=".'+this.canvas.attr("class")+'"]',"click",function(){var $canvas,$this,key,sketch,_i,_len,_ref;$this=$(this);$canvas=$($this.attr("href"));sketch=$canvas.data("sketch");_ref=["color","size","tool"];for(_i=0,_len=_ref.length;_i<_len;_i++){key=_ref[_i];var value=$this.attr("data-"+key);if(value){if(key==="size"){value=+value}self[key]=value}}self.updateToolsSelection();return false})},updateToolsSelection:function(){var self=this;$.each(this.whiteboard.find(".tools a"),function(){var selected=$(this).data("color")===self.color||$(this).data("tool")===self.tool||+$(this).data("size")===self.size;if(selected){$(this).attr("class","selected")}else{$(this).attr("class","")}})},sendData:function(){var data=this.canvas[0].toDataURL();this.sipStack.sendData("whiteboard:"+data)},clear:function(){this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.canvas[0].width,this.canvas[0].height);this.context.restore()},onEvent:function(e){if(e.originalEvent&&e.originalEvent.targetTouches){e.pageX=e.originalEvent.targetTouches[0].pageX;e.pageY=e.originalEvent.targetTouches[0].pageY}switch(e.type){case"mousedown":case"touchstart":this.painting=true;this.action={tool:this.tool,color:this.color,size:parseFloat(this.size),events:[]};break}if(this.painting){this.action.events.push({x:e.pageX-this.canvas.offset().left,y:e.pageY-this.canvas.offset().top,event:e.type});if(this.tool==="marker"){this.draw(this.action)}else if(this.tool==="eraser"){this.erase(this.action)}}switch(e.type){case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":this.painting=false;this.action=null;this.sendData()}e.preventDefault();return false},erase:function(action){var oldcomposite;oldcomposite=this.context.globalCompositeOperation;this.context.globalCompositeOperation="copy";action.color="rgba(0,0,0,0)";this.draw(action);this.context.globalCompositeOperation=oldcomposite;return this.context.globalCompositeOperation},draw:function(action){var event,previous,_i,_len,_ref;this.context.lineJoin="round";this.context.lineCap="round";this.context.beginPath();this.context.moveTo(action.events[0].x,action.events[0].y);_ref=action.events;for(_i=0,_len=_ref.length;_i<_len;_i++){event=_ref[_i];this.context.lineTo(event.x,event.y);previous=event}this.context.strokeStyle=action.color;this.context.lineWidth=action.size;return this.context.stroke()},toggle:function(){if(this.toggled){this.whiteboard.fadeOut(100)}else{this.whiteboard.fadeIn(100)}this.toggled=!this.toggled}}},{"./EventBus":55}],71:[function(require,module,exports){module.exports=XMPP;var events=require("./EventBus");var debug=require("debug")("xmpp");var debugerror=require("debug")("xmpp:ERROR");debugerror.log=console.warn.bind(console);function XMPP(client){this.client=client;this.init()}XMPP.prototype={init:function(){if(ClientConfig.enableXMPP){try{converse.initialize({auto_list_rooms:false,auto_subscribe:false,bosh_service_url:"https://bind.opkode.im",hide_muc_server:false,i18n:locales.en,prebind:false,show_controlbox_by_default:true,xhr_user_search:false});this.registerListeners()}catch(e){debugerror("Could not init XMPP chat : "+e)}}},registerListeners:function(){var self=this;events.on("started",function(){self.statusBeforeCall=converse.getStatus();debug("status before call : "+self.statusBeforeCall);converse.setStatus("dnd")});events.on("ended",function(){debug("reset status to : "+self.statusBeforeCall);converse.setStatus(self.statusBeforeCall)})}}},{"./EventBus":55,debug:10}]},{},[69]);