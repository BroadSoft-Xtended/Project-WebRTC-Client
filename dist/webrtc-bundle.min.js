(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){ClientConfig={enableHD:false,enableCallControl:true,enableCallTimer:true,enableCallHistory:true,enableFullScreen:true,enableSelfView:true,enableCallStats:true,enableDialpad:true,enableMute:true,enableMessages:true,enableRegistrationIcon:true,enableConnectionIcon:true,enableWindowDrag:true,enableAutoAcceptReInvite:true,enableConnectLocalMedia:true,enableIms:false,enableSettings:false,enableAutoAnswer:false,enableTransfer:true,enableHold:true,pAssertedIdentity:"<sip:webguest@broadsoftlabs.com>",allowOutside:true,disableICE:true,volumeClick:1,volumeDTMF:1,websocketsServers:[{ws_uri:"wss://webrtc-gw.broadsoftlabs.com:8443",weight:0}],stunServer:"64.212.220.81",stunPort:3478,domainFrom:"broadsoftlabs.com",domainTo:"broadsoftlabs.com",endCallURL:false,bandwidthLow:128,bandwidthMed:512,bandwidthHigh:2048,expires:365,debug:false,register:false,encodingResolution:"640x480",displayResolution:"640x480",view:"audioVideo",selfViewLocation:"bl",messageProgress:"Ringing",messageOutsideDomain:"Invalid Destination",messageStarted:"Call Started",messageHold:"Call placed on hold",messageResume:"Call removed from hold",messageEnded:"Call Ended",messageCall:"Performing NAT Tests",messageConnected:"Connected",messageConnectionFailed:"Connection failed",messageUnregistered:"Unregistered",messageRegistered:"Registration successful",messageRegistrationFailed:"Registration failed",messageEmptyDestination:"Invalid Destination",messageGetUserMedia:"Unable to Access Camera and/or Microphone"};module.exports=ClientConfig},{}],2:[function(require,module,exports){(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof exports==="object"){module.exports=factory()}else if(typeof root==="undefined"||root!==Object(root)){throw new Error("templatizer: window does not exist or is not an object")}else{root.templatizer=factory()}})(this,function(){var jade=function(){function e(e){return null!=e&&""!==e}function n(t){return(Array.isArray(t)?t.map(n):t&&"object"==typeof t?Object.keys(t).filter(function(e){return t[e]}):[t]).filter(e).join(" ")}var t={};return t.merge=function r(n,t){if(1===arguments.length){for(var a=n[0],i=1;i<n.length;i++)a=r(a,n[i]);return a}var o=n["class"],s=t["class"];(o||s)&&(o=o||[],s=s||[],Array.isArray(o)||(o=[o]),Array.isArray(s)||(s=[s]),n["class"]=o.concat(s).filter(e));for(var l in t)"class"!=l&&(n[l]=t[l]);return n},t.joinClasses=n,t.cls=function(e,r){for(var a=[],i=0;i<e.length;i++)a.push(r&&r[i]?t.escape(n([e[i]])):n(e[i]));var o=n(a);return o.length?' class="'+o+'"':""},t.style=function(e){return e&&"object"==typeof e?Object.keys(e).map(function(n){return n+":"+e[n]}).join(";"):e},t.attr=function(e,n,r,a){return"style"===e&&(n=t.style(n)),"boolean"==typeof n||null==n?n?" "+(a?e:e+'="'+e+'"'):"":0==e.indexOf("data")&&"string"!=typeof n?(-1!==JSON.stringify(n).indexOf("&")&&console.warn("Since Jade 2.0.0, ampersands (`&`) in data attributes will be escaped to `&amp;`"),n&&"function"==typeof n.toISOString&&console.warn("Jade will eliminate the double quotes around dates in ISO form after 2.0.0")," "+e+"='"+JSON.stringify(n).replace(/'/g,"&apos;")+"'"):r?(n&&"function"==typeof n.toISOString&&console.warn("Jade will stringify dates in ISO form after 2.0.0")," "+e+'="'+t.escape(n)+'"'):(n&&"function"==typeof n.toISOString&&console.warn("Jade will stringify dates in ISO form after 2.0.0")," "+e+'="'+n+'"')},t.attrs=function(e,r){var a=[],i=Object.keys(e);if(i.length)for(var o=0;o<i.length;++o){var s=i[o],l=e[s];"class"==s?(l=n(l))&&a.push(" "+s+'="'+l+'"'):a.push(t.attr(s,l,!1,r))}return a.join("")},t.escape=function(e){var n=String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");return n===""+e?e:n},t.rethrow=function a(e,n,t,r){if(!(e instanceof Error))throw e;if(!("undefined"==typeof window&&n||r))throw e.message+=" on line "+t,e;try{r=r||require("fs").readFileSync(n,"utf8")}catch(i){a(e,null,t)}var o=3,s=r.split("\n"),l=Math.max(t-o,0),f=Math.min(s.length,t+o),o=s.slice(l,f).map(function(e,n){var r=n+l+1;return(r==t?"  > ":"    ")+r+"| "+e}).join("\n");throw e.path=n,e.message=(n||"Jade")+":"+t+"\n"+o+"\n\n"+e.message,e},t}();var templatizer={};templatizer["authentication"]=function tmpl_authentication(){return'<div class="authPopup fadeable popup"><span>User ID</span><br/><input type="text" value="" class="userid"/><br/><span>Auth User ID</span><br/><input type="text" value="" class="authUserid"/><br/><span>Password</span><br/><input type="password" value="" class="password"/><br/><br/><div class="alert"></div><button type="button" class="ok button">Sign in</button></div>'};templatizer["client"]=function tmpl_client(){return'<div class="wrapper"><div id="unsupported" class="unsupported"></div><div id="whiteboard_unsupported" class="unsupported"></div><div id="screen_sharing_unsupported" class="unsupported">Could not retrieve screen capture. Do you have it enabled?<br/>Open link to check : <span>chrome://flags/#enable-usermedia-screen-capture</span></div><noscript><div id="javascript_disabled" class="unsupported">JavaScript must be enabled to load the WebRTC client</div></noscript><div id="conversejs"></div><div id="client" class="client"><div class="main"><div class="errorPopup"></div></div></div></div>'};templatizer["connectionstatus"]=function tmpl_connectionstatus(){return'<div class="connection-status connectedIcon"><span title="Websockets Status" class="icon-link"></span></div><div class="connection-status registeredIcon"><span title="Registered" class="icon-link"></span></div>'};templatizer["dialpad"]=function tmpl_dialpad(){return'<div class="dialpad fadeable popup"><div class="callControl destination-container"><input type="text" onclick="this.focus();this.select()" class="destination"/><button title="Call History" class="historyButton"><i class="icon-clock"></i></button><hr/></div><div class="button-row"><button class="keys">1</button><button class="keys">2</button><button class="keys">3</button></div><div class="button-row"><button class="keys">4</button><button class="keys">5</button><button class="keys">6</button></div><div class="button-row"><button class="keys">7</button><button class="keys">8</button><button class="keys">9</button></div><div class="button-row"><button class="keys btn-star">*</button><button class="keys">0</button><button class="keys">#</button></div><div class="dialpad-control-bar"><div class="call main-button"><a href="">Call</a></div></div></div>'};templatizer["fileshare"]=function tmpl_fileshare(){return'<div class="fileshare-container table"><div class="cell"><div class="file_share fadeable"><span>Share File:</span><br/><input type="file" class="file"/><div class="status"></div></div></div></div>'};templatizer["history"]=function tmpl_history(){return'<div class="callHistory"><div class="content"></div><div class="classHistoryActions"><!--<span class="historyBack">\n<a href="" title="Previous" class="icon-arrow-up-thick"></a>\n</span>--><span class="historyClear"><a href="" title="Clear History">Clear</a></span><span class="historyClose"><a href="" title="Close History">Close</a></span><!--<span class="historyForward">\n<a href="" title="Next" class="icon-arrow-down-thick"></a>\n</span>--></div><div class="callHistoryDetails popup"><div id="history-dt-close-container"><span class="historyDetailsClose cell"><a href="" title="Close" class="icon-cancel3"></a></span></div><div class="table"><div class="row"><div class="cell">Resolution In : </div><div class="resolutionIn cell default-color"></div></div><div class="row"><div class="cell">Resolution Out : </div><div class="resolutionOut cell default-color"></div></div><div class="row"><div class="cell">Bitrate In : </div><div class="bitrateIn cell default-color"></div></div><div class="row"><div class="cell">Bitrate Out : </div><div class="bitrateOut cell default-color"></div></div><div class="row"><div class="cell">Frame Rate In : </div><div class="frameRateIn cell default-color"></div></div><div class="row"><div class="cell">Frame Rate Out : </div><div class="frameRateOut cell default-color"></div></div><div class="row"><div class="cell">Audio Lost : </div><div class="audioLostPer cell default-color">%</div></div><div class="row"><div class="cell">Video Out : </div><div class="videoLostPer cell default-color">%</div></div><div class="row"><div class="cell">Jitter : </div><div class="jitter cell default-color"></div></div></div><div class="actions table"><a href="" title="Call" class="callLink cell"></a></div></div><div class="historyRowSample"><div class="row"><a href="" title="Number" class="hist-destination"></a><span class="hist-direction"></span><span class="hist-date"></span><span class="hist-length"></span><span class="hist-details-arrow icon-angle-right"></span></div></div></div>'};templatizer["incomingcall"]=function tmpl_incomingcall(){return'<div class="callPopup fadeable popup"><span class="incomingCallTitle">Incoming Call</span><span class="incomingCallName"></span><span class="incomingCallUser"></span><div class="table"><div class="cell"><button type="button" class="acceptIncomingCall button">Accept</button><button type="button" class="holdAndAnswerButton button">Hold And Answer</button><button type="button" class="dropAndAnswerButton button">Drop And Answer</button></div><div id="rejectIncomingCallContainer" class="cell"><button type="button" class="rejectIncomingCall button">Reject</button></div></div></div>'};templatizer["messages"]=function tmpl_messages(){return'<div class="messages"><div class="alert"></div><div class="success"></div><div class="warning"></div><div class="normal"></div></div>'};templatizer["quality"]=function tmpl_quality(){return'<div class="quality quality1"><span title="Call Quality" class="icon-quality icon-quality1"></span></div><div class="quality quality2"><span title="Call Quality" class="icon-quality icon-quality2"></span></div><div class="quality quality3"><span title="Call Quality" class="icon-quality icon-quality3"></span></div><div class="quality quality4"><span title="Call Quality" class="icon-quality icon-quality4"></span></div>'};templatizer["reinvite"]=function tmpl_reinvite(){return'<div class="reInvitePopup fadeable popup"><span class="title">ReInvite</span><br/><br/><span class="incomingCallName"></span><br/><span class="incomingCallUser"></span><br/><br/><button type="button" class="acceptReInviteCall button">Accept</button><button type="button" class="rejectReInviteCall button">Reject</button></div>'};templatizer["settings"]=function tmpl_settings(){return'<div class="settingsPopup table collapse fixed fadeable popup"><div class="row"><ul class="tabs"><li><a href="#tab1" class="configure"><span class="icon-cog"></span>Configure</a></li><li><a href="#tab2" class="layout"><span class="icon-th"></span>Layout</a></li></ul><div id="tab1"><div class="displayNameRow row"><span class="cell">Display Name</span><input type="text" value="" class="displayName cell"/></div><div class="authenticationUseridRow row"><span class="cell">Auth User ID</span><input type="text" value="" class="authenticationUserid cell"/></div><div class="useridRow row"><span class="cell">User ID</span><input type="text" value="" class="userid cell"/></div><div class="passwordRow row"><span class="cell">Password</span><input type="password" value="" class="password cell"/></div><div class="hdRow row"><span class="cell">Start in HD</span><input type="checkbox" class="hd cell"/><br/></div><div class="autoAnswerRow row"><span class="cell">Auto Answer</span><input type="checkbox" class="autoAnswer cell"/></div><div class="bandwidthRow row"><span class="cell">Bandwidth</span><span class="cell"><input type="text" maxlength="4" value="" placeholder="low" class="bandwidthLow short"/><input type="text" maxlength="4" value="" placeholder="medium" class="bandwidthMed short"/><input type="text" maxlength="4" value="" placeholder="high" class="bandwidthHigh short"/></span></div><div class="row"><span class="cell"><a href="" title="Sign In" class="btn signIn">Sign In</a><a href="" title="Sign Out" class="btn signOut">Sign Out</a></span></div></div><div id="tab2"><div class="selfViewDisableRow row"><span class="cell">Disable Self View</span><input type="checkbox" class="selfViewDisable cell"/></div><div class="resolutionRow"><div class="row"><span class="resolutionTypeRow cell">Mode</span><select class="resolutionType cell"></select></div><div class="row"><span class="resolutionDisplayRow cell">Resolution</span><span class="cell"><select class="resolutionDisplayStandard resolutionSubType"></select><select class="resolutionDisplayWidescreen resolutionSubType"></select></span></div><div class="row"><span class="resolutionEncodingRow cell">Encoding</span><span class="cell"><select class="resolutionEncodingStandard resolutionSubType"></select><select class="resolutionEncodingWidescreen resolutionSubType"></select></span></div></div><div class="row"><span class="cell"><a href="" title="Save Settings" class="btn save">Save Settings</a><a href="" title="Reset Settings" class="clear">Reset Settings</a></span></div></div></div></div>'};templatizer["sms"]=function tmpl_sms(){return'<div class="sms"><div class="view"><div class="table fixed loginForm"><div class="row"><label class="cell">Name:</label><input type="text" name="name" placeholder="Email or TN" class="cell name"/></div><div class="row"><label class="cell">Password:</label><input type="password" name="password" class="cell password"/></div><div class="row"><div class="cell"></div><input type="button" value="Log In" class="cell login"/></div></div><div class="inbox"><fieldset><legend>Inbox</legend><div class="inner"><div class="table fixed"><div class="row"><div class="cell title status">Status</div><div class="cell title time">Received</div><div class="cell title from">From</div><div class="cell title body">Message</div><div class="cell title actions"></div></div><div class="inboxContent"></div></div></div></fieldset></div><div class="sendForm"><div><div><span>To</span><input type="text" placeholder="US Phone Number" class="sendTo"/><span>Text</span><input type="text" placeholder="Message to Send" class="sendBody"/><input type="button" value="Send SMS" class="sendButton"/></div></div></div><div id="sample" class="inboxItem inboxItemSample row"><div class="status cell"></div><div class="time cell"></div><div class="from cell"></div><div class="body cell"><div class="image"><a href="" target="_blank"><span></span><img src=""/></a></div><div class="video"><video controls=""></video></div><div class="audio"><audio controls=""></audio></div><div class="text"></div></div><div class="actions cell"><a href="javascript:;" title="Delete SMS" class="icon-trash icon-highlightable"></a></div></div></div><div class="status"><span class="statusContent"></span></div></div>'};templatizer["stats"]=function tmpl_stats(){return'<div class="stats"><div class="statsContainer"></div><div class="table fixed collapse"><div class="heading"><div class="cell">Video Stats</div><div class="cell">Audio Stats</div></div><div class="row"><div class="cell">Bitrate out: <a href="javascript:;" data-type="video" data-var="kiloBitsSentPerSecond" class="statsVar"></a> kb/s</div><div class="cell">Bitrate out: <a href="javascript:;" data-type="audio" data-var="kiloBitsSentPerSecond" class="statsVar"></a> kb/s</div></div><div class="row"><div class="cell">Bitrate in: <a href="javascript:;" data-type="video" data-var="kiloBitsReceivedPerSecond" class="statsVar"></a> kb/s</div><div class="cell">Bitrate in: <a href="javascript:;" data-type="audio" data-var="kiloBitsReceivedPerSecond" class="statsVar"></a> kb/s</div></div><div class="row"><div class="cell">Lost: <a href="javascript:;" data-type="video" data-var="packetsLost" class="statsVar"></a> packets (<a href="javascript:;" data-type="video" data-var="packetsLostPer" class="statsVar"></a> %)</div><div class="cell">Lost: <a href="javascript:;" data-type="audio" data-var="packetsLost" class="statsVar"></a> packets (<a href="javascript:;" data-type="audio" data-var="packetsLostPer" class="statsVar"></a> %)</div></div><div class="row"><div class="cell">Frame rate out: <a href="javascript:;" data-type="video" data-var="googFrameRateSent" class="statsVar"></a> in: <a href="javascript:;" data-type="video" data-var="googFrameRateReceived" class="statsVar"></a></div><div class="cell">Audio Level out: <a href="javascript:;" data-type="audio" data-var="audioInputLevel" class="statsVar"></a> in: <a href="javascript:;" data-type="audio" data-var="audioOutputLevel" class="statsVar"></a></div></div><div class="row spacer"></div><div class="heading"><div class="cell">Resolution</div><div class="cell">Link</div></div><div class="row"><div class="cell">In: <span data-type="video" data-var="googFrameWidthReceived" class="statsVar"></span> x <span data-type="video" data-var="googFrameHeightReceived" class="statsVar"></span> Out: <span data-type="video" data-var="googFrameWidthSent" class="statsVar"></span> x <span data-type="video" data-var="googFrameHeightSent" class="statsVar"></span></div><div class="cell"><span class="statsDelay">Delay: <a href="javascript:;" data-type="audio" data-var="googRtt" class="statsVar"></a></span> Jitter: <a href="javascript:;" data-type="audio" data-var="googJitterReceived" class="statsVar"></a></div></div><div class="row spacer"></div></div></div>'};templatizer["timer"]=function tmpl_timer(){return'<div class="timer fadeable"></div>'};templatizer["transfer"]=function tmpl_transfer(){return'<div class="transferPopup fadeable popup"><div class="title">Transfer</div><div><input type="text" placeholder="To Target" class="target"/><input type="checkbox" class="typeAttended"/>Attended</div><div class="actions"><button type="button" class="accept button">Transfer</button><button type="button" class="reject button">Cancel</button></div></div>'};templatizer["video"]=function tmpl_video(){return'<div class="video"><span class="icon-facetime-video watermark-icon"></span><video autoplay="autoplay" class="remote"></video><div class="localVideo fadeable"><div class="inner"><video autoplay="autoplay" muted="true" class="local"></video></div></div></div>'};templatizer["videobar"]=function tmpl_videobar(){return'<div class="videoBar"><div class="table fixed collapse"><div class="cell leftSpacer"></div><div class="cell cell-selfView"><div class="selfViewDisable icon fadeable"><a href="" title="Disable Self View" class="icon-selfViewDisable"></a></div><div class="selfViewEnable icon fadeable"><a href="" title="Enable Self View" class="icon-selfViewEnable"></a></div></div><div class="cell cell-dialpad"><div class="dialpadIconShow icon fadeable"><a href="" title="Show Dialpad" class="icon-dialpadShow"></a></div><div class="dialpadIconHide icon fadeable"><a href="" title="Hide Dialpad" class="icon-dialpadHide"></a></div></div><div class="cell cell-muteAudio"><div class="icon fadeable muteAudioIcon"><a href="" title="Mute Audio" class="icon-muteAudio"></a></div><div class="icon fadeable unmuteAudioIcon"><a href="" title="Unmute Audio" class="icon-unmuteAudio"></a></div></div><div class="cell cell-hold"><div class="hold icon fadeable"><a href="" title="Hold Call" class="icon-hold"></a></div><div class="resume icon fadeable"><a href="" title="Resume Call" class="icon-resume"></a></div></div><div class="cell cell-hangup"><div class="hangup icon fadeable"><a href="" title="Hangup" class="icon-hangup"></a><div class="subtitle">End Conference</div></div></div><div class="cell cell-transfer"><div class="transfer icon fadeable"><a href="" title="Transfer" class="icon-transfer"></a></div></div><div class="cell cell-shareScreen"><div class="icon fadeable shareScreen"><a href="" title="Share Screen" class="icon-screen-sharing"></a></div><div class="icon fadeable stopShareScreen"><a href="" title="Stop Share Screen" class="icon-screen-sharing-off"></a></div></div><div class="cell cellTimer"></div><div class="cell cell-settings"><div class="settings icon fadeable"><a href="" title="Settings" class="icon-settings"></a></div></div><div class="cell cell-fullScreen"><div class="fullScreenExpand icon fadeable"><a href="" title="Expand Full Screen" class="icon-fullScreenExpand"></a></div><div class="fullScreenContract icon fadeable"><a href="" title="Contract Full Screen" class="icon-fullScreenContract"></a></div></div><div class="cell rightSpacer"></div></div></div>'};templatizer["whiteboard"]=function tmpl_whiteboard(){return'<div class="whiteboard"><div class="tools"><a href=".canvas" data-tool="marker" class="tooltype">Marker</a><a href=".canvas" data-tool="eraser" class="tooltype">Eraser</a></div><canvas width="600" height="400" class="canvas"></canvas></div>'};templatizer["xmpp"]=function tmpl_xmpp(){return'<div class="xmpp"><div class="table fixed loginForm"><div class="row"><label class="cell">Name:</label><input type="text" name="name" placeholder="Email" class="cell name"/></div><div class="row"><label class="cell">Password:</label><input type="password" name="password" class="cell password"/></div><div class="row"><div class="cell"></div><input type="button" value="Log In" class="cell login"/></div></div><div class="content"></div><div class="messages"></div></div>'};return templatizer})},{fs:3}],3:[function(require,module,exports){},{}],4:[function(require,module,exports){module.exports=require(3)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/lib/_empty.js":3}],5:[function(require,module,exports){var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("is-array");exports.Buffer=Buffer;exports.SlowBuffer=Buffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;var kMaxLength=1073741823;Buffer.TYPED_ARRAY_SUPPORT=function(){try{var buf=new ArrayBuffer(0);var arr=new Uint8Array(buf);arr.foo=function(){return 42};return 42===arr.foo()&&typeof arr.subarray==="function"&&new Uint8Array(1).subarray(1,1).byteLength===0}catch(e){return false}}();function Buffer(subject,encoding,noZero){if(!(this instanceof Buffer))return new Buffer(subject,encoding,noZero);var type=typeof subject;var length;if(type==="number")length=subject>0?subject>>>0:0;else if(type==="string"){if(encoding==="base64")subject=base64clean(subject);length=Buffer.byteLength(subject,encoding)}else if(type==="object"&&subject!==null){if(subject.type==="Buffer"&&isArray(subject.data))subject=subject.data;length=+subject.length>0?Math.floor(+subject.length):0}else throw new TypeError("must start with number, buffer, array or string");if(this.length>kMaxLength)throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength.toString(16)+" bytes");var buf;if(Buffer.TYPED_ARRAY_SUPPORT){buf=Buffer._augment(new Uint8Array(length))}else{buf=this;buf.length=length;buf._isBuffer=true}var i;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof subject.byteLength==="number"){buf._set(subject)}else if(isArrayish(subject)){if(Buffer.isBuffer(subject)){for(i=0;i<length;i++)buf[i]=subject.readUInt8(i)}else{for(i=0;i<length;i++)buf[i]=(subject[i]%256+256)%256}}else if(type==="string"){buf.write(subject,0,encoding)}else if(type==="number"&&!Buffer.TYPED_ARRAY_SUPPORT&&!noZero){for(i=0;i<length;i++){buf[i]=0}}return buf}Buffer.isBuffer=function(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len&&a[i]===b[i];i++){}if(i!==len){x=a[i];y=b[i]}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function(list,totalLength){if(!isArray(list))throw new TypeError("Usage: Buffer.concat(list[, length])");if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}var i;if(totalLength===undefined){totalLength=0;for(i=0;i<list.length;i++){totalLength+=list[i].length}}var buf=new Buffer(totalLength);var pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos);pos+=item.length}return buf};Buffer.byteLength=function(str,encoding){var ret;str=str+"";switch(encoding||"utf8"){case"ascii":case"binary":case"raw":ret=str.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=str.length*2;break;case"hex":ret=str.length>>>1;break;case"utf8":case"utf-8":ret=utf8ToBytes(str).length;break;case"base64":ret=base64ToBytes(str).length;break;default:ret=str.length}return ret};Buffer.prototype.length=undefined;Buffer.prototype.parent=undefined;Buffer.prototype.toString=function(encoding,start,end){var loweredCase=false;start=start>>>0;end=end===undefined||end===Infinity?this.length:end>>>0;if(!encoding)encoding="utf8";if(start<0)start=0;if(end>this.length)end=this.length;if(end<=start)return"";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}};Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return Buffer.compare(this,b)};Buffer.prototype.get=function(offset){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(offset)};Buffer.prototype.set=function(v,offset){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(v,offset)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);if(isNaN(byte))throw new Error("Invalid hex string");buf[offset+i]=byte}return i}function utf8Write(buf,string,offset,length){var charsWritten=blitBuffer(utf8ToBytes(string),buf,offset,length);return charsWritten}function asciiWrite(buf,string,offset,length){var charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length);return charsWritten}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){var charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length);return charsWritten}function utf16leWrite(buf,string,offset,length){var charsWritten=blitBuffer(utf16leToBytes(string),buf,offset,length,2);return charsWritten}Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=Number(offset)||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=hexWrite(this,string,offset,length);break;case"utf8":case"utf-8":ret=utf8Write(this,string,offset,length);break;case"ascii":ret=asciiWrite(this,string,offset,length);break;case"binary":ret=binaryWrite(this,string,offset,length);break;case"base64":ret=base64Write(this,string,offset,length);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=utf16leWrite(this,string,offset,length);break;default:throw new TypeError("Unknown encoding: "+encoding)}return ret};Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){var res="";var tmp="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){if(buf[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]);tmp=""}else{tmp+="%"+buf[i].toString(16)}}return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i])}return ret}function binarySlice(buf,start,end){return asciiSlice(buf,start,end)}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;if(Buffer.TYPED_ARRAY_SUPPORT){return Buffer._augment(this.subarray(start,end))}else{var sliceLen=end-start;var newBuf=new Buffer(sliceLen,undefined,true);for(var i=0;i<sliceLen;i++){newBuf[i]=this[i+start]}return newBuf}};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUInt8=function(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readInt8=function(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24
};Buffer.prototype.readInt32BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||value<min)throw new TypeError("value is out of bounds");if(offset+ext>buf.length)throw new TypeError("index out of range")}Buffer.prototype.writeUInt8=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;i++){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else objectWriteUInt16(this,value,offset,true);return offset+2};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else objectWriteUInt16(this,value,offset,false);return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;i++){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value}else objectWriteUInt32(this,value,offset,true);return offset+4};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else objectWriteUInt32(this,value,offset,false);return offset+4};Buffer.prototype.writeInt8=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value;return offset+1};Buffer.prototype.writeInt16LE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else objectWriteUInt16(this,value,offset,true);return offset+2};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else objectWriteUInt16(this,value,offset,false);return offset+2};Buffer.prototype.writeInt32LE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else objectWriteUInt32(this,value,offset,true);return offset+4};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else objectWriteUInt32(this,value,offset,false);return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||value<min)throw new TypeError("value is out of bounds");if(offset+ext>buf.length)throw new TypeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert)checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38);ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert)checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308);ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function(target,target_start,start,end){var source=this;if(!start)start=0;if(!end&&end!==0)end=this.length;if(!target_start)target_start=0;if(end===start)return;if(target.length===0||source.length===0)return;if(end<start)throw new TypeError("sourceEnd < sourceStart");if(target_start<0||target_start>=target.length)throw new TypeError("targetStart out of bounds");if(start<0||start>=source.length)throw new TypeError("sourceStart out of bounds");if(end<0||end>source.length)throw new TypeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-target_start<end-start)end=target.length-target_start+start;var len=end-start;if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<len;i++){target[i+target_start]=this[i+start]}}else{target._set(this.subarray(start,start+len),target_start)}};Buffer.prototype.fill=function(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;if(end<start)throw new TypeError("end < start");if(end===start)return;if(this.length===0)return;if(start<0||start>=this.length)throw new TypeError("start out of bounds");if(end<0||end>this.length)throw new TypeError("end out of bounds");var i;if(typeof value==="number"){for(i=start;i<end;i++){this[i]=value}}else{var bytes=utf8ToBytes(value.toString());var len=bytes.length;for(i=start;i<end;i++){this[i]=bytes[i%len]}}return this};Buffer.prototype.toArrayBuffer=function(){if(typeof Uint8Array!=="undefined"){if(Buffer.TYPED_ARRAY_SUPPORT){return new Buffer(this).buffer}else{var buf=new Uint8Array(this.length);for(var i=0,len=buf.length;i<len;i+=1){buf[i]=this[i]}return buf.buffer}}else{throw new TypeError("Buffer.toArrayBuffer not supported in this browser")}};var BP=Buffer.prototype;Buffer._augment=function(arr){arr.constructor=Buffer;arr._isBuffer=true;arr._get=arr.get;arr._set=arr.set;arr.get=BP.get;arr.set=BP.set;arr.write=BP.write;arr.toString=BP.toString;arr.toLocaleString=BP.toString;arr.toJSON=BP.toJSON;arr.equals=BP.equals;arr.compare=BP.compare;arr.copy=BP.copy;arr.slice=BP.slice;arr.readUInt8=BP.readUInt8;arr.readUInt16LE=BP.readUInt16LE;arr.readUInt16BE=BP.readUInt16BE;arr.readUInt32LE=BP.readUInt32LE;arr.readUInt32BE=BP.readUInt32BE;arr.readInt8=BP.readInt8;arr.readInt16LE=BP.readInt16LE;arr.readInt16BE=BP.readInt16BE;arr.readInt32LE=BP.readInt32LE;arr.readInt32BE=BP.readInt32BE;arr.readFloatLE=BP.readFloatLE;arr.readFloatBE=BP.readFloatBE;arr.readDoubleLE=BP.readDoubleLE;arr.readDoubleBE=BP.readDoubleBE;arr.writeUInt8=BP.writeUInt8;arr.writeUInt16LE=BP.writeUInt16LE;arr.writeUInt16BE=BP.writeUInt16BE;arr.writeUInt32LE=BP.writeUInt32LE;arr.writeUInt32BE=BP.writeUInt32BE;arr.writeInt8=BP.writeInt8;arr.writeInt16LE=BP.writeInt16LE;arr.writeInt16BE=BP.writeInt16BE;arr.writeInt32LE=BP.writeInt32LE;arr.writeInt32BE=BP.writeInt32BE;arr.writeFloatLE=BP.writeFloatLE;arr.writeFloatBE=BP.writeFloatBE;arr.writeDoubleLE=BP.writeDoubleLE;arr.writeDoubleBE=BP.writeDoubleBE;arr.fill=BP.fill;arr.inspect=BP.inspect;arr.toArrayBuffer=BP.toArrayBuffer;return arr};var INVALID_BASE64_RE=/[^+\/0-9A-z]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function isArrayish(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){var b=str.charCodeAt(i);if(b<=127){byteArray.push(b)}else{var start=i;if(b>=55296&&b<=57343)i++;var h=encodeURIComponent(str.slice(start,i+1)).substr(1).split("%");for(var j=0;j<h.length;j++){byteArray.push(parseInt(h[j],16))}}}return byteArray}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;i++){c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(str)}function blitBuffer(src,dst,offset,length,unitSize){if(unitSize)length-=length%unitSize;for(var i=0;i<length;i++){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}},{"base64-js":6,ieee754:7,"is-array":8}],6:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(exports){"use strict";var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var PLUS="+".charCodeAt(0);var SLASH="/".charCodeAt(0);var NUMBER="0".charCodeAt(0);var LOWER="a".charCodeAt(0);var UPPER="A".charCodeAt(0);function decode(elt){var code=elt.charCodeAt(0);if(code===PLUS)return 62;if(code===SLASH)return 63;if(code<NUMBER)return-1;if(code<NUMBER+10)return code-NUMBER+26+26;if(code<UPPER+26)return code-UPPER;if(code<LOWER+26)return code-LOWER+26}function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0;arr=new Arr(b64.length*3/4-placeHolders);l=placeHolders>0?b64.length-4:b64.length;var L=0;function push(v){arr[L++]=v}for(i=0,j=0;i<l;i+=4,j+=3){tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3));push((tmp&16711680)>>16);push((tmp&65280)>>8);push(tmp&255)}if(placeHolders===2){tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4;push(tmp&255)}else if(placeHolders===1){tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2;push(tmp>>8&255);push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(num&63)}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=encode(temp>>2);output+=encode(temp<<4&63);output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=encode(temp>>10);output+=encode(temp>>4&63);output+=encode(temp<<2&63);output+="=";break}return output}exports.toByteArray=b64ToByteArray;exports.fromByteArray=uint8ToBase64})(typeof exports==="undefined"?this.base64js={}:exports)},{}],7:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}},{}],8:[function(require,module,exports){var isArray=Array.isArray;var str=Object.prototype.toString;module.exports=isArray||function(val){return!!val&&"[object Array]"==str.call(val)}},{}],9:[function(require,module,exports){"use strict";exports.randomBytes=exports.rng=exports.pseudoRandomBytes=exports.prng=require("randombytes");exports.createHash=exports.Hash=require("create-hash");exports.createHmac=exports.Hmac=require("create-hmac");var hashes=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(Object.keys(require("browserify-sign/algos")));exports.getHashes=function(){return hashes};var p=require("pbkdf2-compat");exports.pbkdf2=p.pbkdf2;exports.pbkdf2Sync=p.pbkdf2Sync;var aes=require("browserify-aes");["Cipher","createCipher","Cipheriv","createCipheriv","Decipher","createDecipher","Decipheriv","createDecipheriv","getCiphers","listCiphers"].forEach(function(key){exports[key]=aes[key]});var dh=require("diffie-hellman");["DiffieHellmanGroup","createDiffieHellmanGroup","getDiffieHellman","createDiffieHellman","DiffieHellman"].forEach(function(key){exports[key]=dh[key]});require("browserify-sign/inject")(module.exports,exports);require("create-ecdh/inject")(module.exports,exports);require("public-encrypt/inject")(module.exports,exports);["createCredentials","privateEncrypt","publicDecrypt"].forEach(function(name){exports[name]=function(){throw new Error(["sorry, "+name+" is not implemented yet","we accept pull requests","https://github.com/crypto-browserify/crypto-browserify"].join("\n"))}})},{"browserify-aes":13,"browserify-sign/algos":28,"browserify-sign/inject":29,"create-ecdh/inject":75,"create-hash":97,"create-hmac":108,"diffie-hellman":109,"pbkdf2-compat":116,"public-encrypt/inject":117,randombytes:144}],10:[function(require,module,exports){(function(Buffer){var md5=require("create-hash/md5");module.exports=EVP_BytesToKey;function EVP_BytesToKey(password,keyLen,ivLen){if(!Buffer.isBuffer(password)){password=new Buffer(password,"binary")}keyLen=keyLen/8;ivLen=ivLen||0;var ki=0;var ii=0;var key=new Buffer(keyLen);var iv=new Buffer(ivLen);var addmd=0;var md_buf;var i;var bufs=[];while(true){if(addmd++>0){bufs.push(md_buf)}bufs.push(password);md_buf=md5(Buffer.concat(bufs));bufs=[];i=0;if(keyLen>0){while(true){if(keyLen===0){break}if(i===md_buf.length){break}key[ki++]=md_buf[i];keyLen--;i++}}if(ivLen>0&&i!==md_buf.length){while(true){if(ivLen===0){break}if(i===md_buf.length){break}iv[ii++]=md_buf[i];ivLen--;i++}}if(keyLen===0&&ivLen===0){break}}for(i=0;i<md_buf.length;i++){md_buf[i]=0}return{key:key,iv:iv}}}).call(this,require("buffer").Buffer)},{buffer:5,"create-hash/md5":99}],11:[function(require,module,exports){(function(Buffer){var uint_max=Math.pow(2,32);function fixup_uint32(x){var ret,x_pos;ret=x>uint_max||x<0?(x_pos=Math.abs(x)%uint_max,x<0?uint_max-x_pos:x_pos):x;return ret}function scrub_vec(v){var i,_i,_ref;for(i=_i=0,_ref=v.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){v[i]=0}return false}function Global(){var i;this.SBOX=[];this.INV_SBOX=[];this.SUB_MIX=function(){var _i,_results;_results=[];for(i=_i=0;_i<4;i=++_i){_results.push([])}return _results}();this.INV_SUB_MIX=function(){var _i,_results;_results=[];for(i=_i=0;_i<4;i=++_i){_results.push([])}return _results}();this.init();this.RCON=[0,1,2,4,8,16,32,64,128,27,54]}Global.prototype.init=function(){var d,i,sx,t,x,x2,x4,x8,xi,_i;d=function(){var _i,_results;_results=[];for(i=_i=0;_i<256;i=++_i){if(i<128){_results.push(i<<1)}else{_results.push(i<<1^283)}}return _results}();x=0;xi=0;for(i=_i=0;_i<256;i=++_i){sx=xi^xi<<1^xi<<2^xi<<3^xi<<4;sx=sx>>>8^sx&255^99;this.SBOX[x]=sx;this.INV_SBOX[sx]=x;x2=d[x];x4=d[x2];x8=d[x4];t=d[sx]*257^sx*16843008;this.SUB_MIX[0][x]=t<<24|t>>>8;this.SUB_MIX[1][x]=t<<16|t>>>16;this.SUB_MIX[2][x]=t<<8|t>>>24;this.SUB_MIX[3][x]=t;t=x8*16843009^x4*65537^x2*257^x*16843008;this.INV_SUB_MIX[0][sx]=t<<24|t>>>8;this.INV_SUB_MIX[1][sx]=t<<16|t>>>16;this.INV_SUB_MIX[2][sx]=t<<8|t>>>24;this.INV_SUB_MIX[3][sx]=t;if(x===0){x=xi=1}else{x=x2^d[d[d[x8^x2]]];xi^=d[d[xi]]}}return true};var G=new Global;AES.blockSize=4*4;AES.prototype.blockSize=AES.blockSize;AES.keySize=256/8;AES.prototype.keySize=AES.keySize;function bufferToArray(buf){var len=buf.length/4;var out=new Array(len);var i=-1;while(++i<len){out[i]=buf.readUInt32BE(i*4)}return out}function AES(key){this._key=bufferToArray(key);this._doReset()}AES.prototype._doReset=function(){var invKsRow,keySize,keyWords,ksRow,ksRows,t,_i,_j;keyWords=this._key;keySize=keyWords.length;this._nRounds=keySize+6;ksRows=(this._nRounds+1)*4;this._keySchedule=[];for(ksRow=_i=0;0<=ksRows?_i<ksRows:_i>ksRows;ksRow=0<=ksRows?++_i:--_i){this._keySchedule[ksRow]=ksRow<keySize?keyWords[ksRow]:(t=this._keySchedule[ksRow-1],ksRow%keySize===0?(t=t<<8|t>>>24,t=G.SBOX[t>>>24]<<24|G.SBOX[t>>>16&255]<<16|G.SBOX[t>>>8&255]<<8|G.SBOX[t&255],t^=G.RCON[ksRow/keySize|0]<<24):keySize>6&&ksRow%keySize===4?t=G.SBOX[t>>>24]<<24|G.SBOX[t>>>16&255]<<16|G.SBOX[t>>>8&255]<<8|G.SBOX[t&255]:void 0,this._keySchedule[ksRow-keySize]^t)}this._invKeySchedule=[];for(invKsRow=_j=0;0<=ksRows?_j<ksRows:_j>ksRows;invKsRow=0<=ksRows?++_j:--_j){ksRow=ksRows-invKsRow;t=this._keySchedule[ksRow-(invKsRow%4?0:4)];this._invKeySchedule[invKsRow]=invKsRow<4||ksRow<=4?t:G.INV_SUB_MIX[0][G.SBOX[t>>>24]]^G.INV_SUB_MIX[1][G.SBOX[t>>>16&255]]^G.INV_SUB_MIX[2][G.SBOX[t>>>8&255]]^G.INV_SUB_MIX[3][G.SBOX[t&255]]}return true};AES.prototype.encryptBlock=function(M){M=bufferToArray(new Buffer(M));var out=this._doCryptBlock(M,this._keySchedule,G.SUB_MIX,G.SBOX);var buf=new Buffer(16);buf.writeUInt32BE(out[0],0);buf.writeUInt32BE(out[1],4);buf.writeUInt32BE(out[2],8);buf.writeUInt32BE(out[3],12);return buf};AES.prototype.decryptBlock=function(M){M=bufferToArray(new Buffer(M));var temp=[M[3],M[1]];M[1]=temp[0];M[3]=temp[1];var out=this._doCryptBlock(M,this._invKeySchedule,G.INV_SUB_MIX,G.INV_SBOX);var buf=new Buffer(16);buf.writeUInt32BE(out[0],0);buf.writeUInt32BE(out[3],4);buf.writeUInt32BE(out[2],8);buf.writeUInt32BE(out[1],12);return buf};AES.prototype.scrub=function(){scrub_vec(this._keySchedule);scrub_vec(this._invKeySchedule);scrub_vec(this._key)};AES.prototype._doCryptBlock=function(M,keySchedule,SUB_MIX,SBOX){var ksRow,round,s0,s1,s2,s3,t0,t1,t2,t3,_i,_ref;s0=M[0]^keySchedule[0];s1=M[1]^keySchedule[1];s2=M[2]^keySchedule[2];s3=M[3]^keySchedule[3];ksRow=4;for(round=_i=1,_ref=this._nRounds;1<=_ref?_i<_ref:_i>_ref;round=1<=_ref?++_i:--_i){t0=SUB_MIX[0][s0>>>24]^SUB_MIX[1][s1>>>16&255]^SUB_MIX[2][s2>>>8&255]^SUB_MIX[3][s3&255]^keySchedule[ksRow++];t1=SUB_MIX[0][s1>>>24]^SUB_MIX[1][s2>>>16&255]^SUB_MIX[2][s3>>>8&255]^SUB_MIX[3][s0&255]^keySchedule[ksRow++];t2=SUB_MIX[0][s2>>>24]^SUB_MIX[1][s3>>>16&255]^SUB_MIX[2][s0>>>8&255]^SUB_MIX[3][s1&255]^keySchedule[ksRow++];t3=SUB_MIX[0][s3>>>24]^SUB_MIX[1][s0>>>16&255]^SUB_MIX[2][s1>>>8&255]^SUB_MIX[3][s2&255]^keySchedule[ksRow++];s0=t0;s1=t1;s2=t2;s3=t3}t0=(SBOX[s0>>>24]<<24|SBOX[s1>>>16&255]<<16|SBOX[s2>>>8&255]<<8|SBOX[s3&255])^keySchedule[ksRow++];t1=(SBOX[s1>>>24]<<24|SBOX[s2>>>16&255]<<16|SBOX[s3>>>8&255]<<8|SBOX[s0&255])^keySchedule[ksRow++];t2=(SBOX[s2>>>24]<<24|SBOX[s3>>>16&255]<<16|SBOX[s0>>>8&255]<<8|SBOX[s1&255])^keySchedule[ksRow++];t3=(SBOX[s3>>>24]<<24|SBOX[s0>>>16&255]<<16|SBOX[s1>>>8&255]<<8|SBOX[s2&255])^keySchedule[ksRow++];return[fixup_uint32(t0),fixup_uint32(t1),fixup_uint32(t2),fixup_uint32(t3)]};exports.AES=AES}).call(this,require("buffer").Buffer)},{buffer:5}],12:[function(require,module,exports){(function(Buffer){var aes=require("./aes");var Transform=require("./cipherBase");var inherits=require("inherits");var GHASH=require("./ghash");var xor=require("./xor");inherits(StreamCipher,Transform);module.exports=StreamCipher;function StreamCipher(mode,key,iv,decrypt){if(!(this instanceof StreamCipher)){return new StreamCipher(mode,key,iv)}Transform.call(this);this._finID=Buffer.concat([iv,new Buffer([0,0,0,1])]);iv=Buffer.concat([iv,new Buffer([0,0,0,2])]);this._cipher=new aes.AES(key);this._prev=new Buffer(iv.length);this._cache=new Buffer("");this._secCache=new Buffer("");this._decrypt=decrypt;this._alen=0;this._len=0;iv.copy(this._prev);this._mode=mode;var h=new Buffer(4);h.fill(0);this._ghash=new GHASH(this._cipher.encryptBlock(h));this._authTag=null;this._called=false}StreamCipher.prototype._update=function(chunk){if(!this._called&&this._alen){var rump=16-this._alen%16;if(rump<16){rump=new Buffer(rump);rump.fill(0);this._ghash.update(rump)}}this._called=true;var out=this._mode.encrypt(this,chunk);if(this._decrypt){this._ghash.update(chunk)}else{this._ghash.update(out)}this._len+=chunk.length;return out};StreamCipher.prototype._final=function(){if(this._decrypt&&!this._authTag){throw new Error("Unsupported state or unable to authenticate data")}var tag=xor(this._ghash.final(this._alen*8,this._len*8),this._cipher.encryptBlock(this._finID));if(this._decrypt){if(xorTest(tag,this._authTag)){throw new Error("Unsupported state or unable to authenticate data")}}else{this._authTag=tag}this._cipher.scrub()};StreamCipher.prototype.getAuthTag=function getAuthTag(){if(!this._decrypt&&Buffer.isBuffer(this._authTag)){return this._authTag}else{throw new Error("Attempting to get auth tag in unsupported state")}};StreamCipher.prototype.setAuthTag=function setAuthTag(tag){if(this._decrypt){this._authTag=tag}else{throw new Error("Attempting to set auth tag in unsupported state")}};StreamCipher.prototype.setAAD=function setAAD(buf){if(!this._called){this._ghash.update(buf);this._alen+=buf.length}else{throw new Error("Attempting to set AAD in unsupported state")}};function xorTest(a,b){var out=0;if(a.length!==b.length){out++}var len=Math.min(a.length,b.length);var i=-1;while(++i<len){out+=a[i]^b[i]}return out}}).call(this,require("buffer").Buffer)},{"./aes":11,"./cipherBase":14,"./ghash":17,"./xor":27,buffer:5,inherits:146}],13:[function(require,module,exports){var ciphers=require("./encrypter");exports.createCipher=exports.Cipher=ciphers.createCipher;exports.createCipheriv=exports.Cipheriv=ciphers.createCipheriv;var deciphers=require("./decrypter");exports.createDecipher=exports.Decipher=deciphers.createDecipher;exports.createDecipheriv=exports.Decipheriv=deciphers.createDecipheriv;var modes=require("./modes");function getCiphers(){return Object.keys(modes)}exports.listCiphers=exports.getCiphers=getCiphers},{"./decrypter":15,"./encrypter":16,"./modes":18}],14:[function(require,module,exports){(function(Buffer){var Transform=require("stream").Transform;var inherits=require("inherits");module.exports=CipherBase;inherits(CipherBase,Transform);function CipherBase(){Transform.call(this)}CipherBase.prototype.update=function(data,inputEnc,outputEnc){if(typeof data==="string"){data=new Buffer(data,inputEnc)}var outData=this._update(data);if(outputEnc){outData=outData.toString(outputEnc)}return outData};CipherBase.prototype._transform=function(data,_,next){this.push(this._update(data));next()};CipherBase.prototype._flush=function(next){try{this.push(this._final())}catch(e){return next(e)}next()};CipherBase.prototype.final=function(outputEnc){var outData=this._final()||new Buffer("");if(outputEnc){outData=outData.toString(outputEnc)}return outData}}).call(this,require("buffer").Buffer)},{buffer:5,inherits:146,stream:163}],15:[function(require,module,exports){(function(Buffer){var aes=require("./aes");var Transform=require("./cipherBase");var inherits=require("inherits");var modes=require("./modes");var StreamCipher=require("./streamCipher");var AuthCipher=require("./authCipher");var ebtk=require("./EVP_BytesToKey");inherits(Decipher,Transform);function Decipher(mode,key,iv){if(!(this instanceof Decipher)){return new Decipher(mode,key,iv)}Transform.call(this);this._cache=new Splitter;this._last=void 0;this._cipher=new aes.AES(key);this._prev=new Buffer(iv.length);iv.copy(this._prev);this._mode=mode;this._autopadding=true}Decipher.prototype._update=function(data){this._cache.add(data);var chunk;var thing;var out=[];while(chunk=this._cache.get(this._autopadding)){thing=this._mode.decrypt(this,chunk);out.push(thing)}return Buffer.concat(out)};Decipher.prototype._final=function(){var chunk=this._cache.flush();if(this._autopadding){return unpad(this._mode.decrypt(this,chunk))}else if(chunk){throw new Error("data not multiple of block length")}};Decipher.prototype.setAutoPadding=function(setTo){this._autopadding=!!setTo};function Splitter(){if(!(this instanceof Splitter)){return new Splitter}this.cache=new Buffer("")}Splitter.prototype.add=function(data){this.cache=Buffer.concat([this.cache,data])};Splitter.prototype.get=function(autoPadding){var out;if(autoPadding){if(this.cache.length>16){out=this.cache.slice(0,16);this.cache=this.cache.slice(16);return out}}else{if(this.cache.length>=16){out=this.cache.slice(0,16);this.cache=this.cache.slice(16);return out}}return null};Splitter.prototype.flush=function(){if(this.cache.length){return this.cache}};function unpad(last){var padded=last[15];var i=-1;while(++i<padded){if(last[i+(16-padded)]!==padded){throw new Error("unable to decrypt data")}}if(padded===16){return}return last.slice(0,16-padded)}var modelist={ECB:require("./modes/ecb"),CBC:require("./modes/cbc"),CFB:require("./modes/cfb"),CFB8:require("./modes/cfb8"),CFB1:require("./modes/cfb1"),OFB:require("./modes/ofb"),CTR:require("./modes/ctr"),GCM:require("./modes/ctr")};function createDecipheriv(suite,password,iv){var config=modes[suite.toLowerCase()];if(!config){throw new TypeError("invalid suite type")}if(typeof iv==="string"){iv=new Buffer(iv)}if(typeof password==="string"){password=new Buffer(password)}if(password.length!==config.key/8){throw new TypeError("invalid key length "+password.length)}if(iv.length!==config.iv){throw new TypeError("invalid iv length "+iv.length)}if(config.type==="stream"){return new StreamCipher(modelist[config.mode],password,iv,true)}else if(config.type==="auth"){return new AuthCipher(modelist[config.mode],password,iv,true)}return new Decipher(modelist[config.mode],password,iv)}function createDecipher(suite,password){var config=modes[suite.toLowerCase()];if(!config){throw new TypeError("invalid suite type")}var keys=ebtk(password,config.key,config.iv);return createDecipheriv(suite,keys.key,keys.iv)}exports.createDecipher=createDecipher;exports.createDecipheriv=createDecipheriv}).call(this,require("buffer").Buffer)},{"./EVP_BytesToKey":10,"./aes":11,"./authCipher":12,"./cipherBase":14,"./modes":18,"./modes/cbc":19,"./modes/cfb":20,"./modes/cfb1":21,"./modes/cfb8":22,"./modes/ctr":23,"./modes/ecb":24,"./modes/ofb":25,"./streamCipher":26,buffer:5,inherits:146}],16:[function(require,module,exports){(function(Buffer){var aes=require("./aes");var Transform=require("./cipherBase");var inherits=require("inherits");var modes=require("./modes");var ebtk=require("./EVP_BytesToKey");var StreamCipher=require("./streamCipher");var AuthCipher=require("./authCipher");inherits(Cipher,Transform);function Cipher(mode,key,iv){if(!(this instanceof Cipher)){return new Cipher(mode,key,iv)}Transform.call(this);this._cache=new Splitter;this._cipher=new aes.AES(key);this._prev=new Buffer(iv.length);iv.copy(this._prev);this._mode=mode;this._autopadding=true}Cipher.prototype._update=function(data){this._cache.add(data);var chunk;var thing;var out=[];while(chunk=this._cache.get()){thing=this._mode.encrypt(this,chunk);out.push(thing)}return Buffer.concat(out)};Cipher.prototype._final=function(){var chunk=this._cache.flush();if(this._autopadding){chunk=this._mode.encrypt(this,chunk);this._cipher.scrub();return chunk}else if(chunk.toString("hex")!=="10101010101010101010101010101010"){this._cipher.scrub();throw new Error("data not multiple of block length")}};Cipher.prototype.setAutoPadding=function(setTo){this._autopadding=!!setTo};function Splitter(){if(!(this instanceof Splitter)){return new Splitter}this.cache=new Buffer("")}Splitter.prototype.add=function(data){this.cache=Buffer.concat([this.cache,data])};Splitter.prototype.get=function(){if(this.cache.length>15){var out=this.cache.slice(0,16);this.cache=this.cache.slice(16);return out}return null};Splitter.prototype.flush=function(){var len=16-this.cache.length;var padBuff=new Buffer(len);var i=-1;while(++i<len){padBuff.writeUInt8(len,i)}var out=Buffer.concat([this.cache,padBuff]);return out};var modelist={ECB:require("./modes/ecb"),CBC:require("./modes/cbc"),CFB:require("./modes/cfb"),CFB8:require("./modes/cfb8"),CFB1:require("./modes/cfb1"),OFB:require("./modes/ofb"),CTR:require("./modes/ctr"),GCM:require("./modes/ctr")};function createCipheriv(suite,password,iv){var config=modes[suite.toLowerCase()];if(!config){throw new TypeError("invalid suite type")}if(typeof iv==="string"){iv=new Buffer(iv)}if(typeof password==="string"){password=new Buffer(password)}if(password.length!==config.key/8){throw new TypeError("invalid key length "+password.length)}if(iv.length!==config.iv){throw new TypeError("invalid iv length "+iv.length)}if(config.type==="stream"){return new StreamCipher(modelist[config.mode],password,iv)}else if(config.type==="auth"){return new AuthCipher(modelist[config.mode],password,iv)}return new Cipher(modelist[config.mode],password,iv)}function createCipher(suite,password){var config=modes[suite.toLowerCase()];if(!config){throw new TypeError("invalid suite type")}var keys=ebtk(password,config.key,config.iv);return createCipheriv(suite,keys.key,keys.iv)}exports.createCipheriv=createCipheriv;exports.createCipher=createCipher}).call(this,require("buffer").Buffer)},{"./EVP_BytesToKey":10,"./aes":11,"./authCipher":12,"./cipherBase":14,"./modes":18,"./modes/cbc":19,"./modes/cfb":20,"./modes/cfb1":21,"./modes/cfb8":22,"./modes/ctr":23,"./modes/ecb":24,"./modes/ofb":25,"./streamCipher":26,buffer:5,inherits:146}],17:[function(require,module,exports){(function(Buffer){var zeros=new Buffer(16);zeros.fill(0);module.exports=GHASH;function GHASH(key){this.h=key;this.state=new Buffer(16);this.state.fill(0);this.cache=new Buffer("")}GHASH.prototype.ghash=function(block){var i=-1;while(++i<block.length){this.state[i]^=block[i]}this._multiply()};GHASH.prototype._multiply=function(){var Vi=toArray(this.h);var Zi=[0,0,0,0];var j,xi,lsb_Vi;var i=-1;while(++i<128){xi=(this.state[~~(i/8)]&1<<7-i%8)!==0;if(xi){Zi=xor(Zi,Vi)}lsb_Vi=(Vi[3]&1)!==0;for(j=3;j>0;j--){Vi[j]=Vi[j]>>>1|(Vi[j-1]&1)<<31}Vi[0]=Vi[0]>>>1;if(lsb_Vi){Vi[0]=Vi[0]^225<<24}}this.state=fromArray(Zi)
};GHASH.prototype.update=function(buf){this.cache=Buffer.concat([this.cache,buf]);var chunk;while(this.cache.length>=16){chunk=this.cache.slice(0,16);this.cache=this.cache.slice(16);this.ghash(chunk)}};GHASH.prototype.final=function(abl,bl){if(this.cache.length){this.ghash(Buffer.concat([this.cache,zeros],16))}this.ghash(fromArray([0,abl,0,bl]));return this.state};function toArray(buf){return[buf.readUInt32BE(0),buf.readUInt32BE(4),buf.readUInt32BE(8),buf.readUInt32BE(12)]}function fromArray(out){out=out.map(fixup_uint32);var buf=new Buffer(16);buf.writeUInt32BE(out[0],0);buf.writeUInt32BE(out[1],4);buf.writeUInt32BE(out[2],8);buf.writeUInt32BE(out[3],12);return buf}var uint_max=Math.pow(2,32);function fixup_uint32(x){var ret,x_pos;ret=x>uint_max||x<0?(x_pos=Math.abs(x)%uint_max,x<0?uint_max-x_pos:x_pos):x;return ret}function xor(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]}}).call(this,require("buffer").Buffer)},{buffer:5}],18:[function(require,module,exports){exports["aes-128-ecb"]={cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"};exports["aes-192-ecb"]={cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"};exports["aes-256-ecb"]={cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"};exports["aes-128-cbc"]={cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"};exports["aes-192-cbc"]={cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"};exports["aes-256-cbc"]={cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"};exports["aes128"]=exports["aes-128-cbc"];exports["aes192"]=exports["aes-192-cbc"];exports["aes256"]=exports["aes-256-cbc"];exports["aes-128-cfb"]={cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"};exports["aes-192-cfb"]={cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"};exports["aes-256-cfb"]={cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"};exports["aes-128-cfb8"]={cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"};exports["aes-192-cfb8"]={cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"};exports["aes-256-cfb8"]={cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"};exports["aes-128-cfb1"]={cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"};exports["aes-192-cfb1"]={cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"};exports["aes-256-cfb1"]={cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"};exports["aes-128-ofb"]={cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"};exports["aes-192-ofb"]={cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"};exports["aes-256-ofb"]={cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"};exports["aes-128-ctr"]={cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"};exports["aes-192-ctr"]={cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"};exports["aes-256-ctr"]={cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"};exports["aes-128-gcm"]={cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"};exports["aes-192-gcm"]={cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"};exports["aes-256-gcm"]={cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}},{}],19:[function(require,module,exports){var xor=require("../xor");exports.encrypt=function(self,block){var data=xor(block,self._prev);self._prev=self._cipher.encryptBlock(data);return self._prev};exports.decrypt=function(self,block){var pad=self._prev;self._prev=block;var out=self._cipher.decryptBlock(block);return xor(out,pad)}},{"../xor":27}],20:[function(require,module,exports){(function(Buffer){var xor=require("../xor");exports.encrypt=function(self,data,decrypt){var out=new Buffer("");var len;while(data.length){if(self._cache.length===0){self._cache=self._cipher.encryptBlock(self._prev);self._prev=new Buffer("")}if(self._cache.length<=data.length){len=self._cache.length;out=Buffer.concat([out,encryptStart(self,data.slice(0,len),decrypt)]);data=data.slice(len)}else{out=Buffer.concat([out,encryptStart(self,data,decrypt)]);break}}return out};function encryptStart(self,data,decrypt){var len=data.length;var out=xor(data,self._cache);self._cache=self._cache.slice(len);self._prev=Buffer.concat([self._prev,decrypt?data:out]);return out}}).call(this,require("buffer").Buffer)},{"../xor":27,buffer:5}],21:[function(require,module,exports){(function(Buffer){function encryptByte(self,byte,decrypt){var pad;var i=-1;var len=8;var out=0;var bit,value;while(++i<len){pad=self._cipher.encryptBlock(self._prev);bit=byte&1<<7-i?128:0;value=pad[0]^bit;out+=(value&128)>>i%8;self._prev=shiftIn(self._prev,decrypt?bit:value)}return out}exports.encrypt=function(self,chunk,decrypt){var len=chunk.length;var out=new Buffer(len);var i=-1;while(++i<len){out[i]=encryptByte(self,chunk[i],decrypt)}return out};function shiftIn(buffer,value){var len=buffer.length;var i=-1;var out=new Buffer(buffer.length);buffer=Buffer.concat([buffer,new Buffer([value])]);while(++i<len){out[i]=buffer[i]<<1|buffer[i+1]>>7}return out}}).call(this,require("buffer").Buffer)},{buffer:5}],22:[function(require,module,exports){(function(Buffer){function encryptByte(self,byte,decrypt){var pad=self._cipher.encryptBlock(self._prev);var out=pad[0]^byte;self._prev=Buffer.concat([self._prev.slice(1),new Buffer([decrypt?byte:out])]);return out}exports.encrypt=function(self,chunk,decrypt){var len=chunk.length;var out=new Buffer(len);var i=-1;while(++i<len){out[i]=encryptByte(self,chunk[i],decrypt)}return out}}).call(this,require("buffer").Buffer)},{buffer:5}],23:[function(require,module,exports){(function(Buffer){var xor=require("../xor");function getBlock(self){var out=self._cipher.encryptBlock(self._prev);incr32(self._prev);return out}exports.encrypt=function(self,chunk){while(self._cache.length<chunk.length){self._cache=Buffer.concat([self._cache,getBlock(self)])}var pad=self._cache.slice(0,chunk.length);self._cache=self._cache.slice(chunk.length);return xor(chunk,pad)};function incr32(iv){var len=iv.length;var item;while(len--){item=iv.readUInt8(len);if(item===255){iv.writeUInt8(0,len)}else{item++;iv.writeUInt8(item,len);break}}}}).call(this,require("buffer").Buffer)},{"../xor":27,buffer:5}],24:[function(require,module,exports){exports.encrypt=function(self,block){return self._cipher.encryptBlock(block)};exports.decrypt=function(self,block){return self._cipher.decryptBlock(block)}},{}],25:[function(require,module,exports){(function(Buffer){var xor=require("../xor");function getBlock(self){self._prev=self._cipher.encryptBlock(self._prev);return self._prev}exports.encrypt=function(self,chunk){while(self._cache.length<chunk.length){self._cache=Buffer.concat([self._cache,getBlock(self)])}var pad=self._cache.slice(0,chunk.length);self._cache=self._cache.slice(chunk.length);return xor(chunk,pad)}}).call(this,require("buffer").Buffer)},{"../xor":27,buffer:5}],26:[function(require,module,exports){(function(Buffer){var aes=require("./aes");var Transform=require("./cipherBase");var inherits=require("inherits");inherits(StreamCipher,Transform);module.exports=StreamCipher;function StreamCipher(mode,key,iv,decrypt){if(!(this instanceof StreamCipher)){return new StreamCipher(mode,key,iv)}Transform.call(this);this._cipher=new aes.AES(key);this._prev=new Buffer(iv.length);this._cache=new Buffer("");this._secCache=new Buffer("");this._decrypt=decrypt;iv.copy(this._prev);this._mode=mode}StreamCipher.prototype._update=function(chunk){return this._mode.encrypt(this,chunk,this._decrypt)};StreamCipher.prototype._final=function(){this._cipher.scrub()}}).call(this,require("buffer").Buffer)},{"./aes":11,"./cipherBase":14,buffer:5,inherits:146}],27:[function(require,module,exports){(function(Buffer){module.exports=xor;function xor(a,b){var len=Math.min(a.length,b.length);var out=new Buffer(len);var i=-1;while(++i<len){out.writeUInt8(a[i]^b[i],i)}return out}}).call(this,require("buffer").Buffer)},{buffer:5}],28:[function(require,module,exports){(function(Buffer){exports["RSA-SHA224"]=exports.sha224WithRSAEncryption={sign:"rsa",hash:"sha224",id:new Buffer("302d300d06096086480165030402040500041c","hex")};exports["RSA-SHA256"]=exports.sha256WithRSAEncryption={sign:"rsa",hash:"sha256",id:new Buffer("3031300d060960864801650304020105000420","hex")};exports["RSA-SHA384"]=exports.sha384WithRSAEncryption={sign:"rsa",hash:"sha384",id:new Buffer("3041300d060960864801650304020205000430","hex")};exports["RSA-SHA512"]=exports.sha512WithRSAEncryption={sign:"rsa",hash:"sha512",id:new Buffer("3051300d060960864801650304020305000440","hex")};exports["RSA-SHA1"]={sign:"rsa",hash:"sha1",id:new Buffer("3021300906052b0e03021a05000414","hex")};exports["ecdsa-with-SHA1"]={sign:"ecdsa",hash:"sha1",id:new Buffer("","hex")};exports.DSA=exports["DSA-SHA1"]=exports["DSA-SHA"]={sign:"dsa",hash:"sha1",id:new Buffer("","hex")};exports["DSA-SHA224"]=exports["DSA-WITH-SHA224"]={sign:"dsa",hash:"sha224",id:new Buffer("","hex")};exports["DSA-SHA256"]=exports["DSA-WITH-SHA256"]={sign:"dsa",hash:"sha256",id:new Buffer("","hex")};exports["DSA-SHA384"]=exports["DSA-WITH-SHA384"]={sign:"dsa",hash:"sha384",id:new Buffer("","hex")};exports["DSA-SHA512"]=exports["DSA-WITH-SHA512"]={sign:"dsa",hash:"sha512",id:new Buffer("","hex")};exports["DSA-RIPEMD160"]={sign:"dsa",hash:"rmd160",id:new Buffer("","hex")};exports["RSA-RIPEMD160"]=exports.ripemd160WithRSA={sign:"rsa",hash:"rmd160",id:new Buffer("3021300906052b2403020105000414","hex")};exports["RSA-MD5"]=exports.md5WithRSAEncryption={sign:"rsa",hash:"md5",id:new Buffer("3020300c06082a864886f70d020505000410","hex")}}).call(this,require("buffer").Buffer)},{buffer:5}],29:[function(require,module,exports){(function(Buffer){var sign=require("./sign");var verify=require("./verify");var stream=require("stream");var inherits=require("inherits");var _algos=require("./algos");var algos={};Object.keys(_algos).forEach(function(key){algos[key]=algos[key.toLowerCase()]=_algos[key]});"use strict";module.exports=function(exports,crypto){exports.createSign=exports.Sign=createSign;function createSign(algorithm){return new Sign(algorithm,crypto)}exports.createVerify=exports.Verify=createVerify;function createVerify(algorithm){return new Verify(algorithm,crypto)}};inherits(Sign,stream.Writable);function Sign(algorithm,crypto){stream.Writable.call(this);var data=algos[algorithm];if(!data){throw new Error("Unknown message digest")}this._hashType=data.hash;this._hash=crypto.createHash(data.hash);this._tag=data.id;this._crypto=crypto}Sign.prototype._write=function _write(data,_,done){this._hash.update(data);done()};Sign.prototype.update=function update(data){this.write(data);return this};Sign.prototype.sign=function signMethod(key,enc){this.end();var hash=this._hash.digest();var sig=sign(Buffer.concat([this._tag,hash]),key,this._hashType,this._crypto);if(enc){sig=sig.toString(enc)}return sig};inherits(Verify,stream.Writable);function Verify(algorithm,crypto){stream.Writable.call(this);var data=algos[algorithm];if(!data){throw new Error("Unknown message digest")}this._hash=crypto.createHash(data.hash);this._tag=data.id}Verify.prototype._write=function _write(data,_,done){this._hash.update(data);done()};Verify.prototype.update=function update(data){this.write(data);return this};Verify.prototype.verify=function verifyMethod(key,sig,enc){this.end();var hash=this._hash.digest();if(!Buffer.isBuffer(sig)){sig=new Buffer(sig,enc)}return verify(sig,Buffer.concat([this._tag,hash]),key)}}).call(this,require("buffer").Buffer)},{"./algos":28,"./sign":72,"./verify":73,buffer:5,inherits:146,stream:163}],30:[function(require,module,exports){function assert(val,msg){if(!val)throw new Error(msg||"Assertion failed")}function assertEqual(l,r,msg){if(l!=r)throw new Error(msg||"Assertion failed: "+l+" != "+r)}function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}function BN(number,base,endian){if(number!==null&&typeof number==="object"&&Array.isArray(number.words)){return number}this.sign=false;this.words=null;this.length=0;this.red=null;if(base==="le"||base==="be"){endian=base;base=10}if(number!==null)this._init(number||0,base||10,endian||"be")}if(typeof module==="object")module.exports=BN;BN.BN=BN;BN.wordSize=26;BN.prototype._init=function init(number,base,endian){if(typeof number==="number"){if(number<0){this.sign=true;number=-number}if(number<67108864){this.words=[number&67108863];this.length=1}else{this.words=[number&67108863,number/67108864&67108863];this.length=2}return}else if(typeof number==="object"){return this._initArray(number,base,endian)}if(base==="hex")base=16;assert(base===(base|0)&&base>=2&&base<=36);number=number.toString().replace(/\s+/g,"");var start=0;if(number[0]==="-")start++;if(base===16)this._parseHex(number,start);else this._parseBase(number,base,start);if(number[0]==="-")this.sign=true;this.strip()};BN.prototype._initArray=function _initArray(number,base,endian){assert(typeof number.length==="number");this.length=Math.ceil(number.length/3);this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var off=0;if(endian==="be"){for(var i=number.length-1,j=0;i>=0;i-=3){var w=number[i]|number[i-1]<<8|number[i-2]<<16;this.words[j]|=w<<off&67108863;this.words[j+1]=w>>>26-off&67108863;off+=24;if(off>=26){off-=26;j++}}}else if(endian==="le"){for(var i=0,j=0;i<number.length;i+=3){var w=number[i]|number[i+1]<<8|number[i+2]<<16;this.words[j]|=w<<off&67108863;this.words[j+1]=w>>>26-off&67108863;off+=24;if(off>=26){off-=26;j++}}}return this.strip()};function parseHex(str,start,end){var r=0;var len=Math.min(str.length,end);for(var i=start;i<len;i++){var c=str.charCodeAt(i)-48;r<<=4;if(c>=49&&c<=54)r|=c-49+10;else if(c>=17&&c<=22)r|=c-17+10;else r|=c&15}return r}BN.prototype._parseHex=function _parseHex(number,start){this.length=Math.ceil((number.length-start)/6);this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var off=0;for(var i=number.length-6,j=0;i>=start;i-=6){var w=parseHex(number,i,i+6);this.words[j]|=w<<off&67108863;this.words[j+1]|=w>>>26-off&4194303;off+=24;if(off>=26){off-=26;j++}}if(i+6!==start){var w=parseHex(number,start,i+6);this.words[j]|=w<<off&67108863;this.words[j+1]|=w>>>26-off&4194303}this.strip()};function parseBase(str,start,end,mul){var r=0;var len=Math.min(str.length,end);for(var i=start;i<len;i++){var c=str.charCodeAt(i)-48;r*=mul;if(c>=49)r+=c-49+10;else if(c>=17)r+=c-17+10;else r+=c}return r}BN.prototype._parseBase=function _parseBase(number,base,start){this.words=[0];this.length=1;for(var limbLen=0,limbPow=1;limbPow<=67108863;limbPow*=base)limbLen++;limbLen--;limbPow=limbPow/base|0;var total=number.length-start;var mod=total%limbLen;var end=Math.min(total,total-mod)+start;var word=0;for(var i=start;i<end;i+=limbLen){word=parseBase(number,i,i+limbLen,base);this.imuln(limbPow);this.words[0]+=word}if(mod!==0){var pow=1;var word=parseBase(number,i,number.length,base);for(var i=0;i<mod;i++)pow*=base;this.imuln(pow);this.words[0]+=word}};BN.prototype.copy=function copy(dest){dest.words=new Array(this.length);for(var i=0;i<this.length;i++)dest.words[i]=this.words[i];dest.length=this.length;dest.sign=this.sign;dest.red=this.red};BN.prototype.clone=function clone(){var r=new BN(null);this.copy(r);return r};BN.prototype.strip=function strip(){while(this.length>1&&this.words[this.length-1]===0)this.length--;return this._normSign()};BN.prototype._normSign=function _normSign(){if(this.length===1&&this.words[0]===0)this.sign=false;return this};BN.prototype.inspect=function inspect(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var zeros=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"];var groupSizes=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];var groupBases=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];BN.prototype.toString=function toString(base,padding){base=base||10;if(base===16||base==="hex"){var out="";var off=0;var padding=padding|0||1;var carry=0;for(var i=0;i<this.length;i++){var w=this.words[i];var word=((w<<off|carry)&16777215).toString(16);carry=w>>>24-off&16777215;if(carry!==0||i!==this.length-1)out=zeros[6-word.length]+word+out;else out=word+out;off+=2;if(off>=26){off-=26;i--}}if(carry!==0)out=carry.toString(16)+out;while(out.length%padding!==0)out="0"+out;if(this.sign)out="-"+out;return out}else if(base===(base|0)&&base>=2&&base<=36){var groupSize=groupSizes[base];var groupBase=groupBases[base];var out="";var c=this.clone();c.sign=false;while(c.cmpn(0)!==0){var r=c.modn(groupBase).toString(base);c=c.idivn(groupBase);if(c.cmpn(0)!==0)out=zeros[groupSize-r.length]+r+out;else out=r+out}if(this.cmpn(0)===0)out="0"+out;if(this.sign)out="-"+out;return out}else{assert(false,"Base should be between 2 and 36")}};BN.prototype.toJSON=function toJSON(){return this.toString(16)};BN.prototype.toArray=function toArray(){this.strip();var res=new Array(this.byteLength());res[0]=0;var q=this.clone();for(var i=0;q.cmpn(0)!==0;i++){var b=q.andln(255);q.ishrn(8);res[res.length-i-1]=b}return res};BN.prototype._countBits=function _countBits(w){return w>=33554432?26:w>=16777216?25:w>=8388608?24:w>=4194304?23:w>=2097152?22:w>=1048576?21:w>=524288?20:w>=262144?19:w>=131072?18:w>=65536?17:w>=32768?16:w>=16384?15:w>=8192?14:w>=4096?13:w>=2048?12:w>=1024?11:w>=512?10:w>=256?9:w>=128?8:w>=64?7:w>=32?6:w>=16?5:w>=8?4:w>=4?3:w>=2?2:w>=1?1:0};BN.prototype.bitLength=function bitLength(){var hi=0;var w=this.words[this.length-1];var hi=this._countBits(w);return(this.length-1)*26+hi};BN.prototype.byteLength=function byteLength(){var hi=0;var w=this.words[this.length-1];return Math.ceil(this.bitLength()/8)};BN.prototype.neg=function neg(){if(this.cmpn(0)===0)return this.clone();var r=this.clone();r.sign=!this.sign;return r};BN.prototype.iadd=function iadd(num){if(this.sign&&!num.sign){this.sign=false;var r=this.isub(num);this.sign=!this.sign;return this._normSign()}else if(!this.sign&&num.sign){num.sign=false;var r=this.isub(num);num.sign=true;return r._normSign()}var a;var b;if(this.length>num.length){a=this;b=num}else{a=num;b=this}var carry=0;for(var i=0;i<b.length;i++){var r=a.words[i]+b.words[i]+carry;this.words[i]=r&67108863;carry=r>>>26}for(;carry!==0&&i<a.length;i++){var r=a.words[i]+carry;this.words[i]=r&67108863;carry=r>>>26}this.length=a.length;if(carry!==0){this.words[this.length]=carry;this.length++}else if(a!==this){for(;i<a.length;i++)this.words[i]=a.words[i]}return this};BN.prototype.add=function add(num){if(num.sign&&!this.sign){num.sign=false;var res=this.sub(num);num.sign=true;return res}else if(!num.sign&&this.sign){this.sign=false;var res=num.sub(this);this.sign=true;return res}if(this.length>num.length)return this.clone().iadd(num);else return num.clone().iadd(this)};BN.prototype.isub=function isub(num){if(num.sign){num.sign=false;var r=this.iadd(num);num.sign=true;return r._normSign()}else if(this.sign){this.sign=false;this.iadd(num);this.sign=true;return this._normSign()}var cmp=this.cmp(num);if(cmp===0){this.sign=false;this.length=1;this.words[0]=0;return this}if(cmp>0){var a=this;var b=num}else{var a=num;var b=this}var carry=0;for(var i=0;i<b.length;i++){var r=a.words[i]-b.words[i]-carry;if(r<0){r+=67108864;carry=1}else{carry=0}this.words[i]=r}for(;carry!==0&&i<a.length;i++){var r=a.words[i]-carry;if(r<0){r+=67108864;carry=1}else{carry=0}this.words[i]=r}if(carry===0&&i<a.length&&a!==this)for(;i<a.length;i++)this.words[i]=a.words[i];this.length=Math.max(this.length,i);if(a!==this)this.sign=true;return this.strip()};BN.prototype.sub=function sub(num){return this.clone().isub(num)};BN.prototype._smallMulTo=function _smallMulTo(num,out){out.sign=num.sign!==this.sign;out.length=this.length+num.length;var carry=0;for(var k=0;k<out.length-1;k++){var ncarry=carry>>>26;var rword=carry&67108863;var maxJ=Math.min(k,num.length-1);for(var j=Math.max(0,k-this.length+1);j<=maxJ;j++){var i=k-j;var a=this.words[i]|0;var b=num.words[j]|0;var r=a*b;var lo=r&67108863;ncarry=ncarry+(r/67108864|0)|0;lo=lo+rword|0;rword=lo&67108863;ncarry=ncarry+(lo>>>26)|0}out.words[k]=rword;carry=ncarry}if(carry!==0){out.words[k]=carry}else{out.length--}return out.strip()};BN.prototype._bigMulTo=function _bigMulTo(num,out){out.sign=num.sign!==this.sign;out.length=this.length+num.length;var carry=0;var hncarry=0;for(var k=0;k<out.length-1;k++){var ncarry=hncarry;hncarry=0;var rword=carry&67108863;var maxJ=Math.min(k,num.length-1);for(var j=Math.max(0,k-this.length+1);j<=maxJ;j++){var i=k-j;var a=this.words[i]|0;var b=num.words[j]|0;var r=a*b;var lo=r&67108863;ncarry=ncarry+(r/67108864|0)|0;lo=lo+rword|0;rword=lo&67108863;ncarry=ncarry+(lo>>>26)|0;hncarry+=ncarry>>>26;ncarry&=67108863}out.words[k]=rword;carry=ncarry;ncarry=hncarry}if(carry!==0){out.words[k]=carry}else{out.length--}return out.strip()};BN.prototype.mulTo=function mulTo(num,out){var res;if(this.length+num.length<63)res=this._smallMulTo(num,out);else res=this._bigMulTo(num,out);return res};BN.prototype.mul=function mul(num){var out=new BN(null);out.words=new Array(this.length+num.length);return this.mulTo(num,out)};BN.prototype.imul=function imul(num){if(this.cmpn(0)===0||num.cmpn(0)===0){this.words[0]=0;this.length=1;return this}var tlen=this.length;var nlen=num.length;this.sign=num.sign!==this.sign;this.length=this.length+num.length;this.words[this.length-1]=0;var lastCarry=0;for(var k=this.length-2;k>=0;k--){var carry=0;var rword=0;var maxJ=Math.min(k,nlen-1);for(var j=Math.max(0,k-tlen+1);j<=maxJ;j++){var i=k-j;var a=this.words[i];var b=num.words[j];var r=a*b;var lo=r&67108863;carry+=r/67108864|0;lo+=rword;rword=lo&67108863;carry+=lo>>>26}this.words[k]=rword;this.words[k+1]+=carry;carry=0}var carry=0;for(var i=1;i<this.length;i++){var w=this.words[i]+carry;this.words[i]=w&67108863;carry=w>>>26}return this.strip()};BN.prototype.imuln=function imuln(num){assert(typeof num==="number");var carry=0;for(var i=0;i<this.length;i++){var w=this.words[i]*num;var lo=(w&67108863)+carry;carry=w/67108864|0;this.words[i]=lo}if(carry!==0){this.words[i]=carry;this.length++}return this};BN.prototype.sqr=function sqr(){return this.mul(this)};BN.prototype.isqr=function isqr(){return this.mul(this)};BN.prototype.ishln=function ishln(bits){assert(typeof bits==="number"&&bits>=0);var r=bits%26;var s=(bits-r)/26;var carryMask=67108863>>>26-r<<26-r;var o=this.clone();if(r!==0){var carry=0;for(var i=0;i<this.length;i++){var newCarry=this.words[i]&carryMask;var c=this.words[i]-newCarry<<r;this.words[i]=c|carry;carry=newCarry>>>26-r}if(carry){this.words[i]=carry;this.length++}}if(s!==0){for(var i=this.length-1;i>=0;i--)this.words[i+s]=this.words[i];for(var i=0;i<s;i++)this.words[i]=0;this.length+=s}return this.strip()};BN.prototype.ishrn=function ishrn(bits,hint,extended){assert(typeof bits==="number"&&bits>=0);if(hint)hint=(hint-hint%26)/26;else hint=0;var r=bits%26;var s=Math.min((bits-r)/26,this.length);var mask=67108863^67108863>>>r<<r;var maskedWords=extended;hint-=s;hint=Math.max(0,hint);if(maskedWords){for(var i=0;i<s;i++)maskedWords.words[i]=this.words[i];maskedWords.length=s}if(s===0){}else if(this.length>s){this.length-=s;for(var i=0;i<this.length;i++)this.words[i]=this.words[i+s]}else{this.words[0]=0;this.length=1}var carry=0;for(var i=this.length-1;i>=0&&(carry!==0||i>=hint);i--){var word=this.words[i];this.words[i]=carry<<26-r|word>>>r;carry=word&mask}if(maskedWords&&carry!==0)maskedWords.words[maskedWords.length++]=carry;if(this.length===0){this.words[0]=0;this.length=1}this.strip();if(extended)return{hi:this,lo:maskedWords};return this};BN.prototype.shln=function shln(bits){return this.clone().ishln(bits)};BN.prototype.shrn=function shrn(bits){return this.clone().ishrn(bits)};BN.prototype.testn=function testn(bit){assert(typeof bit==="number"&&bit>=0);var r=bit%26;var s=(bit-r)/26;var q=1<<r;if(this.length<=s){return false}var w=this.words[s];return!!(w&q)};BN.prototype.imaskn=function imaskn(bits){assert(typeof bits==="number"&&bits>=0);var r=bits%26;var s=(bits-r)/26;assert(!this.sign,"imaskn works only with positive numbers");if(r!==0)s++;this.length=Math.min(s,this.length);if(r!==0){var mask=67108863^67108863>>>r<<r;this.words[this.length-1]&=mask}return this.strip()};BN.prototype.maskn=function maskn(bits){return this.clone().imaskn(bits)};BN.prototype.iaddn=function iaddn(num){assert(typeof num==="number");if(num<0)return this.isubn(-num);if(this.sign){if(this.length===1&&this.words[0]<num){this.words[0]=num-this.words[0];this.sign=false;return this}this.sign=false;this.isubn(num);this.sign=true;return this}this.words[0]+=num;for(var i=0;i<this.length&&this.words[i]>=67108864;i++){this.words[i]-=67108864;if(i===this.length-1)this.words[i+1]=1;else this.words[i+1]++}this.length=Math.max(this.length,i+1);return this};BN.prototype.isubn=function isubn(num){assert(typeof num==="number");if(num<0)return this.iaddn(-num);if(this.sign){this.sign=false;this.iaddn(num);this.sign=true;return this}this.words[0]-=num;for(var i=0;i<this.length&&this.words[i]<0;i++){this.words[i]+=67108864;this.words[i+1]-=1}return this.strip()};BN.prototype.addn=function addn(num){return this.clone().iaddn(num)};BN.prototype.subn=function subn(num){return this.clone().isubn(num)};BN.prototype.iabs=function iabs(){this.sign=false;return this};BN.prototype.abs=function abs(){return this.clone().iabs()};BN.prototype._wordDiv=function _wordDiv(num,mode){var shift=this.length-num.length;var a=this.clone();var b=num;var q=mode!=="mod"&&new BN(0);var sign=false;while(a.length>b.length){var hi=a.words[a.length-1]*67108864+a.words[a.length-2];var sq=hi/b.words[b.length-1];var sqhi=sq/67108864|0;var sqlo=sq&67108863;sq=new BN(null);sq.words=[sqlo,sqhi];sq.length=2;var shift=(a.length-b.length-1)*26;if(q){var t=sq.shln(shift);if(a.sign)q.isub(t);else q.iadd(t)}sq=sq.mul(b).ishln(shift);if(a.sign)a.iadd(sq);else a.isub(sq)}while(a.ucmp(b)>=0){var hi=a.words[a.length-1];var sq=new BN(hi/b.words[b.length-1]|0);var shift=(a.length-b.length)*26;if(q){var t=sq.shln(shift);if(a.sign)q.isub(t);else q.iadd(t)}sq=sq.mul(b).ishln(shift);if(a.sign)a.iadd(sq);else a.isub(sq)}if(a.sign){if(q)q.isubn(1);a.iadd(b)}return{div:q?q:null,mod:a}};BN.prototype.divmod=function divmod(num,mode){assert(num.cmpn(0)!==0);if(this.sign&&!num.sign){var res=this.neg().divmod(num,mode);var div;var mod;if(mode!=="mod")div=res.div.neg();if(mode!=="div")mod=res.mod.cmpn(0)===0?res.mod:num.sub(res.mod);return{div:div,mod:mod}}else if(!this.sign&&num.sign){var res=this.divmod(num.neg(),mode);var div;if(mode!=="mod")div=res.div.neg();return{div:div,mod:res.mod}}else if(this.sign&&num.sign){return this.neg().divmod(num.neg(),mode)}if(num.length>this.length||this.cmp(num)<0)return{div:new BN(0),mod:this};if(num.length===1){if(mode==="div")return{div:this.divn(num.words[0]),mod:null};else if(mode==="mod")return{div:null,mod:new BN(this.modn(num.words[0]))};return{div:this.divn(num.words[0]),mod:new BN(this.modn(num.words[0]))}}return this._wordDiv(num,mode)};BN.prototype.div=function div(num){return this.divmod(num,"div").div};BN.prototype.mod=function mod(num){return this.divmod(num,"mod").mod};BN.prototype.divRound=function divRound(num){var dm=this.divmod(num);if(dm.mod.cmpn(0)===0)return dm.div;var mod=dm.div.sign?dm.mod.isub(num):dm.mod;var half=num.shrn(1);var r2=num.andln(1);var cmp=mod.cmp(half);if(cmp<0||r2===1&&cmp===0)return dm.div;return dm.div.sign?dm.div.isubn(1):dm.div.iaddn(1)};BN.prototype.modn=function modn(num){assert(num<=67108863);var p=(1<<26)%num;var acc=0;for(var i=this.length-1;i>=0;i--)acc=(p*acc+this.words[i])%num;return acc};BN.prototype.idivn=function idivn(num){assert(num<=67108863);var carry=0;for(var i=this.length-1;i>=0;i--){var w=this.words[i]+carry*67108864;this.words[i]=w/num|0;carry=w%num}return this.strip()};BN.prototype.divn=function divn(num){return this.clone().idivn(num)};BN.prototype._egcd=function _egcd(x1,p){assert(!p.sign);assert(p.cmpn(0)!==0);var a=this;var b=p.clone();if(a.sign)a=a.mod(p);else a=a.clone();var x2=new BN(0);while(b.isEven())b.ishrn(1);var delta=b.clone();while(a.cmpn(1)>0&&b.cmpn(1)>0){while(a.isEven()){a.ishrn(1);if(x1.isEven())x1.ishrn(1);else x1.iadd(delta).ishrn(1)}while(b.isEven()){b.ishrn(1);if(x2.isEven())x2.ishrn(1);else x2.iadd(delta).ishrn(1)}if(a.cmp(b)>=0){a.isub(b);x1.isub(x2)}else{b.isub(a);x2.isub(x1)}}if(a.cmpn(1)===0)return x1;else return x2};BN.prototype.gcd=function gcd(num){if(this.cmpn(0)===0)return num.clone();if(num.cmpn(0)===0)return this.clone();var a=this.clone();var b=num.clone();a.sign=false;b.sign=false;for(var shift=0;a.isEven()&&b.isEven();shift++){a.ishrn(1);b.ishrn(1)}while(a.isEven())a.ishrn(1);do{while(b.isEven())b.ishrn(1);if(a.cmp(b)<0){var t=a;a=b;b=t}a.isub(a.div(b).mul(b))}while(a.cmpn(0)!==0&&b.cmpn(0)!==0);if(a.cmpn(0)===0)return b.ishln(shift);else return a.ishln(shift)};BN.prototype.invm=function invm(num){return this._egcd(new BN(1),num).mod(num)};BN.prototype.isEven=function isEven(num){return(this.words[0]&1)===0};BN.prototype.isOdd=function isOdd(num){return(this.words[0]&1)===1};BN.prototype.andln=function andln(num){return this.words[0]&num};BN.prototype.bincn=function bincn(bit){assert(typeof bit==="number");var r=bit%26;var s=(bit-r)/26;var q=1<<r;if(this.length<=s){for(var i=this.length;i<s+1;i++)this.words[i]=0;this.words[s]|=q;this.length=s+1;return this}var carry=q;for(var i=s;carry!==0&&i<this.length;i++){var w=this.words[i];w+=carry;carry=w>>>26;w&=67108863;this.words[i]=w}if(carry!==0){this.words[i]=carry;this.length++}return this};BN.prototype.cmpn=function cmpn(num){var sign=num<0;if(sign)num=-num;if(this.sign&&!sign)return-1;else if(!this.sign&&sign)return 1;num&=67108863;this.strip();var res;if(this.length>1){res=1}else{var w=this.words[0];res=w===num?0:w<num?-1:1}if(this.sign)res=-res;return res};BN.prototype.cmp=function cmp(num){if(this.sign&&!num.sign)return-1;else if(!this.sign&&num.sign)return 1;var res=this.ucmp(num);if(this.sign)return-res;else return res};BN.prototype.ucmp=function ucmp(num){if(this.length>num.length)return 1;else if(this.length<num.length)return-1;var res=0;for(var i=this.length-1;i>=0;i--){var a=this.words[i];var b=num.words[i];if(a===b)continue;if(a<b)res=-1;else if(a>b)res=1;break}return res};BN.red=function red(num){return new Red(num)};BN.prototype.toRed=function toRed(ctx){assert(!this.red,"Already a number in reduction context");assert(!this.sign,"red works only with positives");return ctx.convertTo(this)._forceRed(ctx)};BN.prototype.fromRed=function fromRed(){assert(this.red,"fromRed works only with numbers in reduction context");return this.red.convertFrom(this)};BN.prototype._forceRed=function _forceRed(ctx){this.red=ctx;return this};BN.prototype.forceRed=function forceRed(ctx){assert(!this.red,"Already a number in reduction context");return this._forceRed(ctx)};BN.prototype.redAdd=function redAdd(num){assert(this.red,"redAdd works only with red numbers");return this.red.add(this,num)};BN.prototype.redIAdd=function redIAdd(num){assert(this.red,"redIAdd works only with red numbers");return this.red.iadd(this,num)};BN.prototype.redSub=function redSub(num){assert(this.red,"redSub works only with red numbers");return this.red.sub(this,num)};BN.prototype.redISub=function redISub(num){assert(this.red,"redISub works only with red numbers");return this.red.isub(this,num)};BN.prototype.redShl=function redShl(num){assert(this.red,"redShl works only with red numbers");return this.red.shl(this,num)};BN.prototype.redMul=function redMul(num){assert(this.red,"redMul works only with red numbers");this.red._verify2(this,num);return this.red.mul(this,num)};BN.prototype.redIMul=function redIMul(num){assert(this.red,"redMul works only with red numbers");
this.red._verify2(this,num);return this.red.imul(this,num)};BN.prototype.redSqr=function redSqr(){assert(this.red,"redSqr works only with red numbers");this.red._verify1(this);return this.red.sqr(this)};BN.prototype.redISqr=function redISqr(){assert(this.red,"redISqr works only with red numbers");this.red._verify1(this);return this.red.isqr(this)};BN.prototype.redSqrt=function redSqrt(){assert(this.red,"redSqrt works only with red numbers");this.red._verify1(this);return this.red.sqrt(this)};BN.prototype.redInvm=function redInvm(){assert(this.red,"redInvm works only with red numbers");this.red._verify1(this);return this.red.invm(this)};BN.prototype.redNeg=function redNeg(){assert(this.red,"redNeg works only with red numbers");this.red._verify1(this);return this.red.neg(this)};BN.prototype.redPow=function redPow(num){assert(this.red&&!num.red,"redPow(normalNum)");this.red._verify1(this);return this.red.pow(this,num)};var primes={k256:null,p224:null,p192:null,p25519:null};function MPrime(name,p){this.name=name;this.p=new BN(p,16);this.n=this.p.bitLength();this.k=new BN(1).ishln(this.n).isub(this.p);this.tmp=this._tmp()}MPrime.prototype._tmp=function _tmp(){var tmp=new BN(null);tmp.words=new Array(Math.ceil(this.n/13));return tmp};MPrime.prototype.ireduce=function ireduce(num){var r=num;var rlen;do{var pair=r.ishrn(this.n,0,this.tmp);r=this.imulK(pair.hi);r=r.iadd(pair.lo);rlen=r.bitLength()}while(rlen>this.n);var cmp=rlen<this.n?-1:r.cmp(this.p);if(cmp===0){r.words[0]=0;r.length=1}else if(cmp>0){r.isub(this.p)}else{r.strip()}return r};MPrime.prototype.imulK=function imulK(num){return num.imul(this.k)};function K256(){MPrime.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}inherits(K256,MPrime);K256.prototype.imulK=function imulK(num){num.words[num.length]=0;num.words[num.length+1]=0;num.length+=2;var uhi=0;var hi=0;var lo=0;for(var i=0;i<num.length;i++){var w=num.words[i];hi+=w*64;lo+=w*977;hi+=lo/67108864|0;uhi+=hi/67108864|0;hi&=67108863;lo&=67108863;num.words[i]=lo;lo=hi;hi=uhi;uhi=0}if(num.words[num.length-1]===0)num.length--;if(num.words[num.length-1]===0)num.length--;return num};function P224(){MPrime.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}inherits(P224,MPrime);function P192(){MPrime.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}inherits(P192,MPrime);function P25519(){MPrime.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}inherits(P25519,MPrime);P25519.prototype.imulK=function imulK(num){var carry=0;for(var i=0;i<num.length;i++){var hi=num.words[i]*19+carry;var lo=hi&67108863;hi>>>=26;num.words[i]=lo;carry=hi}if(carry!==0)num.words[num.length++]=carry;return num};BN._prime=function prime(name){if(primes[name])return primes[name];var prime;if(name==="k256")prime=new K256;else if(name==="p224")prime=new P224;else if(name==="p192")prime=new P192;else if(name==="p25519")prime=new P25519;else throw new Error("Unknown prime "+name);primes[name]=prime;return prime};function Red(m){if(typeof m==="string"){var prime=BN._prime(m);this.m=prime.p;this.prime=prime}else{this.m=m;this.prime=null}}Red.prototype._verify1=function _verify1(a){assert(!a.sign,"red works only with positives");assert(a.red,"red works only with red numbers")};Red.prototype._verify2=function _verify2(a,b){assert(!a.sign&&!b.sign,"red works only with positives");assert(a.red&&a.red===b.red,"red works only with red numbers")};Red.prototype.imod=function imod(a){if(this.prime)return this.prime.ireduce(a)._forceRed(this);return a.mod(this.m)._forceRed(this)};Red.prototype.neg=function neg(a){var r=a.clone();r.sign=!r.sign;return r.iadd(this.m)._forceRed(this)};Red.prototype.add=function add(a,b){this._verify2(a,b);var res=a.add(b);if(res.cmp(this.m)>=0)res.isub(this.m);return res._forceRed(this)};Red.prototype.iadd=function iadd(a,b){this._verify2(a,b);var res=a.iadd(b);if(res.cmp(this.m)>=0)res.isub(this.m);return res};Red.prototype.sub=function sub(a,b){this._verify2(a,b);var res=a.sub(b);if(res.cmpn(0)<0)res.iadd(this.m);return res._forceRed(this)};Red.prototype.isub=function isub(a,b){this._verify2(a,b);var res=a.isub(b);if(res.cmpn(0)<0)res.iadd(this.m);return res};Red.prototype.shl=function shl(a,num){this._verify1(a);return this.imod(a.shln(num))};Red.prototype.imul=function imul(a,b){this._verify2(a,b);return this.imod(a.imul(b))};Red.prototype.mul=function mul(a,b){this._verify2(a,b);return this.imod(a.mul(b))};Red.prototype.isqr=function isqr(a){return this.imul(a,a)};Red.prototype.sqr=function sqr(a){return this.mul(a,a)};Red.prototype.sqrt=function sqrt(a){if(a.cmpn(0)===0)return a.clone();var mod3=this.m.andln(3);assert(mod3%2===1);if(mod3===3){var pow=this.m.add(new BN(1)).ishrn(2);var r=this.pow(a,pow);return r}var q=this.m.subn(1);var s=0;while(q.cmpn(0)!==0&&q.andln(1)===0){s++;q.ishrn(1)}assert(q.cmpn(0)!==0);var one=new BN(1).toRed(this);var nOne=one.redNeg();var lpow=this.m.subn(1).ishrn(1);var z=this.m.bitLength();z=new BN(2*z*z).toRed(this);while(this.pow(z,lpow).cmp(nOne)!==0)z.redIAdd(nOne);var c=this.pow(z,q);var r=this.pow(a,q.addn(1).ishrn(1));var t=this.pow(a,q);var m=s;while(t.cmp(one)!==0){var tmp=t;for(var i=0;tmp.cmp(one)!==0;i++)tmp=tmp.redSqr();assert(i<m);var b=this.pow(c,new BN(1).ishln(m-i-1));r=r.redMul(b);c=b.redSqr();t=t.redMul(c);m=i}return r};Red.prototype.invm=function invm(a){var inv=a._egcd(new BN(1),this.m);if(inv.sign){inv.sign=false;return this.imod(inv).redNeg()}else{return this.imod(inv)}};Red.prototype.pow=function pow(a,num){var w=[];var q=num.clone();while(q.cmpn(0)!==0){w.push(q.andln(1));q.ishrn(1)}var res=a;for(var i=0;i<w.length;i++,res=this.sqr(res))if(w[i]!==0)break;if(++i<w.length){for(var q=this.sqr(res);i<w.length;i++,q=this.sqr(q)){if(w[i]===0)continue;res=this.mul(res,q)}}return res};Red.prototype.convertTo=function convertTo(num){return num.clone()};Red.prototype.convertFrom=function convertFrom(num){var res=num.clone();res.red=null;return res};BN.mont=function mont(num){return new Mont(num)};function Mont(m){Red.call(this,m);this.shift=this.m.bitLength();if(this.shift%26!==0)this.shift+=26-this.shift%26;this.r=new BN(1).ishln(this.shift);this.r2=this.imod(this.r.sqr());this.rinv=this.r.invm(this.m);this.minv=this.rinv.mul(this.r).sub(new BN(1)).div(this.m).neg().mod(this.r)}inherits(Mont,Red);Mont.prototype.convertTo=function convertTo(num){return this.imod(num.shln(this.shift))};Mont.prototype.convertFrom=function convertFrom(num){var r=this.imod(num.mul(this.rinv));r.red=null;return r};Mont.prototype.imul=function imul(a,b){if(a.cmpn(0)===0||b.cmpn(0)===0){a.words[0]=0;a.length=1;return a}var t=a.imul(b);var c=t.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m);var u=t.isub(c).ishrn(this.shift);var res=u;if(u.cmp(this.m)>=0)res=u.isub(this.m);else if(u.cmpn(0)<0)res=u.iadd(this.m);return res._forceRed(this)};Mont.prototype.mul=function mul(a,b){if(a.cmpn(0)===0||b.cmpn(0)===0)return new BN(0)._forceRed(this);var t=a.mul(b);var c=t.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m);var u=t.isub(c).ishrn(this.shift);var res=u;if(u.cmp(this.m)>=0)res=u.isub(this.m);else if(u.cmpn(0)<0)res=u.iadd(this.m);return res._forceRed(this)};Mont.prototype.invm=function invm(a){var res=this.imod(a.invm(this.m).mul(this.r2));return res._forceRed(this)}},{}],31:[function(require,module,exports){(function(Buffer){var bn=require("bn.js");module.exports=crt;function blind(priv,crypto){var r=getr(priv,crypto);var blinder=r.toRed(bn.mont(priv.modulus)).redPow(new bn(priv.publicExponent)).fromRed();return{blinder:blinder,unblinder:r.invm(priv.modulus)}}function crt(msg,priv,crypto){var blinds=blind(priv,crypto);var len=priv.modulus.byteLength();var mod=bn.mont(priv.modulus);var blinded=new bn(msg).mul(blinds.blinder).mod(priv.modulus);var c1=blinded.toRed(bn.mont(priv.prime1));var c2=blinded.toRed(bn.mont(priv.prime2));var qinv=priv.coefficient;var p=priv.prime1;var q=priv.prime2;var m1=c1.redPow(priv.exponent1);var m2=c2.redPow(priv.exponent2);m1=m1.fromRed();m2=m2.fromRed();var h=m1.isub(m2).imul(qinv).mod(p);h.imul(q);m2.iadd(h);var out=new Buffer(m2.imul(blinds.unblinder).mod(priv.modulus).toArray());if(out.length<len){var prefix=new Buffer(len-out.length);prefix.fill(0);out=Buffer.concat([prefix,out],len)}return out}crt.getr=getr;function getr(priv,crypto){var len=priv.modulus.byteLength();var r=new bn(crypto.randomBytes(len));while(r.cmp(priv.modulus)>=0||!r.mod(priv.prime1)||!r.mod(priv.prime2)){r=new bn(crypto.randomBytes(len))}return r}}).call(this,require("buffer").Buffer)},{"bn.js":30,buffer:5}],32:[function(require,module,exports){var elliptic=exports;elliptic.version=require("../package.json").version;elliptic.utils=require("./elliptic/utils");elliptic.rand=require("brorand");elliptic.hmacDRBG=require("./elliptic/hmac-drbg");elliptic.curve=require("./elliptic/curve");elliptic.curves=require("./elliptic/curves");elliptic.ec=require("./elliptic/ec")},{"../package.json":51,"./elliptic/curve":35,"./elliptic/curves":38,"./elliptic/ec":39,"./elliptic/hmac-drbg":42,"./elliptic/utils":43,brorand:44}],33:[function(require,module,exports){var bn=require("bn.js");var elliptic=require("../../elliptic");var getNAF=elliptic.utils.getNAF;var getJSF=elliptic.utils.getJSF;var assert=elliptic.utils.assert;function BaseCurve(type,conf){this.type=type;this.p=new bn(conf.p,16);this.red=conf.prime?bn.red(conf.prime):bn.mont(this.p);this.zero=new bn(0).toRed(this.red);this.one=new bn(1).toRed(this.red);this.two=new bn(2).toRed(this.red);this.n=conf.n&&new bn(conf.n,16);this.g=conf.g&&this.pointFromJSON(conf.g,conf.gRed);this._wnafT1=new Array(4);this._wnafT2=new Array(4);this._wnafT3=new Array(4);this._wnafT4=new Array(4)}module.exports=BaseCurve;BaseCurve.prototype.point=function point(){throw new Error("Not implemented")};BaseCurve.prototype.validate=function validate(point){throw new Error("Not implemented")};BaseCurve.prototype._fixedNafMul=function _fixedNafMul(p,k){var doubles=p._getDoubles();var naf=getNAF(k,1);var I=(1<<doubles.step+1)-(doubles.step%2===0?2:1);I/=3;var repr=[];for(var j=0;j<naf.length;j+=doubles.step){var nafW=0;for(var k=j+doubles.step-1;k>=j;k--)nafW=(nafW<<1)+naf[k];repr.push(nafW)}var a=this.jpoint(null,null,null);var b=this.jpoint(null,null,null);for(var i=I;i>0;i--){for(var j=0;j<repr.length;j++){var nafW=repr[j];if(nafW===i)b=b.mixedAdd(doubles.points[j]);else if(nafW===-i)b=b.mixedAdd(doubles.points[j].neg())}a=a.add(b)}return a.toP()};BaseCurve.prototype._wnafMul=function _wnafMul(p,k){var w=4;var nafPoints=p._getNAFPoints(w);w=nafPoints.wnd;var wnd=nafPoints.points;var naf=getNAF(k,w);var acc=this.jpoint(null,null,null);for(var i=naf.length-1;i>=0;i--){for(var k=0;i>=0&&naf[i]===0;i--)k++;if(i>=0)k++;acc=acc.dblp(k);if(i<0)break;var z=naf[i];assert(z!==0);if(p.type==="affine"){if(z>0)acc=acc.mixedAdd(wnd[z-1>>1]);else acc=acc.mixedAdd(wnd[-z-1>>1].neg())}else{if(z>0)acc=acc.add(wnd[z-1>>1]);else acc=acc.add(wnd[-z-1>>1].neg())}}return p.type==="affine"?acc.toP():acc};BaseCurve.prototype._wnafMulAdd=function _wnafMulAdd(defW,points,coeffs,len){var wndWidth=this._wnafT1;var wnd=this._wnafT2;var naf=this._wnafT3;var max=0;for(var i=0;i<len;i++){var p=points[i];var nafPoints=p._getNAFPoints(defW);wndWidth[i]=nafPoints.wnd;wnd[i]=nafPoints.points}for(var i=len-1;i>=1;i-=2){var a=i-1;var b=i;if(wndWidth[a]!==1||wndWidth[b]!==1){naf[a]=getNAF(coeffs[a],wndWidth[a]);naf[b]=getNAF(coeffs[b],wndWidth[b]);max=Math.max(naf[a].length,max);max=Math.max(naf[b].length,max);continue}var comb=[points[a],null,null,points[b]];if(points[a].y.cmp(points[b].y)===0){comb[1]=points[a].add(points[b]);comb[2]=points[a].toJ().mixedAdd(points[b].neg())}else if(points[a].y.cmp(points[b].y.redNeg())===0){comb[1]=points[a].toJ().mixedAdd(points[b]);comb[2]=points[a].add(points[b].neg())}else{comb[1]=points[a].toJ().mixedAdd(points[b]);comb[2]=points[a].toJ().mixedAdd(points[b].neg())}var index=[-3,-1,-5,-7,0,7,5,1,3];var jsf=getJSF(coeffs[a],coeffs[b]);max=Math.max(jsf[0].length,max);naf[a]=new Array(max);naf[b]=new Array(max);for(var j=0;j<max;j++){var ja=jsf[0][j]|0;var jb=jsf[1][j]|0;naf[a][j]=index[(ja+1)*3+(jb+1)];naf[b][j]=0;wnd[a]=comb}}var acc=this.jpoint(null,null,null);var tmp=this._wnafT4;for(var i=max;i>=0;i--){var k=0;while(i>=0){var zero=true;for(var j=0;j<len;j++){tmp[j]=naf[j][i]|0;if(tmp[j]!==0)zero=false}if(!zero)break;k++;i--}if(i>=0)k++;acc=acc.dblp(k);if(i<0)break;for(var j=0;j<len;j++){var z=tmp[j];var p;if(z===0)continue;else if(z>0)p=wnd[j][z-1>>1];else if(z<0)p=wnd[j][-z-1>>1].neg();if(p.type==="affine")acc=acc.mixedAdd(p);else acc=acc.add(p)}}for(var i=0;i<len;i++)wnd[i]=null;return acc.toP()};BaseCurve.BasePoint=BasePoint;function BasePoint(curve,type){this.curve=curve;this.type=type;this.precomputed=null}BasePoint.prototype.validate=function validate(){return this.curve.validate(this)};BasePoint.prototype.precompute=function precompute(power,_beta){if(this.precomputed)return this;var precomputed={doubles:null,naf:null,beta:null};precomputed.naf=this._getNAFPoints(8);precomputed.doubles=this._getDoubles(4,power);precomputed.beta=this._getBeta();this.precomputed=precomputed;return this};BasePoint.prototype._getDoubles=function _getDoubles(step,power){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;var doubles=[this];var acc=this;for(var i=0;i<power;i+=step){for(var j=0;j<step;j++)acc=acc.dbl();doubles.push(acc)}return{step:step,points:doubles}};BasePoint.prototype._getNAFPoints=function _getNAFPoints(wnd){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;var res=[this];var max=(1<<wnd)-1;var dbl=max===1?null:this.dbl();for(var i=1;i<max;i++)res[i]=res[i-1].add(dbl);return{wnd:wnd,points:res}};BasePoint.prototype._getBeta=function _getBeta(){return null};BasePoint.prototype.dblp=function dblp(k){var r=this;for(var i=0;i<k;i++)r=r.dbl();return r}},{"../../elliptic":32,"bn.js":30}],34:[function(require,module,exports){var curve=require("../curve");var elliptic=require("../../elliptic");var bn=require("bn.js");var inherits=require("inherits");var Base=curve.base;var getNAF=elliptic.utils.getNAF;var assert=elliptic.utils.assert;function EdwardsCurve(conf){this.twisted=conf.a!=1;this.mOneA=this.twisted&&conf.a==-1;this.extended=this.mOneA;Base.call(this,"mont",conf);this.a=new bn(conf.a,16).mod(this.red.m).toRed(this.red);this.c=new bn(conf.c,16).toRed(this.red);this.c2=this.c.redSqr();this.d=new bn(conf.d,16).toRed(this.red);this.dd=this.d.redAdd(this.d);assert(!this.twisted||this.c.fromRed().cmpn(1)===0);this.oneC=conf.c==1}inherits(EdwardsCurve,Base);module.exports=EdwardsCurve;EdwardsCurve.prototype._mulA=function _mulA(num){if(this.mOneA)return num.redNeg();else return this.a.redMul(num)};EdwardsCurve.prototype._mulC=function _mulC(num){if(this.oneC)return num;else return this.c.redMul(num)};EdwardsCurve.prototype.point=function point(x,y,z,t){return new Point(this,x,y,z,t)};EdwardsCurve.prototype.jpoint=function jpoint(x,y,z,t){return this.point(x,y,z,t)};EdwardsCurve.prototype.pointFromJSON=function pointFromJSON(obj){return Point.fromJSON(this,obj)};EdwardsCurve.prototype.pointFromX=function pointFromX(odd,x){x=new bn(x,16);if(!x.red)x=x.toRed(this.red);var x2=x.redSqr();var rhs=this.c2.redSub(this.a.redMul(x2));var lhs=this.one.redSub(this.c2.redMul(this.d).redMul(x2));var y=rhs.redMul(lhs.redInvm()).redSqrt();var isOdd=y.fromRed().isOdd();if(odd&&!isOdd||!odd&&isOdd)y=y.redNeg();return this.point(x,y,curve.one)};EdwardsCurve.prototype.validate=function validate(point){if(point.isInfinity())return true;point.normalize();var x2=point.x.redSqr();var y2=point.y.redSqr();var lhs=x2.redMul(this.a).redAdd(y2);var rhs=this.c2.redMul(this.one.redAdd(this.d.redMul(x2).redMul(y2)));return lhs.cmp(rhs)===0};function Point(curve,x,y,z,t){Base.BasePoint.call(this,curve,"projective");if(x===null&&y===null&&z===null){this.x=this.curve.zero;this.y=this.curve.one;this.z=this.curve.one;this.t=this.curve.zero;this.zOne=true}else{this.x=new bn(x,16);this.y=new bn(y,16);this.z=z?new bn(z,16):this.curve.one;this.t=t&&new bn(t,16);if(!this.x.red)this.x=this.x.toRed(this.curve.red);if(!this.y.red)this.y=this.y.toRed(this.curve.red);if(!this.z.red)this.z=this.z.toRed(this.curve.red);if(this.t&&!this.t.red)this.t=this.t.toRed(this.curve.red);this.zOne=this.z===this.curve.one;if(this.curve.extended&&!this.t){this.t=this.x.redMul(this.y);if(!this.zOne)this.t=this.t.redMul(this.z.redInvm())}}}inherits(Point,Base.BasePoint);Point.fromJSON=function fromJSON(curve,obj){return new Point(curve,obj[0],obj[1],obj[2])};Point.prototype.inspect=function inspect(){if(this.isInfinity())return"<EC Point Infinity>";return"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"};Point.prototype.isInfinity=function isInfinity(){return this.x.cmpn(0)===0&&this.y.cmp(this.z)===0};Point.prototype._extDbl=function _extDbl(){var a=this.x.redSqr();var b=this.y.redSqr();var c=this.z.redSqr();c=c.redIAdd(c);var d=this.curve._mulA(a);var e=this.x.redAdd(this.y).redSqr().redISub(a).redISub(b);var g=d.redAdd(b);var f=g.redSub(c);var h=d.redSub(b);var nx=e.redMul(f);var ny=g.redMul(h);var nt=e.redMul(h);var nz=f.redMul(g);return this.curve.point(nx,ny,nz,nt)};Point.prototype._projDbl=function _projDbl(){var b=this.x.redAdd(this.y).redSqr();var c=this.x.redSqr();var d=this.y.redSqr();if(this.curve.twisted){var e=this.curve._mulA(c);var f=e.redAdd(d);if(this.zOne){var nx=b.redSub(c).redSub(d).redMul(f.redSub(this.curve.two));var ny=f.redMul(e.redSub(d));var nz=f.redSqr().redSub(f).redSub(f)}else{var h=this.z.redSqr();var j=f.redSub(h).redISub(h);var nx=b.redSub(c).redISub(d).redMul(j);var ny=f.redMul(e.redSub(d));var nz=f.redMul(j)}}else{var e=c.redAdd(d);var h=this.curve._mulC(redMul(this.z)).redSqr();var j=e.redSub(h).redSub(h);var nx=this.curve._mulC(b.redISub(e)).redMul(j);var ny=this.curve._mulC(e).redMul(c.redISub(d));var nz=e.redMul(j)}return this.curve.point(nx,ny,nz)};Point.prototype.dbl=function dbl(){if(this.isInfinity())return this;if(this.curve.extended)return this._extDbl();else return this._projDbl()};Point.prototype._extAdd=function _extAdd(p){var a=this.y.redSub(this.x).redMul(p.y.redSub(p.x));var b=this.y.redAdd(this.x).redMul(p.y.redAdd(p.x));var c=this.t.redMul(this.curve.dd).redMul(p.t);var d=this.z.redMul(p.z.redAdd(p.z));var e=b.redSub(a);var f=d.redSub(c);var g=d.redAdd(c);var h=b.redAdd(a);var nx=e.redMul(f);var ny=g.redMul(h);var nt=e.redMul(h);var nz=f.redMul(g);return this.curve.point(nx,ny,nz,nt)};Point.prototype._projAdd=function _projAdd(p){var a=this.z.redMul(p.z);var b=a.redSqr();var c=this.x.redMul(p.x);var d=this.y.redMul(p.y);var e=this.curve.d.redMul(c).redMul(d);var f=b.redSub(e);var g=b.redAdd(e);var tmp=this.x.redAdd(this.y).redMul(p.x.redAdd(p.y)).redISub(c).redISub(d);var nx=a.redMul(f).redMul(tmp);if(this.curve.twisted){var ny=a.redMul(g).redMul(d.redSub(this.curve._mulA(c)));var nz=f.redMul(g)}else{var ny=a.redMul(g).redMul(d.redSub(c));var nz=this.curve._mulC(f).redMul(g)}return this.curve.point(nx,ny,nz)};Point.prototype.add=function add(p){if(this.isInfinity())return p;if(p.isInfinity())return this;if(this.curve.extended)return this._extAdd(p);else return this._projAdd(p)};Point.prototype.mul=function mul(k){if(this.precomputed&&this.precomputed.doubles)return this.curve._fixedNafMul(this,k);else return this.curve._wnafMul(this,k)};Point.prototype.mulAdd=function mulAdd(k1,p,k2){return this.curve._wnafMulAdd(1,[this,p],[k1,k2],2)};Point.prototype.normalize=function normalize(){if(this.zOne)return this;var zi=this.z.redInvm();this.x=this.x.redMul(zi);this.y=this.y.redMul(zi);if(this.t)this.t=this.t.redMul(zi);this.z=this.curve.one;this.zOne=true;return this};Point.prototype.neg=function neg(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())};Point.prototype.getX=function getX(){this.normalize();return this.x.fromRed()};Point.prototype.getY=function getY(){this.normalize();return this.y.fromRed()};Point.prototype.toP=Point.prototype.normalize;Point.prototype.mixedAdd=Point.prototype.add},{"../../elliptic":32,"../curve":35,"bn.js":30,inherits:146}],35:[function(require,module,exports){var curve=exports;curve.base=require("./base");curve.short=require("./short");curve.mont=require("./mont");curve.edwards=require("./edwards")},{"./base":33,"./edwards":34,"./mont":36,"./short":37}],36:[function(require,module,exports){var curve=require("../curve");var elliptic=require("../../elliptic");var bn=require("bn.js");var inherits=require("inherits");var Base=curve.base;var getNAF=elliptic.utils.getNAF;var assert=elliptic.utils.assert;function MontCurve(conf){Base.call(this,"mont",conf);this.a=new bn(conf.a,16).toRed(this.red);this.b=new bn(conf.b,16).toRed(this.red);this.i4=new bn(4).toRed(this.red).redInvm();this.two=new bn(2).toRed(this.red);this.a24=this.i4.redMul(this.a.redAdd(this.two))}inherits(MontCurve,Base);module.exports=MontCurve;MontCurve.prototype.point=function point(x,z){return new Point(this,x,z)};MontCurve.prototype.pointFromJSON=function pointFromJSON(obj){return Point.fromJSON(this,obj)};MontCurve.prototype.validate=function validate(point){var x=point.normalize().x;var x2=x.redSqr();var rhs=x2.redMul(x).redAdd(x2.redMul(this.a)).redAdd(x);var y=rhs.redSqrt();return y.redSqr().cmp(rhs)===0};function Point(curve,x,z){Base.BasePoint.call(this,curve,"projective");if(x===null&&z===null){this.x=this.curve.one;this.z=this.curve.zero}else{this.x=new bn(x,16);this.z=new bn(z,16);if(!this.x.red)this.x=this.x.toRed(this.curve.red);if(!this.z.red)this.z=this.z.toRed(this.curve.red)}}inherits(Point,Base.BasePoint);Point.prototype.precompute=function precompute(){};Point.fromJSON=function fromJSON(curve,obj){return new Point(curve,obj[0],obj[1]||curve.one)};Point.prototype.inspect=function inspect(){if(this.isInfinity())return"<EC Point Infinity>";return"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"};Point.prototype.isInfinity=function isInfinity(){return this.z.cmpn(0)===0};Point.prototype.dbl=function dbl(){var a=this.x.redAdd(this.z);var aa=a.redSqr();var b=this.x.redSub(this.z);var bb=b.redSqr();var c=aa.redSub(bb);var nx=aa.redMul(bb);var nz=c.redMul(bb.redAdd(this.curve.a24.redMul(c)));return this.curve.point(nx,nz)};Point.prototype.add=function add(p){throw new Error("Not supported on Montgomery curve")};Point.prototype.diffAdd=function diffAdd(p,diff){var a=this.x.redAdd(this.z);var b=this.x.redSub(this.z);var c=p.x.redAdd(p.z);var d=p.x.redSub(p.z);var da=d.redMul(a);var cb=c.redMul(b);var nx=diff.z.redMul(da.redAdd(cb).redSqr());var nz=diff.x.redMul(da.redISub(cb).redSqr());return this.curve.point(nx,nz)};Point.prototype.mul=function mul(k){var t=k.clone();var a=this;var b=this.curve.point(null,null);var c=this;for(var bits=[];t.cmpn(0)!==0;t.ishrn(1))bits.push(t.andln(1));for(var i=bits.length-1;i>=0;i--){if(bits[i]===0){a=a.diffAdd(b,c);b=b.dbl()}else{b=a.diffAdd(b,c);a=a.dbl()}}return b};Point.prototype.mulAdd=function mulAdd(){throw new Error("Not supported on Montgomery curve")};Point.prototype.normalize=function normalize(){this.x=this.x.redMul(this.z.redInvm());this.z=this.curve.one;return this};Point.prototype.getX=function getX(){this.normalize();return this.x.fromRed()}},{"../../elliptic":32,"../curve":35,"bn.js":30,inherits:146}],37:[function(require,module,exports){var curve=require("../curve");var elliptic=require("../../elliptic");var bn=require("bn.js");var inherits=require("inherits");var Base=curve.base;var getNAF=elliptic.utils.getNAF;var assert=elliptic.utils.assert;function ShortCurve(conf){Base.call(this,"short",conf);this.a=new bn(conf.a,16).toRed(this.red);this.b=new bn(conf.b,16).toRed(this.red);this.tinv=this.two.redInvm();this.zeroA=this.a.fromRed().cmpn(0)===0;this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0;this.endo=this._getEndomorphism(conf);this._endoWnafT1=new Array(4);this._endoWnafT2=new Array(4)}inherits(ShortCurve,Base);module.exports=ShortCurve;ShortCurve.prototype._getEndomorphism=function _getEndomorphism(conf){if(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)return;var beta;var lambda;if(conf.beta){beta=new bn(conf.beta,16).toRed(this.red)}else{var betas=this._getEndoRoots(this.p);beta=betas[0].cmp(betas[1])<0?betas[0]:betas[1];beta=beta.toRed(this.red)}if(conf.lambda){lambda=new bn(conf.lambda,16)}else{var lambdas=this._getEndoRoots(this.n);if(this.g.mul(lambdas[0]).x.cmp(this.g.x.redMul(beta))===0){lambda=lambdas[0]}else{lambda=lambdas[1];assert(this.g.mul(lambda).x.cmp(this.g.x.redMul(beta))===0)}}var basis;if(conf.basis){basis=conf.basis.map(function(vec){return{a:new bn(vec.a,16),b:new bn(vec.b,16)}})}else{basis=this._getEndoBasis(lambda)}return{beta:beta,lambda:lambda,basis:basis}};ShortCurve.prototype._getEndoRoots=function _getEndoRoots(num){var red=num===this.p?this.red:bn.mont(num);var tinv=new bn(2).toRed(red).redInvm();var ntinv=tinv.redNeg();var one=new bn(1).toRed(red);var s=new bn(3).toRed(red).redNeg().redSqrt().redMul(tinv);var l1=ntinv.redAdd(s).fromRed();var l2=ntinv.redSub(s).fromRed();return[l1,l2]};ShortCurve.prototype._getEndoBasis=function _getEndoBasis(lambda){var aprxSqrt=this.n.shrn(Math.floor(this.n.bitLength()/2));var u=lambda;var v=this.n.clone();var x1=new bn(1);var y1=new bn(0);var x2=new bn(0);var y2=new bn(1);var a0;var b0;var a1;var b1;var a2;var b2;var prevR;var i=0;while(u.cmpn(0)!==0){var q=v.div(u);var r=v.sub(q.mul(u));var x=x2.sub(q.mul(x1));var y=y2.sub(q.mul(y1));if(!a1&&r.cmp(aprxSqrt)<0){a0=prevR.neg();b0=x1;a1=r.neg();b1=x}else if(a1&&++i===2){break}prevR=r;v=u;u=r;x2=x1;x1=x;y2=y1;y1=y}a2=r.neg();b2=x;var len1=a1.sqr().add(b1.sqr());var len2=a2.sqr().add(b2.sqr());if(len2.cmp(len1)>=0){a2=a0;b2=b0}if(a1.sign){a1=a1.neg();b1=b1.neg()}if(a2.sign){a2=a2.neg();b2=b2.neg()}return[{a:a1,b:b1},{a:a2,b:b2}]};ShortCurve.prototype._endoSplit=function _endoSplit(k){var basis=this.endo.basis;var v1=basis[0];var v2=basis[1];var c1=v2.b.mul(k).divRound(this.n);var c2=v1.b.neg().mul(k).divRound(this.n);var p1=c1.mul(v1.a);var p2=c2.mul(v2.a);var q1=c1.mul(v1.b);var q2=c2.mul(v2.b);var k1=k.sub(p1).sub(p2);var k2=q1.add(q2).neg();return{k1:k1,k2:k2}};ShortCurve.prototype.point=function point(x,y,isRed){return new Point(this,x,y,isRed)};ShortCurve.prototype.pointFromX=function pointFromX(odd,x){x=new bn(x,16);if(!x.red)x=x.toRed(this.red);var y2=x.redSqr().redMul(x).redIAdd(x.redMul(this.a)).redIAdd(this.b);var y=y2.redSqrt();var isOdd=y.fromRed().isOdd();if(odd&&!isOdd||!odd&&isOdd)y=y.redNeg();return this.point(x,y)};ShortCurve.prototype.jpoint=function jpoint(x,y,z){return new JPoint(this,x,y,z)};ShortCurve.prototype.pointFromJSON=function pointFromJSON(obj,red){return Point.fromJSON(this,obj,red)};ShortCurve.prototype.validate=function validate(point){if(point.inf)return true;var x=point.x;var y=point.y;var ax=this.a.redMul(x);var rhs=x.redSqr().redMul(x).redIAdd(ax).redIAdd(this.b);return y.redSqr().redISub(rhs).cmpn(0)===0};ShortCurve.prototype._endoWnafMulAdd=function _endoWnafMulAdd(points,coeffs){var npoints=this._endoWnafT1;var ncoeffs=this._endoWnafT2;for(var i=0;i<points.length;i++){var split=this._endoSplit(coeffs[i]);var p=points[i];var beta=p._getBeta();if(split.k1.sign){split.k1.sign=!split.k1.sign;p=p.neg(true)}if(split.k2.sign){split.k2.sign=!split.k2.sign;beta=beta.neg(true)}npoints[i*2]=p;npoints[i*2+1]=beta;ncoeffs[i*2]=split.k1;ncoeffs[i*2+1]=split.k2}var res=this._wnafMulAdd(1,npoints,ncoeffs,i*2);for(var j=0;j<i*2;j++){npoints[j]=null;ncoeffs[j]=null}return res};function Point(curve,x,y,isRed){Base.BasePoint.call(this,curve,"affine");if(x===null&&y===null){this.x=null;this.y=null;this.inf=true}else{this.x=new bn(x,16);this.y=new bn(y,16);if(isRed){this.x.forceRed(this.curve.red);this.y.forceRed(this.curve.red)}if(!this.x.red)this.x=this.x.toRed(this.curve.red);if(!this.y.red)this.y=this.y.toRed(this.curve.red);this.inf=false}}inherits(Point,Base.BasePoint);Point.prototype._getBeta=function _getBeta(){if(!this.curve.endo)return;var pre=this.precomputed;if(pre&&pre.beta)return pre.beta;var beta=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(pre){var curve=this.curve;function endoMul(p){return curve.point(p.x.redMul(curve.endo.beta),p.y)}pre.beta=beta;beta.precomputed={beta:null,naf:pre.naf&&{wnd:pre.naf.wnd,points:pre.naf.points.map(endoMul)},doubles:pre.doubles&&{step:pre.doubles.step,points:pre.doubles.points.map(endoMul)}}}return beta};Point.prototype.toJSON=function toJSON(){if(!this.precomputed)return[this.x,this.y];return[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]};Point.fromJSON=function fromJSON(curve,obj,red){if(typeof obj==="string")obj=JSON.parse(obj);var res=curve.point(obj[0],obj[1],red);if(!obj[2])return res;function obj2point(obj){return curve.point(obj[0],obj[1],red)}var pre=obj[2];res.precomputed={beta:null,doubles:pre.doubles&&{step:pre.doubles.step,points:[res].concat(pre.doubles.points.map(obj2point))},naf:pre.naf&&{wnd:pre.naf.wnd,points:[res].concat(pre.naf.points.map(obj2point))}};return res};Point.prototype.inspect=function inspect(){if(this.isInfinity())return"<EC Point Infinity>";return"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"};Point.prototype.isInfinity=function isInfinity(){return this.inf};Point.prototype.add=function add(p){if(this.inf)return p;if(p.inf)return this;if(this.eq(p))return this.dbl();if(this.neg().eq(p))return this.curve.point(null,null);if(this.x.cmp(p.x)===0)return this.curve.point(null,null);var c=this.y.redSub(p.y);if(c.cmpn(0)!==0)c=c.redMul(this.x.redSub(p.x).redInvm());var nx=c.redSqr().redISub(this.x).redISub(p.x);var ny=c.redMul(this.x.redSub(nx)).redISub(this.y);return this.curve.point(nx,ny)};Point.prototype.dbl=function dbl(){if(this.inf)return this;var ys1=this.y.redAdd(this.y);if(ys1.cmpn(0)===0)return this.curve.point(null,null);var a=this.curve.a;var x2=this.x.redSqr();var dyinv=ys1.redInvm();var c=x2.redAdd(x2).redIAdd(x2).redIAdd(a).redMul(dyinv);var nx=c.redSqr().redISub(this.x.redAdd(this.x));var ny=c.redMul(this.x.redSub(nx)).redISub(this.y);return this.curve.point(nx,ny)};Point.prototype.getX=function getX(){return this.x.fromRed()};Point.prototype.getY=function getY(){return this.y.fromRed()};Point.prototype.mul=function mul(k){k=new bn(k,16);if(this.precomputed&&this.precomputed.doubles)return this.curve._fixedNafMul(this,k);else if(this.curve.endo)return this.curve._endoWnafMulAdd([this],[k]);else return this.curve._wnafMul(this,k)};Point.prototype.mulAdd=function mulAdd(k1,p2,k2){var points=[this,p2];var coeffs=[k1,k2];if(this.curve.endo)return this.curve._endoWnafMulAdd(points,coeffs);else return this.curve._wnafMulAdd(1,points,coeffs,2)};Point.prototype.eq=function eq(p){return this===p||this.inf===p.inf&&(this.inf||this.x.cmp(p.x)===0&&this.y.cmp(p.y)===0)};Point.prototype.neg=function neg(_precompute){if(this.inf)return this;var res=this.curve.point(this.x,this.y.redNeg());if(_precompute&&this.precomputed){var pre=this.precomputed;function negate(p){return p.neg()}res.precomputed={naf:pre.naf&&{wnd:pre.naf.wnd,points:pre.naf.points.map(negate)},doubles:pre.doubles&&{step:pre.doubles.step,points:pre.doubles.points.map(negate)}}}return res};Point.prototype.toJ=function toJ(){if(this.inf)return this.curve.jpoint(null,null,null);var res=this.curve.jpoint(this.x,this.y,this.curve.one);return res};function JPoint(curve,x,y,z){Base.BasePoint.call(this,curve,"jacobian");if(x===null&&y===null&&z===null){this.x=this.curve.one;this.y=this.curve.one;this.z=new bn(0)}else{this.x=new bn(x,16);this.y=new bn(y,16);this.z=new bn(z,16)}if(!this.x.red)this.x=this.x.toRed(this.curve.red);
if(!this.y.red)this.y=this.y.toRed(this.curve.red);if(!this.z.red)this.z=this.z.toRed(this.curve.red);this.zOne=this.z===this.curve.one}inherits(JPoint,Base.BasePoint);JPoint.prototype.toP=function toP(){if(this.isInfinity())return this.curve.point(null,null);var zinv=this.z.redInvm();var zinv2=zinv.redSqr();var ax=this.x.redMul(zinv2);var ay=this.y.redMul(zinv2).redMul(zinv);return this.curve.point(ax,ay)};JPoint.prototype.neg=function neg(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)};JPoint.prototype.add=function add(p){if(this.isInfinity())return p;if(p.isInfinity())return this;var pz2=p.z.redSqr();var z2=this.z.redSqr();var u1=this.x.redMul(pz2);var u2=p.x.redMul(z2);var s1=this.y.redMul(pz2.redMul(p.z));var s2=p.y.redMul(z2.redMul(this.z));var h=u1.redSub(u2);var r=s1.redSub(s2);if(h.cmpn(0)===0){if(r.cmpn(0)!==0)return this.curve.jpoint(null,null,null);else return this.dbl()}var h2=h.redSqr();var h3=h2.redMul(h);var v=u1.redMul(h2);var nx=r.redSqr().redIAdd(h3).redISub(v).redISub(v);var ny=r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));var nz=this.z.redMul(p.z).redMul(h);return this.curve.jpoint(nx,ny,nz)};JPoint.prototype.mixedAdd=function mixedAdd(p){if(this.isInfinity())return p.toJ();if(p.isInfinity())return this;var z2=this.z.redSqr();var u1=this.x;var u2=p.x.redMul(z2);var s1=this.y;var s2=p.y.redMul(z2).redMul(this.z);var h=u1.redSub(u2);var r=s1.redSub(s2);if(h.cmpn(0)===0){if(r.cmpn(0)!==0)return this.curve.jpoint(null,null,null);else return this.dbl()}var h2=h.redSqr();var h3=h2.redMul(h);var v=u1.redMul(h2);var nx=r.redSqr().redIAdd(h3).redISub(v).redISub(v);var ny=r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));var nz=this.z.redMul(h);return this.curve.jpoint(nx,ny,nz)};JPoint.prototype.dblp=function dblp(pow){if(pow===0)return this;if(this.isInfinity())return this;if(!pow)return this.dbl();if(this.curve.zeroA||this.curve.threeA){var r=this;for(var i=0;i<pow;i++)r=r.dbl();return r}var a=this.curve.a;var tinv=this.curve.tinv;var jx=this.x;var jy=this.y;var jz=this.z;var jz4=jz.redSqr().redSqr();var jyd=jy.redAdd(jy);for(var i=0;i<pow;i++){var jx2=jx.redSqr();var jyd2=jyd.redSqr();var jyd4=jyd2.redSqr();var c=jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4));var t1=jx.redMul(jyd2);var nx=c.redSqr().redISub(t1.redAdd(t1));var t2=t1.redISub(nx);var dny=c.redMul(t2);dny=dny.redIAdd(dny).redISub(jyd4);var nz=jyd.redMul(jz);if(i+1<pow)jz4=jz4.redMul(jyd4);jx=nx;jz=nz;jyd=dny}return this.curve.jpoint(jx,jyd.redMul(tinv),jz)};JPoint.prototype.dbl=function dbl(){if(this.isInfinity())return this;if(this.curve.zeroA)return this._zeroDbl();else if(this.curve.threeA)return this._threeDbl();else return this._dbl()};JPoint.prototype._zeroDbl=function _zeroDbl(){if(this.zOne){var xx=this.x.redSqr();var yy=this.y.redSqr();var yyyy=yy.redSqr();var s=this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);s=s.redIAdd(s);var m=xx.redAdd(xx).redIAdd(xx);var t=m.redSqr().redISub(s).redISub(s);var yyyy8=yyyy.redIAdd(yyyy);yyyy8=yyyy8.redIAdd(yyyy8);yyyy8=yyyy8.redIAdd(yyyy8);var nx=t;var ny=m.redMul(s.redISub(t)).redISub(yyyy8);var nz=this.y.redAdd(this.y)}else{var a=this.x.redSqr();var b=this.y.redSqr();var c=b.redSqr();var d=this.x.redAdd(b).redSqr().redISub(a).redISub(c);d=d.redIAdd(d);var e=a.redAdd(a).redIAdd(a);var f=e.redSqr();var c8=c.redIAdd(c);c8=c8.redIAdd(c8);c8=c8.redIAdd(c8);var nx=f.redISub(d).redISub(d);var ny=e.redMul(d.redISub(nx)).redISub(c8);var nz=this.y.redMul(this.z);nz=nz.redIAdd(nz)}return this.curve.jpoint(nx,ny,nz)};JPoint.prototype._threeDbl=function _threeDbl(){if(this.zOne){var xx=this.x.redSqr();var yy=this.y.redSqr();var yyyy=yy.redSqr();var s=this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);s=s.redIAdd(s);var m=xx.redAdd(xx).redIAdd(xx).redIAdd(this.curve.a);var t=m.redSqr().redISub(s).redISub(s);var nx=t;var yyyy8=yyyy.redIAdd(yyyy);yyyy8=yyyy8.redIAdd(yyyy8);yyyy8=yyyy8.redIAdd(yyyy8);var ny=m.redMul(s.redISub(t)).redISub(yyyy8);var nz=this.y.redAdd(this.y)}else{var delta=this.z.redSqr();var gamma=this.y.redSqr();var beta=this.x.redMul(gamma);var alpha=this.x.redSub(delta).redMul(this.x.redAdd(delta));alpha=alpha.redAdd(alpha).redIAdd(alpha);var beta4=beta.redIAdd(beta);beta4=beta4.redIAdd(beta4);var beta8=beta4.redAdd(beta4);var nx=alpha.redSqr().redISub(beta8);var nz=this.y.redAdd(this.z).redSqr().redISub(gamma).redISub(delta);var ggamma8=gamma.redSqr();ggamma8=ggamma8.redIAdd(ggamma8);ggamma8=ggamma8.redIAdd(ggamma8);ggamma8=ggamma8.redIAdd(ggamma8);var ny=alpha.redMul(beta4.redISub(nx)).redISub(ggamma8)}return this.curve.jpoint(nx,ny,nz)};JPoint.prototype._dbl=function _dbl(){var a=this.curve.a;var tinv=this.curve.tinv;var jx=this.x;var jy=this.y;var jz=this.z;var jz4=jz.redSqr().redSqr();var jx2=jx.redSqr();var jy2=jy.redSqr();var c=jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4));var jxd4=jx.redAdd(jx);jxd4=jxd4.redIAdd(jxd4);var t1=jxd4.redMul(jy2);var nx=c.redSqr().redISub(t1.redAdd(t1));var t2=t1.redISub(nx);var jyd8=jy2.redSqr();jyd8=jyd8.redIAdd(jyd8);jyd8=jyd8.redIAdd(jyd8);jyd8=jyd8.redIAdd(jyd8);var ny=c.redMul(t2).redISub(jyd8);var nz=jy.redAdd(jy).redMul(jz);return this.curve.jpoint(nx,ny,nz)};JPoint.prototype.trpl=function trpl(){if(!this.curve.zeroA)return this.dbl().add(this);var xx=this.x.redSqr();var yy=this.y.redSqr();var zz=this.z.redSqr();var yyyy=yy.redSqr();var m=xx.redAdd(xx).redIAdd(xx);var mm=m.redSqr();var e=this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);e=e.redIAdd(e);e=e.redAdd(e).redIAdd(e);e=e.redISub(mm);var ee=e.redSqr();var t=yyyy.redIAdd(yyyy);t=t.redIAdd(t);t=t.redIAdd(t);t=t.redIAdd(t);var u=m.redIAdd(e).redSqr().redISub(mm).redISub(ee).redISub(t);var yyu4=yy.redMul(u);yyu4=yyu4.redIAdd(yyu4);yyu4=yyu4.redIAdd(yyu4);var nx=this.x.redMul(ee).redISub(yyu4);nx=nx.redIAdd(nx);nx=nx.redIAdd(nx);var ny=this.y.redMul(u.redMul(t.redISub(u)).redISub(e.redMul(ee)));ny=ny.redIAdd(ny);ny=ny.redIAdd(ny);ny=ny.redIAdd(ny);var nz=this.z.redAdd(e).redSqr().redISub(zz).redISub(ee);return this.curve.jpoint(nx,ny,nz)};JPoint.prototype.mul=function mul(k,kbase){k=new bn(k,kbase);return this.curve._wnafMul(this,k)};JPoint.prototype.eq=function eq(p){if(p.type==="affine")return this.eq(p.toJ());if(this===p)return true;var z2=this.z.redSqr();var pz2=p.z.redSqr();if(this.x.redMul(pz2).redISub(p.x.redMul(z2)).cmpn(0)!==0)return false;var z3=z2.redMul(this.z);var pz3=pz2.redMul(p.z);return this.y.redMul(pz3).redISub(p.y.redMul(z3)).cmpn(0)===0};JPoint.prototype.inspect=function inspect(){if(this.isInfinity())return"<EC JPoint Infinity>";return"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"};JPoint.prototype.isInfinity=function isInfinity(){return this.z.cmpn(0)===0}},{"../../elliptic":32,"../curve":35,"bn.js":30,inherits:146}],38:[function(require,module,exports){var curves=exports;var hash=require("hash.js");var bn=require("bn.js");var elliptic=require("../elliptic");var assert=elliptic.utils.assert;function PresetCurve(options){if(options.type==="short")this.curve=new elliptic.curve.short(options);else if(options.type==="edwards")this.curve=new elliptic.curve.edwards(options);else this.curve=new elliptic.curve.mont(options);this.g=this.curve.g;this.n=this.curve.n;this.hash=options.hash;assert(this.g.validate(),"Invalid curve");assert(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}curves.PresetCurve=PresetCurve;function defineCurve(name,options){Object.defineProperty(curves,name,{configurable:true,enumerable:true,get:function(){var curve=new PresetCurve(options);Object.defineProperty(curves,name,{configurable:true,enumerable:true,value:curve});return curve}})}defineCurve("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:hash.sha256,gRed:false,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]});defineCurve("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:hash.sha256,gRed:false,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]});defineCurve("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:hash.sha256,gRed:false,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]});defineCurve("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"0",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:hash.sha256,gRed:false,g:["9"]});defineCurve("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:hash.sha256,gRed:false,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});defineCurve("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:hash.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:false,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",{doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}]})
},{"../elliptic":32,"bn.js":30,"hash.js":45}],39:[function(require,module,exports){var bn=require("bn.js");var elliptic=require("../../elliptic");var utils=elliptic.utils;var assert=utils.assert;var KeyPair=require("./key");var Signature=require("./signature");function EC(options){if(!(this instanceof EC))return new EC(options);if(typeof options==="string"){assert(elliptic.curves.hasOwnProperty(options),"Unknown curve "+options);options=elliptic.curves[options]}if(options instanceof elliptic.curves.PresetCurve)options={curve:options};this.curve=options.curve.curve;this.n=this.curve.n;this.nh=this.n.shrn(1);this.g=this.curve.g;this.g=options.curve.g;this.g.precompute(options.curve.n.bitLength()+1);this.hash=options.hash||options.curve.hash}module.exports=EC;EC.prototype.keyPair=function keyPair(priv,pub){return new KeyPair(this,priv,pub)};EC.prototype.genKeyPair=function genKeyPair(options){if(!options)options={};var drbg=new elliptic.hmacDRBG({hash:this.hash,pers:options.pers,entropy:options.entropy||elliptic.rand(this.hash.hmacStrength),nonce:this.n.toArray()});var bytes=this.n.byteLength();var ns2=this.n.sub(new bn(2));do{var priv=new bn(drbg.generate(bytes));if(priv.cmp(ns2)>0)continue;priv.iaddn(1);return this.keyPair(priv)}while(true)};EC.prototype._truncateToN=function truncateToN(msg,truncOnly){var delta=msg.byteLength()*8-this.n.bitLength();if(delta>0)msg=msg.shrn(delta);if(!truncOnly&&msg.cmp(this.n)>=0)return msg.sub(this.n);else return msg};EC.prototype.sign=function sign(msg,key,options){key=this.keyPair(key,"hex");msg=this._truncateToN(new bn(msg,16));if(!options)options={};var bytes=this.n.byteLength();var bkey=key.getPrivate().toArray();for(var i=bkey.length;i<21;i++)bkey.unshift(0);var nonce=msg.toArray();for(var i=nonce.length;i<bytes;i++)nonce.unshift(0);var drbg=new elliptic.hmacDRBG({hash:this.hash,entropy:bkey,nonce:nonce});var ns1=this.n.sub(new bn(1));do{var k=new bn(drbg.generate(this.n.byteLength()));k=this._truncateToN(k,true);if(k.cmpn(1)<=0||k.cmp(ns1)>=0)continue;var kp=this.g.mul(k);if(kp.isInfinity())continue;var r=kp.getX().mod(this.n);if(r.cmpn(0)===0)continue;var s=k.invm(this.n).mul(r.mul(key.getPrivate()).iadd(msg)).mod(this.n);if(s.cmpn(0)===0)continue;if(options.canonical&&s.cmp(this.nh)>0)s=this.n.sub(s);return new Signature(r,s)}while(true)};EC.prototype.verify=function verify(msg,signature,key){msg=this._truncateToN(new bn(msg,16));key=this.keyPair(key,"hex");signature=new Signature(signature,"hex");var r=signature.r;var s=signature.s;if(r.cmpn(1)<0||r.cmp(this.n)>=0)return false;if(s.cmpn(1)<0||s.cmp(this.n)>=0)return false;var sinv=s.invm(this.n);var u1=sinv.mul(msg).mod(this.n);var u2=sinv.mul(r).mod(this.n);var p=this.g.mulAdd(u1,key.getPublic(),u2);if(p.isInfinity())return false;return p.getX().mod(this.n).cmp(r)===0}},{"../../elliptic":32,"./key":40,"./signature":41,"bn.js":30}],40:[function(require,module,exports){var bn=require("bn.js");var elliptic=require("../../elliptic");var utils=elliptic.utils;var assert=utils.assert;function KeyPair(ec,priv,pub){if(priv instanceof KeyPair)return priv;if(pub instanceof KeyPair)return pub;if(!priv){priv=pub;pub=null}if(priv!==null&&typeof priv==="object"){if(priv.x){pub=priv;priv=null}else if(priv.priv||priv.pub){pub=priv.pub;priv=priv.priv}}this.ec=ec;this.priv=null;this.pub=null;if(this._importPublicHex(priv,pub))return;if(pub==="hex")pub=null;if(priv)this._importPrivate(priv);if(pub)this._importPublic(pub)}module.exports=KeyPair;KeyPair.prototype.validate=function validate(){var pub=this.getPublic();if(pub.isInfinity())return{result:false,reason:"Invalid public key"};if(!pub.validate())return{result:false,reason:"Public key is not a point"};if(!pub.mul(this.ec.curve.n).isInfinity())return{result:false,reason:"Public key * N != O"};return{result:true,reason:null}};KeyPair.prototype.getPublic=function getPublic(compact,enc){if(!this.pub)this.pub=this.ec.g.mul(this.priv);if(typeof compact==="string"){enc=compact;compact=null}if(!enc)return this.pub;var len=this.ec.curve.p.byteLength();var x=this.pub.getX().toArray();for(var i=x.length;i<len;i++)x.unshift(0);if(compact){var res=[this.pub.getY().isEven()?2:3].concat(x)}else{var y=this.pub.getY().toArray();for(var i=y.length;i<len;i++)y.unshift(0);var res=[4].concat(x,y)}return utils.encode(res,enc)};KeyPair.prototype.getPrivate=function getPrivate(enc){if(enc==="hex")return this.priv.toString(16,2);else return this.priv};KeyPair.prototype._importPrivate=function _importPrivate(key){this.priv=new bn(key,16);this.priv=this.priv.mod(this.ec.curve.n)};KeyPair.prototype._importPublic=function _importPublic(key){this.pub=this.ec.curve.point(key.x,key.y)};KeyPair.prototype._importPublicHex=function _importPublic(key,enc){key=utils.toArray(key,enc);var len=this.ec.curve.p.byteLength();if(key[0]===4&&key.length-1===2*len){this.pub=this.ec.curve.point(key.slice(1,1+len),key.slice(1+len,1+2*len))}else if((key[0]===2||key[0]===3)&&key.length-1===len){this.pub=this.ec.curve.pointFromX(key[0]===3,key.slice(1,1+len))}else{return false}return true};KeyPair.prototype.derive=function derive(pub){return pub.mul(this.priv).getX()};KeyPair.prototype.sign=function sign(msg){return this.ec.sign(msg,this)};KeyPair.prototype.verify=function verify(msg,signature){return this.ec.verify(msg,signature,this)};KeyPair.prototype.inspect=function inspect(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},{"../../elliptic":32,"bn.js":30}],41:[function(require,module,exports){var bn=require("bn.js");var elliptic=require("../../elliptic");var utils=elliptic.utils;var assert=utils.assert;function Signature(r,s){if(r instanceof Signature)return r;if(this._importDER(r,s))return;assert(r&&s,"Signature without r or s");this.r=new bn(r,16);this.s=new bn(s,16)}module.exports=Signature;Signature.prototype._importDER=function _importDER(data,enc){data=utils.toArray(data,enc);if(data.length<6||data[0]!==48||data[2]!==2)return false;var total=data[1];if(1+total>data.length)return false;var rlen=data[3];if(rlen>=128)return false;if(4+rlen+2>=data.length)return false;if(data[4+rlen]!==2)return false;var slen=data[5+rlen];if(slen>=128)return false;if(4+rlen+2+slen>data.length)return false;this.r=new bn(data.slice(4,4+rlen));this.s=new bn(data.slice(4+rlen+2,4+rlen+2+slen));return true};Signature.prototype.toDER=function toDER(enc){var r=this.r.toArray();var s=this.s.toArray();if(r[0]&128)r=[0].concat(r);if(s[0]&128)s=[0].concat(s);var total=r.length+s.length+4;var res=[48,total,2,r.length];res=res.concat(r,[2,s.length],s);return utils.encode(res,enc)}},{"../../elliptic":32,"bn.js":30}],42:[function(require,module,exports){var hash=require("hash.js");var elliptic=require("../elliptic");var utils=elliptic.utils;var assert=utils.assert;function HmacDRBG(options){if(!(this instanceof HmacDRBG))return new HmacDRBG(options);this.hash=options.hash;this.predResist=!!options.predResist;this.outLen=this.hash.outSize;this.minEntropy=options.minEntropy||this.hash.hmacStrength;this.reseed=null;this.reseedInterval=null;this.K=null;this.V=null;var entropy=utils.toArray(options.entropy,options.entropyEnc);var nonce=utils.toArray(options.nonce,options.nonceEnc);var pers=utils.toArray(options.pers,options.persEnc);assert(entropy.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits");this._init(entropy,nonce,pers)}module.exports=HmacDRBG;HmacDRBG.prototype._init=function init(entropy,nonce,pers){var seed=entropy.concat(nonce).concat(pers);this.K=new Array(this.outLen/8);this.V=new Array(this.outLen/8);for(var i=0;i<this.V.length;i++){this.K[i]=0;this.V[i]=1}this._update(seed);this.reseed=1;this.reseedInterval=281474976710656};HmacDRBG.prototype._hmac=function hmac(){return new hash.hmac(this.hash,this.K)};HmacDRBG.prototype._update=function update(seed){var kmac=this._hmac().update(this.V).update([0]);if(seed)kmac=kmac.update(seed);this.K=kmac.digest();this.V=this._hmac().update(this.V).digest();if(!seed)return;this.K=this._hmac().update(this.V).update([1]).update(seed).digest();this.V=this._hmac().update(this.V).digest()};HmacDRBG.prototype.reseed=function reseed(entropy,entropyEnc,add,addEnc){if(typeof entropyEnc!=="string"){addEnc=add;add=entropyEnc;entropyEnc=null}entropy=utils.toBuffer(entropy,entropyEnc);add=utils.toBuffer(add,addEnc);assert(entropy.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits");this._update(entropy.concat(add||[]));this.reseed=1};HmacDRBG.prototype.generate=function generate(len,enc,add,addEnc){if(this.reseed>this.reseedInterval)throw new Error("Reseed is required");if(typeof enc!=="string"){addEnc=add;add=enc;enc=null}if(add){add=utils.toArray(add,addEnc);this._update(add)}var temp=[];while(temp.length<len){this.V=this._hmac().update(this.V).digest();temp=temp.concat(this.V)}var res=temp.slice(0,len);this._update(add);this.reseed++;return utils.encode(res,enc)}},{"../elliptic":32,"hash.js":45}],43:[function(require,module,exports){var bn=require("bn.js");var utils=exports;utils.assert=function assert(val,msg){if(!val)throw new Error(msg||"Assertion failed")};function toArray(msg,enc){if(Array.isArray(msg))return msg.slice();if(!msg)return[];var res=[];if(typeof msg==="string"){if(!enc){for(var i=0;i<msg.length;i++){var c=msg.charCodeAt(i);var hi=c>>8;var lo=c&255;if(hi)res.push(hi,lo);else res.push(lo)}}else if(enc==="hex"){msg=msg.replace(/[^a-z0-9]+/gi,"");if(msg.length%2!==0)msg="0"+msg;for(var i=0;i<msg.length;i+=2)res.push(parseInt(msg[i]+msg[i+1],16))}}else{for(var i=0;i<msg.length;i++)res[i]=msg[i]|0}return res}utils.toArray=toArray;function toHex(msg){var res="";for(var i=0;i<msg.length;i++)res+=zero2(msg[i].toString(16));return res}utils.toHex=toHex;utils.encode=function encode(arr,enc){if(enc==="hex")return toHex(arr);else return arr};function zero2(word){if(word.length===1)return"0"+word;else return word}utils.zero2=zero2;function getNAF(num,w){var naf=[];var ws=1<<w+1;var k=num.clone();while(k.cmpn(1)>=0){var z;if(k.isOdd()){var mod=k.andln(ws-1);if(mod>(ws>>1)-1)z=(ws>>1)-mod;else z=mod;k.isubn(z)}else{z=0}naf.push(z);var shift=k.cmpn(0)!==0&&k.andln(ws-1)===0?w+1:1;for(var i=1;i<shift;i++)naf.push(0);k.ishrn(shift)}return naf}utils.getNAF=getNAF;function getJSF(k1,k2){var jsf=[[],[]];k1=k1.clone();k2=k2.clone();var d1=0;var d2=0;while(k1.cmpn(-d1)>0||k2.cmpn(-d2)>0){var m14=k1.andln(3)+d1&3;var m24=k2.andln(3)+d2&3;if(m14===3)m14=-1;if(m24===3)m24=-1;var u1;if((m14&1)===0){u1=0}else{var m8=k1.andln(7)+d1&7;if((m8===3||m8===5)&&m24===2)u1=-m14;else u1=m14}jsf[0].push(u1);var u2;if((m24&1)===0){u2=0}else{var m8=k2.andln(7)+d2&7;if((m8===3||m8===5)&&m14===2)u2=-m24;else u2=m24}jsf[1].push(u2);if(2*d1===u1+1)d1=1-d1;if(2*d2===u2+1)d2=1-d2;k1.ishrn(1);k2.ishrn(1)}return jsf}utils.getJSF=getJSF},{"bn.js":30}],44:[function(require,module,exports){var r;module.exports=function rand(len){if(!r)r=new Rand(null);return r.generate(len)};function Rand(rand){this.rand=rand}module.exports.Rand=Rand;Rand.prototype.generate=function generate(len){return this._rand(len)};if(typeof window==="object"){if(window.crypto&&window.crypto.getRandomValues){Rand.prototype._rand=function _rand(n){var arr=new Uint8Array(n);window.crypto.getRandomValues(arr);return arr}}else if(window.msCrypto&&window.msCrypto.getRandomValues){Rand.prototype._rand=function _rand(n){var arr=new Uint8Array(n);window.msCrypto.getRandomValues(arr);return arr}}else{Rand.prototype._rand=function(){throw new Error("Not implemented yet")}}}else{try{var crypto=require("cry"+"pto");Rand.prototype._rand=function _rand(n){return crypto.randomBytes(n)}}catch(e){Rand.prototype._rand=function _rand(n){var res=new Uint8Array(n);for(var i=0;i<res.length;i++)res[i]=this.rand.getByte();return res}}}},{}],45:[function(require,module,exports){var hash=exports;hash.utils=require("./hash/utils");hash.common=require("./hash/common");hash.sha=require("./hash/sha");hash.ripemd=require("./hash/ripemd");hash.hmac=require("./hash/hmac");hash.sha1=hash.sha.sha1;hash.sha256=hash.sha.sha256;hash.sha224=hash.sha.sha224;hash.sha384=hash.sha.sha384;hash.sha512=hash.sha.sha512;hash.ripemd160=hash.ripemd.ripemd160},{"./hash/common":46,"./hash/hmac":47,"./hash/ripemd":48,"./hash/sha":49,"./hash/utils":50}],46:[function(require,module,exports){var hash=require("../hash");var utils=hash.utils;var assert=utils.assert;function BlockHash(){this.pending=null;this.pendingTotal=0;this.blockSize=this.constructor.blockSize;this.outSize=this.constructor.outSize;this.hmacStrength=this.constructor.hmacStrength;this.padLength=this.constructor.padLength/8;this.endian="big";this._delta8=this.blockSize/8;this._delta32=this.blockSize/32}exports.BlockHash=BlockHash;BlockHash.prototype.update=function update(msg,enc){msg=utils.toArray(msg,enc);if(!this.pending)this.pending=msg;else this.pending=this.pending.concat(msg);this.pendingTotal+=msg.length;if(this.pending.length>=this._delta8){msg=this.pending;var r=msg.length%this._delta8;this.pending=msg.slice(msg.length-r,msg.length);if(this.pending.length===0)this.pending=null;msg=utils.join32(msg,0,msg.length-r,this.endian);for(var i=0;i<msg.length;i+=this._delta32)this._update(msg,i,i+this._delta32)}return this};BlockHash.prototype.digest=function digest(enc){this.update(this._pad());assert(this.pending===null);return this._digest(enc)};BlockHash.prototype._pad=function pad(){var len=this.pendingTotal;var bytes=this._delta8;var k=bytes-(len+this.padLength)%bytes;var res=new Array(k+this.padLength);res[0]=128;for(var i=1;i<k;i++)res[i]=0;len<<=3;if(this.endian==="big"){for(var t=8;t<this.padLength;t++)res[i++]=0;res[i++]=0;res[i++]=0;res[i++]=0;res[i++]=0;res[i++]=len>>>24&255;res[i++]=len>>>16&255;res[i++]=len>>>8&255;res[i++]=len&255}else{res[i++]=len&255;res[i++]=len>>>8&255;res[i++]=len>>>16&255;res[i++]=len>>>24&255;res[i++]=0;res[i++]=0;res[i++]=0;res[i++]=0;for(var t=8;t<this.padLength;t++)res[i++]=0}return res}},{"../hash":45}],47:[function(require,module,exports){var hmac=exports;var hash=require("../hash");var utils=hash.utils;var assert=utils.assert;function Hmac(hash,key,enc){if(!(this instanceof Hmac))return new Hmac(hash,key,enc);this.Hash=hash;this.blockSize=hash.blockSize/8;this.outSize=hash.outSize/8;this.inner=null;this.outer=null;this._init(utils.toArray(key,enc))}module.exports=Hmac;Hmac.prototype._init=function init(key){if(key.length>this.blockSize)key=(new this.Hash).update(key).digest();assert(key.length<=this.blockSize);for(var i=key.length;i<this.blockSize;i++)key.push(0);for(var i=0;i<key.length;i++)key[i]^=54;this.inner=(new this.Hash).update(key);for(var i=0;i<key.length;i++)key[i]^=106;this.outer=(new this.Hash).update(key)};Hmac.prototype.update=function update(msg,enc){this.inner.update(msg,enc);return this};Hmac.prototype.digest=function digest(enc){this.outer.update(this.inner.digest());return this.outer.digest(enc)}},{"../hash":45}],48:[function(require,module,exports){var hash=require("../hash");var utils=hash.utils;var rotl32=utils.rotl32;var sum32=utils.sum32;var sum32_3=utils.sum32_3;var sum32_4=utils.sum32_4;var BlockHash=hash.common.BlockHash;function RIPEMD160(){if(!(this instanceof RIPEMD160))return new RIPEMD160;BlockHash.call(this);this.h=[1732584193,4023233417,2562383102,271733878,3285377520];this.endian="little"}utils.inherits(RIPEMD160,BlockHash);exports.ripemd160=RIPEMD160;RIPEMD160.blockSize=512;RIPEMD160.outSize=160;RIPEMD160.hmacStrength=192;RIPEMD160.padLength=64;RIPEMD160.prototype._update=function update(msg,start){var A=this.h[0];var B=this.h[1];var C=this.h[2];var D=this.h[3];var E=this.h[4];var Ah=A;var Bh=B;var Ch=C;var Dh=D;var Eh=E;for(var j=0;j<80;j++){var T=sum32(rotl32(sum32_4(A,f(j,B,C,D),msg[r[j]+start],K(j)),s[j]),E);A=E;E=D;D=rotl32(C,10);C=B;B=T;T=sum32(rotl32(sum32_4(Ah,f(79-j,Bh,Ch,Dh),msg[rh[j]+start],Kh(j)),sh[j]),Eh);Ah=Eh;Eh=Dh;Dh=rotl32(Ch,10);Ch=Bh;Bh=T}T=sum32_3(this.h[1],C,Dh);this.h[1]=sum32_3(this.h[2],D,Eh);this.h[2]=sum32_3(this.h[3],E,Ah);this.h[3]=sum32_3(this.h[4],A,Bh);this.h[4]=sum32_3(this.h[0],B,Ch);this.h[0]=T};RIPEMD160.prototype._digest=function digest(enc){if(enc==="hex")return utils.toHex32(this.h,"little");else return utils.split32(this.h,"little")};function f(j,x,y,z){if(j<=15)return x^y^z;else if(j<=31)return x&y|~x&z;else if(j<=47)return(x|~y)^z;else if(j<=63)return x&z|y&~z;else return x^(y|~z)}function K(j){if(j<=15)return 0;else if(j<=31)return 1518500249;else if(j<=47)return 1859775393;else if(j<=63)return 2400959708;else return 2840853838}function Kh(j){if(j<=15)return 1352829926;else if(j<=31)return 1548603684;else if(j<=47)return 1836072691;else if(j<=63)return 2053994217;else return 0}var r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13];var rh=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11];var s=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6];var sh=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},{"../hash":45}],49:[function(require,module,exports){var hash=require("../hash");var utils=hash.utils;var assert=utils.assert;var rotr32=utils.rotr32;var rotl32=utils.rotl32;var sum32=utils.sum32;var sum32_4=utils.sum32_4;var sum32_5=utils.sum32_5;var rotr64_hi=utils.rotr64_hi;var rotr64_lo=utils.rotr64_lo;var shr64_hi=utils.shr64_hi;var shr64_lo=utils.shr64_lo;var sum64=utils.sum64;var sum64_hi=utils.sum64_hi;var sum64_lo=utils.sum64_lo;var sum64_4_hi=utils.sum64_4_hi;var sum64_4_lo=utils.sum64_4_lo;var sum64_5_hi=utils.sum64_5_hi;var sum64_5_lo=utils.sum64_5_lo;var BlockHash=hash.common.BlockHash;var sha256_K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];var sha512_K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];var sha1_K=[1518500249,1859775393,2400959708,3395469782];function SHA256(){if(!(this instanceof SHA256))return new SHA256;BlockHash.call(this);this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];this.k=sha256_K;this.W=new Array(64)}utils.inherits(SHA256,BlockHash);exports.sha256=SHA256;SHA256.blockSize=512;SHA256.outSize=256;SHA256.hmacStrength=192;SHA256.padLength=64;SHA256.prototype._update=function _update(msg,start){var W=this.W;for(var i=0;i<16;i++)W[i]=msg[start+i];for(;i<W.length;i++)W[i]=sum32_4(g1_256(W[i-2]),W[i-7],g0_256(W[i-15]),W[i-16]);var a=this.h[0];var b=this.h[1];var c=this.h[2];var d=this.h[3];var e=this.h[4];var f=this.h[5];var g=this.h[6];var h=this.h[7];assert(this.k.length===W.length);for(var i=0;i<W.length;i++){var T1=sum32_5(h,s1_256(e),ch32(e,f,g),this.k[i],W[i]);var T2=sum32(s0_256(a),maj32(a,b,c));h=g;g=f;f=e;e=sum32(d,T1);d=c;c=b;b=a;a=sum32(T1,T2)}this.h[0]=sum32(this.h[0],a);this.h[1]=sum32(this.h[1],b);this.h[2]=sum32(this.h[2],c);this.h[3]=sum32(this.h[3],d);this.h[4]=sum32(this.h[4],e);this.h[5]=sum32(this.h[5],f);this.h[6]=sum32(this.h[6],g);this.h[7]=sum32(this.h[7],h)};SHA256.prototype._digest=function digest(enc){if(enc==="hex")return utils.toHex32(this.h,"big");else return utils.split32(this.h,"big")};function SHA224(){if(!(this instanceof SHA224))return new SHA224;SHA256.call(this);this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}utils.inherits(SHA224,SHA256);exports.sha224=SHA224;SHA224.blockSize=512;SHA224.outSize=224;SHA224.hmacStrength=192;SHA224.padLength=64;SHA224.prototype._digest=function digest(enc){if(enc==="hex")return utils.toHex32(this.h.slice(0,7),"big");else return utils.split32(this.h.slice(0,7),"big")};function SHA512(){if(!(this instanceof SHA512))return new SHA512;BlockHash.call(this);this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209];this.k=sha512_K;this.W=new Array(160)}utils.inherits(SHA512,BlockHash);exports.sha512=SHA512;SHA512.blockSize=1024;SHA512.outSize=512;SHA512.hmacStrength=192;SHA512.padLength=128;SHA512.prototype._prepareBlock=function _prepareBlock(msg,start){var W=this.W;for(var i=0;i<32;i++)W[i]=msg[start+i];for(;i<W.length;i+=2){var c0_hi=g1_512_hi(W[i-4],W[i-3]);var c0_lo=g1_512_lo(W[i-4],W[i-3]);var c1_hi=W[i-14];var c1_lo=W[i-13];var c2_hi=g0_512_hi(W[i-30],W[i-29]);var c2_lo=g0_512_lo(W[i-30],W[i-29]);var c3_hi=W[i-32];var c3_lo=W[i-31];W[i]=sum64_4_hi(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo);W[i+1]=sum64_4_lo(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo)}};SHA512.prototype._update=function _update(msg,start){this._prepareBlock(msg,start);var W=this.W;var ah=this.h[0];var al=this.h[1];var bh=this.h[2];var bl=this.h[3];var ch=this.h[4];var cl=this.h[5];var dh=this.h[6];var dl=this.h[7];var eh=this.h[8];var el=this.h[9];var fh=this.h[10];var fl=this.h[11];var gh=this.h[12];var gl=this.h[13];var hh=this.h[14];var hl=this.h[15];assert(this.k.length===W.length);for(var i=0;i<W.length;i+=2){var c0_hi=hh;var c0_lo=hl;var c1_hi=s1_512_hi(eh,el);var c1_lo=s1_512_lo(eh,el);var c2_hi=ch64_hi(eh,el,fh,fl,gh,gl);var c2_lo=ch64_lo(eh,el,fh,fl,gh,gl);var c3_hi=this.k[i];var c3_lo=this.k[i+1];var c4_hi=W[i];var c4_lo=W[i+1];var T1_hi=sum64_5_hi(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo,c4_hi,c4_lo);var T1_lo=sum64_5_lo(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo,c4_hi,c4_lo);var c0_hi=s0_512_hi(ah,al);var c0_lo=s0_512_lo(ah,al);var c1_hi=maj64_hi(ah,al,bh,bl,ch,cl);var c1_lo=maj64_lo(ah,al,bh,bl,ch,cl);var T2_hi=sum64_hi(c0_hi,c0_lo,c1_hi,c1_lo);var T2_lo=sum64_lo(c0_hi,c0_lo,c1_hi,c1_lo);hh=gh;hl=gl;gh=fh;gl=fl;fh=eh;fl=el;eh=sum64_hi(dh,dl,T1_hi,T1_lo);el=sum64_lo(dl,dl,T1_hi,T1_lo);dh=ch;dl=cl;ch=bh;cl=bl;bh=ah;bl=al;ah=sum64_hi(T1_hi,T1_lo,T2_hi,T2_lo);al=sum64_lo(T1_hi,T1_lo,T2_hi,T2_lo)}sum64(this.h,0,ah,al);sum64(this.h,2,bh,bl);sum64(this.h,4,ch,cl);sum64(this.h,6,dh,dl);sum64(this.h,8,eh,el);sum64(this.h,10,fh,fl);sum64(this.h,12,gh,gl);sum64(this.h,14,hh,hl)};SHA512.prototype._digest=function digest(enc){if(enc==="hex")return utils.toHex32(this.h,"big");else return utils.split32(this.h,"big")};function SHA384(){if(!(this instanceof SHA384))return new SHA384;SHA512.call(this);this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}utils.inherits(SHA384,SHA512);exports.sha384=SHA384;SHA384.blockSize=1024;SHA384.outSize=384;SHA384.hmacStrength=192;SHA384.padLength=128;SHA384.prototype._digest=function digest(enc){if(enc==="hex")return utils.toHex32(this.h.slice(0,12),"big");else return utils.split32(this.h.slice(0,12),"big")};function SHA1(){if(!(this instanceof SHA1))return new SHA1;BlockHash.call(this);this.h=[1732584193,4023233417,2562383102,271733878,3285377520];this.W=new Array(80)}utils.inherits(SHA1,BlockHash);exports.sha1=SHA1;SHA1.blockSize=512;SHA1.outSize=160;SHA1.hmacStrength=80;SHA1.padLength=64;SHA1.prototype._update=function _update(msg,start){var W=this.W;for(var i=0;i<16;i++)W[i]=msg[start+i];for(;i<W.length;i++)W[i]=rotl32(W[i-3]^W[i-8]^W[i-14]^W[i-16],1);var a=this.h[0];var b=this.h[1];var c=this.h[2];var d=this.h[3];var e=this.h[4];for(var i=0;i<W.length;i++){var s=~~(i/20);var t=sum32_5(rotl32(a,5),ft_1(s,b,c,d),e,W[i],sha1_K[s]);e=d;d=c;c=rotl32(b,30);b=a;a=t}this.h[0]=sum32(this.h[0],a);this.h[1]=sum32(this.h[1],b);this.h[2]=sum32(this.h[2],c);this.h[3]=sum32(this.h[3],d);this.h[4]=sum32(this.h[4],e)};SHA1.prototype._digest=function digest(enc){if(enc==="hex")return utils.toHex32(this.h,"big");else return utils.split32(this.h,"big")};function ch32(x,y,z){return x&y^~x&z}function maj32(x,y,z){return x&y^x&z^y&z}function p32(x,y,z){return x^y^z}function s0_256(x){return rotr32(x,2)^rotr32(x,13)^rotr32(x,22)}function s1_256(x){return rotr32(x,6)^rotr32(x,11)^rotr32(x,25)}function g0_256(x){return rotr32(x,7)^rotr32(x,18)^x>>>3}function g1_256(x){return rotr32(x,17)^rotr32(x,19)^x>>>10}function ft_1(s,x,y,z){if(s===0)return ch32(x,y,z);if(s===1||s===3)return p32(x,y,z);if(s===2)return maj32(x,y,z)}function ch64_hi(xh,xl,yh,yl,zh,zl){var r=xh&yh^~xh&zh;if(r<0)r+=4294967296;return r}function ch64_lo(xh,xl,yh,yl,zh,zl){var r=xl&yl^~xl&zl;if(r<0)r+=4294967296;return r}function maj64_hi(xh,xl,yh,yl,zh,zl){var r=xh&yh^xh&zh^yh&zh;if(r<0)r+=4294967296;return r}function maj64_lo(xh,xl,yh,yl,zh,zl){var r=xl&yl^xl&zl^yl&zl;if(r<0)r+=4294967296;return r}function s0_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,28);var c1_hi=rotr64_hi(xl,xh,2);var c2_hi=rotr64_hi(xl,xh,7);var r=c0_hi^c1_hi^c2_hi;if(r<0)r+=4294967296;return r}function s0_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,28);var c1_lo=rotr64_lo(xl,xh,2);var c2_lo=rotr64_lo(xl,xh,7);var r=c0_lo^c1_lo^c2_lo;if(r<0)r+=4294967296;return r}function s1_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,14);var c1_hi=rotr64_hi(xh,xl,18);var c2_hi=rotr64_hi(xl,xh,9);var r=c0_hi^c1_hi^c2_hi;if(r<0)r+=4294967296;return r}function s1_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,14);var c1_lo=rotr64_lo(xh,xl,18);var c2_lo=rotr64_lo(xl,xh,9);var r=c0_lo^c1_lo^c2_lo;if(r<0)r+=4294967296;return r}function g0_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,1);var c1_hi=rotr64_hi(xh,xl,8);var c2_hi=shr64_hi(xh,xl,7);var r=c0_hi^c1_hi^c2_hi;if(r<0)r+=4294967296;return r}function g0_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,1);var c1_lo=rotr64_lo(xh,xl,8);var c2_lo=shr64_lo(xh,xl,7);var r=c0_lo^c1_lo^c2_lo;if(r<0)r+=4294967296;return r}function g1_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,19);var c1_hi=rotr64_hi(xl,xh,29);var c2_hi=shr64_hi(xh,xl,6);var r=c0_hi^c1_hi^c2_hi;if(r<0)r+=4294967296;return r}function g1_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,19);var c1_lo=rotr64_lo(xl,xh,29);var c2_lo=shr64_lo(xh,xl,6);var r=c0_lo^c1_lo^c2_lo;if(r<0)r+=4294967296;return r}},{"../hash":45}],50:[function(require,module,exports){var utils=exports;var inherits=require("inherits");function toArray(msg,enc){if(Array.isArray(msg))return msg.slice();if(!msg)return[];var res=[];if(typeof msg==="string"){if(!enc){for(var i=0;i<msg.length;i++){var c=msg.charCodeAt(i);var hi=c>>8;var lo=c&255;if(hi)res.push(hi,lo);else res.push(lo)}}else if(enc==="hex"){msg=msg.replace(/[^a-z0-9]+/gi,"");if(msg.length%2!==0)msg="0"+msg;for(var i=0;i<msg.length;i+=2)res.push(parseInt(msg[i]+msg[i+1],16))}}else{for(var i=0;i<msg.length;i++)res[i]=msg[i]|0}return res}utils.toArray=toArray;function toHex(msg){var res="";for(var i=0;i<msg.length;i++)res+=zero2(msg[i].toString(16));return res}utils.toHex=toHex;function htonl(w){var res=w>>>24|w>>>8&65280|w<<8&16711680|(w&255)<<24;return res>>>0}utils.htonl=htonl;function toHex32(msg,endian){var res="";for(var i=0;i<msg.length;i++){var w=msg[i];if(endian==="little")w=htonl(w);res+=zero8(w.toString(16))}return res}utils.toHex32=toHex32;function zero2(word){if(word.length===1)return"0"+word;else return word}utils.zero2=zero2;function zero8(word){if(word.length===7)return"0"+word;else if(word.length===6)return"00"+word;else if(word.length===5)return"000"+word;else if(word.length===4)return"0000"+word;else if(word.length===3)return"00000"+word;else if(word.length===2)return"000000"+word;else if(word.length===1)return"0000000"+word;else return word}utils.zero8=zero8;function join32(msg,start,end,endian){var len=end-start;assert(len%4===0);var res=new Array(len/4);for(var i=0,k=start;i<res.length;i++,k+=4){var w;if(endian==="big")w=msg[k]<<24|msg[k+1]<<16|msg[k+2]<<8|msg[k+3];else w=msg[k+3]<<24|msg[k+2]<<16|msg[k+1]<<8|msg[k];res[i]=w>>>0}return res}utils.join32=join32;function split32(msg,endian){var res=new Array(msg.length*4);for(var i=0,k=0;i<msg.length;i++,k+=4){var m=msg[i];if(endian==="big"){res[k]=m>>>24;res[k+1]=m>>>16&255;res[k+2]=m>>>8&255;res[k+3]=m&255}else{res[k+3]=m>>>24;res[k+2]=m>>>16&255;res[k+1]=m>>>8&255;res[k]=m&255}}return res}utils.split32=split32;function rotr32(w,b){return w>>>b|w<<32-b}utils.rotr32=rotr32;function rotl32(w,b){return w<<b|w>>>32-b}utils.rotl32=rotl32;function sum32(a,b){return a+b>>>0}utils.sum32=sum32;function sum32_3(a,b,c){return a+b+c>>>0}utils.sum32_3=sum32_3;function sum32_4(a,b,c,d){return a+b+c+d>>>0}utils.sum32_4=sum32_4;function sum32_5(a,b,c,d,e){return a+b+c+d+e>>>0}utils.sum32_5=sum32_5;function assert(cond,msg){if(!cond)throw new Error(msg||"Assertion failed")}utils.assert=assert;utils.inherits=inherits;function sum64(buf,pos,ah,al){var bh=buf[pos];var bl=buf[pos+1];var lo=al+bl>>>0;var hi=(lo<al?1:0)+ah+bh;buf[pos]=hi>>>0;buf[pos+1]=lo}exports.sum64=sum64;function sum64_hi(ah,al,bh,bl){var lo=al+bl>>>0;var hi=(lo<al?1:0)+ah+bh;return hi>>>0}exports.sum64_hi=sum64_hi;function sum64_lo(ah,al,bh,bl){var lo=al+bl;return lo>>>0}exports.sum64_lo=sum64_lo;function sum64_4_hi(ah,al,bh,bl,ch,cl,dh,dl){var carry=0;var lo=al;lo=lo+bl>>>0;carry+=lo<al?1:0;lo=lo+cl>>>0;carry+=lo<cl?1:0;lo=lo+dl>>>0;carry+=lo<dl?1:0;var hi=ah+bh+ch+dh+carry;return hi>>>0}exports.sum64_4_hi=sum64_4_hi;function sum64_4_lo(ah,al,bh,bl,ch,cl,dh,dl){var lo=al+bl+cl+dl;return lo>>>0}exports.sum64_4_lo=sum64_4_lo;function sum64_5_hi(ah,al,bh,bl,ch,cl,dh,dl,eh,el){var carry=0;var lo=al;lo=lo+bl>>>0;carry+=lo<al?1:0;lo=lo+cl>>>0;carry+=lo<cl?1:0;lo=lo+dl>>>0;carry+=lo<dl?1:0;lo=lo+el>>>0;carry+=lo<el?1:0;var hi=ah+bh+ch+dh+eh+carry;return hi>>>0}exports.sum64_5_hi=sum64_5_hi;
function sum64_5_lo(ah,al,bh,bl,ch,cl,dh,dl,eh,el){var lo=al+bl+cl+dl+el;return lo>>>0}exports.sum64_5_lo=sum64_5_lo;function rotr64_hi(ah,al,num){var r=al<<32-num|ah>>>num;return r>>>0}exports.rotr64_hi=rotr64_hi;function rotr64_lo(ah,al,num){var r=ah<<32-num|al>>>num;return r>>>0}exports.rotr64_lo=rotr64_lo;function shr64_hi(ah,al,num){return ah>>>num}exports.shr64_hi=shr64_hi;function shr64_lo(ah,al,num){var r=ah<<32-num|al>>>num;return r>>>0}exports.shr64_lo=shr64_lo},{inherits:146}],51:[function(require,module,exports){module.exports={name:"elliptic",version:"1.0.1",description:"EC cryptography",main:"lib/elliptic.js",scripts:{test:"mocha --reporter=spec test/*-test.js"},repository:{type:"git",url:"git@github.com:indutny/elliptic"},keywords:["EC","Elliptic","curve","Cryptography"],author:{name:"Fedor Indutny",email:"fedor@indutny.com"},license:"MIT",bugs:{url:"https://github.com/indutny/elliptic/issues"},homepage:"https://github.com/indutny/elliptic",devDependencies:{browserify:"^3.44.2",mocha:"^1.18.2","uglify-js":"^2.4.13"},dependencies:{"bn.js":"^1.0.0",brorand:"^1.0.1","hash.js":"^1.0.0",inherits:"^2.0.1"},readme:"# Elliptic [![Build Status](https://secure.travis-ci.org/indutny/elliptic.png)](http://travis-ci.org/indutny/elliptic)\n\nFast elliptic-curve cryptography in a plain javascript implementation.\n\nNOTE: Please take a look at http://safecurves.cr.yp.to/ before choosing a curve\nfor your cryptography operations.\n\n## Incentive\n\nECC is much slower than regular RSA cryptography, the JS implementations are\neven more slower.\n\n## Benchmarks\n\n```bash\n$ node benchmarks/index.js\nBenchmarking: sign\nelliptic#sign x 262 ops/sec ±0.51% (177 runs sampled)\neccjs#sign x 55.91 ops/sec ±0.90% (144 runs sampled)\n------------------------\nFastest is elliptic#sign\n========================\nBenchmarking: verify\nelliptic#verify x 113 ops/sec ±0.50% (166 runs sampled)\neccjs#verify x 48.56 ops/sec ±0.36% (125 runs sampled)\n------------------------\nFastest is elliptic#verify\n========================\nBenchmarking: gen\nelliptic#gen x 294 ops/sec ±0.43% (176 runs sampled)\neccjs#gen x 62.25 ops/sec ±0.63% (129 runs sampled)\n------------------------\nFastest is elliptic#gen\n========================\nBenchmarking: ecdh\nelliptic#ecdh x 136 ops/sec ±0.85% (156 runs sampled)\n------------------------\nFastest is elliptic#ecdh\n========================\n```\n\n## API\n\n### ECDSA\n\n```javascript\nvar EC = require('elliptic').ec;\n\n// Create and initialize EC context\n// (better do it once and reuse it)\nvar ec = new EC('secp256k1');\n\n// Generate keys\nvar key = ec.genKeyPair();\n\n// Sign message (must be an array, or it'll be treated as a hex sequence)\nvar msg = [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ];\nvar signature = key.sign(msg);\n\n// Export DER encoded signature in Array\nvar derSign = signature.toDER();\n\n// Verify signature\nconsole.log(key.verify(msg, derSign));\n```\n\n### ECDH\n\n```javascript\n// Generate keys\nvar key1 = ec.genKeyPair();\nvar key2 = ec.genKeyPair();\n\nvar shared1 = key1.derive(key2.getPublic());\nvar shared2 = key2.derive(key1.getPublic());\n\nconsole.log('Both shared secrets are BN instances');\nconsole.log(shared1.toString(16));\nconsole.log(shared2.toString(16));\n```\n\nNOTE: `.derive()` returns a [BN][1] instance.\n\n## Supported curves\n\nElliptic.js support following curve types:\n\n* Short Weierstrass\n* Montgomery\n* Edwards\n* Twisted Edwards\n\nFollowing curve 'presets' are embedded into the library:\n\n* `secp256k1`\n* `p192`\n* `p224`\n* `p256`\n* `curve25519`\n* `ed25519`\n\nNOTE: That `curve25519` could not be used for ECDSA, use `ed25519` instead.\n\n### Implementation details\n\nECDSA is using deterministic `k` value generation as per [RFC6979][0]. Most of\nthe curve operations are performed on non-affine coordinates (either projective\nor extended), various windowing techniques are used for different cases.\n\nAll operations are performed in reduction context using [bn.js][1], hashing is\nprovided by [hash.js][2]\n\n#### LICENSE\n\nThis software is licensed under the MIT License.\n\nCopyright Fedor Indutny, 2014.\n\nPermission is hereby granted, free of charge, to any person obtaining a\ncopy of this software and associated documentation files (the\n\"Software\"), to deal in the Software without restriction, including\nwithout limitation the rights to use, copy, modify, merge, publish,\ndistribute, sublicense, and/or sell copies of the Software, and to permit\npersons to whom the Software is furnished to do so, subject to the\nfollowing conditions:\n\nThe above copyright notice and this permission notice shall be included\nin all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\nOR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\nMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\nNO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\nDAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\nOTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\nUSE OR OTHER DEALINGS IN THE SOFTWARE.\n\n[0]: http://tools.ietf.org/html/rfc6979\n[1]: https://github.com/indutny/bn.js\n[2]: https://github.com/indutny/hash.js\n",readmeFilename:"README.md",_id:"elliptic@1.0.1",_from:"elliptic@^1.0.0"}},{}],52:[function(require,module,exports){(function(Buffer){module.exports=function evp(crypto,password,salt,keyLen){keyLen=keyLen/8;var ki=0;var ii=0;var key=new Buffer(keyLen);var addmd=0;var md,md_buf;var i;while(true){md=crypto.createHash("md5");if(addmd++>0){md.update(md_buf)}md.update(password);md.update(salt);md_buf=md.digest();i=0;if(keyLen>0){while(true){if(keyLen===0){break}if(i===md_buf.length){break}key[ki++]=md_buf[i++];keyLen--}}if(keyLen===0){break}}for(i=0;i<md_buf.length;i++){md_buf[i]=0}return key}}).call(this,require("buffer").Buffer)},{buffer:5}],53:[function(require,module,exports){module.exports={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}},{}],54:[function(require,module,exports){var asn1=require("asn1.js");var rfc3280=require("asn1.js-rfc3280");var RSAPrivateKey=asn1.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())});exports.RSAPrivateKey=RSAPrivateKey;var RSAPublicKey=asn1.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())});exports.RSAPublicKey=RSAPublicKey;var PublicKey=rfc3280.SubjectPublicKeyInfo;exports.PublicKey=PublicKey;var ECPublicKey=asn1.define("ECPublicKey",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("curve").objid()),this.key("subjectPrivateKey").bitstr())});exports.ECPublicKey=ECPublicKey;var ECPrivateWrap=asn1.define("ECPrivateWrap",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").seq().obj(this.key("id").objid(),this.key("curve").objid()),this.key("subjectPrivateKey").octstr())});exports.ECPrivateWrap=ECPrivateWrap;var PrivateKeyInfo=asn1.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(rfc3280.AlgorithmIdentifier),this.key("subjectPrivateKey").octstr())});exports.PrivateKey=PrivateKeyInfo;var EncryptedPrivateKeyInfo=asn1.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())});var dsaParams=asn1.define("dsaParams",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()))});exports.EncryptedPrivateKey=EncryptedPrivateKeyInfo;var DSAPublicKey=asn1.define("DSAPublicKey",function(){this.seq().obj(this.key("algorithm").use(dsaParams),this.key("subjectPublicKey").bitstr())});exports.DSAPublicKey=DSAPublicKey;var DSAPrivateWrap=asn1.define("DSAPrivateWrap",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").seq().obj(this.key("id").objid(),this.key("parameters").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int())),this.key("subjectPrivateKey").octstr())});exports.DSAPrivateWrap=DSAPrivateWrap;var DSAPrivateKey=asn1.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())});exports.DSAPrivateKey=DSAPrivateKey;exports.DSAparam=asn1.define("DSAparam",function(){this.int()});var ECPrivateKey=asn1.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(ECParameters),this.key("publicKey").optional().explicit(1).bitstr())});exports.ECPrivateKey=ECPrivateKey;var ECParameters=asn1.define("ECParameters",function(){this.choice({namedCurve:this.objid()})});var ECPrivateKey2=asn1.define("ECPrivateKey2",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("publicKey").seq().obj(this.key("key").bitstr()))});exports.ECPrivateKey2=ECPrivateKey2;exports.signature=asn1.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())})},{"asn1.js":58,"asn1.js-rfc3280":57}],55:[function(require,module,exports){(function(Buffer){var findProc=/Proc-Type: 4,ENCRYPTED\n\r?DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)\n\r?\n\r?([0-9A-z\n\r\+\/\=]+)\n\r?/m;var startRegex=/^-----BEGIN (.*)-----\n/;var evp=require("./EVP_BytesToKey");module.exports=function(okey,password,crypto){var key=okey.toString();var match=key.match(findProc);if(!match){return okey}var suite="aes"+match[1];var iv=new Buffer(match[2],"hex");var cipherText=new Buffer(match[3].replace(/\n\r?/g,""),"base64");var cipherKey=evp(crypto,password,iv.slice(0,8),parseInt(match[1]));var out=[];var cipher=crypto.createDecipheriv(suite,cipherKey,iv);out.push(cipher.update(cipherText));out.push(cipher.final());var decrypted=Buffer.concat(out).toString("base64");var tag=key.match(startRegex)[1];return"-----BEGIN "+tag+"-----\n"+wrap(decrypted)+"\n"+"-----END "+tag+"-----\n"};function wrap(str){var chunks=[];while(str){if(str.length<64){chunks.push(str);break}else{chunks.push(str.slice(0,64));str=str.slice(64)}}return chunks.join("\n")}}).call(this,require("buffer").Buffer)},{"./EVP_BytesToKey":52,buffer:5}],56:[function(require,module,exports){(function(Buffer){var pemstrip=require("pemstrip");var asn1=require("./asn1");var aesid=require("./aesid.json");var fixProc=require("./fixProc");module.exports=parseKeys;function parseKeys(buffer,crypto){var password;if(typeof buffer==="object"&&!Buffer.isBuffer(buffer)){password=buffer.passphrase;buffer=buffer.key}if(typeof buffer==="string"){buffer=new Buffer(buffer)}if(password){buffer=fixProc(buffer,password,crypto)}var stripped=pemstrip.strip(buffer);var type=stripped.tag;var data=new Buffer(stripped.base64,"base64");var subtype,ndata;switch(type){case"PUBLIC KEY":ndata=asn1.PublicKey.decode(data,"der");subtype=ndata.algorithm.algorithm.join(".");switch(subtype){case"1.2.840.113549.1.1.1":return asn1.RSAPublicKey.decode(ndata.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return{type:"ec",data:asn1.ECPublicKey.decode(data,"der")};case"1.2.840.10040.4.1":ndata=asn1.DSAPublicKey.decode(data,"der");ndata.algorithm.parameters.pub_key=asn1.DSAparam.decode(ndata.subjectPublicKey.data,"der");return{type:"dsa",data:ndata.algorithm.parameters};default:throw new Error("unknown key id "+subtype)}throw new Error("unknown key type "+type);case"ENCRYPTED PRIVATE KEY":data=asn1.EncryptedPrivateKey.decode(data,"der");data=decrypt(crypto,data,password);case"PRIVATE KEY":ndata=asn1.PrivateKey.decode(data,"der");subtype=ndata.algorithm.algorithm.join(".");switch(subtype){case"1.2.840.113549.1.1.1":return asn1.RSAPrivateKey.decode(ndata.subjectPrivateKey,"der");case"1.2.840.10045.2.1":ndata=asn1.ECPrivateWrap.decode(data,"der");return{curve:ndata.algorithm.curve,privateKey:asn1.ECPrivateKey.decode(ndata.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":ndata=asn1.DSAPrivateWrap.decode(data,"der");ndata.algorithm.parameters.priv_key=asn1.DSAparam.decode(ndata.subjectPrivateKey,"der");return{type:"dsa",params:ndata.algorithm.parameters};default:throw new Error("unknown key id "+subtype)}throw new Error("unknown key type "+type);case"RSA PUBLIC KEY":return asn1.RSAPublicKey.decode(data,"der");case"RSA PRIVATE KEY":return asn1.RSAPrivateKey.decode(data,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:asn1.DSAPrivateKey.decode(data,"der")};case"EC PRIVATE KEY":data=asn1.ECPrivateKey.decode(data,"der");return{curve:data.parameters.value,privateKey:data.privateKey};default:throw new Error("unknown key type "+type)}}parseKeys.signature=asn1.signature;function decrypt(crypto,data,password){var salt=data.algorithm.decrypt.kde.kdeparams.salt;var iters=data.algorithm.decrypt.kde.kdeparams.iters;var algo=aesid[data.algorithm.decrypt.cipher.algo.join(".")];var iv=data.algorithm.decrypt.cipher.iv;var cipherText=data.subjectPrivateKey;var keylen=parseInt(algo.split("-")[1],10)/8;var key=crypto.pbkdf2Sync(password,salt,iters,keylen);var cipher=crypto.createDecipheriv(algo,key,iv);var out=[];out.push(cipher.update(cipherText));out.push(cipher.final());return Buffer.concat(out)}}).call(this,require("buffer").Buffer)},{"./aesid.json":53,"./asn1":54,"./fixProc":55,buffer:5,pemstrip:71}],57:[function(require,module,exports){try{var asn1=require("asn1.js")}catch(e){var asn1=require("../"+"..")}var CRLReason=asn1.define("CRLReason",function(){this.enum({0:"unspecified",1:"keyCompromise",2:"CACompromise",3:"affiliationChanged",4:"superseded",5:"cessationOfOperation",6:"certificateHold",8:"removeFromCRL",9:"privilegeWithdrawn",10:"AACompromise"})});exports.CRLReason=CRLReason;var AlgorithmIdentifier=asn1.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional().any())});exports.AlgorithmIdentifier=AlgorithmIdentifier;var Certificate=asn1.define("Certificate",function(){this.seq().obj(this.key("tbsCertificate").use(TBSCertificate),this.key("signatureAlgorithm").use(AlgorithmIdentifier),this.key("signature").bitstr())});exports.Certificate=Certificate;var TBSCertificate=asn1.define("TBSCertificate",function(){this.seq().obj(this.key("version").def("v1").explicit(0).use(Version),this.key("serialNumber").use(CertificateSerialNumber),this.key("signature").use(AlgorithmIdentifier),this.key("issuer").use(Name),this.key("validity").use(Validity),this.key("subject").use(Name),this.key("subjectPublicKeyInfo").use(SubjectPublicKeyInfo),this.key("issuerUniqueID").optional().explicit(1).use(UniqueIdentifier),this.key("subjectUniqueID").optional().explicit(2).use(UniqueIdentifier),this.key("extensions").optional().explicit(3).use(Extensions))});exports.TBSCertificate=TBSCertificate;var Version=asn1.define("Version",function(){this.int({0:"v1",1:"v2",2:"v3"})});exports.Version=Version;var CertificateSerialNumber=asn1.define("CertificateSerialNumber",function(){this.int()});exports.CertificateSerialNumber=CertificateSerialNumber;var Validity=asn1.define("Validity",function(){this.seq().obj(this.key("notBefore").use(Time),this.key("notAfter").use(Time))});exports.Validity=Validity;var Time=asn1.define("Time",function(){this.choice({utcTime:this.utctime(),genTime:this.gentime()})});exports.Time=Time;var UniqueIdentifier=asn1.define("UniqueIdentifier",function(){this.bitstr()});exports.UniqueIdentifier=UniqueIdentifier;var SubjectPublicKeyInfo=asn1.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(AlgorithmIdentifier),this.key("subjectPublicKey").bitstr())});exports.SubjectPublicKeyInfo=SubjectPublicKeyInfo;var Extensions=asn1.define("Extensions",function(){this.seqof(Extension)});exports.Extensions=Extensions;var Extension=asn1.define("Extension",function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(false),this.key("extnValue").octstr())});exports.Extension=Extension;var Name=asn1.define("Name",function(){this.choice({rdn:this.use(RDNSequence)})});exports.Name=Name;var RDNSequence=asn1.define("RDNSequence",function(){this.seqof(RelativeDistinguishedName)});exports.RDNSequence=RDNSequence;var RelativeDistinguishedName=asn1.define("RelativeDistinguishedName",function(){this.setof(AttributeTypeAndValue)});exports.RelativeDistinguishedName=RelativeDistinguishedName;var AttributeTypeAndValue=asn1.define("AttributeTypeAndValue",function(){this.seq().obj(this.key("type").use(AttributeType),this.key("value").use(AttributeValue))});exports.AttributeTypeAndValue=AttributeTypeAndValue;var AttributeType=asn1.define("AttributeType",function(){this.objid()});exports.AttributeType=AttributeType;var AttributeValue=asn1.define("AttributeValue",function(){this.any()});exports.AttributeValue=AttributeValue},{"asn1.js":58}],58:[function(require,module,exports){var asn1=exports;asn1.bignum=require("bn.js");asn1.define=require("./asn1/api").define;asn1.base=require("./asn1/base");asn1.constants=require("./asn1/constants");asn1.decoders=require("./asn1/decoders");asn1.encoders=require("./asn1/encoders")},{"./asn1/api":59,"./asn1/base":61,"./asn1/constants":65,"./asn1/decoders":67,"./asn1/encoders":69,"bn.js":30}],59:[function(require,module,exports){var asn1=require("../asn1");var inherits=require("inherits");var vm=require("vm");var api=exports;api.define=function define(name,body){return new Entity(name,body)};function Entity(name,body){this.name=name;this.body=body;this.decoders={};this.encoders={}}Entity.prototype._createNamed=function createNamed(base){var named=vm.runInThisContext("(function "+this.name+"(entity) {\n"+"  this._initNamed(entity);\n"+"})");inherits(named,base);named.prototype._initNamed=function initnamed(entity){base.call(this,entity)};return new named(this)};Entity.prototype._getDecoder=function _getDecoder(enc){if(!this.decoders.hasOwnProperty(enc))this.decoders[enc]=this._createNamed(asn1.decoders[enc]);return this.decoders[enc]};Entity.prototype.decode=function decode(data,enc,options){return this._getDecoder(enc).decode(data,options)};Entity.prototype._getEncoder=function _getEncoder(enc){if(!this.encoders.hasOwnProperty(enc))this.encoders[enc]=this._createNamed(asn1.encoders[enc]);return this.encoders[enc]};Entity.prototype.encode=function encode(data,enc,reporter){return this._getEncoder(enc).encode(data,reporter)}},{"../asn1":58,inherits:146,vm:166}],60:[function(require,module,exports){var inherits=require("inherits");var Reporter=require("../base").Reporter;var Buffer=require("buffer").Buffer;function DecoderBuffer(base,options){Reporter.call(this,options);if(!Buffer.isBuffer(base)){this.error("Input not Buffer");return}this.base=base;this.offset=0;this.length=base.length}inherits(DecoderBuffer,Reporter);exports.DecoderBuffer=DecoderBuffer;DecoderBuffer.prototype.save=function save(){return{offset:this.offset}};DecoderBuffer.prototype.restore=function restore(save){var res=new DecoderBuffer(this.base);res.offset=save.offset;res.length=this.offset;this.offset=save.offset;return res};DecoderBuffer.prototype.isEmpty=function isEmpty(){return this.offset===this.length};DecoderBuffer.prototype.readUInt8=function readUInt8(fail){if(this.offset+1<=this.length)return this.base.readUInt8(this.offset++,true);else return this.error(fail||"DecoderBuffer overrun")};DecoderBuffer.prototype.skip=function skip(bytes,fail){if(!(this.offset+bytes<=this.length))return this.error(fail||"DecoderBuffer overrun");var res=new DecoderBuffer(this.base);res._reporterState=this._reporterState;res.offset=this.offset;res.length=this.offset+bytes;this.offset+=bytes;return res};DecoderBuffer.prototype.raw=function raw(save){return this.base.slice(save?save.offset:this.offset,this.length)};function EncoderBuffer(value,reporter){if(Array.isArray(value)){this.length=0;this.value=value.map(function(item){if(!(item instanceof EncoderBuffer))item=new EncoderBuffer(item,reporter);this.length+=item.length;return item},this)}else if(typeof value==="number"){if(!(0<=value&&value<=255))return reporter.error("non-byte EncoderBuffer value");this.value=value;this.length=1}else if(typeof value==="string"){this.value=value;this.length=Buffer.byteLength(value)}else if(Buffer.isBuffer(value)){this.value=value;this.length=value.length}else{return reporter.error("Unsupported type: "+typeof value)}}exports.EncoderBuffer=EncoderBuffer;EncoderBuffer.prototype.join=function join(out,offset){if(!out)out=new Buffer(this.length);if(!offset)offset=0;if(this.length===0)return out;if(Array.isArray(this.value)){this.value.forEach(function(item){item.join(out,offset);offset+=item.length})}else{if(typeof this.value==="number")out[offset]=this.value;else if(typeof this.value==="string")out.write(this.value,offset);else if(Buffer.isBuffer(this.value))this.value.copy(out,offset);offset+=this.length}return out}},{"../base":61,buffer:5,inherits:146}],61:[function(require,module,exports){var base=exports;base.Reporter=require("./reporter").Reporter;base.DecoderBuffer=require("./buffer").DecoderBuffer;base.EncoderBuffer=require("./buffer").EncoderBuffer;base.Node=require("./node")},{"./buffer":60,"./node":62,"./reporter":63}],62:[function(require,module,exports){var Reporter=require("../base").Reporter;var EncoderBuffer=require("../base").EncoderBuffer;var assert=require("minimalistic-assert");var tags=["seq","seqof","set","setof","octstr","bitstr","objid","bool","gentime","utctime","null_","enum","int","ia5str"];var methods=["key","obj","use","optional","explicit","implicit","def","choice","any"].concat(tags);var overrided=["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"];function Node(enc,parent){var state={};this._baseState=state;state.enc=enc;state.parent=parent||null;state.children=null;state.tag=null;state.args=null;state.reverseArgs=null;state.choice=null;state.optional=false;state.any=false;state.obj=false;state.use=null;state.useDecoder=null;state.key=null;state["default"]=null;state.explicit=null;state.implicit=null;if(!state.parent){state.children=[];this._wrap()}}module.exports=Node;var stateProps=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit"];Node.prototype.clone=function clone(){var state=this._baseState;var cstate={};stateProps.forEach(function(prop){cstate[prop]=state[prop]});var res=new this.constructor(cstate.parent);res._baseState=cstate;return res};Node.prototype._wrap=function wrap(){var state=this._baseState;methods.forEach(function(method){this[method]=function _wrappedMethod(){var clone=new this.constructor(this);state.children.push(clone);return clone[method].apply(clone,arguments)}},this)};Node.prototype._init=function init(body){var state=this._baseState;assert(state.parent===null);body.call(this);state.children=state.children.filter(function(child){return child._baseState.parent===this},this);assert.equal(state.children.length,1,"Root node can have only one child")};Node.prototype._useArgs=function useArgs(args){var state=this._baseState;var children=args.filter(function(arg){return arg instanceof this.constructor},this);args=args.filter(function(arg){return!(arg instanceof this.constructor)},this);if(children.length!==0){assert(state.children===null);state.children=children;children.forEach(function(child){child._baseState.parent=this},this)}if(args.length!==0){assert(state.args===null);state.args=args;state.reverseArgs=args.map(function(arg){if(typeof arg!=="object"||arg.constructor!==Object)return arg;var res={};Object.keys(arg).forEach(function(key){if(key==(key|0))key|=0;var value=arg[key];res[value]=key});return res})}};overrided.forEach(function(method){Node.prototype[method]=function _overrided(){var state=this._baseState;throw new Error(method+" not implemented for encoding: "+state.enc)}});tags.forEach(function(tag){Node.prototype[tag]=function _tagMethod(){var state=this._baseState;var args=Array.prototype.slice.call(arguments);assert(state.tag===null);state.tag=tag;this._useArgs(args);return this}});Node.prototype.use=function use(item){var state=this._baseState;assert(state.use===null);state.use=item;return this};Node.prototype.optional=function optional(){var state=this._baseState;state.optional=true;return this};Node.prototype.def=function def(val){var state=this._baseState;assert(state["default"]===null);state["default"]=val;state.optional=true;return this};Node.prototype.explicit=function explicit(num){var state=this._baseState;assert(state.explicit===null&&state.implicit===null);state.explicit=num;return this};Node.prototype.implicit=function implicit(num){var state=this._baseState;assert(state.explicit===null&&state.implicit===null);state.implicit=num;return this};Node.prototype.obj=function obj(){var state=this._baseState;var args=Array.prototype.slice.call(arguments);state.obj=true;if(args.length!==0)this._useArgs(args);return this};Node.prototype.key=function key(newKey){var state=this._baseState;assert(state.key===null);state.key=newKey;return this};Node.prototype.any=function any(){var state=this._baseState;state.any=true;return this};Node.prototype.choice=function choice(obj){var state=this._baseState;assert(state.choice===null);state.choice=obj;this._useArgs(Object.keys(obj).map(function(key){return obj[key]}));return this};Node.prototype._decode=function decode(input){var state=this._baseState;if(state.parent===null)return input.wrapResult(state.children[0]._decode(input));var result=state["default"];var present=true;var prevKey;if(state.key!==null)prevKey=input.enterKey(state.key);if(state.optional){present=this._peekTag(input,state.explicit!==null?state.explicit:state.implicit!==null?state.implicit:state.tag||0);if(input.isError(present))return present}var prevObj;if(state.obj&&present)prevObj=input.enterObject();if(present){if(state.explicit!==null){var explicit=this._decodeTag(input,state.explicit);if(input.isError(explicit))return explicit;input=explicit}if(state.use===null&&state.choice===null){if(state.any)var save=input.save();var body=this._decodeTag(input,state.implicit!==null?state.implicit:state.tag,state.any);if(input.isError(body))return body;if(state.any)result=input.raw(save);else input=body}if(state.any)result=result;else if(state.choice===null)result=this._decodeGeneric(state.tag,input);else result=this._decodeChoice(input);if(input.isError(result))return result;if(!state.any&&state.choice===null&&state.children!==null){var fail=state.children.some(function decodeChildren(child){child._decode(input)});if(fail)return err}}if(state.obj&&present)result=input.leaveObject(prevObj);if(state.key!==null&&(result!==null||present===true))input.leaveKey(prevKey,state.key,result);return result};Node.prototype._decodeGeneric=function decodeGeneric(tag,input){var state=this._baseState;if(tag==="seq"||tag==="set")return null;if(tag==="seqof"||tag==="setof")return this._decodeList(input,tag,state.args[0]);else if(tag==="octstr"||tag==="bitstr"||tag==="ia5str")return this._decodeStr(input,tag);else if(tag==="objid"&&state.args)return this._decodeObjid(input,state.args[0],state.args[1]);else if(tag==="objid")return this._decodeObjid(input,null,null);else if(tag==="gentime"||tag==="utctime")return this._decodeTime(input,tag);else if(tag==="null_")return this._decodeNull(input);else if(tag==="bool")return this._decodeBool(input);else if(tag==="int"||tag==="enum")return this._decodeInt(input,state.args&&state.args[0]);else if(state.use!==null)return this._getUse(state.use,input._reporterState.obj)._decode(input);else return input.error("unknown tag: "+tag);return null};Node.prototype._getUse=function _getUse(entity,obj){var state=this._baseState;state.useDecoder=this._use(entity,obj);assert(state.useDecoder._baseState.parent===null);state.useDecoder=state.useDecoder._baseState.children[0];if(state.implicit!==state.useDecoder._baseState.implicit){state.useDecoder=state.useDecoder.clone();state.useDecoder._baseState.implicit=state.implicit}return state.useDecoder};Node.prototype._decodeChoice=function decodeChoice(input){var state=this._baseState;var result=null;var match=false;Object.keys(state.choice).some(function(key){var save=input.save();var node=state.choice[key];try{var value=node._decode(input);if(input.isError(value))return false;result={type:key,value:value};match=true}catch(e){input.restore(save);return false}return true},this);if(!match)return input.error("Choice not matched");return result};Node.prototype._createEncoderBuffer=function createEncoderBuffer(data){return new EncoderBuffer(data,this.reporter)};Node.prototype._encode=function encode(data,reporter,parent){var state=this._baseState;if(state["default"]!==null&&state["default"]===data)return;var result=this._encodeValue(data,reporter,parent);if(result===undefined)return;if(this._skipDefault(result,reporter,parent))return;return result};Node.prototype._encodeValue=function encode(data,reporter,parent){var state=this._baseState;if(state.parent===null)return state.children[0]._encode(data,reporter||new Reporter);var result=null;var present=true;this.reporter=reporter;if(state.optional&&data===undefined){if(state["default"]!==null)data=state["default"];else return}var prevKey;var content=null;var primitive=false;if(state.any){result=this._createEncoderBuffer(data)}else if(state.choice){result=this._encodeChoice(data,reporter)}else if(state.children){content=state.children.map(function(child){if(child._baseState.tag==="null_")return child._encode(null,reporter,data);if(child._baseState.key===null)return reporter.error("Child should have a key");var prevKey=reporter.enterKey(child._baseState.key);if(typeof data!=="object")return reporter.error("Child expected, but input is not object");var res=child._encode(data[child._baseState.key],reporter,data);reporter.leaveKey(prevKey);return res},this).filter(function(child){return child});content=this._createEncoderBuffer(content)}else{if(state.tag==="seqof"||state.tag==="setof"){if(!(state.args&&state.args.length===1))return reporter.error("Too many args for : "+state.tag);if(!Array.isArray(data))return reporter.error("seqof/setof, but data is not Array");var child=this.clone();child._baseState.implicit=null;content=this._createEncoderBuffer(data.map(function(item){var state=this._baseState;return this._getUse(state.args[0],data)._encode(item,reporter)},child))}else if(state.use!==null){result=this._getUse(state.use,parent)._encode(data,reporter)}else{content=this._encodePrimitive(state.tag,data);primitive=true}}var result;if(!state.any&&state.choice===null){var tag=state.implicit!==null?state.implicit:state.tag;var cls=state.implicit===null?"universal":"context";if(tag===null){if(state.use===null)reporter.error("Tag could be ommited only for .use()")}else{if(state.use===null)result=this._encodeComposite(tag,primitive,cls,content)
}}if(state.explicit!==null)result=this._encodeComposite(state.explicit,false,"context",result);return result};Node.prototype._encodeChoice=function encodeChoice(data,reporter){var state=this._baseState;var node=state.choice[data.type];if(!node){assert(false,data.type+" not found in "+JSON.stringify(Object.keys(state.choice)))}return node._encode(data.value,reporter)};Node.prototype._encodePrimitive=function encodePrimitive(tag,data){var state=this._baseState;if(tag==="octstr"||tag==="bitstr"||tag==="ia5str")return this._encodeStr(data,tag);else if(tag==="objid"&&state.args)return this._encodeObjid(data,state.reverseArgs[0],state.args[1]);else if(tag==="objid")return this._encodeObjid(data,null,null);else if(tag==="gentime"||tag==="utctime")return this._encodeTime(data,tag);else if(tag==="null_")return this._encodeNull();else if(tag==="int"||tag==="enum")return this._encodeInt(data,state.args&&state.reverseArgs[0]);else if(tag==="bool")return this._encodeBool(data);else throw new Error("Unsupported tag: "+tag)}},{"../base":61,"minimalistic-assert":70}],63:[function(require,module,exports){var inherits=require("inherits");function Reporter(options){this._reporterState={obj:null,path:[],options:options||{},errors:[]}}exports.Reporter=Reporter;Reporter.prototype.isError=function isError(obj){return obj instanceof ReporterError};Reporter.prototype.enterKey=function enterKey(key){return this._reporterState.path.push(key)};Reporter.prototype.leaveKey=function leaveKey(index,key,value){var state=this._reporterState;state.path=state.path.slice(0,index-1);if(state.obj!==null)state.obj[key]=value};Reporter.prototype.enterObject=function enterObject(){var state=this._reporterState;var prev=state.obj;state.obj={};return prev};Reporter.prototype.leaveObject=function leaveObject(prev){var state=this._reporterState;var now=state.obj;state.obj=prev;return now};Reporter.prototype.error=function error(msg){var err;var state=this._reporterState;var inherited=msg instanceof ReporterError;if(inherited){err=msg}else{err=new ReporterError(state.path.map(function(elem){return"["+JSON.stringify(elem)+"]"}).join(""),msg.message||msg,msg.stack)}if(!state.options.partial)throw err;if(!inherited)state.errors.push(err);return err};Reporter.prototype.wrapResult=function wrapResult(result){var state=this._reporterState;if(!state.options.partial)return result;return{result:this.isError(result)?null:result,errors:state.errors}};function ReporterError(path,msg){this.path=path;this.rethrow(msg)}inherits(ReporterError,Error);ReporterError.prototype.rethrow=function rethrow(msg){this.message=msg+" at: "+(this.path||"(shallow)");Error.captureStackTrace(this,ReporterError);return this}},{inherits:146}],64:[function(require,module,exports){var constants=require("../constants");exports.tagClass={0:"universal",1:"application",2:"context",3:"private"};exports.tagClassByName=constants._reverse(exports.tagClass);exports.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"};exports.tagByName=constants._reverse(exports.tag)},{"../constants":65}],65:[function(require,module,exports){var constants=exports;constants._reverse=function reverse(map){var res={};Object.keys(map).forEach(function(key){if((key|0)==key)key=key|0;var value=map[key];res[value]=key});return res};constants.der=require("./der")},{"./der":64}],66:[function(require,module,exports){var inherits=require("inherits");var asn1=require("../../asn1");var base=asn1.base;var bignum=asn1.bignum;var der=asn1.constants.der;function DERDecoder(entity){this.enc="der";this.name=entity.name;this.entity=entity;this.tree=new DERNode;this.tree._init(entity.body)}module.exports=DERDecoder;DERDecoder.prototype.decode=function decode(data,options){if(!(data instanceof base.DecoderBuffer))data=new base.DecoderBuffer(data,options);return this.tree._decode(data,options)};function DERNode(parent){base.Node.call(this,"der",parent)}inherits(DERNode,base.Node);DERNode.prototype._peekTag=function peekTag(buffer,tag){if(buffer.isEmpty())return false;var state=buffer.save();var decodedTag=derDecodeTag(buffer,'Failed to peek tag: "'+tag+'"');if(buffer.isError(decodedTag))return decodedTag;buffer.restore(state);return decodedTag.tag===tag||decodedTag.tagStr===tag};DERNode.prototype._decodeTag=function decodeTag(buffer,tag,any){var decodedTag=derDecodeTag(buffer,'Failed to decode tag of "'+tag+'"');if(buffer.isError(decodedTag))return decodedTag;var len=derDecodeLen(buffer,decodedTag.primitive,'Failed to get length of "'+tag+'"');if(buffer.isError(len))return len;if(!any&&decodedTag.tag!==tag&&decodedTag.tagStr!==tag&&decodedTag.tagStr+"of"!==tag){return buffer.error('Failed to match tag: "'+tag+'"')}if(decodedTag.primitive||len!==null)return buffer.skip(len,'Failed to match body of: "'+tag+'"');var state=buffer.start();var res=this._skipUntilEnd(buffer,'Failed to skip indefinite length body: "'+this.tag+'"');if(buffer.isError(res))return res;return buffer.cut(state)};DERNode.prototype._skipUntilEnd=function skipUntilEnd(buffer,fail){while(true){var tag=derDecodeTag(buffer,fail);if(buffer.isError(tag))return tag;var len=derDecodeLen(buffer,tag.primitive,fail);if(buffer.isError(len))return len;var res;if(tag.primitive||len!==null)res=buffer.skip(len);else res=this._skipUntilEnd(buffer,fail);if(buffer.isError(res))return res;if(tag.tagStr==="end")break}};DERNode.prototype._decodeList=function decodeList(buffer,tag,decoder){var result=[];while(!buffer.isEmpty()){var possibleEnd=this._peekTag(buffer,"end");if(buffer.isError(possibleEnd))return possibleEnd;var res=decoder.decode(buffer,"der");if(buffer.isError(res)&&possibleEnd)break;result.push(res)}return result};DERNode.prototype._decodeStr=function decodeStr(buffer,tag){if(tag==="octstr"){return buffer.raw()}else if(tag==="bitstr"){var unused=buffer.readUInt8();if(buffer.isError(unused))return unused;return{unused:unused,data:buffer.raw()}}else if(tag==="ia5str"){return buffer.raw().toString()}else{return this.error("Decoding of string type: "+tag+" unsupported")}};DERNode.prototype._decodeObjid=function decodeObjid(buffer,values,relative){var identifiers=[];var ident=0;while(!buffer.isEmpty()){var subident=buffer.readUInt8();ident<<=7;ident|=subident&127;if((subident&128)===0){identifiers.push(ident);ident=0}}if(subident&128)identifiers.push(ident);var first=identifiers[0]/40|0;var second=identifiers[0]%40;if(relative)result=identifiers;else result=[first,second].concat(identifiers.slice(1));if(values)result=values[result.join(" ")];return result};DERNode.prototype._decodeTime=function decodeTime(buffer,tag){var str=buffer.raw().toString();if(tag==="gentime"){var year=str.slice(0,4)|0;var mon=str.slice(4,6)|0;var day=str.slice(6,8)|0;var hour=str.slice(8,10)|0;var min=str.slice(10,12)|0;var sec=str.slice(12,14)|0}else if(tag==="utctime"){var year=str.slice(0,2)|0;var mon=str.slice(2,4)|0;var day=str.slice(4,6)|0;var hour=str.slice(6,8)|0;var min=str.slice(8,10)|0;var sec=str.slice(10,12)|0;if(year<70)year=2e3+year;else year=1900+year}else{return this.error("Decoding "+tag+" time is not supported yet")}return Date.UTC(year,mon-1,day,hour,min,sec,0)};DERNode.prototype._decodeNull=function decodeNull(buffer){return null};DERNode.prototype._decodeBool=function decodeBool(buffer){var res=buffer.readUInt8();if(buffer.isError(res))return res;else return res!==0};DERNode.prototype._decodeInt=function decodeInt(buffer,values){var res=0;var raw=buffer.raw();if(raw.length>3)return new bignum(raw);while(!buffer.isEmpty()){res<<=8;var i=buffer.readUInt8();if(buffer.isError(i))return i;res|=i}if(values)res=values[res]||res;return res};DERNode.prototype._use=function use(entity,obj){if(typeof entity==="function")entity=entity(obj);return entity._getDecoder("der").tree};function derDecodeTag(buf,fail){var tag=buf.readUInt8(fail);if(buf.isError(tag))return tag;var cls=der.tagClass[tag>>6];var primitive=(tag&32)===0;if((tag&31)===31){var oct=tag;tag=0;while((oct&128)===128){oct=buf.readUInt8(fail);if(buf.isError(oct))return oct;tag<<=7;tag|=oct&127}}else{tag&=31}var tagStr=der.tag[tag];return{cls:cls,primitive:primitive,tag:tag,tagStr:tagStr}}function derDecodeLen(buf,primitive,fail){var len=buf.readUInt8(fail);if(buf.isError(len))return len;if(!primitive&&len===128)return null;if((len&128)===0){return len}var num=len&127;if(num>=4)return buf.error("length octect is too long");len=0;for(var i=0;i<num;i++){len<<=8;var j=buf.readUInt8(fail);if(buf.isError(j))return j;len|=j}return len}},{"../../asn1":58,inherits:146}],67:[function(require,module,exports){var decoders=exports;decoders.der=require("./der")},{"./der":66}],68:[function(require,module,exports){var inherits=require("inherits");var Buffer=require("buffer").Buffer;var asn1=require("../../asn1");var base=asn1.base;var bignum=asn1.bignum;var der=asn1.constants.der;function DEREncoder(entity){this.enc="der";this.name=entity.name;this.entity=entity;this.tree=new DERNode;this.tree._init(entity.body)}module.exports=DEREncoder;DEREncoder.prototype.encode=function encode(data,reporter){return this.tree._encode(data,reporter).join()};function DERNode(parent){base.Node.call(this,"der",parent)}inherits(DERNode,base.Node);DERNode.prototype._encodeComposite=function encodeComposite(tag,primitive,cls,content){var encodedTag=encodeTag(tag,primitive,cls,this.reporter);if(content.length<128){var header=new Buffer(2);header[0]=encodedTag;header[1]=content.length;return this._createEncoderBuffer([header,content])}var lenOctets=1;for(var i=content.length;i>=256;i>>=8)lenOctets++;var header=new Buffer(1+1+lenOctets);header[0]=encodedTag;header[1]=128|lenOctets;for(var i=1+lenOctets,j=content.length;j>0;i--,j>>=8)header[i]=j&255;return this._createEncoderBuffer([header,content])};DERNode.prototype._encodeStr=function encodeStr(str,tag){if(tag==="octstr")return this._createEncoderBuffer(str);else if(tag==="bitstr")return this._createEncoderBuffer([str.unused|0,str.data]);else if(tag==="ia5str")return this._createEncoderBuffer(str);return this.reporter.error("Encoding of string type: "+tag+" unsupported")};DERNode.prototype._encodeObjid=function encodeObjid(id,values,relative){if(typeof id==="string"){if(!values)return this.reporter.error("string objid given, but no values map found");if(!values.hasOwnProperty(id))return this.reporter.error("objid not found in values map");id=values[id].split(/\s+/g);for(var i=0;i<id.length;i++)id[i]|=0}else if(Array.isArray(id)){id=id.slice()}if(!Array.isArray(id)){return this.reporter.error("objid() should be either array or string, "+"got: "+JSON.stringify(id))}if(!relative){if(id[1]>=40)return this.reporter.error("Second objid identifier OOB");id.splice(0,2,id[0]*40+id[1])}var size=0;for(var i=0;i<id.length;i++){var ident=id[i];for(size++;ident>=128;ident>>=7)size++}var objid=new Buffer(size);var offset=objid.length-1;for(var i=id.length-1;i>=0;i--){var ident=id[i];objid[offset--]=ident&127;while((ident>>=7)>0)objid[offset--]=128|ident&127}return this._createEncoderBuffer(objid)};function two(num){if(num<=10)return"0"+num;else return num}DERNode.prototype._encodeTime=function encodeTime(time,tag){var str;var date=new Date(time);if(tag==="gentime"){str=[date.getFullYear(),two(date.getUTCMonth()+1),two(date.getUTCDate()),two(date.getUTCHours()),two(date.getUTCMinutes()),two(date.getUTCSeconds()),"Z"].join("")}else if(tag==="utctime"){str=[date.getFullYear()%100,two(date.getUTCMonth()+1),two(date.getUTCDate()),two(date.getUTCHours()),two(date.getUTCMinutes()),two(date.getUTCSeconds()),"Z"].join("")}else{this.reporter.error("Encoding "+tag+" time is not supported yet")}return this._encodeStr(str,"octstr")};DERNode.prototype._encodeNull=function encodeNull(){return this._createEncoderBuffer("")};DERNode.prototype._encodeInt=function encodeInt(num,values){if(typeof num==="string"){if(!values)return this.reporter.error("String int or enum given, but no values map");if(!values.hasOwnProperty(num)){return this.reporter.error("Values map doesn't contain: "+JSON.stringify(num))}num=values[num]}if(bignum!==null&&num instanceof bignum){var numArray=num.toArray();if(num.sign===false&&numArray[0]&128){numArray.unshift(0)}num=new Buffer(numArray)}if(Buffer.isBuffer(num)){var size=num.length;if(num.length===0)size++;var out=new Buffer(size);num.copy(out);if(num.length===0)out[0]=0;return this._createEncoderBuffer(out)}if(num<128)return this._createEncoderBuffer(num);if(num<256)return this._createEncoderBuffer([0,num]);var size=1;for(var i=num;i>=256;i>>=8)size++;var out=new Array(size);for(var i=out.length-1;i>=0;i--){out[i]=num&255;num>>=8}if(out[0]&128){out.unshift(0)}return this._createEncoderBuffer(new Buffer(out))};DERNode.prototype._encodeBool=function encodeBool(value){return this._createEncoderBuffer(value?255:0)};DERNode.prototype._use=function use(entity,obj){if(typeof entity==="function")entity=entity(obj);return entity._getEncoder("der").tree};DERNode.prototype._skipDefault=function skipDefault(dataBuffer,reporter,parent){var state=this._baseState;var i;if(state["default"]===null)return false;var data=dataBuffer.join();if(state.defaultBuffer===undefined)state.defaultBuffer=this._encodeValue(state["default"],reporter,parent).join();if(data.length!==state.defaultBuffer.length)return false;for(i=0;i<data.length;i++)if(data[i]!==state.defaultBuffer[i])return false;return true};function encodeTag(tag,primitive,cls,reporter){var res;if(tag==="seqof")tag="seq";else if(tag==="setof")tag="set";if(der.tagByName.hasOwnProperty(tag))res=der.tagByName[tag];else if(typeof tag==="number"&&(tag|0)===tag)res=tag;else return reporter.error("Unknown tag: "+tag);if(res>=31)return reporter.error("Multi-octet tag encoding unsupported");if(!primitive)res|=32;res|=der.tagClassByName[cls||"universal"]<<6;return res}},{"../../asn1":58,buffer:5,inherits:146}],69:[function(require,module,exports){var encoders=exports;encoders.der=require("./der")},{"./der":68}],70:[function(require,module,exports){module.exports=assert;function assert(val,msg){if(!val)throw new Error(msg||"Assertion failed")}assert.equal=function assertEqual(l,r,msg){if(l!=r)throw new Error(msg||"Assertion failed: "+l+" != "+r)}},{}],71:[function(require,module,exports){exports.strip=function strip(artifact){artifact=artifact.toString();var startRegex=/^-----BEGIN (.*)-----\n/;var match=startRegex.exec(artifact);var tag=match[1];var endRegex=new RegExp("\n-----END "+tag+"-----(\n*)$");var base64=artifact.slice(match[0].length).replace(endRegex,"").replace(/\n/g,"");return{tag:tag,base64:base64}};var wrap=function wrap(str,l){var chunks=[];while(str){if(str.length<l){chunks.push(str);break}else{chunks.push(str.substr(0,l));str=str.substr(l)}}return chunks.join("\n")};exports.assemble=function assemble(info){var tag=info.tag;var base64=info.base64;var startLine="-----BEGIN "+tag+"-----";var endLine="-----END "+tag+"-----";return startLine+"\n"+wrap(base64,64)+"\n"+endLine+"\n"}},{}],72:[function(require,module,exports){(function(Buffer){var parseKeys=require("parse-asn1");var bn=require("bn.js");var elliptic=require("elliptic");var crt=require("browserify-rsa");module.exports=sign;function sign(hash,key,hashType,crypto){var priv=parseKeys(key,crypto);if(priv.curve){return ecSign(hash,priv,crypto)}else if(priv.type==="dsa"){return dsaSign(hash,priv,hashType,crypto)}var len=priv.modulus.byteLength();var pad=[0,1];while(hash.length+pad.length+1<len){pad.push(255)}pad.push(0);var i=-1;while(++i<hash.length){pad.push(hash[i])}var out=crt(pad,priv,crypto);return out}function ecSign(hash,priv,crypto){elliptic.rand=crypto.randomBytes;var curve;if(priv.curve.join(".")==="1.3.132.0.10"){curve=new elliptic.ec("secp256k1")}var key=curve.genKeyPair();key._importPrivate(priv.privateKey);var out=key.sign(hash);return new Buffer(out.toDER())}function dsaSign(hash,priv,algo,crypto){var x=priv.params.priv_key;var p=priv.params.p;var q=priv.params.q;var montq=bn.mont(q);var g=priv.params.g;var r=new bn(0);var k;var H=bits2int(hash,q).mod(q);var s=false;var kv=getKay(x,q,hash,algo,crypto);while(s===false){k=makeKey(q,kv,algo,crypto);r=makeR(g,k,p,q);s=k.invm(q).imul(H.add(x.mul(r))).mod(q);if(!s.cmpn(0)){s=false;r=new bn(0)}}return toDER(r,s)}function toDER(r,s){r=r.toArray();s=s.toArray();if(r[0]&128)r=[0].concat(r);if(s[0]&128)s=[0].concat(s);var total=r.length+s.length+4;var res=[48,total,2,r.length];res=res.concat(r,[2,s.length],s);return new Buffer(res)}module.exports.getKay=getKay;function getKay(x,q,hash,algo,crypto){x=new Buffer(x.toArray());if(x.length<q.byteLength()){var zeros=new Buffer(q.byteLength()-x.length);zeros.fill(0);x=Buffer.concat([zeros,x])}var hlen=hash.length;var hbits=bits2octets(hash,q);var v=new Buffer(hlen);v.fill(1);var k=new Buffer(hlen);k.fill(0);k=crypto.createHmac(algo,k).update(v).update(new Buffer([0])).update(x).update(hbits).digest();v=crypto.createHmac(algo,k).update(v).digest();k=crypto.createHmac(algo,k).update(v).update(new Buffer([1])).update(x).update(hbits).digest();v=crypto.createHmac(algo,k).update(v).digest();return{k:k,v:v}}function bits2int(obits,q){bits=new bn(obits);var shift=obits.length*8-q.bitLength();if(shift>0){bits.ishrn(shift)}return bits}function bits2octets(bits,q){bits=bits2int(bits,q);bits=bits.mod(q);var out=new Buffer(bits.toArray());if(out.length<q.byteLength()){var zeros=new Buffer(q.byteLength()-out.length);zeros.fill(0);out=Buffer.concat([zeros,out])}return out}module.exports.makeKey=makeKey;function makeKey(q,kv,algo,crypto){var t;var k;while(true){t=new Buffer("");while(t.length*8<q.bitLength()){kv.v=crypto.createHmac(algo,kv.k).update(kv.v).digest();t=Buffer.concat([t,kv.v])}k=bits2int(t,q);kv.k=crypto.createHmac(algo,kv.k).update(kv.v).update(new Buffer([0])).digest();kv.v=crypto.createHmac(algo,kv.k).update(kv.v).digest();if(k.cmp(q)===-1){return k}}}function makeR(g,k,p,q){return g.toRed(bn.mont(p)).redPow(k).fromRed().mod(q)}}).call(this,require("buffer").Buffer)},{"bn.js":30,"browserify-rsa":31,buffer:5,elliptic:32,"parse-asn1":56}],73:[function(require,module,exports){(function(Buffer){var parseKeys=require("parse-asn1");var elliptic=require("elliptic");var bn=require("bn.js");module.exports=verify;function verify(sig,hash,key){var pub=parseKeys(key);if(pub.type==="ec"){return ecVerify(sig,hash,pub)}else if(pub.type==="dsa"){return dsaVerify(sig,hash,pub)}var len=pub.modulus.byteLength();var pad=[0,1];while(hash.length+pad.length+1<len){pad.push(255)}pad.push(0);var i=-1;while(++i<hash.length){pad.push(hash[i])}pad=hash;var red=bn.mont(pub.modulus);sig=new bn(sig).toRed(red);sig=sig.redPow(new bn(pub.publicExponent));sig=new Buffer(sig.fromRed().toArray());sig=sig.slice(sig.length-hash.length);var out=0;len=sig.length;i=-1;while(++i<len){out+=sig[i]^hash[i]}return!out}function ecVerify(sig,hash,pub){var curve;if(pub.data.algorithm.curve.join(".")==="1.3.132.0.10"){curve=new elliptic.ec("secp256k1")}var pubkey=pub.data.subjectPrivateKey.data;return curve.verify(hash.toString("hex"),sig.toString("hex"),pubkey.toString("hex"))}function dsaVerify(sig,hash,pub){var p=pub.data.p;var q=pub.data.q;var g=pub.data.g;var y=pub.data.pub_key;var unpacked=parseKeys.signature.decode(sig,"der");var s=unpacked.s;var r=unpacked.r;checkValue(s,q);checkValue(r,q);var montq=bn.mont(q);var montp=bn.mont(p);var w=s.invm(q);var v=g.toRed(montp).redPow(new bn(hash).mul(w).mod(q)).fromRed().mul(y.toRed(montp).redPow(r.mul(w).mod(q)).fromRed()).mod(p).mod(q);return!v.cmp(r)}function checkValue(b,q){if(b.cmpn(0)<=0){throw new Error("invalid sig")}if(b.cmp(q)>=q){throw new Error("invalid sig")}}}).call(this,require("buffer").Buffer)},{"bn.js":30,buffer:5,elliptic:32,"parse-asn1":56}],74:[function(require,module,exports){(function(Buffer){var elliptic=require("elliptic");var BN=require("bn.js");module.exports=ECDH;function ECDH(curve,crypto){elliptic.rand=crypto.randomBytes;this.curve=new elliptic.ec(curve);this.keys=void 0}ECDH.prototype.generateKeys=function(enc,format){this.keys=this.curve.genKeyPair();return this.getPublicKey(enc,format)};ECDH.prototype.computeSecret=function(other,inenc,enc){inenc=inenc||"utf8";if(!Buffer.isBuffer(other)){other=new Buffer(other,inenc)}other=new BN(other);other=other.toString(16);var otherPub=this.curve.keyPair(other,"hex").getPublic();var out=otherPub.mul(this.keys.getPrivate()).getX();return returnValue(out,enc)};ECDH.prototype.getPublicKey=function(enc,format){var key=this.keys.getPublic(format==="compressed",true);if(format==="hybrid"){if(key[key.length-1]%2){key[0]=7}else{key[0]=6}}return returnValue(key,enc)};ECDH.prototype.getPrivateKey=function(enc){return returnValue(this.keys.getPrivate(),enc)};ECDH.prototype.setPublicKey=function(pub,enc){enc=enc||"utf8";if(!Buffer.isBuffer(pub)){pub=new Buffer(pub,enc)}var pkey=new BN(pub);pkey=pkey.toArray();this.keys._importPublicHex(pkey)};ECDH.prototype.setPrivateKey=function(priv,enc){enc=enc||"utf8";if(!Buffer.isBuffer(priv)){priv=new Buffer(priv,enc)}var _priv=new BN(priv);_priv=_priv.toString(16);this.keys._importPrivate(_priv)};function returnValue(bn,enc){if(!Array.isArray(bn)){bn=bn.toArray()}var buf=new Buffer(bn);if(!enc){return buf}else{return buf.toString(enc)}}}).call(this,require("buffer").Buffer)},{"bn.js":76,buffer:5,elliptic:77}],75:[function(require,module,exports){var ECDH=require("./ecdh");module.exports=function(crypto,exports){exports.createECDH=function(curve){return new ECDH(curve,crypto)}}},{"./ecdh":74}],76:[function(require,module,exports){module.exports=require(30)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/bn.js/lib/bn.js":30}],77:[function(require,module,exports){module.exports=require(32)},{"../package.json":96,"./elliptic/curve":80,"./elliptic/curves":83,"./elliptic/ec":84,"./elliptic/hmac-drbg":87,"./elliptic/utils":88,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/lib/elliptic.js":32,brorand:89}],78:[function(require,module,exports){module.exports=require(33)},{"../../elliptic":77,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/lib/elliptic/curve/base.js":33,"bn.js":76}],79:[function(require,module,exports){module.exports=require(34)},{"../../elliptic":77,"../curve":80,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/lib/elliptic/curve/edwards.js":34,"bn.js":76,inherits:146}],80:[function(require,module,exports){module.exports=require(35)},{"./base":78,"./edwards":79,"./mont":81,"./short":82,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/lib/elliptic/curve/index.js":35}],81:[function(require,module,exports){module.exports=require(36)},{"../../elliptic":77,"../curve":80,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/lib/elliptic/curve/mont.js":36,"bn.js":76,inherits:146}],82:[function(require,module,exports){module.exports=require(37)},{"../../elliptic":77,"../curve":80,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/lib/elliptic/curve/short.js":37,"bn.js":76,inherits:146}],83:[function(require,module,exports){module.exports=require(38)},{"../elliptic":77,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/lib/elliptic/curves.js":38,"bn.js":76,"hash.js":90}],84:[function(require,module,exports){module.exports=require(39)},{"../../elliptic":77,"./key":85,"./signature":86,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/lib/elliptic/ec/index.js":39,"bn.js":76}],85:[function(require,module,exports){module.exports=require(40)},{"../../elliptic":77,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/lib/elliptic/ec/key.js":40,"bn.js":76}],86:[function(require,module,exports){module.exports=require(41)},{"../../elliptic":77,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/lib/elliptic/ec/signature.js":41,"bn.js":76}],87:[function(require,module,exports){module.exports=require(42)},{"../elliptic":77,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/lib/elliptic/hmac-drbg.js":42,"hash.js":90}],88:[function(require,module,exports){module.exports=require(43)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/lib/elliptic/utils.js":43,"bn.js":76}],89:[function(require,module,exports){module.exports=require(44)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/node_modules/brorand/index.js":44}],90:[function(require,module,exports){module.exports=require(45)},{"./hash/common":91,"./hash/hmac":92,"./hash/ripemd":93,"./hash/sha":94,"./hash/utils":95,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/node_modules/hash.js/lib/hash.js":45}],91:[function(require,module,exports){module.exports=require(46)},{"../hash":90,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/node_modules/hash.js/lib/hash/common.js":46}],92:[function(require,module,exports){module.exports=require(47)},{"../hash":90,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/node_modules/hash.js/lib/hash/hmac.js":47}],93:[function(require,module,exports){module.exports=require(48)},{"../hash":90,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/node_modules/hash.js/lib/hash/ripemd.js":48}],94:[function(require,module,exports){module.exports=require(49)},{"../hash":90,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/node_modules/hash.js/lib/hash/sha.js":49}],95:[function(require,module,exports){module.exports=require(50)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/node_modules/hash.js/lib/hash/utils.js":50,inherits:146}],96:[function(require,module,exports){module.exports=require(51)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/package.json":51}],97:[function(require,module,exports){(function(Buffer){"use strict";var createHash=require("sha.js");var md5=require("./md5");var rmd160=require("ripemd160");var Transform=require("stream").Transform;var inherits=require("inherits");module.exports=function(alg){if("md5"===alg)return new HashNoConstructor(md5);if("rmd160"===alg)return new HashNoConstructor(rmd160);return new Hash(createHash(alg))};inherits(HashNoConstructor,Transform);function HashNoConstructor(hash){Transform.call(this);this._hash=hash;this.buffers=[]}HashNoConstructor.prototype._transform=function(data,_,done){this.buffers.push(data);done()};HashNoConstructor.prototype._flush=function(done){var buf=Buffer.concat(this.buffers);var r=this._hash(buf);this.buffers=null;this.push(r);done()};HashNoConstructor.prototype.update=function(data,enc){this.write(data,enc);return this};HashNoConstructor.prototype.digest=function(enc){this.end();var outData=new Buffer("");var chunk;while(chunk=this.read()){outData=Buffer.concat([outData,chunk])}if(enc){outData=outData.toString(enc)}return outData};inherits(Hash,Transform);function Hash(hash){Transform.call(this);this._hash=hash}Hash.prototype._transform=function(data,_,done){this._hash.update(data);done()};Hash.prototype._flush=function(done){this.push(this._hash.digest());this._hash=null;done()};Hash.prototype.update=function(data,enc){this.write(data,enc);return this};Hash.prototype.digest=function(enc){this.end();var outData=new Buffer("");var chunk;while(chunk=this.read()){outData=Buffer.concat([outData,chunk])}if(enc){outData=outData.toString(enc)}return outData}}).call(this,require("buffer").Buffer)},{"./md5":99,buffer:5,inherits:146,ripemd160:100,"sha.js":102,stream:163}],98:[function(require,module,exports){(function(Buffer){"use strict";var intSize=4;var zeroBuffer=new Buffer(intSize);zeroBuffer.fill(0);var chrsz=8;function toArray(buf,bigEndian){if(buf.length%intSize!==0){var len=buf.length+(intSize-buf.length%intSize);buf=Buffer.concat([buf,zeroBuffer],len)}var arr=[];var fn=bigEndian?buf.readInt32BE:buf.readInt32LE;for(var i=0;i<buf.length;i+=intSize){arr.push(fn.call(buf,i))}return arr}function toBuffer(arr,size,bigEndian){var buf=new Buffer(size);var fn=bigEndian?buf.writeInt32BE:buf.writeInt32LE;for(var i=0;i<arr.length;i++){fn.call(buf,arr[i],i*4,true)}return buf}function hash(buf,fn,hashSize,bigEndian){if(!Buffer.isBuffer(buf))buf=new Buffer(buf);var arr=fn(toArray(buf,bigEndian),buf.length*chrsz);return toBuffer(arr,hashSize,bigEndian)}exports.hash=hash}).call(this,require("buffer").Buffer)},{buffer:5}],99:[function(require,module,exports){"use strict";var helpers=require("./helpers");function core_md5(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);
c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd)}return Array(a,b,c,d)}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b)}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}module.exports=function md5(buf){return helpers.hash(buf,core_md5,16)}},{"./helpers":98}],100:[function(require,module,exports){(function(Buffer){var zl=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13];var zr=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11];var sl=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6];var sr=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];var hl=[0,1518500249,1859775393,2400959708,2840853838];var hr=[1352829926,1548603684,1836072691,2053994217,0];function bytesToWords(bytes){var words=[];for(var i=0,b=0;i<bytes.length;i++,b+=8){words[b>>>5]|=bytes[i]<<24-b%32}return words}function wordsToBytes(words){var bytes=[];for(var b=0;b<words.length*32;b+=8){bytes.push(words[b>>>5]>>>24-b%32&255)}return bytes}function processBlock(H,M,offset){for(var i=0;i<16;i++){var offset_i=offset+i;var M_offset_i=M[offset_i];M[offset_i]=(M_offset_i<<8|M_offset_i>>>24)&16711935|(M_offset_i<<24|M_offset_i>>>8)&4278255360}var al,bl,cl,dl,el;var ar,br,cr,dr,er;ar=al=H[0];br=bl=H[1];cr=cl=H[2];dr=dl=H[3];er=el=H[4];var t;for(var i=0;i<80;i+=1){t=al+M[offset+zl[i]]|0;if(i<16){t+=f1(bl,cl,dl)+hl[0]}else if(i<32){t+=f2(bl,cl,dl)+hl[1]}else if(i<48){t+=f3(bl,cl,dl)+hl[2]}else if(i<64){t+=f4(bl,cl,dl)+hl[3]}else{t+=f5(bl,cl,dl)+hl[4]}t=t|0;t=rotl(t,sl[i]);t=t+el|0;al=el;el=dl;dl=rotl(cl,10);cl=bl;bl=t;t=ar+M[offset+zr[i]]|0;if(i<16){t+=f5(br,cr,dr)+hr[0]}else if(i<32){t+=f4(br,cr,dr)+hr[1]}else if(i<48){t+=f3(br,cr,dr)+hr[2]}else if(i<64){t+=f2(br,cr,dr)+hr[3]}else{t+=f1(br,cr,dr)+hr[4]}t=t|0;t=rotl(t,sr[i]);t=t+er|0;ar=er;er=dr;dr=rotl(cr,10);cr=br;br=t}t=H[1]+cl+dr|0;H[1]=H[2]+dl+er|0;H[2]=H[3]+el+ar|0;H[3]=H[4]+al+br|0;H[4]=H[0]+bl+cr|0;H[0]=t}function f1(x,y,z){return x^y^z}function f2(x,y,z){return x&y|~x&z}function f3(x,y,z){return(x|~y)^z}function f4(x,y,z){return x&z|y&~z}function f5(x,y,z){return x^(y|~z)}function rotl(x,n){return x<<n|x>>>32-n}function ripemd160(message){var H=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof message=="string")message=new Buffer(message,"utf8");var m=bytesToWords(message);var nBitsLeft=message.length*8;var nBitsTotal=message.length*8;m[nBitsLeft>>>5]|=128<<24-nBitsLeft%32;m[(nBitsLeft+64>>>9<<4)+14]=(nBitsTotal<<8|nBitsTotal>>>24)&16711935|(nBitsTotal<<24|nBitsTotal>>>8)&4278255360;for(var i=0;i<m.length;i+=16){processBlock(H,m,i)}for(var i=0;i<5;i++){var H_i=H[i];H[i]=(H_i<<8|H_i>>>24)&16711935|(H_i<<24|H_i>>>8)&4278255360}var digestbytes=wordsToBytes(H);return new Buffer(digestbytes)}module.exports=ripemd160}).call(this,require("buffer").Buffer)},{buffer:5}],101:[function(require,module,exports){(function(Buffer){function Hash(blockSize,finalSize){this._block=new Buffer(blockSize);this._finalSize=finalSize;this._blockSize=blockSize;this._len=0;this._s=0}Hash.prototype.update=function(data,enc){if("string"===typeof data){enc=enc||"utf8";data=new Buffer(data,enc)}var l=this._len+=data.length;var s=this._s||0;var f=0;var buffer=this._block;while(s<l){var t=Math.min(data.length,f+this._blockSize-s%this._blockSize);var ch=t-f;for(var i=0;i<ch;i++){buffer[s%this._blockSize+i]=data[i+f]}s+=ch;f+=ch;if(s%this._blockSize===0){this._update(buffer)}}this._s=s;return this};Hash.prototype.digest=function(enc){var l=this._len*8;this._block[this._len%this._blockSize]=128;this._block.fill(0,this._len%this._blockSize+1);if(l%(this._blockSize*8)>=this._finalSize*8){this._update(this._block);this._block.fill(0)}this._block.writeInt32BE(l,this._blockSize-4);var hash=this._update(this._block)||this._hash();return enc?hash.toString(enc):hash};Hash.prototype._update=function(){throw new Error("_update must be implemented by subclass")};module.exports=Hash}).call(this,require("buffer").Buffer)},{buffer:5}],102:[function(require,module,exports){var exports=module.exports=function(alg){var Alg=exports[alg.toLowerCase()];if(!Alg)throw new Error(alg+" is not supported (we accept pull requests)");return new Alg};exports.sha1=require("./sha1");exports.sha224=require("./sha224");exports.sha256=require("./sha256");exports.sha384=require("./sha384");exports.sha512=require("./sha512")},{"./sha1":103,"./sha224":104,"./sha256":105,"./sha384":106,"./sha512":107}],103:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var W=new Array(80);function Sha1(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha1,Hash);Sha1.prototype.init=function(){this._a=1732584193;this._b=4023233417;this._c=2562383102;this._d=271733878;this._e=3285377520;return this};function rol(num,cnt){return num<<cnt|num>>>32-cnt}Sha1.prototype._update=function(M){var W=this._w;var a=this._a;var b=this._b;var c=this._c;var d=this._d;var e=this._e;var j=0,k;function calcW(){return rol(W[j-3]^W[j-8]^W[j-14]^W[j-16],1)}function loop(w,f){W[j]=w;var t=rol(a,5)+f+e+w+k;e=d;d=c;c=rol(b,30);b=a;a=t;j++}k=1518500249;while(j<16)loop(M.readInt32BE(j*4),b&c|~b&d);while(j<20)loop(calcW(),b&c|~b&d);k=1859775393;while(j<40)loop(calcW(),b^c^d);k=-1894007588;while(j<60)loop(calcW(),b&c|b&d|c&d);k=-899497514;while(j<80)loop(calcW(),b^c^d);this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0};Sha1.prototype._hash=function(){var H=new Buffer(20);H.writeInt32BE(this._a|0,0);H.writeInt32BE(this._b|0,4);H.writeInt32BE(this._c|0,8);H.writeInt32BE(this._d|0,12);H.writeInt32BE(this._e|0,16);return H};module.exports=Sha1}).call(this,require("buffer").Buffer)},{"./hash":101,buffer:5,inherits:146}],104:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var SHA256=require("./sha256");var Hash=require("./hash");var W=new Array(64);function Sha224(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha224,SHA256);Sha224.prototype.init=function(){this._a=3238371032|0;this._b=914150663|0;this._c=812702999|0;this._d=4144912697|0;this._e=4290775857|0;this._f=1750603025|0;this._g=1694076839|0;this._h=3204075428|0;return this};Sha224.prototype._hash=function(){var H=new Buffer(28);H.writeInt32BE(this._a,0);H.writeInt32BE(this._b,4);H.writeInt32BE(this._c,8);H.writeInt32BE(this._d,12);H.writeInt32BE(this._e,16);H.writeInt32BE(this._f,20);H.writeInt32BE(this._g,24);return H};module.exports=Sha224}).call(this,require("buffer").Buffer)},{"./hash":101,"./sha256":105,buffer:5,inherits:146}],105:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];var W=new Array(64);function Sha256(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha256,Hash);Sha256.prototype.init=function(){this._a=1779033703|0;this._b=3144134277|0;this._c=1013904242|0;this._d=2773480762|0;this._e=1359893119|0;this._f=2600822924|0;this._g=528734635|0;this._h=1541459225|0;return this};function S(X,n){return X>>>n|X<<32-n}function R(X,n){return X>>>n}function Ch(x,y,z){return x&y^~x&z}function Maj(x,y,z){return x&y^x&z^y&z}function Sigma0256(x){return S(x,2)^S(x,13)^S(x,22)}function Sigma1256(x){return S(x,6)^S(x,11)^S(x,25)}function Gamma0256(x){return S(x,7)^S(x,18)^R(x,3)}function Gamma1256(x){return S(x,17)^S(x,19)^R(x,10)}Sha256.prototype._update=function(M){var W=this._w;var a=this._a|0;var b=this._b|0;var c=this._c|0;var d=this._d|0;var e=this._e|0;var f=this._f|0;var g=this._g|0;var h=this._h|0;var j=0;function calcW(){return Gamma1256(W[j-2])+W[j-7]+Gamma0256(W[j-15])+W[j-16]}function loop(w){W[j]=w;var T1=h+Sigma1256(e)+Ch(e,f,g)+K[j]+w;var T2=Sigma0256(a)+Maj(a,b,c);h=g;g=f;f=e;e=d+T1;d=c;c=b;b=a;a=T1+T2;j++}while(j<16)loop(M.readInt32BE(j*4));while(j<64)loop(calcW());this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0;this._f=f+this._f|0;this._g=g+this._g|0;this._h=h+this._h|0};Sha256.prototype._hash=function(){var H=new Buffer(32);H.writeInt32BE(this._a,0);H.writeInt32BE(this._b,4);H.writeInt32BE(this._c,8);H.writeInt32BE(this._d,12);H.writeInt32BE(this._e,16);H.writeInt32BE(this._f,20);H.writeInt32BE(this._g,24);H.writeInt32BE(this._h,28);return H};module.exports=Sha256}).call(this,require("buffer").Buffer)},{"./hash":101,buffer:5,inherits:146}],106:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var SHA512=require("./sha512");var Hash=require("./hash");var W=new Array(160);function Sha384(){this.init();this._w=W;Hash.call(this,128,112)}inherits(Sha384,SHA512);Sha384.prototype.init=function(){this._a=3418070365|0;this._b=1654270250|0;this._c=2438529370|0;this._d=355462360|0;this._e=1731405415|0;this._f=2394180231|0;this._g=3675008525|0;this._h=1203062813|0;this._al=3238371032|0;this._bl=914150663|0;this._cl=812702999|0;this._dl=4144912697|0;this._el=4290775857|0;this._fl=1750603025|0;this._gl=1694076839|0;this._hl=3204075428|0;return this};Sha384.prototype._hash=function(){var H=new Buffer(48);function writeInt64BE(h,l,offset){H.writeInt32BE(h,offset);H.writeInt32BE(l,offset+4)}writeInt64BE(this._a,this._al,0);writeInt64BE(this._b,this._bl,8);writeInt64BE(this._c,this._cl,16);writeInt64BE(this._d,this._dl,24);writeInt64BE(this._e,this._el,32);writeInt64BE(this._f,this._fl,40);return H};module.exports=Sha384}).call(this,require("buffer").Buffer)},{"./hash":101,"./sha512":107,buffer:5,inherits:146}],107:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];var W=new Array(160);function Sha512(){this.init();this._w=W;Hash.call(this,128,112)}inherits(Sha512,Hash);Sha512.prototype.init=function(){this._a=1779033703|0;this._b=3144134277|0;this._c=1013904242|0;this._d=2773480762|0;this._e=1359893119|0;this._f=2600822924|0;this._g=528734635|0;this._h=1541459225|0;this._al=4089235720|0;this._bl=2227873595|0;this._cl=4271175723|0;this._dl=1595750129|0;this._el=2917565137|0;this._fl=725511199|0;this._gl=4215389547|0;this._hl=327033209|0;return this};function S(X,Xl,n){return X>>>n|Xl<<32-n}function Ch(x,y,z){return x&y^~x&z}function Maj(x,y,z){return x&y^x&z^y&z}Sha512.prototype._update=function(M){var W=this._w;var a=this._a|0;var b=this._b|0;var c=this._c|0;var d=this._d|0;var e=this._e|0;var f=this._f|0;var g=this._g|0;var h=this._h|0;var al=this._al|0;var bl=this._bl|0;var cl=this._cl|0;var dl=this._dl|0;var el=this._el|0;var fl=this._fl|0;var gl=this._gl|0;var hl=this._hl|0;var i=0,j=0;var Wi,Wil;function calcW(){var x=W[j-15*2];var xl=W[j-15*2+1];var gamma0=S(x,xl,1)^S(x,xl,8)^x>>>7;var gamma0l=S(xl,x,1)^S(xl,x,8)^S(xl,x,7);x=W[j-2*2];xl=W[j-2*2+1];var gamma1=S(x,xl,19)^S(xl,x,29)^x>>>6;var gamma1l=S(xl,x,19)^S(x,xl,29)^S(xl,x,6);var Wi7=W[j-7*2];var Wi7l=W[j-7*2+1];var Wi16=W[j-16*2];var Wi16l=W[j-16*2+1];Wil=gamma0l+Wi7l;Wi=gamma0+Wi7+(Wil>>>0<gamma0l>>>0?1:0);Wil=Wil+gamma1l;Wi=Wi+gamma1+(Wil>>>0<gamma1l>>>0?1:0);Wil=Wil+Wi16l;Wi=Wi+Wi16+(Wil>>>0<Wi16l>>>0?1:0)}function loop(){W[j]=Wi;W[j+1]=Wil;var maj=Maj(a,b,c);var majl=Maj(al,bl,cl);var sigma0h=S(a,al,28)^S(al,a,2)^S(al,a,7);var sigma0l=S(al,a,28)^S(a,al,2)^S(a,al,7);var sigma1h=S(e,el,14)^S(e,el,18)^S(el,e,9);var sigma1l=S(el,e,14)^S(el,e,18)^S(e,el,9);var Ki=K[j];var Kil=K[j+1];var ch=Ch(e,f,g);var chl=Ch(el,fl,gl);var t1l=hl+sigma1l;var t1=h+sigma1h+(t1l>>>0<hl>>>0?1:0);t1l=t1l+chl;t1=t1+ch+(t1l>>>0<chl>>>0?1:0);t1l=t1l+Kil;t1=t1+Ki+(t1l>>>0<Kil>>>0?1:0);t1l=t1l+Wil;t1=t1+Wi+(t1l>>>0<Wil>>>0?1:0);var t2l=sigma0l+majl;var t2=sigma0h+maj+(t2l>>>0<sigma0l>>>0?1:0);h=g;hl=gl;g=f;gl=fl;f=e;fl=el;el=dl+t1l|0;e=d+t1+(el>>>0<dl>>>0?1:0)|0;d=c;dl=cl;c=b;cl=bl;b=a;bl=al;al=t1l+t2l|0;a=t1+t2+(al>>>0<t1l>>>0?1:0)|0;i++;j+=2}while(i<16){Wi=M.readInt32BE(j*4);Wil=M.readInt32BE(j*4+4);loop()}while(i<80){calcW();loop()}this._al=this._al+al|0;this._bl=this._bl+bl|0;this._cl=this._cl+cl|0;this._dl=this._dl+dl|0;this._el=this._el+el|0;this._fl=this._fl+fl|0;this._gl=this._gl+gl|0;this._hl=this._hl+hl|0;this._a=this._a+a+(this._al>>>0<al>>>0?1:0)|0;this._b=this._b+b+(this._bl>>>0<bl>>>0?1:0)|0;this._c=this._c+c+(this._cl>>>0<cl>>>0?1:0)|0;this._d=this._d+d+(this._dl>>>0<dl>>>0?1:0)|0;this._e=this._e+e+(this._el>>>0<el>>>0?1:0)|0;this._f=this._f+f+(this._fl>>>0<fl>>>0?1:0)|0;this._g=this._g+g+(this._gl>>>0<gl>>>0?1:0)|0;this._h=this._h+h+(this._hl>>>0<hl>>>0?1:0)|0};Sha512.prototype._hash=function(){var H=new Buffer(64);function writeInt64BE(h,l,offset){H.writeInt32BE(h,offset);H.writeInt32BE(l,offset+4)}writeInt64BE(this._a,this._al,0);writeInt64BE(this._b,this._bl,8);writeInt64BE(this._c,this._cl,16);writeInt64BE(this._d,this._dl,24);writeInt64BE(this._e,this._el,32);writeInt64BE(this._f,this._fl,40);writeInt64BE(this._g,this._gl,48);writeInt64BE(this._h,this._hl,56);return H};module.exports=Sha512}).call(this,require("buffer").Buffer)},{"./hash":101,buffer:5,inherits:146}],108:[function(require,module,exports){(function(Buffer){"use strict";var createHash=require("create-hash/browser");var inherits=require("inherits");var Transform=require("stream").Transform;var ZEROS=new Buffer(128);ZEROS.fill(0);function Hmac(alg,key){Transform.call(this);if(typeof key==="string"){key=new Buffer(key)}var blocksize=alg==="sha512"||alg==="sha384"?128:64;this._alg=alg;this._key=key;if(key.length>blocksize){key=createHash(alg).update(key).digest()}else if(key.length<blocksize){key=Buffer.concat([key,ZEROS],blocksize)}var ipad=this._ipad=new Buffer(blocksize);var opad=this._opad=new Buffer(blocksize);for(var i=0;i<blocksize;i++){ipad[i]=key[i]^54;opad[i]=key[i]^92}this._hash=createHash(alg).update(ipad)}inherits(Hmac,Transform);Hmac.prototype.update=function(data,enc){this._hash.update(data,enc);return this};Hmac.prototype._transform=function(data,_,next){this._hash.update(data);next()};Hmac.prototype._flush=function(next){this.push(this.digest());next()};Hmac.prototype.digest=function(enc){var h=this._hash.digest();return createHash(this._alg).update(this._opad).update(h).digest(enc)};module.exports=function createHmac(alg,key){return new Hmac(alg,key)}}).call(this,require("buffer").Buffer)},{buffer:5,"create-hash/browser":97,inherits:146,stream:163}],109:[function(require,module,exports){(function(Buffer){var generatePrime=require("./lib/generatePrime");var primes=require("./lib/primes");var DH=require("./lib/dh");function getDiffieHellman(mod){var prime=new Buffer(primes[mod].prime,"hex");var gen=new Buffer(primes[mod].gen,"hex");return new DH(prime,gen)}function createDiffieHellman(prime,enc,generator,genc){if(Buffer.isBuffer(enc)||typeof enc==="string"&&["hex","binary","base64"].indexOf(enc)===-1){genc=generator;generator=enc;enc=undefined}enc=enc||"binary";genc=genc||"binary";generator=generator||new Buffer([2]);if(!Buffer.isBuffer(generator)){generator=new Buffer(generator,genc)}if(typeof prime==="number"){return new DH(generatePrime(prime,generator),generator,true)}if(!Buffer.isBuffer(prime)){prime=new Buffer(prime,enc)}return new DH(prime,generator,true)}exports.DiffieHellmanGroup=exports.createDiffieHellmanGroup=exports.getDiffieHellman=getDiffieHellman;exports.createDiffieHellman=exports.DiffieHellman=createDiffieHellman}).call(this,require("buffer").Buffer)},{"./lib/dh":110,"./lib/generatePrime":111,"./lib/primes":112,buffer:5}],110:[function(require,module,exports){(function(Buffer){var BN=require("bn.js");var MillerRabin=require("miller-rabin");var millerRabin=new MillerRabin;var TWENTYFOUR=new BN(24);var ELEVEN=new BN(11);var TEN=new BN(10);var THREE=new BN(3);var SEVEN=new BN(7);var primes=require("./generatePrime");var randomBytes=require("randombytes");module.exports=DH;function setPublicKey(pub,enc){enc=enc||"utf8";if(!Buffer.isBuffer(pub)){pub=new Buffer(pub,enc)}this._pub=new BN(pub);return this}function setPrivateKey(priv,enc){enc=enc||"utf8";if(!Buffer.isBuffer(priv)){priv=new Buffer(priv,enc)}this._priv=new BN(priv);return this}var primeCache={};function checkPrime(prime,generator){var gen=generator.toString("hex");var hex=[gen,prime.toString(16)].join("_");if(hex in primeCache){return primeCache[hex]}var error=0;if(prime.isEven()||!primes.simpleSieve||!primes.fermatTest(prime)||!millerRabin.test(prime)){error+=1;if(gen==="02"||gen==="05"){error+=8}else{error+=4}primeCache[hex]=error;return error}if(!millerRabin.test(prime.shrn(1))){error+=2}var rem;switch(gen){case"02":if(prime.mod(TWENTYFOUR).cmp(ELEVEN)){error+=8}break;case"05":rem=prime.mod(TEN);if(rem.cmp(THREE)&&rem.cmp(SEVEN)){error+=8}break;default:error+=4}primeCache[hex]=error;return error}function defineError(self,error){try{Object.defineProperty(self,"verifyError",{enumerable:true,value:error,writable:false})}catch(e){self.verifyError=error}}function DH(prime,generator,malleable){this.setGenerator(generator);this.__prime=new BN(prime);this._prime=BN.mont(this.__prime);this._primeLen=prime.length;this._pub=void 0;this._priv=void 0;if(malleable){this.setPublicKey=setPublicKey;this.setPrivateKey=setPrivateKey;defineError(this,checkPrime(this.__prime,generator))}else{defineError(this,8)}}DH.prototype.generateKeys=function(){if(!this._priv){this._priv=new BN(randomBytes(this._primeLen))}this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed();return this.getPublicKey()};DH.prototype.computeSecret=function(other){other=new BN(other);other=other.toRed(this._prime);var secret=other.redPow(this._priv).fromRed();var out=new Buffer(secret.toArray());var prime=this.getPrime();if(out.length<prime.length){var front=new Buffer(prime.length-out.length);front.fill(0);out=Buffer.concat([front,out])}return out};DH.prototype.getPublicKey=function getPublicKey(enc){return formatReturnValue(this._pub,enc)};DH.prototype.getPrivateKey=function getPrivateKey(enc){return formatReturnValue(this._priv,enc)};DH.prototype.getPrime=function(enc){return formatReturnValue(this.__prime,enc)};DH.prototype.getGenerator=function(enc){return formatReturnValue(this._gen,enc)};DH.prototype.setGenerator=function(gen,enc){enc=enc||"utf8";if(!Buffer.isBuffer(gen)){gen=new Buffer(gen,enc)}this._gen=new BN(gen);return this};function formatReturnValue(bn,enc){var buf=new Buffer(bn.toArray());if(!enc){return buf}else{return buf.toString(enc)}}}).call(this,require("buffer").Buffer)},{"./generatePrime":111,"bn.js":113,buffer:5,"miller-rabin":114,randombytes:144}],111:[function(require,module,exports){var randomBytes=require("randombytes");module.exports=findPrime;findPrime.simpleSieve=simpleSieve;findPrime.fermatTest=fermatTest;var BN=require("bn.js");var TWENTYFOUR=new BN(24);var MillerRabin=require("miller-rabin");var millerRabin=new MillerRabin;var ONE=new BN(1);var TWO=new BN(2);var FIVE=new BN(5);var SIXTEEN=new BN(16);var EIGHT=new BN(8);var TEN=new BN(10);var THREE=new BN(3);var SEVEN=new BN(7);var ELEVEN=new BN(11);var FOUR=new BN(4);var TWELVE=new BN(12);var primes=null;function _getPrimes(){if(primes!==null)return primes;var limit=1048576;var res=[];res[0]=2;for(var i=1,k=3;k<limit;k+=2){var sqrt=Math.ceil(Math.sqrt(k));for(var j=0;j<i&&res[j]<=sqrt;j++)if(k%res[j]===0)break;if(i!==j&&res[j]<=sqrt)continue;res[i++]=k}primes=res;return res}function simpleSieve(p){var primes=_getPrimes();for(var i=0;i<primes.length;i++)if(p.modn(primes[i])===0){if(p.cmpn(primes[i])===0){return true}else{return false}}return true}function fermatTest(p){var red=BN.mont(p);return TWO.toRed(red).redPow(p.subn(1)).fromRed().cmpn(1)===0}function findPrime(bits,gen){if(bits<16){if(gen===2||gen===5){return new BN([140,123])}else{return new BN([140,39])}}gen=new BN(gen);var runs,comp;function generateRandom(bits){runs=-1;var out=new BN(randomBytes(Math.ceil(bits/8)));while(out.bitLength()>bits){out.ishrn(1)}if(out.isEven()){out.iadd(ONE)}if(!out.testn(1)){out.iadd(TWO)}if(!gen.cmp(TWO)){while(out.mod(TWENTYFOUR).cmp(ELEVEN)){out.iadd(FOUR)}comp={major:[TWENTYFOUR],minor:[TWELVE]}}else if(!gen.cmp(FIVE)){rem=out.mod(TEN);while(rem.cmp(THREE)){out.iadd(FOUR);rem=out.mod(TEN)}comp={major:[FOUR,SIXTEEN],minor:[TWO,EIGHT]}}else{comp={major:[FOUR],minor:[TWO]}}return out}var num=generateRandom(bits);var n2=num.shrn(1);while(true){while(num.bitLength()>bits){num=generateRandom(bits);n2=num.shrn(1)}runs++;if(simpleSieve(n2)&&simpleSieve(num)&&fermatTest(n2)&&fermatTest(num)&&millerRabin.test(n2)&&millerRabin.test(num)){return num}num.iadd(comp.major[runs%comp.major.length]);n2.iadd(comp.minor[runs%comp.minor.length])}}},{"bn.js":113,"miller-rabin":114,randombytes:144}],112:[function(require,module,exports){module.exports={modp1:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},modp2:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},modp5:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},modp14:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},modp15:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},modp16:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},modp17:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},modp18:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}
},{}],113:[function(require,module,exports){module.exports=require(30)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/bn.js/lib/bn.js":30}],114:[function(require,module,exports){var bn=require("bn.js");var brorand=require("brorand");function MillerRabin(rand){this.rand=rand||new brorand.Rand}module.exports=MillerRabin;MillerRabin.create=function create(rand){return new MillerRabin(rand)};MillerRabin.prototype._rand=function _rand(n){var len=n.bitLength();var buf=this.rand.generate(Math.ceil(len/8));buf[0]|=3;var mask=len&7;if(mask!==0)buf[buf.length-1]>>=7-mask;return new bn(buf)};MillerRabin.prototype.test=function test(n,k,cb){var len=n.bitLength();var red=bn.mont(n);var rone=new bn(1).toRed(red);if(!k)k=Math.max(1,len/48|0);var n1=n.subn(1);var n2=n1.subn(1);for(var s=0;!n1.testn(s);s++){}var d=n.shrn(s);var rn1=n1.toRed(red);var prime=true;for(;k>0;k--){var a=this._rand(n2);if(cb)cb(a);var x=a.toRed(red).redPow(d);if(x.cmp(rone)===0||x.cmp(rn1)===0)continue;for(var i=1;i<s;i++){x=x.redSqr();if(x.cmp(rone)===0)return false;if(x.cmp(rn1)===0)break}if(i===s)return false}return prime};MillerRabin.prototype.getDivisor=function getDivisor(n,k){var len=n.bitLength();var red=bn.mont(n);var rone=new bn(1).toRed(red);if(!k)k=Math.max(1,len/48|0);var n1=n.subn(1);var n2=n1.subn(1);for(var s=0;!n1.testn(s);s++){}var d=n.shrn(s);var rn1=n1.toRed(red);var prime=true;for(;k>0;k--){var a=this._rand(n2);var g=n.gcd(a);if(g.cmpn(1)!==0)return g;var x=a.toRed(red).redPow(d);if(x.cmp(rone)===0||x.cmp(rn1)===0)continue;for(var i=1;i<s;i++){x=x.redSqr();if(x.cmp(rone)===0)return x.fromRed().subn(1).gcd(n);if(x.cmp(rn1)===0)break}if(i===s){x=x.redSqr();return x.fromRed().subn(1).gcd(n)}}return prime}},{"bn.js":113,brorand:115}],115:[function(require,module,exports){module.exports=require(44)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/elliptic/node_modules/brorand/index.js":44}],116:[function(require,module,exports){(function(Buffer){var createHmac=require("create-hmac");exports.pbkdf2=pbkdf2;function pbkdf2(password,salt,iterations,keylen,digest,callback){if(typeof digest==="function"){callback=digest;digest=undefined}if(typeof callback!=="function"){throw new Error("No callback provided to pbkdf2")}var result=pbkdf2Sync(password,salt,iterations,keylen,digest);setTimeout(function(){callback(undefined,result)})}exports.pbkdf2Sync=pbkdf2Sync;function pbkdf2Sync(password,salt,iterations,keylen,digest){if(typeof iterations!=="number")throw new TypeError("Iterations not a number");if(iterations<0)throw new TypeError("Bad iterations");if(typeof keylen!=="number")throw new TypeError("Key length not a number");if(keylen<0)throw new TypeError("Bad key length");digest=digest||"sha1";if(!Buffer.isBuffer(password))password=new Buffer(password);if(!Buffer.isBuffer(salt))salt=new Buffer(salt);var hLen;var l=1;var DK=new Buffer(keylen);var block1=new Buffer(salt.length+4);salt.copy(block1,0,0,salt.length);var r;var T;for(var i=1;i<=l;i++){block1.writeUInt32BE(i,salt.length);var U=createHmac(digest,password).update(block1).digest();if(!hLen){hLen=U.length;T=new Buffer(hLen);l=Math.ceil(keylen/hLen);r=keylen-(l-1)*hLen;if(keylen>(Math.pow(2,32)-1)*hLen)throw new TypeError("keylen exceeds maximum length")}U.copy(T,0,0,hLen);for(var j=1;j<iterations;j++){U=createHmac(digest,password).update(U).digest();for(var k=0;k<hLen;k++){T[k]^=U[k]}}var destPos=(i-1)*hLen;var len=i===l?r:hLen;T.copy(DK,destPos,0,len)}return DK}}).call(this,require("buffer").Buffer)},{buffer:5,"create-hmac":108}],117:[function(require,module,exports){module.exports=function(exports,crypto){exports.publicEncrypt=require("./publicEncrypt")(crypto);exports.privateDecrypt=require("./privateDecrypt")(crypto)}},{"./privateDecrypt":141,"./publicEncrypt":142}],118:[function(require,module,exports){(function(Buffer){module.exports=function(seed,len,crypto){var t=new Buffer("");var i=0,c;while(t.length<len){c=i2ops(i++);t=Buffer.concat([t,crypto.createHash("sha1").update(seed).update(c).digest()])}return t.slice(0,len)};function i2ops(c){var out=new Buffer(4);out.writeUInt32BE(c,0);return out}}).call(this,require("buffer").Buffer)},{buffer:5}],119:[function(require,module,exports){module.exports=require(30)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/bn.js/lib/bn.js":30}],120:[function(require,module,exports){module.exports=require(31)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/browserify-rsa/index.js":31,"bn.js":119,buffer:5}],121:[function(require,module,exports){module.exports=require(52)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/EVP_BytesToKey.js":52,buffer:5}],122:[function(require,module,exports){module.exports=require(53)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/aesid.json":53}],123:[function(require,module,exports){module.exports=require(54)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/asn1.js":54,"asn1.js":127,"asn1.js-rfc3280":126}],124:[function(require,module,exports){module.exports=require(55)},{"./EVP_BytesToKey":121,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/fixProc.js":55,buffer:5}],125:[function(require,module,exports){module.exports=require(56)},{"./aesid.json":122,"./asn1":123,"./fixProc":124,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/index.js":56,buffer:5,pemstrip:140}],126:[function(require,module,exports){module.exports=require(57)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/asn1.js-rfc3280/index.js":57,"asn1.js":127}],127:[function(require,module,exports){module.exports=require(58)},{"./asn1/api":128,"./asn1/base":130,"./asn1/constants":134,"./asn1/decoders":136,"./asn1/encoders":138,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/asn1.js/lib/asn1.js":58,"bn.js":119}],128:[function(require,module,exports){module.exports=require(59)},{"../asn1":127,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/asn1.js/lib/asn1/api.js":59,inherits:146,vm:166}],129:[function(require,module,exports){module.exports=require(60)},{"../base":130,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/asn1.js/lib/asn1/base/buffer.js":60,buffer:5,inherits:146}],130:[function(require,module,exports){module.exports=require(61)},{"./buffer":129,"./node":131,"./reporter":132,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/asn1.js/lib/asn1/base/index.js":61}],131:[function(require,module,exports){module.exports=require(62)},{"../base":130,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/asn1.js/lib/asn1/base/node.js":62,"minimalistic-assert":139}],132:[function(require,module,exports){module.exports=require(63)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/asn1.js/lib/asn1/base/reporter.js":63,inherits:146}],133:[function(require,module,exports){module.exports=require(64)},{"../constants":134,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/asn1.js/lib/asn1/constants/der.js":64}],134:[function(require,module,exports){module.exports=require(65)},{"./der":133,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/asn1.js/lib/asn1/constants/index.js":65}],135:[function(require,module,exports){module.exports=require(66)},{"../../asn1":127,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/asn1.js/lib/asn1/decoders/der.js":66,inherits:146}],136:[function(require,module,exports){module.exports=require(67)},{"./der":135,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/asn1.js/lib/asn1/decoders/index.js":67}],137:[function(require,module,exports){module.exports=require(68)},{"../../asn1":127,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/asn1.js/lib/asn1/encoders/der.js":68,buffer:5,inherits:146}],138:[function(require,module,exports){module.exports=require(69)},{"./der":137,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/asn1.js/lib/asn1/encoders/index.js":69}],139:[function(require,module,exports){module.exports=require(70)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/asn1.js/node_modules/minimalistic-assert/index.js":70}],140:[function(require,module,exports){module.exports=require(71)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/browserify-sign/node_modules/parse-asn1/node_modules/pemstrip/index.js":71}],141:[function(require,module,exports){(function(Buffer){var parseKeys=require("parse-asn1");var mgf=require("./mgf");var xor=require("./xor");var bn=require("bn.js");var crt=require("browserify-rsa");module.exports=function(crypto){return privateDecrypt;function privateDecrypt(private_key,enc){var padding;if(private_key.padding){padding=private_key.padding}else{padding=4}var key=parseKeys(private_key,crypto);var k=key.modulus.byteLength();if(enc.length>k||new bn(enc).cmp(key.modulus)>=0){throw new Error("decryption error")}var msg=crt(enc,key,crypto);var zBuffer=new Buffer(k-msg.length);zBuffer.fill(0);msg=Buffer.concat([zBuffer,msg],k);if(padding===4){return oaep(key,msg,crypto)}else if(padding===1){return pkcs1(key,msg,crypto)}else if(padding===3){return msg}else{throw new Error("unknown padding")}}};function oaep(key,msg,crypto){var n=key.modulus;var k=key.modulus.byteLength();var mLen=msg.length;var iHash=crypto.createHash("sha1").update(new Buffer("")).digest();var hLen=iHash.length;var hLen2=2*hLen;if(msg[0]!==0){throw new Error("decryption error")}var maskedSeed=msg.slice(1,hLen+1);var maskedDb=msg.slice(hLen+1);var seed=xor(maskedSeed,mgf(maskedDb,hLen,crypto));var db=xor(maskedDb,mgf(seed,k-hLen-1,crypto));if(compare(iHash,db.slice(0,hLen))){throw new Error("decryption error")}var i=hLen;while(db[i]===0){i++}if(db[i++]!==1){throw new Error("decryption error")}return db.slice(i)}function pkcs1(key,msg,crypto){var p1=msg.slice(0,2);var i=2;var status=0;while(msg[i++]!==0){if(i>=msg.length){status++;break}}var ps=msg.slice(2,i-1);var p2=msg.slice(i-1,i);if(p1.toString("hex")!=="0002"){status++}if(ps.length<8){status++}return msg.slice(i)}function compare(a,b){var dif=0;var len=a.length;if(a.length!==b.length){dif++;len=Math.min(a.length,b.length)}var i=-1;while(++i<len){dif+=a[i]^b[i]}return dif}}).call(this,require("buffer").Buffer)},{"./mgf":118,"./xor":143,"bn.js":119,"browserify-rsa":120,buffer:5,"parse-asn1":125}],142:[function(require,module,exports){(function(Buffer){var parseKeys=require("parse-asn1");var mgf=require("./mgf");var xor=require("./xor");var bn=require("bn.js");var constants={RSA_PKCS1_OAEP_PADDING:4,RSA_PKCS1_PADDIN:1,RSA_NO_PADDING:3};module.exports=function(crypto){return publicEncrypt;function publicEncrypt(public_key,msg){var padding;if(public_key.padding){padding=public_key.padding}else{padding=4}var key=parseKeys(public_key);var paddedMsg;if(padding===4){paddedMsg=oaep(key,msg,crypto)}else if(padding===1){paddedMsg=pkcs1(key,msg,crypto)}else if(padding===3){paddedMsg=new bn(msg);if(paddedMsg.cmp(key.modulus)>=0){throw new Error("data too long for modulus")}}else{throw new Error("unknown padding")}var enc=paddedMsg.toRed(bn.mont(key.modulus)).redPow(new bn(key.publicExponent)).fromRed().toArray();return new Buffer(enc)}};function oaep(key,msg,crypto){var k=key.modulus.byteLength();var mLen=msg.length;var iHash=crypto.createHash("sha1").update(new Buffer("")).digest();var hLen=iHash.length;var hLen2=2*hLen;if(mLen>k-hLen2-2){throw new Error("message too long")}var ps=new Buffer(k-mLen-hLen2-2);ps.fill(0);var dblen=k-hLen-1;var seed=crypto.randomBytes(hLen);var maskedDb=xor(Buffer.concat([iHash,ps,new Buffer([1]),msg],dblen),mgf(seed,dblen,crypto));var maskedSeed=xor(seed,mgf(maskedDb,hLen,crypto));return new bn(Buffer.concat([new Buffer([0]),maskedSeed,maskedDb],k))}function pkcs1(key,msg,crypto){var mLen=msg.length;var k=key.modulus.byteLength();if(mLen>k-11){throw new Error("message too long")}var ps=nonZero(k-mLen-3,crypto);return new bn(Buffer.concat([new Buffer([0,2]),ps,new Buffer([0]),msg],k))}function nonZero(len,crypto){var out=new Buffer(len);var i=0;var cache=crypto.randomBytes(len*2);var cur=0;var num;while(i<len){if(cur===cache.length){cache=crypto.randomBytes(len*2);cur=0}num=cache[cur++];if(num){out[i++]=num}}return out}}).call(this,require("buffer").Buffer)},{"./mgf":118,"./xor":143,"bn.js":119,buffer:5,"parse-asn1":125}],143:[function(require,module,exports){module.exports=function xor(a,b){var len=a.length;var i=-1;while(++i<len){a[i]^=b[i]}return a}},{}],144:[function(require,module,exports){(function(process,global,Buffer){"use strict";var crypto=global.crypto||global.msCrypto;if(crypto&&crypto.getRandomValues){module.exports=randomBytes}else{module.exports=oldBrowser}function randomBytes(size,cb){var bytes=new Buffer(size);crypto.getRandomValues(bytes);if(typeof cb==="function"){return process.nextTick(function(){cb(null,bytes)})}return bytes}function oldBrowser(){throw new Error("secure random number generation not supported by this browser\n"+"use chrome, FireFox or Internet Explorer 11")}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer)},{_process:149,buffer:5}],145:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],146:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],147:[function(require,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],148:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:149}],149:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){var source=ev.source;if((source===window||source===null)&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],150:[function(require,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports;var freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^ -~]/,regexSeparators=/\x2E|\u3002|\uFF0E|\uFF61/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw RangeError(errors[type])}function map(array,fn){var length=array.length;while(length--){array[length]=fn(array[length])}return array}function mapDomain(string,fn){return map(string.split(regexSeparators),fn).join(".")}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map(array,function(value){var output="";if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output}).join("")}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error("not-basic")}output.push(input.charCodeAt(j))}for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error("invalid-input")}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error("overflow")}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error("overflow")}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error("overflow")}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")}function toUnicode(domain){return mapDomain(domain,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(domain){return mapDomain(domain,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}punycode={version:"1.2.4",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define("punycode",function(){return punycode})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],151:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":152}],152:[function(require,module,exports){(function(process){module.exports=Duplex;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);forEach(objectKeys(Writable.prototype),function(method){if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]});function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;process.nextTick(this.end.bind(this))}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}}).call(this,require("_process"))},{"./_stream_readable":154,"./_stream_writable":156,_process:149,"core-util-is":157,inherits:146}],153:[function(require,module,exports){module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");
util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":155,"core-util-is":157,inherits:146}],154:[function(require,module,exports){(function(process){module.exports=Readable;var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require("stream");var util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;util.inherits(Readable,Stream);function ReadableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=false;this.ended=false;this.endEmitted=false;this.reading=false;this.calledRead=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.objectMode=!!options.objectMode;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(typeof chunk==="string"&&!state.objectMode){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null||chunk===undefined){state.reading=false;if(!state.ended)onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);state.length+=state.objectMode?1:chunk.length;if(addToFront){state.buffer.unshift(chunk)}else{state.reading=false;state.buffer.push(chunk)}if(state.needReadable)emitReadable(stream);maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(n===null||isNaN(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else return state.length}return n}Readable.prototype.read=function(n){var state=this._readableState;state.calledRead=true;var nOrig=n;var ret;if(typeof n!=="number"||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){ret=null;if(state.length>0&&state.decoder){ret=fromList(n,state);state.length-=ret.length}if(state.length===0)endReadable(this);return ret}var doRead=state.needReadable;if(state.length-n<=state.highWaterMark)doRead=true;if(state.ended||state.reading)doRead=false;if(doRead){state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(state.ended&&!state.endEmitted&&state.length===0)endReadable(this);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;if(state.length>0)emitReadable(stream);else endReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(state.emittedReadable)return;state.emittedReadable=true;if(state.sync)process.nextTick(function(){emitReadable_(stream)});else emitReadable_(stream)}function emitReadable_(stream){stream.emit("readable")}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;process.nextTick(function(){maybeReadMore_(stream,state)})}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)process.nextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){if(readable!==src)return;cleanup()}function onend(){dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);if(!dest._writableState||dest._writableState.needDrain)ondrain()}function onerror(er){unpipe();dest.removeListener("error",onerror);if(EE.listenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){this.on("readable",pipeOnReadable);state.flowing=true;process.nextTick(function(){flow(src)})}return dest};function pipeOnDrain(src){return function(){var dest=this;var state=src._readableState;state.awaitDrain--;if(state.awaitDrain===0)flow(src)}}function flow(src){var state=src._readableState;var chunk;state.awaitDrain=0;function write(dest,i,list){var written=dest.write(chunk);if(false===written){state.awaitDrain++}}while(state.pipesCount&&null!==(chunk=src.read())){if(state.pipesCount===1)write(state.pipes,0,null);else forEach(state.pipes,write);src.emit("data",chunk);if(state.awaitDrain>0)return}if(state.pipesCount===0){state.flowing=false;if(EE.listenerCount(src,"data")>0)emitDataEvents(src);return}state.ranOut=true}function pipeOnReadable(){if(this._readableState.ranOut){this._readableState.ranOut=false;flow(this)}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&!this._readableState.flowing)emitDataEvents(this);if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){this.read(0)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.resume=function(){emitDataEvents(this);this.read(0);this.emit("resume")};Readable.prototype.pause=function(){emitDataEvents(this,true);this.emit("pause")};function emitDataEvents(stream,startPaused){var state=stream._readableState;if(state.flowing){throw new Error("Cannot switch to old mode now.")}var paused=startPaused||false;var readable=false;stream.readable=true;stream.pipe=Stream.prototype.pipe;stream.on=stream.addListener=Stream.prototype.on;stream.on("readable",function(){readable=true;var c;while(!paused&&null!==(c=stream.read()))stream.emit("data",c);if(c===null){readable=false;stream._readableState.needReadable=true}});stream.pause=function(){paused=true;this.emit("pause")};stream.resume=function(){paused=false;if(readable)process.nextTick(function(){stream.emit("readable")});else this.read(0);this.emit("resume")};stream.emit("readable")}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(typeof stream[i]==="function"&&typeof this[i]==="undefined"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted&&state.calledRead){state.ended=true;process.nextTick(function(){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}})}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{_process:149,buffer:5,"core-util-is":157,events:145,inherits:146,isarray:147,stream:163,"string_decoder/":158}],155:[function(require,module,exports){module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);if(cb)cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);var ts=this._transformState=new TransformState(options,this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;this.once("finish",function(){if("function"===typeof this._flush)this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var rs=stream._readableState;var ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":152,"core-util-is":157,inherits:146}],156:[function(require,module,exports){(function(process){module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream);function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb}function WritableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.objectMode=!!options.objectMode;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.buffer=[];this.errorEmitted=false}function Writable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er);process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=true;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);process.nextTick(function(){cb(er)});valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=function(){};if(state.ended)writeAfterEnd(this,state,cb);else if(validChunk(this,state,chunk,cb))ret=writeOrBuffer(this,state,chunk,encoding,cb);return ret};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing)state.buffer.push(new WriteReq(chunk,encoding,cb));else doWrite(stream,state,len,chunk,encoding,cb);return ret}function doWrite(stream,state,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){if(sync)process.nextTick(function(){cb(er)});else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);if(!finished&&!state.bufferProcessing&&state.buffer.length)clearBuffer(stream,state);if(sync){process.nextTick(function(){afterWrite(stream,state,finished,cb)})}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);cb();if(finished)finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c];var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,len,chunk,encoding,cb);if(state.writing){c++;break}}state.bufferProcessing=false;if(c<state.buffer.length)state.buffer=state.buffer.slice(c);else state.buffer.length=0}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(typeof chunk!=="undefined"&&chunk!==null)this.write(chunk,encoding);if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(stream,state){return state.ending&&state.length===0&&!state.finished&&!state.writing}function finishMaybe(stream,state){var need=needFinish(stream,state);if(need){state.finished=true;stream.emit("finish")}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)process.nextTick(cb);else stream.once("finish",cb)}state.ended=true}}).call(this,require("_process"))},{"./_stream_duplex":152,_process:149,buffer:5,"core-util-is":157,inherits:146,stream:163}],157:[function(require,module,exports){(function(Buffer){function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;function isBuffer(arg){return Buffer.isBuffer(arg)}exports.isBuffer=isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,require("buffer").Buffer)},{buffer:5}],158:[function(require,module,exports){var Buffer=require("buffer").Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr="";while(this.charLength){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return""}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}break}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=buffer.length>=3?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},{buffer:5}],159:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":153}],160:[function(require,module,exports){var Stream=require("stream");exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=Stream;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":152,"./lib/_stream_passthrough.js":153,"./lib/_stream_readable.js":154,"./lib/_stream_transform.js":155,"./lib/_stream_writable.js":156,stream:163}],161:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":155}],162:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":156}],163:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:145,inherits:146,"readable-stream/duplex.js":151,"readable-stream/passthrough.js":159,"readable-stream/readable.js":160,"readable-stream/transform.js":161,"readable-stream/writable.js":162}],164:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],165:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";
base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":164,_process:149,inherits:146}],166:[function(require,module,exports){var indexOf=require("indexof");var Object_keys=function(obj){if(Object.keys)return Object.keys(obj);else{var res=[];for(var key in obj)res.push(key);return res}};var forEach=function(xs,fn){if(xs.forEach)return xs.forEach(fn);else for(var i=0;i<xs.length;i++){fn(xs[i],i,xs)}};var defineProp=function(){try{Object.defineProperty({},"_",{});return function(obj,name,value){Object.defineProperty(obj,name,{writable:true,enumerable:false,configurable:true,value:value})}}catch(e){return function(obj,name,value){obj[name]=value}}}();var globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function NodeScript(code){if(!(this instanceof Script))return new Script(code);this.code=code};Script.prototype.runInContext=function(context){if(!(context instanceof Context)){throw new TypeError("needs a 'context' argument.")}var iframe=document.createElement("iframe");if(!iframe.style)iframe.style={};iframe.style.display="none";document.body.appendChild(iframe);var win=iframe.contentWindow;var wEval=win.eval,wExecScript=win.execScript;if(!wEval&&wExecScript){wExecScript.call(win,"null");wEval=win.eval}forEach(Object_keys(context),function(key){win[key]=context[key]});forEach(globals,function(key){if(context[key]){win[key]=context[key]}});var winKeys=Object_keys(win);var res=wEval.call(win,this.code);forEach(Object_keys(win),function(key){if(key in context||indexOf(winKeys,key)===-1){context[key]=win[key]}});forEach(globals,function(key){if(!(key in context)){defineProp(context,key,win[key])}});document.body.removeChild(iframe);return res};Script.prototype.runInThisContext=function(){return eval(this.code)};Script.prototype.runInNewContext=function(context){var ctx=Script.createContext(context);var res=this.runInContext(ctx);forEach(Object_keys(ctx),function(key){context[key]=ctx[key]});return res};forEach(Object_keys(Script.prototype),function(name){exports[name]=Script[name]=function(code){var s=Script(code);return s[name].apply(s,[].slice.call(arguments,1))}});exports.createScript=function(code){return exports.Script(code)};exports.createContext=Script.createContext=function(context){var copy=new Context;if(typeof context==="object"){forEach(Object_keys(context),function(key){copy[key]=context[key]})}return copy}},{indexof:167}],167:[function(require,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],168:[function(require,module,exports){exports=module.exports=require("./debug");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;var storage;if(typeof chrome!=="undefined"&&typeof chrome.storage!=="undefined")storage=chrome.storage.local;else storage=window.localStorage;exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if("%%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){storage.removeItem("debug")}else{storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=storage.debug}catch(e){}return r}exports.enable(load())},{"./debug":169}],169:[function(require,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=require("ms");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args=["%o"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match==="%%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if("function"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||"").split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:170}],170:[function(require,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if("string"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){var match=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"h":return n*h;case"minutes":case"minute":case"m":return n*m;case"seconds":case"second":case"s":return n*s;case"ms":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+"d";if(ms>=h)return Math.round(ms/h)+"h";if(ms>=m)return Math.round(ms/m)+"m";if(ms>=s)return Math.round(ms/s)+"s";return ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+" "+name;return Math.ceil(ms/n)+" "+name+"s"}},{}],171:[function(require,module,exports){var utils=require("./utils"),path=require("path"),dirname=path.dirname,extname=path.extname,join=path.join,fs=require("fs"),read=fs.readFileSync;var filters=exports.filters=require("./filters");var cache={};exports.clearCache=function(){cache={}};function filtered(js){return js.substr(1).split("|").reduce(function(js,filter){var parts=filter.split(":"),name=parts.shift(),args=parts.join(":")||"";if(args)args=", "+args;return"filters."+name+"("+js+args+")"})}function rethrow(err,str,filename,lineno){var lines=str.split("\n"),start=Math.max(lineno-3,0),end=Math.min(lines.length,lineno+3);var context=lines.slice(start,end).map(function(line,i){var curr=i+start+1;return(curr==lineno?" >> ":"    ")+curr+"| "+line}).join("\n");err.path=filename;err.message=(filename||"ejs")+":"+lineno+"\n"+context+"\n\n"+err.message;throw err}var parse=exports.parse=function(str,options){var options=options||{},open=options.open||exports.open||"<%",close=options.close||exports.close||"%>",filename=options.filename,compileDebug=options.compileDebug!==false,buf="";buf+="var buf = [];";if(false!==options._with)buf+="\nwith (locals || {}) { (function(){ ";buf+="\n buf.push('";var lineno=1;var consumeEOL=false;for(var i=0,len=str.length;i<len;++i){var stri=str[i];if(str.slice(i,open.length+i)==open){i+=open.length;var prefix,postfix,line=(compileDebug?"__stack.lineno=":"")+lineno;switch(str[i]){case"=":prefix="', escape(("+line+", ";postfix=")), '";++i;break;case"-":prefix="', ("+line+", ";postfix="), '";++i;break;default:prefix="');"+line+";";postfix="; buf.push('"}var end=str.indexOf(close,i);if(end<0){throw new Error('Could not find matching close tag "'+close+'".')}var js=str.substring(i,end),start=i,include=null,n=0;if("-"==js[js.length-1]){js=js.substring(0,js.length-2);consumeEOL=true}if(0==js.trim().indexOf("include")){var name=js.trim().slice(7).trim();if(!filename)throw new Error("filename option is required for includes");var path=resolveInclude(name,filename);include=read(path,"utf8");include=exports.parse(include,{filename:path,_with:false,open:open,close:close,compileDebug:compileDebug});buf+="' + (function(){"+include+"})() + '";js=""}while(~(n=js.indexOf("\n",n)))n++,lineno++;if(js.substr(0,1)==":")js=filtered(js);if(js){if(js.lastIndexOf("//")>js.lastIndexOf("\n"))js+="\n";buf+=prefix;buf+=js;buf+=postfix}i+=end-start+close.length-1}else if(stri=="\\"){buf+="\\\\"}else if(stri=="'"){buf+="\\'"}else if(stri=="\r"){}else if(stri=="\n"){if(consumeEOL){consumeEOL=false}else{buf+="\\n";lineno++}}else{buf+=stri}}if(false!==options._with)buf+="'); })();\n} \nreturn buf.join('');";else buf+="');\nreturn buf.join('');";return buf};var compile=exports.compile=function(str,options){options=options||{};var escape=options.escape||utils.escape;var input=JSON.stringify(str),compileDebug=options.compileDebug!==false,client=options.client,filename=options.filename?JSON.stringify(options.filename):"undefined";if(compileDebug){str=["var __stack = { lineno: 1, input: "+input+", filename: "+filename+" };",rethrow.toString(),"try {",exports.parse(str,options),"} catch (err) {","  rethrow(err, __stack.input, __stack.filename, __stack.lineno);","}"].join("\n")}else{str=exports.parse(str,options)}if(options.debug)console.log(str);if(client)str="escape = escape || "+escape.toString()+";\n"+str;try{var fn=new Function("locals, filters, escape, rethrow",str)}catch(err){if("SyntaxError"==err.name){err.message+=options.filename?" in "+filename:" while compiling ejs"}throw err}if(client)return fn;return function(locals){return fn.call(this,locals,filters,escape,rethrow)}};exports.render=function(str,options){var fn,options=options||{};if(options.cache){if(options.filename){fn=cache[options.filename]||(cache[options.filename]=compile(str,options))}else{throw new Error('"cache" option requires "filename".')}}else{fn=compile(str,options)}options.__proto__=options.locals;return fn.call(options.scope,options)};exports.renderFile=function(path,options,fn){var key=path+":string";if("function"==typeof options){fn=options,options={}}options.filename=path;var str;try{str=options.cache?cache[key]||(cache[key]=read(path,"utf8")):read(path,"utf8")}catch(err){fn(err);return}fn(null,exports.render(str,options))};function resolveInclude(name,filename){var path=join(dirname(filename),name);var ext=extname(name);if(!ext)path+=".ejs";return path}exports.__express=exports.renderFile;if(require.extensions){require.extensions[".ejs"]=function(module,filename){filename=filename||module.filename;var options={filename:filename,client:true},template=fs.readFileSync(filename).toString(),fn=compile(template,options);module._compile("module.exports = "+fn.toString()+";",filename)}}else if(require.registerExtension){require.registerExtension(".ejs",function(src){return compile(src,{})})}},{"./filters":172,"./utils":173,fs:3,path:148}],172:[function(require,module,exports){exports.first=function(obj){return obj[0]};exports.last=function(obj){return obj[obj.length-1]};exports.capitalize=function(str){str=String(str);return str[0].toUpperCase()+str.substr(1,str.length)};exports.downcase=function(str){return String(str).toLowerCase()};exports.upcase=function(str){return String(str).toUpperCase()};exports.sort=function(obj){return Object.create(obj).sort()};exports.sort_by=function(obj,prop){return Object.create(obj).sort(function(a,b){a=a[prop],b=b[prop];if(a>b)return 1;if(a<b)return-1;return 0})};exports.size=exports.length=function(obj){return obj.length};exports.plus=function(a,b){return Number(a)+Number(b)};exports.minus=function(a,b){return Number(a)-Number(b)};exports.times=function(a,b){return Number(a)*Number(b)};exports.divided_by=function(a,b){return Number(a)/Number(b)};exports.join=function(obj,str){return obj.join(str||", ")};exports.truncate=function(str,len,append){str=String(str);if(str.length>len){str=str.slice(0,len);if(append)str+=append}return str};exports.truncate_words=function(str,n){var str=String(str),words=str.split(/ +/);return words.slice(0,n).join(" ")};exports.replace=function(str,pattern,substitution){return String(str).replace(pattern,substitution||"")};exports.prepend=function(obj,val){return Array.isArray(obj)?[val].concat(obj):val+obj};exports.append=function(obj,val){return Array.isArray(obj)?obj.concat(val):obj+val};exports.map=function(arr,prop){return arr.map(function(obj){return obj[prop]})};exports.reverse=function(obj){return Array.isArray(obj)?obj.reverse():String(obj).split("").reverse().join("")};exports.get=function(obj,prop){return obj[prop]};exports.json=function(obj){return JSON.stringify(obj)}},{}],173:[function(require,module,exports){exports.escape=function(html){return String(html).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")}},{}],174:[function(require,module,exports){"use strict";var isEmpty=require("es5-ext/object/is-empty"),value=require("es5-ext/object/valid-value"),hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=function(obj){var type;value(obj);type=arguments[1];if(arguments.length>1){return hasOwnProperty.call(obj,"__ee__")&&Boolean(obj.__ee__[type])}return obj.hasOwnProperty("__ee__")&&!isEmpty(obj.__ee__)}},{"es5-ext/object/is-empty":181,"es5-ext/object/valid-value":187}],175:[function(require,module,exports){"use strict";var d=require("d"),callable=require("es5-ext/object/valid-callable"),apply=Function.prototype.apply,call=Function.prototype.call,create=Object.create,defineProperty=Object.defineProperty,defineProperties=Object.defineProperties,hasOwnProperty=Object.prototype.hasOwnProperty,descriptor={configurable:true,enumerable:false,writable:true},on,once,off,emit,methods,descriptors,base;on=function(type,listener){var data;callable(listener);if(!hasOwnProperty.call(this,"__ee__")){data=descriptor.value=create(null);defineProperty(this,"__ee__",descriptor);descriptor.value=null}else{data=this.__ee__}if(!data[type])data[type]=listener;else if(typeof data[type]==="object")data[type].push(listener);else data[type]=[data[type],listener];if(type==="connected"){console.log("data[type] : ",data[type])}return this};once=function(type,listener){var once,self;callable(listener);self=this;on.call(this,type,once=function(){off.call(self,type,once);apply.call(listener,this,arguments)});once.__eeOnceListener__=listener;return this};off=function(type,listener){var data,listeners,candidate,i;callable(listener);if(!hasOwnProperty.call(this,"__ee__"))return this;data=this.__ee__;if(!data[type])return this;listeners=data[type];if(typeof listeners==="object"){for(i=0;candidate=listeners[i];++i){if(candidate===listener||candidate.__eeOnceListener__===listener){if(listeners.length===2)data[type]=listeners[i?0:1];else listeners.splice(i,1)}}}else{if(listeners===listener||listeners.__eeOnceListener__===listener){delete data[type]}}return this};emit=function(type){var i,l,listener,listeners,args;if(!hasOwnProperty.call(this,"__ee__"))return;listeners=this.__ee__[type];if(!listeners)return;if(typeof listeners==="object"){l=arguments.length;args=new Array(l-1);for(i=1;i<l;++i)args[i-1]=arguments[i];listeners=listeners.slice();for(i=0;listener=listeners[i];++i){apply.call(listener,this,args)}}else{switch(arguments.length){case 1:call.call(listeners,this);break;case 2:call.call(listeners,this,arguments[1]);break;case 3:call.call(listeners,this,arguments[1],arguments[2]);break;default:l=arguments.length;args=new Array(l-1);for(i=1;i<l;++i){args[i-1]=arguments[i]}apply.call(listeners,this,args)}}};methods={on:on,once:once,off:off,emit:emit};descriptors={on:d(on),once:d(once),off:d(off),emit:d(emit)};base=defineProperties({},descriptors);module.exports=exports=function(o){return o==null?create(base):defineProperties(Object(o),descriptors)};exports.methods=methods},{d:176,"es5-ext/object/valid-callable":186}],176:[function(require,module,exports){"use strict";var assign=require("es5-ext/object/assign"),normalizeOpts=require("es5-ext/object/normalize-options"),isCallable=require("es5-ext/object/is-callable"),contains=require("es5-ext/string/#/contains"),d;d=module.exports=function(dscr,value){var c,e,w,options,desc;if(arguments.length<2||typeof dscr!=="string"){options=value;value=dscr;dscr=null}else{options=arguments[2]}if(dscr==null){c=w=true;e=false}else{c=contains.call(dscr,"c");e=contains.call(dscr,"e");w=contains.call(dscr,"w")}desc={value:value,configurable:c,enumerable:e,writable:w};return!options?desc:assign(normalizeOpts(options),desc)};d.gs=function(dscr,get,set){var c,e,options,desc;if(typeof dscr!=="string"){options=set;set=get;get=dscr;dscr=null}else{options=arguments[3]}if(get==null){get=undefined}else if(!isCallable(get)){options=get;get=set=undefined}else if(set==null){set=undefined}else if(!isCallable(set)){options=set;set=undefined}if(dscr==null){c=true;e=false}else{c=contains.call(dscr,"c");e=contains.call(dscr,"e")}desc={get:get,set:set,configurable:c,enumerable:e};return!options?desc:assign(normalizeOpts(options),desc)}},{"es5-ext/object/assign":177,"es5-ext/object/is-callable":180,"es5-ext/object/normalize-options":185,"es5-ext/string/#/contains":188}],177:[function(require,module,exports){"use strict";module.exports=require("./is-implemented")()?Object.assign:require("./shim")},{"./is-implemented":178,"./shim":179}],178:[function(require,module,exports){"use strict";module.exports=function(){var assign=Object.assign,obj;if(typeof assign!=="function")return false;obj={foo:"raz"};assign(obj,{bar:"dwa"},{trzy:"trzy"});return obj.foo+obj.bar+obj.trzy==="razdwatrzy"}},{}],179:[function(require,module,exports){"use strict";var keys=require("../keys"),value=require("../valid-value"),max=Math.max;module.exports=function(dest,src){var error,i,l=max(arguments.length,2),assign;dest=Object(value(dest));assign=function(key){try{dest[key]=src[key]}catch(e){if(!error)error=e}};for(i=1;i<l;++i){src=arguments[i];keys(src).forEach(assign)}if(error!==undefined)throw error;return dest}},{"../keys":182,"../valid-value":187}],180:[function(require,module,exports){"use strict";module.exports=function(obj){return typeof obj==="function"}},{}],181:[function(require,module,exports){"use strict";var value=require("./valid-value"),propertyIsEnumerable=Object.prototype.propertyIsEnumerable;module.exports=function(obj){var i;value(obj);for(i in obj){if(propertyIsEnumerable.call(obj,i))return false}return true}},{"./valid-value":187}],182:[function(require,module,exports){"use strict";module.exports=require("./is-implemented")()?Object.keys:require("./shim")},{"./is-implemented":183,"./shim":184}],183:[function(require,module,exports){"use strict";module.exports=function(){try{Object.keys("primitive");return true}catch(e){return false}}},{}],184:[function(require,module,exports){"use strict";var keys=Object.keys;module.exports=function(object){return keys(object==null?object:Object(object))}},{}],185:[function(require,module,exports){"use strict";var forEach=Array.prototype.forEach,create=Object.create;var process=function(src,obj){var key;for(key in src)obj[key]=src[key]};module.exports=function(options){var result=create(null);forEach.call(arguments,function(options){if(options==null)return;process(Object(options),result)});return result}},{}],186:[function(require,module,exports){"use strict";module.exports=function(fn){if(typeof fn!=="function")throw new TypeError(fn+" is not a function");return fn}},{}],187:[function(require,module,exports){"use strict";module.exports=function(value){if(value==null)throw new TypeError("Cannot use null or undefined");return value}},{}],188:[function(require,module,exports){"use strict";module.exports=require("./is-implemented")()?String.prototype.contains:require("./shim")},{"./is-implemented":189,"./shim":190}],189:[function(require,module,exports){"use strict";var str="razdwatrzy";module.exports=function(){if(typeof str.contains!=="function")return false;return str.contains("dwa")===true&&str.contains("foo")===false}},{}],190:[function(require,module,exports){"use strict";var indexOf=String.prototype.indexOf;module.exports=function(searchString){return indexOf.call(this,searchString,arguments[1])>-1}},{}],191:[function(require,module,exports){var grammar=module.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-]*)\/(\d*)(?:\s*\/(\S*))?/,names:["payload","codec","rate","encoding"],format:function(o){return o.encoding?"rtpmap:%d %s/%s/%s":"rtpmap:%d %s/%s"}},{push:"fmtp",reg:/^fmtp:(\d*) (\S*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(o){return o.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(o){return o.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(o){return o.config!=null?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(o){return o.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:(\w*)/,format:"mid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/,format:"%s"},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","generation"],format:function(o){var str="candidate:%s %d %s %d %s %d typ %s";str+=o.raddr!=null?" raddr %s rport %d":"%v%v";if(o.generation!=null){str+=" generation %d"}return str}},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{name:"msidSemantic",reg:/^msid-semantic: (\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{push:"invalid",names:["value"]}]};Object.keys(grammar).forEach(function(key){var objs=grammar[key];objs.forEach(function(obj){if(!obj.reg){obj.reg=/(.*)/}if(!obj.format){obj.format="%s"}})})},{}],192:[function(require,module,exports){var parser=require("./parser");var writer=require("./writer");exports.write=writer;exports.parse=parser.parse;exports.parseFmtpConfig=parser.parseFmtpConfig;exports.parsePayloads=parser.parsePayloads;exports.parseRemoteCandidates=parser.parseRemoteCandidates},{"./parser":193,"./writer":194}],193:[function(require,module,exports){var toIntIfInt=function(v){return String(Number(v))===v?Number(v):v};var attachProperties=function(match,location,names,rawName){if(rawName&&!names){location[rawName]=toIntIfInt(match[1])}else{for(var i=0;i<names.length;i+=1){if(match[i+1]!=null){location[names[i]]=toIntIfInt(match[i+1])}}}};var parseReg=function(obj,location,content){var needsBlank=obj.name&&obj.names;if(obj.push&&!location[obj.push]){location[obj.push]=[]}else if(needsBlank&&!location[obj.name]){location[obj.name]={}}var keyLocation=obj.push?{}:needsBlank?location[obj.name]:location;attachProperties(content.match(obj.reg),keyLocation,obj.names,obj.name);if(obj.push){location[obj.push].push(keyLocation)}};var grammar=require("./grammar");var validLine=RegExp.prototype.test.bind(/^([a-z])=(.*)/);exports.parse=function(sdp){var session={},media=[],location=session;sdp.split("\r\n").filter(validLine).forEach(function(l){var type=l[0];
var content=l.slice(2);if(type==="m"){media.push({rtp:[],fmtp:[]});location=media[media.length-1]}for(var j=0;j<(grammar[type]||[]).length;j+=1){var obj=grammar[type][j];if(obj.reg.test(content)){return parseReg(obj,location,content)}}});session.media=media;return session};var fmtpReducer=function(acc,expr){var s=expr.split("=");if(s.length===2){acc[s[0]]=toIntIfInt(s[1])}return acc};exports.parseFmtpConfig=function(str){return str.split(";").reduce(fmtpReducer,{})};exports.parsePayloads=function(str){return str.split(" ").map(Number)};exports.parseRemoteCandidates=function(str){var candidates=[];var parts=str.split(" ").map(toIntIfInt);for(var i=0;i<parts.length;i+=3){candidates.push({component:parts[i],ip:parts[i+1],port:parts[i+2]})}return candidates}},{"./grammar":191}],194:[function(require,module,exports){var grammar=require("./grammar");var formatRegExp=/%[sdv%]/g;var format=function(formatStr){var i=1;var args=arguments;var len=args.length;return formatStr.replace(formatRegExp,function(x){if(i>=len){return x}var arg=args[i];i+=1;switch(x){case"%%":return"%";case"%s":return String(arg);case"%d":return Number(arg);case"%v":return""}})};var makeLine=function(type,obj,location){var str=obj.format instanceof Function?obj.format(obj.push?location:location[obj.name]):obj.format;var args=[type+"="+str];if(obj.names){for(var i=0;i<obj.names.length;i+=1){var n=obj.names[i];if(obj.name){args.push(location[obj.name][n])}else{args.push(location[obj.names[i]])}}}else{args.push(location[obj.name])}return format.apply(null,args)};var defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"];var defaultInnerOrder=["i","c","b","a"];module.exports=function(session,opts){opts=opts||{};if(session.version==null){session.version=0}if(session.name==null){session.name=" "}session.media.forEach(function(mLine){if(mLine.payloads==null){mLine.payloads=""}});var outerOrder=opts.outerOrder||defaultOuterOrder;var innerOrder=opts.innerOrder||defaultInnerOrder;var sdp=[];outerOrder.forEach(function(type){grammar[type].forEach(function(obj){if(obj.name in session){sdp.push(makeLine(type,obj,session))}else if(obj.push in session){session[obj.push].forEach(function(el){sdp.push(makeLine(type,obj,el))})}})});session.media.forEach(function(mLine){sdp.push(makeLine("m",grammar.m[0],mLine));innerOrder.forEach(function(type){grammar[type].forEach(function(obj){if(obj.name in mLine){sdp.push(makeLine(type,obj,mLine))}else if(obj.push in mLine){mLine[obj.push].forEach(function(el){sdp.push(makeLine(type,obj,el))})}})})});return sdp.join("\r\n")+"\r\n"}},{"./grammar":191}],195:[function(require,module,exports){var global=function(){return this}();var WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null;function ws(uri,protocols,opts){var instance;if(protocols){instance=new WebSocket(uri,protocols)}else{instance=new WebSocket(uri)}return instance}if(WebSocket)ws.prototype=WebSocket.prototype},{}],196:[function(require,module,exports){module.exports={name:"exsip",title:"ExSIP",description:"BroadSoft Javascript SIP library",version:"2.0.0",homepage:"http://www.broadsoft.com",author:"BroadSoft, Inc.",contributors:[{url:""}],main:"src/ExSIP.js",repository:{type:"git",url:""},keywords:["sip","websocket","webrtc","library"],dependencies:{"sdp-transform":"0.6.1",ws:"0.4.32"},devDependencies:{nodeunit:"0.9.0",grunt:"0.4.5","grunt-contrib-jshint":"0.10.0","grunt-contrib-concat":"0.5.0","grunt-contrib-nodeunit":"0.4.1","grunt-contrib-uglify":"0.6.0","grunt-contrib-watch":"0.6.1","grunt-contrib-symlink":"0.3.0","grunt-browserify":"3.0.1","grunt-jsdoc":"0.5.7","grunt-notify":">=0.2.6","grunt-bumpx":"0.1.5",pegjs:"0.7.0"},engines:{node:">=0.8"},license:"MIT",scripts:{test:"grunt travis --verbose"}}},{}],197:[function(require,module,exports){var pkg=require("../package.json");var C={USER_AGENT:"BroadSoft WebRTC Client - "+pkg.version,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",BYE:"Terminated",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout",NOT_ACCEPTABLE_ERROR:"Not Acceptable"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488],AUTHENTICATION_ERROR:[401,407],NOT_ACCEPTABLE_ERROR:[606]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",REFER:"REFER",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",SENDONLY:"sendonly",RECVONLY:"recvonly",SENDRECV:"sendrecv",INACTIVE:"inactive",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"ExSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69};module.exports=C},{"../package.json":196}],198:[function(require,module,exports){module.exports=Dialog;var C={STATUS_EARLY:1,STATUS_CONFIRMED:2};Dialog.C=C;var SIPMessage=require("./SIPMessage");var ExSIP_C=require("./Constants");var Transactions=require("./Transactions");var Utils=require("./Utils");var Dialog_RequestSender=require("./Dialog/RequestSender");function Dialog(owner,message,type,state){var contact;this.uac_pending_reply=false;this.uas_pending_reply=false;this.is_acknowledged=false;this.type=type;if(!message.hasHeader("contact")){return{error:"unable to create a Dialog without Contact header field"}}if(message instanceof SIPMessage.IncomingResponse){state=message.status_code<200?C.STATUS_EARLY:C.STATUS_CONFIRMED}else{state=state||C.STATUS_CONFIRMED}contact=message.parseHeader("contact");if(type==="UAS"){this.id={call_id:message.call_id,local_tag:message.to_tag,remote_tag:message.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}};this.state=state;this.remote_seqnum=message.cseq;this.local_uri=message.parseHeader("to").uri;this.remote_uri=message.parseHeader("from").uri;this.remote_target=contact.uri;this.route_set=message.getHeaders("record-route")}else if(type==="UAC"){this.id={call_id:message.call_id,local_tag:message.from_tag,remote_tag:message.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}};this.state=state;this.local_seqnum=message.cseq;this.local_uri=message.parseHeader("from").uri;this.remote_uri=message.parseHeader("to").uri;this.remote_target=contact.uri;this.route_set=message.getHeaders("record-route").reverse()}this.logger=owner.ua.getLogger("ExSIP.dialog",this.id.toString());this.owner=owner;owner.ua.dialogs[this.id.toString()]=this;this.logger.debug("new "+type+" dialog created with status "+(this.state===C.STATUS_EARLY?"EARLY":"CONFIRMED"))}Dialog.prototype={isUAS:function(){return this.type==="UAS"},isUAC:function(){return this.type==="UAC"},update:function(message,type){this.state=C.STATUS_CONFIRMED;this.logger.debug("dialog "+this.id.toString()+"  changed to CONFIRMED state");if(type==="UAC"){this.route_set=message.getHeaders("record-route").reverse()}},terminate:function(){this.logger.debug("dialog "+this.id.toString()+" deleted");delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(method,extraHeaders,body){var cseq,request;extraHeaders=extraHeaders&&extraHeaders.slice()||[];if(!this.local_seqnum){this.local_seqnum=Math.floor(Math.random()*1e4)}cseq=method===ExSIP_C.CANCEL||method===ExSIP_C.ACK?this.local_seqnum:this.local_seqnum+=1;request=new SIPMessage.OutgoingRequest(method,this.remote_target,this.owner.ua,{cseq:cseq,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},extraHeaders,body);this.logger.debug("createRequest : dialog.request_sender.request.extraHeaders : "+Utils.toString(request.extraHeaders));request.dialog=this;return request},checkInDialogRequest:function(request){var self=this;if(request.method===ExSIP_C.INVITE||request.method===ExSIP_C.UPDATE&&request.body){if(this.uac_pending_reply===true){request.reply(491)}else if(this.uas_pending_reply===true||this.type==="UAS"&&!this.is_acknowledged){var retryAfter=(Math.random()*10|0)+1;request.reply(500,null,["Retry-After:"+retryAfter]);return false}else{this.uas_pending_reply=true;request.server_transaction.on("stateChanged",function stateChanged(e){if(e.sender.state===Transactions.C.STATUS_ACCEPTED||e.sender.state===Transactions.C.STATUS_COMPLETED||e.sender.state===Transactions.C.STATUS_TERMINATED){request.server_transaction.removeListener("stateChanged",stateChanged);self.uas_pending_reply=false;if(self.uac_pending_reply===false){self.owner.onReadyToReinvite()}}})}if(request.hasHeader("contact")){request.server_transaction.on("stateChanged",function(e){if(e.sender.state===Transactions.C.STATUS_ACCEPTED){self.remote_target=request.parseHeader("contact").uri}})}}else if(request.method===ExSIP_C.NOTIFY){if(request.hasHeader("contact")){request.server_transaction.on("stateChanged",function(e){if(e.sender.state===Transactions.C.STATUS_COMPLETED){self.remote_target=request.parseHeader("contact").uri}})}}else if(request.method===ExSIP_C.ACK){this.is_acknowledged=true}if(!this.remote_seqnum){this.remote_seqnum=request.cseq}else if(request.cseq<this.remote_seqnum){if(request.method!==ExSIP_C.ACK){request.reply(500)}return false}else if(request.cseq>this.remote_seqnum){this.remote_seqnum=request.cseq}return true},createRequestSender:function(applicant,method,options){options=options||{};var extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],body=options.body||null,request=this.createRequest(method,extraHeaders,body),request_sender=new Dialog_RequestSender(this,applicant,request);this.logger.debug("dialog.request_sender.request.extraHeaders : "+Utils.toString(request.extraHeaders));return request_sender},sendRequest:function(applicant,method,options){var request_sender=this.createRequestSender(applicant,method,options);request_sender.send()},receiveRequest:function(request){if(!this.checkInDialogRequest(request)){return}this.owner.receiveRequest(request)}}},{"./Constants":197,"./Dialog/RequestSender":199,"./SIPMessage":216,"./Transactions":218,"./Utils":222}],199:[function(require,module,exports){module.exports=DialogRequestSender;var ExSIP_C=require("../Constants");var Transactions=require("../Transactions");var RTCSession=require("../RTCSession");var RequestSender=require("../RequestSender");function DialogRequestSender(dialog,applicant,request){this.dialog=dialog;this.applicant=applicant;this.request=request;this.logger=dialog.owner.ua.getLogger("ExSIP.dialog.requestsender",dialog.id);this.reattempt=false;this.reattemptTimer=null}DialogRequestSender.prototype={send:function(callbacks){var self=this,request_sender=new RequestSender(this,this.dialog.owner.ua);request_sender.send(callbacks);if(this.request.method===ExSIP_C.INVITE&&request_sender.clientTransaction.state!==Transactions.C.STATUS_TERMINATED){this.dialog.uac_pending_reply=true;request_sender.clientTransaction.on("stateChanged",function stateChanged(e){if(e.sender.state===Transactions.C.STATUS_ACCEPTED||e.sender.state===Transactions.C.STATUS_COMPLETED||e.sender.state===Transactions.C.STATUS_TERMINATED){request_sender.clientTransaction.removeListener("stateChanged",stateChanged);self.dialog.uac_pending_reply=false;if(self.dialog.uas_pending_reply===false){self.dialog.owner.onReadyToReinvite()}}})}},onRequestTimeout:function(){this.logger.log("********* onRequestTimeout : ",this.applicant);this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(response){var self=this;this.logger.debug("receiveResponse : "+response);if(response.status_code===408||response.status_code===481){this.applicant.onDialogError(response)}else if(response.method===ExSIP_C.INVITE&&response.status_code===491){if(this.reattempt){this.applicant.receiveResponse(response)}else{this.request.cseq.value=this.dialog.local_seqnum+=1;this.reattemptTimer=setTimeout(function(){if(self.applicant.owner.status!==RTCSession.C.STATUS_TERMINATED){self.reattempt=true;self.request_sender.send()}},this.getReattemptTimeout())}}else{this.applicant.receiveResponse(response)}}}},{"../Constants":197,"../RTCSession":210,"../RequestSender":215,"../Transactions":218}],200:[function(require,module,exports){module.exports=DigestAuthentication;function DigestAuthentication(ua){this.logger=ua.getLogger("ExSIP.digestauthentication");this.username=ua.configuration.authorization_user;this.password=ua.configuration.password;this.cnonce=null;this.nc=0;this.ncHex="00000000";this.response=null}var Utils=require("./Utils");DigestAuthentication.prototype.authenticate=function(request,challenge){this.algorithm=challenge.algorithm;this.realm=challenge.realm;this.nonce=challenge.nonce;this.opaque=challenge.opaque;this.stale=challenge.stale;if(this.algorithm){if(this.algorithm!=="MD5"){this.logger.warn('challenge with Digest algorithm different than "MD5", authentication aborted');return false}}else{this.algorithm="MD5"}if(!this.realm){this.logger.warn("challenge without Digest realm, authentication aborted");return false}if(!this.nonce){this.logger.warn("challenge without Digest nonce, authentication aborted");return false}if(challenge.qop){if(challenge.qop.indexOf("auth")>-1){this.qop="auth"}else if(challenge.qop.indexOf("auth-int")>-1){this.qop="auth-int"}else{this.logger.warn('challenge without Digest qop different than "auth" or "auth-int", authentication aborted');return false}}else{this.qop=null}this.method=request.method;this.uri=request.ruri;this.cnonce=Utils.createRandomToken(12);this.nc+=1;this.updateNcHex();if(this.nc===4294967296){this.nc=1;this.ncHex="00000001"}this.calculateResponse();return true};DigestAuthentication.prototype.calculateResponse=function(){var ha1,ha2;ha1=Utils.calculateMD5(this.username+":"+this.realm+":"+this.password);if(this.qop==="auth"){ha2=Utils.calculateMD5(this.method+":"+this.uri);this.response=Utils.calculateMD5(ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+ha2)}else if(this.qop==="auth-int"){ha2=Utils.calculateMD5(this.method+":"+this.uri+":"+Utils.calculateMD5(this.body?this.body:""));this.response=Utils.calculateMD5(ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+ha2)}else if(this.qop===null){ha2=Utils.calculateMD5(this.method+":"+this.uri);this.response=Utils.calculateMD5(ha1+":"+this.nonce+":"+ha2)}};DigestAuthentication.prototype.toString=function(){var auth_params=[];if(!this.response){throw new Error("response field does not exist, cannot generate Authorization header")}auth_params.push("algorithm="+this.algorithm);auth_params.push('username="'+this.username+'"');auth_params.push('realm="'+this.realm+'"');auth_params.push('nonce="'+this.nonce+'"');auth_params.push('uri="'+this.uri+'"');auth_params.push('response="'+this.response+'"');if(this.opaque){auth_params.push('opaque="'+this.opaque+'"')}if(this.qop){auth_params.push("qop="+this.qop);auth_params.push('cnonce="'+this.cnonce+'"');auth_params.push("nc="+this.ncHex)}return"Digest "+auth_params.join(", ")};DigestAuthentication.prototype.updateNcHex=function(){var hex=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-hex.length)+hex}},{"./Utils":222}],201:[function(require,module,exports){module.exports=EventEmitter;function EventEmitter(){}var LoggerFactory=require("./LoggerFactory");function Event(type,sender,data){this.type=type;this.sender=sender;this.data=data}var logger=(new LoggerFactory).getLogger("ExSIP.eventemitter"),C={MAX_LISTENERS:50};EventEmitter.prototype={initEvents:function(events){var idx,length;if(!this.logger){this.logger=logger}this.maxListeners=C.MAX_LISTENERS;this.events={};this.oneTimeListeners={};length=events.length;for(idx=0;idx<length;idx++){this.events[events[idx]]=[];this.oneTimeListeners[events[idx]]=[]}},checkEvent:function(event){return!!this.events[event]},addListener:function(event,listener){if(listener===undefined){return}else if(typeof listener!=="function"){this.logger.error("listener must be a function");return}else if(!this.checkEvent(event)){this.logger.error("unable to add a listener to a nonexistent event "+event);return}if(this.events[event].length>=this.maxListeners){this.logger.warn("max listeners exceeded for event "+event)}this.events[event].push(listener)},on:function(event,listener){this.addListener(event,listener)},once:function(event,listener){this.on(event,listener);this.oneTimeListeners[event].push(listener)},removeListener:function(event,listener){var events,length,idx=0;if(listener===undefined){return}else if(typeof listener!=="function"){this.logger.error("listener must be a function");return}else if(!this.checkEvent(event)){this.logger.error("unable to remove a listener from a nonexistent event"+event);return}events=this.events[event];length=events.length;while(idx<length){if(events[idx]===listener){events.splice(idx,1)}else{idx++}}},removeAllListener:function(event){if(!this.checkEvent(event)){this.logger.error("unable to remove listeners from a nonexistent event"+event);return}this.events[event]=[];this.oneTimeListeners[event]=[]},setMaxListeners:function(listeners){if(typeof listeners!=="number"||listeners<0){this.logger.error("listeners must be a positive number");return}this.maxListeners=listeners},listeners:function(event){if(!this.checkEvent(event)){this.logger.error("no event "+event);return}return this.events[event]},emit:function(event,sender,data){var listeners,length,e,idx,self=this;if(!this.checkEvent(event)){this.logger.error("unable to emit a nonexistent event"+event);return}this.logger.debug("emitting event "+event);listeners=this.events[event];length=listeners.length;e=new Event(event,sender,data);listeners.map(function(listener){return function(){listener.call(null,e)}}).forEach(function(callback){try{callback()}catch(err){self.logger.error(err.stack)}});for(idx in this.oneTimeListeners[event]){this.removeListener(event,this.oneTimeListeners[event][idx])}this.oneTimeListeners[event]=[]}}},{"./LoggerFactory":206}],202:[function(require,module,exports){var ExSIP={C:require("./Constants"),Exceptions:require("./Exceptions"),Utils:require("./Utils"),UA:require("./UA"),URI:require("./URI"),NameAddrHeader:require("./NameAddrHeader"),Grammar:require("./Grammar"),WebRTC:require("./WebRTC"),RTCSession:require("./RTCSession")};module.exports=ExSIP;var pkg=require("../package.json");Object.defineProperties(ExSIP,{name:{get:function(){return pkg.title}},version:{get:function(){return pkg.version}}})},{"../package.json":196,"./Constants":197,"./Exceptions":203,"./Grammar":204,"./NameAddrHeader":208,"./RTCSession":210,"./UA":220,"./URI":221,"./Utils":222,"./WebRTC":223}],203:[function(require,module,exports){var Exceptions={ConfigurationError:function(){var exception=function(parameter,value){console.trace("----------------------ConfigurationError : "+parameter+", "+value);this.code=1;this.name="CONFIGURATION_ERROR";this.parameter=parameter;this.value=value;this.message=!this.value?"Missing parameter: "+this.parameter:"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"'};exception.prototype=new Error;return exception}(),InvalidStateError:function(){var exception=function(status){console.trace("----------------------InvalidStateError : "+status);this.code=2;this.name="INVALID_STATE_ERROR";this.status=status;this.message="Invalid status: "+status};exception.prototype=new Error;return exception}(),NotSupportedError:function(){var exception=function(message){console.trace("----------------------NotSupportedError : "+message);this.code=3;this.name="NOT_SUPPORTED_ERROR";this.message=message};exception.prototype=new Error;return exception}(),NotReadyError:function(){var exception=function(message){console.trace("----------------------NotReadyError : "+message);this.code=4;this.name="NOT_READY_ERROR";this.message=message};exception.prototype=new Error;return exception}()};module.exports=Exceptions},{}],204:[function(require,module,exports){module.exports=function(){function quote(s){return'"'+s.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var result={parse:function(input,startRule){var parseFunctions={CRLF:parse_CRLF,DIGIT:parse_DIGIT,ALPHA:parse_ALPHA,HEXDIG:parse_HEXDIG,WSP:parse_WSP,OCTET:parse_OCTET,DQUOTE:parse_DQUOTE,SP:parse_SP,HTAB:parse_HTAB,alphanum:parse_alphanum,reserved:parse_reserved,unreserved:parse_unreserved,mark:parse_mark,escaped:parse_escaped,LWS:parse_LWS,SWS:parse_SWS,HCOLON:parse_HCOLON,TEXT_UTF8_TRIM:parse_TEXT_UTF8_TRIM,TEXT_UTF8char:parse_TEXT_UTF8char,UTF8_NONASCII:parse_UTF8_NONASCII,UTF8_CONT:parse_UTF8_CONT,LHEX:parse_LHEX,token:parse_token,token_nodot:parse_token_nodot,separators:parse_separators,word:parse_word,STAR:parse_STAR,SLASH:parse_SLASH,EQUAL:parse_EQUAL,LPAREN:parse_LPAREN,RPAREN:parse_RPAREN,RAQUOT:parse_RAQUOT,LAQUOT:parse_LAQUOT,COMMA:parse_COMMA,SEMI:parse_SEMI,COLON:parse_COLON,LDQUOT:parse_LDQUOT,RDQUOT:parse_RDQUOT,comment:parse_comment,ctext:parse_ctext,quoted_string:parse_quoted_string,quoted_string_clean:parse_quoted_string_clean,qdtext:parse_qdtext,quoted_pair:parse_quoted_pair,SIP_URI_noparams:parse_SIP_URI_noparams,SIP_URI:parse_SIP_URI,uri_scheme:parse_uri_scheme,userinfo:parse_userinfo,user:parse_user,user_unreserved:parse_user_unreserved,password:parse_password,hostport:parse_hostport,host:parse_host,hostname:parse_hostname,domainlabel:parse_domainlabel,toplabel:parse_toplabel,IPv6reference:parse_IPv6reference,IPv6address:parse_IPv6address,h16:parse_h16,ls32:parse_ls32,IPv4address:parse_IPv4address,dec_octet:parse_dec_octet,port:parse_port,uri_parameters:parse_uri_parameters,uri_parameter:parse_uri_parameter,transport_param:parse_transport_param,user_param:parse_user_param,method_param:parse_method_param,ttl_param:parse_ttl_param,maddr_param:parse_maddr_param,lr_param:parse_lr_param,other_param:parse_other_param,pname:parse_pname,pvalue:parse_pvalue,paramchar:parse_paramchar,param_unreserved:parse_param_unreserved,headers:parse_headers,header:parse_header,hname:parse_hname,hvalue:parse_hvalue,hnv_unreserved:parse_hnv_unreserved,Request_Response:parse_Request_Response,Request_Line:parse_Request_Line,Request_URI:parse_Request_URI,absoluteURI:parse_absoluteURI,hier_part:parse_hier_part,net_path:parse_net_path,abs_path:parse_abs_path,opaque_part:parse_opaque_part,uric:parse_uric,uric_no_slash:parse_uric_no_slash,path_segments:parse_path_segments,segment:parse_segment,param:parse_param,pchar:parse_pchar,scheme:parse_scheme,authority:parse_authority,srvr:parse_srvr,reg_name:parse_reg_name,query:parse_query,SIP_Version:parse_SIP_Version,INVITEm:parse_INVITEm,ACKm:parse_ACKm,OPTIONSm:parse_OPTIONSm,BYEm:parse_BYEm,CANCELm:parse_CANCELm,REGISTERm:parse_REGISTERm,SUBSCRIBEm:parse_SUBSCRIBEm,NOTIFYm:parse_NOTIFYm,Method:parse_Method,Status_Line:parse_Status_Line,Status_Code:parse_Status_Code,extension_code:parse_extension_code,Reason_Phrase:parse_Reason_Phrase,Allow_Events:parse_Allow_Events,Call_ID:parse_Call_ID,Contact:parse_Contact,contact_param:parse_contact_param,name_addr:parse_name_addr,display_name:parse_display_name,contact_params:parse_contact_params,c_p_q:parse_c_p_q,c_p_expires:parse_c_p_expires,delta_seconds:parse_delta_seconds,qvalue:parse_qvalue,generic_param:parse_generic_param,gen_value:parse_gen_value,Content_Disposition:parse_Content_Disposition,disp_type:parse_disp_type,disp_param:parse_disp_param,handling_param:parse_handling_param,Content_Encoding:parse_Content_Encoding,Content_Length:parse_Content_Length,Content_Type:parse_Content_Type,media_type:parse_media_type,m_type:parse_m_type,discrete_type:parse_discrete_type,composite_type:parse_composite_type,extension_token:parse_extension_token,x_token:parse_x_token,m_subtype:parse_m_subtype,m_parameter:parse_m_parameter,m_value:parse_m_value,CSeq:parse_CSeq,CSeq_value:parse_CSeq_value,Expires:parse_Expires,Event:parse_Event,event_type:parse_event_type,From:parse_From,from_param:parse_from_param,tag_param:parse_tag_param,Max_Forwards:parse_Max_Forwards,Min_Expires:parse_Min_Expires,Name_Addr_Header:parse_Name_Addr_Header,Proxy_Authenticate:parse_Proxy_Authenticate,challenge:parse_challenge,other_challenge:parse_other_challenge,auth_param:parse_auth_param,digest_cln:parse_digest_cln,realm:parse_realm,realm_value:parse_realm_value,domain:parse_domain,URI:parse_URI,nonce:parse_nonce,nonce_value:parse_nonce_value,opaque:parse_opaque,stale:parse_stale,algorithm:parse_algorithm,qop_options:parse_qop_options,qop_value:parse_qop_value,Proxy_Require:parse_Proxy_Require,Record_Route:parse_Record_Route,rec_route:parse_rec_route,Require:parse_Require,Route:parse_Route,route_param:parse_route_param,Subscription_State:parse_Subscription_State,substate_value:parse_substate_value,subexp_params:parse_subexp_params,event_reason_value:parse_event_reason_value,Subject:parse_Subject,Supported:parse_Supported,To:parse_To,to_param:parse_to_param,Via:parse_Via,via_parm:parse_via_parm,via_params:parse_via_params,via_ttl:parse_via_ttl,via_maddr:parse_via_maddr,via_received:parse_via_received,via_branch:parse_via_branch,response_port:parse_response_port,sent_protocol:parse_sent_protocol,protocol_name:parse_protocol_name,transport:parse_transport,sent_by:parse_sent_by,via_host:parse_via_host,via_port:parse_via_port,ttl:parse_ttl,WWW_Authenticate:parse_WWW_Authenticate,extension_header:parse_extension_header,header_value:parse_header_value,message_body:parse_message_body,stun_URI:parse_stun_URI,stun_scheme:parse_stun_scheme,stun_host_port:parse_stun_host_port,stun_host:parse_stun_host,reg_name:parse_reg_name,stun_unreserved:parse_stun_unreserved,sub_delims:parse_sub_delims,turn_URI:parse_turn_URI,turn_scheme:parse_turn_scheme,turn_transport:parse_turn_transport,uuid_URI:parse_uuid_URI,uuid:parse_uuid,hex4:parse_hex4,hex8:parse_hex8,hex12:parse_hex12};if(startRule!==undefined){if(parseFunctions[startRule]===undefined){throw new Error("Invalid rule name: "+quote(startRule)+".")}}else{startRule="CRLF"}var pos=0;var reportFailures=0;var rightmostFailuresPos=0;var rightmostFailuresExpected=[];function padLeft(input,padding,length){var result=input;var padLength=length-input.length;for(var i=0;i<padLength;i++){result=padding+result}return result}function escape(ch){var charCode=ch.charCodeAt(0);var escapeChar;var length;if(charCode<=255){escapeChar="x";length=2}else{escapeChar="u";length=4}return"\\"+escapeChar+padLeft(charCode.toString(16).toUpperCase(),"0",length)}function matchFailed(failure){if(pos<rightmostFailuresPos){return}if(pos>rightmostFailuresPos){rightmostFailuresPos=pos;rightmostFailuresExpected=[]}rightmostFailuresExpected.push(failure)}function parse_CRLF(){var result0;if(input.substr(pos,2)==="\r\n"){result0="\r\n";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"\\r\\n"')}}return result0}function parse_DIGIT(){var result0;if(/^[0-9]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[0-9]")}}return result0}function parse_ALPHA(){var result0;if(/^[a-zA-Z]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[a-zA-Z]")}}return result0}function parse_HEXDIG(){var result0;if(/^[0-9a-fA-F]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[0-9a-fA-F]")}}return result0}function parse_WSP(){var result0;result0=parse_SP();if(result0===null){result0=parse_HTAB()}return result0}function parse_OCTET(){var result0;if(/^[\0-\xFF]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\0-\\xFF]")}}return result0}function parse_DQUOTE(){var result0;if(/^["]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed('["]')}}return result0}function parse_SP(){var result0;if(input.charCodeAt(pos)===32){result0=" ";pos++}else{result0=null;if(reportFailures===0){matchFailed('" "')}}return result0}function parse_HTAB(){var result0;if(input.charCodeAt(pos)===9){result0="	";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\\t"')}}return result0}function parse_alphanum(){var result0;if(/^[a-zA-Z0-9]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9]")}}return result0}function parse_reserved(){var result0;if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===64){result0="@";pos++}else{result0=null;if(reportFailures===0){matchFailed('"@"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')
}}}}}}}}}}}return result0}function parse_unreserved(){var result0;result0=parse_alphanum();if(result0===null){result0=parse_mark()}return result0}function parse_mark(){var result0;if(input.charCodeAt(pos)===45){result0="-";pos++}else{result0=null;if(reportFailures===0){matchFailed('"-"')}}if(result0===null){if(input.charCodeAt(pos)===95){result0="_";pos++}else{result0=null;if(reportFailures===0){matchFailed('"_"')}}if(result0===null){if(input.charCodeAt(pos)===46){result0=".";pos++}else{result0=null;if(reportFailures===0){matchFailed('"."')}}if(result0===null){if(input.charCodeAt(pos)===33){result0="!";pos++}else{result0=null;if(reportFailures===0){matchFailed('"!"')}}if(result0===null){if(input.charCodeAt(pos)===126){result0="~";pos++}else{result0=null;if(reportFailures===0){matchFailed('"~"')}}if(result0===null){if(input.charCodeAt(pos)===42){result0="*";pos++}else{result0=null;if(reportFailures===0){matchFailed('"*"')}}if(result0===null){if(input.charCodeAt(pos)===39){result0="'";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\'"')}}if(result0===null){if(input.charCodeAt(pos)===40){result0="(";pos++}else{result0=null;if(reportFailures===0){matchFailed('"("')}}if(result0===null){if(input.charCodeAt(pos)===41){result0=")";pos++}else{result0=null;if(reportFailures===0){matchFailed('")"')}}}}}}}}}}return result0}function parse_escaped(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.charCodeAt(pos)===37){result0="%";pos++}else{result0=null;if(reportFailures===0){matchFailed('"%"')}}if(result0!==null){result1=parse_HEXDIG();if(result1!==null){result2=parse_HEXDIG();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,escaped){return escaped.join("")}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_LWS(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;pos2=pos;result0=[];result1=parse_WSP();while(result1!==null){result0.push(result1);result1=parse_WSP()}if(result0!==null){result1=parse_CRLF();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos2}}else{result0=null;pos=pos2}result0=result0!==null?result0:"";if(result0!==null){result2=parse_WSP();if(result2!==null){result1=[];while(result2!==null){result1.push(result2);result2=parse_WSP()}}else{result1=null}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return" "}(pos0)}if(result0===null){pos=pos0}return result0}function parse_SWS(){var result0;result0=parse_LWS();result0=result0!==null?result0:"";return result0}function parse_HCOLON(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=[];result1=parse_SP();if(result1===null){result1=parse_HTAB()}while(result1!==null){result0.push(result1);result1=parse_SP();if(result1===null){result1=parse_HTAB()}}if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return":"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_TEXT_UTF8_TRIM(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result1=parse_TEXT_UTF8char();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_TEXT_UTF8char()}}else{result0=null}if(result0!==null){result1=[];pos2=pos;result2=[];result3=parse_LWS();while(result3!==null){result2.push(result3);result3=parse_LWS()}if(result2!==null){result3=parse_TEXT_UTF8char();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=[];result3=parse_LWS();while(result3!==null){result2.push(result3);result3=parse_LWS()}if(result2!==null){result3=parse_TEXT_UTF8char();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_TEXT_UTF8char(){var result0;if(/^[!-~]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[!-~]")}}if(result0===null){result0=parse_UTF8_NONASCII()}return result0}function parse_UTF8_NONASCII(){var result0;if(/^[\x80-\uFFFF]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\x80-\\uFFFF]")}}return result0}function parse_UTF8_CONT(){var result0;if(/^[\x80-\xBF]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\x80-\\xBF]")}}return result0}function parse_LHEX(){var result0;result0=parse_DIGIT();if(result0===null){if(/^[a-f]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[a-f]")}}}return result0}function parse_token(){var result0,result1;var pos0;pos0=pos;result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}}}}}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}}}}}}}}else{result0=null}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_token_nodot(){var result0,result1;var pos0;pos0=pos;result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}}}}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}}}}}}}else{result0=null}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_separators(){var result0;if(input.charCodeAt(pos)===40){result0="(";pos++}else{result0=null;if(reportFailures===0){matchFailed('"("')}}if(result0===null){if(input.charCodeAt(pos)===41){result0=")";pos++}else{result0=null;if(reportFailures===0){matchFailed('")"')}}if(result0===null){if(input.charCodeAt(pos)===60){result0="<";pos++}else{result0=null;if(reportFailures===0){matchFailed('"<"')}}if(result0===null){if(input.charCodeAt(pos)===62){result0=">";pos++}else{result0=null;if(reportFailures===0){matchFailed('">"')}}if(result0===null){if(input.charCodeAt(pos)===64){result0="@";pos++}else{result0=null;if(reportFailures===0){matchFailed('"@"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}if(result0===null){if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===92){result0="\\";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\\\\"')}}if(result0===null){result0=parse_DQUOTE();if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0===null){if(input.charCodeAt(pos)===91){result0="[";pos++}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0===null){if(input.charCodeAt(pos)===93){result0="]";pos++}else{result0=null;if(reportFailures===0){matchFailed('"]"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===123){result0="{";pos++}else{result0=null;if(reportFailures===0){matchFailed('"{"')}}if(result0===null){if(input.charCodeAt(pos)===125){result0="}";pos++}else{result0=null;if(reportFailures===0){matchFailed('"}"')}}if(result0===null){result0=parse_SP();if(result0===null){result0=parse_HTAB()}}}}}}}}}}}}}}}}}}return result0}function parse_word(){var result0,result1;var pos0;pos0=pos;result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}if(result1===null){if(input.charCodeAt(pos)===40){result1="(";pos++}else{result1=null;if(reportFailures===0){matchFailed('"("')}}if(result1===null){if(input.charCodeAt(pos)===41){result1=")";pos++}else{result1=null;if(reportFailures===0){matchFailed('")"')}}if(result1===null){if(input.charCodeAt(pos)===60){result1="<";pos++}else{result1=null;if(reportFailures===0){matchFailed('"<"')}}if(result1===null){if(input.charCodeAt(pos)===62){result1=">";pos++}else{result1=null;if(reportFailures===0){matchFailed('">"')}}if(result1===null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1===null){if(input.charCodeAt(pos)===92){result1="\\";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\\\\"')}}if(result1===null){result1=parse_DQUOTE();if(result1===null){if(input.charCodeAt(pos)===47){result1="/";pos++}else{result1=null;if(reportFailures===0){matchFailed('"/"')}}if(result1===null){if(input.charCodeAt(pos)===91){result1="[";pos++}else{result1=null;if(reportFailures===0){matchFailed('"["')}}if(result1===null){if(input.charCodeAt(pos)===93){result1="]";pos++}else{result1=null;if(reportFailures===0){matchFailed('"]"')}}if(result1===null){if(input.charCodeAt(pos)===63){result1="?";pos++}else{result1=null;if(reportFailures===0){matchFailed('"?"')}}if(result1===null){if(input.charCodeAt(pos)===123){result1="{";pos++}else{result1=null;if(reportFailures===0){matchFailed('"{"')}}if(result1===null){if(input.charCodeAt(pos)===125){result1="}";pos++}else{result1=null;if(reportFailures===0){matchFailed('"}"')}}}}}}}}}}}}}}}}}}}}}}}}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}if(result1===null){if(input.charCodeAt(pos)===40){result1="(";pos++}else{result1=null;if(reportFailures===0){matchFailed('"("')}}if(result1===null){if(input.charCodeAt(pos)===41){result1=")";pos++}else{result1=null;if(reportFailures===0){matchFailed('")"')}}if(result1===null){if(input.charCodeAt(pos)===60){result1="<";pos++}else{result1=null;if(reportFailures===0){matchFailed('"<"')}}if(result1===null){if(input.charCodeAt(pos)===62){result1=">";pos++}else{result1=null;if(reportFailures===0){matchFailed('">"')}}if(result1===null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1===null){if(input.charCodeAt(pos)===92){result1="\\";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\\\\"')}}if(result1===null){result1=parse_DQUOTE();if(result1===null){if(input.charCodeAt(pos)===47){result1="/";pos++}else{result1=null;if(reportFailures===0){matchFailed('"/"')}}if(result1===null){if(input.charCodeAt(pos)===91){result1="[";pos++}else{result1=null;if(reportFailures===0){matchFailed('"["')}}if(result1===null){if(input.charCodeAt(pos)===93){result1="]";pos++}else{result1=null;if(reportFailures===0){matchFailed('"]"')}}if(result1===null){if(input.charCodeAt(pos)===63){result1="?";pos++}else{result1=null;if(reportFailures===0){matchFailed('"?"')}}if(result1===null){if(input.charCodeAt(pos)===123){result1="{";pos++}else{result1=null;if(reportFailures===0){matchFailed('"{"')}}if(result1===null){if(input.charCodeAt(pos)===125){result1="}";pos++}else{result1=null;if(reportFailures===0){matchFailed('"}"')}}}}}}}}}}}}}}}}}}}}}}}}}}}else{result0=null}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_STAR(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"*"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_SLASH(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===47){result1="/";pos++}else{result1=null;if(reportFailures===0){matchFailed('"/"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"/"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_EQUAL(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"="}(pos0)}if(result0===null){pos=pos0}return result0}function parse_LPAREN(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===40){result1="(";pos++}else{result1=null;if(reportFailures===0){matchFailed('"("')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"("}(pos0)}if(result0===null){pos=pos0}return result0}function parse_RPAREN(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===41){result1=")";pos++}else{result1=null;if(reportFailures===0){matchFailed('")"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return")"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_RAQUOT(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.charCodeAt(pos)===62){result0=">";pos++}else{result0=null;if(reportFailures===0){matchFailed('">"')}}if(result0!==null){result1=parse_SWS();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return">"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_LAQUOT(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===60){result1="<";pos++}else{result1=null;if(reportFailures===0){matchFailed('"<"')}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"<"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_COMMA(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return","}(pos0)}if(result0===null){pos=pos0}return result0}function parse_SEMI(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return";"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_COLON(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return":"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_LDQUOT(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){result1=parse_DQUOTE();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return'"'}(pos0)}if(result0===null){pos=pos0}return result0}function parse_RDQUOT(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_DQUOTE();if(result0!==null){result1=parse_SWS();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return'"'}(pos0)}if(result0===null){pos=pos0}return result0}function parse_comment(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_LPAREN();if(result0!==null){result1=[];result2=parse_ctext();if(result2===null){result2=parse_quoted_pair();if(result2===null){result2=parse_comment()}}while(result2!==null){result1.push(result2);result2=parse_ctext();if(result2===null){result2=parse_quoted_pair();if(result2===null){result2=parse_comment()}}}if(result1!==null){result2=parse_RPAREN();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_ctext(){var result0;if(/^[!-']/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[!-']")}}if(result0===null){if(/^[*-[]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[*-[]")}}if(result0===null){if(/^[\]-~]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\]-~]")}}if(result0===null){result0=parse_UTF8_NONASCII();if(result0===null){result0=parse_LWS()}}}}return result0}function parse_quoted_string(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){result1=parse_DQUOTE();if(result1!==null){result2=[];result3=parse_qdtext();if(result3===null){result3=parse_quoted_pair()}while(result3!==null){result2.push(result3);result3=parse_qdtext();if(result3===null){result3=parse_quoted_pair()}}if(result2!==null){result3=parse_DQUOTE();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_quoted_string_clean(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){result1=parse_DQUOTE();if(result1!==null){result2=[];result3=parse_qdtext();if(result3===null){result3=parse_quoted_pair()}while(result3!==null){result2.push(result3);result3=parse_qdtext();if(result3===null){result3=parse_quoted_pair()}}if(result2!==null){result3=parse_DQUOTE();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return input.substring(pos-1,offset+1)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_qdtext(){var result0;result0=parse_LWS();if(result0===null){if(input.charCodeAt(pos)===33){result0="!";pos++}else{result0=null;if(reportFailures===0){matchFailed('"!"')}}if(result0===null){if(/^[#-[]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[#-[]")}}if(result0===null){if(/^[\]-~]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\]-~]")}}if(result0===null){result0=parse_UTF8_NONASCII()}}}}return result0}function parse_quoted_pair(){var result0,result1;var pos0;pos0=pos;if(input.charCodeAt(pos)===92){result0="\\";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\\\\"')}}if(result0!==null){if(/^[\0-\t]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[\\0-\\t]")}}if(result1===null){if(/^[\x0B-\f]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[\\x0B-\\f]")}}if(result1===null){if(/^[\x0E-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[\\x0E-]")}}}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_SIP_URI_noparams(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_uri_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_userinfo();result2=result2!==null?result2:"";if(result2!==null){result3=parse_hostport();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){try{data.uri=new URI(data.scheme,data.user,data.host,data.port);delete data.scheme;delete data.user;delete data.host;delete data.host_type;delete data.port}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_SIP_URI(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_uri_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_userinfo();result2=result2!==null?result2:"";if(result2!==null){result3=parse_hostport();if(result3!==null){result4=parse_uri_parameters();if(result4!==null){result5=parse_headers();result5=result5!==null?result5:"";if(result5!==null){result0=[result0,result1,result2,result3,result4,result5]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var header;try{data.uri=new URI(data.scheme,data.user,data.host,data.port,data.uri_params,data.uri_headers);delete data.scheme;delete data.user;delete data.host;delete data.host_type;delete data.port;delete data.uri_params;if(startRule==="SIP_URI"){data=data.uri}}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_uri_scheme(){var result0;var pos0;if(input.substr(pos,3).toLowerCase()==="sip"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"sip"')}}if(result0===null){pos0=pos;if(input.substr(pos,4).toLowerCase()==="sips"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"sips"')}}if(result0!==null){result0=function(offset){data.scheme=uri_scheme.toLowerCase()}(pos0)}if(result0===null){pos=pos0}}return result0}function parse_userinfo(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_user();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_password();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){if(input.charCodeAt(pos)===64){result2="@";pos++}else{result2=null;if(reportFailures===0){matchFailed('"@"')}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1
}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.user=decodeURIComponent(input.substring(pos-1,offset))}(pos0)}if(result0===null){pos=pos0}return result0}function parse_user(){var result0,result1;result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_user_unreserved()}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_user_unreserved()}}}}else{result0=null}return result0}function parse_user_unreserved(){var result0;if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}if(result0===null){if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}}}}}}}}return result0}function parse_password(){var result0,result1;var pos0;pos0=pos;result0=[];result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){if(input.charCodeAt(pos)===38){result1="&";pos++}else{result1=null;if(reportFailures===0){matchFailed('"&"')}}if(result1===null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===36){result1="$";pos++}else{result1=null;if(reportFailures===0){matchFailed('"$"')}}if(result1===null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}}}}}}}while(result1!==null){result0.push(result1);result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){if(input.charCodeAt(pos)===38){result1="&";pos++}else{result1=null;if(reportFailures===0){matchFailed('"&"')}}if(result1===null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===36){result1="$";pos++}else{result1=null;if(reportFailures===0){matchFailed('"$"')}}if(result1===null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}}}}}}}}if(result0!==null){result0=function(offset){data.password=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_hostport(){var result0,result1,result2;var pos0,pos1;pos0=pos;result0=parse_host();if(result0!==null){pos1=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_port();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos1}}else{result1=null;pos=pos1}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_host(){var result0;var pos0;pos0=pos;result0=parse_IPv4address();if(result0===null){result0=parse_IPv6reference();if(result0===null){result0=parse_hostname()}}if(result0!==null){result0=function(offset){data.host=input.substring(pos,offset).toLowerCase();return data.host}(pos0)}if(result0===null){pos=pos0}return result0}function parse_hostname(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=[];pos2=pos;result1=parse_domainlabel();if(result1!==null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}while(result1!==null){result0.push(result1);pos2=pos;result1=parse_domainlabel();if(result1!==null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}}if(result0!==null){result1=parse_toplabel();if(result1!==null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}result2=result2!==null?result2:"";if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.host_type="domain";return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_domainlabel(){var result0,result1;if(/^[a-zA-Z0-9_\-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9_\\-]")}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);if(/^[a-zA-Z0-9_\-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9_\\-]")}}}}else{result0=null}return result0}function parse_toplabel(){var result0,result1;if(/^[a-zA-Z0-9_\-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9_\\-]")}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);if(/^[a-zA-Z0-9_\-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9_\\-]")}}}}else{result0=null}return result0}function parse_IPv6reference(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.charCodeAt(pos)===91){result0="[";pos++}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0!==null){result1=parse_IPv6address();if(result1!==null){if(input.charCodeAt(pos)===93){result2="]";pos++}else{result2=null;if(reportFailures===0){matchFailed('"]"')}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.host_type="IPv6";return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_IPv6address(){var result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11,result12;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_h16();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){if(input.charCodeAt(pos)===58){result7=":";pos++}else{result7=null;if(reportFailures===0){matchFailed('":"')}}if(result7!==null){result8=parse_h16();if(result8!==null){if(input.charCodeAt(pos)===58){result9=":";pos++}else{result9=null;if(reportFailures===0){matchFailed('":"')}}if(result9!==null){result10=parse_h16();if(result10!==null){if(input.charCodeAt(pos)===58){result11=":";pos++}else{result11=null;if(reportFailures===0){matchFailed('":"')}}if(result11!==null){result12=parse_ls32();if(result12!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11,result12]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_h16();if(result7!==null){if(input.charCodeAt(pos)===58){result8=":";pos++}else{result8=null;if(reportFailures===0){matchFailed('":"')}}if(result8!==null){result9=parse_h16();if(result9!==null){if(input.charCodeAt(pos)===58){result10=":";pos++}else{result10=null;if(reportFailures===0){matchFailed('":"')}}if(result10!==null){result11=parse_ls32();if(result11!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_h16();if(result7!==null){if(input.charCodeAt(pos)===58){result8=":";pos++}else{result8=null;if(reportFailures===0){matchFailed('":"')}}if(result8!==null){result9=parse_ls32();if(result9!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_ls32();if(result7!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_ls32();if(result5!==null){result0=[result0,result1,result2,result3,result4,result5]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_ls32();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_ls32();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){if(input.substr(pos,2)==="::"){result1="::";pos+=2}else{result1=null;if(reportFailures===0){matchFailed('"::"')}}if(result1!==null){result2=parse_h16();if(result2!==null){if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){if(input.charCodeAt(pos)===58){result7=":";pos++}else{result7=null;if(reportFailures===0){matchFailed('":"')}}if(result7!==null){result8=parse_h16();if(result8!==null){if(input.charCodeAt(pos)===58){result9=":";pos++}else{result9=null;if(reportFailures===0){matchFailed('":"')}}if(result9!==null){result10=parse_ls32();if(result10!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){if(input.substr(pos,2)==="::"){result2="::";pos+=2}else{result2=null;if(reportFailures===0){matchFailed('"::"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_h16();if(result7!==null){if(input.charCodeAt(pos)===58){result8=":";pos++}else{result8=null;if(reportFailures===0){matchFailed('":"')}}if(result8!==null){result9=parse_ls32();if(result9!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){if(input.substr(pos,2)==="::"){result3="::";pos+=2}else{result3=null;if(reportFailures===0){matchFailed('"::"')}}if(result3!==null){result4=parse_h16();if(result4!==null){if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){if(input.charCodeAt(pos)===58){result7=":";pos++}else{result7=null;if(reportFailures===0){matchFailed('":"')}}if(result7!==null){result8=parse_ls32();if(result8!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){pos2=pos;if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos2}}else{result3=null;pos=pos2}result3=result3!==null?result3:"";if(result3!==null){if(input.substr(pos,2)==="::"){result4="::";pos+=2}else{result4=null;if(reportFailures===0){matchFailed('"::"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_ls32();if(result7!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){pos2=pos;if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos2}}else{result3=null;pos=pos2}result3=result3!==null?result3:"";if(result3!==null){pos2=pos;if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos2}}else{result4=null;pos=pos2}result4=result4!==null?result4:"";if(result4!==null){if(input.substr(pos,2)==="::"){result5="::";pos+=2}else{result5=null;if(reportFailures===0){matchFailed('"::"')}}if(result5!==null){result6=parse_ls32();if(result6!==null){result0=[result0,result1,result2,result3,result4,result5,result6]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){pos2=pos;if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos2}}else{result3=null;pos=pos2}result3=result3!==null?result3:"";if(result3!==null){pos2=pos;if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos2}}else{result4=null;pos=pos2}result4=result4!==null?result4:"";if(result4!==null){pos2=pos;if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}result5=result5!==null?result5:"";if(result5!==null){if(input.substr(pos,2)==="::"){result6="::";pos+=2}else{result6=null;if(reportFailures===0){matchFailed('"::"')}}if(result6!==null){result7=parse_h16();if(result7!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){pos2=pos;if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos2}}else{result3=null;pos=pos2}result3=result3!==null?result3:"";if(result3!==null){pos2=pos;if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos2}}else{result4=null;pos=pos2}result4=result4!==null?result4:"";if(result4!==null){pos2=pos;if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}result5=result5!==null?result5:"";if(result5!==null){pos2=pos;if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_h16();if(result7!==null){result6=[result6,result7]}else{result6=null;pos=pos2}}else{result6=null;pos=pos2}result6=result6!==null?result6:"";if(result6!==null){if(input.substr(pos,2)==="::"){result7="::";pos+=2}else{result7=null;if(reportFailures===0){matchFailed('"::"')}}if(result7!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}}}}}}}}}}}}}}if(result0!==null){result0=function(offset){data.host_type="IPv6";return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_h16(){var result0,result1,result2,result3;var pos0;pos0=pos;result0=parse_HEXDIG();if(result0!==null){result1=parse_HEXDIG();result1=result1!==null?result1:"";if(result1!==null){result2=parse_HEXDIG();result2=result2!==null?result2:"";if(result2!==null){result3=parse_HEXDIG();result3=result3!==null?result3:"";if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_ls32(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_h16();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){result0=parse_IPv4address()}return result0}function parse_IPv4address(){var result0,result1,result2,result3,result4,result5,result6;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_dec_octet();if(result0!==null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1!==null){result2=parse_dec_octet();if(result2!==null){if(input.charCodeAt(pos)===46){result3=".";pos++}else{result3=null;if(reportFailures===0){matchFailed('"."')}}if(result3!==null){result4=parse_dec_octet();if(result4!==null){if(input.charCodeAt(pos)===46){result5=".";pos++}else{result5=null;if(reportFailures===0){matchFailed('"."')}}if(result5!==null){result6=parse_dec_octet();if(result6!==null){result0=[result0,result1,result2,result3,result4,result5,result6]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.host_type="IPv4";return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_dec_octet(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,2)==="25"){result0="25";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"25"')}}if(result0!==null){if(/^[0-5]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[0-5]")}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){pos0=pos;if(input.charCodeAt(pos)===50){result0="2";pos++}else{result0=null;if(reportFailures===0){matchFailed('"2"')}}if(result0!==null){if(/^[0-4]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[0-4]")}}if(result1!==null){result2=parse_DIGIT();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){pos0=pos;if(input.charCodeAt(pos)===49){result0="1";pos++}else{result0=null;if(reportFailures===0){matchFailed('"1"')}}if(result0!==null){result1=parse_DIGIT();if(result1!==null){result2=parse_DIGIT();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){pos0=pos;if(/^[1-9]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[1-9]")}}if(result0!==null){result1=parse_DIGIT();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){result0=parse_DIGIT()}}}}return result0}function parse_port(){var result0,result1,result2,result3,result4;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_DIGIT();result0=result0!==null?result0:"";if(result0!==null){result1=parse_DIGIT();result1=result1!==null?result1:"";if(result1!==null){result2=parse_DIGIT();result2=result2!==null?result2:"";if(result2!==null){result3=parse_DIGIT();result3=result3!==null?result3:"";if(result3!==null){result4=parse_DIGIT();result4=result4!==null?result4:"";if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,port){port=parseInt(port.join(""));data.port=port;return port}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_uri_parameters(){var result0,result1,result2;var pos0;result0=[];pos0=pos;if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1!==null){result2=parse_uri_parameter();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos0}}else{result1=null;pos=pos0}while(result1!==null){result0.push(result1);pos0=pos;if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1!==null){result2=parse_uri_parameter();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos0}}else{result1=null;pos=pos0}}return result0}function parse_uri_parameter(){var result0;result0=parse_transport_param();if(result0===null){result0=parse_user_param();if(result0===null){result0=parse_method_param();if(result0===null){result0=parse_ttl_param();if(result0===null){result0=parse_maddr_param();
if(result0===null){result0=parse_lr_param();if(result0===null){result0=parse_other_param()}}}}}}return result0}function parse_transport_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,10).toLowerCase()==="transport="){result0=input.substr(pos,10);pos+=10}else{result0=null;if(reportFailures===0){matchFailed('"transport="')}}if(result0!==null){if(input.substr(pos,3).toLowerCase()==="udp"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"udp"')}}if(result1===null){if(input.substr(pos,3).toLowerCase()==="tcp"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"tcp"')}}if(result1===null){if(input.substr(pos,4).toLowerCase()==="sctp"){result1=input.substr(pos,4);pos+=4}else{result1=null;if(reportFailures===0){matchFailed('"sctp"')}}if(result1===null){if(input.substr(pos,3).toLowerCase()==="tls"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"tls"')}}if(result1===null){result1=parse_token()}}}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,transport){if(!data.uri_params)data.uri_params={};data.uri_params["transport"]=transport.toLowerCase()}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_user_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,5).toLowerCase()==="user="){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"user="')}}if(result0!==null){if(input.substr(pos,5).toLowerCase()==="phone"){result1=input.substr(pos,5);pos+=5}else{result1=null;if(reportFailures===0){matchFailed('"phone"')}}if(result1===null){if(input.substr(pos,2).toLowerCase()==="ip"){result1=input.substr(pos,2);pos+=2}else{result1=null;if(reportFailures===0){matchFailed('"ip"')}}if(result1===null){result1=parse_token()}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,user){if(!data.uri_params)data.uri_params={};data.uri_params["user"]=user.toLowerCase()}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_method_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,7).toLowerCase()==="method="){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"method="')}}if(result0!==null){result1=parse_Method();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,method){if(!data.uri_params)data.uri_params={};data.uri_params["method"]=method}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_ttl_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,4).toLowerCase()==="ttl="){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"ttl="')}}if(result0!==null){result1=parse_ttl();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,ttl){if(!data.params)data.params={};data.params["ttl"]=ttl}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_maddr_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,6).toLowerCase()==="maddr="){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"maddr="')}}if(result0!==null){result1=parse_host();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,maddr){if(!data.uri_params)data.uri_params={};data.uri_params["maddr"]=maddr}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_lr_param(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;if(input.substr(pos,2).toLowerCase()==="lr"){result0=input.substr(pos,2);pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"lr"')}}if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1!==null){result2=parse_token();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){if(!data.uri_params)data.uri_params={};data.uri_params["lr"]=undefined}(pos0)}if(result0===null){pos=pos0}return result0}function parse_other_param(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_pname();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1!==null){result2=parse_pvalue();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,param,value){if(!data.uri_params)data.uri_params={};if(typeof value==="undefined"){value=undefined}else{value=value[1]}data.uri_params[param.toLowerCase()]=value&&value.toLowerCase()}(pos0,result0[0],result0[1])}if(result0===null){pos=pos0}return result0}function parse_pname(){var result0,result1;var pos0;pos0=pos;result1=parse_paramchar();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_paramchar()}}else{result0=null}if(result0!==null){result0=function(offset,pname){return pname.join("")}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_pvalue(){var result0,result1;var pos0;pos0=pos;result1=parse_paramchar();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_paramchar()}}else{result0=null}if(result0!==null){result0=function(offset,pvalue){return pvalue.join("")}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_paramchar(){var result0;result0=parse_param_unreserved();if(result0===null){result0=parse_unreserved();if(result0===null){result0=parse_escaped()}}return result0}function parse_param_unreserved(){var result0;if(input.charCodeAt(pos)===91){result0="[";pos++}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0===null){if(input.charCodeAt(pos)===93){result0="]";pos++}else{result0=null;if(reportFailures===0){matchFailed('"]"')}}if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}}}}}}}return result0}function parse_headers(){var result0,result1,result2,result3,result4;var pos0,pos1;pos0=pos;if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0!==null){result1=parse_header();if(result1!==null){result2=[];pos1=pos;if(input.charCodeAt(pos)===38){result3="&";pos++}else{result3=null;if(reportFailures===0){matchFailed('"&"')}}if(result3!==null){result4=parse_header();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos1}}else{result3=null;pos=pos1}while(result3!==null){result2.push(result3);pos1=pos;if(input.charCodeAt(pos)===38){result3="&";pos++}else{result3=null;if(reportFailures===0){matchFailed('"&"')}}if(result3!==null){result4=parse_header();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos1}}else{result3=null;pos=pos1}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_header(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_hname();if(result0!==null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1!==null){result2=parse_hvalue();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,hname,hvalue){hname=hname.join("").toLowerCase();hvalue=hvalue.join("");if(!data.uri_headers)data.uri_headers={};if(!data.uri_headers[hname]){data.uri_headers[hname]=[hvalue]}else{data.uri_headers[hname].push(hvalue)}}(pos0,result0[0],result0[2])}if(result0===null){pos=pos0}return result0}function parse_hname(){var result0,result1;result1=parse_hnv_unreserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped()}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_hnv_unreserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped()}}}}else{result0=null}return result0}function parse_hvalue(){var result0,result1;result0=[];result1=parse_hnv_unreserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped()}}while(result1!==null){result0.push(result1);result1=parse_hnv_unreserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped()}}}return result0}function parse_hnv_unreserved(){var result0;if(input.charCodeAt(pos)===91){result0="[";pos++}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0===null){if(input.charCodeAt(pos)===93){result0="]";pos++}else{result0=null;if(reportFailures===0){matchFailed('"]"')}}if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}}}}}}}return result0}function parse_Request_Response(){var result0;result0=parse_Status_Line();if(result0===null){result0=parse_Request_Line()}return result0}function parse_Request_Line(){var result0,result1,result2,result3,result4;var pos0;pos0=pos;result0=parse_Method();if(result0!==null){result1=parse_SP();if(result1!==null){result2=parse_Request_URI();if(result2!==null){result3=parse_SP();if(result3!==null){result4=parse_SIP_Version();if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Request_URI(){var result0;result0=parse_SIP_URI();if(result0===null){result0=parse_absoluteURI()}return result0}function parse_absoluteURI(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_hier_part();if(result2===null){result2=parse_opaque_part()}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_hier_part(){var result0,result1,result2;var pos0,pos1;pos0=pos;result0=parse_net_path();if(result0===null){result0=parse_abs_path()}if(result0!==null){pos1=pos;if(input.charCodeAt(pos)===63){result1="?";pos++}else{result1=null;if(reportFailures===0){matchFailed('"?"')}}if(result1!==null){result2=parse_query();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos1}}else{result1=null;pos=pos1}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_net_path(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,2)==="//"){result0="//";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"//"')}}if(result0!==null){result1=parse_authority();if(result1!==null){result2=parse_abs_path();result2=result2!==null?result2:"";if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_abs_path(){var result0,result1;var pos0;pos0=pos;if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0!==null){result1=parse_path_segments();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_opaque_part(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_uric_no_slash();if(result0!==null){result1=[];result2=parse_uric();while(result2!==null){result1.push(result2);result2=parse_uric()}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_uric(){var result0;result0=parse_reserved();if(result0===null){result0=parse_unreserved();if(result0===null){result0=parse_escaped()}}return result0}function parse_uric_no_slash(){var result0;result0=parse_unreserved();if(result0===null){result0=parse_escaped();if(result0===null){if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===64){result0="@";pos++}else{result0=null;if(reportFailures===0){matchFailed('"@"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}}}}}}}}}}}return result0}function parse_path_segments(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_segment();if(result0!==null){result1=[];pos1=pos;if(input.charCodeAt(pos)===47){result2="/";pos++}else{result2=null;if(reportFailures===0){matchFailed('"/"')}}if(result2!==null){result3=parse_segment();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;if(input.charCodeAt(pos)===47){result2="/";pos++}else{result2=null;if(reportFailures===0){matchFailed('"/"')}}if(result2!==null){result3=parse_segment();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_segment(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=[];result1=parse_pchar();while(result1!==null){result0.push(result1);result1=parse_pchar()}if(result0!==null){result1=[];pos1=pos;if(input.charCodeAt(pos)===59){result2=";";pos++}else{result2=null;if(reportFailures===0){matchFailed('";"')}}if(result2!==null){result3=parse_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;if(input.charCodeAt(pos)===59){result2=";";pos++}else{result2=null;if(reportFailures===0){matchFailed('";"')}}if(result2!==null){result3=parse_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_param(){var result0,result1;result0=[];result1=parse_pchar();while(result1!==null){result0.push(result1);result1=parse_pchar()}return result0}function parse_pchar(){var result0;result0=parse_unreserved();if(result0===null){result0=parse_escaped();if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===64){result0="@";pos++}else{result0=null;if(reportFailures===0){matchFailed('"@"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}}}}}}}}}return result0}function parse_scheme(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_ALPHA();if(result0!==null){result1=[];result2=parse_ALPHA();if(result2===null){result2=parse_DIGIT();if(result2===null){if(input.charCodeAt(pos)===43){result2="+";pos++}else{result2=null;if(reportFailures===0){matchFailed('"+"')}}if(result2===null){if(input.charCodeAt(pos)===45){result2="-";pos++}else{result2=null;if(reportFailures===0){matchFailed('"-"')}}if(result2===null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}}}}}while(result2!==null){result1.push(result2);result2=parse_ALPHA();if(result2===null){result2=parse_DIGIT();if(result2===null){if(input.charCodeAt(pos)===43){result2="+";pos++}else{result2=null;if(reportFailures===0){matchFailed('"+"')}}if(result2===null){if(input.charCodeAt(pos)===45){result2="-";pos++}else{result2=null;if(reportFailures===0){matchFailed('"-"')}}if(result2===null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}}}}}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.scheme=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_authority(){var result0;result0=parse_srvr();if(result0===null){result0=parse_reg_name()}return result0}function parse_srvr(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_userinfo();if(result0!==null){if(input.charCodeAt(pos)===64){result1="@";pos++}else{result1=null;if(reportFailures===0){matchFailed('"@"')}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}result0=result0!==null?result0:"";if(result0!==null){result1=parse_hostport();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}result0=result0!==null?result0:"";return result0}function parse_reg_name(){var result0,result1;result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){if(input.charCodeAt(pos)===36){result1="$";pos++}else{result1=null;if(reportFailures===0){matchFailed('"$"')}}if(result1===null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}if(result1===null){if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1===null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1===null){if(input.charCodeAt(pos)===64){result1="@";pos++}else{result1=null;if(reportFailures===0){matchFailed('"@"')}}if(result1===null){if(input.charCodeAt(pos)===38){result1="&";pos++}else{result1=null;if(reportFailures===0){matchFailed('"&"')}}if(result1===null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}}}}}}}}}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){if(input.charCodeAt(pos)===36){result1="$";pos++}else{result1=null;if(reportFailures===0){matchFailed('"$"')}}if(result1===null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}if(result1===null){if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1===null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1===null){if(input.charCodeAt(pos)===64){result1="@";pos++}else{result1=null;if(reportFailures===0){matchFailed('"@"')}}if(result1===null){if(input.charCodeAt(pos)===38){result1="&";pos++}else{result1=null;if(reportFailures===0){matchFailed('"&"')}}if(result1===null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}}}}}}}}}}}}else{result0=null}return result0}function parse_query(){var result0,result1;result0=[];result1=parse_uric();while(result1!==null){result0.push(result1);result1=parse_uric()}return result0}function parse_SIP_Version(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,3).toLowerCase()==="sip"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"SIP"')}}if(result0!==null){if(input.charCodeAt(pos)===47){result1="/";pos++}else{result1=null;if(reportFailures===0){matchFailed('"/"')}}if(result1!==null){result3=parse_DIGIT();if(result3!==null){result2=[];while(result3!==null){result2.push(result3);result3=parse_DIGIT()}}else{result2=null}if(result2!==null){if(input.charCodeAt(pos)===46){result3=".";pos++}else{result3=null;if(reportFailures===0){matchFailed('"."')}}if(result3!==null){result5=parse_DIGIT();if(result5!==null){result4=[];while(result5!==null){result4.push(result5);result5=parse_DIGIT()}}else{result4=null}if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.sip_version=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_INVITEm(){var result0;if(input.substr(pos,6)==="INVITE"){result0="INVITE";pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"INVITE"')}}return result0}function parse_ACKm(){var result0;if(input.substr(pos,3)==="ACK"){result0="ACK";pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"ACK"')}}return result0}function parse_OPTIONSm(){var result0;if(input.substr(pos,7)==="OPTIONS"){result0="OPTIONS";pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"OPTIONS"')}}return result0}function parse_BYEm(){var result0;if(input.substr(pos,3)==="BYE"){result0="BYE";pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"BYE"')}}return result0}function parse_CANCELm(){var result0;if(input.substr(pos,6)==="CANCEL"){result0="CANCEL";pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"CANCEL"')}}return result0}function parse_REGISTERm(){var result0;if(input.substr(pos,8)==="REGISTER"){result0="REGISTER";pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"REGISTER"')}}return result0}function parse_SUBSCRIBEm(){var result0;if(input.substr(pos,9)==="SUBSCRIBE"){result0="SUBSCRIBE";pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"SUBSCRIBE"')}}return result0}function parse_NOTIFYm(){var result0;if(input.substr(pos,6)==="NOTIFY"){result0="NOTIFY";pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"NOTIFY"')}}return result0}function parse_Method(){var result0;var pos0;pos0=pos;result0=parse_INVITEm();if(result0===null){result0=parse_ACKm();if(result0===null){result0=parse_OPTIONSm();if(result0===null){result0=parse_BYEm();if(result0===null){result0=parse_CANCELm();if(result0===null){result0=parse_REGISTERm();if(result0===null){result0=parse_SUBSCRIBEm();if(result0===null){result0=parse_NOTIFYm();if(result0===null){result0=parse_token()}}}}}}}}if(result0!==null){result0=function(offset){data.method=input.substring(pos,offset);return data.method}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Status_Line(){var result0,result1,result2,result3,result4;var pos0;pos0=pos;result0=parse_SIP_Version();if(result0!==null){result1=parse_SP();if(result1!==null){result2=parse_Status_Code();if(result2!==null){result3=parse_SP();if(result3!==null){result4=parse_Reason_Phrase();if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Status_Code(){var result0;var pos0;pos0=pos;result0=parse_extension_code();if(result0!==null){result0=function(offset,status_code){data.status_code=parseInt(status_code.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_extension_code(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_DIGIT();if(result0!==null){result1=parse_DIGIT();if(result1!==null){result2=parse_DIGIT();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Reason_Phrase(){var result0,result1;var pos0;pos0=pos;result0=[];result1=parse_reserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_UTF8_NONASCII();if(result1===null){result1=parse_UTF8_CONT();if(result1===null){result1=parse_SP();if(result1===null){result1=parse_HTAB()}}}}}}while(result1!==null){result0.push(result1);result1=parse_reserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_UTF8_NONASCII();if(result1===null){result1=parse_UTF8_CONT();if(result1===null){result1=parse_SP();if(result1===null){result1=parse_HTAB()}}}}}}}if(result0!==null){result0=function(offset){data.reason_phrase=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Allow_Events(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_event_type();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_event_type();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_event_type();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Call_ID(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_word();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===64){result1="@";pos++}else{result1=null;if(reportFailures===0){matchFailed('"@"')}}if(result1!==null){result2=parse_word();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Contact(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;result0=parse_STAR();if(result0===null){pos1=pos;result0=parse_contact_param();if(result0!==null){result1=[];pos2=pos;result2=parse_COMMA();if(result2!==null){result3=parse_contact_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_COMMA();if(result2!==null){result3=parse_contact_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}if(result0!==null){result0=function(offset){var idx,length;length=data.multi_header.length;for(idx=0;idx<length;idx++){if(data.multi_header[idx].parsed===null){data=null;break}}if(data!==null){data=data.multi_header}else{data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_contact_param(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_SIP_URI_noparams();if(result0===null){result0=parse_name_addr()}if(result0!==null){result1=[];pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_contact_params();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_contact_params();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var header;if(!data.multi_header)data.multi_header=[];try{header=new NameAddrHeader(data.uri,data.display_name,data.params);delete data.uri;delete data.display_name;delete data.params}catch(e){header=null}data.multi_header.push({possition:pos,offset:offset,parsed:header})}(pos0)}if(result0===null){pos=pos0}return result0}function parse_name_addr(){var result0,result1,result2,result3;var pos0;pos0=pos;result0=parse_display_name();result0=result0!==null?result0:"";if(result0!==null){result1=parse_LAQUOT();if(result1!==null){result2=parse_SIP_URI();if(result2!==null){result3=parse_RAQUOT();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_display_name(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_token();if(result0!==null){result1=[];pos2=pos;result2=parse_LWS();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_LWS();if(result2!==null){result3=parse_token();
if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){result0=parse_quoted_string()}if(result0!==null){result0=function(offset,display_name){display_name=input.substring(pos,offset).trim();if(display_name[0]==='"'){display_name=display_name.substring(1,display_name.length-1)}data.display_name=display_name}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_contact_params(){var result0;result0=parse_c_p_q();if(result0===null){result0=parse_c_p_expires();if(result0===null){result0=parse_generic_param()}}return result0}function parse_c_p_q(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,1).toLowerCase()==="q"){result0=input.substr(pos,1);pos++}else{result0=null;if(reportFailures===0){matchFailed('"q"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_qvalue();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,q){if(!data.params)data.params={};data.params["q"]=q}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_c_p_expires(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,7).toLowerCase()==="expires"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"expires"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_delta_seconds();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,expires){if(!data.params)data.params={};data.params["expires"]=expires}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_delta_seconds(){var result0,result1;var pos0;pos0=pos;result1=parse_DIGIT();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_DIGIT()}}else{result0=null}if(result0!==null){result0=function(offset,delta_seconds){return parseInt(delta_seconds.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_qvalue(){var result0,result1,result2,result3,result4;var pos0,pos1,pos2;pos0=pos;pos1=pos;if(input.charCodeAt(pos)===48){result0="0";pos++}else{result0=null;if(reportFailures===0){matchFailed('"0"')}}if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1!==null){result2=parse_DIGIT();result2=result2!==null?result2:"";if(result2!==null){result3=parse_DIGIT();result3=result3!==null?result3:"";if(result3!==null){result4=parse_DIGIT();result4=result4!==null?result4:"";if(result4!==null){result1=[result1,result2,result3,result4]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return parseFloat(input.substring(pos,offset))}(pos0)}if(result0===null){pos=pos0}return result0}function parse_generic_param(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_token();if(result0!==null){pos2=pos;result1=parse_EQUAL();if(result1!==null){result2=parse_gen_value();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,param,value){if(!data.params)data.params={};if(typeof value==="undefined"){value=undefined}else{value=value[1]}data.params[param.toLowerCase()]=value}(pos0,result0[0],result0[1])}if(result0===null){pos=pos0}return result0}function parse_gen_value(){var result0;result0=parse_token();if(result0===null){result0=parse_host();if(result0===null){result0=parse_quoted_string()}}return result0}function parse_Content_Disposition(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_disp_type();if(result0!==null){result1=[];pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_disp_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_disp_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_disp_type(){var result0;if(input.substr(pos,6).toLowerCase()==="render"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"render"')}}if(result0===null){if(input.substr(pos,7).toLowerCase()==="session"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"session"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="icon"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"icon"')}}if(result0===null){if(input.substr(pos,5).toLowerCase()==="alert"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"alert"')}}if(result0===null){result0=parse_token()}}}}return result0}function parse_disp_param(){var result0;result0=parse_handling_param();if(result0===null){result0=parse_generic_param()}return result0}function parse_handling_param(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,8).toLowerCase()==="handling"){result0=input.substr(pos,8);pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"handling"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){if(input.substr(pos,8).toLowerCase()==="optional"){result2=input.substr(pos,8);pos+=8}else{result2=null;if(reportFailures===0){matchFailed('"optional"')}}if(result2===null){if(input.substr(pos,8).toLowerCase()==="required"){result2=input.substr(pos,8);pos+=8}else{result2=null;if(reportFailures===0){matchFailed('"required"')}}if(result2===null){result2=parse_token()}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Content_Encoding(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Content_Length(){var result0,result1;var pos0;pos0=pos;result1=parse_DIGIT();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_DIGIT()}}else{result0=null}if(result0!==null){result0=function(offset,length){data=parseInt(length.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Content_Type(){var result0;var pos0;pos0=pos;result0=parse_media_type();if(result0!==null){result0=function(offset){data=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_media_type(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;result0=parse_m_type();if(result0!==null){result1=parse_SLASH();if(result1!==null){result2=parse_m_subtype();if(result2!==null){result3=[];pos1=pos;result4=parse_SEMI();if(result4!==null){result5=parse_m_parameter();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}while(result4!==null){result3.push(result4);pos1=pos;result4=parse_SEMI();if(result4!==null){result5=parse_m_parameter();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}}if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_m_type(){var result0;result0=parse_discrete_type();if(result0===null){result0=parse_composite_type()}return result0}function parse_discrete_type(){var result0;if(input.substr(pos,4).toLowerCase()==="text"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"text"')}}if(result0===null){if(input.substr(pos,5).toLowerCase()==="image"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"image"')}}if(result0===null){if(input.substr(pos,5).toLowerCase()==="audio"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"audio"')}}if(result0===null){if(input.substr(pos,5).toLowerCase()==="video"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"video"')}}if(result0===null){if(input.substr(pos,11).toLowerCase()==="application"){result0=input.substr(pos,11);pos+=11}else{result0=null;if(reportFailures===0){matchFailed('"application"')}}if(result0===null){result0=parse_extension_token()}}}}}return result0}function parse_composite_type(){var result0;if(input.substr(pos,7).toLowerCase()==="message"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"message"')}}if(result0===null){if(input.substr(pos,9).toLowerCase()==="multipart"){result0=input.substr(pos,9);pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"multipart"')}}if(result0===null){result0=parse_extension_token()}}return result0}function parse_extension_token(){var result0;result0=parse_token();if(result0===null){result0=parse_x_token()}return result0}function parse_x_token(){var result0,result1;var pos0;pos0=pos;if(input.substr(pos,2).toLowerCase()==="x-"){result0=input.substr(pos,2);pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"x-"')}}if(result0!==null){result1=parse_token();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_m_subtype(){var result0;result0=parse_extension_token();if(result0===null){result0=parse_token()}return result0}function parse_m_parameter(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_token();if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_m_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_m_value(){var result0;result0=parse_token();if(result0===null){result0=parse_quoted_string()}return result0}function parse_CSeq(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_CSeq_value();if(result0!==null){result1=parse_LWS();if(result1!==null){result2=parse_Method();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_CSeq_value(){var result0,result1;var pos0;pos0=pos;result1=parse_DIGIT();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_DIGIT()}}else{result0=null}if(result0!==null){result0=function(offset,cseq_value){data.value=parseInt(cseq_value.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Expires(){var result0;var pos0;pos0=pos;result0=parse_delta_seconds();if(result0!==null){result0=function(offset,expires){data=expires}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Event(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_event_type();if(result0!==null){result1=[];pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,event_type){data.event=event_type.join("").toLowerCase()}(pos0,result0[0])}if(result0===null){pos=pos0}return result0}function parse_event_type(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token_nodot();if(result0!==null){result1=[];pos1=pos;if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}if(result2!==null){result3=parse_token_nodot();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}if(result2!==null){result3=parse_token_nodot();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_From(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_SIP_URI_noparams();if(result0===null){result0=parse_name_addr()}if(result0!==null){result1=[];pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_from_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_from_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var tag=data.tag;try{data=new NameAddrHeader(data.uri,data.display_name,data.params);if(tag){data.setParam("tag",tag)}}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_from_param(){var result0;result0=parse_tag_param();if(result0===null){result0=parse_generic_param()}return result0}function parse_tag_param(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,3).toLowerCase()==="tag"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"tag"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_token();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,tag){data.tag=tag}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_Max_Forwards(){var result0,result1;var pos0;pos0=pos;result1=parse_DIGIT();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_DIGIT()}}else{result0=null}if(result0!==null){result0=function(offset,forwards){data=parseInt(forwards.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Min_Expires(){var result0;var pos0;pos0=pos;result0=parse_delta_seconds();if(result0!==null){result0=function(offset,min_expires){data=min_expires}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Name_Addr_Header(){var result0,result1,result2,result3,result4,result5,result6;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=[];result1=parse_display_name();while(result1!==null){result0.push(result1);result1=parse_display_name()}if(result0!==null){result1=parse_LAQUOT();if(result1!==null){result2=parse_SIP_URI();if(result2!==null){result3=parse_RAQUOT();if(result3!==null){result4=[];pos2=pos;result5=parse_SEMI();if(result5!==null){result6=parse_generic_param();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}while(result5!==null){result4.push(result5);pos2=pos;result5=parse_SEMI();if(result5!==null){result6=parse_generic_param();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}}if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){try{data=new NameAddrHeader(data.uri,data.display_name,data.params)}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Proxy_Authenticate(){var result0;result0=parse_challenge();return result0}function parse_challenge(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;if(input.substr(pos,6).toLowerCase()==="digest"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"Digest"')}}if(result0!==null){result1=parse_LWS();if(result1!==null){result2=parse_digest_cln();if(result2!==null){result3=[];pos1=pos;result4=parse_COMMA();if(result4!==null){result5=parse_digest_cln();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}while(result4!==null){result3.push(result4);pos1=pos;result4=parse_COMMA();if(result4!==null){result5=parse_digest_cln();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}}if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){result0=parse_other_challenge()}return result0}function parse_other_challenge(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=parse_LWS();if(result1!==null){result2=parse_auth_param();if(result2!==null){result3=[];pos1=pos;result4=parse_COMMA();if(result4!==null){result5=parse_auth_param();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}while(result4!==null){result3.push(result4);pos1=pos;result4=parse_COMMA();if(result4!==null){result5=parse_auth_param();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}}if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_auth_param(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_token();if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_token();if(result2===null){result2=parse_quoted_string()}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_digest_cln(){var result0;result0=parse_realm();if(result0===null){result0=parse_domain();if(result0===null){result0=parse_nonce();if(result0===null){result0=parse_opaque();if(result0===null){result0=parse_stale();if(result0===null){result0=parse_algorithm();if(result0===null){result0=parse_qop_options();if(result0===null){result0=parse_auth_param()}}}}}}}return result0}function parse_realm(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,5).toLowerCase()==="realm"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"realm"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_realm_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_realm_value(){var result0;var pos0;pos0=pos;result0=parse_quoted_string_clean();if(result0!==null){result0=function(offset,realm){data.realm=realm}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_domain(){var result0,result1,result2,result3,result4,result5,result6;var pos0,pos1;pos0=pos;if(input.substr(pos,6).toLowerCase()==="domain"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"domain"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_LDQUOT();if(result2!==null){result3=parse_URI();if(result3!==null){result4=[];pos1=pos;result6=parse_SP();if(result6!==null){result5=[];while(result6!==null){result5.push(result6);result6=parse_SP()}}else{result5=null}if(result5!==null){result6=parse_URI();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos1}}else{result5=null;pos=pos1}while(result5!==null){result4.push(result5);pos1=pos;result6=parse_SP();if(result6!==null){result5=[];while(result6!==null){result5.push(result6);result6=parse_SP()}}else{result5=null}if(result5!==null){result6=parse_URI();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos1}}else{result5=null;pos=pos1}}if(result4!==null){result5=parse_RDQUOT();if(result5!==null){result0=[result0,result1,result2,result3,result4,result5]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_URI(){var result0;result0=parse_absoluteURI();if(result0===null){result0=parse_abs_path()}return result0}function parse_nonce(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,5).toLowerCase()==="nonce"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"nonce"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_nonce_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_nonce_value(){var result0;var pos0;pos0=pos;result0=parse_quoted_string_clean();if(result0!==null){result0=function(offset,nonce){data.nonce=nonce}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_opaque(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,6).toLowerCase()==="opaque"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"opaque"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_quoted_string_clean();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,opaque){data.opaque=opaque}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_stale(){var result0,result1,result2;var pos0,pos1;pos0=pos;if(input.substr(pos,5).toLowerCase()==="stale"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"stale"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){pos1=pos;if(input.substr(pos,4).toLowerCase()==="true"){result2=input.substr(pos,4);pos+=4}else{result2=null;if(reportFailures===0){matchFailed('"true"')}}if(result2!==null){result2=function(offset){data.stale=true}(pos1)}if(result2===null){pos=pos1}if(result2===null){pos1=pos;if(input.substr(pos,5).toLowerCase()==="false"){result2=input.substr(pos,5);pos+=5}else{result2=null;if(reportFailures===0){matchFailed('"false"')}}if(result2!==null){result2=function(offset){data.stale=false}(pos1)}if(result2===null){pos=pos1}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_algorithm(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,9).toLowerCase()==="algorithm"){result0=input.substr(pos,9);pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"algorithm"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){if(input.substr(pos,3).toLowerCase()==="md5"){result2=input.substr(pos,3);pos+=3}else{result2=null;if(reportFailures===0){matchFailed('"MD5"')}}if(result2===null){if(input.substr(pos,8).toLowerCase()==="md5-sess"){result2=input.substr(pos,8);pos+=8}else{result2=null;if(reportFailures===0){matchFailed('"MD5-sess"')}}if(result2===null){result2=parse_token()}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,algorithm){data.algorithm=algorithm.toUpperCase()}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_qop_options(){var result0,result1,result2,result3,result4,result5,result6;var pos0,pos1,pos2;pos0=pos;if(input.substr(pos,3).toLowerCase()==="qop"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"qop"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_LDQUOT();if(result2!==null){pos1=pos;result3=parse_qop_value();if(result3!==null){result4=[];pos2=pos;if(input.charCodeAt(pos)===44){result5=",";pos++}else{result5=null;if(reportFailures===0){matchFailed('","')}}if(result5!==null){result6=parse_qop_value();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}while(result5!==null){result4.push(result5);pos2=pos;if(input.charCodeAt(pos)===44){result5=",";pos++}else{result5=null;if(reportFailures===0){matchFailed('","')}}if(result5!==null){result6=parse_qop_value();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}}if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos1}}else{result3=null;pos=pos1}if(result3!==null){result4=parse_RDQUOT();if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_qop_value(){var result0;var pos0;pos0=pos;if(input.substr(pos,8).toLowerCase()==="auth-int"){result0=input.substr(pos,8);pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"auth-int"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="auth"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"auth"')}}if(result0===null){result0=parse_token()}}if(result0!==null){result0=function(offset,qop_value){data.qop||(data.qop=[]);data.qop.push(qop_value.toLowerCase())}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Proxy_Require(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Record_Route(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_rec_route();if(result0!==null){result1=[];pos2=pos;result2=parse_COMMA();if(result2!==null){result3=parse_rec_route();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_COMMA();if(result2!==null){result3=parse_rec_route();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var idx,length;length=data.multi_header.length;for(idx=0;idx<length;idx++){if(data.multi_header[idx].parsed===null){data=null;break}}if(data!==null){data=data.multi_header}else{data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_rec_route(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_name_addr();if(result0!==null){result1=[];pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var header;if(!data.multi_header)data.multi_header=[];try{header=new NameAddrHeader(data.uri,data.display_name,data.params);delete data.uri;delete data.display_name;delete data.params}catch(e){header=null}data.multi_header.push({possition:pos,offset:offset,parsed:header})}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Require(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Route(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_route_param();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_route_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_route_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_route_param(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_name_addr();if(result0!==null){result1=[];pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Subscription_State(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_substate_value();if(result0!==null){result1=[];pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_subexp_params();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);
pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_subexp_params();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_substate_value(){var result0;var pos0;pos0=pos;if(input.substr(pos,6).toLowerCase()==="active"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"active"')}}if(result0===null){if(input.substr(pos,7).toLowerCase()==="pending"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"pending"')}}if(result0===null){if(input.substr(pos,10).toLowerCase()==="terminated"){result0=input.substr(pos,10);pos+=10}else{result0=null;if(reportFailures===0){matchFailed('"terminated"')}}if(result0===null){result0=parse_token()}}}if(result0!==null){result0=function(offset){data.state=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_subexp_params(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,6).toLowerCase()==="reason"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"reason"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_event_reason_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,reason){if(typeof reason!=="undefined")data.reason=reason}(pos0,result0[2])}if(result0===null){pos=pos0}if(result0===null){pos0=pos;pos1=pos;if(input.substr(pos,7).toLowerCase()==="expires"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"expires"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_delta_seconds();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,expires){if(typeof expires!=="undefined")data.expires=expires}(pos0,result0[2])}if(result0===null){pos=pos0}if(result0===null){pos0=pos;pos1=pos;if(input.substr(pos,11).toLowerCase()==="retry_after"){result0=input.substr(pos,11);pos+=11}else{result0=null;if(reportFailures===0){matchFailed('"retry_after"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_delta_seconds();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,retry_after){if(typeof retry_after!=="undefined")data.retry_after=retry_after}(pos0,result0[2])}if(result0===null){pos=pos0}if(result0===null){result0=parse_generic_param()}}}return result0}function parse_event_reason_value(){var result0;if(input.substr(pos,11).toLowerCase()==="deactivated"){result0=input.substr(pos,11);pos+=11}else{result0=null;if(reportFailures===0){matchFailed('"deactivated"')}}if(result0===null){if(input.substr(pos,9).toLowerCase()==="probation"){result0=input.substr(pos,9);pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"probation"')}}if(result0===null){if(input.substr(pos,8).toLowerCase()==="rejected"){result0=input.substr(pos,8);pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"rejected"')}}if(result0===null){if(input.substr(pos,7).toLowerCase()==="timeout"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"timeout"')}}if(result0===null){if(input.substr(pos,6).toLowerCase()==="giveup"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"giveup"')}}if(result0===null){if(input.substr(pos,10).toLowerCase()==="noresource"){result0=input.substr(pos,10);pos+=10}else{result0=null;if(reportFailures===0){matchFailed('"noresource"')}}if(result0===null){if(input.substr(pos,9).toLowerCase()==="invariant"){result0=input.substr(pos,9);pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"invariant"')}}if(result0===null){result0=parse_token()}}}}}}}return result0}function parse_Subject(){var result0;result0=parse_TEXT_UTF8_TRIM();result0=result0!==null?result0:"";return result0}function parse_Supported(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}result0=result0!==null?result0:"";return result0}function parse_To(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_SIP_URI_noparams();if(result0===null){result0=parse_name_addr()}if(result0!==null){result1=[];pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_to_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_to_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var tag=data.tag;try{data=new NameAddrHeader(data.uri,data.display_name,data.params);if(tag){data.setParam("tag",tag)}}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_to_param(){var result0;result0=parse_tag_param();if(result0===null){result0=parse_generic_param()}return result0}function parse_Via(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_via_parm();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_via_parm();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_via_parm();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_via_parm(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;result0=parse_sent_protocol();if(result0!==null){result1=parse_LWS();if(result1!==null){result2=parse_sent_by();if(result2!==null){result3=[];pos1=pos;result4=parse_SEMI();if(result4!==null){result5=parse_via_params();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}while(result4!==null){result3.push(result4);pos1=pos;result4=parse_SEMI();if(result4!==null){result5=parse_via_params();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}}if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_via_params(){var result0;result0=parse_via_ttl();if(result0===null){result0=parse_via_maddr();if(result0===null){result0=parse_via_received();if(result0===null){result0=parse_via_branch();if(result0===null){result0=parse_response_port();if(result0===null){result0=parse_generic_param()}}}}}return result0}function parse_via_ttl(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,3).toLowerCase()==="ttl"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"ttl"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_ttl();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_ttl_value){data.ttl=via_ttl_value}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_via_maddr(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,5).toLowerCase()==="maddr"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"maddr"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_host();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_maddr){data.maddr=via_maddr}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_via_received(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,8).toLowerCase()==="received"){result0=input.substr(pos,8);pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"received"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_IPv4address();if(result2===null){result2=parse_IPv6address()}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_received){data.received=via_received}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_via_branch(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,6).toLowerCase()==="branch"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"branch"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_token();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_branch){data.branch=via_branch}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_response_port(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;if(input.substr(pos,5).toLowerCase()==="rport"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"rport"')}}if(result0!==null){pos2=pos;result1=parse_EQUAL();if(result1!==null){result2=[];result3=parse_DIGIT();while(result3!==null){result2.push(result3);result3=parse_DIGIT()}if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){if(typeof response_port!=="undefined")data.rport=response_port.join("")}(pos0)}if(result0===null){pos=pos0}return result0}function parse_sent_protocol(){var result0,result1,result2,result3,result4;var pos0;pos0=pos;result0=parse_protocol_name();if(result0!==null){result1=parse_SLASH();if(result1!==null){result2=parse_token();if(result2!==null){result3=parse_SLASH();if(result3!==null){result4=parse_transport();if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_protocol_name(){var result0;var pos0;pos0=pos;if(input.substr(pos,3).toLowerCase()==="sip"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"SIP"')}}if(result0===null){result0=parse_token()}if(result0!==null){result0=function(offset,via_protocol){data.protocol=via_protocol}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_transport(){var result0;var pos0;pos0=pos;if(input.substr(pos,3).toLowerCase()==="udp"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"UDP"')}}if(result0===null){if(input.substr(pos,3).toLowerCase()==="tcp"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"TCP"')}}if(result0===null){if(input.substr(pos,3).toLowerCase()==="tls"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"TLS"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="sctp"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"SCTP"')}}if(result0===null){result0=parse_token()}}}}if(result0!==null){result0=function(offset,via_transport){data.transport=via_transport}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_sent_by(){var result0,result1,result2;var pos0,pos1;pos0=pos;result0=parse_via_host();if(result0!==null){pos1=pos;result1=parse_COLON();if(result1!==null){result2=parse_via_port();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos1}}else{result1=null;pos=pos1}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_via_host(){var result0;var pos0;pos0=pos;result0=parse_IPv4address();if(result0===null){result0=parse_IPv6reference();if(result0===null){result0=parse_hostname()}}if(result0!==null){result0=function(offset){data.host=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_via_port(){var result0,result1,result2,result3,result4;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_DIGIT();result0=result0!==null?result0:"";if(result0!==null){result1=parse_DIGIT();result1=result1!==null?result1:"";if(result1!==null){result2=parse_DIGIT();result2=result2!==null?result2:"";if(result2!==null){result3=parse_DIGIT();result3=result3!==null?result3:"";if(result3!==null){result4=parse_DIGIT();result4=result4!==null?result4:"";if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_sent_by_port){data.port=parseInt(via_sent_by_port.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_ttl(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_DIGIT();if(result0!==null){result1=parse_DIGIT();result1=result1!==null?result1:"";if(result1!==null){result2=parse_DIGIT();result2=result2!==null?result2:"";if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,ttl){return parseInt(ttl.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_WWW_Authenticate(){var result0;result0=parse_challenge();return result0}function parse_extension_header(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_token();if(result0!==null){result1=parse_HCOLON();if(result1!==null){result2=parse_header_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_header_value(){var result0,result1;result0=[];result1=parse_TEXT_UTF8char();if(result1===null){result1=parse_UTF8_CONT();if(result1===null){result1=parse_LWS()}}while(result1!==null){result0.push(result1);result1=parse_TEXT_UTF8char();if(result1===null){result1=parse_UTF8_CONT();if(result1===null){result1=parse_LWS()}}}return result0}function parse_message_body(){var result0,result1;result0=[];result1=parse_OCTET();while(result1!==null){result0.push(result1);result1=parse_OCTET()}return result0}function parse_stun_URI(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_stun_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_stun_host_port();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_stun_scheme(){var result0;var pos0;pos0=pos;if(input.substr(pos,5).toLowerCase()==="stuns"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"stuns"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="stun"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"stun"')}}}if(result0!==null){result0=function(offset,scheme){data.scheme=scheme}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_stun_host_port(){var result0,result1,result2;var pos0,pos1;pos0=pos;result0=parse_stun_host();if(result0!==null){pos1=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_port();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos1}}else{result1=null;pos=pos1}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_stun_host(){var result0;var pos0;pos0=pos;result0=parse_IPv4address();if(result0===null){result0=parse_IPv6reference();if(result0===null){result0=parse_reg_name()}}if(result0!==null){result0=function(offset,host){data.host=host}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_reg_name(){var result0,result1;var pos0;pos0=pos;result0=[];result1=parse_stun_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_sub_delims()}}while(result1!==null){result0.push(result1);result1=parse_stun_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_sub_delims()}}}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_stun_unreserved(){var result0;result0=parse_ALPHA();if(result0===null){result0=parse_DIGIT();if(result0===null){if(input.charCodeAt(pos)===45){result0="-";pos++}else{result0=null;if(reportFailures===0){matchFailed('"-"')}}if(result0===null){if(input.charCodeAt(pos)===46){result0=".";pos++}else{result0=null;if(reportFailures===0){matchFailed('"."')}}if(result0===null){if(input.charCodeAt(pos)===95){result0="_";pos++}else{result0=null;if(reportFailures===0){matchFailed('"_"')}}if(result0===null){if(input.charCodeAt(pos)===126){result0="~";pos++}else{result0=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}return result0}function parse_sub_delims(){var result0;if(input.charCodeAt(pos)===33){result0="!";pos++}else{result0=null;if(reportFailures===0){matchFailed('"!"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===39){result0="'";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\'"')}}if(result0===null){if(input.charCodeAt(pos)===40){result0="(";pos++}else{result0=null;if(reportFailures===0){matchFailed('"("')}}if(result0===null){if(input.charCodeAt(pos)===41){result0=")";pos++}else{result0=null;if(reportFailures===0){matchFailed('")"')}}if(result0===null){if(input.charCodeAt(pos)===42){result0="*";pos++}else{result0=null;if(reportFailures===0){matchFailed('"*"')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}if(result0===null){if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}}}}}}}}}}}return result0}function parse_turn_URI(){var result0,result1,result2,result3,result4;var pos0,pos1;pos0=pos;result0=parse_turn_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_stun_host_port();if(result2!==null){pos1=pos;if(input.substr(pos,11)==="?transport="){result3="?transport=";pos+=11}else{result3=null;if(reportFailures===0){matchFailed('"?transport="')}}if(result3!==null){result4=parse_transport();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos1}}else{result3=null;pos=pos1}result3=result3!==null?result3:"";if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_turn_scheme(){var result0;var pos0;pos0=pos;if(input.substr(pos,5).toLowerCase()==="turns"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"turns"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="turn"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"turn"')}}}if(result0!==null){result0=function(offset,scheme){data.scheme=scheme}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_turn_transport(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_transport();if(result0!==null){if(input.substr(pos,3).toLowerCase()==="udp"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"udp"')}}if(result1===null){if(input.substr(pos,3).toLowerCase()==="tcp"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"tcp"')}}if(result1===null){result1=[];result2=parse_unreserved();while(result2!==null){result1.push(result2);result2=parse_unreserved()}}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.transport=transport}(pos0)}if(result0===null){pos=pos0}return result0}function parse_uuid_URI(){var result0,result1;var pos0;pos0=pos;if(input.substr(pos,5)==="uuid:"){result0="uuid:";pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"uuid:"')}}if(result0!==null){result1=parse_uuid();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_uuid(){var result0,result1,result2,result3,result4,result5,result6,result7,result8;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_hex8();if(result0!==null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1!==null){result2=parse_hex4();if(result2!==null){if(input.charCodeAt(pos)===45){result3="-";pos++}else{result3=null;if(reportFailures===0){matchFailed('"-"')}}if(result3!==null){result4=parse_hex4();if(result4!==null){if(input.charCodeAt(pos)===45){result5="-";pos++}else{result5=null;if(reportFailures===0){matchFailed('"-"')}}if(result5!==null){result6=parse_hex4();if(result6!==null){if(input.charCodeAt(pos)===45){result7="-";pos++}else{result7=null;if(reportFailures===0){matchFailed('"-"')}}if(result7!==null){result8=parse_hex12();if(result8!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,uuid){data=input.substring(pos+5,offset)}(pos0,result0[0])}if(result0===null){pos=pos0}return result0}function parse_hex4(){var result0,result1,result2,result3;var pos0;pos0=pos;result0=parse_HEXDIG();if(result0!==null){result1=parse_HEXDIG();if(result1!==null){result2=parse_HEXDIG();if(result2!==null){result3=parse_HEXDIG();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_hex8(){var result0,result1;var pos0;pos0=pos;result0=parse_hex4();if(result0!==null){result1=parse_hex4();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_hex12(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_hex4();if(result0!==null){result1=parse_hex4();if(result1!==null){result2=parse_hex4();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function cleanupExpected(expected){expected.sort();var lastExpected=null;var cleanExpected=[];for(var i=0;i<expected.length;i++){if(expected[i]!==lastExpected){cleanExpected.push(expected[i]);lastExpected=expected[i]}}return cleanExpected}function computeErrorPosition(){var line=1;var column=1;var seenCR=false;for(var i=0;i<Math.max(pos,rightmostFailuresPos);i++){var ch=input.charAt(i);if(ch==="\n"){if(!seenCR){line++}column=1;seenCR=false}else if(ch==="\r"||ch==="\u2028"||ch==="\u2029"){line++;column=1;seenCR=true}else{column++;seenCR=false}}return{line:line,column:column}}var URI=require("./URI");var NameAddrHeader=require("./NameAddrHeader");var data={};var result=parseFunctions[startRule]();if(result===null||pos!==input.length){var offset=Math.max(pos,rightmostFailuresPos);var found=offset<input.length?input.charAt(offset):null;var errorPosition=computeErrorPosition();new this.SyntaxError(cleanupExpected(rightmostFailuresExpected),found,offset,errorPosition.line,errorPosition.column);return-1}return data},toSource:function(){return this._source}};result.SyntaxError=function(expected,found,offset,line,column){function buildMessage(expected,found){var expectedHumanized,foundHumanized;switch(expected.length){case 0:expectedHumanized="end of input";break;case 1:expectedHumanized=expected[0];break;default:expectedHumanized=expected.slice(0,expected.length-1).join(", ")+" or "+expected[expected.length-1]}foundHumanized=found?quote(found):"end of input";return"Expected "+expectedHumanized+" but "+foundHumanized+" found."}this.name="SyntaxError";this.expected=expected;this.found=found;this.message=buildMessage(expected,found);this.offset=offset;this.line=line;this.column=column};result.SyntaxError.prototype=Error.prototype;return result}()},{"./NameAddrHeader":208,"./URI":221}],205:[function(require,module,exports){module.exports=Logger;function DateFmt(fstr){this.formatString=fstr;var mthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var zeroPad=function(number){return("0"+number).substr(-2,2)};var dateMarkers={d:["getDate",function(v){return zeroPad(v)}],m:["getMonth",function(v){return zeroPad(v+1)}],n:["getMonth",function(v){return mthNames[v]}],w:["getDay",function(v){return dayNames[v]}],y:["getFullYear"],H:["getHours",function(v){return zeroPad(v)}],M:["getMinutes",function(v){return zeroPad(v)}],S:["getSeconds",function(v){return zeroPad(v)}],i:["toISOString"]};this.format=function(date){var dateTxt=this.formatString.replace(/%(.)/g,function(m,p){var dateMarker=dateMarkers[p];var method=dateMarker[0];var rv=date[method]();if(dateMarker[1]!==null){rv=dateMarker[1](rv)}return rv});return dateTxt}}function Logger(logger,category,label){this.logger=logger;this.category=category;this.label=label;this.fmt=new DateFmt("%m%d/%H%M%S")}Logger.prototype.debug=function(content){this.logger.debug(this.category,this.label,content)};Logger.prototype.log=function(content){this.logger.log(this.category,this.label,content)};Logger.prototype.warn=function(content){this.logger.warn(this.category,this.label,content)};Logger.prototype.error=function(content){this.logger.error(this.category,this.label,content)};Logger.prototype.formatMsg=function(msg){return this.getTime()+" : "+msg};Logger.prototype.getTime=function(){return this.getTimeFor(new Date)};Logger.prototype.getTimeFor=function(date){return this.fmt.format(date)}},{}],206:[function(require,module,exports){module.exports=LoggerFactory;var Logger=require("./Logger");function LoggerFactory(){var logger,levels={error:0,warn:1,log:2,debug:3},level=1,builtinEnabled=true,connector=null;this.loggers={};logger=this.getLogger("ExSIP.loggerfactory");Object.defineProperties(this,{builtinEnabled:{get:function(){return builtinEnabled},set:function(value){if(typeof value==="boolean"){builtinEnabled=value}else{logger.error('invalid "builtinEnabled" parameter value: '+JSON.stringify(value))}}},level:{get:function(){return level},set:function(value){if(value>=0&&value<=3){level=value}else if(value>3){level=3}else if(levels.hasOwnProperty(value)){level=levels[value]}else{logger.error('invalid "level" parameter value: '+JSON.stringify(value))}}},connector:{get:function(){return connector},set:function(value){if(value===null||value===""||value===undefined){connector=null}else if(typeof value==="function"){connector=value}else{logger.error('invalid "connector" parameter value: '+JSON.stringify(value))}}}})}LoggerFactory.prototype.print=function(target,category,label,content){var prefix=[];prefix.push(new Date);prefix.push(category);if(label){prefix.push(label)}prefix.push("");if(typeof content==="string"){target.call(console,prefix.join(" | ")+content)}else{target.call(console,content)}};LoggerFactory.prototype.debug=function(category,label,content){if(this.level===3){if(this.builtinEnabled){this.print(console.info,category,label,content)}if(this.connector){this.connector("debug",category,label,content)}}};LoggerFactory.prototype.log=function(category,label,content){if(this.level>=2){if(this.builtinEnabled){this.print(console.log,category,label,content)}if(this.connector){this.connector("log",category,label,content)}}};LoggerFactory.prototype.warn=function(category,label,content){if(this.level>=1){if(this.builtinEnabled){this.print(console.warn,category,label,content)}if(this.connector){this.connector("warn",category,label,content)}}};LoggerFactory.prototype.error=function(category,label,content){if(this.builtinEnabled){this.print(console.error,category,label,content)}if(this.connector){this.connector("error",category,label,content)}};LoggerFactory.prototype.getLogger=function(category,label){var logger;if(label&&this.level===1){return new Logger(this,category,label)}else if(this.loggers[category]){return this.loggers[category]}else{logger=new Logger(this,category);this.loggers[category]=logger;return logger}}},{"./Logger":205}],207:[function(require,module,exports){module.exports=Message;function Message(ua){this.ua=ua;this.logger=ua.getLogger("ExSIP.message");this.data={}}var ExSIP_C=require("./Constants");var EventEmitter=require("./EventEmitter");var SIPMessage=require("./SIPMessage");var Utils=require("./Utils");var RequestSender=require("./RequestSender");var Transactions=require("./Transactions");var Exceptions=require("./Exceptions");Message.prototype=new EventEmitter;Message.prototype.isDebug=function(){return this.ua.isDebug()};Message.prototype.send=function(target,body,options){var request_sender,event,contentType,eventHandlers,extraHeaders,events=["succeeded","failed"],originalTarget=target;if(target===undefined||body===undefined){throw new TypeError("Not enough arguments")}target=this.ua.normalizeTarget(target);if(!target){throw new TypeError("Invalid target: "+originalTarget)}this.initEvents(events);options=options||{};extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[];eventHandlers=options.eventHandlers||{};
contentType=options.contentType||"text/plain";this.content_type=contentType;for(event in eventHandlers){this.on(event,eventHandlers[event])}this.closed=false;this.ua.applicants[this]=this;extraHeaders.push("Content-Type: "+contentType);this.request=new SIPMessage.OutgoingRequest(ExSIP_C.MESSAGE,target,this.ua,null,extraHeaders);if(body){this.request.body=body;this.content=body}else{this.content=null}request_sender=new RequestSender(this,this.ua);this.newMessage("local",this.request);request_sender.send()};Message.prototype.receiveResponse=function(response){var cause;if(this.closed){return}switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):delete this.ua.applicants[this];this.emit("succeeded",this,{originator:"remote",response:response});break;default:delete this.ua.applicants[this];cause=Utils.sipErrorCause(response.status_code);this.emit("failed",this,{originator:"remote",response:response,cause:cause});break}};Message.prototype.onRequestTimeout=function(){if(this.closed){return}this.emit("failed",this,{originator:"system",cause:ExSIP_C.causes.REQUEST_TIMEOUT})};Message.prototype.onTransportError=function(){if(this.closed){return}this.emit("failed",this,{originator:"system",cause:ExSIP_C.causes.CONNECTION_ERROR})};Message.prototype.close=function(){this.closed=true;delete this.ua.applicants[this]};Message.prototype.init_incoming=function(request){var transaction;this.request=request;this.content_type=request.getHeader("Content-Type");if(request.body){this.content=request.body}else{this.content=null}this.newMessage("remote",request);transaction=this.ua.transactions.nist[request.via_branch];if(transaction&&(transaction.state===Transactions.C.STATUS_TRYING||transaction.state===Transactions.C.STATUS_PROCEEDING)){request.reply(200)}};Message.prototype.accept=function(options){options=options||{};var extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],body=options.body;if(this.direction!=="incoming"){throw new Exceptions.NotSupportedError('"accept" not supported for outgoing Message')}this.request.reply(200,null,extraHeaders,body)};Message.prototype.reject=function(options){options=options||{};var status_code=options.status_code||480,reason_phrase=options.reason_phrase,extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],body=options.body;if(this.direction!=="incoming"){throw new Exceptions.NotSupportedError('"reject" not supported for outgoing Message')}if(status_code<300||status_code>=700){throw new TypeError("Invalid status_code: "+status_code)}this.request.reply(status_code,reason_phrase,extraHeaders,body)};Message.prototype.newMessage=function(originator,request){var message=this,event_name="newMessage";if(originator==="remote"){message.direction="incoming";message.local_identity=request.to;message.remote_identity=request.from}else if(originator==="local"){message.direction="outgoing";message.local_identity=request.from;message.remote_identity=request.to}message.ua.emit(event_name,message.ua,{originator:originator,message:message,request:request})}},{"./Constants":197,"./EventEmitter":201,"./Exceptions":203,"./RequestSender":215,"./SIPMessage":216,"./Transactions":218,"./Utils":222}],208:[function(require,module,exports){module.exports=NameAddrHeader;var URI=require("./URI");var Grammar=require("./Grammar");function NameAddrHeader(uri,display_name,parameters){var param;if(!uri||!(uri instanceof URI)){throw new TypeError('missing or invalid "uri" parameter')}this.uri=uri;this.parameters={};for(param in parameters){this.setParam(param,parameters[param])}Object.defineProperties(this,{display_name:{get:function(){return display_name},set:function(value){display_name=value===0?"0":value}}})}NameAddrHeader.prototype={setParam:function(key,value){if(key){this.parameters[key.toLowerCase()]=typeof value==="undefined"||value===null?null:value.toString()}},getParam:function(key){if(key){return this.parameters[key.toLowerCase()]}},hasParam:function(key){if(key){return this.parameters.hasOwnProperty(key.toLowerCase())&&true||false}},deleteParam:function(parameter){var value;parameter=parameter.toLowerCase();if(this.parameters.hasOwnProperty(parameter)){value=this.parameters[parameter];delete this.parameters[parameter];return value}},clearParams:function(){this.parameters={}},clone:function(){return new NameAddrHeader(this.uri.clone(),this.display_name,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var body,parameter;body=this.display_name||this.display_name===0?'"'+this.display_name+'" ':"";body+="<"+this.uri.toString()+">";for(parameter in this.parameters){body+=";"+parameter;if(this.parameters[parameter]!==null){body+="="+this.parameters[parameter]}}return body}};NameAddrHeader.parse=function(name_addr_header){name_addr_header=Grammar.parse(name_addr_header,"Name_Addr_Header");if(name_addr_header!==-1){return name_addr_header}else{return undefined}}},{"./Grammar":204,"./URI":221}],209:[function(require,module,exports){var Parser={};module.exports=Parser;var sdp_transform=require("sdp-transform");var Grammar=require("./Grammar");var SIPMessage=require("./SIPMessage");function getHeader(data,headerStart){var start=headerStart,end=0,partialEnd=0;if(data.substring(start,start+2).match(/(^\r\n)/)){return-2}while(end===0){partialEnd=data.indexOf("\r\n",start);if(partialEnd===-1){return partialEnd}if(!data.substring(partialEnd+2,partialEnd+4).match(/(^\r\n)/)&&data.charAt(partialEnd+2).match(/(^\s+)/)){start=partialEnd+2}else{end=partialEnd}}return end}function parseHeader(message,data,headerStart,headerEnd){var header,idx,length,parsed,hcolonIndex=data.indexOf(":",headerStart),headerName=data.substring(headerStart,hcolonIndex).trim(),headerValue=data.substring(hcolonIndex+1,headerEnd).trim();switch(headerName.toLowerCase()){case"via":case"v":message.addHeader("via",headerValue);if(message.getHeaders("via").length===1){parsed=message.parseHeader("Via");if(parsed){message.via=parsed;message.via_branch=parsed.branch}}else{parsed=0}break;case"from":case"f":message.setHeader("from",headerValue);parsed=message.parseHeader("from");if(parsed){message.from=parsed;message.from_tag=parsed.getParam("tag")}break;case"to":case"t":message.setHeader("to",headerValue);parsed=message.parseHeader("to");if(parsed){message.to=parsed;message.to_tag=parsed.getParam("tag")}break;case"record-route":parsed=Grammar.parse(headerValue,"Record_Route");if(parsed===-1){parsed=undefined}length=parsed.length;for(idx=0;idx<length;idx++){header=parsed[idx];message.addHeader("record-route",headerValue.substring(header.possition,header.offset));message.headers["Record-Route"][message.getHeaders("record-route").length-1].parsed=header.parsed}break;case"call-id":case"i":message.setHeader("call-id",headerValue);parsed=message.parseHeader("call-id");if(parsed){message.call_id=headerValue}break;case"contact":case"m":parsed=Grammar.parse(headerValue,"Contact");if(parsed===-1){parsed=undefined}length=parsed.length;for(idx=0;idx<length;idx++){header=parsed[idx];message.addHeader("contact",headerValue.substring(header.possition,header.offset));message.headers.Contact[message.getHeaders("contact").length-1].parsed=header.parsed}break;case"content-length":case"l":message.setHeader("content-length",headerValue);parsed=message.parseHeader("content-length");break;case"content-type":case"c":message.setHeader("content-type",headerValue);parsed=message.parseHeader("content-type");break;case"cseq":message.setHeader("cseq",headerValue);parsed=message.parseHeader("cseq");if(parsed){message.cseq=parsed.value}if(message instanceof SIPMessage.IncomingResponse){message.method=parsed.method}break;case"max-forwards":message.setHeader("max-forwards",headerValue);parsed=message.parseHeader("max-forwards");break;case"www-authenticate":message.setHeader("www-authenticate",headerValue);parsed=message.parseHeader("www-authenticate");break;case"proxy-authenticate":message.setHeader("proxy-authenticate",headerValue);parsed=message.parseHeader("proxy-authenticate");break;default:message.setHeader(headerName,headerValue);parsed=0}if(parsed===undefined){return{error:'error parsing header "'+headerName+'"'}}else{return true}}Parser.parseMessage=function(data,ua){var message,firstLine,contentLength,bodyStart,parsed,headerStart=0,headerEnd=data.indexOf("\r\n"),logger=ua.getLogger("ExSIP.parser");if(headerEnd===-1){logger.warn("no CRLF found, not a SIP message, discarded");return}firstLine=data.substring(0,headerEnd);parsed=Grammar.parse(firstLine,"Request_Response");if(parsed===-1){logger.warn('error parsing first line of SIP message: "'+firstLine+'"');return}else if(!parsed.status_code){message=new SIPMessage.IncomingRequest(ua);message.method=parsed.method;message.ruri=parsed.uri}else{message=new SIPMessage.IncomingResponse(ua);message.status_code=parsed.status_code;message.reason_phrase=parsed.reason_phrase}message.data=data;headerStart=headerEnd+2;while(true){headerEnd=getHeader(data,headerStart);if(headerEnd===-2){bodyStart=headerStart+2;break}else if(headerEnd===-1){parsed.error("malformed message");return}parsed=parseHeader(message,data,headerStart,headerEnd);if(parsed!==true){logger.error(parsed.error);return}headerStart=headerEnd+2}if(message.hasHeader("content-length")){contentLength=message.getHeader("content-length");message.body=data.substr(bodyStart,contentLength)}else{message.body=data.substring(bodyStart)}return message};Parser.parseSDP=sdp_transform.parse;Parser.writeSDP=sdp_transform.write;Parser.parseFmtpConfig=sdp_transform.parseFmtpConfig;Parser.parsePayloads=sdp_transform.parsePayloads;Parser.parseRemoteCandidates=sdp_transform.parseRemoteCandidates},{"./Grammar":204,"./SIPMessage":216,"sdp-transform":192}],210:[function(require,module,exports){module.exports=RTCSession;var C={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9,STATUS_REFER_SENT:10,STATUS_BYE_SENT:11};RTCSession.C=C;var ExSIP_C=require("./Constants");var EventEmitter=require("./EventEmitter");var Exceptions=require("./Exceptions");var Parser=require("./Parser");var Utils=require("./Utils");var Timers=require("./Timers");var UA=require("./UA");var WebRTC=require("./WebRTC");var SIPMessage=require("./SIPMessage");var Dialog=require("./Dialog");var RequestSender=require("./RequestSender");var RTCSession_RTCMediaHandler=require("./RTCSession/RTCMediaHandler");var RTCSession_DTMF=require("./RTCSession/DTMF");function RTCSession(ua){var events=["connecting","progress","failed","accepted","confirmed","ended","newDTMF","hold","held","resumed","unhold","muted","unmuted","started","onReInvite"];this.ua=ua;this.setStatus(C.STATUS_NULL);this.dialog=null;this.earlyDialogs={};this.rtcMediaHandler=null;this.receiveResponse=this.receiveInviteResponse;this.is_confirmed=false;this.late_sdp=false;this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null};this.data={};this.dtmf=new RTCSession_DTMF(this);this.isOnHold=false;this.audioMuted=false;this.videoMuted=false;this.local_hold=false;this.remote_hold=false;this.start_time=null;this.pending_actions={actions:[],length:function(){return this.actions.length},isPending:function(name){var idx=0,length=this.actions.length;for(idx;idx<length;idx++){if(this.actions[idx].name===name){return true}}return false},shift:function(){return this.actions.shift()},push:function(name){this.actions.push({name:name})},pop:function(name){var idx=0,length=this.actions.length;for(idx;idx<length;idx++){if(this.actions[idx].name===name){this.actions.splice(idx,1)}}}};this.data={};this.initEvents(events)}RTCSession.prototype=new EventEmitter;RTCSession.prototype.terminate=function(options){options=options||{};var cancel_reason,status_code=options.status_code,reason_phrase=options.reason_phrase,extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],body=options.body;if(this.status===C.STATUS_TERMINATED){throw new Exceptions.InvalidStateError(this.status)}this.logger.log("terminate with status : "+this.status);switch(this.status){case C.STATUS_NULL:case C.STATUS_INVITE_SENT:case C.STATUS_1XX_RECEIVED:this.logger.debug("canceling RTCSession");if(status_code&&(status_code<200||status_code>=700)){throw new TypeError("Invalid status_code: "+status_code)}else if(status_code){reason_phrase=reason_phrase||ExSIP_C.REASON_PHRASE[status_code]||"";cancel_reason="SIP ;cause="+status_code+' ;text="'+reason_phrase+'"'}if(this.status===C.STATUS_NULL){this.isCanceled=true;this.cancelReason=cancel_reason}else if(this.status===C.STATUS_INVITE_SENT){if(this.received_100){this.logger.debug("canceling after received 100 response");if(typeof this.request.cancel==="undefined"){this.sendBye(options);this.ended("local",null,ExSIP_C.causes.BYE)}else{this.isCanceled=true;this.logger.log("terminate on 100 - setting isCanceled = true",this.ua);this.request.cancel(cancel_reason)}}else{this.isCanceled=true;this.cancelReason=cancel_reason}}else if(this.status===C.STATUS_1XX_RECEIVED){this.isCanceled=true;this.logger.log("terminate on 1xx - setting isCanceled = true");this.request.cancel(cancel_reason)}this.setStatus(C.STATUS_CANCELED);this.failed("local",null,ExSIP_C.causes.CANCELED);break;case C.STATUS_WAITING_FOR_ANSWER:this.logger.log("rejecting RTCSession with 486 Busy Here",this.ua);this.request.reply(486);this.failed("local",null,ExSIP_C.causes.REJECTED);break;case C.STATUS_ANSWERED:this.logger.debug("rejecting RTCSession");status_code=status_code||480;if(status_code<300||status_code>=700){throw new TypeError("Invalid status_code: "+status_code)}this.request.reply(status_code,reason_phrase,extraHeaders,body);this.failed("local",null,ExSIP_C.causes.REJECTED);break;case C.STATUS_WAITING_FOR_ACK:case C.STATUS_REFER_SENT:case C.STATUS_CONFIRMED:this.logger.debug("terminating RTCSession");this.sendBye(options);return}this.close()};RTCSession.prototype.answer=function(options){options=options||{};var idx,length,sdp,remoteDescription,hasAudio=false,hasVideo=false,self=this,request=this.request,extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],mediaConstraints=options.mediaConstraints||{},mediaStream=options.mediaStream||null,sdpCreationSucceeded=function(body){var replySucceeded=function(){self.setStatus(C.STATUS_WAITING_FOR_ACK);self.setInvite2xxTimer(request,body);self.setACKTimer();self.accepted("local")},replyFailed=function(){self.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)};request.reply(200,null,extraHeaders,body,replySucceeded,replyFailed)},sdpCreationFailed=function(){if(self.status===C.STATUS_TERMINATED){return}self.failed("system",null,ExSIP_C.causes.WEBRTC_ERROR)};this.data=options.data||{};if(this.direction!=="incoming"){throw new Exceptions.NotSupportedError('"answer" not supported for outgoing RTCSession')}else if(this.status!==C.STATUS_WAITING_FOR_ANSWER){throw new Exceptions.InvalidStateError(this.status)}this.setStatus(C.STATUS_ANSWERED);if(!this.createDialog(request,"UAS")){request.reply(500,"Missing Contact header field");return}clearTimeout(this.timers.userNoAnswerTimer);extraHeaders.unshift("Contact: "+self.contact);remoteDescription=this.rtcMediaHandler.peerConnection.remoteDescription||{};sdp=Parser.parseSDP(remoteDescription.sdp||"");if(!(sdp.media instanceof Array)){sdp.media=[sdp.media||[]]}idx=sdp.media.length;while(idx--){if(sdp.media[idx].type==="audio"&&(sdp.media[idx].direction==="sendrecv"||sdp.media[idx].direction==="recvonly")){hasAudio=true}if(sdp.media[idx].type==="video"&&(sdp.media[idx].direction==="sendrecv"||sdp.media[idx].direction==="recvonly")){hasVideo=true}}if(mediaStream&&mediaConstraints.audio===false){length=mediaStream.getAudioTracks().length;for(idx=0;idx<length;idx++){mediaStream.removeTrack(mediaStream.getAudioTracks()[idx])}}if(mediaStream&&mediaConstraints.video===false){length=mediaStream.getVideoTracks().length;for(idx=0;idx<length;idx++){mediaStream.removeTrack(mediaStream.getVideoTracks()[idx])}}if(mediaConstraints.audio===undefined){mediaConstraints.audio=hasAudio}if(mediaConstraints.video===undefined){mediaConstraints.video=hasVideo}this.getUserMedia(mediaConstraints,sdpCreationSucceeded,sdpCreationFailed,{isAnswer:true,remoteSdp:request.body})};RTCSession.prototype.sendDTMF=function(tones,options){var duration,interToneGap;options=options||{};duration=options.duration||null;interToneGap=options.interToneGap||null;if(tones===undefined){throw new TypeError("Not enough arguments")}if(this.status!==C.STATUS_CONFIRMED&&this.status!==C.STATUS_WAITING_FOR_ACK){throw new Exceptions.InvalidStateError(this.status)}if(typeof tones==="number"){tones=tones.toString()}if(!tones||typeof tones!=="string"||!tones.match(/^[0-9A-D#*,]+$/i)){throw new TypeError("Invalid tones: "+tones)}if(duration&&!Utils.isDecimal(duration)){throw new TypeError("Invalid tone duration: "+duration)}else if(!duration){duration=RTCSession_DTMF.C.DEFAULT_DURATION}else if(duration<RTCSession_DTMF.C.MIN_DURATION){this.logger.warn('"duration" value is lower than the minimum allowed, setting it to '+RTCSession_DTMF.C.MIN_DURATION+" milliseconds");duration=RTCSession_DTMF.C.MIN_DURATION}else if(duration>RTCSession_DTMF.C.MAX_DURATION){this.logger.warn('"duration" value is greater than the maximum allowed, setting it to '+RTCSession_DTMF.C.MAX_DURATION+" milliseconds");duration=RTCSession_DTMF.C.MAX_DURATION}else{duration=Math.abs(duration)}options.duration=duration;if(interToneGap&&!Utils.isDecimal(interToneGap)){throw new TypeError("Invalid interToneGap: "+interToneGap)}else if(!interToneGap){interToneGap=RTCSession_DTMF.C.DEFAULT_INTER_TONE_GAP}else if(interToneGap<RTCSession_DTMF.C.MIN_INTER_TONE_GAP){this.logger.warn('"interToneGap" value is lower than the minimum allowed, setting it to '+RTCSession_DTMF.C.MIN_INTER_TONE_GAP+" milliseconds");interToneGap=RTCSession_DTMF.C.MIN_INTER_TONE_GAP}else{interToneGap=Math.abs(interToneGap)}this.dtmf.send(tones,options)};RTCSession.prototype.rejectReInvite=function(options){options=options||{};this.logger.log("rejecting re-INVITE");this.request.reply(488)};RTCSession.prototype.acceptReInvite=function(options){options=options||{};var self=this,extraHeaders=options.extraHeaders||[];this.logger.log("accepting re-INVITE");var replySucceeded=function(){var timeout=Timers.T1;self.setStatus(C.STATUS_WAITING_FOR_ACK);self.timers.invite2xxTimer=setTimeout(function invite2xxRetransmission(){if(self.status!==C.STATUS_WAITING_FOR_ACK){return}self.request.reply(200,null,extraHeaders,self.rtcMediaHandler.peerConnection.localDescription.sdp);if(timeout<Timers.T2){timeout=timeout*2;if(timeout>Timers.T2){timeout=Timers.T2}}self.timers.invite2xxTimer=setTimeout(invite2xxRetransmission,timeout)},timeout);self.timers.ackTimer=setTimeout(function(){if(self.status===C.STATUS_WAITING_FOR_ACK){self.logger.log("no ACK received")}},Timers.TIMER_H);self.started("local",undefined,true)};var replyFailed=function(){self.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)};var connectSuccess=function(){self.logger.debug("onMessage success");self.request.reply(200,null,extraHeaders,self.rtcMediaHandler.peerConnection.localDescription.getSdp({additionalSdp:self.rtcMediaHandler.peerConnection.remoteUnsupportedMedia}),replySucceeded,replyFailed)};var connectFailed=function(e){self.logger.warn("invalid SDP");self.logger.warn(e);self.request.reply(488)};this.initialRemoteSdp=this.initialRemoteSdp||self.rtcMediaHandler.peerConnection.remoteDescription.sdp;var sdp=this.request.body;if(sdp.length===0){this.logger.debug("empty sdp")}this.reconnectRtcMediaHandler(connectSuccess,connectFailed,{isAnswer:true,remoteSdp:sdp,isReconnect:true})};RTCSession.prototype.reconnectRtcMediaHandler=function(connectSuccess,connectFailed,options){var self=this;options=options||{};var localMedia=options.localMedia||this.rtcMediaHandler.localMedia;options.createOfferConstraints=options.createOfferConstraints||this.rtcMediaHandler.createOfferConstraints;this.rtcMediaHandler.close(!!options.localMedia);this.initRtcMediaHandler(options);this.rtcMediaHandler.localMedia=localMedia;this.rtcMediaHandler.createOfferConstraints=options.createOfferConstraints;this.connectRtcMediaHandler(localMedia,function(){self.started("local",undefined,true);connectSuccess()},connectFailed,options)};RTCSession.prototype.isReadyToReinvite=function(){if(!this.rtcMediaHandler.isReady()){return}if(this.dialog.uac_pending_reply===true||this.dialog.uas_pending_reply===true){return false}else{return true}};RTCSession.prototype.mute=function(options){options=options||{audio:true,video:false};var audioMuted=false,videoMuted=false;if(this.audioMuted===false&&options.audio){audioMuted=true;this.audioMuted=true;this.toogleMuteAudio(true)}if(this.videoMuted===false&&options.video){videoMuted=true;this.videoMuted=true;this.toogleMuteVideo(true)}if(audioMuted===true||videoMuted===true){this.onmute({audio:audioMuted,video:videoMuted})}};RTCSession.prototype.unmute=function(options){options=options||{audio:true,video:true};var audioUnMuted=false,videoUnMuted=false;if(this.audioMuted===true&&options.audio){audioUnMuted=true;this.audioMuted=false;if(this.local_hold===false){this.toogleMuteAudio(false)}}if(this.videoMuted===true&&options.video){videoUnMuted=true;this.videoMuted=false;if(this.local_hold===false){this.toogleMuteVideo(false)}}if(audioUnMuted===true||videoUnMuted===true){this.onunmute({audio:audioUnMuted,video:videoUnMuted})}};RTCSession.prototype.isMuted=function(){return{audio:this.audioMuted,video:this.videoMuted}};RTCSession.prototype.setInvite2xxTimer=function(request,body){var self=this,timeout=Timers.T1;this.timers.invite2xxTimer=setTimeout(function invite2xxRetransmission(){if(self.status!==C.STATUS_WAITING_FOR_ACK){return}request.reply(200,null,["Contact: "+self.contact],body);if(timeout<Timers.T2){timeout=timeout*2;if(timeout>Timers.T2){timeout=Timers.T2}}self.timers.invite2xxTimer=setTimeout(invite2xxRetransmission,timeout)},timeout)};RTCSession.prototype.setACKTimer=function(){var self=this;this.timers.ackTimer=setTimeout(function(){if(self.status===C.STATUS_WAITING_FOR_ACK){self.logger.debug("no ACK received, terminating the call");clearTimeout(self.timers.invite2xxTimer);self.sendBye();self.ended("remote",null,ExSIP_C.causes.NO_ACK)}},Timers.TIMER_H)};RTCSession.prototype.getLocalStreams=function(){try{if(this.rtcMediaHandler.peerConnection.localStreams){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.localStreams||[]}else{return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getLocalStreams()||[]}}catch(ex){return[]}};RTCSession.prototype.getRemoteStreams=function(){try{if(this.rtcMediaHandler.peerConnection.remoteStreams){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.remoteStreams||[]}else{return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getRemoteStreams()||[]}}catch(ex){return[]}};RTCSession.prototype.initRtcMediaHandler=function(options){options=options||{};var constraints=options.RTCConstraints||this.ua.rtcConstraints()||{optional:[{DtlsSrtpKeyAgreement:"true"}]};this.rtcMediaHandler=new RTCSession_RTCMediaHandler(this,{constraints:constraints,stun_servers:options.stun_servers,turn_servers:options.turn_servers})};RTCSession.prototype.init_incoming=function(request){var expires,self=this,contentType=request.getHeader("Content-Type"),waitForAnswer=function(){self.setStatus(C.STATUS_WAITING_FOR_ANSWER);self.timers.userNoAnswerTimer=setTimeout(function(){request.reply(408);self.failed("local",null,ExSIP_C.causes.NO_ANSWER)},self.ua.configuration.no_answer_timeout);if(expires){self.timers.expiresTimer=setTimeout(function(){if(self.status===C.STATUS_WAITING_FOR_ANSWER){request.reply(487);self.failed("system",null,ExSIP_C.causes.EXPIRES)}},expires)}self.newRTCSession("remote",request);request.reply(180,null,["Contact: "+self.contact]);self.progress("local",null)};if(request.body&&contentType!=="application/sdp"){request.reply(415);return}this.setStatus(C.STATUS_INVITE_RECEIVED);this.from_tag=request.from_tag;this.id=request.call_id+this.from_tag;this.request=request;this.contact=this.ua.contact.toString();this.logger=this.ua.getLogger("rtcsession",this.id);this.ua.sessions[this.id]=this;if(request.hasHeader("expires")){expires=request.getHeader("expires")*1e3}request.to_tag=Utils.newTag();if(!this.createDialog(request,"UAS",true)){request.reply(500,"Missing Contact header field");return}this.initRtcMediaHandler();if(request.body){this.rtcMediaHandler.onMessage("offer",request.body,waitForAnswer,function(e){self.logger.warn("invalid SDP");self.logger.warn(e);request.reply(488)})}else{this.late_sdp=true;waitForAnswer()}};RTCSession.prototype.connect=function(target,options){var self=this;options=options||{};this.data=options.data||{};this.initRtcMediaHandler(options);this.connectLocalMedia(target,options,function(){self.sendInviteRequest(target,options)},function(){})};RTCSession.prototype.close=function(){var idx;if(this.status===C.STATUS_TERMINATED){return}this.logger.debug("closing INVITE session "+this.id);if(this.rtcMediaHandler){this.rtcMediaHandler.close()}for(idx in this.timers){clearTimeout(this.timers[idx])}if(this.dialog){this.dialog.terminate();delete this.dialog}for(idx in this.earlyDialogs){this.earlyDialogs[idx].terminate();delete this.earlyDialogs[idx]}this.setStatus(C.STATUS_TERMINATED);delete this.ua.sessions[this.id]};RTCSession.prototype.createDialog=function(message,type,early){var dialog,early_dialog,local_tag=type==="UAS"?message.to_tag:message.from_tag,remote_tag=type==="UAS"?message.from_tag:message.to_tag,id=message.call_id+local_tag+remote_tag;early_dialog=this.earlyDialogs[id];if(early){if(early_dialog){return true}else{early_dialog=new Dialog(this,message,type,Dialog.C.STATUS_EARLY);if(early_dialog.id){this.earlyDialogs[id]=early_dialog;return true}else{this.failed("remote",message,ExSIP_C.causes.INTERNAL_ERROR);return false}}}else{if(early_dialog){early_dialog.update(message,type);this.dialog=early_dialog;delete this.earlyDialogs[id];return true}dialog=new Dialog(this,message,type);if(dialog.id){this.to_tag=message.to_tag;this.dialog=dialog;return true}else{this.failed("remote",message,ExSIP_C.causes.INTERNAL_ERROR);return false}}};RTCSession.prototype.connectRtcMediaHandler=function(stream,creationSucceeded,creationFailed,options){this.rtcMediaHandler.connect(stream,creationSucceeded,creationFailed,options);this.dtmf.enableDtmfSender(stream,this.rtcMediaHandler.peerConnection)};RTCSession.prototype.sendData=function(data){this.rtcMediaHandler.sendData(data)};RTCSession.prototype.getUserMedia=function(constraints,creationSucceeded,creationFailed,options){var self=this;var userMediaSucceeded=function(stream){self.ua.localMedia=stream;self.connectRtcMediaHandler(stream,creationSucceeded,creationFailed,options)};var userMediaFailed=function(){if(self.status===C.STATUS_TERMINATED){return}self.failed("local",null,ExSIP_C.causes.USER_DENIED_MEDIA_ACCESS)};if(this.ua.reuseLocalMedia()&&this.ua.localMedia){this.rtcMediaHandler.localMedia=this.ua.localMedia;userMediaSucceeded(this.ua.localMedia)}else{this.rtcMediaHandler.getUserMedia(userMediaSucceeded,userMediaFailed,constraints)}};RTCSession.prototype.sendInviteRequest=function(target,options,inviteSuccessCallback,inviteFailureCallback){options=options||{};options.status=C.STATUS_INVITE_SENT;options.sdp=this.rtcMediaHandler.peerConnection.localDescription.sdp;options.target=target;this.sendRequest(ExSIP_C.INVITE,options,{success:inviteSuccessCallback,failure:inviteFailureCallback})};RTCSession.prototype.createOutgoingRequestSender=function(target,method,options){options=options||{};var event,requestParams,iceServers,originalTarget=target,eventHandlers=options.eventHandlers||{},extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],stun_servers=options.stun_servers||null,turn_servers=options.turn_servers||null;if(stun_servers){iceServers=UA.configuration_check.optional.stun_servers(stun_servers);if(!iceServers){throw new TypeError("Invalid stun_servers: "+stun_servers)}else{stun_servers=iceServers}}if(turn_servers){iceServers=UA.configuration_check.optional.turn_servers(turn_servers);if(!iceServers){throw new TypeError("Invalid turn_servers: "+turn_servers)}else{turn_servers=iceServers}}if(target===undefined){throw new TypeError("Not enough arguments")}if(!WebRTC.isSupported){throw new Exceptions.NotSupportedError("WebRTC not supported")}target=this.ua.normalizeTarget(target);if(!target){throw new TypeError("Invalid target: "+originalTarget)}if(this.status!==C.STATUS_NULL){throw new Exceptions.InvalidStateError(this.status)}for(event in eventHandlers){this.on(event,eventHandlers[event])}this.from_tag=Utils.newTag();this.anonymous=options.anonymous||false;this.isCanceled=false;requestParams={from_tag:this.from_tag};this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:true});if(this.anonymous){requestParams.from_display_name="Anonymous";requestParams.from_uri="sip:anonymous@anonymous.invalid";extraHeaders.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString());extraHeaders.push("Privacy: id")}extraHeaders.push("Contact: "+this.contact);extraHeaders.push("Allow: "+Utils.getAllowedMethods(this.ua));this.request=new SIPMessage.OutgoingRequest(method,target,this.ua,requestParams,extraHeaders);this.id=this.request.call_id+this.from_tag;this.logger=this.ua.getLogger("rtcsession",this.id);this.ua.sessions[this.id]=this;this.newRTCSession("local",this.request);return new RequestSender(this,this.ua)};RTCSession.prototype.sendReferRequest=function(sessionToTransfer,options){this.sessionToTransfer=sessionToTransfer;options=options||{};options.status=C.STATUS_REFER_SENT;options.target=sessionToTransfer.dialog.remote_target;this.sendRequest(ExSIP_C.REFER,options)};RTCSession.prototype.sendNotifyRequest=function(options,successCallback,failureCallback){options=options||{};var extraHeaders=["Content-Type: message/sipfrag","Subscription-State: "+(options.subscriptionState||"active;expires=60"),"Event: refer"];options=Utils.merge_options({extraHeaders:extraHeaders},options);this.sendRequest(ExSIP_C.NOTIFY,options,{success:successCallback,failure:failureCallback})};RTCSession.prototype.isStarted=function(){return this.start_time!==null};RTCSession.prototype.isHeld=function(){return this.isOnHold};RTCSession.prototype.held=function(){this.isOnHold=true;this.emit("held",this)};RTCSession.prototype.resumed=function(){this.isOnHold=false;this.emit("resumed",this)};RTCSession.prototype.hold=function(inviteSuccessCallback,inviteFailureCallback){var self=this;this.changeSession({audioMode:ExSIP_C.INACTIVE,audioPort:"0",videoMode:ExSIP_C.INACTIVE,videoPort:"0"},function(){self.held();if(inviteSuccessCallback){inviteSuccessCallback()}},inviteFailureCallback)};RTCSession.prototype.unhold=function(inviteSuccessCallback,inviteFailureCallback){var self=this;this.changeSession({audioMode:ExSIP_C.SENDRECV,videoMode:ExSIP_C.SENDRECV},function(){self.resumed();if(inviteSuccessCallback){inviteSuccessCallback()}},inviteFailureCallback)};RTCSession.prototype.changeSession=function(sdpOptions,inviteSuccessCallback,inviteFailureCallback){var self=this;this.logger.debug("changeSession : "+JSON.stringify(sdpOptions));this.reconnectRtcMediaHandler(function(){self.logger.debug("changeSession : reconnectRtcMediaHandler : success");self.receiveResponse=self.receiveReinviteResponse;self.reinviteSucceeded=inviteSuccessCallback;self.reinviteFailed=inviteFailureCallback;self.sendInviteRequest(undefined,undefined)},function(){self.logger.error("Could not change local mode")},sdpOptions)};RTCSession.prototype.receiveInviteResponse=function(response){var cause,dialog,session=this;if(this.dialog&&(response.status_code>=200&&response.status_code<=299)){if(this.dialog.id.call_id===response.call_id&&this.dialog.id.local_tag===response.from_tag&&this.dialog.id.remote_tag===response.to_tag){this.sendRequest(ExSIP_C.ACK);
return}else{dialog=new Dialog(this,response,"UAC");if(dialog.error!==undefined){this.logger.error(dialog.error);return}dialog.sendRequest({owner:{status:C.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},ExSIP_C.ACK);dialog.sendRequest({owner:{status:C.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},ExSIP_C.BYE);return}}if(this.isCanceled){this.isCanceled=false;if(response.status_code>=100&&response.status_code<200){this.request.cancel(this.cancelReason)}else if(response.status_code>=200&&response.status_code<299){this.acceptAndTerminate(response)}return}if(this.status!==C.STATUS_INVITE_SENT&&this.status!==C.STATUS_1XX_RECEIVED){return}switch(true){case/^100$/.test(response.status_code):this.received_100=true;break;case/^1[0-9]{2}$/.test(response.status_code):this.received_100=true;if(this.status!==C.STATUS_INVITE_SENT&&this.status!==C.STATUS_1XX_RECEIVED){break}if(!response.to_tag){this.logger.warn("1xx response received without to tag");break}if(response.hasHeader("contact")){if(!this.createDialog(response,"UAC",true)){break}}this.setStatus(C.STATUS_1XX_RECEIVED);this.progress("remote",response);if(!response.body){break}this.rtcMediaHandler.onMessage("pranswer",response.body,function(){},function(e){session.logger.warn(e);session.earlyDialogs[response.call_id+response.from_tag+response.to_tag].terminate()});break;case/^2[0-9]{2}$/.test(response.status_code):this.setStatus(C.STATUS_CONFIRMED);if(!response.body){this.acceptAndTerminate(response,400,ExSIP_C.causes.MISSING_SDP);this.failed("remote",response,ExSIP_C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(response,"UAC")){break}this.rtcMediaHandler.onMessage("answer",response.body,function(){session.accepted("remote",response);session.sendRequest(ExSIP_C.ACK);session.confirmed("local",null)},function(e){session.logger.warn(e);session.acceptAndTerminate(response,488,"Not Acceptable Here");session.failed("remote",response,ExSIP_C.causes.BAD_MEDIA_DESCRIPTION)});break;default:cause=Utils.sipErrorCause(response.status_code);this.failed("remote",response,cause)}};RTCSession.prototype.createDialog=function(message,type,early){var dialog,early_dialog,local_tag=type==="UAS"?message.to_tag:message.from_tag,remote_tag=type==="UAS"?message.from_tag:message.to_tag,id=message.call_id+local_tag+remote_tag;early_dialog=this.earlyDialogs[id];if(early){if(early_dialog){return true}else{early_dialog=new Dialog(this,message,type,Dialog.C.STATUS_EARLY);if(early_dialog.error){this.logger.error(dialog.error);this.failed("remote",message,ExSIP_C.causes.INTERNAL_ERROR);return false}else{this.earlyDialogs[id]=early_dialog;return true}}}else{if(early_dialog){early_dialog.update(message,type);this.dialog=early_dialog;delete this.earlyDialogs[id];return true}dialog=new Dialog(this,message,type);if(dialog.error){this.logger.error(dialog.error);this.failed("remote",message,ExSIP_C.causes.INTERNAL_ERROR);return false}else{this.to_tag=message.to_tag;this.dialog=dialog;return true}}};RTCSession.prototype.receiveReinvite=function(request){var sdp,idx,direction,self=this,contentType=request.getHeader("Content-Type"),hold=false,createSdp=function(onSuccess,onFailure){if(self.late_sdp){self.rtcMediaHandler.createOffer(onSuccess,onFailure)}else{self.rtcMediaHandler.createAnswer(onSuccess,onFailure)}},answer=function(){createSdp(function(body){request.reply(200,null,["Contact: "+self.contact],body,function(){self.setStatus(C.STATUS_WAITING_FOR_ACK);self.setInvite2xxTimer(request,body);self.setACKTimer();if(self.remote_hold===true&&hold===false){self.onunhold("remote")}else if(self.remote_hold===false&&hold===true){self.onhold("remote")}})},function(){request.reply(500)})};if(request.body){if(contentType!=="application/sdp"){this.logger.warn("invalid Content-Type");request.reply(415);return}sdp=Parser.parseSDP(request.body);for(idx=0;idx<sdp.media.length;idx++){direction=sdp.direction||sdp.media[idx].direction||"sendrecv";if(direction==="sendonly"||direction==="inactive"){hold=true}}this.rtcMediaHandler.onMessage("offer",request.body,answer,function(e){self.logger.error(e);request.reply(488)})}else{this.late_sdp=true;answer()}};RTCSession.prototype.receiveUpdate=function(request){var sdp,idx,direction,self=this,contentType=request.getHeader("Content-Type"),hold=true;if(!request.body){request.reply(200);return}if(contentType!=="application/sdp"){this.logger.warn("invalid Content-Type");request.reply(415);return}sdp=Parser.parseSDP(request.body);for(idx=0;idx<sdp.media.length;idx++){direction=sdp.direction||sdp.media[idx].direction||"sendrecv";if(direction!=="sendonly"&&direction!=="inactive"){hold=false}}this.rtcMediaHandler.onMessage("offer",request.body,function(){self.rtcMediaHandler.createAnswer(function(body){request.reply(200,null,["Contact: "+self.contact],body,function(){if(self.remote_hold===true&&hold===false){self.onunhold("remote")}else if(self.remote_hold===false&&hold===true){self.onhold("remote")}})},function(){request.reply(500)})},function(e){self.logger.error(e);request.reply(488)})};RTCSession.prototype.receiveRequest=function(request){var contentType,self=this;if(request.method===ExSIP_C.CANCEL){if(this.status===C.STATUS_WAITING_FOR_ANSWER||this.status===C.STATUS_ANSWERED){this.setStatus(C.STATUS_CANCELED);this.request.reply(487);this.failed("remote",request,ExSIP_C.causes.CANCELED)}}else{switch(request.method){case ExSIP_C.ACK:if(this.status===C.STATUS_WAITING_FOR_ACK){clearTimeout(this.timers.ackTimer);clearTimeout(this.timers.invite2xxTimer);this.setStatus(C.STATUS_CONFIRMED);if(request.body.length>0){this.logger.log("set remoteDescription for late offer ACK");this.rtcMediaHandler.onMessage(self.rtcMediaHandler.getSetRemoteLocationType(),request.body,function(){self.logger.log("late offer remoteDescription success");self.started("local",undefined,true)},function(){self.logger.log("late offer remoteDescription failure")})}}break;case ExSIP_C.BYE:if(this.status===C.STATUS_CONFIRMED){request.reply(200);this.ended("remote",request,ExSIP_C.causes.BYE)}else if(this.status===C.STATUS_INVITE_RECEIVED){request.reply(200);this.request.reply(487,"BYE Received");this.ended("remote",request,ExSIP_C.causes.BYE)}else{request.reply(403,"Wrong Status")}break;case ExSIP_C.INVITE:if(this.status===C.STATUS_CONFIRMED){this.logger.debug("re-INVITE received");this.request=request;if(!request.body||request.body.length===0){this.acceptReInvite();return}var description=new WebRTC.RTCSessionDescription({type:"offer",sdp:request.body});var oldDescription=this.rtcMediaHandler.peerConnection.remoteDescription;var audioAdd=description.hasActiveAudio()&&(!oldDescription||!oldDescription.hasActiveAudio());var videoAdd=description.hasActiveVideo()&&(!oldDescription||!oldDescription.hasActiveVideo());if(audioAdd||videoAdd){this.ua.emit("onReInvite",this.ua,{session:this,request:request,audioAdd:audioAdd,videoAdd:videoAdd})}else{this.acceptReInvite()}}else{request.reply(403,"Wrong Status")}break;case ExSIP_C.INFO:if(this.status===C.STATUS_CONFIRMED||this.status===C.STATUS_WAITING_FOR_ACK||this.status===C.STATUS_INVITE_RECEIVED||this.status===C.STATUS_ANSWERED){contentType=request.getHeader("content-type");if(contentType&&contentType.match(/^application\/dtmf-relay/i)){new RTCSession_DTMF(this).init_incoming(request)}else if(contentType&&contentType.match(/^application\/media_control\+xml/i)){request.reply(200);this.started("local",undefined,true)}else{request.reply(415)}}else{this.logger.debug("Wrong Status : "+this.status);request.reply(403,"Wrong Status")}break;case ExSIP_C.UPDATE:if(this.status===C.STATUS_CONFIRMED){this.logger.debug("UPDATE received");this.receiveUpdate(request)}else{request.reply(403,"Wrong Status")}break;case ExSIP_C.REFER:if(this.status===C.STATUS_CONFIRMED){this.ua.processRefer(this,request)}break;case ExSIP_C.NOTIFY:if(this.status===C.STATUS_REFER_SENT){request.reply(200);this.logger.log("received NOTIFY with body : "+request.body);var status=parseInt(request.body.match(/SIP\/2.0\s(.*)\s/)[1],10);this.logger.log("NOTIFY status : "+status);if(!this.sessionToTransfer){this.logger.warn("no transferred session for REFER session : "+this.id);return}if(status>=200&&status<=299){this.logger.log("terminate transferred session : "+this.sessionToTransfer.id);this.sessionToTransfer.terminate()}else if(status>=400&&status<=699){this.logger.warn("resuming session : "+this.sessionToTransfer.id);this.sessionToTransfer.unhold(function(){self.logger.log("resumed session : "+self.sessionToTransfer.id)})}}break;default:request.reply(501)}}};RTCSession.prototype.setStatus=function(status){if(this.logger){this.logger.debug("setStatus : "+Object.keys(C)[status])}else{console.log("setStatus : "+Object.keys(C)[status])}this.status=status};RTCSession.prototype.supports=function(name){var supported=this.request.getHeader("Supported");return supported!==undefined&&supported.indexOf(name)!==-1};RTCSession.prototype.sendACK=function(){this.sendRequest(ExSIP_C.ACK)};RTCSession.prototype.sendBye=function(options){var self=this;options=options||{};options.extraHeaders=options.extraHeaders||[];var reason,status_code=options.status_code,reason_phrase=options.reason_phrase||ExSIP_C.REASON_PHRASE[status_code]||"",body=options.body;if(status_code&&(status_code<200||status_code>=700)){throw new TypeError("Invalid status_code: "+status_code)}else if(status_code){reason="SIP ;cause="+status_code+'; text="'+reason_phrase+'"';options.extraHeaders.push("Reason: "+reason)}options.sdp=body;options.status=C.STATUS_BYE_SENT;var callbacks={success:function(){self.sendACK();self.ended("local",null,ExSIP_C.causes.BYE)}};this.logger.log("sendBye : "+callbacks);this.sendRequest(ExSIP_C.BYE,options,callbacks)};RTCSession.prototype.sendRequest=function(method,options,requestCallbacks){var request_sender;options=options||{};if(this.dialog){this.logger.debug("sendRequest : dialog : "+method);request_sender=this.dialog.createRequestSender(this,method,options)}else{this.logger.debug("sendRequest : createOutgoingRequestSender : "+method+", "+JSON.stringify(options));request_sender=this.createOutgoingRequestSender(options.target,method,options)}if(!request_sender){return}if(options.status){this.setStatus(options.status)}request_sender.request.body=options.sdp;var hasSdp=request_sender.request.body&&request_sender.request.body.length>0;if(!Utils.containsHeader(request_sender.request.extraHeaders,"Content-Type")&&hasSdp){request_sender.request.extraHeaders.push("Content-Type: application/sdp")}this.logger.debug("request_sender.request.extraHeaders : "+Utils.toString(request_sender.request.extraHeaders));request_sender.send(requestCallbacks)};RTCSession.prototype.onTransportError=function(){if(this.status!==C.STATUS_TERMINATED){if(this.status===C.STATUS_CONFIRMED){this.ended("system",null,ExSIP_C.causes.CONNECTION_ERROR)}else{this.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)}}};RTCSession.prototype.connectLocalMedia=function(target,options,success,failure){var self=this;this.receiveResponse=this.receiveInviteResponse;var mediaConstraints=options.mediaConstraints||{audio:true,video:true};this.getUserMedia(mediaConstraints,function(){self.logger.log("getUserMedia succeeded");success()},function(){self.logger.log("getUserMedia failed");self.failed("local",null,ExSIP_C.causes.WEBRTC_ERROR);failure()},options)};RTCSession.prototype.sendReinvite=function(options){options=options||{};var self=this,extraHeaders=options.extraHeaders||[],eventHandlers=options.eventHandlers||{},mangle=options.mangle||null;if(eventHandlers.succeeded){this.reinviteSucceeded=eventHandlers.succeeded}else{this.reinviteSucceeded=function(){}}if(eventHandlers.failed){this.reinviteFailed=eventHandlers.failed}else{this.reinviteFailed=function(){}}extraHeaders.push("Contact: "+this.contact);extraHeaders.push("Content-Type: application/sdp");this.receiveResponse=this.receiveReinviteResponse;this.rtcMediaHandler.createOffer(function(body){if(mangle){body=mangle(body)}self.dialog.sendRequest(self,ExSIP_C.INVITE,{extraHeaders:extraHeaders,body:body})},function(){if(self.isReadyToReinvite()){self.onReadyToReinvite()}self.reinviteFailed()})};RTCSession.prototype.receiveReinviteResponse=function(response){var self=this,contentType=response.getHeader("Content-Type");if(this.status===C.STATUS_TERMINATED){return}switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):this.setStatus(C.STATUS_CONFIRMED);this.sendRequest(ExSIP_C.ACK);if(!response.body){this.reinviteFailed();break}else if(contentType!=="application/sdp"){this.reinviteFailed();break}this.rtcMediaHandler.onMessage("answer",response.body,function(){if(self.reinviteSucceeded){self.reinviteSucceeded()}},function(){if(self.reinviteFailed){self.reinviteFailed()}});break;default:if(this.reinviteFailed){this.reinviteFailed()}}};RTCSession.prototype.acceptAndTerminate=function(response,status_code,reason_phrase){var extraHeaders=[];if(status_code){reason_phrase=reason_phrase||ExSIP_C.REASON_PHRASE[status_code]||"";extraHeaders.push("Reason: SIP ;cause="+status_code+'; text="'+reason_phrase+'"')}if(this.dialog||this.createDialog(response,"UAC")){this.sendRequest(ExSIP_C.ACK);this.sendBye()}this.setStatus(C.STATUS_TERMINATED)};RTCSession.prototype.toogleMuteAudio=function(mute){var streamIdx,trackIdx,tracks,localStreams=this.getLocalStreams();for(streamIdx in localStreams){tracks=localStreams[streamIdx].getAudioTracks();for(trackIdx in tracks){tracks[trackIdx].enabled=!mute}}};RTCSession.prototype.toogleMuteVideo=function(mute){var streamIdx,trackIdx,tracks,localStreams=this.getLocalStreams();for(streamIdx in localStreams){tracks=localStreams[streamIdx].getVideoTracks();for(trackIdx in tracks){tracks[trackIdx].enabled=!mute}}};RTCSession.prototype.onTransportError=function(){if(this.status!==C.STATUS_TERMINATED){if(this.status===C.STATUS_CONFIRMED){this.ended("system",null,ExSIP_C.causes.CONNECTION_ERROR)}else{this.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)}}};RTCSession.prototype.onRequestTimeout=function(){if(this.status!==C.STATUS_TERMINATED){if(this.status===C.STATUS_CONFIRMED){this.ended("system",null,ExSIP_C.causes.REQUEST_TIMEOUT)}else{this.ua.reconnect();this.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)}}};RTCSession.prototype.onDialogError=function(response){if(this.status!==C.STATUS_TERMINATED){if(this.status===C.STATUS_CONFIRMED){this.ended("remote",response,ExSIP_C.causes.DIALOG_ERROR)}else{this.failed("remote",response,ExSIP_C.causes.DIALOG_ERROR)}}};RTCSession.prototype.newRTCSession=function(originator,request){var session=this,event_name="newRTCSession";if(originator==="remote"){session.direction="incoming";session.local_identity=request.to;session.remote_identity=request.from}else if(originator==="local"){session.direction="outgoing";session.local_identity=request.from;session.remote_identity=request.to}session.ua.emit(event_name,session.ua,{originator:originator,session:session,request:request})};RTCSession.prototype.connecting=function(request){var session=this,event_name="connecting";session.emit(event_name,session,{request:request})};RTCSession.prototype.progress=function(originator,response){var session=this,event_name="progress";session.emit(event_name,session,{originator:originator,response:response||null})};RTCSession.prototype.accepted=function(originator,message){var session=this,event_name="accepted";session.start_time=new Date;session.emit(event_name,session,{originator:originator,response:message||null})};RTCSession.prototype.started=function(originator,message){var session=this,event_name="started";session.start_time=new Date;session.emit(event_name,session,{originator:originator,response:message||null})};RTCSession.prototype.confirmed=function(originator,ack){var session=this,event_name="confirmed";this.is_confirmed=true;session.emit(event_name,session,{originator:originator,ack:ack||null})};RTCSession.prototype.ended=function(originator,message,cause){var session=this,event_name="ended";session.end_time=new Date;session.close();session.emit(event_name,session,{originator:originator,message:message||null,cause:cause})};RTCSession.prototype.failed=function(originator,message,cause){var session=this,event_name="failed";session.close();session.emit(event_name,session,{originator:originator,message:message||null,cause:cause})};RTCSession.prototype.onhold=function(originator){if(originator==="local"){this.local_hold=true}else{this.remote_hold=true}this.emit("hold",this,{originator:originator})};RTCSession.prototype.onunhold=function(originator){if(originator==="local"){this.local_hold=false}else{this.remote_hold=false}this.emit("unhold",this,{originator:originator})};RTCSession.prototype.onmute=function(options){this.emit("muted",this,{audio:options.audio,video:options.video})};RTCSession.prototype.onunmute=function(options){this.emit("unmuted",this,{audio:options.audio,video:options.video})};RTCSession.prototype.onReadyToReinvite=function(){var action=this.pending_actions.length()>0?this.pending_actions.shift():null;if(!action){return}if(action.name==="hold"){this.hold()}else if(action.name==="unhold"){this.unhold()}}},{"./Constants":197,"./Dialog":198,"./EventEmitter":201,"./Exceptions":203,"./Parser":209,"./RTCSession/DTMF":211,"./RTCSession/RTCMediaHandler":213,"./RequestSender":215,"./SIPMessage":216,"./Timers":217,"./UA":220,"./Utils":222,"./WebRTC":223}],211:[function(require,module,exports){module.exports=DTMF;var C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};DTMF.C=C;var EventEmitter=require("../EventEmitter");var Exceptions=require("../Exceptions");var RTCSession=require("../RTCSession");var Utils=require("../Utils");function DTMF(session){var events=["succeeded","failed"];this.sendTimeoutId=null;this.queuedDTMFs=[];this.session=session;this.direction=null;this.tone=null;this.duration=null;this.interToneGap=null;this.dtmfSender=null;this.logger=this.session.ua.getLogger("rtcsession.dtmf",session.id);this.initEvents(events)}DTMF.prototype=new EventEmitter;DTMF.prototype.send=function(tone,options){var event,eventHandlers,extraHeaders;if(tone===undefined){throw new TypeError("Not enough arguments")}this.direction="outgoing";if(this.session.status!==RTCSession.C.STATUS_CONFIRMED&&this.session.status!==RTCSession.C.STATUS_WAITING_FOR_ACK){throw new Exceptions.InvalidStateError(this.session.status)}options=options||{};extraHeaders=options.extraHeaders?options.extraHeaders.slice():[];eventHandlers=options.eventHandlers||{};if(typeof tone==="string"){tone=tone.toUpperCase()}else if(typeof tone==="number"){tone=tone.toString()}else{throw new TypeError("Invalid tone: "+tone)}if(!tone.match(/^[0-9A-D#*,]+$/i)){throw new TypeError("Invalid tone: "+tone)}else{this.tone=tone}for(event in eventHandlers){this.on(event,eventHandlers[event])}this.queueTone(this.tone,options.duration,options.interToneGap)};DTMF.prototype.processQueuedDTMFs=function(){var self=this;if(this.queuedDTMFs.length===0){return}if(!this.dtmfSender.canInsertDTMF){this.logger.log("DTMF Sender cannot insert DTMF - trying again after timeout",this.session.ua);this.sendTimeoutId=setTimeout(function(){self.processQueuedDTMFs()},1e3);return}var tones="";var durationSum=0;var interToneGapSum=0;for(var i=0;i<this.queuedDTMFs.length;i++){var dtmf=this.queuedDTMFs[i];tones+=dtmf.tone;durationSum+=dtmf.duration;interToneGapSum+=dtmf.interToneGap}var duration=durationSum/this.queuedDTMFs.length;var interToneGap=interToneGapSum/this.queuedDTMFs.length;this.logger.log("sending DTMF with tones "+tones+", duration "+duration+", gap "+interToneGap);this.dtmfSender.insertDTMF(tones,duration,interToneGap)};DTMF.prototype.queueTone=function(tone,duration,interToneGap){this.logger.log("Queue tone : "+tone);clearTimeout(this.sendTimeoutId);this.queuedDTMFs.push({tone:tone,duration:duration,interToneGap:interToneGap});var self=this;this.sendTimeoutId=setTimeout(function(){self.processQueuedDTMFs()},2*duration)};DTMF.prototype.onDTMFSent=function(tone){if(!tone){return}this.logger.log("Sent Dtmf tone: "+tone.tone);for(var i=0;i<this.queuedDTMFs.length;i++){var dtmf=this.queuedDTMFs[i];if(tone.tone===dtmf.tone){this.queuedDTMFs.splice(i,1);this.logger.log("removing from queued tones - remaining queue: 	"+Utils.toString(this.queuedDTMFs));break}else if(dtmf.tone.indexOf(tone.tone)!==-1){dtmf.tone=dtmf.tone.replace(tone.tone,"");this.queuedDTMFs[i]=dtmf;this.logger.log("removing from queued tones as contained - remaining queue: 	"+Utils.toString(this.queuedDTMFs));break}}this.session.emit("newDTMF",this.session,{originator:"local",dtmf:this,tone:tone.tone})};DTMF.prototype.enableDtmfSender=function(localstream,peerConnection){var self=this;this.logger.debug("enableDtmfSender : "+localstream);if(localstream!==null){var local_audio_track=localstream.getAudioTracks()[0];this.dtmfSender=peerConnection.createDTMFSender(local_audio_track);this.logger.log("Created DTMF Sender with canInsertDTMF : "+this.dtmfSender.canInsertDTMF);this.dtmfSender.ontonechange=function(tone){self.onDTMFSent(tone)};this.processQueuedDTMFs()}else{this.logger.error("No Local Stream to create DTMF Sender")}};DTMF.prototype.receiveResponse=function(response){var cause;switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):this.emit("succeeded",this,{originator:"remote",response:response});break;default:cause=Utils.sipErrorCause(response.status_code);this.emit("failed",this,{originator:"remote",response:response,cause:cause});break}};DTMF.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:C.causes.REQUEST_TIMEOUT})};DTMF.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:C.causes.CONNECTION_ERROR})};DTMF.prototype.init_incoming=function(request){var body,reg_tone=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,reg_duration=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming";this.request=request;request.reply(200);if(request.body){body=request.body.split("\r\n");if(body.length===2){if(reg_tone.test(body[0])){this.tone=body[0].replace(reg_tone,"$2")}if(reg_duration.test(body[1])){this.duration=parseInt(body[1].replace(reg_duration,"$2"),10)}}}if(!this.tone||!this.duration){this.logger.warn("invalid INFO DTMF received, discarded")}else{this.session.emit("newDTMF",this.session,{originator:"remote",dtmf:this,request:request})}}},{"../EventEmitter":201,"../Exceptions":203,"../RTCSession":210,"../Utils":222}],212:[function(require,module,exports){module.exports=DataChannel;var EventEmitter=require("../EventEmitter");function DataChannel(session,peerConnection){this.session=session;this.peerConnection=peerConnection;this.sendChannel=null;this.receiveChannel=null;this.chunkLength=6e4;this.dataReceived=[];this.logger=session.ua.getLogger("ExSIP.rtcsession.datachannel",session.id);this.initSendChannel()}DataChannel.prototype=new EventEmitter;DataChannel.prototype.isDebug=function(){return this.session.ua.isDebug()};DataChannel.prototype.close=function(){if(this.sendChannel){this.sendChannel.close()}if(this.receiveChannel){this.receiveChannel.close()}};DataChannel.prototype.send=function(data){this.sendInChunks(data);this.logger.log("Sent Data: "+data,this.session.ua);this.session.emit("dataSent",this,{data:data})};DataChannel.prototype.sendInChunks=function(data){var text=null,last=false,self=this;if(data.length>this.chunkLength){text=data.slice(0,this.chunkLength)}else{text=data;last=true}this.sendChannel.send(text+(last?"\n":""));if(!last){var remainingDataURL=data.slice(text.length);window.setTimeout(function(){self.sendInChunks(remainingDataURL)},50)}};DataChannel.prototype.initSendChannel=function(){var self=this;try{this.sendChannel=this.peerConnection.createDataChannel("sendDataChannel",null);this.logger.log("Created send data channel",this.session.ua);var onSendChannelStateChange=function(){var readyState=self.sendChannel.readyState;this.logger.log("Send channel state is: "+readyState,self.session.ua)};this.sendChannel.onopen=onSendChannelStateChange;this.sendChannel.onclose=onSendChannelStateChange;var receiveChannelCallback=function(event){this.logger.log("Receive Channel Callback",self.session.ua);self.receiveChannel=event.channel;var onReceiveChannelStateChange=function(){var readyState=self.receiveChannel.readyState;this.logger.log("Receive channel state is: "+readyState,self.session.ua)};var onReceiveMessageCallback=function(event){this.logger.log("Received Message : "+event.data,self.session.ua);if(event.data.indexOf("\n")!==-1){self.dataReceived.push(event.data.replace("\n",""));var data=self.dataReceived.join("");self.dataReceived=[];self.session.emit("dataReceived",self,{data:data})}else{self.dataReceived.push(event.data)}};self.receiveChannel.onmessage=onReceiveMessageCallback;self.receiveChannel.onopen=onReceiveChannelStateChange;self.receiveChannel.onclose=onReceiveChannelStateChange};this.peerConnection.ondatachannel=receiveChannelCallback}catch(e){this.emit("failed",this,{cause:"Failed to create data channel"});self.logger.error("Create Data channel failed with exception: "+e.message)}}},{"../EventEmitter":201}],213:[function(require,module,exports){module.exports=RTCMediaHandler;var ExSIP_C=require("../Constants");var WebRTC=require("../WebRTC");var Utils=require("../Utils");var DataChannel=require("./DataChannel");function RTCMediaHandler(session,constraints){constraints=constraints||{};this.logger=session.ua.getLogger("ExSIP.rtcsession.rtcmediahandler",session.id);this.logger.log("constraints : "+Utils.toString(constraints),session.ua);this.session=session;this.localMedia=null;this.peerConnection=null;this.createOfferConstraints=null;this.dataChannel=null;this.ready=true;this.init(constraints)}RTCMediaHandler.prototype={isReady:function(){return this.ready},copy:function(rtcMediaHandler){var self=this;var streamAdditionSucceeded=function(){};var streamAdditionFailed=function(){if(self.session.status===ExSIP_C.STATUS_TERMINATED){return}self.session.failed("local",null,ExSIP_C.causes.WEBRTC_ERROR)};var description=new WebRTC.RTCSessionDescription({type:this.getSetLocalDescriptionType(),sdp:rtcMediaHandler.peerConnection.localDescription.sdp});this.setLocalDescription(description);this.addStream(rtcMediaHandler.localMedia,streamAdditionSucceeded,streamAdditionFailed)},connect:function(stream,connectSucceeded,connectFailed,options){var self=this;options=options||{};this.logger.log("connect with isAnswer : "+options.isAnswer+" and remoteSdp : "+options.remoteSdp,self.session.ua);var setLocalDescription=function(callback){self.setLocalDescription(options.localDescription,callback||connectSucceeded,connectFailed)};var setRemoteDescription=function(successCallback){self.onMessage(self.getSetRemoteLocationType(),options.remoteSdp,successCallback||connectSucceeded,function(e){self.logger.error("setRemoteDescription failed");self.logger.error(Utils.toString(e));connectFailed()})};var createAnswer=function(){self.createAnswer(connectSucceeded,connectFailed,options.mediaConstraints)};var createOffer=function(){self.createOffer(function(sdp){if(options.remoteSdp&&options.remoteSdp!==""){setRemoteDescription(connectSucceeded)}else{connectSucceeded(sdp)}},connectFailed,options.createOfferConstraints,options)};var streamAdditionSucceeded=function(){var hasRemoteSdp=options.remoteSdp&&options.remoteSdp.length>0;var isRemote=options.isAnswer&&hasRemoteSdp;self.logger.log("isRemote : "+isRemote+", isAnswer : "+options.isAnswer+", hasRemoteSdp :"+hasRemoteSdp,self.session.ua);if(isRemote){if(options.localDescription){setRemoteDescription(setLocalDescription)}else{setRemoteDescription(createAnswer)}}else{if(options.remoteSdp){setLocalDescription(setRemoteDescription)}else{createOffer()}}};var streamAdditionFailed=function(){if(self.session.status===ExSIP_C.STATUS_TERMINATED){return}self.session.failed("local",null,ExSIP_C.causes.WEBRTC_ERROR);connectFailed()};this.addStream(stream,streamAdditionSucceeded,streamAdditionFailed)},createOffer:function(onSuccess,onFailure,constraints,options){var self=this;options=options||{};function onSetLocalDescriptionSuccess(){if(self.peerConnection.iceGatheringState==="complete"&&(self.peerConnection.iceConnectionState==="connected"||self.peerConnection.iceConnectionState==="completed")){self.ready=true;onSuccess(self.peerConnection.localDescription.sdp)}else{self.onIceCompleted=function(){self.onIceCompleted=undefined;self.ready=true;onSuccess(self.peerConnection.localDescription.sdp)}}}this.ready=false;this.createOfferConstraints=constraints;this.logger.log("createOffer with createOfferConstraints : "+Utils.toString(this.createOfferConstraints),this.session.ua);this.peerConnection.createOffer(function(sessionDescription){if(options.videoMode){sessionDescription.setVideoMode(options.videoMode)}if(options.videoPort){sessionDescription.setVideoPort(options.videoPort)}if(options.audioMode){sessionDescription.setAudioMode(options.audioMode)}if(options.audioPort){sessionDescription.setAudioPort(options.audioPort)}self.setLocalDescription(sessionDescription,onSetLocalDescriptionSuccess,function(e){self.ready=true;onFailure(e)})},function(e){self.ready=true;self.logger.error("unable to create offer");self.logger.error(e);onFailure(e)},constraints)},getRemoteDescriptionSdp:function(){return this.peerConnection.remoteDescription?this.peerConnection.remoteDescription.sdp:undefined},createAnswer:function(onSuccess,onFailure,constraints){var self=this;function onSetLocalDescriptionSuccess(){if(self.peerConnection.iceGatheringState==="complete"&&(self.peerConnection.iceConnectionState==="connected"||self.peerConnection.iceConnectionState==="completed")){self.ready=true;onSuccess(self.peerConnection.localDescription.sdp)}else{self.onIceCompleted=function(){self.onIceCompleted=undefined;self.ready=true;onSuccess(self.peerConnection.localDescription.sdp)}}}this.ready=false;constraints=constraints||this.createOfferConstraints;this.logger.log("createAnswer with constraints : "+constraints,this.session.ua);this.peerConnection.createAnswer(function(sessionDescription){self.setLocalDescription(sessionDescription,onSetLocalDescriptionSuccess,function(e){self.ready=true;onFailure(e)})},function(e){self.ready=true;self.logger.error("unable to create answer");self.logger.error(e);onFailure(e)},constraints)},setLocalDescription:function(sessionDescription,onSuccess,onFailure){var self=this;this.peerConnection.setLocalDescription(sessionDescription,onSuccess,function(e){self.logger.error("unable to set local description");self.logger.error(e);onFailure(e)})},addStream:function(stream,onSuccess,onFailure,constraints){try{this.logger.log("add stream : "+Utils.toString(stream),this.session.ua);this.peerConnection.addStream(stream,constraints)}catch(e){this.logger.error("error adding stream");this.logger.error(e);onFailure();return}onSuccess()},clearStreams:function(){if(!this.localMedia){return}if(this.removeStream(this.localMedia)){this.localMedia=null}return},removeStream:function(stream){try{this.logger.log("remove stream : "+Utils.toString(stream),this.session.ua);this.peerConnection.removeStream(stream)}catch(e){this.logger.error("error removing stream");this.logger.error(e);return false}return true},getSetLocalDescriptionType:function(){var state=this.peerConnection.signalingState;if(state==="stable"||state==="have-local-offer"){return"offer"}else if(state==="have-remote-offer"||state==="have-local-pr-answer"){return"answer"}else{this.logger.error("state "+state+" not implemented - returning offer");return"offer"}},getSetRemoteLocationType:function(){var state=this.peerConnection.signalingState;if(state==="stable"||state==="have-remote-offer"){return"offer"}else if(state==="have-local-offer"||state==="have-remote-pr-answer"){return"answer"
}else{this.logger.error("state "+state+" not implemented - returning offer");return"offer"}},sendData:function(data){if(this.dataChannel){this.dataChannel.send(data)}else{this.logger.error("datachannel is not enabled - see UA.configuration.enable_datachannel")}},init:function(options){options=options||{};var idx,length,server,self=this,servers=[],constraints=options.constraints||{},stun_servers=options.stun_servers||null,turn_servers=options.turn_servers||null,config=this.session.ua.configuration;if(!stun_servers){stun_servers=config.stun_servers}if(!turn_servers){turn_servers=config.turn_servers}if(stun_servers.length>0){servers.push({url:stun_servers})}length=turn_servers.length;for(idx=0;idx<length;idx++){server=turn_servers[idx];servers.push({url:server.urls,username:server.username,credential:server.credential})}this.peerConnection=new WebRTC.RTCPeerConnection({iceServers:servers},constraints);this.peerConnection.onaddstream=function(e){self.logger.debug("stream added: "+e.stream.id)};this.peerConnection.onremovestream=function(e){self.logger.debug("stream removed: "+e.stream.id)};this.peerConnection.onicecandidate=function(e){if(e.candidate&&self.session.ua.rtcMediaHandlerOptions.enableICE){self.logger.debug("ICE candidate received: "+e.candidate.candidate)}else if(self.onIceCompleted!==undefined){self.logger.log("onIceCompleted with ready : "+self.ready+" and candidate : "+Utils.toString(e.candidate),self.session.ua);if(!self.ready&&e.candidate){self.onIceCompleted()}}};this.peerConnection.oniceconnectionstatechange=function(){self.logger.debug('ICE connection state changed to "'+this.iceConnectionState+'"');if(this.iceConnectionState==="failed"){self.session.terminate({cause:ExSIP_C.causes.RTP_TIMEOUT,status_code:200,reason_phrase:ExSIP_C.causes.RTP_TIMEOUT})}};this.peerConnection.onstatechange=function(){self.logger.debug('PeerConnection state changed to "'+this.readyState+'"')};if(self.session.ua.configuration.enable_datachannel){this.dataChannel=new DataChannel(this.session,this.peerConnection)}},close:function(stopLocalMedia){this.logger.debug("closing PeerConnection");if(this.peerConnection){if(this.peerConnection.signalingState!=="closed"){this.logger.log("closing PeerConnection",this.session.ua);this.peerConnection.close()}if(stopLocalMedia){if(this.localMedia){this.logger.log("stopping local media "+Utils.toString(this.localMedia),this.session.ua);this.localMedia.stop()}}}},getUserMedia:function(onSuccess,onFailure,constraints){var self=this;this.logger.debug("requesting access to local media");WebRTC.getUserMedia(constraints,function(stream){self.logger.debug("got local media stream");self.localMedia=stream;onSuccess(stream)},function(e){self.logger.error("unable to get user media");self.logger.error(e);onFailure()})},onMessage:function(type,body,onSuccess,onFailure){var self=this;var description=new WebRTC.RTCSessionDescription({type:type,sdp:body});if(this.session.ua.rtcMediaHandlerOptions.videoBandwidth){description.setVideoBandwidth(this.session.ua.rtcMediaHandlerOptions.videoBandwidth);this.logger.log("Modifying SDP with videoBandwidth : "+this.session.ua.rtcMediaHandlerOptions.videoBandwidth)}if(this.peerConnection){if(!description.sdp){this.logger.log("empty sdp on setRemoteDescription - calling success");onSuccess();return}var unsupportedMedia=description.removeUnsupportedMedia();if(unsupportedMedia){this.logger.log("removed unsupported media : "+unsupportedMedia);this.peerConnection.remoteUnsupportedMedia=unsupportedMedia}this.logger.log("peerConnection.setRemoteDescription : description : "+Utils.toString(description));this.logger.log("peerConnection.setRemoteDescription for type "+description.type+" : "+description.sdp);this.peerConnection.setRemoteDescription(description,onSuccess,function(e){self.logger.log("----------setRemoteDescription with error : "+JSON.stringify(e));onFailure(e)})}}}},{"../Constants":197,"../Utils":222,"../WebRTC":223,"./DataChannel":212}],214:[function(require,module,exports){module.exports=Registrator;var Utils=require("./Utils");var ExSIP_C=require("./Constants");var SIPMessage=require("./SIPMessage");var RequestSender=require("./RequestSender");function Registrator(ua,transport){var reg_id=1;this.logger=ua.getLogger("ExSIP.registrator");this.ua=ua;this.transport=transport;this.registrar=ua.configuration.registrar_server;this.expires=ua.configuration.register_expires;this.call_id=Utils.createRandomToken(22);this.cseq=0;this.to_uri=ua.configuration.uri;this.registrationTimer=null;this.registered=false;this.contact=this.ua.contact.toString();this.contact+=";+sip.ice";this.extraHeaders=[];this.extraContactParams="";if(reg_id){this.contact+=";reg-id="+reg_id;this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"'}}Registrator.prototype={setExtraHeaders:function(extraHeaders){if(!extraHeaders instanceof Array){extraHeaders=[]}this.extraHeaders=extraHeaders.slice()},setExtraContactParams:function(extraContactParams){if(!extraContactParams instanceof Object){extraContactParams={}}this.extraContactParams="";for(var param_key in extraContactParams){var param_value=extraContactParams[param_key];this.extraContactParams+=";"+param_key;if(param_value){this.extraContactParams+="="+param_value}}},register:function(){var request_sender,cause,extraHeaders,self=this;extraHeaders=this.extraHeaders.slice();extraHeaders.push("Contact: "+this.contact+";expires="+this.expires+this.extraContactParams);extraHeaders.push("Expires: "+this.expires);this.request=new SIPMessage.OutgoingRequest(ExSIP_C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},extraHeaders);request_sender=new RequestSender(this,this.ua);this.receiveResponse=function(response){var contact,expires,contacts=response.getHeaders("contact").length;if(response.cseq!==this.cseq){return}if(this.registrationTimer!==null){clearTimeout(this.registrationTimer);this.registrationTimer=null}switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):if(response.hasHeader("expires")){expires=response.getHeader("expires")}if(!contacts){this.logger.warn("no Contact header in response to REGISTER, response ignored");break}while(contacts--){contact=response.parseHeader("contact",contacts);if(contact.uri.user===this.ua.contact.uri.user){expires=contact.getParam("expires");break}else{contact=null}}if(!contact){this.logger.warn("no Contact header pointing to us, response ignored");break}if(!expires){expires=this.expires}this.registrationTimer=setTimeout(function(){self.registrationTimer=null;self.register()},expires*1e3-3e3);if(contact.hasParam("temp-gruu")){this.ua.contact.temp_gruu=contact.getParam("temp-gruu").replace(/"/g,"")}if(contact.hasParam("pub-gruu")){this.ua.contact.pub_gruu=contact.getParam("pub-gruu").replace(/"/g,"")}if(!this.registered){this.registered=true;this.ua.emit("registered",this.ua,{response:response})}break;case/^423$/.test(response.status_code):if(response.hasHeader("min-expires")){this.expires=response.getHeader("min-expires");this.register()}else{this.logger.warn("423 response received for REGISTER without Min-Expires");this.registrationFailure(response,ExSIP_C.causes.SIP_FAILURE_CODE)}break;default:cause=Utils.sipErrorCause(response.status_code);this.registrationFailure(response,cause)}};this.onRequestTimeout=function(){this.registrationFailure(null,ExSIP_C.causes.REQUEST_TIMEOUT)};this.onTransportError=function(){this.registrationFailure(null,ExSIP_C.causes.CONNECTION_ERROR)};request_sender.send()},unregister:function(options){var extraHeaders;if(!this.registered){this.logger.debug("already unregistered");return}options=options||{};this.registered=false;if(this.registrationTimer!==null){clearTimeout(this.registrationTimer);this.registrationTimer=null}extraHeaders=this.extraHeaders.slice();if(options.all){extraHeaders.push("Contact: *"+this.extraContactParams);extraHeaders.push("Expires: 0");this.request=new SIPMessage.OutgoingRequest(ExSIP_C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},extraHeaders)}else{extraHeaders.push("Contact: "+this.contact+";expires=0"+this.extraContactParams);extraHeaders.push("Expires: 0");this.request=new SIPMessage.OutgoingRequest(ExSIP_C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},extraHeaders)}var request_sender=new RequestSender(this,this.ua);this.receiveResponse=function(response){var cause;switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):this.unregistered(response);break;default:cause=Utils.sipErrorCause(response.status_code);this.unregistered(response,cause)}};this.onRequestTimeout=function(){this.unregistered(null,ExSIP_C.causes.REQUEST_TIMEOUT)};this.onTransportError=function(){this.unregistered(null,ExSIP_C.causes.CONNECTION_ERROR)};request_sender.send()},registrationFailure:function(response,cause){this.ua.emit("registrationFailed",this.ua,{response:response||null,cause:cause});if(this.registered){this.registered=false;this.ua.emit("unregistered",this.ua,{response:response||null,cause:cause})}},unregistered:function(response,cause){this.registered=false;this.ua.emit("unregistered",this.ua,{response:response||null,cause:cause||null})},onTransportConnected:function(){this.register()},onTransportClosed:function(){if(this.registrationTimer!==null){clearTimeout(this.registrationTimer);this.registrationTimer=null}if(this.registered){this.registered=false;this.ua.emit("unregistered",this.ua)}},close:function(){if(this.registered){this.unregister()}}}},{"./Constants":197,"./RequestSender":215,"./SIPMessage":216,"./Utils":222}],215:[function(require,module,exports){module.exports=RequestSender;var ExSIP_C=require("./Constants");var UA=require("./UA");var DigestAuthentication=require("./DigestAuthentication");var Transactions=require("./Transactions");function RequestSender(applicant,ua){this.logger=ua.getLogger("ExSIP.requestsender");this.ua=ua;this.applicant=applicant;this.method=applicant.request.method;this.request=applicant.request;this.credentials=null;this.challenged=false;this.staled=false;if(ua.status===UA.C.STATUS_USER_CLOSED&&(this.method!==ExSIP_C.BYE||this.method!==ExSIP_C.ACK)){this.onTransportError()}}RequestSender.prototype={send:function(callbacks){this.callbacks=callbacks||{};this.logger.log("callbacks : "+this.callbacks);switch(this.method){case"INVITE":this.clientTransaction=new Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.logger.log("******************** onRequestTimeout : "+this.applicant);this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(response){var cseq,challenge,authorization_header_name,status_code=response.status_code;this.logger.log("receiveResponse: callbacks : "+this.callbacks);if(status_code===401||status_code===407){if(response.status_code===401){challenge=response.parseHeader("www-authenticate");authorization_header_name="authorization"}else{challenge=response.parseHeader("proxy-authenticate");authorization_header_name="proxy-authorization"}if(!challenge){this.logger.warn(response.status_code+" with wrong or missing challenge, cannot authenticate");this.applicant.receiveResponse(response);return}if(!this.challenged||!this.staled&&challenge.stale===true){if(!this.credentials){this.credentials=new DigestAuthentication(this.ua)}if(!this.credentials.authenticate(this.request,challenge)){this.applicant.receiveResponse(response);return}this.challenged=true;if(challenge.stale){this.staled=true}if(response.method===ExSIP_C.REGISTER){cseq=this.applicant.cseq+=1}else if(this.request.dialog){cseq=this.request.dialog.local_seqnum+=1}else{cseq=this.request.cseq+1;this.request.cseq=cseq}this.request.setHeader("cseq",cseq+" "+this.method);this.request.setHeader(authorization_header_name,this.credentials.toString());this.send()}else{this.applicant.receiveResponse(response)}}else{this.applicant.receiveResponse(response)}switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):if(this.callbacks.success){this.callbacks.success()}break;default:if(this.callbacks.failure){this.callbacks.failure(response)}break}}}},{"./Constants":197,"./DigestAuthentication":200,"./Transactions":218,"./UA":220}],216:[function(require,module,exports){module.exports={OutgoingRequest:OutgoingRequest,IncomingRequest:IncomingRequest,IncomingResponse:IncomingResponse};var ExSIP_C=require("./Constants");var Utils=require("./Utils");var NameAddrHeader=require("./NameAddrHeader");var Grammar=require("./Grammar");function OutgoingRequest(method,ruri,ua,params,extraHeaders,body){var to,from,call_id,cseq;params=params||{};this.logger=ua.getLogger("ExSIP.sipmessage");this.logger.debug("OutgoingRequest.extraHeaders : "+method+", "+ruri+", "+extraHeaders);if(!method||!ruri||!ua){return null}this.ua=ua;this.headers={};this.method=method;this.ruri=ruri;this.body=body;this.extraHeaders=extraHeaders&&extraHeaders.slice()||[];this.logger.debug("OutgoingRequest.extraHeaders 2 : "+this.extraHeaders);if(params.route_set){this.setHeader("route",params.route_set)}else if(ua.configuration.use_preloaded_route){this.setHeader("route",ua.transport.server.sip_uri)}this.setHeader("via","");this.setHeader("max-forwards",ExSIP_C.MAX_FORWARDS);to=params.to_display_name||params.to_display_name===0?'"'+params.to_display_name+'" ':"";var toUri=params.to_uri||ruri;to+="<"+(ua.configuration.enable_ims&&toUri.isPhoneNumber()&&toUri.toString().indexOf(";user=phone")===-1?toUri+";user=phone":toUri)+">";to+=params.to_tag?";tag="+params.to_tag:"";this.to=new NameAddrHeader.parse(to);this.setHeader("to",to);var fromName;if(params.from_display_name||params.from_display_name===0){fromName='"'+params.from_display_name+'" '}else if(ua.configuration.display_name){fromName='"'+ua.configuration.display_name+'" '}else{fromName=""}var fromUri=params.from_uri||ua.configuration.uri;fromName+="<"+(ua.configuration.enable_ims&&fromUri.isPhoneNumber()&&fromUri.toString().indexOf(";user=phone")===-1?fromUri+";user=phone":fromUri)+">";var fromTag=";tag="+(params.from_tag||Utils.newTag());from=fromName+fromTag;this.from=new NameAddrHeader.parse(from);this.setHeader("from",from);call_id=params.call_id||ua.configuration.exsip_id+Utils.createRandomToken(15);this.call_id=call_id;this.setHeader("call-id",call_id);cseq=params.cseq||Math.floor(Math.random()*1e4);this.cseq=cseq;this.setHeader("cseq",cseq+" "+method);if(ua.configuration.enable_ims){this.setHeader("P-Asserted-Identity",fromName)}else if(ua.configuration.p_asserted_identity){this.setHeader("P-Asserted-Identity",ua.configuration.p_asserted_identity)}}OutgoingRequest.prototype={setHeader:function(name,value){this.headers[Utils.headerize(name)]=value instanceof Array?value:[value]},getHeader:function(name){var regexp,idx,length=this.extraHeaders.length,header=this.headers[Utils.headerize(name)];if(header){if(header[0]){return header[0]}}else{regexp=new RegExp("^\\s*"+name+"\\s*:","i");for(idx=0;idx<length;idx++){header=this.extraHeaders[idx];if(regexp.test(header)){return header.substring(header.indexOf(":")+1).trim()}}}return},getHeaders:function(name){var idx,length,regexp,header=this.headers[Utils.headerize(name)],result=[];if(header){length=header.length;for(idx=0;idx<length;idx++){result.push(header[idx])}return result}else{length=this.extraHeaders.length;regexp=new RegExp("^\\s*"+name+"\\s*:","i");for(idx=0;idx<length;idx++){header=this.extraHeaders[idx];if(regexp.test(header)){result.push(header.substring(header.indexOf(":")+1).trim())}}return result}},hasHeader:function(name){var regexp,idx,length=this.extraHeaders.length;if(this.headers[Utils.headerize(name)]){return true}else{regexp=new RegExp("^\\s*"+name+"\\s*:","i");for(idx=0;idx<length;idx++){if(regexp.test(this.extraHeaders[idx])){return true}}}return false},toString:function(){var msg="",header,length,idx,supported=[];msg+=this.method+" "+(this.ua.configuration.enable_ims&&this.ruri.isPhoneNumber()?this.ruri+";user=phone":this.ruri)+" SIP/2.0\r\n";for(header in this.headers){length=this.headers[header].length;for(idx=0;idx<length;idx++){msg+=header+": "+this.headers[header][idx]+"\r\n"}}length=this.extraHeaders.length;for(idx=0;idx<length;idx++){msg+=this.extraHeaders[idx].trim()+"\r\n"}switch(this.method){case ExSIP_C.REGISTER:supported.push("path","gruu");break;case ExSIP_C.INVITE:if(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu){supported.push("gruu")}break}supported.push("outbound");if(!this.hasHeader("Allow")){msg+="Allow: "+ExSIP_C.ALLOWED_METHODS+"\r\n"}if(!this.hasHeader("Supported")){msg+="Supported: "+supported+"\r\n"}msg+="User-Agent: "+ExSIP_C.USER_AGENT+"\r\n";if(this.body){length=Utils.str_utf8_length(this.body);msg+="Content-Length: "+length+"\r\n\r\n";msg+=this.body}else{msg+="Content-Length: 0\r\n\r\n"}return msg}};function IncomingMessage(){this.data=null;this.headers=null;this.method=null;this.via=null;this.via_branch=null;this.call_id=null;this.cseq=null;this.from=null;this.from_tag=null;this.to=null;this.to_tag=null;this.body=null}IncomingMessage.prototype={addHeader:function(name,value){var header={raw:value};name=Utils.headerize(name);if(this.headers[name]){this.headers[name].push(header)}else{this.headers[name]=[header]}},getHeader:function(name){var header=this.headers[Utils.headerize(name)];if(header){if(header[0]){return header[0].raw}}else{return}},getHeaders:function(name){var idx,length,header=this.headers[Utils.headerize(name)],result=[];if(!header){return[]}length=header.length;for(idx=0;idx<length;idx++){result.push(header[idx].raw)}return result},hasHeader:function(name){return this.headers[Utils.headerize(name)]?true:false},parseHeader:function(name,idx){var header,value,parsed;name=Utils.headerize(name);idx=idx||0;if(!this.headers[name]){this.logger.log('header "'+name+'" not present');return}else if(idx>=this.headers[name].length){this.logger.log('not so many "'+name+'" headers present');return}header=this.headers[name][idx];value=header.raw;if(header.parsed){return header.parsed}parsed=Grammar.parse(value,name.replace(/-/g,"_"));if(parsed===-1){this.headers[name].splice(idx,1);this.logger.warn('error parsing "'+name+'" header field with value "'+value+'"');return}else{header.parsed=parsed;return parsed}},s:function(name,idx){return this.parseHeader(name,idx)},setHeader:function(name,value){var header={raw:value};this.headers[Utils.headerize(name)]=[header]}};function IncomingRequest(ua){this.logger=ua.getLogger("ExSIP.sipmessage");this.ua=ua;this.headers={};this.ruri=null;this.transport=null;this.server_transaction=null}IncomingRequest.prototype=new IncomingMessage;IncomingRequest.prototype.reply=function(code,reason,extraHeaders,body,onSuccess,onFailure){var rr,vias,length,idx,response,supported=[],to=this.getHeader("To"),r=0,v=0;code=code||null;reason=reason||null;if(!code||(code<100||code>699)){throw new TypeError("Invalid status_code: "+code)}else if(reason&&typeof reason!=="string"&&!(reason instanceof String)){throw new TypeError("Invalid reason_phrase: "+reason)}reason=reason||ExSIP_C.REASON_PHRASE[code]||"";extraHeaders=extraHeaders&&extraHeaders.slice()||[];response="SIP/2.0 "+code+" "+reason+"\r\n";if(this.method===ExSIP_C.INVITE&&code>100&&code<=200){rr=this.getHeaders("record-route");length=rr.length;for(r;r<length;r++){response+="Record-Route: "+rr[r]+"\r\n"}}vias=this.getHeaders("via");length=vias.length;for(v;v<length;v++){response+="Via: "+vias[v]+"\r\n"}if(!this.to_tag&&code>100){to+=";tag="+Utils.newTag()}else if(this.to_tag&&!this.s("to").hasParam("tag")){to+=";tag="+this.to_tag}response+="To: "+to+"\r\n";response+="From: "+this.getHeader("From")+"\r\n";response+="Call-ID: "+this.call_id+"\r\n";response+="CSeq: "+this.cseq+" "+this.method+"\r\n";length=extraHeaders.length;for(idx=0;idx<length;idx++){response+=extraHeaders[idx].trim()+"\r\n"}switch(this.method){case ExSIP_C.INVITE:if(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu){supported.push("gruu")}break}supported.push("outbound");if(this.method===ExSIP_C.OPTIONS){response+="Allow: "+ExSIP_C.ALLOWED_METHODS+"\r\n";response+="Accept: "+ExSIP_C.ACCEPTED_BODY_TYPES+"\r\n"}else if(code===405){response+="Allow: "+ExSIP_C.ALLOWED_METHODS+"\r\n"}else if(code===415){response+="Accept: "+ExSIP_C.ACCEPTED_BODY_TYPES+"\r\n"}response+="Supported: "+supported+"\r\n";if(body){length=Utils.str_utf8_length(body);if(!this.hasHeader("Content-Type")){response+="Content-Type: application/sdp\r\n"}response+="Content-Length: "+length+"\r\n\r\n";response+=body}else{response+="Content-Length: "+0+"\r\n\r\n"}this.server_transaction.receiveResponse(code,response,onSuccess,onFailure)};IncomingRequest.prototype.reply_sl=function(code,reason){var to,response,v=0,vias=this.getHeaders("via"),length=vias.length;code=code||null;reason=reason||null;if(!code||(code<100||code>699)){throw new TypeError("Invalid status_code: "+code)}else if(reason&&typeof reason!=="string"&&!(reason instanceof String)){throw new TypeError("Invalid reason_phrase: "+reason)}reason=reason||ExSIP_C.REASON_PHRASE[code]||"";response="SIP/2.0 "+code+" "+reason+"\r\n";for(v;v<length;v++){response+="Via: "+vias[v]+"\r\n"}to=this.getHeader("To");if(!this.to_tag&&code>100){to+=";tag="+Utils.newTag()}else if(this.to_tag&&!this.s("to").hasParam("tag")){to+=";tag="+this.to_tag}response+="To: "+to+"\r\n";response+="From: "+this.getHeader("From")+"\r\n";response+="Call-ID: "+this.call_id+"\r\n";response+="CSeq: "+this.cseq+" "+this.method+"\r\n";response+="Content-Length: "+0+"\r\n\r\n";this.transport.send(response)};function IncomingResponse(ua){this.logger=ua.getLogger("ExSIP.sipmessage");this.headers={};this.status_code=null;this.reason_phrase=null}IncomingResponse.prototype=new IncomingMessage},{"./Constants":197,"./Grammar":204,"./NameAddrHeader":208,"./Utils":222}],217:[function(require,module,exports){var T1=500,T2=4e3,T4=5e3;var Timers={T1:T1,T2:T2,T4:T4,TIMER_B:64*T1,TIMER_D:0*T1,TIMER_F:64*T1,TIMER_H:64*T1,TIMER_I:0*T1,TIMER_J:0*T1,TIMER_K:0*T4,TIMER_L:64*T1,TIMER_M:64*T1,PROVISIONAL_RESPONSE_INTERVAL:6e4};module.exports=Timers},{}],218:[function(require,module,exports){module.exports={C:null,NonInviteClientTransaction:NonInviteClientTransaction,InviteClientTransaction:InviteClientTransaction,AckClientTransaction:AckClientTransaction,NonInviteServerTransaction:NonInviteServerTransaction,InviteServerTransaction:InviteServerTransaction,checkTransaction:checkTransaction};var C={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};module.exports.C=C;var ExSIP_C=require("./Constants");var EventEmitter=require("./EventEmitter");var Timers=require("./Timers");function NonInviteClientTransaction(request_sender,request,transport){var via,via_transport,events=["stateChanged"];this.type=C.NON_INVITE_CLIENT;this.transport=transport;this.id="z9hG4bK"+Math.floor(Math.random()*1e7);this.request_sender=request_sender;this.request=request;this.logger=request_sender.ua.getLogger("ExSIP.transaction.nict",this.id);if(request_sender.ua.configuration.hack_via_tcp){via_transport="TCP"}else if(request_sender.ua.configuration.hack_via_ws){via_transport="WS"}else{via_transport=transport.server.scheme}via="SIP/2.0/"+via_transport;via+=" "+request_sender.ua.configuration.via_host+";branch="+this.id;this.request.setHeader("via",via);this.request_sender.ua.newTransaction(this);this.initEvents(events)}NonInviteClientTransaction.prototype=new EventEmitter;NonInviteClientTransaction.prototype.stateChanged=function(state){this.state=state;this.emit("stateChanged",this)};NonInviteClientTransaction.prototype.send=function(){var tr=this;this.stateChanged(C.STATUS_TRYING);this.F=setTimeout(function(){tr.timer_F()},Timers.TIMER_F);if(!this.transport.send(this.request)){this.onTransportError()}};NonInviteClientTransaction.prototype.onTransportError=function(){this.logger.debug("transport error occurred, deleting non-INVITE client transaction "+this.id);clearTimeout(this.F);clearTimeout(this.K);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);this.request_sender.onTransportError()};NonInviteClientTransaction.prototype.timer_F=function(){this.logger.debug("Timer F expired for non-INVITE client transaction "+this.id);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);this.request_sender.onRequestTimeout()};NonInviteClientTransaction.prototype.timer_K=function(){this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this)};NonInviteClientTransaction.prototype.receiveResponse=function(response){var tr=this,status_code=response.status_code;if(status_code<200){switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_PROCEEDING);this.request_sender.receiveResponse(response);break}}else{switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_COMPLETED);clearTimeout(this.F);if(status_code===408){this.request_sender.onRequestTimeout()}else{this.request_sender.receiveResponse(response)}this.K=setTimeout(function(){tr.timer_K()},Timers.TIMER_K);break;case C.STATUS_COMPLETED:break}}};function InviteClientTransaction(request_sender,request,transport){var via,tr=this,via_transport,events=["stateChanged"];this.type=C.INVITE_CLIENT;this.transport=transport;this.id="z9hG4bK"+Math.floor(Math.random()*1e7);this.request_sender=request_sender;this.request=request;this.logger=request_sender.ua.getLogger("ExSIP.transaction.ict",this.id);this.logger.log("******************** request_sender : "+request_sender);if(request_sender.ua.configuration.hack_via_tcp){via_transport="TCP"}else if(request_sender.ua.configuration.hack_via_ws){via_transport="WS"}else{via_transport=transport.server.scheme}via="SIP/2.0/"+via_transport;via+=" "+request_sender.ua.configuration.via_host+";branch="+this.id;this.request.setHeader("via",via);this.request_sender.ua.newTransaction(this);this.request.cancel=function(reason){tr.cancel_request(tr,reason)};this.initEvents(events)}InviteClientTransaction.prototype=new EventEmitter;InviteClientTransaction.prototype.stateChanged=function(state){this.state=state;this.emit("stateChanged",this)};InviteClientTransaction.prototype.send=function(){var tr=this;this.stateChanged(C.STATUS_CALLING);this.B=setTimeout(function(){tr.timer_B()},Timers.TIMER_B);if(!this.transport.send(this.request)){this.onTransportError()}};InviteClientTransaction.prototype.onTransportError=function(){this.logger.debug("transport error occurred, deleting INVITE client transaction "+this.id);clearTimeout(this.B);clearTimeout(this.D);clearTimeout(this.M);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);if(this.state!==C.STATUS_ACCEPTED){this.request_sender.onTransportError()}};InviteClientTransaction.prototype.timer_M=function(){this.logger.debug("Timer M expired for INVITE client transaction "+this.id);if(this.state===C.STATUS_ACCEPTED){clearTimeout(this.B);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this)}};InviteClientTransaction.prototype.timer_B=function(){this.logger.debug("Timer B expired for INVITE client transaction "+this.id);if(this.state===C.STATUS_CALLING){this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);this.logger.debug("InviteClientTransaction.timer_B : "+this.request_sender);this.request_sender.onRequestTimeout()}};InviteClientTransaction.prototype.timer_D=function(){this.logger.debug("Timer D expired for INVITE client transaction "+this.id);clearTimeout(this.B);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this)};InviteClientTransaction.prototype.sendACK=function(response){var tr=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n";this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n";if(this.request.headers.Route){this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"}this.ack+="To: "+response.getHeader("to")+"\r\n";this.ack+="From: "+this.request.headers.From.toString()+"\r\n";this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n";this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0];this.ack+=" ACK\r\n";this.ack+="Content-Length: 0\r\n\r\n";this.D=setTimeout(function(){tr.timer_D()},Timers.TIMER_D);this.transport.send(this.ack)};InviteClientTransaction.prototype.cancel_request=function(tr,reason){var request=tr.request;this.cancel=ExSIP_C.CANCEL+" "+request.ruri+" SIP/2.0\r\n";this.cancel+="Via: "+request.headers.Via.toString()+"\r\n";if(this.request.headers.Route){this.cancel+="Route: "+request.headers.Route.toString()+"\r\n"}this.cancel+="To: "+request.headers.To.toString()+"\r\n";this.cancel+="From: "+request.headers.From.toString()+"\r\n";this.cancel+="Call-ID: "+request.headers["Call-ID"].toString()+"\r\n";this.cancel+="CSeq: "+request.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n";if(reason){this.cancel+="Reason: "+reason+"\r\n"}this.cancel+="Content-Length: 0\r\n\r\n";if(this.state===C.STATUS_PROCEEDING){this.transport.send(this.cancel)}};InviteClientTransaction.prototype.receiveResponse=function(response){var tr=this,status_code=response.status_code;if(status_code>=100&&status_code<=199){this.logger.debug("received 1xx : "+this.state);switch(this.state){case C.STATUS_CALLING:this.stateChanged(C.STATUS_PROCEEDING);this.request_sender.receiveResponse(response);break;case C.STATUS_PROCEEDING:this.request_sender.receiveResponse(response);break}}else if(status_code>=200&&status_code<=299){switch(this.state){case C.STATUS_CALLING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_ACCEPTED);this.M=setTimeout(function(){tr.timer_M()},Timers.TIMER_M);this.request_sender.receiveResponse(response);break;case C.STATUS_ACCEPTED:this.request_sender.receiveResponse(response);break}}else if(status_code>=300&&status_code<=699){switch(this.state){case C.STATUS_CALLING:case C.STATUS_PROCEEDING:this.state=C.STATUS_COMPLETED;this.sendACK(response);if(status_code===503){var options={code:503,reason:"Service Unavailable",retryCallback:function(transport){transport.ua.once("connected",function(e){if(transport===e.data.transport){tr.send()}})}};this.request_sender.ua.onTransportError(this.request_sender.ua.transport,options)}else{this.request_sender.receiveResponse(response)}break;case C.STATUS_COMPLETED:this.sendACK(response);break}}};function AckClientTransaction(request_sender,request,transport){var via,via_transport;this.transport=transport;this.id="z9hG4bK"+Math.floor(Math.random()*1e7);this.request_sender=request_sender;this.request=request;this.logger=request_sender.ua.getLogger("ExSIP.transaction.nict",this.id);if(request_sender.ua.configuration.hack_via_tcp){via_transport="TCP"}else if(request_sender.ua.configuration.hack_via_ws){via_transport="WS"}else{via_transport=transport.server.scheme}via="SIP/2.0/"+via_transport;via+=" "+request_sender.ua.configuration.via_host+";branch="+this.id;this.request.setHeader("via",via)}AckClientTransaction.prototype=new EventEmitter;AckClientTransaction.prototype.send=function(){if(!this.transport.send(this.request)){this.onTransportError()}};AckClientTransaction.prototype.onTransportError=function(){this.logger.debug("transport error occurred, for an ACK client transaction "+this.id);this.request_sender.onTransportError()};function NonInviteServerTransaction(request,ua){var events=["stateChanged"];this.type=C.NON_INVITE_SERVER;
this.id=request.via_branch;this.request=request;this.transport=request.transport;this.ua=ua;this.last_response="";request.server_transaction=this;this.logger=ua.getLogger("ExSIP.transaction.nist",this.id);this.state=C.STATUS_TRYING;ua.newTransaction(this);this.initEvents(events)}NonInviteServerTransaction.prototype=new EventEmitter;NonInviteServerTransaction.prototype.stateChanged=function(state){this.state=state;this.emit("stateChanged",this)};NonInviteServerTransaction.prototype.timer_J=function(){this.logger.debug("Timer J expired for non-INVITE server transaction "+this.id);this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)};NonInviteServerTransaction.prototype.onTransportError=function(){if(!this.transportError){this.transportError=true;this.logger.debug("transport error occurred, deleting non-INVITE server transaction "+this.id);clearTimeout(this.J);this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)}};NonInviteServerTransaction.prototype.receiveResponse=function(status_code,response,onSuccess,onFailure){var tr=this;if(status_code===100){switch(this.state){case C.STATUS_TRYING:this.stateChanged(C.STATUS_PROCEEDING);if(!this.transport.send(response)){this.onTransportError()}break;case C.STATUS_PROCEEDING:this.last_response=response;if(!this.transport.send(response)){this.onTransportError();if(onFailure){onFailure()}}else if(onSuccess){onSuccess()}break}}else if(status_code>=200&&status_code<=699){switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_COMPLETED);this.last_response=response;if(Timers.TIMER_J===0){tr.timer_J()}else{this.J=setTimeout(function(){tr.timer_J()},Timers.TIMER_J)}if(!this.transport.send(response)){this.onTransportError();if(onFailure){onFailure()}}else if(onSuccess){onSuccess()}break;case C.STATUS_COMPLETED:break}}};function InviteServerTransaction(request,ua){var events=["stateChanged"];this.type=C.INVITE_SERVER;this.id=request.via_branch;this.request=request;this.transport=request.transport;this.ua=ua;this.last_response="";request.server_transaction=this;this.logger=ua.getLogger("ExSIP.transaction.ist",this.id);this.state=C.STATUS_PROCEEDING;ua.newTransaction(this);this.resendProvisionalTimer=null;request.reply(100);this.initEvents(events)}InviteServerTransaction.prototype=new EventEmitter;InviteServerTransaction.prototype.stateChanged=function(state){this.state=state;this.emit("stateChanged",this)};InviteServerTransaction.prototype.timer_H=function(){this.logger.debug("Timer H expired for INVITE server transaction "+this.id);if(this.state===C.STATUS_COMPLETED){this.logger.log("transactions","ACK for INVITE server transaction was never received, call will be terminated")}this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)};InviteServerTransaction.prototype.timer_I=function(){this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)};InviteServerTransaction.prototype.timer_L=function(){this.logger.debug("Timer L expired for INVITE server transaction "+this.id);if(this.state===C.STATUS_ACCEPTED){this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)}};InviteServerTransaction.prototype.onTransportError=function(){if(!this.transportError){this.transportError=true;this.logger.debug("transport error occurred, deleting INVITE server transaction "+this.id);if(this.resendProvisionalTimer!==null){clearInterval(this.resendProvisionalTimer);this.resendProvisionalTimer=null}clearTimeout(this.L);clearTimeout(this.H);clearTimeout(this.I);this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)}};InviteServerTransaction.prototype.resend_provisional=function(){if(!this.transport.send(this.last_response)){this.onTransportError()}};InviteServerTransaction.prototype.receiveResponse=function(status_code,response,onSuccess,onFailure){var tr=this;if(status_code>=100&&status_code<=199){switch(this.state){case C.STATUS_PROCEEDING:if(!this.transport.send(response)){this.onTransportError()}this.last_response=response;break}}if(status_code>100&&status_code<=199&&this.state===C.STATUS_PROCEEDING){if(this.resendProvisionalTimer===null){this.resendProvisionalTimer=setInterval(function(){tr.resend_provisional()},Timers.PROVISIONAL_RESPONSE_INTERVAL)}}else if(status_code>=200&&status_code<=299){switch(this.state){case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_ACCEPTED);this.last_response=response;this.L=setTimeout(function(){tr.timer_L()},Timers.TIMER_L);if(this.resendProvisionalTimer!==null){clearInterval(this.resendProvisionalTimer);this.resendProvisionalTimer=null}case C.STATUS_ACCEPTED:if(!this.transport.send(response)){this.onTransportError();if(onFailure){onFailure()}}else if(onSuccess){onSuccess()}break}}else if(status_code>=300&&status_code<=699){switch(this.state){case C.STATUS_PROCEEDING:if(this.resendProvisionalTimer!==null){clearInterval(this.resendProvisionalTimer);this.resendProvisionalTimer=null}if(!this.transport.send(response)){this.onTransportError();if(onFailure){onFailure()}}else{this.stateChanged(C.STATUS_COMPLETED);this.H=setTimeout(function(){tr.timer_H()},Timers.TIMER_H);if(onSuccess){onSuccess()}}break}}};function checkTransaction(ua,request){var tr;switch(request.method){case ExSIP_C.INVITE:tr=ua.transactions.ist[request.via_branch];if(tr){switch(tr.state){case C.STATUS_PROCEEDING:tr.transport.send(tr.last_response);break;case C.STATUS_ACCEPTED:break}console.log("checkTransaction failed for INVITE request and server transaction in state : "+tr.state);return true}break;case ExSIP_C.ACK:tr=ua.transactions.ist[request.via_branch];if(tr){if(tr.state===C.STATUS_ACCEPTED){return false}else if(tr.state===C.STATUS_COMPLETED){tr.state=C.STATUS_CONFIRMED;tr.I=setTimeout(function(){tr.timer_I()},Timers.TIMER_I);return true}}else{return false}break;case ExSIP_C.CANCEL:tr=ua.transactions.ist[request.via_branch];if(tr){request.reply_sl(200);if(tr.state===C.STATUS_PROCEEDING){return false}else{console.log("checkTransaction failed for CANCEL request and server transaction in state : "+tr.state);return true}}else{request.reply_sl(481);console.log("checkTransaction failed for CANCEL request and no server transaction");return true}break;default:console.log("***************** nist : ",Object.keys(ua.transactions.nist));tr=ua.transactions.nist[request.via_branch];if(tr){switch(tr.state){case C.STATUS_TRYING:break;case C.STATUS_PROCEEDING:case C.STATUS_COMPLETED:tr.transport.send(tr.last_response);break}console.log("checkTransaction failed for non invite server transaction in state : "+tr.state);return true}break}}},{"./Constants":197,"./EventEmitter":201,"./Timers":217}],219:[function(require,module,exports){(function(global){module.exports=Transport;var C={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};Transport.C=C;var ExSIP_C=require("./Constants");var Parser=require("./Parser");var UA=require("./UA");var SIPMessage=require("./SIPMessage");var sanityCheck=require("./sanityCheck");var WebSocket;var isNode=false;if(global.WebSocket){WebSocket=global.WebSocket}else{WebSocket=require("ws");isNode=true}function Transport(ua,server){this.logger=ua.getLogger("ExSIP.transport");this.ua=ua;this.ws=null;this.server=server;this.reconnection_attempts=0;this.closed=false;this.connected=false;this.reconnectTimer=null;this.lastTransportError={};if(isNode){this.ws_options=this.ua.configuration.node_ws_options;this.ws_options.protocol="sip";this.ws_options.headers={"User-Agent":ExSIP_C.USER_AGENT}}}Transport.prototype={send:function(msg){var message=msg.toString();if(this.ws&&this.readyState()===WebSocket.OPEN){if(this.ua.configuration.trace_sip===true){this.logger.debug("sending WebSocket message:\n\n"+message+"\n")}this.ws.send(message);return true}else{this.logger.warn("unable to send message, WebSocket is not open");return false}},readyState:function(){return this.ws.readyState},disconnect:function(){if(this.ws){clearTimeout(this.reconnectTimer);this.closed=true;this.logger.debug("closing WebSocket "+this.server.ws_uri);this.ws.close()}if(this.reconnectTimer!==null){clearTimeout(this.reconnectTimer);this.reconnectTimer=null;this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason})}},connect:function(){var transport=this;if(this.ws&&(this.readyState()===WebSocket.OPEN||this.readyState()===WebSocket.CONNECTING)){this.logger.log("WebSocket "+this.server.ws_uri+" is already connected");return false}if(this.ws){this.ws.close()}this.logger.log("connecting to WebSocket "+this.server.ws_uri);this.ua.onTransportConnecting(this,this.reconnection_attempts===0?1:this.reconnection_attempts);try{if(!isNode){this.ws=new WebSocket(this.server.ws_uri,"sip");this.ws.binaryType="arraybuffer"}else{this.ws=new WebSocket(this.server.ws_uri,this.ws_options)}this.ua.usedServers.push(this.server);this.ws.onopen=function(){transport.onOpen()};this.ws.onclose=function(e){transport.onClose(e)};this.ws.onmessage=function(e){transport.onMessage(e)};this.ws.onerror=function(e){transport.onError(e)}}catch(e){this.logger.warn("error connecting to WebSocket "+this.server.ws_uri+": "+e);this.lastTransportError.code=null;this.lastTransportError.reason=e.message;this.ua.onTransportError(this)}},onOpen:function(){this.connected=true;this.logger.debug("WebSocket "+this.server.ws_uri+" connected");if(this.reconnectTimer!==null){clearTimeout(this.reconnectTimer);this.reconnectTimer=null}this.reconnection_attempts=0;this.closed=false;this.ua.onTransportConnected(this)},onClose:function(e){var connected_before=this.connected;this.connected=false;this.lastTransportError.code=e.code;this.lastTransportError.reason=e.reason;this.logger.debug("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")");if(e.wasClean===false){this.logger.warn("WebSocket abrupt disconnection")}if(connected_before===true){this.ua.onTransportClosed(this);if(!this.closed){this.reConnect()}else{this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason})}}else{this.ua.onTransportError(this)}},onMessage:function(e){var message,transaction,data=e.data;if(data==="\r\n"){if(this.ua.configuration.trace_sip===true){this.logger.debug("received WebSocket message with CRLF Keep Alive response")}return}else if(typeof data!=="string"){try{data=String.fromCharCode.apply(null,new Uint8Array(data))}catch(evt){this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded");return}if(this.ua.configuration.trace_sip===true){this.logger.debug("received WebSocket binary message:\n\n"+data+"\n")}}else{this.logger.log("onMessage : "+this.ua.configuration.trace_sip);if(this.ua.configuration.trace_sip===true){this.logger.debug("received WebSocket text message:\n\n"+data+"\n")}}message=Parser.parseMessage(data,this.ua);if(!message){return}if(this.ua.status===UA.C.STATUS_USER_CLOSED&&message instanceof SIPMessage.IncomingRequest){return}if(!sanityCheck(message,this.ua,this)){return}if(message instanceof SIPMessage.IncomingRequest){message.transport=this;this.ua.receiveRequest(message)}else if(message instanceof SIPMessage.IncomingResponse){switch(message.method){case ExSIP_C.INVITE:transaction=this.ua.transactions.ict[message.via_branch];if(transaction){transaction.receiveResponse(message)}break;case ExSIP_C.ACK:break;default:transaction=this.ua.transactions.nict[message.via_branch];if(transaction){transaction.receiveResponse(message)}break}}},onError:function(e){this.logger.warn("WebSocket connection error: "+e)},reConnect:function(){var transport=this;this.reconnection_attempts+=1;if(this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection){this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.ws_uri);this.ua.onTransportError(this)}else{this.logger.log("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"+" (reconnection timeout "+this.ua.configuration.ws_server_reconnection_timeout+")");if(this.ua.configuration.ws_server_reconnection_timeout===0){transport.connect()}else{this.reconnectTimer=setTimeout(function(){transport.connect();transport.reconnectTimer=null},this.ua.configuration.ws_server_reconnection_timeout*1e3)}}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Constants":197,"./Parser":209,"./SIPMessage":216,"./UA":220,"./sanityCheck":224,ws:195}],220:[function(require,module,exports){module.exports=UA;var C={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};UA.C=C;var ExSIP_C=require("./Constants");var LoggerFactory=require("./LoggerFactory");var EventEmitter=require("./EventEmitter");var Registrator=require("./Registrator");var RTCSession=require("./RTCSession");var Message=require("./Message");var Transport=require("./Transport");var Transactions=require("./Transactions");var Transactions=require("./Transactions");var Utils=require("./Utils");var WebRTC=require("./WebRTC");var Exceptions=require("./Exceptions");var URI=require("./URI");var Grammar=require("./Grammar");var Utils=require("./Utils");function UA(configuration){var events=["connecting","connected","disconnected","newTransaction","transactionDestroyed","registered","unregistered","registrationFailed","newRTCSession","newMessage","onReInvite"];this.log=new LoggerFactory;this.logger=this.getLogger("ua");this.usedServers=[];this.rtcMediaHandlerOptions={};this.cache={credentials:{}};this.configuration={};this.dynConfiguration={};this.dialogs={};this.applicants={};this.sessions={};this.transport=null;this.contact=null;this.status=C.STATUS_INIT;this.error=null;this.transactions={nist:{},nict:{},ist:{},ict:{}};this.data={};this.transportRecoverAttempts=0;this.transportRecoveryTimer=null;Object.defineProperties(this,{transactionsCount:{get:function(){var type,transactions=["nist","nict","ist","ict"],count=0;for(type in transactions){count+=Object.keys(this.transactions[transactions[type]]).length}return count}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}});if(configuration===undefined){throw new TypeError("Not enough arguments")}if(configuration.log){if(configuration.log.hasOwnProperty("builtinEnabled")){this.log.builtinEnabled=configuration.log.builtinEnabled}if(configuration.log.hasOwnProperty("level")){this.log.level=configuration.log.level}if(configuration.log.hasOwnProperty("connector")){this.log.connector=configuration.log.connector}}try{this.loadConfig(configuration);this.initEvents(events)}catch(e){this.status=C.STATUS_NOT_READY;this.error=C.CONFIGURATION_ERROR;throw e}this._registrator=new Registrator(this)}UA.prototype=new EventEmitter;UA.prototype.isDebug=function(){return this.configuration.trace_sip===true};UA.prototype.isRegistered=function(){if(this._registrator&&this._registrator.registered){return true}else{return false}};UA.prototype.isConnected=function(){if(this.transport){return this.transport.connected}else{return false}};UA.prototype.transfer=function(transferTarget,sessionToTransfer,options){var self=this;this.logger.log("transfer : "+transferTarget+" : options : "+Utils.toString(options));transferTarget=Utils.normalizeTarget(transferTarget,this.configuration.hostport_params);if(!transferTarget){sessionToTransfer.failed("local",null,ExSIP_C.causes.INVALID_TARGET);this.logger.warn("invalid transfer target");return}var holdFailed=function(){self.logger.log("transfer : hold failed")};var holdSuccess=function(){self.logger.log("transfer : hold success - sending refer to transferee");self.sendReferBasic(sessionToTransfer,transferTarget,options)};self.logger.log("transfer : holding session to transfer");sessionToTransfer.hold(holdSuccess,holdFailed)};UA.prototype.attendedTransfer=function(transferTarget,sessionToTransfer,options){var self=this;this.logger.log("attended transfer : "+transferTarget+" : options : "+Utils.toString(options));transferTarget=Utils.normalizeTarget(transferTarget,this.configuration.hostport_params);if(!transferTarget){this.logger.warn("invalid transfer target");sessionToTransfer.failed("local",null,ExSIP_C.causes.INVALID_TARGET);return}var targetSession=self.newSession(options);targetSession.rtcMediaHandler.copy(sessionToTransfer.rtcMediaHandler);var holdTargetSuccess=function(){self.logger.log("transfer : hold target success - sending attended refer");self.sendReferAttended(sessionToTransfer,targetSession,transferTarget,options)};var holdTargetFailed=function(){self.logger.log("transfer : hold target failed")};var sendTargetInviteSuccess=function(){self.logger.log("transfer : send invite to target success - putting target on hold");targetSession.hold(holdTargetSuccess,holdTargetFailed)};var sendTargetInviteFailed=function(response){self.logger.log("transfer : send invite to target failed - sending basic refer");if(response.status_code===420){self.sendReferBasic(sessionToTransfer,transferTarget,options)}};var holdFailed=function(){self.logger.log("transfer : hold failed")};var holdSuccess=function(){self.logger.log("transfer : hold success - sending invite to target");targetSession.sendInviteRequest(transferTarget,{extraHeaders:["Require: replaces"]},sendTargetInviteSuccess,sendTargetInviteFailed)};self.logger.log("transfer : holding session to transfer");sessionToTransfer.hold(holdSuccess,holdFailed)};UA.prototype.sendReferAttended=function(sessionToTransfer,targetSession,transferTarget,options){var referSession=this.getReferSession(sessionToTransfer,options);options=this.getReferOptions(sessionToTransfer,targetSession,options);var referTo="<"+transferTarget.toString()+"?Replaces="+targetSession.dialog.id.call_id+"%3Bto-tag%3D"+targetSession.dialog.id.remote_tag+"%3Bfrom-tag%3D"+targetSession.dialog.id.local_tag+">";options.extraHeaders.push("Refer-To: "+referTo);referSession.sendReferRequest(sessionToTransfer,options)};UA.prototype.processRefer=function(sessionToTransfer,referRequest){var self=this;referRequest.reply(202);var notifySuccess=function(){self.logger.log("Notify successful")};var notifyFailure=function(){self.logger.log("Notify failed")};sessionToTransfer.sendNotifyRequest({sdp:"SIP/2.0 100 Trying"},notifySuccess,notifyFailure)};UA.prototype.sendReferBasic=function(sessionToTransfer,transferTarget,options){var referSession=this.getReferSession(sessionToTransfer,options);options=this.getReferOptions(sessionToTransfer,sessionToTransfer,options);options.extraHeaders.push("Refer-To: <"+transferTarget+">");this.logger.debug("refer options : "+JSON.stringify(options));referSession.sendReferRequest(sessionToTransfer,options)};UA.prototype.getReferOptions=function(sessionToTransfer,targetDialogSession,options){options=options||{};options.extraHeaders=options.extraHeaders||[];if(sessionToTransfer.supports("tdialog")){options.extraHeaders.push("Require: tdialog");var localTag=targetDialogSession.dialog.isUAS()?targetDialogSession.dialog.id.remote_tag:targetDialogSession.dialog.id.local_tag;var remoteTag=targetDialogSession.dialog.isUAS()?targetDialogSession.dialog.id.local_tag:targetDialogSession.dialog.id.remote_tag;var targetDialog=targetDialogSession.dialog.id.call_id+";local-tag="+localTag+";remote-tag="+remoteTag;options.extraHeaders.push("Target-Dialog: "+targetDialog)}return options};UA.prototype.getReferSession=function(sessionToTransfer,options){if(sessionToTransfer.supports("tdialog")){return this.newSession(options)}else{this.logger.warn("tdialog not supported - sending refer in same session : "+sessionToTransfer.id,this);return sessionToTransfer}};UA.prototype.newSession=function(options){var session=new RTCSession(this);session.initRtcMediaHandler(options);return session};UA.prototype.getUserMedia=function(options,success,failure,force){if(!force&&this.localMedia){return this.localMedia}if(this.localMedia){this.logger.log("stopping existing local media stream",this);this.localMedia.stop()}this.logger.log("options : "+Utils.toString(options),this);var self=this;var constraints=options.mediaConstraints||{audio:true,video:true};WebRTC.getUserMedia(constraints,function(stream){self.logger.log("got local media stream",self);self.localMedia=stream;success(stream)},function(e){self.logger.error("unable to get user media");self.logger.error(e);failure(e)})};UA.prototype.stop=function(){var session,applicant,ua=this;this.logger.log("user requested closure...");this.dynConfiguration={};if(this.status===C.STATUS_USER_CLOSED){this.logger.warn("UA already closed");return}clearTimeout(this.transportRecoveryTimer);if(this._registrator){this.logger.debug("closing registrator");this._registrator.close()}var num_sessions=Object.keys(this.sessions).length;for(session in this.sessions){this.logger.log("closing session "+session,this);this.sessions[session].terminate()}for(applicant in this.applicants){this.applicants[applicant].close()}this.status=C.STATUS_USER_CLOSED;if(this.nistTransactionsCount===0&&this.nictTransactionsCount===0&&num_sessions===0){ua.transport.disconnect()}else{setTimeout(function(){ua.transport.disconnect()},2e3)}};UA.prototype.reconnect=function(){this.logger.debug("************** reconnect");this.stop();this.status=C.STATUS_INIT;this.start()};UA.prototype.start=function(){var server;this.logger.debug("user requested startup... : ",this.status);if(this.status===C.STATUS_INIT){server=this.getNextWsServer({force:true});this.transport=new Transport(this,server);this.transport.connect()}else if(this.status===C.STATUS_USER_CLOSED){this.logger.log("resuming");this.status=C.STATUS_READY;this.transport.connect()}else if(this.status===C.STATUS_READY){this.logger.log("UA is in READY status, not resuming")}else{this.logger.error("Connection is down. Auto-Recovery system is trying to connect")}this.dynConfiguration.register=this.configuration.register};UA.prototype.register=function(){this.dynConfiguration.register=true;this._registrator.register()};UA.prototype.unregister=function(options){this.dynConfiguration.register=false;this._registrator.unregister(options)};UA.prototype.registrator=function(){return this._registrator};UA.prototype.isRegistered=function(){if(this._registrator.registered){return true}else{return false}};UA.prototype.isConnected=function(){if(this.transport){return this.transport.connected}else{return false}};UA.prototype.call=function(target,options){var session;session=new RTCSession(this);session.connect(target,options);return session};UA.prototype.sendMessage=function(target,body,options){var message;message=new Message(this);message.send(target,body,options)};UA.prototype.normalizeTarget=function(target){return Utils.normalizeTarget(target,this.configuration.hostport_params)};UA.prototype.setRtcMediaHandlerOptions=function(rtcMediaHandlerOptions){this.rtcMediaHandlerOptions=rtcMediaHandlerOptions};UA.prototype.rtcConstraints=function(){return this.rtcMediaHandlerOptions?this.rtcMediaHandlerOptions.RTCConstraints:false};UA.prototype.reuseLocalMedia=function(){return this.rtcMediaHandlerOptions?this.rtcMediaHandlerOptions.reuseLocalMedia:false};UA.prototype.saveCredentials=function(credentials){this.cache.credentials[credentials.realm]=this.cache.credentials[credentials.realm]||{};this.cache.credentials[credentials.realm][credentials.uri]=credentials};UA.prototype.getCredentials=function(request){var realm,credentials;realm=request.ruri.host;if(this.cache.credentials[realm]&&this.cache.credentials[realm][request.ruri]){credentials=this.cache.credentials[realm][request.ruri];credentials.method=request.method}return credentials};UA.prototype.getLogger=function(category,label){return this.log.getLogger(category,label)};UA.prototype.onTransportClosed=function(transport){var type,idx,length,client_transactions=["nict","ict","nist","ist"];transport.server.status=Transport.C.STATUS_DISCONNECTED;this.logger.log("connection state set to "+Transport.C.STATUS_DISCONNECTED,this);length=client_transactions.length;for(type=0;type<length;type++){for(idx in this.transactions[client_transactions[type]]){this.transactions[client_transactions[type]][idx].onTransportError()}}if(!this.contact.pub_gruu){this.closeSessionsOnTransportError()}};UA.prototype.onTransportError=function(transport,options){options=options||{};if(this.status===C.STATUS_USER_CLOSED){return}this.logger.log("transport "+transport.server.ws_uri+" failed | connection state set to "+Transport.C.STATUS_ERROR,this);transport.server.status=Transport.C.STATUS_ERROR;this.closeSessionsOnTransportError();if(!this.error||this.error!==C.NETWORK_ERROR){this.status=C.STATUS_NOT_READY;this.error=C.NETWORK_ERROR}this.recoverTransport(options);var data=Utils.merge_options({transport:transport,code:transport.lastTransportError.code,reason:transport.lastTransportError.reason},options);this.emit("disconnected",this,data)};UA.prototype.onTransportConnected=function(transport){this.transport=transport;this.transportRecoverAttempts=0;transport.server.status=Transport.C.STATUS_READY;this.logger.log("connection state set to "+Transport.C.STATUS_READY,this);if(this.status===C.STATUS_USER_CLOSED){return}this.status=C.STATUS_READY;this.error=null;this.emit("connected",this,{transport:transport});if(this.dynConfiguration.register){if(this._registrator){this._registrator.onTransportConnected()}else{this._registrator=new Registrator(this,transport);this.register()}}else if(!this._registrator){this._registrator=new Registrator(this,transport)}};UA.prototype.onTransportConnecting=function(transport,attempts){this.emit("connecting",this,{transport:transport,attempts:attempts})};UA.prototype.newTransaction=function(transaction){this.transactions[transaction.type][transaction.id]=transaction;this.emit("newTransaction",this,{transaction:transaction})};UA.prototype.destroyTransaction=function(transaction){delete this.transactions[transaction.type][transaction.id];this.emit("transactionDestroyed",this,{transaction:transaction})};UA.prototype.receiveRequest=function(request){var dialog,session,message,method=request.method;if(request.ruri.user!==this.configuration.uri.user&&request.ruri.user!==this.contact.uri.user){this.logger.warn("Request-URI ("+request.ruri.user+") does not point to us ("+this.configuration.uri.user+")",this);if(request.method!==ExSIP_C.ACK){request.reply_sl(404)}return}if(request.ruri.scheme===ExSIP_C.SIPS){request.reply_sl(416);return}if(Transactions.checkTransaction(this,request)){this.logger.warn("Check Transaction failed",this);return}if(method===ExSIP_C.INVITE){new Transactions.InviteServerTransaction(request,this)}else if(method!==ExSIP_C.ACK&&method!==ExSIP_C.CANCEL){new Transactions.NonInviteServerTransaction(request,this)}if(method===ExSIP_C.OPTIONS){request.reply(200)}else if(method===ExSIP_C.MESSAGE){if(!this.checkEvent("newMessage")||this.listeners("newMessage").length===0){request.reply(405);return}message=new Message(this);message.init_incoming(request)}else if(method===ExSIP_C.INVITE){if(!this.checkEvent("newRTCSession")||this.listeners("newRTCSession").length===0){request.reply(405);return}}if(!request.to_tag){switch(method){case ExSIP_C.INVITE:if(WebRTC.isSupported){this.logger.debug("INVITE received",this);session=new RTCSession(this);session.init_incoming(request)}else{this.logger.warn("INVITE received but WebRTC is not supported",this);request.reply(488)}break;case ExSIP_C.BYE:request.reply(481);break;case ExSIP_C.CANCEL:session=this.findSession(request);if(session){session.receiveRequest(request)}else{this.logger.warn("received CANCEL request for a non existent session",this)}break;case ExSIP_C.ACK:break;default:request.reply(405);break}}else{dialog=this.findDialog(request);if(dialog){dialog.receiveRequest(request)}else if(method===ExSIP_C.NOTIFY){session=this.findSession(request);if(session){this.logger.log("received NOTIFY request for session : "+session.id,this);session.receiveRequest(request)}else{this.logger.warn("received NOTIFY request for a non existent session",this);this.logger.log("request : "+(request.call_id+"-"+request.from_tag+"-"+request.to_tag),this);this.logger.log("sessions : "+Object.keys(this.sessions),this);request.reply(481,"Subscription does not exist")}}else{if(method!==ExSIP_C.ACK){request.reply(481)}}}};UA.prototype.findSession=function(request){var sessionIDa=request.call_id+request.from_tag,sessionA=this.sessions[sessionIDa],sessionIDb=request.call_id+request.to_tag,sessionB=this.sessions[sessionIDb];if(sessionA){return sessionA}else if(sessionB){return sessionB}else{return null}};UA.prototype.findDialog=function(request){var id=request.call_id+request.from_tag+request.to_tag,dialog=this.dialogs[id];if(dialog){return dialog}else{id=request.call_id+request.to_tag+request.from_tag;dialog=this.dialogs[id];if(dialog){return dialog}else{return null}}};UA.prototype.getNextWsServer=function(options){options=options||{};if(options.force&&this.usedServers.length>=this.configuration.ws_servers.length){this.usedServers=[]}var candidates=[];var totalWeight=0;for(var i=0;i<this.configuration.ws_servers.length;i++){var server=this.configuration.ws_servers[i];if(server.status===Transport.C.STATUS_READY&&this.usedServers.indexOf(server)===-1){candidates.push(server);totalWeight+=server.weight||1}}var weightedServers=[];for(var j=0;j<candidates.length;j++){var candidate=candidates[j];for(var k=0;k<(candidate.weight||1);k++){weightedServers.push(candidate)}}var randomNumber=Math.floor(Math.random()*totalWeight);var index=Math.min(randomNumber,weightedServers.length-1);return weightedServers[index]};UA.prototype.closeSessionsOnTransportError=function(){var idx;for(idx in this.sessions){this.sessions[idx].onTransportError()}this._registrator.onTransportClosed()};UA.prototype.loadConfig=function(configuration){var parameter,value,checked_value,hostport_params,registrar_server,settings={via_host:Utils.createRandomToken(12)+".invalid",password:null,register_expires:600,register:true,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,use_preloaded_route:false,no_answer_timeout:60,stun_servers:["stun:stun.l.google.com:19302"],turn_servers:[],trace_sip:false,hack_via_tcp:false,hack_via_ws:false,hack_ip_in_contact:false,enable_datachannel:false,enable_ims:false,p_asserted_identity:null,node_ws_options:{}};for(parameter in UA.configuration_check.mandatory){if(!configuration.hasOwnProperty(parameter)){throw new Exceptions.ConfigurationError(parameter)}else{value=configuration[parameter];checked_value=UA.configuration_check.mandatory[parameter].call(this,value);if(checked_value!==undefined){settings[parameter]=checked_value}else{throw new Exceptions.ConfigurationError(parameter,value)}}}for(parameter in UA.configuration_check.optional){if(configuration.hasOwnProperty(parameter)){value=configuration[parameter];if(Utils.isEmpty(value)){continue}checked_value=UA.configuration_check.optional[parameter].call(this,value);if(checked_value!==undefined){settings[parameter]=checked_value}else{throw new Exceptions.ConfigurationError(parameter,value)}}}if(settings.connection_recovery_max_interval<settings.connection_recovery_min_interval){throw new Exceptions.ConfigurationError("connection_recovery_max_interval",settings.connection_recovery_max_interval)}if(settings.display_name===0){settings.display_name="0"}if(!settings.instance_id){settings.instance_id=Utils.newUUID()}settings.exsip_id=Utils.createRandomToken(5);hostport_params=settings.uri.clone();hostport_params.user=null;settings.hostport_params=hostport_params.toString().replace(/^sip:/i,"");if(!settings.authorization_user){settings.authorization_user=settings.uri.user
}if(!settings.registrar_server){registrar_server=settings.uri.clone();registrar_server.user=null;settings.registrar_server=registrar_server}settings.no_answer_timeout=settings.no_answer_timeout*1e3;if(settings.hack_ip_in_contact){settings.via_host=Utils.getRandomTestNetIP()}value=configuration.stun_servers;if(value instanceof Array&&value.length===0){settings.stun_servers=[]}this.contact={pub_gruu:null,temp_gruu:null,uri:new URI("sip",Utils.createRandomToken(8),settings.via_host,null,{transport:"ws"}),toString:function(options){options=options||{};var anonymous=options.anonymous||null,outbound=options.outbound||null,contact="<";if(anonymous){contact+=this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws"}else{contact+=this.pub_gruu||this.uri.toString()}if(outbound&&(anonymous?!this.temp_gruu:!this.pub_gruu)){contact+=";ob"}contact+=">";return contact}};for(parameter in settings){UA.configuration_skeleton[parameter].value=settings[parameter]}Object.defineProperties(this.configuration,UA.configuration_skeleton);for(parameter in settings){UA.configuration_skeleton[parameter].value=""}this.logger.debug("configuration parameters after validation:");for(parameter in settings){switch(parameter){case"uri":case"registrar_server":this.logger.debug("· "+parameter+": "+settings[parameter]);break;case"password":this.logger.debug("· "+parameter+": "+"NOT SHOWN");break;default:this.logger.debug("· "+parameter+": "+JSON.stringify(settings[parameter]))}}return};UA.prototype.retry=function(nextRetry,server,callback){var self=this;var retryCallback=function(){var transport=new Transport(self,server);if(callback){callback(transport)}};if(nextRetry===0){retryCallback()}else{setTimeout(retryCallback,nextRetry*1e3)}};UA.prototype.recoverTransport=function(options){var idx,length,k,nextRetry,count,server;options=options||{};count=this.transportRecoverAttempts;length=this.configuration.ws_servers.length;for(idx=0;idx<length;idx++){this.configuration.ws_servers[idx].status=Transport.C.STATUS_READY}server=this.getNextWsServer();if(options.code===503&&!server){delete options.retryAfter;this.logger.log("non-failover on 503 error - skipping recoverTransport",this);return}var maxTransportRecoveryAttempts=this.configuration.max_transport_recovery_attempts;if(typeof maxTransportRecoveryAttempts!=="undefined"&&count>=parseInt(maxTransportRecoveryAttempts,10)){delete options.retryAfter;this.logger.log("recover attempts "+count+" exceed max transport recovery attempts "+maxTransportRecoveryAttempts+" - skipping recoverTransport");return}if(server){this.logger.log("failover - new connection attempt with "+server.ws_uri);this.retry(0,server,options.retryCallback);return}if(options.retryAfter){nextRetry=options.retryAfter}else{k=Math.floor(Math.random()*Math.pow(2,count)+1);nextRetry=k*this.configuration.connection_recovery_min_interval;if(nextRetry>this.configuration.connection_recovery_max_interval){this.logger.log("time for next connection attempt exceeds connection_recovery_max_interval, resetting counter",this);nextRetry=this.configuration.connection_recovery_min_interval;count=0}}server=this.getNextWsServer({force:true});this.transportRecoverAttempts=count+1;this.logger.log("resetting ws server list - next connection attempt in "+nextRetry+" seconds to "+server.ws_uri+" : "+this.transportRecoverAttempts);this.retry(nextRetry,server,options.retryCallback)};UA.configuration_skeleton=function(){var idx,parameter,skeleton={},parameters=["exsip_id","ws_server_max_reconnection","ws_server_reconnection_timeout","hostport_params","uri","ws_servers","authorization_user","connection_recovery_max_interval","connection_recovery_min_interval","max_transport_recovery_attempts","display_name","hack_via_tcp","hack_via_ws","hack_ip_in_contact","instance_id","no_answer_timeout","node_ws_options","password","register_expires","registrar_server","stun_servers","trace_sip","turn_servers","use_preloaded_route","enable_datachannel","enable_ims","p_asserted_identity","via_core_value","via_host"];for(idx in parameters){parameter=parameters[idx];skeleton[parameter]={value:"",writable:false,configurable:false}}skeleton.register={value:"",writable:true,configurable:false};return skeleton}();UA.configuration_check={mandatory:{uri:function(uri){var parsed;if(!/^sip:/i.test(uri)){uri=ExSIP_C.SIP+":"+uri}parsed=URI.parse(uri);if(!parsed){return}else if(!parsed.user){return}else{return parsed}},ws_servers:function(ws_servers){var idx,length,url;if(typeof ws_servers==="string"){ws_servers=[{ws_uri:ws_servers}]}else if(ws_servers instanceof Array){length=ws_servers.length;for(idx=0;idx<length;idx++){if(typeof ws_servers[idx]==="string"){ws_servers[idx]={ws_uri:ws_servers[idx]}}}}else{return}if(ws_servers.length===0){return false}length=ws_servers.length;for(idx=0;idx<length;idx++){if(!ws_servers[idx].ws_uri){this.logger.error('missing "ws_uri" attribute in ws_servers parameter');return}if(ws_servers[idx].weight&&!Number(ws_servers[idx].weight)){this.logger.error('"weight" attribute in ws_servers parameter must be a Number');return}url=Grammar.parse(ws_servers[idx].ws_uri,"absoluteURI");if(url===-1){this.logger.error('invalid "ws_uri" attribute in ws_servers parameter: '+ws_servers[idx].ws_uri);return}else if(url.scheme!=="wss"&&url.scheme!=="ws"){this.logger.error("invalid URI scheme in ws_servers parameter: "+url.scheme);return}else{ws_servers[idx].sip_uri="<sip:"+url.host+(url.port?":"+url.port:"")+";transport=ws;lr>";if(!ws_servers[idx].weight){ws_servers[idx].weight=0}ws_servers[idx].status=0;ws_servers[idx].scheme=url.scheme.toUpperCase()}}return ws_servers}},optional:{authorization_user:function(authorization_user){if(Grammar.parse('"'+authorization_user+'"',"quoted_string")===-1){return}else{return authorization_user}},connection_recovery_max_interval:function(connection_recovery_max_interval){var value;if(Utils.isDecimal(connection_recovery_max_interval)){value=Number(connection_recovery_max_interval);if(value>0){return value}}},connection_recovery_min_interval:function(connection_recovery_min_interval){var value;if(Utils.isDecimal(connection_recovery_min_interval)){value=Number(connection_recovery_min_interval);if(value>=0){return value}}},display_name:function(display_name){if(Grammar.parse('"'+display_name+'"',"display_name")===-1){return}else{return display_name}},hack_via_tcp:function(hack_via_tcp){if(typeof hack_via_tcp==="boolean"){return hack_via_tcp}},hack_via_ws:function(hack_via_ws){if(typeof hack_via_ws==="boolean"){return hack_via_ws}},hack_ip_in_contact:function(hack_ip_in_contact){if(typeof hack_ip_in_contact==="boolean"){return hack_ip_in_contact}},enable_ims:function(enable_ims){if(typeof enable_ims==="boolean"){return enable_ims}},ws_server_reconnection_timeout:function(ws_server_reconnection_timeout){var value;if(Utils.isDecimal(ws_server_reconnection_timeout)){value=Number(ws_server_reconnection_timeout);if(value>=0){return value}}},max_transport_recovery_attempts:function(max_transport_recovery_attempts){var value;if(Utils.isDecimal(max_transport_recovery_attempts)){value=Number(max_transport_recovery_attempts);if(value>=0){return value}}},p_asserted_identity:function(p_asserted_identity){return String(p_asserted_identity)},enable_datachannel:function(enable_datachannel){if(typeof enable_datachannel==="boolean"){return enable_datachannel}},instance_id:function(instance_id){if(/^uuid:/i.test(instance_id)){instance_id=instance_id.substr(5)}if(Grammar.parse(instance_id,"uuid")===-1){return}else{return instance_id}},no_answer_timeout:function(no_answer_timeout){var value;if(Utils.isDecimal(no_answer_timeout)){value=Number(no_answer_timeout);if(value>0){return value}}},node_ws_options:function(node_ws_options){return typeof node_ws_options==="object"?node_ws_options:{}},password:function(password){return String(password)},register:function(register){if(typeof register==="boolean"){return register}},register_expires:function(register_expires){var value;if(Utils.isDecimal(register_expires)){value=Number(register_expires);if(value>0){return value}}},registrar_server:function(registrar_server){var parsed;if(!/^sip:/i.test(registrar_server)){registrar_server=ExSIP_C.SIP+":"+registrar_server}parsed=URI.parse(registrar_server);if(!parsed){return}else if(parsed.user){return}else{return parsed}},stun_servers:function(stun_servers){var idx,length,stun_server;if(typeof stun_servers==="string"){stun_servers=[stun_servers]}else if(!(stun_servers instanceof Array)){return}length=stun_servers.length;for(idx=0;idx<length;idx++){stun_server=stun_servers[idx];if(!/^stuns?:/.test(stun_server)){stun_server="stun:"+stun_server}if(Grammar.parse(stun_server,"stun_URI")===-1){return}else{stun_servers[idx]=stun_server}}return stun_servers},trace_sip:function(trace_sip){if(typeof trace_sip==="boolean"){return trace_sip}},turn_servers:function(turn_servers){var idx,idx2,length,length2,turn_server,url;if(!turn_servers instanceof Array){turn_servers=[turn_servers]}length=turn_servers.length;for(idx=0;idx<length;idx++){turn_server=turn_servers[idx];if(turn_server.server){turn_server.urls=[turn_server.server]}if(turn_server.password){turn_server.credential=[turn_server.password]}if(!turn_server.urls||!turn_server.username||!turn_server.credential){return}if(!(turn_server.urls instanceof Array)){turn_server.urls=[turn_server.urls]}length2=turn_server.urls.length;for(idx2=0;idx2<length2;idx2++){url=turn_server.urls[idx2];if(!/^turns?:/.test(url)){url="turn:"+url}if(Grammar.parse(url,"turn_URI")===-1){return}}}return turn_servers},use_preloaded_route:function(use_preloaded_route){if(typeof use_preloaded_route==="boolean"){return use_preloaded_route}}}}},{"./Constants":197,"./EventEmitter":201,"./Exceptions":203,"./Grammar":204,"./LoggerFactory":206,"./Message":207,"./RTCSession":210,"./Registrator":214,"./Transactions":218,"./Transport":219,"./URI":221,"./Utils":222,"./WebRTC":223}],221:[function(require,module,exports){module.exports=URI;var ExSIP_C=require("./Constants");var Utils=require("./Utils");var Grammar=require("./Grammar");function URI(scheme,user,host,port,parameters,headers){var param,header;if(!host){throw new TypeError('missing or invalid "host" parameter')}scheme=scheme||ExSIP_C.SIP;this.parameters={};this.headers={};for(param in parameters){this.setParam(param,parameters[param])}for(header in headers){this.setHeader(header,headers[header])}Object.defineProperties(this,{scheme:{get:function(){return scheme},set:function(value){scheme=value.toLowerCase()}},user:{get:function(){return user},set:function(value){user=value}},host:{get:function(){return host},set:function(value){host=value.toLowerCase()}},port:{get:function(){return port},set:function(value){port=value===0?value:parseInt(value,10)||null}}})}URI.prototype={setParam:function(key,value){if(key){this.parameters[key.toLowerCase()]=typeof value==="undefined"||value===null?null:value.toString().toLowerCase()}},getParam:function(key){if(key){return this.parameters[key.toLowerCase()]}},hasParam:function(key){if(key){return this.parameters.hasOwnProperty(key.toLowerCase())&&true||false}},deleteParam:function(parameter){var value;parameter=parameter.toLowerCase();if(this.parameters.hasOwnProperty(parameter)){value=this.parameters[parameter];delete this.parameters[parameter];return value}},clearParams:function(){this.parameters={}},setHeader:function(name,value){this.headers[Utils.headerize(name)]=value instanceof Array?value:[value]},getHeader:function(name){if(name){return this.headers[Utils.headerize(name)]}},hasHeader:function(name){if(name){return this.headers.hasOwnProperty(Utils.headerize(name))&&true||false}},deleteHeader:function(header){var value;header=Utils.headerize(header);if(this.headers.hasOwnProperty(header)){value=this.headers[header];delete this.headers[header];return value}},clearHeaders:function(){this.headers={}},isPhoneNumber:function(){return this.user&&this.user.match(/^\+?\d+$/)!==null},clone:function(){return new URI(this.scheme,this.user,this.host,this.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toString:function(){var header,parameter,idx,uri,headers=[];uri=this.scheme+":";if(this.user){uri+=Utils.escapeUser(this.user)+"@"}uri+=this.host;if(this.port||this.port===0){uri+=":"+this.port}for(parameter in this.parameters){uri+=";"+parameter;if(this.parameters[parameter]!==null){uri+="="+this.parameters[parameter]}}for(header in this.headers){for(idx in this.headers[header]){headers.push(header+"="+this.headers[header][idx])}}if(headers.length>0){uri+="?"+headers.join("&")}return uri},toAor:function(show_port){var aor;aor=this.scheme+":";if(this.user){aor+=Utils.escapeUser(this.user)+"@"}aor+=this.host;if(show_port&&(this.port||this.port===0)){aor+=":"+this.port}return aor}};URI.parse=function(uri){uri=Grammar.parse(uri,"SIP_URI");if(uri!==-1){return uri}else{return undefined}}},{"./Constants":197,"./Grammar":204,"./Utils":222}],222:[function(require,module,exports){var Utils={};module.exports=Utils;var ExSIP_C=require("./Constants");var URI=require("./URI");var Grammar=require("./Grammar");Utils.inArray=function(array,el){for(var i=array.length;i--;){if(array[i]===el){return true}}return false};Utils.isEqArrays=function(arr1,arr2){if(arr1===null&&arr2!==null){return false}if(arr1!==null&&arr2===null){return false}if(arr1===null&&arr2===null){return true}if(arr1.length!==arr2.length){return false}for(var i=arr1.length;i--;){if(!this.inArray(arr2,arr1[i])){return false}}return true};Utils.merge_options=function(obj1,obj2){var obj3={};for(var attrname1 in obj1){obj3[attrname1]=obj1[attrname1]}for(var attrname2 in obj2){obj3[attrname2]=obj2[attrname2]}return obj3};Utils.containsHeader=function(headers,name){for(var i=0;i<headers.length;i++){if(headers[i].indexOf(name)!==-1){return true}}return false};Utils.str_utf8_length=function(string){return unescape(encodeURIComponent(string)).length};Utils.toString=function(object){var seen=[];return JSON.stringify(object,function(key,val){if(typeof val==="object"){if(seen.indexOf(val)>=0){return}seen.push(val)}return val})};Utils.isFunction=function(fn){if(fn!==undefined){return Object.prototype.toString.call(fn)==="[object Function]"?true:false}else{return false}};Utils.isDecimal=function(num){return!isNaN(num)&&parseFloat(num)===parseInt(num,10)};Utils.getHeadersFromQuery=function(query){var headers=[];var queryParts=query.split("&");for(var i=0;i<queryParts.length;i++){var parameters=queryParts[i].split("=");headers.push(parameters[0]+": "+decodeURIComponent(parameters[1]))}return headers};Utils.stripSip=function(address){var match=address.match(/<sip\:(.*)\>/);return match?match[1]:address};Utils.isEmpty=function(value){if(value===null||value===""||value===undefined||value instanceof Array&&value.length===0||typeof value==="number"&&isNaN(value)){return true}};Utils.getAllowedMethods=function(ua){var event,allowed=ExSIP_C.ALLOWED_METHODS.toString();for(event in ExSIP_C.EVENT_METHODS){if(ua.checkEvent(event)&&ua.listeners(event).length>0){allowed+=","+ExSIP_C.EVENT_METHODS[event]}}return allowed};Utils.createRandomToken=function(size,base){var i,r,token="";base=base||32;for(i=0;i<size;i++){r=Math.random()*base|0;token+=r.toString(base)}return token};Utils.newTag=function(){return Utils.createRandomToken(10)};Utils.newUUID=function(){var UUID="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==="x"?r:r&3|8;return v.toString(16)});return UUID};Utils.hostType=function(host){if(!host){return}else{host=Grammar.parse(host,"host");if(host!==-1){return host.host_type}}};Utils.normalizeTarget=function(target,domain){var uri,target_array,target_user,target_domain;if(!target){return}else if(target instanceof URI){return target}else if(typeof target==="string"){target_array=target.split("@");switch(target_array.length){case 1:if(!domain){return}target_user=target;target_domain=domain;break;case 2:target_user=target_array[0];target_domain=target_array[1];break;default:target_user=target_array.slice(0,target_array.length-1).join("@");target_domain=target_array[target_array.length-1]}target_user=target_user.replace(/^(sips?|tel):/i,"");if(/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(target_user)){target_user=target_user.replace(/[\-\.\(\)]/g,"")}target=ExSIP_C.SIP+":"+Utils.escapeUser(target_user)+"@"+target_domain;if(uri=URI.parse(target)){return uri}else{return}}else{return}};Utils.escapeUser=function(user){return encodeURIComponent(decodeURIComponent(user)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")};Utils.headerize=function(string){var exceptions={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},name=string.toLowerCase().replace(/_/g,"-").split("-"),hname="",parts=name.length,part;for(part=0;part<parts;part++){if(part!==0){hname+="-"}hname+=name[part].charAt(0).toUpperCase()+name[part].substring(1)}if(exceptions[hname]){hname=exceptions[hname]}return hname};Utils.sipErrorCause=function(status_code){var cause;for(cause in ExSIP_C.SIP_ERROR_CAUSES){if(ExSIP_C.SIP_ERROR_CAUSES[cause].indexOf(status_code)!==-1){return ExSIP_C.causes[cause]}}return ExSIP_C.causes.SIP_FAILURE_CODE};Utils.getRandomTestNetIP=function(){function getOctet(from,to){return Math.floor(Math.random()*(to-from+1)+from)}return"192.0.2."+getOctet(1,254)};Utils.calculateMD5=function(string){function rotateLeft(lValue,iShiftBits){return lValue<<iShiftBits|lValue>>>32-iShiftBits}function addUnsigned(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=lX&2147483648;lY8=lY&2147483648;lX4=lX&1073741824;lY4=lY&1073741824;lResult=(lX&1073741823)+(lY&1073741823);if(lX4&lY4){return lResult^2147483648^lX8^lY8}if(lX4|lY4){if(lResult&1073741824){return lResult^3221225472^lX8^lY8}else{return lResult^1073741824^lX8^lY8}}else{return lResult^lX8^lY8}}function doF(x,y,z){return x&y|~x&z}function doG(x,y,z){return x&z|y&~z}function doH(x,y,z){return x^y^z}function doI(x,y,z){return y^(x|~z)}function doFF(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(doF(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)}function doGG(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(doG(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)}function doHH(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(doH(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)}function doII(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(doI(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)}function convertToWordArray(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWords_temp1=lMessageLength+8;var lNumberOfWords_temp2=(lNumberOfWords_temp1-lNumberOfWords_temp1%64)/64;var lNumberOfWords=(lNumberOfWords_temp2+1)*16;var lWordArray=new Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|string.charCodeAt(lByteCount)<<lBytePosition;lByteCount++}lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|128<<lBytePosition;lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray}function wordToHex(lValue){var wordToHexValue="",wordToHexValue_temp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=lValue>>>lCount*8&255;wordToHexValue_temp="0"+lByte.toString(16);wordToHexValue=wordToHexValue+wordToHexValue_temp.substr(wordToHexValue_temp.length-2,2)}return wordToHexValue}function utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext}var x=[];var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=utf8Encode(string);x=convertToWordArray(string);a=1732584193;b=4023233417;c=2562383102;d=271733878;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=doFF(a,b,c,d,x[k+0],S11,3614090360);d=doFF(d,a,b,c,x[k+1],S12,3905402710);c=doFF(c,d,a,b,x[k+2],S13,606105819);b=doFF(b,c,d,a,x[k+3],S14,3250441966);a=doFF(a,b,c,d,x[k+4],S11,4118548399);d=doFF(d,a,b,c,x[k+5],S12,1200080426);c=doFF(c,d,a,b,x[k+6],S13,2821735955);b=doFF(b,c,d,a,x[k+7],S14,4249261313);a=doFF(a,b,c,d,x[k+8],S11,1770035416);d=doFF(d,a,b,c,x[k+9],S12,2336552879);c=doFF(c,d,a,b,x[k+10],S13,4294925233);b=doFF(b,c,d,a,x[k+11],S14,2304563134);a=doFF(a,b,c,d,x[k+12],S11,1804603682);d=doFF(d,a,b,c,x[k+13],S12,4254626195);c=doFF(c,d,a,b,x[k+14],S13,2792965006);b=doFF(b,c,d,a,x[k+15],S14,1236535329);a=doGG(a,b,c,d,x[k+1],S21,4129170786);d=doGG(d,a,b,c,x[k+6],S22,3225465664);c=doGG(c,d,a,b,x[k+11],S23,643717713);b=doGG(b,c,d,a,x[k+0],S24,3921069994);a=doGG(a,b,c,d,x[k+5],S21,3593408605);d=doGG(d,a,b,c,x[k+10],S22,38016083);c=doGG(c,d,a,b,x[k+15],S23,3634488961);b=doGG(b,c,d,a,x[k+4],S24,3889429448);a=doGG(a,b,c,d,x[k+9],S21,568446438);d=doGG(d,a,b,c,x[k+14],S22,3275163606);c=doGG(c,d,a,b,x[k+3],S23,4107603335);b=doGG(b,c,d,a,x[k+8],S24,1163531501);a=doGG(a,b,c,d,x[k+13],S21,2850285829);d=doGG(d,a,b,c,x[k+2],S22,4243563512);c=doGG(c,d,a,b,x[k+7],S23,1735328473);b=doGG(b,c,d,a,x[k+12],S24,2368359562);a=doHH(a,b,c,d,x[k+5],S31,4294588738);d=doHH(d,a,b,c,x[k+8],S32,2272392833);c=doHH(c,d,a,b,x[k+11],S33,1839030562);b=doHH(b,c,d,a,x[k+14],S34,4259657740);a=doHH(a,b,c,d,x[k+1],S31,2763975236);d=doHH(d,a,b,c,x[k+4],S32,1272893353);c=doHH(c,d,a,b,x[k+7],S33,4139469664);b=doHH(b,c,d,a,x[k+10],S34,3200236656);a=doHH(a,b,c,d,x[k+13],S31,681279174);d=doHH(d,a,b,c,x[k+0],S32,3936430074);c=doHH(c,d,a,b,x[k+3],S33,3572445317);b=doHH(b,c,d,a,x[k+6],S34,76029189);a=doHH(a,b,c,d,x[k+9],S31,3654602809);d=doHH(d,a,b,c,x[k+12],S32,3873151461);c=doHH(c,d,a,b,x[k+15],S33,530742520);b=doHH(b,c,d,a,x[k+2],S34,3299628645);a=doII(a,b,c,d,x[k+0],S41,4096336452);d=doII(d,a,b,c,x[k+7],S42,1126891415);c=doII(c,d,a,b,x[k+14],S43,2878612391);b=doII(b,c,d,a,x[k+5],S44,4237533241);a=doII(a,b,c,d,x[k+12],S41,1700485571);d=doII(d,a,b,c,x[k+3],S42,2399980690);c=doII(c,d,a,b,x[k+10],S43,4293915773);b=doII(b,c,d,a,x[k+1],S44,2240044497);a=doII(a,b,c,d,x[k+8],S41,1873313359);d=doII(d,a,b,c,x[k+15],S42,4264355552);c=doII(c,d,a,b,x[k+6],S43,2734768916);b=doII(b,c,d,a,x[k+13],S44,1309151649);a=doII(a,b,c,d,x[k+4],S41,4149444226);d=doII(d,a,b,c,x[k+11],S42,3174756917);c=doII(c,d,a,b,x[k+2],S43,718787259);b=doII(b,c,d,a,x[k+9],S44,3951481745);a=addUnsigned(a,AA);b=addUnsigned(b,BB);c=addUnsigned(c,CC);d=addUnsigned(d,DD)}var temp=wordToHex(a)+wordToHex(b)+wordToHex(c)+wordToHex(d);return temp.toLowerCase()}},{"./Constants":197,"./Grammar":204,"./URI":221}],223:[function(require,module,exports){var WebRTC={};module.exports=WebRTC;var ExSIP_C=require("./Constants");var Utils=require("./Utils");if(typeof navigator!=="undefined"&&navigator.webkitGetUserMedia){WebRTC.getUserMedia=navigator.webkitGetUserMedia.bind(navigator)}else if(typeof navigator!=="undefined"&&navigator.mozGetUserMedia){WebRTC.getUserMedia=navigator.mozGetUserMedia.bind(navigator)}else if(typeof navigator!=="undefined"&&navigator.getUserMedia){WebRTC.getUserMedia=navigator.getUserMedia.bind(navigator)}if(typeof webkitRTCPeerConnection!=="undefined"){WebRTC.RTCPeerConnection=webkitRTCPeerConnection}else if(typeof mozRTCPeerConnection!=="undefined"){WebRTC.RTCPeerConnection=mozRTCPeerConnection}else if(typeof RTCPeerConnection!=="undefined"){WebRTC.RTCPeerConnection=RTCPeerConnection}else{console.log("WebRTC.RTCPeerConnection undefined");WebRTC.RTCPeerConnection=function(options,constraints){this.options=options;this.constraints=constraints}}if(typeof RTCIceCandidate!=="undefined"){WebRTC.RTCIceCandidate=RTCIceCandidate}else{console.log("WebRTC.RTCIceCandidate undefined");WebRTC.RTCIceCandidate=function(){}}if(typeof webkitRTCSessionDescription!=="undefined"){WebRTC.RTCSessionDescription=webkitRTCSessionDescription}else if(typeof mozRTCSessionDescription!=="undefined"){WebRTC.RTCSessionDescription=mozRTCSessionDescription}else if(typeof RTCSessionDescription!=="undefined"){WebRTC.RTCSessionDescription=RTCSessionDescription}else{console.log("WebRTC.RTCSessionDescription undefined");WebRTC.RTCSessionDescription=function(options){options=options||{};this.sdp=options.sdp;this.type=options.type}}WebRTC.RTCSessionDescription.prototype.getSdp=function(options){options=options||{};var sdp=this.sdp;if(options.additionalSdp){sdp+=options.additionalSdp}return sdp};WebRTC.RTCSessionDescription.prototype.getUnsupportedMedias=function(){var slideMedias=this.getSlidesMedias();var inactiveApplicationMedias=this.getApplicationMedias("0 RTP/SAVPF");var unsupportedMedias=slideMedias.concat(inactiveApplicationMedias);return unsupportedMedias};WebRTC.RTCSessionDescription.prototype.removeUnsupportedMedia=function(){var unsupportedMedias=this.getUnsupportedMedias();for(var i=0;i<unsupportedMedias.length;i++){this.sdp=this.sdp.replace(unsupportedMedias[i],"");console.warn("removing unsupported media from sdp : "+unsupportedMedias[i])}return unsupportedMedias.join("")};WebRTC.RTCSessionDescription.prototype.getSlidesMedias=function(){var slideMedia=this.getVideoMedias("a=content:slides");return slideMedia};WebRTC.RTCSessionDescription.prototype.getVideoMedias=function(filter){return this.getMedias("video",filter)};WebRTC.RTCSessionDescription.prototype.getApplicationMedias=function(filter){return this.getMedias("application",filter)};WebRTC.RTCSessionDescription.prototype.getMedias=function(type,filter){var regex=new RegExp("(m="+type+"(?:(?!m=)[\\s\\S])*)","mig");var match;var results=[];while((match=regex.exec(this.sdp))!==null){var media=match.pop();if(!filter||media.indexOf(filter)!==-1){results.push(media)}}return results};WebRTC.RTCSessionDescription.prototype.getAudioIcePwd=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=ice-pwd:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideoIcePwd=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=ice-pwd:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioIceUfrag=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=ice-ufrag:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideoIceUfrag=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=ice-ufrag:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getCandidates=function(media){var regex=new RegExp("a=candidate:(.*)","ig");var matches;var result=[];while((matches=regex.exec(media))!==null){result.push(matches[matches.length-1])}return result};WebRTC.RTCSessionDescription.prototype.getAudioCandidates=function(){var audio=this.getAudio();return audio?this.getCandidates(audio):null};WebRTC.RTCSessionDescription.prototype.getVideoCandidates=function(){var video=this.getVideo();return video?this.getCandidates(video):null};WebRTC.RTCSessionDescription.prototype.getConnection=function(){var match=this.sdp.match(/v=(?:(?!m=)[\s\S])*c=(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudio=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideo=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioConnection=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*c=(.*)/im);return match!==null?match[match.length-1]:this.getConnection()};WebRTC.RTCSessionDescription.prototype.getVideoConnection=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*c=(.*)/im);return match!==null?match[match.length-1]:this.getConnection()};WebRTC.RTCSessionDescription.prototype.hasVideo=function(){return this.sdp.match(/m=video/)!==null};WebRTC.RTCSessionDescription.prototype.hasAudio=function(){return this.sdp.match(/m=audio/)!==null};WebRTC.RTCSessionDescription.prototype.videoPort=function(){var match=this.sdp.match(/m=video\s(\d*)\s/);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.audioPort=function(){var match=this.sdp.match(/m=audio\s(\d*)\s/);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioMedia=function(){var match=this.sdp.match(/m=audio\s(.*)/);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideoMedia=function(){var match=this.sdp.match(/m=video\s(.*)/);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioCodecs=function(){var audioMedia=this.getAudioMedia();return this.getCodecs(audioMedia)};WebRTC.RTCSessionDescription.prototype.getVideoCodecs=function(){var videoMedia=this.getVideoMedia();return this.getCodecs(videoMedia)};WebRTC.RTCSessionDescription.prototype.getCodecs=function(media){if(!media){return null}var mediaParts=media.split(" ");return mediaParts.splice(2)};WebRTC.RTCSessionDescription.prototype.getAudioCodecRtpmap=function(codec){var regex=new RegExp("m=audio(?:(?!m=)[\\s\\S])*a=rtpmap:"+codec+"(.*)","mi");var match=this.sdp.match(regex);return match!==null?match[match.length-1].trim():null};WebRTC.RTCSessionDescription.prototype.getVideoCodecRtpmap=function(codec){var regex=new RegExp("m=video(?:(?!m=)[\\s\\S])*a=rtpmap:"+codec+"(.*)","mi");var match=this.sdp.match(regex);return match!==null?match[match.length-1].trim():null};WebRTC.RTCSessionDescription.prototype.getAudioCodecFmtp=function(codec){var regex=new RegExp("m=audio(?:(?!m=)[\\s\\S])*a=fmtp:"+codec+"(.*)","mi");var match=this.sdp.match(regex);return match!==null?match[match.length-1].trim():null};WebRTC.RTCSessionDescription.prototype.getVideoCodecFmtp=function(codec){var regex=new RegExp("m=video(?:(?!m=)[\\s\\S])*a=fmtp:"+codec+"(.*)","mi");var match=this.sdp.match(regex);return match!==null?match[match.length-1].trim():null};WebRTC.RTCSessionDescription.prototype.getAudioFingerprint=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=fingerprint:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideoFingerprint=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=fingerprint:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioRtcp=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=rtcp:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideoRtcp=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=rtcp:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.removeVideoFingerprint=function(){if(this.getVideoFingerprint()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(a=fingerprint:.*\r\n)/im,"$1")}};WebRTC.RTCSessionDescription.prototype.removeAudioFingerprint=function(){if(this.getAudioFingerprint()){this.sdp=this.sdp.replace(/(m=audio(?:(?!m=)[\s\S])*)(a=fingerprint:.*\r\n)/im,"$1")}};WebRTC.RTCSessionDescription.prototype.hasActiveVideo=function(){var videoPort=this.videoPort()||0;var videoConnection=this.getVideoConnection()||"";return this.hasVideo()&&videoPort>0&&videoConnection.indexOf("0.0.0.0")===-1};WebRTC.RTCSessionDescription.prototype.hasActiveAudio=function(){var audioPort=this.audioPort()||0;var audioConnection=this.getAudioConnection()||"";return this.hasAudio()&&audioPort>0&&audioConnection.indexOf("0.0.0.0")===-1};WebRTC.RTCSessionDescription.prototype.getVideoBandwidth=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*b=.*:(.*)/im);
return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.setVideoBandwidth=function(videoBandwidth){if(this.getVideoBandwidth()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(b=.*)/im,"$1b=AS:"+videoBandwidth)}else{this.sdp=this.sdp.replace(/(m=video.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\nb=AS:"+videoBandwidth)}};WebRTC.RTCSessionDescription.prototype.setVideoMode=function(mode){if(this.getVideoMode()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(a=(sendrecv|sendonly|recvonly|inactive))/im,"$1a="+mode)}else{this.sdp=this.sdp.replace(/(m=video.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\na="+mode)}};WebRTC.RTCSessionDescription.prototype.setVideoPort=function(port){this.sdp=this.sdp.replace(/(m=video\s)(\d*)(\s)/i,"$1"+port+"$3")};WebRTC.RTCSessionDescription.prototype.getVideoMode=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=(sendrecv|sendonly|recvonly|inactive)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.setAudioMode=function(mode){if(this.getAudioMode()){this.sdp=this.sdp.replace(/(m=audio(?:(?!m=)[\s\S])*)(a=(sendrecv|sendonly|recvonly|inactive))/im,"$1a="+mode)}else{this.sdp=this.sdp.replace(/(m=audio.*(:?(?!m=)[\s\S])*(c=IN\s+IP4.*)?)/,"$1\r\na="+mode)}};WebRTC.RTCSessionDescription.prototype.setAudioPort=function(port){this.sdp=this.sdp.replace(/(m=audio\s)(\d*)(\s)/i,"$1"+port+"$3")};WebRTC.RTCSessionDescription.prototype.setAudioConnection=function(audioConnection){if(this.getAudioConnection()){this.sdp=this.sdp.replace(/(m=audio(?:(?!m=)[\s\S])*)(c=.*)/im,"$1c="+audioConnection)}else{this.sdp=this.sdp.replace(/(m=audio.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\nc="+audioConnection)}};WebRTC.RTCSessionDescription.prototype.setVideoConnection=function(videoConnection){if(this.getVideoConnection()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(c=.*)/im,"$1c="+videoConnection)}else{this.sdp=this.sdp.replace(/(m=video.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\nc="+videoConnection)}};WebRTC.RTCSessionDescription.prototype.setAudioRtcp=function(audioRtcp){if(this.getAudioRtcp()){this.sdp=this.sdp.replace(/(m=audio(?:(?!m=)[\s\S])*)(a=rtcp:.*)/im,"$1a=rtcp:"+audioRtcp)}else{this.sdp=this.sdp.replace(/(m=audio.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\na=rtcp:"+audioRtcp)}};WebRTC.RTCSessionDescription.prototype.setVideoRtcp=function(videoRtcp){if(this.getVideoRtcp()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(a=rtcp:.*)/im,"$1a=rtcp:"+videoRtcp)}else{this.sdp=this.sdp.replace(/(m=video.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\na=rtcp:"+videoRtcp)}};WebRTC.RTCSessionDescription.prototype.getAudioMode=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=(sendrecv|sendonly|recvonly|inactive)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.isActive=function(){if(this.hasAudio()&&this.audioPort()!=="0"&&this.getAudioMode()!==ExSIP_C.INACTIVE){return true}if(this.hasVideo()&&this.videoPort()!=="0"&&this.getVideoMode()!==ExSIP_C.INACTIVE){return true}return false};WebRTC.RTCSessionDescription.prototype.mediaChanges=function(otherSdp){var mediaChanges=[];if(this.hasAudio()!==otherSdp.hasAudio()){mediaChanges.push("audio has changed")}if(this.hasVideo()!==otherSdp.hasVideo()){mediaChanges.push("video has changed")}if(this.audioPort()!==otherSdp.audioPort()){mediaChanges.push("audio port has changed : "+this.audioPort()+" - "+otherSdp.audioPort())}if(this.videoPort()!==otherSdp.videoPort()){mediaChanges.push("video port has changed : "+this.videoPort()+" - "+otherSdp.videoPort())}if(this.getAudioConnection()!==otherSdp.getAudioConnection()){mediaChanges.push("audio connection has changed : "+this.getAudioConnection()+" - "+otherSdp.getAudioConnection())}if(this.getVideoConnection()!==otherSdp.getVideoConnection()){mediaChanges.push("video connection has changed : "+this.getVideoConnection()+" - "+otherSdp.getVideoConnection())}var audioCodecs=this.getAudioCodecs();if(!Utils.isEqArrays(audioCodecs,otherSdp.getAudioCodecs())){mediaChanges.push("audio codecs has changed : "+audioCodecs+" - "+otherSdp.getAudioCodecs())}var videoCodecs=this.getVideoCodecs();if(!Utils.isEqArrays(videoCodecs,otherSdp.getVideoCodecs())){mediaChanges.push("video codecs has changed : "+videoCodecs+" - "+otherSdp.getVideoCodecs())}if(audioCodecs){for(var i=0;i<audioCodecs.length;i++){if(this.getAudioCodecRtpmap(audioCodecs[i])!==otherSdp.getAudioCodecRtpmap(audioCodecs[i])){mediaChanges.push("audio codec rtpmap for "+audioCodecs[i]+" has changed : "+this.getAudioCodecRtpmap(audioCodecs[i])+" - "+otherSdp.getAudioCodecRtpmap(audioCodecs[i]))}}}if(videoCodecs){for(var j=0;j<videoCodecs.length;j++){if(this.getVideoCodecRtpmap(videoCodecs[j])!==otherSdp.getVideoCodecRtpmap(videoCodecs[j])){mediaChanges.push("video codec rtpmap for "+videoCodecs[j]+" has changed : "+this.getVideoCodecRtpmap(videoCodecs[j])+" - "+otherSdp.getVideoCodecRtpmap(videoCodecs[j]))}}}return mediaChanges};if(WebRTC.RTCPeerConnection&&WebRTC.RTCPeerConnection.prototype){if(!WebRTC.RTCPeerConnection.prototype.getLocalStreams){WebRTC.RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams};WebRTC.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams}}WebRTC.RTCPeerConnection.prototype.isIceCandidateReady=function(candidate){return candidate}}if(WebRTC.getUserMedia&&WebRTC.RTCPeerConnection&&WebRTC.RTCSessionDescription){WebRTC.isSupported=true}else{WebRTC.isSupported=false}},{"./Constants":197,"./Utils":222}],224:[function(require,module,exports){module.exports=sanityCheck;var ExSIP_C=require("./Constants");var SIPMessage=require("./SIPMessage");var Utils=require("./Utils");var logger,message,ua,transport,requests=[],responses=[],all=[];requests.push(rfc3261_8_2_2_1);requests.push(rfc3261_16_3_4);requests.push(rfc3261_18_3_request);requests.push(rfc3261_8_2_2_2);responses.push(rfc3261_8_1_3_3);responses.push(rfc3261_18_3_response);all.push(minimumHeaders);function sanityCheck(m,u,t){var len,pass;message=m;ua=u;transport=t;logger=ua.getLogger("ExSIP.sanitycheck");len=all.length;while(len--){pass=all[len](message);if(pass===false){return false}}if(message instanceof SIPMessage.IncomingRequest){len=requests.length;while(len--){pass=requests[len](message);if(pass===false){return false}}}else if(message instanceof SIPMessage.IncomingResponse){len=responses.length;while(len--){pass=responses[len](message);if(pass===false){return false}}}return true}function rfc3261_8_2_2_1(){if(message.s("to").uri.scheme!=="sip"){logger.warn("Scheme ("+message.s("to").uri.scheme+") is not sip. Dropping the request",ua);reply(416);return false}}function rfc3261_16_3_4(){if(!message.to_tag){if(message.call_id.substr(0,5)===ua.configuration.exsip_id){logger.warn("Call_id ("+message.call_id+") is same as exsip ("+ua.configuration.exsip_id+"). Dropping the request",ua);reply(482);return false}}}function rfc3261_18_3_request(){var len=Utils.str_utf8_length(message.body),contentLength=message.getHeader("content-length");if(len<contentLength){logger.warn("Message body length ("+len+") is lower than the value in Content-Length header field ("+contentLength+"). Dropping the request",ua);reply(400);return false}}function rfc3261_8_2_2_2(){var tr,idx,fromTag=message.from_tag,call_id=message.call_id,cseq=message.cseq;if(message.to_tag){return}if(message.method===ExSIP_C.INVITE){if(ua.transactions.ist[message.via_branch]){return false}else{for(idx in ua.transactions.ist){tr=ua.transactions.ist[idx];if(tr.request.from_tag===fromTag&&tr.request.call_id===call_id&&tr.request.cseq===cseq){reply(482);return false}}}}else{if(ua.transactions.nist[message.via_branch]){return false}else{for(idx in ua.transactions.nist){tr=ua.transactions.nist[idx];if(tr.request.from_tag===fromTag&&tr.request.call_id===call_id&&tr.request.cseq===cseq){reply(482);return false}}}}}function rfc3261_8_1_3_3(){if(message.getHeaders("via").length>1){logger.warn("More than one Via header field present in the response. Dropping the response");return false}}function rfc3261_18_3_response(){var len=Utils.str_utf8_length(message.body),contentLength=message.getHeader("content-length");if(len<contentLength){logger.warn("Message body length is lower than the value in Content-Length header field. Dropping the response");return false}}function minimumHeaders(){var mandatoryHeaders=["from","to","call_id","cseq","via"],idx=mandatoryHeaders.length;while(idx--){if(!message.hasHeader(mandatoryHeaders[idx])){logger.warn("Missing mandatory header field : "+mandatoryHeaders[idx]+". Dropping the response");return false}}}function reply(status_code){var to,response="SIP/2.0 "+status_code+" "+ExSIP_C.REASON_PHRASE[status_code]+"\r\n",vias=message.getHeaders("via"),length=vias.length,idx=0;for(idx;idx<length;idx++){response+="Via: "+vias[idx]+"\r\n"}to=message.getHeader("To");if(!message.to_tag){to+=";tag="+Utils.newTag()}response+="To: "+to+"\r\n";response+="From: "+message.getHeader("From")+"\r\n";response+="Call-ID: "+message.call_id+"\r\n";response+="CSeq: "+message.cseq+" "+message.method+"\r\n";response+="\r\n";transport.send(response)}},{"./Constants":197,"./SIPMessage":216,"./Utils":222}],225:[function(require,module,exports){var jQuery=require("jquery");(function($,undefined){var uuid=0,runiqueId=/^ui-id-\d+$/;$.ui=$.ui||{};$.extend($.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});$.fn.extend({focus:function(orig){return function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem)}},delay)}):orig.apply(this,arguments)}}($.fn.focus),scrollParent:function(){var scrollParent;if($.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))){scrollParent=this.parents().filter(function(){return/(relative|absolute|fixed)/.test($.css(this,"position"))&&/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0)}else{scrollParent=this.parents().filter(function(){return/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0)}return/fixed/.test(this.css("position"))||!scrollParent.length?$(document):scrollParent},zIndex:function(zIndex){if(zIndex!==undefined){return this.css("zIndex",zIndex)}if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value}}elem=elem.parent()}}return 0},uniqueId:function(){return this.each(function(){if(!this.id){this.id="ui-id-"+ ++uuid}})},removeUniqueId:function(){return this.each(function(){if(runiqueId.test(this.id)){$(this).removeAttr("id")}})}});function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false}img=$("img[usemap=#"+mapName+"]")[0];return!!img&&visible(img)}return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return $.css(this,"visibility")==="hidden"}).length}$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")))},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}});if(!$("<a>").outerWidth(1).jquery){$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;if(border){size-=parseFloat($.css(elem,"border"+this+"Width"))||0}if(margin){size-=parseFloat($.css(elem,"margin"+this))||0}});return size}$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this)}return this.each(function(){$(this).css(type,reduce(this,size)+"px")})};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size)}return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px")})}})}if(!$.fn.addBack){$.fn.addBack=function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}}if($("<a>").data("a-b","a").removeData("a-b").data("a-b")){$.fn.removeData=function(removeData){return function(key){if(arguments.length){return removeData.call(this,$.camelCase(key))}else{return removeData.call(this)}}}($.fn.removeData)}$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());$.support.selectstart="onselectstart"in document.createElement("div");$.fn.extend({disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});$.extend($.ui,{plugin:{add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]])}},call:function(instance,name,args){var i,set=instance.plugins[name];if(!set||!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11){return}for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args)}}}},hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false}var scroll=a&&a==="left"?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true}el[scroll]=1;has=el[scroll]>0;el[scroll]=0;return has}})})(jQuery)},{jquery:230}],226:[function(require,module,exports){var jQuery=require("jquery");require("./core");require("./mouse");require("./widget");(function($,undefined){$.widget("ui.draggable",$.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false,drag:null,start:null,stop:null},_create:function(){if(this.options.helper==="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))){this.element[0].style.position="relative"}if(this.options.addClasses){this.element.addClass("ui-draggable")}if(this.options.disabled){this.element.addClass("ui-draggable-disabled")}this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy()},_mouseCapture:function(event){var o=this.options;if(this.helper||o.disabled||$(event.target).closest(".ui-resizable-handle").length>0){return false}this.handle=this._getHandle(event);if(!this.handle){return false}$(o.iframeFix===true?"iframe":o.iframeFix).each(function(){$("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css($(this).offset()).appendTo("body")});return true},_mouseStart:function(event){var o=this.options;this.helper=this._createHelper(event);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();if($.ui.ddmanager){$.ui.ddmanager.current=this}this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offsetParent=this.helper.offsetParent();this.offsetParentCssPosition=this.offsetParent.css("position");this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};this.offset.scroll=false;$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt);this._setContainment();if(this._trigger("start",event)===false){this._clear();return false}this._cacheHelperProportions();if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event)}this._mouseDrag(event,true);if($.ui.ddmanager){$.ui.ddmanager.dragStart(this,event)}return true},_mouseDrag:function(event,noPropagation){if(this.offsetParentCssPosition==="fixed"){this.offset.parent=this._getParentOffset()}this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger("drag",event,ui)===false){this._mouseUp({});return false}this.position=ui.position}if(!this.options.axis||this.options.axis!=="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!=="x"){this.helper[0].style.top=this.position.top+"px"}if($.ui.ddmanager){$.ui.ddmanager.drag(this,event)}return false},_mouseStop:function(event){var that=this,dropped=false;if($.ui.ddmanager&&!this.options.dropBehaviour){dropped=$.ui.ddmanager.drop(this,event)}if(this.dropped){dropped=this.dropped;this.dropped=false}if(this.options.helper==="original"&&!$.contains(this.element[0].ownerDocument,this.element[0])){return false}if(this.options.revert==="invalid"&&!dropped||this.options.revert==="valid"&&dropped||this.options.revert===true||$.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped)){$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(that._trigger("stop",event)!==false){that._clear()}})}else{if(this._trigger("stop",event)!==false){this._clear()}}return false},_mouseUp:function(event){$("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});if($.ui.ddmanager){$.ui.ddmanager.dragStop(this,event)}return $.ui.mouse.prototype._mouseUp.call(this,event)},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp({})}else{this._clear()}return this},_getHandle:function(event){return this.options.handle?!!$(event.target).closest(this.element.find(this.options.handle)).length:true},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):o.helper==="clone"?this.element.clone().removeAttr("id"):this.element;if(!helper.parents("body").length){helper.appendTo(o.appendTo==="parent"?this.element[0].parentNode:o.appendTo)}if(helper[0]!==this.element[0]&&!/(fixed|absolute)/.test(helper.css("position"))){helper.css("position","absolute")}return helper},_adjustOffsetFromHelper:function(obj){if(typeof obj==="string"){obj=obj.split(" ")}if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0}}if("left"in obj){this.offset.click.left=obj.left+this.margins.left}if("right"in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left}if("top"in obj){this.offset.click.top=obj.top+this.margins.top}if("bottom"in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top}},_getParentOffset:function(){var po=this.offsetParent.offset();if(this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&$.ui.ie){po={top:0,left:0}}return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var over,c,ce,o=this.options;if(!o.containment){this.containment=null;return}if(o.containment==="window"){this.containment=[$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,$(window).scrollLeft()+$(window).width()-this.helperProportions.width-this.margins.left,$(window).scrollTop()+($(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(o.containment==="document"){this.containment=[0,0,$(document).width()-this.helperProportions.width-this.margins.left,($(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(o.containment.constructor===Array){this.containment=o.containment;return}if(o.containment==="parent"){o.containment=this.helper[0].parentNode}c=$(o.containment);ce=c[0];if(!ce){return}over=c.css("overflow")!=="hidden";this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=c},_convertPositionTo:function(d,pos){if(!pos){pos=this.position}var mod=d==="absolute"?1:-1,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent;if(!this.offset.scroll){this.offset.scroll={top:scroll.scrollTop(),left:scroll.scrollLeft()}}return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():this.offset.scroll.top)*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():this.offset.scroll.left)*mod}},_generatePosition:function(event){var containment,co,top,left,o=this.options,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,pageX=event.pageX,pageY=event.pageY;if(!this.offset.scroll){this.offset.scroll={top:scroll.scrollTop(),left:scroll.scrollLeft()}}if(this.originalPosition){if(this.containment){if(this.relative_container){co=this.relative_container.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top]}else{containment=this.containment}if(event.pageX-this.offset.click.left<containment[0]){pageX=containment[0]+this.offset.click.left}if(event.pageY-this.offset.click.top<containment[1]){pageY=containment[1]+this.offset.click.top}if(event.pageX-this.offset.click.left>containment[2]){pageX=containment[2]+this.offset.click.left}if(event.pageY-this.offset.click.top>containment[3]){pageY=containment[3]+this.offset.click.top}}if(o.grid){top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?top-this.offset.click.top>=containment[1]||top-this.offset.click.top>containment[3]?top:top-this.offset.click.top>=containment[1]?top-o.grid[1]:top+o.grid[1]:top;left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?left-this.offset.click.left>=containment[0]||left-this.offset.click.left>containment[2]?left:left-this.offset.click.left>=containment[0]?left-o.grid[0]:left+o.grid[0]:left}}return{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():this.offset.scroll.top),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval){this.helper.remove()}this.helper=null;this.cancelHelperRemoval=false},_trigger:function(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui]);if(type==="drag"){this.positionAbs=this._convertPositionTo("absolute")}return $.Widget.prototype._trigger.call(this,type,event,ui)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui){var inst=$(this).data("ui-draggable"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[];$(o.connectToSortable).each(function(){var sortable=$.data(this,"ui-sortable");if(sortable&&!sortable.options.disabled){inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert});sortable.refreshPositions();sortable._trigger("activate",event,uiSortable)}})},stop:function(event,ui){var inst=$(this).data("ui-draggable"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;inst.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert){this.instance.options.revert=this.shouldRevert}this.instance._mouseStop(event);this.instance.options.helper=this.instance.options._helper;if(inst.options.helper==="original"){this.instance.currentItem.css({top:"auto",left:"auto"})}}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",event,uiSortable)}})},drag:function(event,ui){var inst=$(this).data("ui-draggable"),that=this;$.each(inst.sortables,function(){var innermostIntersecting=false,thisSortable=this;this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){innermostIntersecting=true;$.each(inst.sortables,function(){this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this!==thisSortable&&this.instance._intersectsWith(this.instance.containerCache)&&$.contains(thisSortable.instance.element[0],this.instance.element[0])){innermostIntersecting=false}return innermostIntersecting})}if(innermostIntersecting){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=$(that).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return ui.helper[0]};event.target=this.instance.currentItem[0];this.instance._mouseCapture(event,true);this.instance._mouseStart(event,true,true);this.instance.offset.click.top=inst.offset.click.top;this.instance.offset.click.left=inst.offset.click.left;this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top;inst._trigger("toSortable",event);inst.dropped=this.instance.element;inst.currentItem=inst.element;this.instance.fromOutside=inst}if(this.instance.currentItem){this.instance._mouseDrag(event)}}else{if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",event,this.instance._uiHash(this.instance));this.instance._mouseStop(event,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();if(this.instance.placeholder){this.instance.placeholder.remove()}inst._trigger("fromSortable",event);inst.dropped=false}}})}});$.ui.plugin.add("draggable","cursor",{start:function(){var t=$("body"),o=$(this).data("ui-draggable").options;if(t.css("cursor")){o._cursor=t.css("cursor")}t.css("cursor",o.cursor)},stop:function(){var o=$(this).data("ui-draggable").options;if(o._cursor){$("body").css("cursor",o._cursor)}}});$.ui.plugin.add("draggable","opacity",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("ui-draggable").options;if(t.css("opacity")){o._opacity=t.css("opacity")}t.css("opacity",o.opacity)},stop:function(event,ui){var o=$(this).data("ui-draggable").options;if(o._opacity){$(ui.helper).css("opacity",o._opacity)}}});$.ui.plugin.add("draggable","scroll",{start:function(){var i=$(this).data("ui-draggable");if(i.scrollParent[0]!==document&&i.scrollParent[0].tagName!=="HTML"){i.overflowOffset=i.scrollParent.offset()}},drag:function(event){var i=$(this).data("ui-draggable"),o=i.options,scrolled=false;if(i.scrollParent[0]!==document&&i.scrollParent[0].tagName!=="HTML"){if(!o.axis||o.axis!=="x"){if(i.overflowOffset.top+i.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity){i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed}else if(event.pageY-i.overflowOffset.top<o.scrollSensitivity){i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed}}if(!o.axis||o.axis!=="y"){if(i.overflowOffset.left+i.scrollParent[0].offsetWidth-event.pageX<o.scrollSensitivity){i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed}else if(event.pageX-i.overflowOffset.left<o.scrollSensitivity){i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed}}}else{if(!o.axis||o.axis!=="x"){if(event.pageY-$(document).scrollTop()<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed)}else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed)}}if(!o.axis||o.axis!=="y"){if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed)}else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed)}}}if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(i,event)}}});$.ui.plugin.add("draggable","snap",{start:function(){var i=$(this).data("ui-draggable"),o=i.options;i.snapElements=[];$(o.snap.constructor!==String?o.snap.items||":data(ui-draggable)":o.snap).each(function(){var $t=$(this),$o=$t.offset();if(this!==i.element[0]){i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left})
}})},drag:function(event,ui){var ts,bs,ls,rs,l,r,t,b,i,first,inst=$(this).data("ui-draggable"),o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(i=inst.snapElements.length-1;i>=0;i--){l=inst.snapElements[i].left;r=l+inst.snapElements[i].width;t=inst.snapElements[i].top;b=t+inst.snapElements[i].height;if(x2<l-d||x1>r+d||y2<t-d||y1>b+d||!$.contains(inst.snapElements[i].item.ownerDocument,inst.snapElements[i].item)){if(inst.snapElements[i].snapping){inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item}))}inst.snapElements[i].snapping=false;continue}if(o.snapMode!=="inner"){ts=Math.abs(t-y2)<=d;bs=Math.abs(b-y1)<=d;ls=Math.abs(l-x2)<=d;rs=Math.abs(r-x1)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top}if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top}if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left}if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left}}first=ts||bs||ls||rs;if(o.snapMode!=="outer"){ts=Math.abs(t-y1)<=d;bs=Math.abs(b-y2)<=d;ls=Math.abs(l-x1)<=d;rs=Math.abs(r-x2)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top}if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top}if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left-inst.margins.left}if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left}}if(!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)){inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item}))}inst.snapElements[i].snapping=ts||bs||ls||rs||first}}});$.ui.plugin.add("draggable","stack",{start:function(){var min,o=this.data("ui-draggable").options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0)});if(!group.length){return}min=parseInt($(group[0]).css("zIndex"),10)||0;$(group).each(function(i){$(this).css("zIndex",min+i)});this.css("zIndex",min+group.length)}});$.ui.plugin.add("draggable","zIndex",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("ui-draggable").options;if(t.css("zIndex")){o._zIndex=t.css("zIndex")}t.css("zIndex",o.zIndex)},stop:function(event,ui){var o=$(this).data("ui-draggable").options;if(o._zIndex){$(ui.helper).css("zIndex",o._zIndex)}}})})(jQuery)},{"./core":225,"./mouse":227,"./widget":228,jquery:230}],227:[function(require,module,exports){var jQuery=require("jquery");require("./widget");(function($,undefined){var mouseHandled=false;$(document).mouseup(function(){mouseHandled=false});$.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind("mousedown."+this.widgetName,function(event){return that._mouseDown(event)}).bind("click."+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+".preventClickEvent")){$.removeData(event.target,that.widgetName+".preventClickEvent");event.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)}},_mouseDown:function(event){if(mouseHandled){return}this._mouseStarted&&this._mouseUp(event);this._mouseDownEvent=event;var that=this,btnIsLeft=event.which===1,elIsCancel=typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false;if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(event)!==false;if(!this._mouseStarted){event.preventDefault();return true}}if(true===$.data(event.target,this.widgetName+".preventClickEvent")){$.removeData(event.target,this.widgetName+".preventClickEvent")}this._mouseMoveDelegate=function(event){return that._mouseMove(event)};this._mouseUpDelegate=function(event){return that._mouseUp(event)};$(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true},_mouseMove:function(event){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button){return this._mouseUp(event)}if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault()}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(this._mouseDownEvent,event)!==false;this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)}return!this._mouseStarted},_mouseUp:function(event){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+".preventClickEvent",true)}this._mouseStop(event)}return false},_mouseDistanceMet:function(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}})})(jQuery)},{"./widget":228,jquery:230}],228:[function(require,module,exports){var jQuery=require("jquery");(function($,undefined){var uuid=0,slice=Array.prototype.slice,_cleanData=$.cleanData;$.cleanData=function(elems){for(var i=0,elem;(elem=elems[i])!=null;i++){try{$(elem).triggerHandler("remove")}catch(e){}}_cleanData(elems)};$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget}$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element)}if(arguments.length){this._createWidget(options,element)}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base;basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if(!$.isFunction(value)){proxiedPrototype[prop]=value;return}proxiedPrototype[prop]=function(){var _super=function(){return base.prototype[prop].apply(this,arguments)},_superApply=function(args){return base.prototype[prop].apply(this,args)};return function(){var __super=this._super,__superApply=this._superApply,returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue}}()});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?basePrototype.widgetEventPrefix||name:name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)});delete existingConstructor._childConstructors}else{base._childConstructors.push(constructor)}$.widget.bridge(name,constructor)};$.widget.extend=function(target){var input=slice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value)}else{target[key]=value}}}}return target};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options;if(isMethodCall){this.each(function(){var methodValue,instance=$.data(this,fullName);if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'")}if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance")}methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false}})}else{this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{})._init()}else{$.data(this,fullName,new object(options,this))}})}return returnValue}};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=uuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function(event){if(event.target===element){this.destroy()}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow)}this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(key,value){var options=key,parts,curOption,i;if(arguments.length===0){return $.widget.extend({},this.options)}if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]]}key=parts.pop();if(arguments.length===1){return curOption[key]===undefined?null:curOption[key]}curOption[key]=value}else{if(arguments.length===1){return this.options[key]===undefined?null:this.options[key]}options[key]=value}}this._setOptions(options);return this},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key])}return this},_setOption:function(key,value){this.options[key]=value;if(key==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!value).attr("aria-disabled",value);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;if(typeof suppressDisabledCheck!=="boolean"){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false}if(!handlers){handlers=element;element=this.element;delegateElement=this.widget()}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element)}$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass("ui-state-disabled"))){return}return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments)}if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++}var match=event.match(/^(\w+)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];if(selector){delegateElement.delegate(selector,eventName,handlerProxy)}else{element.bind(eventName,handlerProxy)}})},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.unbind(eventName).undelegate(eventName)},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments)}var instance=this;return setTimeout(handlerProxy,delay||0)},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover")},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus")},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop]}}}this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented())}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options}}var hasOptions,effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options}}hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay)}if(hasOptions&&$.effects&&$.effects.effect[effectName]){element[method](options)}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback)}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0])}next()})}}})})(jQuery)},{jquery:230}],229:[function(require,module,exports){(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else if(typeof exports==="object"){factory(require("jquery"))}else{factory(jQuery)}})(function($){var pluses=/\+/g;function encode(s){return config.raw?s:encodeURIComponent(s)}function decode(s){return config.raw?s:decodeURIComponent(s)}function stringifyCookieValue(value){return encode(config.json?JSON.stringify(value):String(value))}function parseCookieValue(s){if(s.indexOf('"')===0){s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{s=decodeURIComponent(s.replace(pluses," "));return config.json?JSON.parse(s):s}catch(e){}}function read(s,converter){var value=config.raw?s:parseCookieValue(s);return $.isFunction(converter)?converter(value):value}var config=$.cookie=function(key,value,options){if(value!==undefined&&!$.isFunction(value)){options=$.extend({},config.defaults,options);if(typeof options.expires==="number"){var days=options.expires,t=options.expires=new Date;t.setTime(+t+days*864e5)}return document.cookie=[encode(key),"=",stringifyCookieValue(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}var result=key?undefined:{};var cookies=document.cookie?document.cookie.split("; "):[];for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split("=");var name=decode(parts.shift());var cookie=parts.join("=");if(key&&key===name){result=read(cookie,value);break}if(!key&&(cookie=read(cookie))!==undefined){result[name]=cookie}}return result};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)===undefined){return false}$.cookie(key,"",$.extend({},options,{expires:-1}));return!$.cookie(key)}})},{jquery:230}],230:[function(require,module,exports){(function(global,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=global.document?factory(global,true):function(w){if(!w.document){throw new Error("jQuery requires a window with a document")}return factory(w)}}else{factory(global)}})(typeof window!=="undefined"?window:this,function(window,noGlobal){var arr=[];var slice=arr.slice;var concat=arr.concat;var push=arr.push;var indexOf=arr.indexOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;var support={};var document=window.document,version="2.1.3",jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this)},get:function(num){return num!=null?num<0?this[num+this.length]:this[num]:slice.call(this)},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback,args){return jQuery.each(this,callback,args)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:push,sort:arr.sort,splice:arr.splice};jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(i===length){target=this;i--}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target};jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:true,error:function(msg){throw new Error(msg)},noop:function(){},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray,isWindow:function(obj){return obj!=null&&obj===obj.window},isNumeric:function(obj){return!jQuery.isArray(obj)&&obj-parseFloat(obj)+1>=0},isPlainObject:function(obj){if(jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}if(obj.constructor&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}return true},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},type:function(obj){if(obj==null){return obj+""}return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code);if(code){if(code.indexOf("use strict")===1){script=document.createElement("script");script.text=code;document.head.appendChild(script).parentNode.removeChild(script)}else{indirect(code)}}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray){for(;i<length;i++){value=callback.apply(obj[i],args);if(value===false){break}}}else{for(i in obj){value=callback.apply(obj[i],args);if(value===false){break}}}}else{if(isArray){for(;i<length;i++){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}else{for(i in obj){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}}return obj},trim:function(text){return text==null?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArraylike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr)}else{push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){return arr==null?-1:indexOf.call(arr,elem,i)},merge:function(first,second){var len=+second.length,j=0,i=first.length;for(;j<len;j++){first[i++]=second[j]}first.length=i;return first},grep:function(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;for(;i<length;i++){callbackInverse=!callback(elems[i],i);if(callbackInverse!==callbackExpect){matches.push(elems[i])}}return matches},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}return concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},now:Date.now,support:support});jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);if(type==="function"||jQuery.isWindow(obj)){return false}if(obj.nodeType===1&&length){return true}return type==="array"||length===0||typeof length==="number"&&length>0&&length-1 in obj}var Sizzle=function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true}return 0},MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){var i=0,len=list.length;for(;i<len;i++){if(list[i]===elem){return i}}return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|"+".*"+")\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)},unloadHandler=function(){setDocument()};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;results=results||[];nodeType=context.nodeType;if(typeof selector!=="string"||!selector||nodeType!==1&&nodeType!==9&&nodeType!==11){return results}if(!seed&&documentIsHTML){if(nodeType!==11&&(match=rquickExpr.exec(selector))){if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else if((m=match[3])&&support.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType!==1&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if(old=context.getAttribute("id")){nid=old.replace(rescape,"\\$&")}else{context.setAttribute("id",nid)}nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i])}newContext=rsibling.test(selector)&&testContext(context.parentNode)||context;newSelector=groups.join(",")}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(!old){context.removeAttribute("id")}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+" ")>Expr.cacheLength){delete cache[keys.shift()]}return cache[key+" "]=value}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=attrs.length;while(i--){Expr.attrHandle[arr[i]]=handler}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while(cur=cur.nextSibling){if(cur===b){return-1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[j=matchIndexes[i]]){seed[j]=!(matches[j]=seed[j])}}})})}function testContext(context){return context&&typeof context.getElementsByTagName!=="undefined"&&context}support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};setDocument=Sizzle.setDocument=function(node){var hasCompare,parent,doc=node?node.ownerDocument||node:preferredDoc;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=doc.documentElement;parent=doc.defaultView;if(parent&&parent!==parent.top){if(parent.addEventListener){parent.addEventListener("unload",unloadHandler,false)}else if(parent.attachEvent){parent.attachEvent("onunload",unloadHandler)}}documentIsHTML=!isXML(doc);support.attributes=assert(function(div){div.className="i";return!div.getAttribute("className")});support.getElementsByTagName=assert(function(div){div.appendChild(doc.createComment(""));return!div.getElementsByTagName("*").length});support.getElementsByClassName=rnative.test(doc.getElementsByClassName);support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!doc.getElementsByName||!doc.getElementsByName(expando).length});if(support.getById){Expr.find["ID"]=function(id,context){if(typeof context.getElementById!=="undefined"&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{delete Expr.find["ID"];Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!=="undefined"){return context.getElementsByTagName(tag)}else if(support.qsa){return context.querySelectorAll(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while(elem=results[i++]){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if(support.qsa=rnative.test(doc.querySelectorAll)){assert(function(div){docElem.appendChild(div).innerHTML="<a id='"+expando+"'></a>"+"<select id='"+expando+"-\f]' msallowcapture=''>"+"<option selected=''></option></select>";
if(div.querySelectorAll("[msallowcapture^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!div.querySelectorAll("[id~="+expando+"-]").length){rbuggyQSA.push("~=")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}if(!div.querySelectorAll("a#"+expando+"+*").length){rbuggyQSA.push(".#.+[+~]")}});assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("name","D");if(div.querySelectorAll("[name=d]").length){rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?=")}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare}compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare){if(a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return-1}if(b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1}return sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0}return compare&4?-1:1}:function(a,b){if(a===b){hasDuplicate=true;return 0}var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0}else if(aup===bup){return siblingCheck(a,b)}cur=a;while(cur=cur.parentNode){ap.unshift(cur)}cur=b;while(cur=cur.parentNode){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return doc};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++]){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}sortInput=null;return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){while(node=elem[i++]){ret+=getText(node)}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else if(nodeType===3||nodeType===4){return elem.nodeValue}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+(match[7]+match[8]||match[3]==="odd")}else if(match[3]){Sizzle.error(match[0])}return match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null}if(match[3]){match[2]=match[4]||match[5]||""}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!=="undefined"&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while(node=node[dir]){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns){diff=cache[1]}else{while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff]}if(node===elem){break}}}}diff-=last;return diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if(elem=unmatched[i]){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);input[0]=null;return!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){text=text.replace(runescape,funescape);return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang")){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false}}return true},parent:function(elem){return!Expr.pseudos["empty"](elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text")},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters;tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)};function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((oldCache=outerCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return newCache[2]=oldCache[2]}else{outerCache[dir]=newCache;if(newCache[2]=matcher(elem,context,xml)){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if(elem=unmatched[i]){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if(elem=temp[i]){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if(elem=matcherOut[i]){temp.push(matcherIn[i]=elem)}}postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));checkContext=null;return ret}];for(;i<len;i++){if(matcher=Expr.relative[tokens[i].type]){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",outermost),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||.1,len=elems.length;if(outermost){outermostContext=context!==document&&context}for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while(matcher=elementMatchers[j++]){if(matcher(elem,context,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique}}if(bySet){if(elem=!matcher&&elem){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++]){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!match){match=tokenize(selector)}i=match.length;while(i--){cached=matcherFromTokens(match[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));cached.selector=selector}return cached};select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==="function"&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}else if(compiled){context=context.parentNode}selector=selector.slice(tokens.shift().value.length)}i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type]){break}if(find=Expr.find[type]){if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context)){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context);return results};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#"})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}})}if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")===""})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue}})}if(!assert(function(div){return div.getAttribute("disabled")==null})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return elem[name]===true?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}})}return Sizzle}(window);jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;var rneedsContext=jQuery.expr.match.needsContext;var rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/;var risSimple=/^.[^:#\[\.,]*$/;function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return elem===qualifier!==not})}if(typeof qualifier==="string"){if(risSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not)}qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return indexOf.call(qualifier,elem)>=0!==not})}jQuery.filter=function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")"}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))};jQuery.fn.extend({find:function(selector){var i,len=this.length,ret=[],self=this;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true}}}))}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret)}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},is:function(selector){return!!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context){var match,elem;if(!selector){return this}if(typeof selector==="string"){if(selector[0]==="<"&&selector[selector.length-1]===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}else if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}else if(jQuery.isFunction(selector)){return typeof rootjQuery.ready!=="undefined"?rootjQuery.ready(selector):selector(jQuery)}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)};init.prototype=jQuery.fn;rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.extend({dir:function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break}matched.push(elem)}}return matched},sibling:function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n)}}return matched}});jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){var i=0;for(;i<l;i++){if(jQuery.contains(this,targets[i])){return true}}})},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}}}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){if(!elem){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof elem==="string"){return indexOf.call(jQuery(elem),this[0])}return indexOf.call(this,elem.jquery?elem[0]:elem)},add:function(selector,context){return this.pushStack(jQuery.unique(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){while((cur=cur[dir])&&cur.nodeType!==1){}return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return elem.contentDocument||jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until}if(selector&&typeof selector==="string"){matched=jQuery.filter(selector,matched)}if(this.length>1){if(!guaranteedUnique[name]){jQuery.unique(matched)}if(rparentsprev.test(name)){matched.reverse()}}return this.pushStack(matched)}});var rnotwhite=/\S+/g;var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?optionsCache[options]||createOptions(options):jQuery.extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else if(memory){list=[]}else{self.disable()}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"){if(!options.unique||!self.has(arg)){list.push(arg)}}else if(arg&&arg.length&&type!=="string"){add(arg)}})})(arguments);if(firing){firingLength=list.length}else if(memory){firingStart=start;fire(memory)}}return this},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!!(list&&list.length)},empty:function(){list=[];firingLength=0;return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return!list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return!stack},fireWith:function(context,args){if(list&&(!fired||stack)){args=args||[];args=[context,args.slice?args.slice():args];if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)}})});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length!==1||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else if(!--remaining){deferred.resolveWith(contexts,values)}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});var readyList;
jQuery.fn.ready=function(fn){jQuery.ready.promise().done(fn);return this};jQuery.extend({isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.triggerHandler){jQuery(document).triggerHandler("ready");jQuery(document).off("ready")}}});function completed(){document.removeEventListener("DOMContentLoaded",completed,false);window.removeEventListener("load",completed,false);jQuery.ready()}jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready)}else{document.addEventListener("DOMContentLoaded",completed,false);window.addEventListener("load",completed,false)}}return readyList.promise(obj)};jQuery.ready.promise();var access=jQuery.access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){jQuery.access(elems,fn,i,key[i],true,emptyGet,raw)}}else if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<len;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}return chainable?elems:bulk?fn.call(elems):len?fn(elems[0],key):emptyGet};jQuery.acceptData=function(owner){return owner.nodeType===1||owner.nodeType===9||!+owner.nodeType};function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=jQuery.expando+Data.uid++}Data.uid=1;Data.accepts=jQuery.acceptData;Data.prototype={key:function(owner){if(!Data.accepts(owner)){return 0}var descriptor={},unlock=owner[this.expando];if(!unlock){unlock=Data.uid++;try{descriptor[this.expando]={value:unlock};Object.defineProperties(owner,descriptor)}catch(e){descriptor[this.expando]=unlock;jQuery.extend(owner,descriptor)}}if(!this.cache[unlock]){this.cache[unlock]={}}return unlock},set:function(owner,data,value){var prop,unlock=this.key(owner),cache=this.cache[unlock];if(typeof data==="string"){cache[data]=value}else{if(jQuery.isEmptyObject(cache)){jQuery.extend(this.cache[unlock],data)}else{for(prop in data){cache[prop]=data[prop]}}}return cache},get:function(owner,key){var cache=this.cache[this.key(owner)];return key===undefined?cache:cache[key]},access:function(owner,key,value){var stored;if(key===undefined||key&&typeof key==="string"&&value===undefined){stored=this.get(owner,key);return stored!==undefined?stored:this.get(owner,jQuery.camelCase(key))}this.set(owner,key,value);return value!==undefined?value:key},remove:function(owner,key){var i,name,camel,unlock=this.key(owner),cache=this.cache[unlock];if(key===undefined){this.cache[unlock]={}}else{if(jQuery.isArray(key)){name=key.concat(key.map(jQuery.camelCase))}else{camel=jQuery.camelCase(key);if(key in cache){name=[key,camel]}else{name=camel;name=name in cache?[name]:name.match(rnotwhite)||[]}}i=name.length;while(i--){delete cache[name[i]]}}},hasData:function(owner){return!jQuery.isEmptyObject(this.cache[owner[this.expando]]||{})},discard:function(owner){if(owner[this.expando]){delete this.cache[owner[this.expando]]}}};var data_priv=new Data;var data_user=new Data;var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/([A-Z])/g;function dataAttr(elem,key,data){var name;if(data===undefined&&elem.nodeType===1){name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}data_user.set(elem,key,data)}else{data=undefined}}return data}jQuery.extend({hasData:function(elem){return data_user.hasData(elem)||data_priv.hasData(elem)},data:function(elem,name,data){return data_user.access(elem,name,data)},removeData:function(elem,name){data_user.remove(elem,name)},_data:function(elem,name,data){return data_priv.access(elem,name,data)},_removeData:function(elem,name){data_priv.remove(elem,name)}});jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(key===undefined){if(this.length){data=data_user.get(elem);if(elem.nodeType===1&&!data_priv.get(elem,"hasDataAttrs")){i=attrs.length;while(i--){if(attrs[i]){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name])}}}data_priv.set(elem,"hasDataAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){data_user.set(this,key)})}return access(this,function(value){var data,camelKey=jQuery.camelCase(key);if(elem&&value===undefined){data=data_user.get(elem,key);if(data!==undefined){return data}data=data_user.get(elem,camelKey);if(data!==undefined){return data}data=dataAttr(elem,camelKey,undefined);if(data!==undefined){return data}return}this.each(function(){var data=data_user.get(this,camelKey);data_user.set(this,camelKey,value);if(key.indexOf("-")!==-1&&data!==undefined){data_user.set(this,key,value)}})},null,value,arguments.length>1,null,true)},removeData:function(key){return this.each(function(){data_user.remove(this,key)})}});jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=data_priv.get(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=data_priv.access(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return data_priv.get(elem,key)||data_priv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(elem,[type+"queue",key])})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!--count){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=data_priv.get(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;var cssExpand=["Top","Right","Bottom","Left"];var isHidden=function(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)};var rcheckableType=/^(?:checkbox|radio)$/i;(function(){var fragment=document.createDocumentFragment(),div=fragment.appendChild(document.createElement("div")),input=document.createElement("input");input.setAttribute("type","radio");input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);support.checkClone=div.cloneNode(true).cloneNode(true).lastChild.checked;div.innerHTML="<textarea>x</textarea>";support.noCloneChecked=!!div.cloneNode(true).lastChild.defaultValue})();var strundefined=typeof undefined;support.focusinBubbles="onfocusin"in window;var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.get(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!==strundefined&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):undefined}}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.hasData(elem)&&data_priv.get(elem);if(!elemData||!(events=elemData.events)){return}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;data_priv.remove(elem,"events")}},trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(data_priv.get(cur,"events")||{})[event.type]&&data_priv.get(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&handle.apply&&jQuery.acceptData(cur)){event.result=handle.apply(cur,data);if(event.result===false){event.preventDefault()}}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&jQuery.acceptData(elem)){if(ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=slice.call(arguments),handlers=(data_priv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.namespace_re||event.namespace_re.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||event.type!=="click")){for(;cur!==this;cur=cur.parentNode||this){if(cur.disabled!==true||event.type!=="click"){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length}if(matches[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches})}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)})}return handlerQueue},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.which&&button!==undefined){event.which=button&1?1:button&2?3:button&4?2:0}return event}},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop]}if(!event.target){event.target=document}if(event.target.nodeType===3){event.target=event.target.parentNode}return fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input")){this.click();return false}},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){if(event.result!==undefined&&event.originalEvent){event.originalEvent.returnValue=event.result}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.removeEvent=function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.defaultPrevented===undefined&&src.returnValue===false?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(e&&e.preventDefault){e.preventDefault()}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e&&e.stopPropagation){e.stopPropagation()}},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue;if(e&&e.stopImmediatePropagation){e.stopImmediatePropagation()}this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||related!==target&&!jQuery.contains(target,related)){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=data_priv.access(doc,fix);if(!attaches){doc.addEventListener(orig,handler,true)}data_priv.access(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=data_priv.access(doc,fix)-1;if(!attaches){doc.removeEventListener(orig,handler,true);data_priv.remove(doc,fix)}else{data_priv.access(doc,fix,attaches)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}if(fn===false){fn=returnFalse}else if(!fn){return this}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType!==11?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type=(elem.getAttribute("type")!==null)+"/"+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1]}else{elem.removeAttribute("type")}return elem}function setGlobalEval(elems,refElements){var i=0,l=elems.length;for(;i<l;i++){data_priv.set(elems[i],"globalEval",!refElements||data_priv.get(refElements[i],"globalEval"))}}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(dest.nodeType!==1){return}if(data_priv.hasData(src)){pdataOld=data_priv.access(src);pdataCur=data_priv.set(dest,pdataOld);events=pdataOld.events;if(events){delete pdataCur.handle;pdataCur.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}}if(data_user.hasData(src)){udataOld=data_user.access(src);udataCur=jQuery.extend({},udataOld);data_user.set(dest,udataCur)}}function getAll(context,tag){var ret=context.getElementsByTagName?context.getElementsByTagName(tag||"*"):context.querySelectorAll?context.querySelectorAll(tag||"*"):[];return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();if(nodeName==="input"&&rcheckableType.test(src.type)){dest.checked=src.checked}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(true),inPage=jQuery.contains(elem.ownerDocument,elem);if(!support.noCloneChecked&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0,l=srcElements.length;i<l;i++){fixInput(srcElements[i],destElements[i])}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0,l=srcElements.length;i<l;i++){cloneCopyEvent(srcElements[i],destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"))}return clone},buildFragment:function(elems,context,scripts,selection){var elem,tmp,tag,wrap,contains,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||fragment.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild}jQuery.merge(nodes,tmp.childNodes);tmp=fragment.firstChild;tmp.textContent=""}}}fragment.textContent="";i=0;while(elem=nodes[i++]){if(selection&&jQuery.inArray(elem,selection)!==-1){continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(fragment.appendChild(elem),"script");if(contains){setGlobalEval(tmp)}if(scripts){j=0;while(elem=tmp[j++]){if(rscriptType.test(elem.type||"")){scripts.push(elem)}}}}return fragment},cleanData:function(elems){var data,elem,type,key,special=jQuery.event.special,i=0;for(;(elem=elems[i])!==undefined;i++){if(jQuery.acceptData(elem)){key=elem[data_priv.expando];if(key&&(data=data_priv.cache[key])){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}if(data_priv.cache[key]){delete data_priv.cache[key]}}}delete data_user.cache[elem[data_user.expando]]}}});jQuery.fn.extend({text:function(value){return access(this,function(value){return value===undefined?jQuery.text(this):this.empty().each(function(){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){this.textContent=value}})},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},remove:function(selector,keepData){var elem,elems=selector?jQuery.filter(selector,this):this,i=0;for(;(elem=elems[i])!=null;i++){if(!keepData&&elem.nodeType===1){jQuery.cleanData(getAll(elem))}if(elem.parentNode){if(keepData&&jQuery.contains(elem.ownerDocument,elem)){setGlobalEval(getAll(elem,"script"))}elem.parentNode.removeChild(elem)}}return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.textContent=""}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&elem.nodeType===1){return elem.innerHTML}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var arg=arguments[0];this.domManip(arguments,function(elem){arg=this.parentNode;jQuery.cleanData(getAll(this));if(arg){arg.replaceChild(elem,this)}});return arg&&(arg.length||arg.nodeType)?this:this.remove()},detach:function(selector){return this.remove(selector,true)},domManip:function(args,callback){args=concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||l>1&&typeof value==="string"&&!support.checkClone&&rchecked.test(value)){return this.each(function(index){var self=set.eq(index);if(isFunction){args[0]=value.call(this,index,self.html())}self.domManip(args,callback)})}if(l){fragment=jQuery.buildFragment(args,this[0].ownerDocument,false,this);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"))}}callback.call(this[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!data_priv.access(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){if(jQuery._evalUrl){jQuery._evalUrl(node.src)}}else{jQuery.globalEval(node.textContent.replace(rcleanScript,""))}}}}}}return this}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);push.apply(ret,elems.get())}return this.pushStack(ret)}});var iframe,elemdisplay={};function actualDisplay(name,doc){var style,elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=window.getDefaultComputedStyle&&(style=window.getDefaultComputedStyle(elem[0]))?style.display:jQuery.css(elem[0],"display");elem.detach();return display}function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement);doc=iframe[0].contentDocument;doc.write();doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}var rmargin=/^margin/;var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i");var getStyles=function(elem){if(elem.ownerDocument.defaultView.opener){return elem.ownerDocument.defaultView.getComputedStyle(elem,null)}return window.getComputedStyle(elem,null)};function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;computed=computed||getStyles(elem);if(computed){ret=computed.getPropertyValue(name)||computed[name]}if(computed){if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret!==undefined?ret+"":ret}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(conditionFn()){delete this.get;return}return(this.get=hookFn).apply(this,arguments)}}}(function(){var pixelPositionVal,boxSizingReliableVal,docElem=document.documentElement,container=document.createElement("div"),div=document.createElement("div");
if(!div.style){return}div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";container.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;"+"position:absolute";container.appendChild(div);function computePixelPositionAndBoxSizingReliable(){div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;"+"box-sizing:border-box;display:block;margin-top:1%;top:1%;"+"border:1px;padding:1px;width:4px;position:absolute";div.innerHTML="";docElem.appendChild(container);var divStyle=window.getComputedStyle(div,null);pixelPositionVal=divStyle.top!=="1%";boxSizingReliableVal=divStyle.width==="4px";docElem.removeChild(container)}if(window.getComputedStyle){jQuery.extend(support,{pixelPosition:function(){computePixelPositionAndBoxSizingReliable();return pixelPositionVal},boxSizingReliable:function(){if(boxSizingReliableVal==null){computePixelPositionAndBoxSizingReliable()}return boxSizingReliableVal},reliableMarginRight:function(){var ret,marginDiv=div.appendChild(document.createElement("div"));marginDiv.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;"+"box-sizing:content-box;display:block;margin:0;border:0;padding:0";marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";docElem.appendChild(container);ret=!parseFloat(window.getComputedStyle(marginDiv,null).marginRight);docElem.removeChild(container);div.removeChild(marginDiv);return ret}})}})();jQuery.swap=function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret};var rdisplayswap=/^(none|table(?!-c[ea]).+)/,rnumsplit=new RegExp("^("+pnum+")(.*)$","i"),rrelNum=new RegExp("^([+-])=("+pnum+")","i"),cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"];function vendorPropName(style,name){if(name in style){return name}var capName=name[0].toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles)}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]);val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=data_priv.get(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=data_priv.access(elem,"olddisplay",defaultDisplay(elem.nodeName))}}else{hidden=isHidden(elem);if(display!=="none"||!hidden){data_priv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{columnCount:true,fillOpacity:true,flexGrow:true,flexShrink:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":"cssFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number"}if(value==null||value!==value){return}if(type==="number"&&!jQuery.cssNumber[origName]){value+="px"}if(!support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit"}if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){style[name]=value}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===""||extra){num=parseFloat(val);return extra===true||jQuery.isNumeric(num)?num||0:val}return val}});jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return rdisplayswap.test(jQuery.css(elem,"display"))&&elem.offsetWidth===0?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles):0)}}});jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){if(computed){return jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}});jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide()}return this.each(function(){if(isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,"");return!result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}};jQuery.fx=Tween.prototype.init;jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||unit!=="px"&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3];parts=parts||[];start=+target||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit)}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}if(parts){start=tween.start=+start||+target||0;tween.unit=unit;tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]}return tween}]};function createFxNow(){setTimeout(function(){fxNow=undefined});return fxNow=jQuery.now()}function genFx(type,includeWidth){var which,i=0,attrs={height:type};includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}function createTween(value,prop,animation){var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(tween=collection[index].call(animation,prop,value)){return tween}}}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,checkDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=data_priv.get(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];display=jQuery.css(elem,"display");checkDisplay=display==="none"?data_priv.get(elem,"olddisplay")||defaultDisplay(elem.nodeName):display;if(checkDisplay==="inline"&&jQuery.css(elem,"float")==="none"){style.display="inline-block"}}if(opts.overflow){style.overflow="hidden";anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true}else{continue}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}else{display=undefined}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden"in dataShow){hidden=dataShow.hidden}}else{dataShow=data_priv.access(elem,"fxshow",{})}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;data_priv.remove(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}else if((display==="none"?defaultDisplay(elem.nodeName):display)==="inline"){style.display=display}}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.split(" ")}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback)}else{animationPrefilters.push(callback)}}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||data_priv.get(this,"finish")){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=data_priv.get(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||"fx"}return this.each(function(){var index,data=data_priv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.timers=[];jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){jQuery.timers.push(timer);if(timer()){jQuery.fx.start()}else{jQuery.timers.pop()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fn.delay=function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})};(function(){var input=document.createElement("input"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));input.type="checkbox";support.checkOn=input.value!=="";support.optSelected=opt.selected;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement("input");input.value="t";input.type="radio";support.radioValue=input.value==="t"})();var nodeHook,boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}});jQuery.extend({attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute===strundefined){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name)}else if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,value+"");return value}}else if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&elem.nodeType===1){while(name=attrNames[i++]){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){elem[propName]=false}elem.removeAttribute(name)}}},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else{elem.setAttribute(name,name)}return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle;if(!isXML){handle=attrHandle[name];attrHandle[name]=ret;ret=getter(elem,name,isXML)!=null?name.toLowerCase():null;attrHandle[name]=handle}return ret}});var rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})}});jQuery.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){return hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value}else{return hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]}},propHooks:{tabIndex:{get:function(elem){return elem.hasAttribute("tabindex")||rfocusable.test(elem.nodeName)||elem.href?elem.tabIndex:-1}}}});if(!support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent&&parent.parentNode){parent.parentNode.selectedIndex}return null}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});var rclass=/[\t\r\n\f]/g;jQuery.fn.extend({addClass:function(value){var classes,elem,cur,clazz,j,finalValue,proceed=typeof value==="string"&&value,i=0,len=this.length;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ");if(cur){j=0;while(clazz=classes[j++]){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}finalValue=jQuery.trim(cur);if(elem.className!==finalValue){elem.className=finalValue}}}}return this},removeClass:function(value){var classes,elem,cur,clazz,j,finalValue,proceed=arguments.length===0||typeof value==="string"&&value,i=0,len=this.length;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"");if(cur){j=0;while(clazz=classes[j++]){while(cur.indexOf(" "+clazz+" ")>=0){cur=cur.replace(" "+clazz+" "," ")}}finalValue=value?jQuery.trim(cur):"";if(elem.className!==finalValue){elem.className=finalValue}}}}return this},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==="boolean"&&type==="string"){return stateVal?this.addClass(value):this.removeClass(value)}if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),classNames=value.match(rnotwhite)||[];while(className=classNames[i++]){if(self.hasClass(className)){self.removeClass(className)}else{self.addClass(className)}}}else if(type===strundefined||type==="boolean"){if(this.className){data_priv.set(this,"__className__",this.className)}this.className=this.className||value===false?"":data_priv.get(this,"__className__")||""}})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true}}return false}});var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,jQuery(this).val())}else{val=value}if(val==null){val=""}else if(typeof val==="number"){val+=""}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return val!=null?val:jQuery.trim(jQuery.text(elem))}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(option.selected=jQuery.inArray(option.value,values)>=0){optionSet=true}}if(!optionSet){elem.selectedIndex=-1}return values}}}});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}}};if(!support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var nonce=jQuery.now();var rquery=/\?/;jQuery.parseJSON=function(data){return JSON.parse(data+"")};jQuery.parseXML=function(data){var xml,tmp;if(!data||typeof data!=="string"){return null}try{tmp=new DOMParser;xml=tmp.parseFromString(data,"text/xml")}catch(e){xml=undefined}if(!xml||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml};var rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,prefilters={},transports={},allTypes="*/".concat("*"),ajaxLocation=window.location.href,ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func)){while(dataType=dataTypes[i++]){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else if(seekingTransport){return!(selected=dataTypeOrTransport)}});return selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:deep||(deep={}))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0]in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response
}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}break}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}}}return{state:"success",data:response}}jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString)){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]]}}else{jqXHR.always(map[jqXHR.status])}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""];if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=jQuery.event&&s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=s.url+=(rquery.test(cacheURL)?"&":"?")+s.data;delete s.data}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified}}if(status===204||s.type==="HEAD"){statusText="nocontent"}else if(status===304){statusText="notmodified"}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!--jQuery.active){jQuery.event.trigger("ajaxStop")}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}});jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:false,global:false,"throws":true})};jQuery.fn.extend({wrapAll:function(html){var wrap;if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstElementChild){elem=elem.firstElementChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()}});jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}})}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value==null?"":value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a)){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrId=0,xhrCallbacks={},xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();if(window.attachEvent){window.attachEvent("onunload",function(){for(var key in xhrCallbacks){xhrCallbacks[key]()}})}support.cors=!!xhrSupported&&"withCredentials"in xhrSupported;support.ajax=xhrSupported=!!xhrSupported;jQuery.ajaxTransport(function(options){var callback;if(support.cors||xhrSupported&&!options.crossDomain){return{send:function(headers,complete){var i,xhr=options.xhr(),id=++xhrId;xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i]}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}for(i in headers){xhr.setRequestHeader(i,headers[i])}callback=function(type){return function(){if(callback){delete xhrCallbacks[id];callback=xhr.onload=xhr.onerror=null;if(type==="abort"){xhr.abort()}else if(type==="error"){complete(xhr.status,xhr.statusText)}else{complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,typeof xhr.responseText==="string"?{text:xhr.responseText}:undefined,xhr.getAllResponseHeaders())}}}};xhr.onload=callback();xhr.onerror=callback("error");callback=xhrCallbacks[id]=callback("abort");try{xhr.send(options.hasContent&&options.data||null)}catch(e){if(callback){throw e}}},abort:function(){if(callback){callback()}}}}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET"}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,callback;return{send:function(_,complete){script=jQuery("<script>").prop({async:true,charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove();callback=null;if(evt){complete(evt.type==="error"?404:200,evt.type)}});document.head.appendChild(script[0])},abort:function(){if(callback){callback()}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName)}else if(s.jsonp!==false){s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});jQuery.parseHTML=function(data,context,keepScripts){if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){keepScripts=context;context=false}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=jQuery.buildFragment([data],context,scripts);if(scripts&&scripts.length){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}var selector,type,response,self=this,off=url.indexOf(" ");if(off>=0){selector=jQuery.trim(url.slice(off));url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else if(params&&typeof params==="object"){type="POST"}if(self.length>0){jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])})}return this};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length};var docElem=window.document.documentElement;function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9&&elem.defaultView}jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative"}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&(curCSSTop+curCSSLeft).indexOf("auto")>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=options.top-curOffset.top+curTop}if(options.left!=null){props.left=options.left-curOffset.left+curLeft}if("using"in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({offset:function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!==strundefined){box=elem.getBoundingClientRect()}win=getWindow(doc);return{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}},position:function(){if(!this[0]){return}var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset()}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true)}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||docElem;while(offsetParent&&(!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent}return offsetParent||docElem})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?win[prop]:elem[method]}if(win){win.scrollTo(!top?val:window.pageXOffset,top?val:window.pageYOffset)}else{elem[method]=val}},method,val,arguments.length,null)}});jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}})});jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery})}var _jQuery=window.jQuery,_$=window.$;jQuery.noConflict=function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery};if(typeof noGlobal===strundefined){window.jQuery=window.$=jQuery}return jQuery})},{}],231:[function(require,module,exports){(function(global,factory){if(typeof exports==="object"){module.exports=factory()}else if(typeof define==="function"&&define.amd){define(factory)}else{global.printStackTrace=factory()}})(this,function(){function printStackTrace(options){options=options||{guess:true};var ex=options.e||null,guess=!!options.guess,mode=options.mode||null;var p=new printStackTrace.implementation,result=p.run(ex,mode);return guess?p.guessAnonymousFunctions(result):result}printStackTrace.implementation=function(){};printStackTrace.implementation.prototype={run:function(ex,mode){ex=ex||this.createException();mode=mode||this.mode(ex);if(mode==="other"){return this.other(arguments.callee)}else{return this[mode](ex)}},createException:function(){try{this.undef()}catch(e){return e}},mode:function(e){if(typeof window!=="undefined"&&window.navigator.userAgent.indexOf("PhantomJS")>-1){return"phantomjs"}if(e["arguments"]&&e.stack){return"chrome"}if(e.stack&&e.sourceURL){return"safari"}if(e.stack&&e.number){return"ie"}if(e.stack&&e.fileName){return"firefox"}if(e.message&&e["opera#sourceloc"]){if(!e.stacktrace){return"opera9"}if(e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length){return"opera9"}return"opera10a"}if(e.message&&e.stack&&e.stacktrace){if(e.stacktrace.indexOf("called from line")<0){return"opera10b"}return"opera11"}if(e.stack&&!e.fileName){return"chrome"}return"other"},instrumentFunction:function(context,functionName,callback){context=context||window;var original=context[functionName];context[functionName]=function instrumented(){callback.call(this,printStackTrace().slice(4));return context[functionName]._instrumented.apply(this,arguments)};context[functionName]._instrumented=original},deinstrumentFunction:function(context,functionName){if(context[functionName].constructor===Function&&context[functionName]._instrumented&&context[functionName]._instrumented.constructor===Function){context[functionName]=context[functionName]._instrumented}},chrome:function(e){return(e.stack+"\n").replace(/^[\s\S]+?\s+at\s+/," at ").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)").replace(/^(.+) \((.+)\)$/gm,"$1@$2").split("\n").slice(0,-1)},safari:function(e){return e.stack.replace(/\[native code\]\n/m,"").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},ie:function(e){return e.stack.replace(/^\s*at\s+(.*)$/gm,"$1").replace(/^Anonymous function\s+/gm,"{anonymous}() ").replace(/^(.+)\s+\((.+)\)$/gm,"$1@$2").split("\n").slice(1)},firefox:function(e){return e.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@").split("\n")},opera11:function(e){var ANON="{anonymous}",lineRE=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;var lines=e.stacktrace.split("\n"),result=[];for(var i=0,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);if(match){var location=match[4]+":"+match[1]+":"+match[2];var fnName=match[3]||"global code";fnName=fnName.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,ANON);result.push(fnName+"@"+location+" -- "+lines[i+1].replace(/^\s+/,""))}}return result},opera10b:function(e){var lineRE=/^(.*)@(.+):(\d+)$/;var lines=e.stacktrace.split("\n"),result=[];for(var i=0,len=lines.length;i<len;i++){var match=lineRE.exec(lines[i]);if(match){var fnName=match[1]?match[1]+"()":"global code";result.push(fnName+"@"+match[2]+":"+match[3])}}return result},opera10a:function(e){var ANON="{anonymous}",lineRE=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;var lines=e.stacktrace.split("\n"),result=[];for(var i=0,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);if(match){var fnName=match[3]||ANON;result.push(fnName+"()@"+match[2]+":"+match[1]+" -- "+lines[i+1].replace(/^\s+/,""))}}return result},opera9:function(e){var ANON="{anonymous}",lineRE=/Line (\d+).*script (?:in )?(\S+)/i;var lines=e.message.split("\n"),result=[];for(var i=2,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);if(match){result.push(ANON+"()@"+match[2]+":"+match[1]+" -- "+lines[i+1].replace(/^\s+/,""))}}return result},phantomjs:function(e){var ANON="{anonymous}",lineRE=/(\S+) \((\S+)\)/i;var lines=e.stack.split("\n"),result=[];for(var i=1,len=lines.length;i<len;i++){lines[i]=lines[i].replace(/^\s+at\s+/gm,"");var match=lineRE.exec(lines[i]);if(match){result.push(match[1]+"()@"+match[2])}else{result.push(ANON+"()@"+lines[i])}}return result},other:function(curr){var ANON="{anonymous}",fnRE=/function(?:\s+([\w$]+))?\s*\(/,stack=[],fn,args,maxStackSize=10;var slice=Array.prototype.slice;while(curr&&stack.length<maxStackSize){fn=fnRE.test(curr.toString())?RegExp.$1||ANON:ANON;try{args=slice.call(curr["arguments"]||[])}catch(e){args=["Cannot access arguments: "+e]}stack[stack.length]=fn+"("+this.stringifyArguments(args)+")";try{curr=curr.caller}catch(e){stack[stack.length]="Cannot access caller: "+e;break}}return stack},stringifyArguments:function(args){var result=[];var slice=Array.prototype.slice;for(var i=0;i<args.length;++i){var arg=args[i];if(arg===undefined){result[i]="undefined"}else if(arg===null){result[i]="null"}else if(arg.constructor){if(arg.constructor===Array){if(arg.length<3){result[i]="["+this.stringifyArguments(arg)+"]"}else{result[i]="["+this.stringifyArguments(slice.call(arg,0,1))+"..."+this.stringifyArguments(slice.call(arg,-1))+"]"}}else if(arg.constructor===Object){result[i]="#object"}else if(arg.constructor===Function){result[i]="#function"}else if(arg.constructor===String){result[i]='"'+arg+'"'}else if(arg.constructor===Number){result[i]=arg}else{result[i]="?"}}}return result.join(",")},sourceCache:{},ajax:function(url){var req=this.createXMLHTTPObject();if(req){try{req.open("GET",url,false);req.send(null);return req.responseText}catch(e){}}return""},createXMLHTTPObject:function(){var xmlhttp,XMLHttpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var i=0;i<XMLHttpFactories.length;i++){try{xmlhttp=XMLHttpFactories[i]();this.createXMLHTTPObject=XMLHttpFactories[i];return xmlhttp}catch(e){}}},isSameDomain:function(url){return typeof location!=="undefined"&&url.indexOf(location.hostname)!==-1},getSource:function(url){if(!(url in this.sourceCache)){this.sourceCache[url]=this.ajax(url).split("\n")}return this.sourceCache[url]},guessAnonymousFunctions:function(stack){for(var i=0;i<stack.length;++i){var reStack=/\{anonymous\}\(.*\)@(.*)/,reRef=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,frame=stack[i],ref=reStack.exec(frame);if(ref){var m=reRef.exec(ref[1]);if(m){var file=m[1],lineno=m[2],charno=m[3]||0;if(file&&this.isSameDomain(file)&&lineno){var functionName=this.guessAnonymousFunction(file,lineno,charno);stack[i]=frame.replace("{anonymous}",functionName)}}}}return stack},guessAnonymousFunction:function(url,lineNo,charNo){var ret;try{ret=this.findFunctionName(this.getSource(url),lineNo)}catch(e){ret="getSource failed with url: "+url+", exception: "+e.toString()}return ret},findFunctionName:function(source,lineNo){var reFunctionDeclaration=/function\s+([^(]*?)\s*\(([^)]*)\)/;var reFunctionExpression=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/;var reFunctionEvaluation=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/;var code="",line,maxLines=Math.min(lineNo,20),m,commentPos;for(var i=0;i<maxLines;++i){line=source[lineNo-i-1];commentPos=line.indexOf("//");if(commentPos>=0){line=line.substr(0,commentPos)}if(line){code=line+code;m=reFunctionExpression.exec(code);if(m&&m[1]){return m[1]}m=reFunctionDeclaration.exec(code);if(m&&m[1]){return m[1]}m=reFunctionEvaluation.exec(code);if(m&&m[1]){return m[1]}}}return"(?)"}};return printStackTrace})},{}],232:[function(require,module,exports){"use strict";exports.VERSION="7.0.6";exports.JID=require("xmpp-jid").JID;exports.Client=require("./lib/client");exports.createClient=function(opts){var client=new exports.Client(opts);client.use(require("./lib/plugins"));return client}},{"./lib/client":233,"./lib/plugins":256,"xmpp-jid":450}],233:[function(require,module,exports){"use strict";var _=require("underscore");var jxt=require("jxt");var WildEmitter=require("wildemitter");var util=require("util");var BPromise=require("bluebird");var uuid=require("node-uuid");var JID=require("xmpp-jid").JID;var StreamManagement=require("./sm");var getHostMeta=require("hostmeta");var SASLFactory=require("saslmechanisms");var SASL_MECHS={external:require("sasl-external"),"scram-sha-1":require("sasl-scram-sha-1"),"digest-md5":require("alt-sasl-digest-md5"),plain:require("sasl-plain"),anonymous:require("sasl-anonymous")};function Client(opts){var self=this;WildEmitter.call(this);opts=opts||{};this._initConfig(opts);this.stanzas=jxt.getGlobalJXT();this.jid=new JID;this.stanzas=jxt.createRegistry();this.stanzas.use(require("jxt-xmpp-types"));this.stanzas.use(require("./stanza/message"));this.stanzas.use(require("./stanza/presence"));this.stanzas.use(require("./stanza/iq"));this.stanzas.use(require("./stanza/error"));this.stanzas.use(require("./stanza/streamError"));this.use(require("./plugins/features"));this.use(require("./plugins/sasl"));this.use(require("./plugins/smacks"));this.use(require("./plugins/bind"));this.use(require("./plugins/session"));this.sm=new StreamManagement(this);this.transports={};this.use(require("./plugins/websocket"));this.use(require("./plugins/oldwebsocket"));this.use(require("./plugins/bosh"));this.on("stream:data",function(data){var json=data.toJSON();if(data._name==="iq"){json._xmlChildCount=0;_.each(data.xml.childNodes,function(child){if(child.nodeType===1){json._xmlChildCount+=1}})}self.emit(data._eventname||data._name,json);if(data._name==="message"||data._name==="presence"||data._name==="iq"){self.sm.handle(json);self.emit("stanza",json)}else if(data._name==="smAck"){return self.sm.process(json)}else if(data._name==="smRequest"){return self.sm.ack()}if(json.id){self.emit("id:"+json.id,json);self.emit(data._name+":id:"+json.id,json)}});this.on("disconnected",function(){if(self.transport){self.transport.off("*");delete self.transport}self.releaseGroup("connection")});this.on("iq",function(iq){var iqType=iq.type;var xmlChildCount=iq._xmlChildCount;delete iq._xmlChildCount;var exts=Object.keys(iq);if(iq.type==="get"||iq.type==="set"){if(xmlChildCount!==1){return self.sendIq(iq.errorReply({error:{type:"modify",condition:"bad-request"}}))}if(!exts.length){return self.sendIq(iq.errorReply({error:{type:"cancel",condition:"feature-not-implemented"}}))}var iqEvent="iq:"+iqType+":"+exts[0];if(self.callbacks[iqEvent]){self.emit(iqEvent,iq)}else{self.sendIq(iq.errorReply({error:{type:"cancel",condition:"feature-not-implemented"}}))}}});this.on("message",function(msg){if(Object.keys(msg.$body||{}).length){if(msg.type==="chat"||msg.type==="normal"){self.emit("chat",msg)}else if(msg.type==="groupchat"){self.emit("groupchat",msg)}}if(msg.type==="error"){self.emit("message:error",msg)}});this.on("presence",function(pres){var presType=pres.type||"available";if(presType==="error"){presType="presence:error"}self.emit(presType,pres)})}util.inherits(Client,WildEmitter);Object.defineProperty(Client.prototype,"stream",{get:function(){return this.transport?this.transport.stream:undefined}});Client.prototype._initConfig=function(opts){var self=this;var currConfig=this.config||{};this.config=_.extend({useStreamManagement:true,transports:["websocket","bosh"],sasl:["external","scram-sha-1","digest-md5","plain","anonymous"]},currConfig,opts);if(!_.isArray(this.config.sasl)){this.config.sasl=[this.config.sasl]}this.SASLFactory=new SASLFactory;this.config.sasl.forEach(function(mech){if(typeof mech==="string"){var existingMech=SASL_MECHS[mech.toLowerCase()];if(existingMech){self.SASLFactory.use(existingMech)}}else{self.SASLFactory.use(mech)}});this.config.jid=new JID(this.config.jid);if(!this.config.server){this.config.server=this.config.jid.domain
}if(this.config.password){this.config.credentials=this.config.credentials||{};this.config.credentials.password=this.config.password;delete this.config.password}if(this.config.transport){this.config.transports=[this.config.transport]}if(!_.isArray(this.config.transports)){this.config.transports=[this.config.transports]}};Client.prototype.use=function(pluginInit){pluginInit(this,this.stanzas,this.config)};Client.prototype.nextId=function(){return uuid.v4()};Client.prototype.discoverBindings=function(server,cb){getHostMeta(server,function(err,data){if(err){return cb(err,[])}var results={websocket:[],bosh:[]};var links=data.links||[];links.forEach(function(link){if(link.href&&link.rel==="urn:xmpp:alt-connections:websocket"){results.websocket.push(link.href)}if(link.href&&link.rel==="urn:xmpp:altconnect:websocket"){results.websocket.push(link.href)}if(link.href&&link.rel==="urn:xmpp:alt-connections:xbosh"){results.bosh.push(link.href)}if(link.href&&link.rel==="urn:xmpp:altconnect:bosh"){results.bosh.push(link.href)}});cb(false,results)})};Client.prototype.getCredentials=function(){var creds=this.config.credentials||{};var requestedJID=new JID(this.config.jid);var username=creds.username||requestedJID.local;var server=creds.server||requestedJID.domain;var defaultCreds={username:username,password:this.config.password,server:server,host:server,realm:server,serviceType:"xmpp",serviceName:server};var result=_.extend(defaultCreds,creds);return result};Client.prototype.connect=function(opts,transInfo){var self=this;this._initConfig(opts);if(transInfo&&transInfo.name&&transInfo.url){var trans=self.transport=new self.transports[transInfo.name](self.sm,self.stanzas);trans.on("*",function(event,data){self.emit(event,data)});return trans.connect(self.config)}if(!transInfo&&self.config.transports.length===1){transInfo={};transInfo.name=self.config.transports[0];if(transInfo.name==="websocket"||transInfo.name==="old-websocket"){transInfo.url=self.config.wsURL}if(transInfo.name==="bosh"){transInfo.url=self.config.boshURL}if(transInfo.name&&transInfo.url){return self.connect(null,transInfo)}}return self.discoverBindings(self.config.server,function(err,endpoints){if(err){console.error("Could not find https://"+self.config.server+"/.well-known/host-meta file to discover connection endpoints for the requested transports.");return self.disconnect()}for(var t=0,tlen=self.config.transports.length;t<tlen;t++){var transport=self.config.transports[t];console.log("Checking for %s endpoints",transport);for(var i=0,len=(endpoints[transport]||[]).length;i<len;i++){var uri=endpoints[transport][i];if(uri.indexOf("wss://")===0||uri.indexOf("https://")===0){if(transport==="websocket"){self.config.wsURL=uri}else{self.config.boshURL=uri}console.log("Using %s endpoint: %s",transport,uri);return self.connect(null,{name:transport,url:uri})}else{console.warn("Discovered unencrypted %s endpoint (%s). Ignoring",transport,uri)}}}console.error("No endpoints found for the requested transports.");return self.disconnect()})};Client.prototype.disconnect=function(){if(this.sessionStarted){this.releaseGroup("session");if(!this.sm.started){this.emit("session:end")}}this.sessionStarted=false;this.releaseGroup("connection");if(this.transport){this.transport.disconnect()}else{this.emit("disconnected")}};Client.prototype.send=function(data){this.sm.track(data);if(this.transport){this.transport.send(data)}};Client.prototype.sendMessage=function(data){data=data||{};if(!data.id){data.id=this.nextId()}var Message=this.stanzas.getMessage();var msg=new Message(data);this.emit("message:sent",msg.toJSON());this.send(msg);return data.id};Client.prototype.sendPresence=function(data){data=data||{};if(!data.id){data.id=this.nextId()}var Presence=this.stanzas.getPresence();this.send(new Presence(data));return data.id};Client.prototype.sendIq=function(data,cb){var result,respEvent,allowed,dest;var self=this;data=data||{};if(!data.id){data.id=this.nextId()}var Iq=this.stanzas.getIq();var iq=!data.toJSON?new Iq(data):data;if(data.type==="error"||data.type==="result"){this.send(iq);return}dest=new JID(data.to);allowed={};allowed[""]=true;allowed[dest.full]=true;allowed[dest.bare]=true;allowed[dest.domain]=true;allowed[self.jid.bare]=true;allowed[self.jid.domain]=true;respEvent="iq:id:"+data.id;result=new BPromise(function(resolve,reject){var handler=function(res){if(!allowed[res.from.full]){return}if(res.type!=="result"&&res.type!=="error"){return}self.off(respEvent,handler);if(!res.error){resolve(res)}else{reject(res)}};self.on(respEvent,"session",handler)});this.send(iq);return result.timeout(self.config.timeout*1e3||15e3).catch(BPromise.TimeoutError,function(){throw{id:data.id,type:"error",error:{condition:"timeout"}}}).nodeify(cb)};Client.prototype.sendStreamError=function(data){data=data||{};var StreamError=this.stanzas.getStreamError();var error=new StreamError(data);this.emit("stream:error",error.toJSON());this.send(error);this.disconnect()};module.exports=Client},{"./plugins/bind":236,"./plugins/bosh":240,"./plugins/features":251,"./plugins/oldwebsocket":267,"./plugins/sasl":278,"./plugins/session":279,"./plugins/smacks":281,"./plugins/websocket":285,"./sm":286,"./stanza/error":300,"./stanza/iq":309,"./stanza/message":315,"./stanza/presence":321,"./stanza/streamError":339,"alt-sasl-digest-md5":348,bluebird:363,hostmeta:365,jxt:407,"jxt-xmpp-types":406,"node-uuid":420,"sasl-anonymous":422,"sasl-external":424,"sasl-plain":426,"sasl-scram-sha-1":427,saslmechanisms:447,underscore:448,util:165,wildemitter:449,"xmpp-jid":450}],234:[function(require,module,exports){"use strict";module.exports=function(client){client.disco.addFeature("urn:xmpp:attention:0");client.getAttention=function(jid,opts){opts=opts||{};opts.to=jid;opts.type="headline";opts.attention=true;client.sendMessage(opts)};client.on("message",function(msg){if(msg.attention){client.emit("attention",msg)}})}},{}],235:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/avatar"));client.disco.addFeature("urn:xmpp:avatar:metadata+notify");client.on("pubsub:event",function(msg){if(!msg.event.updated){return}if(msg.event.updated.node!=="urn:xmpp:avatar:metadata"){return}client.emit("avatar",{jid:msg.from,source:"pubsub",avatars:msg.event.updated.published[0].avatars})});client.on("presence",function(pres){if(pres.avatarId){client.emit("avatar",{jid:pres.from,source:"vcard",avatars:[{id:pres.avatarId}]})}});client.publishAvatar=function(id,data,cb){return this.publish("","urn:xmpp:avatar:data",{id:id,avatarData:data},cb)};client.useAvatars=function(info,cb){return this.publish("","urn:xmpp:avatar:metadata",{id:"current",avatars:info},cb)};client.getAvatar=function(jid,id,cb){return this.getItem(jid,"urn:xmpp:avatar:data",id,cb)}}},{"../stanza/avatar":287}],236:[function(require,module,exports){"use strict";var JID=require("xmpp-jid").JID;module.exports=function(client,stanzas,config){stanzas.use(require("../stanza/bind"));client.registerFeature("bind",300,function(features,cb){var self=this;self.sendIq({type:"set",bind:{resource:config.resource}},function(err,resp){if(err){self.emit("session:error",err);return cb("disconnect","JID binding failed")}self.features.negotiated.bind=true;self.jid=new JID(resp.bind.jid);self.emit("session:bound",self.jid);var canStartSession=!features.session||features.session&&features.session.optional;if(!self.sessionStarted&&canStartSession){self.sessionStarted=true;self.emit("session:started",self.jid)}return cb()})});client.on("disconnected",function(){client.sessionStarted=false;client.features.negotiated.bind=false})}},{"../stanza/bind":288,"xmpp-jid":450}],237:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/blocking"));client.disco.addFeature("urn:xmpp:blocking");client.block=function(jid,cb){return client.sendIq({type:"set",block:{jids:[jid]}},cb)};client.unblock=function(jid,cb){return client.sendIq({type:"set",unblock:{jids:[jid]}},cb)};client.getBlocked=function(cb){return client.sendIq({type:"get",blockList:true},cb)};client.on("iq:set:block",function(iq){client.emit("block",{jids:iq.block.jids||[]});client.sendIq(iq.resultReply())});client.on("iq:set:unblock",function(iq){client.emit("unblock",{jids:iq.unblock.jids||[]});client.sendIq(iq.resultReply())})}},{"../stanza/blocking":289}],238:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/bob"));client.disco.addFeature("urn:xmpp:bob");client.getBits=function(jid,cid,cb){return client.sendIq({to:jid,type:"get",bob:{cid:cid}},cb)}}},{"../stanza/bob":290}],239:[function(require,module,exports){"use strict";var _=require("underscore");var JID=require("xmpp-jid").JID;module.exports=function(client,stanzas){stanzas.use(require("../stanza/bookmarks"));client.getBookmarks=function(cb){return this.getPrivateData({bookmarks:true},cb)};client.setBookmarks=function(opts,cb){return this.setPrivateData({bookmarks:opts},cb)};client.addBookmark=function(bookmark,cb){bookmark.jid=new JID(bookmark.jid);return this.getBookmarks().then(function(res){var bookmarks=res.privateStorage.bookmarks.conferences||[];var existing=_.filter(bookmarks,function(bm){return bm.jid.bare===bookmark.jid.bare});if(existing.length){_.extend(existing[0],bookmark)}else{bookmarks.push(bookmark)}return client.setBookmarks({conferences:bookmarks})}).nodeify(cb)};client.removeBookmark=function(jid,cb){jid=new JID(jid);return this.getBookmarks().then(function(res){var bookmarks=res.privateStorage.bookmarks.conferences||[];bookmarks=_.filter(bookmarks,function(bm){return jid.bare!==bm.jid.bare});return client.setBookmarks({conferences:bookmarks})}).nodeify(cb)}}},{"../stanza/bookmarks":291,underscore:448,"xmpp-jid":450}],240:[function(require,module,exports){"use strict";var BOSHConnection=require("../transports/bosh");module.exports=function(client,stanzas){stanzas.use(require("../stanza/bosh"));client.transports.bosh=BOSHConnection}},{"../stanza/bosh":292,"../transports/bosh":345}],241:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/carbons"));client.disco.addFeature("urn:xmpp:carbons:2");client.enableCarbons=function(cb){return this.sendIq({type:"set",enableCarbons:true},cb)};client.disableCarbons=function(cb){return this.sendIq({type:"set",disableCarbons:true},cb)};client.on("message",function(msg){if(msg.carbonSent){return client.emit("carbon:sent",msg)}if(msg.carbonReceived){return client.emit("carbon:received",msg)}});client.on("carbon:*",function(name,carbon){var dir=name.split(":")[1];if(carbon.from.bare!==client.jid.bare){return}var msg,delay;if(dir==="received"){msg=carbon.carbonReceived.forwarded.message;delay=carbon.carbonReceived.forwarded.delay}else{msg=carbon.carbonSent.forwarded.message;delay=carbon.carbonSent.forwarded.delay}if(!msg.delay){if(delay){msg.delay.stamp=delay.stamp}else{msg.delay={stamp:new Date(Date.now())}}}msg.carbon=true;if(msg.from.bare===client.jid.bare){client.emit("message:sent",msg)}else{client.emit("message",msg)}})}},{"../stanza/carbons":294}],242:[function(require,module,exports){"use strict";module.exports=function(client){client.disco.addFeature("http://jabber.org/protocol/chatstates");client.on("message",function(msg){if(msg.chatState){client.emit("chat:state",{to:msg.to,from:msg.from,chatState:msg.chatState});client.emit("chatState",{to:msg.to,from:msg.from,chatState:msg.chatState})}})}},{}],243:[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/commands";module.exports=function(client,stanzas){stanzas.use(require("../stanza/command"));client.disco.addFeature(NS);client.disco.addItem({name:"Ad-Hoc Commands",node:NS});client.getCommands=function(jid,cb){return client.getDiscoItems(jid,NS,cb)}}},{"../stanza/command":295}],244:[function(require,module,exports){"use strict";module.exports=function(client){client.disco.addFeature("urn:xmpp:message-correct:0");client.on("message",function(msg){if(msg.replace){client.emit("replace",msg);client.emit("replace:"+msg.id,msg)}})}},{}],245:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/csi"));var Active=stanzas.getDefinition("active","urn:xmpp:csi");var Inactive=stanzas.getDefinition("inactive","urn:xmpp:csi");client.registerFeature("clientStateIndication",400,function(features,cb){this.features.negotiated.clientStateIndication=true;cb()});client.markActive=function(){if(this.features.negotiated.clientStateIndication){this.send(new Active)}};client.markInactive=function(){if(this.features.negotiated.clientStateIndication){this.send(new Inactive)}}}},{"../stanza/csi":296}],246:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/dataforms"));client.disco.addFeature("jabber:x:data");client.disco.addFeature("urn:xmpp:media-element");client.disco.addFeature("http://jabber.org/protocol/xdata-validate");client.disco.addFeature("http://jabber.org/protocol/xdata-layout");client.on("message",function(msg){if(msg.form){client.emit("dataform",msg)}})}},{"../stanza/dataforms":297}],247:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/delayed"));client.disco.addFeature("urn:xmpp:delay")}},{"../stanza/delayed":298}],248:[function(require,module,exports){(function(Buffer){"use strict";var _=require("underscore");var JID=require("xmpp-jid").JID;var hashes=require("iana-hashes");function generateVerString(info,hash){var S="";var features=info.features.sort();var identities=[];var formTypes={};var formOrder=[];_.forEach(info.identities,function(identity){identities.push([identity.category||"",identity.type||"",identity.lang||"",identity.name||""].join("/"))});identities.sort();var idLen=identities.length;var featureLen=features.length;identities=_.unique(identities,true);features=_.unique(features,true);if(featureLen!==features.length||idLen!==identities.length){return false}S+=identities.join("<")+"<";S+=features.join("<")+"<";var illFormed=false;_.forEach(info.extensions,function(ext){var fields=ext.fields;for(var i=0,len=fields.length;i<len;i++){if(fields[i].name==="FORM_TYPE"&&fields[i].type==="hidden"){var name=fields[i].value;if(formTypes[name]){illFormed=true;return}formTypes[name]=ext;formOrder.push(name);return}}});if(illFormed){return false}formOrder.sort();_.forEach(formOrder,function(name){var ext=formTypes[name];var fields={};var fieldOrder=[];S+="<"+name;_.forEach(ext.fields,function(field){var fieldName=field.name;if(fieldName!=="FORM_TYPE"){var values=field.value||"";if(typeof values!=="object"){values=values.split("\n")}fields[fieldName]=values.sort();fieldOrder.push(fieldName)}});fieldOrder.sort();_.forEach(fieldOrder,function(fieldName){S+="<"+fieldName;_.forEach(fields[fieldName],function(val){S+="<"+val})})});var ver=hashes.createHash(hash).update(new Buffer(S,"utf8")).digest("base64");var padding=4-ver.length%4;if(padding===4){padding=0}for(var i=0;i<padding;i++){ver+="="}return ver}function verifyVerString(info,hash,check){var computed=generateVerString(info,hash);return computed&&computed===check}function Disco(){this.features={};this.identities={};this.extensions={};this.items={};this.caps={}}Disco.prototype={constructor:{value:Disco},addFeature:function(feature,node){node=node||"";if(!this.features[node]){this.features[node]=[]}this.features[node].push(feature)},addIdentity:function(identity,node){node=node||"";if(!this.identities[node]){this.identities[node]=[]}this.identities[node].push(identity)},addItem:function(item,node){node=node||"";if(!this.items[node]){this.items[node]=[]}this.items[node].push(item)},addExtension:function(form,node){node=node||"";if(!this.extensions[node]){this.extensions[node]=[]}this.extensions[node].push(form)}};module.exports=function(client,stanzas){stanzas.use(require("../stanza/disco"));stanzas.use(require("../stanza/caps"));stanzas.use(require("../stanza/rsm"));client.disco=new Disco(client);client.disco.addFeature("http://jabber.org/protocol/disco#info");client.disco.addFeature("http://jabber.org/protocol/disco#items");client.disco.addIdentity({category:"client",type:"web"});client.registerFeature("caps",100,function(features,cb){this.emit("disco:caps",{from:new JID(this.jid.domain),caps:features.caps});this.features.negotiated.caps=true;cb()});client.getDiscoInfo=function(jid,node,cb){return this.sendIq({to:jid,type:"get",discoInfo:{node:node}},cb)};client.getDiscoItems=function(jid,node,cb){return this.sendIq({to:jid,type:"get",discoItems:{node:node}},cb)};client.updateCaps=function(){var node=this.config.capsNode||"https://stanza.io";var data=JSON.parse(JSON.stringify({identities:this.disco.identities[""],features:this.disco.features[""],extensions:this.disco.extensions[""]}));var ver=generateVerString(data,"sha-1");this.disco.caps={node:node,hash:"sha-1",ver:ver};node=node+"#"+ver;this.disco.features[node]=data.features;this.disco.identities[node]=data.identities;this.disco.extensions[node]=data.extensions;return client.getCurrentCaps()};client.getCurrentCaps=function(){var caps=client.disco.caps;if(!caps.ver){return{ver:null,discoInfo:null}}var node=caps.node+"#"+caps.ver;return{ver:caps.ver,discoInfo:{identities:client.disco.identities[node],features:client.disco.features[node],extensions:client.disco.extensions[node]}}};client.on("presence",function(pres){if(pres.caps){client.emit("disco:caps",pres)}});client.on("iq:get:discoInfo",function(iq){var node=iq.discoInfo.node||"";var reportedNode=iq.discoInfo.node||"";if(node===client.disco.caps.node+"#"+client.disco.caps.ver){reportedNode=node;node=""}client.sendIq(iq.resultReply({discoInfo:{node:reportedNode,identities:client.disco.identities[node]||[],features:client.disco.features[node]||[],extensions:client.disco.extensions[node]||[]}}))});client.on("iq:get:discoItems",function(iq){var node=iq.discoItems.node;client.sendIq(iq.resultReply({discoItems:{node:node,items:client.disco.items[node]||[]}}))});client.verifyVerString=verifyVerString;client.generateVerString=generateVerString;client.updateCaps()}}).call(this,require("buffer").Buffer)},{"../stanza/caps":293,"../stanza/disco":299,"../stanza/rsm":331,buffer:5,"iana-hashes":368,underscore:448,"xmpp-jid":450}],249:[function(require,module,exports){"use strict";module.exports=function(client){client.disco.addFeature("jid\\20escaping")}},{}],250:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/extdisco"));client.disco.addFeature("urn:xmpp:extdisco:1");client.getServices=function(jid,type,cb){return this.sendIq({type:"get",to:jid,services:{type:type}},cb)};client.getServiceCredentials=function(jid,host,cb){return this.sendIq({type:"get",to:jid,credentials:{service:{host:host}}},cb)}}},{"../stanza/extdisco":301}],251:[function(require,module,exports){"use strict";var async=require("async");module.exports=function(client,stanzas){stanzas.use(require("../stanza/streamFeatures"));client.features={negotiated:{},order:[],handlers:{}};client.registerFeature=function(name,priority,handler){this.features.order.push({priority:priority,name:name});this.features.order.sort(function(a,b){if(a.priority<b.priority){return-1}if(a.priority>b.priority){return 1}return 0});this.features.handlers[name]=handler.bind(client)};client.on("streamFeatures",function(features){var series=[];var negotiated=client.features.negotiated;var handlers=client.features.handlers;client.features.order.forEach(function(feature){var name=feature.name;if(features[name]&&handlers[name]&&!negotiated[name]){series.push(function(cb){if(!negotiated[name]){handlers[name](features,cb)}else{cb()}})}});async.series(series,function(cmd,msg){if(cmd==="restart"){client.transport.restart()}else if(cmd==="disconnect"){client.emit("stream:error",{condition:"policy-violation",text:"Failed to negotiate stream features: "+msg});client.disconnect()}})})}},{"../stanza/streamFeatures":340,async:362}],252:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/forwarded"));client.disco.addFeature("urn:xmpp:forward:0")}},{"../stanza/forwarded":303}],253:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/geoloc"));client.disco.addFeature("http://jabber.org/protocol/geoloc");client.disco.addFeature("http://jabber.org/protocol/geoloc+notify");client.on("pubsub:event",function(msg){if(!msg.event.updated){return}if(msg.event.updated.node!=="http://jabber.org/protocol/geoloc"){return}client.emit("geoloc",{jid:msg.from,geoloc:msg.event.updated.published[0].geoloc})});client.publishGeoLoc=function(data,cb){return this.publish("","http://jabber.org/protocol/geoloc",{geoloc:data},cb)}}},{"../stanza/geoloc":305}],254:[function(require,module,exports){"use strict";var hashes=require("iana-hashes");module.exports=function(client,stanzas){stanzas.use(require("../stanza/hash"));client.disco.addFeature("urn:xmpp:hashes:1");var names=hashes.getHashes();names.forEach(function(name){client.disco.addFeature("urn:xmpp:hash-function-text-names:"+name)})}},{"../stanza/hash":306,"iana-hashes":368}],255:[function(require,module,exports){"use strict";module.exports=function(client){client.disco.addFeature("urn:xmpp:idle:1")}},{}],256:[function(require,module,exports){"use strict";module.exports=function(client){client.use(require("./disco"));client.use(require("./attention"));client.use(require("./avatar"));client.use(require("./blocking"));client.use(require("./bob"));client.use(require("./bookmarks"));client.use(require("./carbons"));client.use(require("./chatstates"));client.use(require("./command"));client.use(require("./correction"));client.use(require("./csi"));client.use(require("./dataforms"));client.use(require("./delayed"));client.use(require("./escaping"));client.use(require("./extdisco"));client.use(require("./forwarding"));client.use(require("./geoloc"));client.use(require("./hashes"));client.use(require("./idle"));client.use(require("./invisible"));client.use(require("./jidprep"));client.use(require("./jingle"));client.use(require("./json"));client.use(require("./keepalive"));client.use(require("./logging"));client.use(require("./mam"));client.use(require("./muc"));client.use(require("./mood"));client.use(require("./nick"));client.use(require("./oob"));client.use(require("./ping"));client.use(require("./private"));client.use(require("./psa"));client.use(require("./pubsub"));client.use(require("./reach"));client.use(require("./receipts"));client.use(require("./register"));client.use(require("./roster"));client.use(require("./rtt"));client.use(require("./shim"));client.use(require("./time"));client.use(require("./vcard"));client.use(require("./version"))}},{"./attention":234,"./avatar":235,"./blocking":237,"./bob":238,"./bookmarks":239,"./carbons":241,"./chatstates":242,"./command":243,"./correction":244,"./csi":245,"./dataforms":246,"./delayed":247,"./disco":248,"./escaping":249,"./extdisco":250,"./forwarding":252,"./geoloc":253,"./hashes":254,"./idle":255,"./invisible":257,"./jidprep":258,"./jingle":259,"./json":260,"./keepalive":261,"./logging":262,"./mam":263,"./mood":264,"./muc":265,"./nick":266,"./oob":268,"./ping":269,"./private":270,"./psa":271,"./pubsub":272,"./reach":273,"./receipts":274,"./register":275,"./roster":276,"./rtt":277,"./shim":280,"./time":282,"./vcard":283,"./version":284}],257:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/visibility"));client.goInvisible=function(cb){return this.sendIq({type:"set",invisible:true},cb)};client.goVisible=function(cb){return this.sendIq({type:"set",visible:true},cb)}}},{"../stanza/visibility":344}],258:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/jidprep"));client.prepJID=function(jid,cb){return client.sendIq({to:client.jid.domain,type:"get",jidPrep:jid},cb)}}},{"../stanza/jidprep":310}],259:[function(require,module,exports){"use strict";var Jingle=require("jingle");module.exports=function(client,stanzas){stanzas.use(require("../stanza/jingle"));stanzas.use(require("../stanza/rtp"));stanzas.use(require("../stanza/iceUdp"));stanzas.use(require("../stanza/file"));var jingle=client.jingle=new Jingle;jingle.capabilities.forEach(function(cap){client.disco.addFeature(cap)});var mappedEvents=["outgoing","incoming","accepted","terminated","ringing","mute","unmute","hold","resumed"];mappedEvents.forEach(function(event){jingle.on(event,function(session,arg1){client.emit("jingle:"+event,session,arg1)})});jingle.on("createdSession",function(session){client.emit("jingle:created",session)});jingle.on("peerStreamAdded",function(session,stream){client.emit("jingle:remotestream:added",session,stream)});jingle.on("peerStreamRemoved",function(session,stream){client.emit("jingle:remotestream:removed",session,stream)});jingle.on("send",function(data){client.sendIq(data,function(err){if(err){client.emit("jingle:error",err)}})});client.on("session:bound",function(jid){jingle.jid=jid;jingle.selfID=jid.full});client.on("iq:set:jingle",function(data){jingle.process(data)});client.on("unavailable",function(pres){var peer=pres.from.full;jingle.endPeerSessions(peer,true)});client.discoverICEServers=function(cb){return this.getServices(client.config.server).then(function(res){var services=res.services.services;var discovered=[];for(var i=0;i<services.length;i++){var service=services[i];var ice={};if(service.type==="stun"||service.type==="stuns"){ice.url=service.type+":"+service.host;if(service.port){ice.url+=":"+service.port}discovered.push(ice);client.jingle.addICEServer(ice)}else if(service.type==="turn"||service.type==="turns"){ice.url=service.type+":"+service.host;if(service.port){ice.url+=":"+service.port}if(service.transport&&service.transport!=="udp"){ice.url+="?transport="+service.transport}if(service.username){ice.username=service.username}if(service.password){ice.credential=service.password}discovered.push(ice);client.jingle.addICEServer(ice)}}return discovered}).nodeify(cb)}}},{"../stanza/file":302,"../stanza/iceUdp":308,"../stanza/jingle":311,"../stanza/rtp":332,jingle:384}],260:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/json"));client.disco.addFeature("urn:xmpp:json:0")}},{"../stanza/json":312}],261:[function(require,module,exports){"use strict";var BPromise=require("bluebird");function checkConnection(client,timeout){return new BPromise(function(resolve,reject){if(client.sm.started){client.once("stream:management:ack",resolve);client.sm.request()}else{client.ping().then(resolve).catch(function(err){if(err.error&&err.error.condition!=="timeout"){resolve()}else{reject()}})}}).timeout(timeout*1e3||15e3)}module.exports=function(client){client.enableKeepAlive=function(opts){opts=opts||{};opts.interval=opts.interval||300;opts.timeout=opts.timeout||15;function keepalive(){if(client.sessionStarted){checkConnection(client,opts.timeout).catch(function(){client.sendStreamError({condition:"connection-timeout"})})}}client._keepAliveInterval=setInterval(keepalive,opts.interval*1e3)};client.disableKeepAlive=function(){if(client._keepAliveInterval){clearInterval(client._keepAliveInterval);delete client._keepAliveInterval}};client.on("disconnected",function(){client.disableKeepAlive()})}},{bluebird:363}],262:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/logging"));client.disco.addFeature("","urn:xmpp:eventlog");client.sendLog=function(jid,logData){client.sendMessage({to:jid,type:"normal",log:logData})}}},{"../stanza/logging":313}],263:[function(require,module,exports){"use strict";var BPromise=require("bluebird");var JID=require("xmpp-jid").JID;module.exports=function(client,stanzas){stanzas.use(require("../stanza/mam"));client.disco.addFeature("urn:xmpp:mam:0");client.getHistorySearchForm=function(jid,cb){return client.sendIq({to:jid,type:"get",mam:true},cb)};client.searchHistory=function(opts,cb){var self=this;var queryid=this.nextId();opts=opts||{};opts.queryid=queryid;var to=opts.jid||opts.to||"";delete opts.jid;delete opts.to;if(!opts.form){opts.form={}}opts.form.type="submit";var fields=opts.form.fields=opts.form.fields||[];var defaultFields=["FORM_TYPE","with","start","end"];defaultFields.forEach(function(name){if(opts[name]||name==="FORM_TYPE"){var val=opts[name];var isDate=name==="start"||name==="end";if(isDate&&typeof val!=="string"){val=val.toISOString()}if(name==="FORM_TYPE"){val="urn:xmpp:mam:0"}var existing=false;for(var i=0,len=fields.length;i<len;i++){if(fields[i].name===name){continue}}if(!existing){fields.push({name:name,value:val})}delete opts[name]}});var dest=new JID(to||client.jid.bare);var allowed={};allowed[""]=true;allowed[dest.full]=true;allowed[dest.bare]=true;allowed[dest.domain]=true;allowed[client.jid.bare]=true;allowed[client.jid.domain]=true;var results=[];this.on("mam:item:"+queryid,"session",function(msg){if(!allowed[msg.from.full]){return}results.push(msg.mamItem)});var collectResults=new BPromise(function(resolve){self.once("mam:result:"+queryid,"session",function(msg){if(!allowed[msg.from.full]){return}msg.mamResult.items=results;resolve(msg)})});var mamQuery=this.sendIq({type:"set",to:to,id:queryid,mam:opts});return BPromise.all([mamQuery,collectResults]).spread(function(iqRes,mamRes){return mamRes}).timeout(self.config.timeout*1e3||15e3).catch(BPromise.TimeoutError,function(){throw{id:queryid,type:"error",error:{condition:"timeout"}}}).finally(function(){self.off("mam:item:"+queryid);self.off("mam:result:"+queryid)}).nodeify(cb)};client.getHistoryPreferences=function(cb){return this.sendIq({type:"get",mamPrefs:true},cb)};client.setHistoryPreferences=function(opts,cb){return this.sendIq({type:"set",mamPrefs:opts},cb)};client.on("message",function(msg){if(msg.mamItem){client.emit("mam:item:"+msg.mamItem.queryid,msg)}if(msg.mamResult){client.emit("mam:result:"+msg.mamResult.queryid,msg)}})}},{"../stanza/mam":314,bluebird:363,"xmpp-jid":450}],264:[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/mood";module.exports=function(client,stanzas){stanzas.use(require("../stanza/mood"));client.disco.addFeature(NS);client.disco.addFeature(NS+"+notify");client.on("pubsub:event",function(msg){if(!msg.event.updated){return}if(msg.event.updated.node!==NS){return}client.emit("mood",{jid:msg.from,mood:msg.event.updated.published[0].mood})});client.publishMood=function(mood,text,cb){return this.publish("",NS,{mood:{value:mood,text:text}},cb)}}},{"../stanza/mood":316}],265:[function(require,module,exports){"use strict";var _=require("underscore");var JID=require("xmpp-jid").JID;module.exports=function(client,stanzas){stanzas.use(require("../stanza/muc"));stanzas.use(require("../stanza/hats"));client.disco.addFeature("http://jabber.org/protocol/muc");client.disco.addFeature("jabber:x:conference");client.disco.addFeature("urn:xmpp:hats:0");client.joinedRooms={};function rejoinRooms(){_.each(client.joinedRooms,function(nick,room){client.joinedRooms[room]=false;client.joinRoom(room,nick)})}client.on("session:started",rejoinRooms);client.on("stream:management:resumed",rejoinRooms);client.on("message",function(msg){if(msg.muc){if(msg.muc.invite){client.emit("muc:invite",{from:msg.muc.invite.from,room:msg.from,reason:msg.muc.invite.reason,password:msg.muc.password,thread:msg.muc.invite.thread,type:"mediated"})}if(msg.muc.destroyed){client.emit("muc:destroyed",{room:msg.from,newRoom:msg.muc.destroyed.jid,reason:msg.muc.destroyed.reason,password:msg.muc.password})}if(msg.muc.decline){client.emit("muc:declined",{room:msg.from,from:msg.muc.decline.from,reason:msg.muc.decline.reason})
}}else if(msg.mucInvite){client.emit("muc:invite",{from:msg.from,room:msg.mucInvite.jid,reason:msg.mucInvite.reason,password:msg.mucInvite.password,thread:msg.mucInvite.thread,type:"direct"})}if(msg.type==="groupchat"&&msg.subject){client.emit("muc:subject",msg)}});client.on("presence",function(pres){if(pres.joinMuc&&pres.type==="error"){client.emit("muc:error",pres)}else if(pres.muc){var isSelf=pres.muc.codes&&pres.muc.codes.indexOf("110")>=0;if(pres.type==="error"){client.emit("muc:error",pres)}else if(pres.type==="unavailable"){client.emit("muc:unavailable",pres);if(isSelf){client.emit("muc:leave",pres);delete client.joinedRooms[pres.from.bare]}}else{client.emit("muc:available",pres);if(isSelf&&!client.joinedRooms[pres.from.bare]){client.emit("muc:join",pres);client.joinedRooms[pres.from.bare]=pres.from.resource}}}});client.joinRoom=function(room,nick,opts){opts=opts||{};opts.to=room+"/"+nick;opts.caps=this.disco.caps;opts.joinMuc=opts.joinMuc||{};this.sendPresence(opts)};client.leaveRoom=function(room,nick,opts){opts=opts||{};opts.to=room+"/"+nick;opts.type="unavailable";this.sendPresence(opts)};client.ban=function(room,jid,reason,cb){client.setRoomAffiliation(room,jid,"outcast",reason,cb)};client.kick=function(room,nick,reason,cb){client.setRoomRole(room,nick,"none",reason,cb)};client.invite=function(room,opts){client.sendMessage({to:room,muc:{invites:opts}})};client.directInvite=function(room,opts){opts.jid=room;client.sendMessage({to:opts.to,mucInvite:opts})};client.declineInvite=function(room,sender,reason){client.sendMessage({to:room,muc:{decline:{to:sender,reason:reason}}})};client.changeNick=function(room,nick){client.sendPresence({to:new JID(room).bare+"/"+nick})};client.setSubject=function(room,subject){client.sendMessage({to:room,type:"groupchat",subject:subject})};client.discoverReservedNick=function(room,cb){client.getDiscoInfo(room,"x-roomuser-item",function(err,res){if(err){return cb(err)}var ident=res.discoInfo.identities[0]||{};cb(null,ident.name)})};client.requestRoomVoice=function(room){client.sendMessage({to:room,form:{fields:[{name:"FORM_TYPE",value:"http://jabber.org/protocol/muc#request"},{name:"muc#role",type:"text-single",value:"participant"}]}})};client.setRoomAffiliation=function(room,jid,affiliation,reason,cb){return this.sendIq({type:"set",to:room,mucAdmin:{jid:jid,affiliation:affiliation,reason:reason}},cb)};client.setRoomRole=function(room,nick,role,reason,cb){return this.sendIq({type:"set",to:room,mucAdmin:{nick:nick,role:role,reason:reason}},cb)};client.getRoomMembers=function(room,opts,cb){return this.sendIq({type:"get",to:room,mucAdmin:opts},cb)};client.getRoomConfig=function(jid,cb){return this.sendIq({to:jid,type:"get",mucOwner:true},cb)};client.configureRoom=function(jid,form,cb){if(!form.type){form.type="submit"}return this.sendIq({to:jid,type:"set",mucOwner:{form:form}},cb)};client.getUniqueRoomName=function(jid,cb){return this.sendIq({type:"get",to:jid,mucUnique:true},cb)}}},{"../stanza/hats":307,"../stanza/muc":317,underscore:448,"xmpp-jid":450}],266:[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/nick";module.exports=function(client,stanzas){stanzas.use(require("../stanza/nick"));client.disco.addFeature(NS);client.disco.addFeature(NS+"+notify");client.on("pubsub:event",function(msg){if(!msg.event.updated){return}if(msg.event.updated.node!==NS){return}client.emit("nick",{jid:msg.from,nick:msg.event.updated.published[0].nick})});client.publishNick=function(nick,cb){return this.publish("",NS,{nick:nick},cb)}}},{"../stanza/nick":318}],267:[function(require,module,exports){"use strict";var OldWSConnection=require("../transports/old-websocket");module.exports=function(client,stanzas){stanzas.use(require("../stanza/stream"));client.transports["old-websocket"]=OldWSConnection}},{"../stanza/stream":338,"../transports/old-websocket":346}],268:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/oob"));client.disco.addFeature("jabber:x:oob")}},{"../stanza/oob":319}],269:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/ping"));client.disco.addFeature("urn:xmpp:ping");client.on("iq:get:ping",function(iq){client.sendIq(iq.resultReply())});client.ping=function(jid,cb){return this.sendIq({to:jid,type:"get",ping:true},cb)}}},{"../stanza/ping":320}],270:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/private"));client.getPrivateData=function(opts,cb){return this.sendIq({type:"get",privateStorage:opts},cb)};client.setPrivateData=function(opts,cb){return this.sendIq({type:"set",privateStorage:opts},cb)}}},{"../stanza/private":322}],271:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/psa"));client.disco.addFeature("urn:xmpp:psa")}},{"../stanza/psa":323}],272:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/pubsub"));stanzas.use(require("../stanza/pubsubOwner"));stanzas.use(require("../stanza/pubsubEvents"));stanzas.use(require("../stanza/pubsubError"));client.on("message",function(msg){if(msg.event){client.emit("pubsub:event",msg);client.emit("pubsubEvent",msg);if(msg.event.updated){var published=msg.event.updated.published;var retracted=msg.event.updated.retracted;if(published&&published.length){client.emit("pubsub:published",msg)}if(retracted&&retracted.length){client.emit("pubsub:retracted",msg)}}if(msg.event.purged){client.emit("pubsub:purged",msg)}if(msg.event.deleted){client.emit("pubsub:deleted",msg)}if(msg.event.subscriptionChanged){client.emit("pubsub:subscription",msg)}if(msg.event.configurationChanged){client.emit("pubsub:config",msg)}}if(msg.pubsub&&msg.pubsub.affiliations){client.emit("pubsub:affiliation",msg)}});client.subscribeToNode=function(jid,opts,cb){if(typeof opts==="string"){opts={node:opts}}opts.jid=opts.jid||client.jid;return this.sendIq({type:"set",to:jid,pubsub:{subscribe:opts}},cb)};client.unsubscribeFromNode=function(jid,opts,cb){if(typeof opts==="string"){opts={node:opts}}opts.jid=opts.jid||client.jid.bare;return this.sendIq({type:"set",to:jid,pubsub:{unsubscribe:opts}},cb)};client.publish=function(jid,node,item,cb){return this.sendIq({type:"set",to:jid,pubsub:{publish:{node:node,item:item}}},cb)};client.getItem=function(jid,node,id,cb){return this.sendIq({type:"get",to:jid,pubsub:{retrieve:{node:node,item:id}}},cb)};client.getItems=function(jid,node,opts,cb){opts=opts||{};opts.node=node;return this.sendIq({type:"get",to:jid,pubsub:{retrieve:{node:node,max:opts.max},rsm:opts.rsm}},cb)};client.retract=function(jid,node,id,notify,cb){return this.sendIq({type:"set",to:jid,pubsub:{retract:{node:node,notify:notify,id:id}}},cb)};client.purgeNode=function(jid,node,cb){return this.sendIq({type:"set",to:jid,pubsubOwner:{purge:node}},cb)};client.deleteNode=function(jid,node,cb){return this.sendIq({type:"set",to:jid,pubsubOwner:{del:node}},cb)};client.createNode=function(jid,node,config,cb){var cmd={type:"set",to:jid,pubsubOwner:{create:node}};if(config){cmd.pubsubOwner.config={form:config}}return this.sendIq(cmd,cb)};client.getSubscriptions=function(jid,opts,cb){opts=opts||{};return this.sendIq({type:"get",to:jid,pubsub:{subscriptions:opts}},cb)};client.getAffiliations=function(jid,opts,cb){opts=opts||{};return this.sendIq({type:"get",to:jid,pubsub:{affiliations:opts}},cb)};client.getNodeSubscribers=function(jid,node,opts,cb){opts=opts||{};opts.node=node;return this.sendIq({type:"get",to:jid,pubsubOwner:{subscriptions:opts}},cb)};client.updateNodeSubscriptions=function(jid,node,delta,cb){return this.sendIq({type:"set",to:jid,pubsubOwner:{subscriptions:{node:node,list:delta}}},cb)};client.getNodeAffiliations=function(jid,node,opts,cb){opts=opts||{};opts.node=node;return this.sendIq({type:"get",to:jid,pubsubOwner:{affiliations:opts}},cb)};client.updateNodeAffiliations=function(jid,node,delta,cb){return this.sendIq({type:"set",to:jid,pubsubOwner:{affiliations:{node:node,list:delta}}},cb)}}},{"../stanza/pubsub":324,"../stanza/pubsubError":325,"../stanza/pubsubEvents":326,"../stanza/pubsubOwner":327}],273:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/reach"));client.disco.addFeature("urn:xmpp:reach:0");client.disco.addFeature("urn:xmpp:reach:0+notify");client.on("pubsub:event",function(msg){if(!msg.event.updated){return}if(msg.event.updated.node!=="urn:xmpp:reach:0"){return}client.emit("reachability",{jid:msg.from,addresses:msg.event.updated.published[0].reach})});client.on("presence",function(pres){if(!pres.reach||!pres.reach.length){return}client.emit("reachability",{jid:pres.from,addresses:pres.reach})});client.publishReachability=function(data,cb){return this.publish("","urn:xmpp:reach:0",{reach:data},cb)}}},{"../stanza/reach":328}],274:[function(require,module,exports){"use strict";module.exports=function(client){client.disco.addFeature("urn:xmpp:receipts");client.on("message",function(msg){var ackTypes={normal:true,chat:true,headline:true};if(ackTypes[msg.type]&&msg.requestReceipt&&!msg.receipt){client.sendMessage({to:msg.from,receipt:msg.id,id:msg.id})}if(msg.receipt){client.emit("receipt",msg);client.emit("receipt:"+msg.receipt)}})}},{}],275:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/register"));client.getAccountInfo=function(jid,cb){return this.sendIq({type:"get",to:jid,register:true},cb)};client.updateAccount=function(jid,data,cb){return this.sendIq({type:"set",to:jid,register:data},cb)};client.deleteAccount=function(jid,cb){return this.sendIq({type:"set",to:jid,register:{remove:true}},cb)}}},{"../stanza/register":329}],276:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/roster"));client.on("iq:set:roster",function(iq){var allowed={};allowed[""]=true;allowed[client.jid.bare]=true;allowed[client.jid.domain]=true;if(!allowed[iq.from.full]){return client.sendIq(iq.errorReply({error:{type:"cancel",condition:"service-unavailable"}}))}client.emit("roster:update",iq);client.sendIq({id:iq.id,type:"result"})});client.getRoster=function(cb){var self=this;cb=cb||function(){};return client.sendIq({type:"get",roster:{ver:self.config.rosterVer}}).then(function(resp){if(resp.roster){var ver=resp.roster.ver;if(ver){self.config.rosterVer=ver;self.emit("roster:ver",ver)}}return resp}).nodeify(cb)};client.updateRosterItem=function(item,cb){return client.sendIq({type:"set",roster:{items:[item]}},cb)};client.removeRosterItem=function(jid,cb){return client.updateRosterItem({jid:jid,subscription:"remove"},cb)};client.subscribe=function(jid){client.sendPresence({type:"subscribe",to:jid})};client.unsubscribe=function(jid){client.sendPresence({type:"unsubscribe",to:jid})};client.acceptSubscription=function(jid){client.sendPresence({type:"subscribed",to:jid})};client.denySubscription=function(jid){client.sendPresence({type:"unsubscribed",to:jid})}}},{"../stanza/roster":330}],277:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/rtt"));client.disco.addFeature("urn:xmpp:rtt:0");client.on("message",function(msg){if(msg.rtt){client.emit("rtt",msg);client.emit("rtt:"+msg.rtt.event,msg)}})}},{"../stanza/rtt":333}],278:[function(require,module,exports){(function(Buffer){"use strict";var NS="urn:ietf:params:xml:ns:xmpp-sasl";module.exports=function(client,stanzas){stanzas.use(require("../stanza/sasl"));var Auth=stanzas.getDefinition("auth",NS);var Response=stanzas.getDefinition("response",NS);client.registerFeature("sasl",100,function(features,cb){var self=this;var mech=self.SASLFactory.create(features.sasl.mechanisms);if(!mech){self.releaseGroup("sasl");self.emit("auth:failed");return cb("disconnect","authentication failed")}self.on("sasl:success","sasl",function(){self.features.negotiated.sasl=true;self.releaseGroup("sasl");self.emit("auth:success",self.config.credentials);cb("restart")});self.on("sasl:challenge","sasl",function(challenge){mech.challenge(challenge.value);self.send(new Response({value:mech.response(self.getCredentials())}));if(mech.cache){Object.keys(mech.cache).forEach(function(key){if(!mech.cache[key]){return}self.config.credentials[key]=new Buffer(mech.cache[key])});self.emit("credentials:update",self.config.credentials)}});self.on("sasl:failure","sasl",function(){self.releaseGroup("sasl");self.emit("auth:failed");cb("disconnect","authentication failed")});self.on("sasl:abort","sasl",function(){self.releaseGroup("sasl");self.emit("auth:failed");cb("disconnect","authentication failed")});var auth={mechanism:mech.name};if(mech.clientFirst){auth.value=mech.response(self.getCredentials())}self.send(new Auth(auth))});client.on("disconnected",function(){client.features.negotiated.sasl=false})}}).call(this,require("buffer").Buffer)},{"../stanza/sasl":334,buffer:5}],279:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/session"));client.registerFeature("session",1e3,function(features,cb){var self=this;if(features.session.optional||self.sessionStarted){self.features.negotiated.session=true;return cb()}self.sendIq({type:"set",session:{}},function(err){if(err){return cb("disconnect","session request failed")}self.features.negotiated.session=true;if(!self.sessionStarted){self.sessionStarted=true;self.emit("session:started",self.jid)}cb()})});client.on("disconnected",function(){client.sessionStarted=false;client.features.negotiated.session=false})}},{"../stanza/session":335}],280:[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/shim";module.exports=function(client,stanzas){stanzas.use(require("../stanza/shim"));client.disco.addFeature(NS);client.disco.addFeature(NS+"#SubID",NS)}},{"../stanza/shim":336}],281:[function(require,module,exports){"use strict";module.exports=function(client,stanzas,config){stanzas.use(require("../stanza/sm"));var smacks=function(features,cb){var self=this;if(!config.useStreamManagement){return cb()}self.on("stream:management:enabled","sm",function(enabled){self.sm.enabled(enabled);self.features.negotiated.streamManagement=true;self.releaseGroup("sm");cb()});self.on("stream:management:resumed","sm",function(resumed){self.sm.resumed(resumed);self.features.negotiated.streamManagement=true;self.features.negotiated.bind=true;self.sessionStarted=true;self.releaseGroup("sm");cb("break")});self.on("stream:management:failed","sm",function(){self.sm.failed();self.emit("session:end");self.releaseGroup("session");self.releaseGroup("sm");cb()});if(!self.sm.id){if(self.features.negotiated.bind){self.sm.enable()}else{cb()}}else if(self.sm.id&&self.sm.allowResume){self.sm.resume()}else{cb()}};client.on("disconnected",function(){client.features.negotiated.streamManagement=false});client.registerFeature("streamManagement",200,smacks);client.registerFeature("streamManagement",500,smacks)}},{"../stanza/sm":337}],282:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/time"));client.disco.addFeature("urn:xmpp:time");client.getTime=function(jid,cb){return this.sendIq({to:jid,type:"get",time:true},cb)};client.on("iq:get:time",function(iq){var time=new Date;client.sendIq(iq.resultReply({time:{utc:time,tzo:time.getTimezoneOffset()}}))})}},{"../stanza/time":341}],283:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/vcard"));client.disco.addFeature("vcard-temp");client.getVCard=function(jid,cb){return this.sendIq({to:jid,type:"get",vCardTemp:true},cb)};client.publishVCard=function(vcard,cb){return this.sendIq({type:"set",vCardTemp:vcard},cb)}}},{"../stanza/vcard":342}],284:[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/version"));client.disco.addFeature("jabber:iq:version");client.on("iq:get:version",function(iq){client.sendIq(iq.resultReply({version:client.config.softwareVersion||{name:"stanza.io"}}))});client.getSoftwareVersion=function(jid,cb){return this.sendIq({to:jid,type:"get",version:true},cb)}}},{"../stanza/version":343}],285:[function(require,module,exports){"use strict";var WSConnection=require("../transports/websocket");module.exports=function(client,stanzas){stanzas.use(require("../stanza/framing"));client.transports.websocket=WSConnection}},{"../stanza/framing":304,"../transports/websocket":347}],286:[function(require,module,exports){"use strict";var MAX_SEQ=Math.pow(2,32);function mod(v,n){return(v%n+n)%n}function StreamManagement(client){this.client=client;this.id=false;this.allowResume=true;this.started=false;this.inboundStarted=false;this.outboundStarted=false;this.lastAck=0;this.handled=0;this.windowSize=1;this.unacked=[];this.pendingAck=false;var NS="urn:xmpp:sm:3";this.stanzas={Enable:client.stanzas.getDefinition("enable",NS),Resume:client.stanzas.getDefinition("resume",NS),Ack:client.stanzas.getDefinition("a",NS),Request:client.stanzas.getDefinition("r",NS)}}StreamManagement.prototype={constructor:{value:StreamManagement},enable:function(){var enable=new this.stanzas.Enable;enable.resume=this.allowResume;this.client.send(enable);this.handled=0;this.outboundStarted=true},resume:function(){var resume=new this.stanzas.Resume({h:this.handled,previd:this.id});this.client.send(resume);this.outboundStarted=true},enabled:function(resp){this.id=resp.id;this.handled=0;this.inboundStarted=true},resumed:function(resp){this.id=resp.previd;if(resp.h){this.process(resp,true)}this.inboundStarted=true},failed:function(){this.inboundStarted=false;this.outboundStarted=false;this.id=false;this.lastAck=0;this.handled=0;this.unacked=[]},ack:function(){this.client.send(new this.stanzas.Ack({h:this.handled}))},request:function(){this.pendingAck=true;this.client.send(new this.stanzas.Request)},process:function(ack,resend){var self=this;var numAcked=mod(ack.h-this.lastAck,MAX_SEQ);this.pendingAck=false;for(var i=0;i<numAcked&&this.unacked.length>0;i++){this.client.emit("stanza:acked",this.unacked.shift())}this.lastAck=ack.h;if(resend){var resendUnacked=this.unacked;this.unacked=[];resendUnacked.forEach(function(stanza){self.client.send(stanza)})}if(this.needAck()){this.request()}},track:function(stanza){var name=stanza._name;var acceptable={message:true,presence:true,iq:true};if(this.outboundStarted&&acceptable[name]){this.unacked.push(stanza);if(this.needAck()){this.request()}}},handle:function(){if(this.inboundStarted){this.handled=mod(this.handled+1,MAX_SEQ)}},needAck:function(){return!this.pendingAck&&this.unacked.length>=this.windowSize}};Object.defineProperties(StreamManagement.prototype,{started:{get:function(){return this.outboundStarted&&this.inboundStarted},set:function(value){if(!value){this.outboundStarted=false;this.inboundStarted=false}}}});module.exports=StreamManagement},{}],287:[function(require,module,exports){"use strict";var _=require("underscore");module.exports=function(stanza){var types=stanza.utils;var Avatar=stanza.define({name:"avatar",namespace:"urn:xmpp:avatar:metadata",element:"info",fields:{id:types.attribute("id"),bytes:types.attribute("bytes"),height:types.attribute("height"),width:types.attribute("width"),type:types.attribute("type","image/png"),url:types.attribute("url")}});var avatars={get:function(){var metadata=types.find(this.xml,"urn:xmpp:avatar:metadata","metadata");var results=[];if(metadata.length){var avatars=types.find(metadata[0],"urn:xmpp:avatar:metadata","info");_.forEach(avatars,function(info){results.push(new Avatar({},info))})}return results},set:function(value){var metadata=types.findOrCreate(this.xml,"urn:xmpp:avatar:metadata","metadata");types.setAttribute(metadata,"xmlns","urn:xmpp:avatar:metadata");_.forEach(value,function(info){var avatar=new Avatar(info);metadata.appendChild(avatar.xml)})}};stanza.withPubsubItem(function(Item){stanza.add(Item,"avatars",avatars);stanza.add(Item,"avatarData",types.textSub("urn:xmpp:avatar:data","data"))})}},{underscore:448}],288:[function(require,module,exports){"use strict";var NS="urn:ietf:params:xml:ns:xmpp-bind";module.exports=function(stanza){var types=stanza.utils;var Bind=stanza.define({name:"bind",namespace:NS,element:"bind",fields:{resource:types.textSub(NS,"resource"),jid:types.jidSub(NS,"jid")}});stanza.withIq(function(Iq){stanza.extend(Iq,Bind)});stanza.withStreamFeatures(function(StreamFeatures){stanza.extend(StreamFeatures,Bind)})}},{}],289:[function(require,module,exports){"use strict";var JID=require("xmpp-jid").JID;var NS="urn:xmpp:blocking";module.exports=function(stanza){var types=stanza.utils;var jids={get:function(){var result=[];var items=types.find(this.xml,NS,"item");if(!items.length){return result}items.forEach(function(item){result.push(new JID(types.getAttribute(item,"jid","")))});return result},set:function(values){var self=this;values.forEach(function(value){var item=types.createElement(NS,"item",NS);types.setAttribute(item,"jid",value.toString());self.xml.appendChild(item)})}};var Block=stanza.define({name:"block",namespace:NS,element:"block",fields:{jids:jids}});var Unblock=stanza.define({name:"unblock",namespace:NS,element:"unblock",fields:{jids:jids}});var BlockList=stanza.define({name:"blockList",namespace:NS,element:"blocklist",fields:{jids:jids}});stanza.withIq(function(Iq){stanza.extend(Iq,Block);stanza.extend(Iq,Unblock);stanza.extend(Iq,BlockList)})}},{"xmpp-jid":450}],290:[function(require,module,exports){"use strict";var NS="urn:xmpp:bob";module.exports=function(stanza){var types=stanza.utils;var BOB=stanza.define({name:"bob",namespace:NS,element:"data",fields:{cid:types.attribute("cid"),maxAge:types.numberAttribute("max-age"),type:types.attribute("type"),data:types.text()}});stanza.withIq(function(Iq){stanza.extend(Iq,BOB)});stanza.withMessage(function(Message){stanza.extend(Message,BOB)});stanza.withPresence(function(Presence){stanza.extend(Presence,BOB)})}},{}],291:[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;var Conference=stanza.define({name:"_conference",namespace:"storage:bookmarks",element:"conference",fields:{name:types.attribute("name"),autoJoin:types.boolAttribute("autojoin"),jid:types.jidAttribute("jid"),nick:types.textSub("storage:bookmarks","nick")}});var Bookmarks=stanza.define({name:"bookmarks",namespace:"storage:bookmarks",element:"storage"});stanza.extend(Bookmarks,Conference,"conferences");stanza.withDefinition("query","jabber:iq:private",function(PrivateStorage){stanza.extend(PrivateStorage,Bookmarks)})}},{}],292:[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/httpbind";var XMPP_NS="urn:xmpp:xbosh";module.exports=function(stanza){var types=stanza.utils;stanza.define({name:"bosh",namespace:NS,element:"body",prefixes:{xmpp:XMPP_NS},fields:{accept:types.attribute("accept"),ack:types.numberAttribute("ack"),authid:types.attribute("authid"),charsets:types.attribute("charsets"),condition:types.attribute("condition"),content:types.attribute("content"),from:types.jidAttribute("from",true),hold:types.numberAttribute("hold"),inactivity:types.numberAttribute("inactivity"),key:types.attribute("key"),maxpause:types.numberAttribute("maxpause"),newKey:types.attribute("newkey"),pause:types.numberAttribute("pause"),polling:types.numberAttribute("polling"),resport:types.numberAttribute("report"),requests:types.numberAttribute("requests"),rid:types.numberAttribute("rid"),sid:types.attribute("sid"),stream:types.attribute("stream"),time:types.attribute("time"),to:types.jidAttribute("to",true),type:types.attribute("type"),ver:types.attribute("ver"),wait:types.numberAttribute("wait"),uri:types.textSub(NS,"uri"),lang:types.langAttribute(),version:types.attribute("xmpp:version","1.0"),restart:types.attribute("xmpp:restart"),restartLogic:types.boolAttribute("xmpp:restartLogic"),payload:{get:function(){var results=[];for(var i=0,len=this.xml.childNodes.length;i<len;i++){var obj=stanza.build(this.xml.childNodes[i]);if(obj!==undefined){results.push(obj)}}return results},set:function(values){var self=this;values.forEach(function(types){self.xml.appendChild(types.xml)})}}}})}},{}],293:[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;var Caps=stanza.define({name:"caps",namespace:"http://jabber.org/protocol/caps",element:"c",fields:{ver:types.attribute("ver"),node:types.attribute("node"),hash:types.attribute("hash"),ext:types.attribute("ext")}});stanza.withPresence(function(Presence){stanza.extend(Presence,Caps)});stanza.withStreamFeatures(function(StreamFeatures){stanza.extend(StreamFeatures,Caps)})}},{}],294:[function(require,module,exports){"use strict";module.exports=function(stanza){var Sent=stanza.define({name:"carbonSent",eventName:"carbon:sent",namespace:"urn:xmpp:carbons:2",element:"sent"});var Received=stanza.define({name:"carbonReceived",eventName:"carbon:received",namespace:"urn:xmpp:carbons:2",element:"received"});var Private=stanza.define({name:"carbonPrivate",eventName:"carbon:private",namespace:"urn:xmpp:carbons:2",element:"private"});var Enable=stanza.define({name:"enableCarbons",namespace:"urn:xmpp:carbons:2",element:"enable"});var Disable=stanza.define({name:"disableCarbons",namespace:"urn:xmpp:carbons:2",element:"disable"});stanza.withDefinition("forwarded","urn:xmpp:forward:0",function(Forwarded){stanza.extend(Sent,Forwarded);stanza.extend(Received,Forwarded)});stanza.withMessage(function(Message){stanza.extend(Message,Sent);stanza.extend(Message,Received);stanza.extend(Message,Private)});stanza.withIq(function(Iq){stanza.extend(Iq,Enable);stanza.extend(Iq,Disable)})}},{}],295:[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/commands";var ACTIONS=["next","prev","complete","cancel"];var CONDITIONS=["bad-action","bad-locale","bad-payload","bad-sessionid","malformed-action","session-expired"];module.exports=function(stanza){var types=stanza.utils;var Command=stanza.define({name:"command",namespace:NS,element:"command",fields:{action:types.attribute("action"),node:types.attribute("node"),sessionid:types.attribute("sessionid"),status:types.attribute("status"),execute:types.subAttribute(NS,"actions","execute"),actions:{get:function(){var result=[];var actionSet=types.find(this.xml,NS,"actions");if(!actionSet.length){return[]}ACTIONS.forEach(function(action){var existing=types.find(actionSet[0],NS,action);if(existing.length){result.push(action)}});return result},set:function(values){var actionSet=types.findOrCreate(this.xml,NS,"actions");for(var i=0,len=actionSet.childNodes.length;i<len;i++){actionSet.removeChild(actionSet.childNodes[i])}values.forEach(function(value){actionSet.appendChild(types.createElement(NS,value.toLowerCase(),NS))})}}}});var Note=stanza.define({name:"_commandNote",namespace:NS,element:"note",fields:{type:types.attribute("type"),value:types.text()}});stanza.extend(Command,Note,"notes");stanza.withStanzaError(function(ErrorStanza){stanza.add(ErrorStanza,"adhocCommandCondition",types.enumSub(NS,CONDITIONS))});stanza.withDataForm(function(DataForm){stanza.extend(Command,DataForm)});stanza.withIq(function(Iq){stanza.extend(Iq,Command)})}},{}],296:[function(require,module,exports){"use strict";var NS="urn:xmpp:csi";module.exports=function(stanza){var CSIFeature=stanza.define({name:"clientStateIndication",namespace:NS,element:"csi"});stanza.define({name:"csiActive",eventName:"csi:active",namespace:NS,element:"active",topLevel:true});stanza.define({name:"csiInactive",eventName:"csi:inactive",namespace:NS,element:"inactive",topLevel:true});stanza.withStreamFeatures(function(StreamFeatures){stanza.extend(StreamFeatures,CSIFeature)})}},{}],297:[function(require,module,exports){"use strict";var JID=require("xmpp-jid").JID;var FORM_NS="jabber:x:data";var MEDIA_NS="urn:xmpp:media-element";var VALIDATE_NS="http://jabber.org/protocol/xdata-validate";var LAYOUT_NS="http://jabber.org/protocol/xdata-layout";var SINGLE_FIELDS=["text-single","text-private","list-single","jid-single"];module.exports=function(stanza){var types=stanza.utils;var Field=stanza.define({name:"_field",namespace:FORM_NS,element:"field",init:function(data){this._type=(data||{}).type||this.type},fields:{type:{get:function(){return types.getAttribute(this.xml,"type","text-single")},set:function(value){this._type=value;types.setAttribute(this.xml,"type",value)}},name:types.attribute("var"),desc:types.textSub(FORM_NS,"desc"),required:types.boolSub(FORM_NS,"required"),label:types.attribute("label"),value:{get:function(){var vals=types.getMultiSubText(this.xml,FORM_NS,"value");if(this._type==="boolean"){return vals[0]==="1"||vals[0]==="true"}if(vals.length>1){if(this._type==="text-multi"){return vals.join("\n")}if(this._type==="jid-multi"){return vals.map(function(jid){return new JID(jid)})}return vals}if(SINGLE_FIELDS.indexOf(this._type)>=0){if(this._type==="jid-single"){return new JID(vals[0])}return vals[0]}return vals},set:function(value){if(this._type==="boolean"){var truthy=value===true||value==="true"||value==="1";types.setSubText(this.xml,FORM_NS,"value",truthy?"1":"0")}else{if(this._type==="text-multi"&&typeof value==="string"){value=value.split("\n")}types.setMultiSubText(this.xml,FORM_NS,"value",value)}}}}});var Option=stanza.define({name:"_formoption",namespace:FORM_NS,element:"option",fields:{label:types.attribute("label"),value:types.textSub(FORM_NS,"value")}});var Item=stanza.define({name:"_formitem",namespace:FORM_NS,element:"item"});var Media=stanza.define({name:"media",element:"media",namespace:MEDIA_NS,fields:{height:types.numberAttribute("height"),width:types.numberAttribute("width")}});var MediaURI=stanza.define({name:"_mediaURI",element:"uri",namespace:MEDIA_NS,fields:{uri:types.text(),type:types.attribute("type")}});var Validation=stanza.define({name:"validation",element:"validate",namespace:VALIDATE_NS,fields:{dataType:types.attribute("datatype"),basic:types.boolSub(VALIDATE_NS,"basic"),open:types.boolSub(VALIDATE_NS,"open"),regex:types.textSub(VALIDATE_NS,"regex")}});var Range=stanza.define({name:"range",element:"range",namespace:VALIDATE_NS,fields:{min:types.attribute("min"),max:types.attribute("max")}});var ListRange=stanza.define({name:"select",element:"list-range",namespace:VALIDATE_NS,fields:{min:types.numberAttribute("min"),max:types.numberAttribute("max")}});var layoutContents={get:function(){var result=[];for(var i=0,len=this.xml.childNodes.length;i<len;i++){var child=this.xml.childNodes[i];if(child.namespaceURI!==LAYOUT_NS){continue}switch(child.localName){case"text":result.push({text:child.textContent});break;case"fieldref":result.push({field:child.getAttribute("var")});break;case"reportedref":result.push({reported:true});break;case"section":result.push({section:new Section(null,child,this).toJSON()});break}}return result},set:function(values){for(var i=0,len=values.length;i<len;i++){var value=values[i];if(value.text){var text=stanza.createElement(LAYOUT_NS,"text",LAYOUT_NS);text.textContent=value.text;this.xml.appendChild(text)}if(value.field){var field=stanza.createElement(LAYOUT_NS,"fieldref",LAYOUT_NS);field.setAttribute("var",value.field);this.xml.appendChild(field)}if(value.reported){this.xml.appendChild(stanza.createElement(LAYOUT_NS,"reportedref",LAYOUT_NS))}if(value.section){var sectionXML=stanza.createElement(LAYOUT_NS,"section",LAYOUT_NS);this.xml.appendChild(sectionXML);var section=new Section(null,sectionXML);section.label=value.section.label;section.contents=value.section.contents}}}};var Section=stanza.define({name:"_section",element:"section",namespace:LAYOUT_NS,fields:{label:types.attribute("label"),contents:layoutContents}});var Page=stanza.define({name:"_page",element:"page",namespace:LAYOUT_NS,fields:{label:types.attribute("label"),contents:layoutContents}});
var DataForm=stanza.define({name:"form",namespace:FORM_NS,element:"x",init:function(){if(!this.reportedFields.length){return}var fieldTypes={};this.reportedFields.forEach(function(reported){fieldTypes[reported.name]=reported.type});this.items.forEach(function(item){item.fields.forEach(function(field){field.type=field._type=fieldTypes[field.name]})})},fields:{title:types.textSub(FORM_NS,"title"),instructions:types.multiTextSub(FORM_NS,"instructions"),type:types.attribute("type","form"),reportedFields:types.subMultiExtension(FORM_NS,"reported",Field)}});stanza.extend(DataForm,Field,"fields");stanza.extend(DataForm,Item,"items");stanza.extend(DataForm,Page,"layout");stanza.extend(Field,Media);stanza.extend(Field,Validation);stanza.extend(Field,Option,"options");stanza.extend(Item,Field,"fields");stanza.extend(Media,MediaURI,"uris");stanza.extend(Validation,Range);stanza.extend(Validation,ListRange);stanza.withMessage(function(Message){stanza.extend(Message,DataForm)})}},{"xmpp-jid":450}],298:[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;var DelayedDelivery=stanza.define({name:"delay",namespace:"urn:xmpp:delay",element:"delay",fields:{from:types.jidAttribute("from"),stamp:types.dateAttribute("stamp"),reason:types.text()}});stanza.withMessage(function(Message){stanza.extend(Message,DelayedDelivery)});stanza.withPresence(function(Presence){stanza.extend(Presence,DelayedDelivery)})}},{}],299:[function(require,module,exports){"use strict";var NSInfo="http://jabber.org/protocol/disco#info";var NSItems="http://jabber.org/protocol/disco#items";module.exports=function(stanza){var types=stanza.utils;var DiscoInfo=stanza.define({name:"discoInfo",namespace:NSInfo,element:"query",fields:{node:types.attribute("node"),features:types.multiSubAttribute(NSInfo,"feature","var")}});var DiscoIdentity=stanza.define({name:"_discoIdentity",namespace:NSInfo,element:"identity",fields:{category:types.attribute("category"),type:types.attribute("type"),name:types.attribute("name"),lang:types.langAttribute()}});var DiscoItems=stanza.define({name:"discoItems",namespace:NSItems,element:"query",fields:{node:types.attribute("node")}});var DiscoItem=stanza.define({name:"_discoItem",namespace:NSItems,element:"item",fields:{jid:types.jidAttribute("jid"),node:types.attribute("node"),name:types.attribute("name")}});stanza.extend(DiscoItems,DiscoItem,"items");stanza.extend(DiscoInfo,DiscoIdentity,"identities");stanza.withIq(function(Iq){stanza.extend(Iq,DiscoInfo);stanza.extend(Iq,DiscoItems)});stanza.withDataForm(function(DataForm){stanza.extend(DiscoInfo,DataForm,"extensions")});stanza.withDefinition("set","http://jabber.org/protocol/rsm",function(RSM){stanza.extend(DiscoItems,RSM)})}},{}],300:[function(require,module,exports){"use strict";var ERR_NS="urn:ietf:params:xml:ns:xmpp-stanzas";var CONDITIONS=["bad-request","conflict","feature-not-implemented","forbidden","gone","internal-server-error","item-not-found","jid-malformed","not-acceptable","not-allowed","not-authorized","payment-required","recipient-unavailable","redirect","registration-required","remote-server-not-found","remote-server-timeout","resource-constraint","service-unavailable","subscription-required","undefined-condition","unexpected-request"];module.exports=function(stanza){var types=stanza.utils;var ErrorStanza=stanza.define({name:"error",namespace:"jabber:client",element:"error",fields:{lang:{get:function(){return(this.parent||{}).lang||""}},condition:types.enumSub(ERR_NS,CONDITIONS),gone:{get:function(){return types.getSubText(this.xml,ERR_NS,"gone")},set:function(value){this.condition="gone";types.setSubText(this.xml,ERR_NS,"gone",value)}},redirect:{get:function(){return types.getSubText(this.xml,ERR_NS,"redirect")},set:function(value){this.condition="redirect";types.setSubText(this.xml,ERR_NS,"redirect",value)}},code:types.attribute("code"),type:types.attribute("type"),by:types.jidAttribute("by"),$text:{get:function(){return types.getSubLangText(this.xml,ERR_NS,"text",this.lang)}},text:{get:function(){var text=this.$text;return text[this.lang]||""},set:function(value){types.setSubLangText(this.xml,ERR_NS,"text",value,this.lang)}}}});stanza.withMessage(function(Message){stanza.extend(Message,ErrorStanza)});stanza.withPresence(function(Presence){stanza.extend(Presence,ErrorStanza)});stanza.withIq(function(Iq){stanza.extend(Iq,ErrorStanza)})}},{}],301:[function(require,module,exports){"use strict";var NS="urn:xmpp:extdisco:1";module.exports=function(stanza){var types=stanza.utils;var Services=exports.Services=stanza.define({name:"services",namespace:NS,element:"services",fields:{type:types.attribute("type")}});var Credentials=exports.Credentials=stanza.define({name:"credentials",namespace:NS,element:"credentials"});var Service=stanza.define({name:"service",namespace:NS,element:"service",fields:{host:types.attribute("host"),port:types.attribute("port"),transport:types.attribute("transport"),type:types.attribute("type"),username:types.attribute("username"),password:types.attribute("password")}});stanza.extend(Services,Service,"services");stanza.extend(Credentials,Service);stanza.withDataForm(function(DataForm){stanza.extend(Service,DataForm)});stanza.withIq(function(Iq){stanza.extend(Iq,Services);stanza.extend(Iq,Credentials)})}},{}],302:[function(require,module,exports){"use strict";var NS="urn:xmpp:jingle:apps:file-transfer:3";var TB_NS="urn:xmpp:thumbs:0";module.exports=function(stanza){var types=stanza.utils;var File=stanza.define({name:"_file",namespace:NS,element:"file",fields:{name:types.textSub(NS,"name"),desc:types.textSub(NS,"desc"),size:types.numberSub(NS,"size"),date:types.dateSub(NS,"date")}});var Range=stanza.define({name:"range",namespace:NS,element:"range",fields:{offset:types.numberAttribute("offset")}});var Thumbnail=stanza.define({name:"thumbnail",namespace:TB_NS,element:"thumbnail",fields:{cid:types.attribute("cid"),mimeType:types.attribute("mime-type"),width:types.numberAttribute("width"),height:types.numberAttribute("height")}});var FileTransfer=stanza.define({name:"_filetransfer",namespace:NS,element:"description",tags:["jingle-description"],fields:{descType:{value:"filetransfer"},offer:types.subExtension("offer",NS,"offer",File),request:types.subExtension("request",NS,"request",File)}});stanza.extend(File,Range);stanza.extend(File,Thumbnail);stanza.withDefinition("hash","urn:xmpp:hashes:1",function(Hash){stanza.extend(File,Hash,"hashes")});stanza.withDefinition("content","urn:xmpp:jingle:1",function(Content){stanza.extend(Content,FileTransfer)})}},{}],303:[function(require,module,exports){"use strict";module.exports=function(stanza){var Forwarded=stanza.define({name:"forwarded",eventName:"forward",namespace:"urn:xmpp:forward:0",element:"forwarded"});stanza.withMessage(function(Message){stanza.extend(Message,Forwarded);stanza.extend(Forwarded,Message)});stanza.withPresence(function(Presence){stanza.extend(Forwarded,Presence)});stanza.withIq(function(Iq){stanza.extend(Forwarded,Iq)});stanza.withDefinition("delay","urn:xmpp:delay",function(Delayed){stanza.extend(Forwarded,Delayed)})}},{}],304:[function(require,module,exports){"use strict";var NS="urn:ietf:params:xml:ns:xmpp-framing";module.exports=function(stanza){var types=stanza.utils;stanza.define({name:"openStream",namespace:NS,element:"open",topLevel:true,fields:{lang:types.langAttribute(),id:types.attribute("id"),version:types.attribute("version","1.0"),to:types.jidAttribute("to",true),from:types.jidAttribute("from",true)}});stanza.define({name:"closeStream",namespace:NS,element:"close",topLevel:true,fields:{seeOtherURI:types.attribute("see-other-uri")}})}},{}],305:[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/geoloc";module.exports=function(stanza){var types=stanza.utils;var GeoLoc=stanza.define({name:"geoloc",namespace:NS,element:"geoloc",fields:{accuracy:types.numberSub(NS,"accuracy",true),altitude:types.numberSub(NS,"alt",true),area:types.textSub(NS,"area"),heading:types.numberSub(NS,"bearing",true),bearing:types.numberSub(NS,"bearing",true),building:types.textSub(NS,"building"),country:types.textSub(NS,"country"),countrycode:types.textSub(NS,"countrycode"),datum:types.textSub(NS,"datum"),description:types.textSub(NS,"description"),error:types.numberSub(NS,"error",true),floor:types.textSub(NS,"floor"),latitude:types.numberSub(NS,"lat",true),locality:types.textSub(NS,"locality"),longitude:types.numberSub(NS,"lon",true),postalcode:types.textSub(NS,"postalcode"),region:types.textSub(NS,"region"),room:types.textSub(NS,"room"),speed:types.numberSub(NS,"speed",true),street:types.textSub(NS,"street"),text:types.textSub(NS,"text"),timestamp:types.dateSub(NS,"timestamp"),tzo:types.tzoSub(NS,"tzo"),uri:types.textSub(NS,"uri")}});stanza.withPubsubItem(function(Item){stanza.extend(Item,GeoLoc)})}},{}],306:[function(require,module,exports){"use strict";module.exports=function(stanza){stanza.define({name:"hash",namespace:"urn:xmpp:hashes:1",element:"hash",fields:{algo:stanza.utils.attribute("algo"),value:stanza.utils.text()}})}},{}],307:[function(require,module,exports){"use strict";var NS="urn:xmpp:hats:0";module.exports=function(stanza){var types=stanza.utils;var Hat=stanza.define({name:"_hat",namespace:NS,element:"hat",fields:{lang:types.langAttribute(),name:types.attribute("name"),displayName:types.attribute("displayName")}});stanza.withPresence(function(Presence){stanza.add(Presence,"hats",types.subMultiExtension(NS,"hats",Hat))})}},{}],308:[function(require,module,exports){"use strict";var NS="urn:xmpp:jingle:transports:ice-udp:1";module.exports=function(stanza){var types=stanza.utils;var ICE=stanza.define({name:"_iceUdp",namespace:NS,element:"transport",tags:["jingle-transport"],fields:{transType:{value:"iceUdp"},pwd:types.attribute("pwd"),ufrag:types.attribute("ufrag")}});var RemoteCandidate=stanza.define({name:"remoteCandidate",namespace:NS,element:"remote-candidate",fields:{component:types.attribute("component"),ip:types.attribute("ip"),port:types.attribute("port")}});var Candidate=stanza.define({name:"_iceUdpCandidate",namespace:NS,element:"candidate",fields:{component:types.attribute("component"),foundation:types.attribute("foundation"),generation:types.attribute("generation"),id:types.attribute("id"),ip:types.attribute("ip"),network:types.attribute("network"),port:types.attribute("port"),priority:types.attribute("priority"),protocol:types.attribute("protocol"),relAddr:types.attribute("rel-addr"),relPort:types.attribute("rel-port"),tcpType:types.attribute("tcptype"),type:types.attribute("type")}});var Fingerprint=stanza.define({name:"_iceFingerprint",namespace:"urn:xmpp:jingle:apps:dtls:0",element:"fingerprint",fields:{hash:types.attribute("hash"),setup:types.attribute("setup"),value:types.text(),required:types.boolAttribute("required")}});var SctpMap=stanza.define({name:"_sctpMap",namespace:"urn:xmpp:jingle:transports:dtls-sctp:1",element:"sctpmap",fields:{number:types.attribute("number"),protocol:types.attribute("protocol"),streams:types.attribute("streams")}});stanza.extend(ICE,Candidate,"candidates");stanza.extend(ICE,RemoteCandidate);stanza.extend(ICE,Fingerprint,"fingerprints");stanza.extend(ICE,SctpMap,"sctp");stanza.withDefinition("content","urn:xmpp:jingle:1",function(Content){stanza.extend(Content,ICE)})}},{}],309:[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;var Iq=stanza.define({name:"iq",namespace:"jabber:client",element:"iq",topLevel:true,fields:{lang:types.langAttribute(),id:types.attribute("id"),to:types.jidAttribute("to",true),from:types.jidAttribute("from",true),type:types.attribute("type")}});var toJSON=Iq.prototype.toJSON;Iq.prototype.toJSON=function(){var result=toJSON.call(this);result.resultReply=this.resultReply;result.errorReply=this.errorReply;return result};Iq.prototype.resultReply=function(data){data=data||{};data.to=this.from;data.id=this.id;data.type="result";return new Iq(data)};Iq.prototype.errorReply=function(data){data=data||{};data.to=this.from;data.id=this.id;data.type="error";return new Iq(data)}}},{}],310:[function(require,module,exports){"use strict";var JID=require("xmpp-jid").JID;var NS="urn:xmpp:jidprep:0";module.exports=function(stanza){var types=stanza.utils;stanza.withIq(function(Iq){stanza.add(Iq,"jidPrep",{get:function(){var data=types.getSubText(this.xml,NS,"jid");if(data){var jid=new JID(data);jid.prepped=true;return jid}},set:function(value){types.setSubText(this.xml,NS,"jid",(value||"").toString())}})})}},{"xmpp-jid":450}],311:[function(require,module,exports){"use strict";var NS="urn:xmpp:jingle:1";var ERRNS="urn:xmpp:jingle:errors:1";var CONDITIONS=["out-of-order","tie-break","unknown-session","unsupported-info"];var REASONS=["alternative-session","busy","cancel","connectivity-error","decline","expired","failed-application","failed-transport","general-error","gone","incompatible-parameters","media-error","security-error","success","timeout","unsupported-applications","unsupported-transports"];module.exports=function(stanza){var types=stanza.utils;var Jingle=stanza.define({name:"jingle",namespace:NS,element:"jingle",fields:{action:types.attribute("action"),initiator:types.attribute("initiator"),responder:types.attribute("responder"),sid:types.attribute("sid")}});var Content=stanza.define({name:"_jingleContent",namespace:NS,element:"content",fields:{creator:types.attribute("creator"),disposition:types.attribute("disposition","session"),name:types.attribute("name"),senders:types.attribute("senders","both"),description:{get:function(){var opts=stanza.tagged("jingle-description").map(function(Description){return Description.prototype._name});for(var i=0,len=opts.length;i<len;i++){if(this._extensions[opts[i]]){return this._extensions[opts[i]]}}},set:function(value){var ext="_"+value.descType;this[ext]=value}},transport:{get:function(){var opts=stanza.tagged("jingle-transport").map(function(Transport){return Transport.prototype._name});for(var i=0,len=opts.length;i<len;i++){if(this._extensions[opts[i]]){return this._extensions[opts[i]]}}},set:function(value){var ext="_"+value.transType;this[ext]=value}}}});var Reason=stanza.define({name:"reason",namespace:NS,element:"reason",fields:{condition:types.enumSub(NS,REASONS),alternativeSession:{get:function(){return types.getSubText(this.xml,NS,"alternative-session")},set:function(value){this.condition="alternative-session";types.setSubText(this.xml,NS,"alternative-session",value)}},text:types.textSub(NS,"text")}});stanza.extend(Jingle,Content,"contents");stanza.extend(Jingle,Reason);stanza.withStanzaError(function(ErrorStanza){stanza.add(ErrorStanza,"jingleCondition",types.enumSub(ERRNS,CONDITIONS))});stanza.withIq(function(Iq){stanza.extend(Iq,Jingle)})}},{}],312:[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;var JSONExtension={get:function(){var data=types.getSubText(this.xml,"urn:xmpp:json:0","json");if(data){return JSON.parse(data)}},set:function(value){value=JSON.stringify(value);if(value){types.setSubText(this.xml,"urn:xmpp:json:0","json",value)}}};stanza.withMessage(function(Message){stanza.add(Message,"json",JSONExtension)});stanza.withPubsubItem(function(Item){stanza.add(Item,"json",JSONExtension)})}},{}],313:[function(require,module,exports){"use strict";var NS="urn:xmpp:eventlog";module.exports=function(stanza){var types=stanza.utils;var Log=stanza.define({name:"log",namespace:NS,element:"log",fields:{id:types.attribute("id"),timestamp:types.dateAttribute("timestamp"),type:types.attribute("type"),level:types.attribute("level"),object:types.attribute("object"),subject:types.attribute("subject"),facility:types.attribute("facility"),module:types.attribute("module"),message:types.textSub(NS,"message"),stackTrace:types.textSub(NS,"stackTrace")}});var Tag=stanza.define({name:"_logtag",namespace:NS,element:"tag",fields:{name:types.attribute("name"),value:types.attribute("value"),type:types.attribute("type")}});stanza.extend(Log,Tag,"tags");stanza.withMessage(function(Message){stanza.extend(Message,Log)});stanza.withPubsubItem(function(Item){stanza.extend(Item,Log)})}},{}],314:[function(require,module,exports){"use strict";var JID=require("xmpp-jid").JID;var NS="urn:xmpp:mam:0";module.exports=function(stanza){var types=stanza.utils;var MAMQuery=stanza.define({name:"mam",namespace:NS,element:"query",fields:{queryid:types.attribute("queryid")}});var Result=stanza.define({name:"mamItem",namespace:NS,element:"result",fields:{queryid:types.attribute("queryid"),id:types.attribute("id")}});var Fin=stanza.define({name:"mamResult",namespace:NS,element:"fin",fields:{queryid:types.attribute("queryid"),complete:types.boolAttribute("complete"),stable:types.boolAttribute("stable")}});var Prefs=stanza.define({name:"mamPrefs",namespace:NS,element:"prefs",fields:{defaultCondition:types.attribute("default"),always:{get:function(){var results=[];var container=types.find(this.xml,NS,"always");if(container.length===0){return results}container=container[0];var jids=types.getMultiSubText(container,NS,"jid");jids.forEach(function(jid){results.push(new JID(jid.textContent))});return results},set:function(value){if(value.length>0){var container=types.find(this.xml,NS,"always");types.setMultiSubText(container,NS,"jid",value)}}},never:{get:function(){var results=[];var container=types.find(this.xml,NS,"always");if(container.length===0){return results}container=container[0];var jids=types.getMultiSubText(container,NS,"jid");jids.forEach(function(jid){results.push(new JID(jid.textContent))});return results},set:function(value){if(value.length>0){var container=types.find(this.xml,NS,"never");types.setMultiSubText(container,NS,"jid",value)}}}}});stanza.withDefinition("forwarded","urn:xmpp:forward:0",function(Forwarded){stanza.extend(Result,Forwarded)});stanza.withDefinition("set","http://jabber.org/protocol/rsm",function(RSM){stanza.extend(MAMQuery,RSM);stanza.extend(Fin,RSM)});stanza.withDataForm(function(DataForm){stanza.extend(MAMQuery,DataForm)});stanza.withIq(function(Iq){stanza.extend(Iq,MAMQuery);stanza.extend(Iq,Prefs)});stanza.withMessage(function(Message){stanza.extend(Message,Result);stanza.extend(Message,Fin)})}},{"xmpp-jid":450}],315:[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;stanza.define({name:"message",namespace:"jabber:client",element:"message",topLevel:true,fields:{lang:types.langAttribute(),id:types.attribute("id"),to:types.jidAttribute("to",true),from:types.jidAttribute("from",true),type:types.attribute("type","normal"),thread:types.textSub("jabber:client","thread"),parentThread:types.subAttribute("jabber:client","thread","parent"),subject:types.textSub("jabber:client","subject"),$body:{get:function(){return types.getSubLangText(this.xml,this._NS,"body",this.lang)}},body:{get:function(){var bodies=this.$body;return bodies[this.lang]||""},set:function(value){types.setSubLangText(this.xml,this._NS,"body",value,this.lang)}},attention:types.boolSub("urn:xmpp:attention:0","attention"),chatState:types.enumSub("http://jabber.org/protocol/chatstates",["active","composing","paused","inactive","gone"]),replace:types.subAttribute("urn:xmpp:message-correct:0","replace","id"),requestReceipt:types.boolSub("urn:xmpp:receipts","request"),receipt:types.subAttribute("urn:xmpp:receipts","received","id")}})}},{}],316:[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/mood";var MOODS=["afraid","amazed","amorous","angry","annoyed","anxious","aroused","ashamed","bored","brave","calm","cautious","cold","confident","confused","contemplative","contented","cranky","crazy","creative","curious","dejected","depressed","disappointed","disgusted","dismayed","distracted","embarrassed","envious","excited","flirtatious","frustrated","grateful","grieving","grumpy","guilty","happy","hopeful","hot","humbled","humiliated","hungry","hurt","impressed","in_awe","in_love","indignant","interested","intoxicated","invincible","jealous","lonely","lucky","mean","moody","nervous","neutral","offended","outraged","playful","proud","relaxed","relieved","remorseful","restless","sad","sarcastic","serious","shocked","shy","sick","sleepy","spontaneous","stressed","strong","surprised","thankful","thirsty","tired","undefined","weak","worried"];module.exports=function(stanza){var Mood=stanza.define({name:"mood",namespace:NS,element:"mood",fields:{text:stanza.utils.textSub(NS,"text"),value:stanza.utils.enumSub(NS,MOODS)}});stanza.withPubsubItem(function(Item){stanza.extend(Item,Mood)});stanza.withMessage(function(Message){stanza.extend(Message,Mood)})}},{}],317:[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/muc";var USER_NS=NS+"#user";var ADMIN_NS=NS+"#admin";var OWNER_NS=NS+"#owner";var UNIQ_NS=NS+"#unique";var proxy=function(child,field){return{get:function(){if(this._extensions[child]){return this[child][field]}},set:function(value){this[child][field]=value}}};module.exports=function(stanza){var types=stanza.utils;var UserItem=stanza.define({name:"_mucUserItem",namespace:USER_NS,element:"item",fields:{affiliation:types.attribute("affiliation"),nick:types.attribute("nick"),jid:types.jidAttribute("jid"),role:types.attribute("role"),reason:types.textSub(USER_NS,"reason")}});var UserActor=stanza.define({name:"_mucUserActor",namespace:USER_NS,element:"actor",fields:{nick:types.attribute("nick"),jid:types.jidAttribute("jid")}});var Destroyed=stanza.define({name:"destroyed",namespace:USER_NS,element:"destroy",fields:{jid:types.jidAttribute("jid"),reason:types.textSub(USER_NS,"reason")}});var Invite=stanza.define({name:"invite",namespace:USER_NS,element:"invite",fields:{to:types.jidAttribute("to"),from:types.jidAttribute("from"),reason:types.textSub(USER_NS,"reason"),thread:types.subAttribute(USER_NS,"continue","thread"),"continue":types.boolSub(USER_NS,"continue")}});var Decline=stanza.define({name:"decline",namespace:USER_NS,element:"decline",fields:{to:types.jidAttribute("to"),from:types.jidAttribute("from"),reason:types.textSub(USER_NS,"reason")}});var AdminItem=stanza.define({name:"_mucAdminItem",namespace:ADMIN_NS,element:"item",fields:{affiliation:types.attribute("affiliation"),nick:types.attribute("nick"),jid:types.jidAttribute("jid"),role:types.attribute("role"),reason:types.textSub(ADMIN_NS,"reason")}});var AdminActor=stanza.define({name:"actor",namespace:USER_NS,element:"actor",fields:{nick:types.attribute("nick"),jid:types.jidAttribute("jid")}});var Destroy=stanza.define({name:"destroy",namespace:OWNER_NS,element:"destroy",fields:{jid:types.jidAttribute("jid"),password:types.textSub(OWNER_NS,"password"),reason:types.textSub(OWNER_NS,"reason")}});var MUC=stanza.define({name:"muc",namespace:USER_NS,element:"x",fields:{affiliation:proxy("_mucUserItem","affiliation"),nick:proxy("_mucUserItem","nick"),jid:proxy("_mucUserItem","jid"),role:proxy("_mucUserItem","role"),actor:proxy("_mucUserItem","_mucUserActor"),reason:proxy("_mucUserItem","reason"),password:types.textSub(USER_NS,"password"),codes:{get:function(){return types.getMultiSubText(this.xml,USER_NS,"status",function(sub){return types.getAttribute(sub,"code")})},set:function(value){var self=this;types.setMultiSubText(this.xml,USER_NS,"status",value,function(val){var child=types.createElement(USER_NS,"status",USER_NS);types.setAttribute(child,"code",val);self.xml.appendChild(child)})}}}});var MUCAdmin=stanza.define({name:"mucAdmin",namespace:ADMIN_NS,element:"query",fields:{affiliation:proxy("_mucAdminItem","affiliation"),nick:proxy("_mucAdminItem","nick"),jid:proxy("_mucAdminItem","jid"),role:proxy("_mucAdminItem","role"),actor:proxy("_mucAdminItem","_mucAdminActor"),reason:proxy("_mucAdminItem","reason")}});var MUCOwner=stanza.define({name:"mucOwner",namespace:OWNER_NS,element:"query"});var MUCJoin=stanza.define({name:"joinMuc",namespace:NS,element:"x",fields:{password:types.textSub(NS,"password"),history:{get:function(){var result={};var hist=types.find(this.xml,this._NS,"history");if(!hist.length){return{}}hist=hist[0];var maxchars=hist.getAttribute("maxchars")||"";var maxtypess=hist.getAttribute("maxstanas")||"";var seconds=hist.getAttribute("seconds")||"";var since=hist.getAttribute("since")||"";if(maxchars){result.maxchars=parseInt(maxchars,10)}if(maxtypess){result.maxtypess=parseInt(maxtypess,10)}if(seconds){result.seconds=parseInt(seconds,10)}if(since){result.since=new Date(since)}},set:function(opts){var existing=types.find(this.xml,this._NS,"history");if(existing.length){for(var i=0;i<existing.length;i++){this.xml.removeChild(existing[i])}}var hist=types.createElement(this._NS,"history",this._NS);this.xml.appendChild(hist);if(opts.maxchars){hist.setAttribute(""+opts.maxchars)}if(opts.maxtypess){hist.setAttribute(""+opts.maxtypess)}if(opts.seconds){hist.setAttribute(""+opts.seconds)}if(opts.since){hist.setAttribute(opts.since.toISOString())}}}}});var DirectInvite=stanza.define({name:"mucInvite",namespace:"jabber:x:conference",element:"x",fields:{jid:types.jidAttribute("jid"),password:types.attribute("password"),reason:types.attribute("reason"),thread:types.attribute("thread"),"continue":types.boolAttribute("continue")}});stanza.extend(UserItem,UserActor);stanza.extend(MUC,UserItem);stanza.extend(MUC,Invite,"invites");stanza.extend(MUC,Decline);stanza.extend(MUC,Destroyed);stanza.extend(AdminItem,AdminActor);stanza.extend(MUCAdmin,AdminItem,"items");stanza.extend(MUCOwner,Destroy);stanza.withDataForm(function(DataForm){stanza.extend(MUCOwner,DataForm)});stanza.withIq(function(Iq){stanza.add(Iq,"mucUnique",types.textSub(UNIQ_NS,"unique"));stanza.extend(Iq,MUCAdmin);stanza.extend(Iq,MUCOwner)});stanza.withPresence(function(Presence){stanza.extend(Presence,MUC);stanza.extend(Presence,MUCJoin)});stanza.withMessage(function(Message){stanza.extend(Message,MUC);stanza.extend(Message,DirectInvite)})}},{}],318:[function(require,module,exports){"use strict";module.exports=function(stanza){var nick=stanza.utils.textSub("http://jabber.org/protocol/nick","nick");stanza.withPubsubItem(function(Item){stanza.add(Item,"nick",nick)});stanza.withPresence(function(Presence){stanza.add(Presence,"nick",nick)});stanza.withMessage(function(Message){stanza.add(Message,"nick",nick)})}},{}],319:[function(require,module,exports){"use strict";var NS="jabber:x:oob";module.exports=function(stanza){var OOB=stanza.define({name:"oob",element:"x",namespace:NS,fields:{url:stanza.utils.textSub(NS,"url"),desc:stanza.utils.textSub(NS,"desc")}});stanza.withMessage(function(Message){stanza.extend(Message,OOB,"oobURIs")})}},{}],320:[function(require,module,exports){"use strict";var NS="urn:xmpp:ping";module.exports=function(stanza){var Ping=stanza.define({name:"ping",namespace:NS,element:"ping"});stanza.withIq(function(Iq){stanza.extend(Iq,Ping)})}},{}],321:[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;stanza.define({name:"presence",namespace:"jabber:client",element:"presence",topLevel:true,fields:{lang:types.langAttribute(),id:types.attribute("id"),to:types.jidAttribute("to",true),from:types.jidAttribute("from",true),priority:types.numberSub("jabber:client","priority",false,0),show:types.textSub("jabber:client","show"),type:{get:function(){return types.getAttribute(this.xml,"type","available")},set:function(value){if(value==="available"){value=false}types.setAttribute(this.xml,"type",value)}},$status:{get:function(){return types.getSubLangText(this.xml,this._NS,"status",this.lang)}},status:{get:function(){var statuses=this.$status;return statuses[this.lang]||""},set:function(value){types.setSubLangText(this.xml,this._NS,"status",value,this.lang)}},idleSince:types.dateSubAttribute("urn:xmpp:idle:1","idle","since"),decloak:types.subAttribute("urn:xmpp:decloak:0","decloak","reason"),avatarId:{get:function(){var NS="vcard-temp:x:update";var update=types.find(this.xml,NS,"x");if(!update.length){return""}return types.getSubText(update[0],NS,"photo")},set:function(value){var NS="vcard-temp:x:update";var update=types.findOrCreate(this.xml,NS,"x");if(value===""){types.setBoolSub(update,NS,"photo",true)}else if(value===true){return}else if(value){types.setSubText(update,NS,"photo",value)}else{this.xml.removeChild(update)}}}}})}},{}],322:[function(require,module,exports){"use strict";module.exports=function(stanza){var PrivateStorage=stanza.define({name:"privateStorage",namespace:"jabber:iq:private",element:"query"});stanza.withIq(function(Iq){stanza.extend(Iq,PrivateStorage)})}},{}],323:[function(require,module,exports){"use strict";var NS="urn:xmpp:psa";var CONDITIONS=["server-unavailable","connection-paused"];module.exports=function(stanza){var types=stanza.utils;var PSA=stanza.define({name:"state",namespace:NS,element:"state-annotation",fields:{from:types.jidAttribute("from"),condition:types.enumSub(NS,CONDITIONS),description:types.textSub(NS,"description")}});stanza.withPresence(function(Presence){stanza.extend(Presence,PSA)})}},{}],324:[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/pubsub";module.exports=function(stanza){var types=stanza.utils;var Pubsub=stanza.define({name:"pubsub",namespace:"http://jabber.org/protocol/pubsub",element:"pubsub",fields:{publishOptions:{get:function(){var DataForm=stanza.getDefinition("x","jabber:x:data");var conf=types.find(this.xml,this._NS,"publish-options");if(conf.length&&conf[0].childNodes.length){return new DataForm({},conf[0].childNodes[0])}},set:function(value){var DataForm=stanza.getDefinition("x","jabber:x:data");var conf=types.findOrCreate(this.xml,this._NS,"publish-options");if(value){var form=new DataForm(value);conf.appendChild(form.xml)}}}}});var Subscribe=stanza.define({name:"subscribe",namespace:NS,element:"subscribe",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid")}});var Subscription=stanza.define({name:"subscription",namespace:NS,element:"subscription",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid"),subid:types.attribute("subid"),type:types.attribute("subscription"),configurable:types.boolSub("subscribe-options"),configurationRequired:{get:function(){var options=types.find(this.xml,NS,"subscribe-options");if(options.length){return types.getBoolSub(options[0],NS,"required")}return false}}}});var Subscriptions=stanza.define({name:"subscriptions",namespace:NS,element:"subscriptions",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid")}});var Affiliation=stanza.define({name:"affiliation",namespace:NS,element:"affiliation",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid"),type:types.attribute("affiliation")}});var Affiliations=stanza.define({name:"affiliations",namespace:NS,element:"affiliations",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid")}});var SubscriptionOptions=stanza.define({name:"subscriptionOptions",namespace:NS,element:"options",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid"),subid:types.attribute("subid")}});var Unsubscribe=stanza.define({name:"unsubscribe",namespace:NS,element:"unsubscribe",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid")}});var Publish=stanza.define({name:"publish",namespace:NS,element:"publish",fields:{node:types.attribute("node")}});var Retract=stanza.define({name:"retract",namespace:NS,element:"retract",fields:{node:types.attribute("node"),notify:types.boolAttribute("notify"),id:types.subAttribute(NS,"item","id")}});var Retrieve=stanza.define({name:"retrieve",namespace:NS,element:"items",fields:{node:types.attribute("node"),max:types.attribute("max_items")}});var Item=stanza.define({name:"item",namespace:NS,element:"item",fields:{id:types.attribute("id")}});stanza.extend(Pubsub,Subscribe);stanza.extend(Pubsub,Unsubscribe);stanza.extend(Pubsub,Publish);stanza.extend(Pubsub,Retract);stanza.extend(Pubsub,Retrieve);stanza.extend(Pubsub,Subscription);stanza.extend(Pubsub,SubscriptionOptions);stanza.extend(Pubsub,Subscriptions);
stanza.extend(Pubsub,Affiliations);stanza.extend(Publish,Item,"items");stanza.extend(Retrieve,Item,"items");stanza.extend(Subscriptions,Subscription,"list");stanza.extend(Affiliations,Affiliation,"list");stanza.withDataForm(function(DataForm){stanza.extend(SubscriptionOptions,DataForm);stanza.extend(Item,DataForm)});stanza.withIq(function(Iq){stanza.extend(Iq,Pubsub)});stanza.withDefinition("set","http://jabber.org/protocol/rsm",function(RSM){stanza.extend(Pubsub,RSM)})}},{}],325:[function(require,module,exports){"use strict";var ERRNS="http://jabber.org/protocol/pubsub#errors";var CONDITIONS=["closed-node","configuration-required","invalid-jid","invalid-options","invalid-payload","invalid-subid","item-forbidden","item-required","jid-required","max-items-exceeded","max-nodes-exceeded","nodeid-required","not-in-roster-group","not-subscribed","payload-too-big","payload-required","pending-subscription","presence-subscription-required","subid-required","too-many-subscriptions","unsupported","unsupported-access-model"];module.exports=function(stanza){stanza.withStanzaError(function(ErrorStanza){stanza.add(ErrorStanza,"pubsubCondition",stanza.utils.enumSub(ERRNS,CONDITIONS))})}},{}],326:[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/pubsub#event";module.exports=function(stanza){var types=stanza.utils;var Event=stanza.define({name:"event",namespace:NS,element:"event"});var EventPurge=stanza.define({name:"purged",namespace:NS,element:"purge",fields:{node:types.attribute("node")}});var EventDelete=stanza.define({name:"deleted",namespace:NS,element:"delete",fields:{node:types.attribute("node"),redirect:types.subAttribute(NS,"redirect","uri")}});var EventSubscription=stanza.define({name:"subscriptionChanged",namespace:NS,element:"subscription",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid"),type:types.attribute("subscription"),subid:types.attribute("subid"),expiry:{get:function(){var text=types.getAttribute(this.xml,"expiry");if(text==="presence"){return text}else if(text){return new Date(text)}},set:function(value){if(!value){return}if(typeof value!=="string"){value=value.toISOString()}types.setAttribute(this.xml,"expiry",value)}}}});var EventConfiguration=stanza.define({name:"configurationChanged",namespace:NS,element:"configuration",fields:{node:types.attribute("node")}});var EventItems=stanza.define({name:"updated",namespace:NS,element:"items",fields:{node:types.attribute("node"),retracted:{get:function(){var results=[];var retracted=types.find(this.xml,this._NS,"retract");retracted.forEach(function(xml){results.push(xml.getAttribute("id"))});return results},set:function(value){var self=this;value.forEach(function(id){var retracted=types.createElement(self._NS,"retract",self._NS);retracted.setAttribute("id",id);this.xml.appendChild(retracted)})}}}});var EventItem=stanza.define({name:"_eventItem",namespace:NS,element:"item",fields:{id:types.attribute("id"),node:types.attribute("node"),publisher:types.jidAttribute("publisher")}});stanza.extend(EventItems,EventItem,"published");stanza.extend(Event,EventItems);stanza.extend(Event,EventSubscription);stanza.extend(Event,EventConfiguration);stanza.extend(Event,EventDelete);stanza.extend(Event,EventPurge);stanza.withMessage(function(Message){stanza.extend(Message,Event)});stanza.withDataForm(function(DataForm){stanza.extend(EventConfiguration,DataForm)})}},{}],327:[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/pubsub#owner";module.exports=function(stanza){var types=stanza.utils;var PubsubOwner=stanza.define({name:"pubsubOwner",namespace:NS,element:"pubsub",fields:{create:types.subAttribute(NS,"create","node"),purge:types.subAttribute(NS,"purge","node"),del:types.subAttribute(NS,"delete","node"),redirect:{get:function(){var del=types.find(this.xml,this._NS,"delete");if(del.length){return types.getSubAttribute(del[0],this._NS,"redirect","uri")}return""},set:function(value){var del=types.findOrCreate(this.xml,this._NS,"delete");types.setSubAttribute(del,this._NS,"redirect","uri",value)}}}});var Subscription=stanza.define({name:"subscription",namespace:NS,element:"subscription",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid"),subid:types.attribute("subid"),type:types.attribute("subscription"),configurable:types.boolSub("subscribe-options"),configurationRequired:{get:function(){var options=types.find(this.xml,NS,"subscribe-options");if(options.length){return types.getBoolSub(options[0],NS,"required")}return false}}}});var Subscriptions=stanza.define({name:"subscriptions",namespace:NS,element:"subscriptions",fields:{node:types.attribute("node")}});var Affiliation=stanza.define({name:"affiliation",namespace:NS,element:"affiliation",fields:{node:types.attribute("node"),type:types.attribute("affiliation")}});var Affiliations=stanza.define({name:"affiliations",namespace:NS,element:"affiliations",fields:{node:types.attribute("node")}});var Configure=stanza.define({name:"config",namespace:NS,element:"configure",fields:{node:types.attribute("node")}});stanza.extend(PubsubOwner,Configure);stanza.extend(PubsubOwner,Subscriptions);stanza.extend(PubsubOwner,Affiliations);stanza.extend(Subscriptions,Subscription,"list");stanza.extend(Affiliations,Affiliation,"list");stanza.withDataForm(function(DataForm){stanza.extend(Configure,DataForm)});stanza.withIq(function(Iq){stanza.extend(Iq,PubsubOwner)})}},{}],328:[function(require,module,exports){"use strict";var _=require("underscore");var NS="urn:xmpp:reach:0";module.exports=function(stanza){var types=stanza.utils;var ReachURI=stanza.define({name:"_reachAddr",namespace:NS,element:"addr",fields:{uri:types.attribute("uri"),$desc:{get:function(){return types.getSubLangText(this.xml,NS,"desc",this.lang)}},desc:{get:function(){var descs=this.$desc;return descs[this.lang]||""},set:function(value){types.setSubLangText(this.xml,NS,"desc",value,this.lang)}}}});var reachability={get:function(){var reach=types.find(this.xml,NS,"reach");var results=[];if(reach.length){var addrs=types.find(reach[0],NS,"addr");_.forEach(addrs,function(addr){results.push(new ReachURI({},addr))})}return results},set:function(value){var reach=types.findOrCreate(this.xml,NS,"reach");types.setAttribute(reach,"xmlns",NS);_.forEach(value,function(info){var addr=new ReachURI(info);reach.appendChild(addr.xml)})}};stanza.withPubsubItem(function(Item){stanza.add(Item,"reach",reachability)});stanza.withPresence(function(Presence){stanza.add(Presence,"reach",reachability)})}},{underscore:448}],329:[function(require,module,exports){"use strict";var NS="jabber:iq:register";module.exports=function(stanza){var types=stanza.utils;var Register=stanza.define({name:"register",namespace:NS,element:"query",fields:{instructions:types.textSub(NS,"instructions"),registered:types.boolSub(NS,"registered"),remove:types.boolSub(NS,"remove"),username:types.textSub(NS,"username"),nick:types.textSub(NS,"nick"),password:types.textSub(NS,"password"),name:types.textSub(NS,"name"),first:types.textSub(NS,"first"),last:types.textSub(NS,"last"),email:types.textSub(NS,"email"),address:types.textSub(NS,"address"),city:types.textSub(NS,"city"),state:types.textSub(NS,"state"),zip:types.textSub(NS,"zip"),phone:types.textSub(NS,"phone"),url:types.textSub(NS,"url"),date:types.textSub(NS,"date"),misc:types.textSub(NS,"misc"),text:types.textSub(NS,"text"),key:types.textSub(NS,"key")}});stanza.withDefinition("x","jabber:x:oob",function(OOB){stanza.extend(Register,OOB)});stanza.withDataForm(function(DataForm){stanza.extend(Register,DataForm)});stanza.withIq(function(Iq){stanza.extend(Iq,Register)})}},{}],330:[function(require,module,exports){"use strict";var NS="jabber:iq:roster";module.exports=function(stanza){var types=stanza.utils;var Roster=stanza.define({name:"roster",namespace:NS,element:"query",fields:{ver:{get:function(){return types.getAttribute(this.xml,"ver")},set:function(value){var force=value==="";types.setAttribute(this.xml,"ver",value,force)}}}});var RosterItem=stanza.define({name:"_rosterItem",namespace:NS,element:"item",fields:{jid:types.jidAttribute("jid",true),name:types.attribute("name"),subscription:types.attribute("subscription","none"),subscriptionRequested:{get:function(){var ask=types.getAttribute(this.xml,"ask");return ask==="subscribe"}},preApproved:types.boolAttribute(NS,"approved"),groups:types.multiTextSub(NS,"group")}});stanza.extend(Roster,RosterItem,"items");stanza.withIq(function(Iq){stanza.extend(Iq,Roster)})}},{}],331:[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/rsm";module.exports=function(stanza){var types=stanza.utils;stanza.define({name:"rsm",namespace:NS,element:"set",fields:{after:types.textSub(NS,"after"),before:{get:function(){return types.getSubText(this.xml,this._NS,"before")},set:function(value){if(value===true){types.findOrCreate(this.xml,this._NS,"before")}else{types.setSubText(this.xml,this._NS,"before",value)}}},count:types.numberSub(NS,"count",false,0),first:types.textSub(NS,"first"),firstIndex:types.subAttribute(NS,"first","index"),index:types.textSub(NS,"index"),last:types.textSub(NS,"last"),max:types.textSub(NS,"max")}})}},{}],332:[function(require,module,exports){"use strict";var NS="urn:xmpp:jingle:apps:rtp:1";var FBNS="urn:xmpp:jingle:apps:rtp:rtcp-fb:0";var HDRNS="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0";var INFONS="urn:xmpp:jingle:apps:rtp:info:1";var SSMANS="urn:xmpp:jingle:apps:rtp:ssma:0";var GROUPNS="urn:xmpp:jingle:apps:grouping:0";module.exports=function(stanza){var types=stanza.utils;var Feedback={get:function(){var existing=types.find(this.xml,FBNS,"rtcp-fb");var result=[];existing.forEach(function(xml){result.push({type:types.getAttribute(xml,"type"),subtype:types.getAttribute(xml,"subtype")})});existing=types.find(this.xml,FBNS,"rtcp-fb-trr-int");existing.forEach(function(xml){result.push({type:types.getAttribute(xml,"type"),value:types.getAttribute(xml,"value")})});return result},set:function(values){var self=this;var existing=types.find(this.xml,FBNS,"rtcp-fb");existing.forEach(function(item){self.xml.removeChild(item)});existing=types.find(this.xml,FBNS,"rtcp-fb-trr-int");existing.forEach(function(item){self.xml.removeChild(item)});values.forEach(function(value){var fb;if(value.type==="trr-int"){fb=types.createElement(FBNS,"rtcp-fb-trr-int",NS);types.setAttribute(fb,"type",value.type);types.setAttribute(fb,"value",value.value)}else{fb=types.createElement(FBNS,"rtcp-fb",NS);types.setAttribute(fb,"type",value.type);types.setAttribute(fb,"subtype",value.subtype)}self.xml.appendChild(fb)})}};var Bandwidth=stanza.define({name:"bandwidth",namespace:NS,element:"bandwidth",fields:{type:types.attribute("type"),bandwidth:types.text()}});var RTP=stanza.define({name:"_rtp",namespace:NS,element:"description",tags:["jingle-description"],fields:{descType:{value:"rtp"},media:types.attribute("media"),ssrc:types.attribute("ssrc"),mux:types.boolSub(NS,"rtcp-mux"),encryption:{get:function(){var enc=types.find(this.xml,NS,"encryption");if(!enc.length){return[]}enc=enc[0];var self=this;var data=types.find(enc,NS,"crypto");var results=[];data.forEach(function(xml){results.push(new Crypto({},xml,self).toJSON())});return results},set:function(values){var enc=types.find(this.xml,NS,"encryption");if(enc.length){this.xml.removeChild(enc)}if(!values.length){return}types.setBoolSubAttribute(this.xml,NS,"encryption","required",true);enc=types.find(this.xml,NS,"encryption")[0];var self=this;values.forEach(function(value){var content=new Crypto(value,null,self);enc.appendChild(content.xml)})}},feedback:Feedback,headerExtensions:{get:function(){var existing=types.find(this.xml,HDRNS,"rtp-hdrext");var result=[];existing.forEach(function(xml){result.push({id:types.getAttribute(xml,"id"),uri:types.getAttribute(xml,"uri"),senders:types.getAttribute(xml,"senders")})});return result},set:function(values){var self=this;var existing=types.find(this.xml,HDRNS,"rtp-hdrext");existing.forEach(function(item){self.xml.removeChild(item)});values.forEach(function(value){var hdr=types.createElement(HDRNS,"rtp-hdrext",NS);types.setAttribute(hdr,"id",value.id);types.setAttribute(hdr,"uri",value.uri);types.setAttribute(hdr,"senders",value.senders);self.xml.appendChild(hdr)})}}}});var PayloadType=stanza.define({name:"_payloadType",namespace:NS,element:"payload-type",fields:{channels:types.attribute("channels"),clockrate:types.attribute("clockrate"),id:types.attribute("id"),maxptime:types.attribute("maxptime"),name:types.attribute("name"),ptime:types.attribute("ptime"),feedback:Feedback,parameters:{get:function(){var result=[];var params=types.find(this.xml,NS,"parameter");params.forEach(function(param){result.push({key:types.getAttribute(param,"name"),value:types.getAttribute(param,"value")})});return result},set:function(values){var self=this;values.forEach(function(value){var param=types.createElement(NS,"parameter");types.setAttribute(param,"name",value.key);types.setAttribute(param,"value",value.value);self.xml.appendChild(param)})}}}});var Crypto=stanza.define({name:"crypto",namespace:NS,element:"crypto",fields:{cipherSuite:types.attribute("crypto-suite"),keyParams:types.attribute("key-params"),sessionParams:types.attribute("session-params"),tag:types.attribute("tag")}});var ContentGroup=stanza.define({name:"_group",namespace:GROUPNS,element:"group",fields:{semantics:types.attribute("semantics"),contents:types.multiSubAttribute(GROUPNS,"content","name")}});var SourceGroup=stanza.define({name:"_sourceGroup",namespace:SSMANS,element:"ssrc-group",fields:{semantics:types.attribute("semantics"),sources:types.multiSubAttribute(SSMANS,"source","ssrc")}});var Source=stanza.define({name:"_source",namespace:SSMANS,element:"source",fields:{ssrc:types.attribute("ssrc"),parameters:{get:function(){var result=[];var params=types.find(this.xml,SSMANS,"parameter");params.forEach(function(param){result.push({key:types.getAttribute(param,"name"),value:types.getAttribute(param,"value")})});return result},set:function(values){var self=this;values.forEach(function(value){var param=types.createElement(SSMANS,"parameter");types.setAttribute(param,"name",value.key);types.setAttribute(param,"value",value.value);self.xml.appendChild(param)})}}}});var Mute=stanza.define({name:"mute",namespace:INFONS,element:"mute",fields:{creator:types.attribute("creator"),name:types.attribute("name")}});var Unmute=stanza.define({name:"unmute",namespace:INFONS,element:"unmute",fields:{creator:types.attribute("creator"),name:types.attribute("name")}});stanza.extend(RTP,Bandwidth);stanza.extend(RTP,PayloadType,"payloads");stanza.extend(RTP,Source,"sources");stanza.extend(RTP,SourceGroup,"sourceGroups");stanza.withDefinition("content","urn:xmpp:jingle:1",function(Content){stanza.extend(Content,RTP)});stanza.withDefinition("jingle","urn:xmpp:jingle:1",function(Jingle){stanza.extend(Jingle,Mute);stanza.extend(Jingle,Unmute);stanza.extend(Jingle,ContentGroup,"groups");stanza.add(Jingle,"ringing",types.boolSub(INFONS,"ringing"));stanza.add(Jingle,"hold",types.boolSub(INFONS,"hold"));stanza.add(Jingle,"active",types.boolSub(INFONS,"active"))})}},{}],333:[function(require,module,exports){"use strict";var NS="urn:xmpp:rtt:0";var typemap={insert:"t",erase:"e",wait:"w"};var actionmap={t:"insert",e:"erase",w:"wait"};module.exports=function(stanza){var types=stanza.utils;var RTT=stanza.define({name:"rtt",namespace:NS,element:"rtt",fields:{id:types.attribute("id"),event:types.attribute("event","edit"),seq:types.numberAttribute("seq"),actions:{get:function(){var results=[];for(var i=0,len=this.xml.childNodes.length;i<len;i++){var child=this.xml.childNodes[i];var name=child.localName;var action={};if(child.namespaceURI!==NS){continue}if(actionmap[name]){action.type=actionmap[name]}else{continue}var pos=types.getAttribute(child,"p");if(pos){action.pos=parseInt(pos,10)}var n=types.getAttribute(child,"n");if(n){action.num=parseInt(n,10)}var t=types.getText(child);if(t&&name==="t"){action.text=t}results.push(action)}return results},set:function(actions){var self=this;for(var i=0,len=this.xml.childNodes.length;i<len;i++){this.xml.removeChild(this.xml.childNodes[i])}actions.forEach(function(action){if(!typemap[action.type]){return}var child=types.createElement(NS,typemap[action.type],NS);if(action.pos!==undefined){types.setAttribute(child,"p",action.pos.toString())}if(action.num){types.setAttribute(child,"n",action.num.toString())}if(action.text){types.setText(child,action.text)}self.xml.appendChild(child)})}}}});stanza.withMessage(function(Message){stanza.extend(Message,RTT)})}},{}],334:[function(require,module,exports){"use strict";var NS="urn:ietf:params:xml:ns:xmpp-sasl";var CONDITIONS=["aborted","account-disabled","credentials-expired","encryption-required","incorrect-encoding","invalid-authzid","invalid-mechanism","malformed-request","mechanism-too-weak","not-authorized","temporary-auth-failure"];module.exports=function(stanza){var types=stanza.utils;var Mechanisms=stanza.define({name:"sasl",namespace:NS,element:"mechanisms",fields:{mechanisms:types.multiTextSub(NS,"mechanism")}});stanza.define({name:"saslAuth",eventName:"sasl:auth",namespace:NS,element:"auth",topLevel:true,fields:{value:types.b64Text(),mechanism:types.attribute("mechanism")}});stanza.define({name:"saslChallenge",eventName:"sasl:challenge",namespace:NS,element:"challenge",topLevel:true,fields:{value:types.b64Text()}});stanza.define({name:"saslResponse",eventName:"sasl:response",namespace:NS,element:"response",topLevel:true,fields:{value:types.b64Text()}});stanza.define({name:"saslAbort",eventName:"sasl:abort",namespace:NS,element:"abort",topLevel:true});stanza.define({name:"saslSuccess",eventName:"sasl:success",namespace:NS,element:"success",topLevel:true,fields:{value:types.b64Text()}});stanza.define({name:"saslFailure",eventName:"sasl:failure",namespace:NS,element:"failure",topLevel:true,fields:{lang:{get:function(){return this._lang||""},set:function(value){this._lang=value}},condition:types.enumSub(NS,CONDITIONS),$text:{get:function(){return types.getSubLangText(this.xml,NS,"text",this.lang)}},text:{get:function(){var text=this.$text;return text[this.lang]||""},set:function(value){types.setSubLangText(this.xml,NS,"text",value,this.lang)}}}});stanza.withStreamFeatures(function(StreamFeatures){stanza.extend(StreamFeatures,Mechanisms)})}},{}],335:[function(require,module,exports){"use strict";var NS="urn:ietf:params:xml:ns:xmpp-session";module.exports=function(stanza){var types=stanza.utils;var Session=stanza.define({name:"session",namespace:NS,element:"session",fields:{required:types.boolSub(NS,"required"),optional:types.boolSub(NS,"optional")}});stanza.withIq(function(Iq){stanza.extend(Iq,Session)});stanza.withStreamFeatures(function(StreamFeatures){stanza.extend(StreamFeatures,Session)})}},{}],336:[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/shim";module.exports=function(stanza){var types=stanza.utils;var SHIM={get:function(){var headerSet=types.find(this.xml,NS,"headers");if(headerSet.length){return types.getMultiSubText(headerSet[0],NS,"header",function(header){var name=types.getAttribute(header,"name");if(name){return{name:name,value:types.getText(header)}}})}return[]},set:function(values){var headerSet=types.findOrCreate(this.xml,NS,"headers");stanza.setMultiSubText(headerSet,NS,"header",values,function(val){var header=types.createElement(NS,"header",NS);types.setAttribute(header,"name",val.name);types.setText(header,val.value);headerSet.appendChild(header)})}};stanza.withMessage(function(Message){stanza.add(Message,"headers",SHIM)});stanza.withPresence(function(Presence){stanza.add(Presence,"headers",SHIM)})}},{}],337:[function(require,module,exports){"use strict";var NS="urn:xmpp:sm:3";module.exports=function(stanza){var types=stanza.utils;var SMFeature=stanza.define({name:"streamManagement",namespace:NS,element:"sm"});stanza.define({name:"smEnable",eventName:"stream:management:enable",namespace:NS,element:"enable",topLevel:true,fields:{resume:types.boolAttribute("resume")}});stanza.define({name:"smEnabled",eventName:"stream:management:enabled",namespace:NS,element:"enabled",topLevel:true,fields:{id:types.attribute("id"),resume:types.boolAttribute("resume")}});stanza.define({name:"smResume",eventName:"stream:management:resume",namespace:NS,element:"resume",topLevel:true,fields:{h:types.numberAttribute("h",false,0),previd:types.attribute("previd")}});stanza.define({name:"smResumed",eventName:"stream:management:resumed",namespace:NS,element:"resumed",topLevel:true,fields:{h:types.numberAttribute("h",false,0),previd:types.attribute("previd")}});stanza.define({name:"smFailed",eventName:"stream:management:failed",namespace:NS,element:"failed",topLevel:true});stanza.define({name:"smAck",eventName:"stream:management:ack",namespace:NS,element:"a",topLevel:true,fields:{h:types.numberAttribute("h",false,0)}});stanza.define({name:"smRequest",eventName:"stream:management:request",namespace:NS,element:"r",topLevel:true});stanza.withStreamFeatures(function(StreamFeatures){stanza.extend(StreamFeatures,SMFeature)})}},{}],338:[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;stanza.define({name:"stream",namespace:"http://etherx.jabber.org/streams",element:"stream",fields:{lang:types.langAttribute(),id:types.attribute("id"),version:types.attribute("version","1.0"),to:types.jidAttribute("to",true),from:types.jidAttribute("from",true)}})}},{}],339:[function(require,module,exports){"use strict";var ERR_NS="urn:ietf:params:xml:ns:xmpp-streams";var CONDITIONS=["bad-format","bad-namespace-prefix","conflict","connection-timeout","host-gone","host-unknown","improper-addressing","internal-server-error","invalid-from","invalid-namespace","invalid-xml","not-authorized","not-well-formed","policy-violation","remote-connection-failed","reset","resource-constraint","restricted-xml","see-other-host","system-shutdown","undefined-condition","unsupported-encoding","unsupported-feature","unsupported-stanza-type","unsupported-version"];module.exports=function(stanza){var types=stanza.utils;stanza.define({name:"streamError",namespace:"http://etherx.jabber.org/streams",element:"error",topLevel:true,fields:{lang:{get:function(){return this._lang||""},set:function(value){this._lang=value}},condition:types.enumSub(ERR_NS,CONDITIONS),seeOtherHost:{get:function(){return types.getSubText(this.xml,ERR_NS,"see-other-host")},set:function(value){this.condition="see-other-host";types.setSubText(this.xml,ERR_NS,"see-other-host",value)}},$text:{get:function(){return types.getSubLangText(this.xml,ERR_NS,"text",this.lang)}},text:{get:function(){var text=this.$text;return text[this.lang]||""},set:function(value){types.setSubLangText(this.xml,ERR_NS,"text",value,this.lang)}}}})}},{}],340:[function(require,module,exports){"use strict";module.exports=function(stanza){var StreamFeatures=stanza.define({name:"streamFeatures",namespace:"http://etherx.jabber.org/streams",element:"features",topLevel:true});var RosterVerFeature=stanza.define({name:"rosterVersioning",namespace:"urn:xmpp:features:rosterver",element:"ver"});var SubscriptionPreApprovalFeature=stanza.define({name:"subscriptionPreApproval",namespace:"urn:xmpp:features:pre-approval",element:"sub"});stanza.extend(StreamFeatures,RosterVerFeature);stanza.extend(StreamFeatures,SubscriptionPreApprovalFeature)}},{}],341:[function(require,module,exports){"use strict";module.exports=function(stanza){var EntityTime=stanza.define({name:"time",namespace:"urn:xmpp:time",element:"time",fields:{utc:stanza.utils.dateSub("urn:xmpp:time","utc"),tzo:stanza.utils.tzoSub("urn:xmpp:time","tzo",0)}});stanza.withIq(function(Iq){stanza.extend(Iq,EntityTime)})}},{}],342:[function(require,module,exports){"use strict";var NS="vcard-temp";module.exports=function(stanza){var types=stanza.utils;var VCardTemp=stanza.define({name:"vCardTemp",namespace:NS,element:"vCard",fields:{role:types.textSub(NS,"ROLE"),website:types.textSub(NS,"URL"),title:types.textSub(NS,"TITLE"),description:types.textSub(NS,"DESC"),fullName:types.textSub(NS,"FN"),birthday:types.dateSub(NS,"BDAY"),nicknames:types.multiTextSub(NS,"NICKNAME"),jids:types.multiTextSub(NS,"JABBERID")}});var Email=stanza.define({name:"_email",namespace:NS,element:"EMAIL",fields:{email:types.textSub(NS,"USERID"),home:types.boolSub(NS,"HOME"),work:types.boolSub(NS,"WORK"),preferred:types.boolSub(NS,"PREF")}});var PhoneNumber=stanza.define({name:"_tel",namespace:NS,element:"TEL",fields:{number:types.textSub(NS,"NUMBER"),home:types.boolSub(NS,"HOME"),work:types.boolSub(NS,"WORK"),mobile:types.boolSub(NS,"CELL"),preferred:types.boolSub(NS,"PREF")}});var Address=stanza.define({name:"_address",namespace:NS,element:"ADR",fields:{street:types.textSub(NS,"STREET"),street2:types.textSub(NS,"EXTADD"),country:types.textSub(NS,"CTRY"),city:types.textSub(NS,"LOCALITY"),region:types.textSub(NS,"REGION"),postalCode:types.textSub(NS,"PCODE"),pobox:types.textSub(NS,"POBOX"),home:types.boolSub(NS,"HOME"),work:types.boolSub(NS,"WORK"),preferred:types.boolSub(NS,"PREF")}});var Organization=stanza.define({name:"organization",namespace:NS,element:"ORG",fields:{name:types.textSub(NS,"ORGNAME"),unit:types.textSub(NS,"ORGUNIT")}});var Name=stanza.define({name:"name",namespace:NS,element:"N",fields:{family:types.textSub(NS,"FAMILY"),given:types.textSub(NS,"GIVEN"),middle:types.textSub(NS,"MIDDLE"),prefix:types.textSub(NS,"PREFIX"),suffix:types.textSub(NS,"SUFFIX")}});var Photo=stanza.define({name:"photo",namespace:NS,element:"PHOTO",fields:{type:types.textSub(NS,"TYPE"),data:types.textSub(NS,"BINVAL"),url:types.textSub(NS,"EXTVAL")}});stanza.extend(VCardTemp,Email,"emails");stanza.extend(VCardTemp,Address,"addresses");stanza.extend(VCardTemp,PhoneNumber,"phoneNumbers");stanza.extend(VCardTemp,Organization);stanza.extend(VCardTemp,Name);stanza.extend(VCardTemp,Photo);stanza.withIq(function(Iq){stanza.extend(Iq,VCardTemp)})}},{}],343:[function(require,module,exports){"use strict";var NS="jabber:iq:version";module.exports=function(stanza){var types=stanza.utils;var Version=stanza.define({name:"version",namespace:NS,element:"query",fields:{name:types.textSub(NS,"name"),version:types.textSub(NS,"version"),os:types.textSub(NS,"os")}});stanza.withIq(function(Iq){stanza.extend(Iq,Version)})}},{}],344:[function(require,module,exports){"use strict";var NS="urn:xmpp:invisible:0";module.exports=function(stanza){stanza.withIq(function(Iq){stanza.add(Iq,"visible",stanza.utils.boolSub(NS,"visible"));stanza.add(Iq,"invisible",stanza.utils.boolSub(NS,"invisible"))})}},{}],345:[function(require,module,exports){(function(process,Buffer){"use strict";var _=require("underscore");var util=require("util");var BPromise=require("bluebird");var request=BPromise.promisify(require("request"));var WildEmitter=require("wildemitter");function ConnectionError(){}util.inherits(ConnectionError,Error);function retryRequest(opts,timeout,allowedRetries,retries){retries=retries||0;var req=request(opts).cancellable().timeout((timeout||20)*1e3);console.log("retryRequest : opts : ",opts);console.log("retryRequest : timeout : ",timeout);console.log("retryRequest : allowedRetries : ",allowedRetries);return req.spread(function(req,body){if(req.statusCode<200||req.statusCode>=400){throw new ConnectionError("HTTP Status Error")}return body}).catch(BPromise.TimeoutError,function(){throw new ConnectionError("Dead Connection, exceeded timeout limit")}).catch(function(){if(retries<allowedRetries){return BPromise.delay(100).then(function(){return retryRequest(opts,timeout,allowedRetries,retries+1)})}else{throw new ConnectionError("Dead Connection, exceeded retry limit")}})}function BOSHConnection(sm,stanzas){var self=this;WildEmitter.call(this);self.sm=sm;self.stanzas={BOSH:stanzas.getDefinition("body","http://jabber.org/protocol/httpbind"),StreamError:stanzas.getStreamError()};self.sendQueue=[];self.requests=[];self.maxRequests=2;self.sid="";self.on("raw:incoming",function(data){data=data.trim();if(data===""){return}var bosh,err;try{bosh=stanzas.parse(data,self.stanzas.BOSH)}catch(e){err=new self.stanzas.StreamError({condition:"invalid-xml"});self.emit("stream:error",err,e);self.send(err);return self.disconnect()}if(!self.hasStream){self.hasStream=true;self.stream={id:bosh.sid,lang:bosh.lang||"en",version:bosh.version||"1.0",to:bosh.to,from:bosh.from};self.sid=bosh.sid;self.maxRequests=bosh.requests}var payload=bosh.payload;payload.forEach(function(stanzaObj){if(!stanzaObj.lang){stanzaObj.lang=self.stream.lang}self.emit("stream:data",stanzaObj)});if(bosh.type==="terminate"){self.rid=undefined;self.sid=undefined;self.emit("bosh:terminate",bosh);self.emit("stream:end");self.emit("disconnected",self)}})}util.inherits(BOSHConnection,WildEmitter);BOSHConnection.prototype.connect=function(opts){var self=this;self.config=_.extend({rid:Math.ceil(Math.random()*9999999999),wait:30,maxRetries:5},opts);self.hasStream=false;self.sm.started=false;self.url=opts.boshURL;self.rid=self.config.rid;self.requests=[];self.rid++;self.request(new self.stanzas.BOSH({version:self.config.version||"1.0",to:self.config.server,lang:self.config.lang||"en",wait:self.config.wait,ver:"1.6",hold:1}))};BOSHConnection.prototype.disconnect=function(){if(this.hasStream){this.rid++;this.request(new this.stanzas.BOSH({type:"terminate"}))}else{this.requests.forEach(function(ticket){ticket.request.cancel()});this.stream=undefined;this.sid=undefined;this.rid=undefined;this.emit("disconnected",this)}};BOSHConnection.prototype.restart=function(){var self=this;self.rid++;self.request(new self.stanzas.BOSH({to:self.config.server,lang:self.config.lang||"en",restart:"true"}))};BOSHConnection.prototype.send=function(data){var self=this;if(self.hasStream){self.sendQueue.push(data);process.nextTick(self.longPoll.bind(self))}};BOSHConnection.prototype.longPoll=function(){var canReceive=this.requests.length===0;var canSend=this.sendQueue.length>0&&this.requests.length<this.maxRequests;if(!this.sid||!canReceive&&!canSend){return}var stanzas=this.sendQueue;this.sendQueue=[];this.rid++;this.request(new this.stanzas.BOSH({payload:stanzas}))};BOSHConnection.prototype.request=function(bosh){var self=this;var ticket={id:self.rid,request:null};bosh.rid=self.rid;bosh.sid=self.sid;var body=new Buffer(bosh.toString(),"utf8").toString();self.emit("raw:outgoing",body);self.requests.push(ticket);var req=retryRequest({uri:self.url,body:body,method:"POST",strictSSL:true},self.config.wait*1.5,this.config.maxRetries);ticket.request=req;return req.then(function(body){self.emit("raw:incoming",new Buffer(body,"utf8").toString())}).catch(ConnectionError,function(err){self.hasStream=false;var serr=new self.stanzas.StreamError({condition:"connection-timeout"});self.emit("stream:error",serr,err);self.disconnect()}).catch(BPromise.CancellationError,function(){return}).finally(function(){self.requests=_.filter(self.requests,function(item){return item.id!==ticket.id});if(bosh.type!=="terminate"){process.nextTick(function(){process.nextTick(self.longPoll.bind(self))})}})};module.exports=BOSHConnection}).call(this,require("_process"),require("buffer").Buffer)},{_process:149,bluebird:363,buffer:5,request:364,underscore:448,util:165,wildemitter:449}],346:[function(require,module,exports){"use strict";var WSConnection=require("./websocket");var _=require("underscore");var util=require("util");function OldWSConnection(sm,stanzas){WSConnection.call(this,sm,stanzas);var self=this;function wrap(data){return[self.streamStart,data,self.streamEnd].join("")}self.on("connected",function(){self.streamStart='<stream:stream xmlns:stream="http://etherx.jabber.org/streams">';self.streamEnd="</stream:stream>"});self.off("raw:incoming");self.on("raw:incoming",function(data){var streamData,ended,err;data=data.trim();data=data.replace(/^(\s*<\?.*\?>\s*)*/,"");if(data===""){return}if(data.match(self.streamEnd)){return self.disconnect()}else if(self.hasStream){try{streamData=stanzas.parse(wrap(data))
}catch(e){err=new this.stanzas.StreamError({condition:"invalid-xml"});self.emit("stream:error",err,e);self.send(err);return self.disconnect()}}else{var parts=data.match(/^<(\S+:)?(\S+) /);self.streamStart=data;self.streamEnd="</"+(parts[1]||"")+parts[2]+">";ended=false;try{streamData=stanzas.parse(data+self.streamEnd)}catch(e){try{streamData=stanzas.parse(data);ended=true}catch(e2){err=new this.stanzas.StreamError({condition:"invalid-xml"});self.emit("stream:error",err,e2);self.send(err);return self.disconnect()}}self.hasStream=true;self.stream=streamData;self.emit("stream:start",streamData)}_.each(streamData._extensions,function(stanzaObj){if(!stanzaObj.lang&&self.stream){stanzaObj.lang=self.stream.lang}self.emit("stream:data",stanzaObj)});if(ended){self.emit("stream:end")}})}util.inherits(OldWSConnection,WSConnection);OldWSConnection.prototype.startHeader=function(){return["<stream:stream",'xmlns:stream="http://etherx.jabber.org/streams"','xmlns="jabber:client"','version="'+(this.config.version||"1.0")+'"','xml:lang="'+(this.config.lang||"en")+'"','to="'+this.config.server+'">'].join(" ")};OldWSConnection.prototype.closeHeader=function(){return"</stream:stream>"};module.exports=OldWSConnection},{"./websocket":347,underscore:448,util:165}],347:[function(require,module,exports){(function(Buffer){"use strict";var util=require("util");var WildEmitter=require("wildemitter");var async=require("async");var WS=require("faye-websocket")&&require("faye-websocket").Client?require("faye-websocket").Client:window.WebSocket;var WS_OPEN=1;function WSConnection(sm,stanzas){var self=this;WildEmitter.call(this);self.sm=sm;self.closing=false;self.stanzas={Open:stanzas.getDefinition("open","urn:ietf:params:xml:ns:xmpp-framing",true),Close:stanzas.getDefinition("close","urn:ietf:params:xml:ns:xmpp-framing",true),StreamError:stanzas.getStreamError()};self.sendQueue=async.queue(function(data,cb){if(self.conn){if(typeof data!=="string"){data=data.toString()}data=new Buffer(data,"utf8").toString();self.emit("raw:outgoing",data);if(self.conn.readyState===WS_OPEN){self.conn.send(data)}}cb()},1);self.on("connected",function(){self.send(self.startHeader())});self.on("raw:incoming",function(data){var stanzaObj,err;data=data.trim();if(data===""){return}try{stanzaObj=stanzas.parse(data)}catch(e){err=new this.stanzas.StreamError({condition:"invalid-xml"});self.emit("stream:error",err,e);self.send(err);return self.disconnect()}if(stanzaObj._name==="openStream"){self.hasStream=true;self.stream=stanzaObj;return self.emit("stream:start",stanzaObj.toJSON())}if(stanzaObj._name==="closeStream"){self.emit("stream:end");return self.disconnect()}if(!stanzaObj.lang&&self.stream){stanzaObj.lang=self.stream.lang}self.emit("stream:data",stanzaObj)})}util.inherits(WSConnection,WildEmitter);WSConnection.prototype.connect=function(opts){var self=this;self.config=opts;self.hasStream=false;self.closing=false;self.conn=new WS(opts.wsURL,"xmpp");self.conn.onerror=function(e){e.preventDefault();self.emit("disconnected",self)};self.conn.onclose=function(){self.emit("disconnected",self)};self.conn.onopen=function(){self.sm.started=false;self.emit("connected",self)};self.conn.onmessage=function(wsMsg){self.emit("raw:incoming",new Buffer(wsMsg.data,"utf8").toString())}};WSConnection.prototype.startHeader=function(){return new this.stanzas.Open({version:this.config.version||"1.0",lang:this.config.lang||"en",to:this.config.server})};WSConnection.prototype.closeHeader=function(){return new this.stanzas.Close};WSConnection.prototype.disconnect=function(){if(this.conn&&!this.closing){this.closing=true;this.send(this.closeHeader())}else{this.hasStream=false;this.stream=undefined;if(this.conn.readyState===WS_OPEN){this.conn.close()}this.conn=undefined}};WSConnection.prototype.restart=function(){var self=this;self.hasStream=false;self.send(this.startHeader())};WSConnection.prototype.send=function(data){this.sendQueue.push(data)};module.exports=WSConnection}).call(this,require("buffer").Buffer)},{async:362,buffer:5,"faye-websocket":4,util:165,wildemitter:449}],348:[function(require,module,exports){var randomBytes=require("randombytes");var createHash=require("create-hash");function parse(chal){var dtives={};var tokens=chal.split(/,(?=(?:[^"]|"[^"]*")*$)/);for(var i=0,len=tokens.length;i<len;i++){var dtiv=/(\w+)=["]?([^"]+)["]?$/.exec(tokens[i]);if(dtiv){dtives[dtiv[1]]=dtiv[2]}}return dtives}function genNonce(){return randomBytes(16).toString("hex")}function Mechanism(options){options=options||{};this._genNonce=options.genNonce||genNonce}Mechanism.Mechanism=Mechanism;Mechanism.prototype.name="DIGEST-MD5";Mechanism.prototype.clientFirst=false;Mechanism.prototype.response=function(cred){if(this._completed){return undefined}var uri=cred.serviceType+"/"+cred.host;if(cred.serviceName&&cred.host!==cred.serviceName){uri+="/"+cred.serviceName}var realm=cred.realm||this._realm||"";var cnonce=this._genNonce();var nc="00000001";var qop="auth";var str="";str+='username="'+cred.username+'"';if(realm){str+=',realm="'+realm+'"'}str+=',nonce="'+this._nonce+'"';str+=',cnonce="'+cnonce+'"';str+=",nc="+nc;str+=",qop="+qop;str+=',digest-uri="'+uri+'"';var base=createHash("md5").update(cred.username).update(":").update(realm).update(":").update(cred.password).digest();var ha1=createHash("md5").update(base).update(":").update(this._nonce).update(":").update(cnonce);if(cred.authzid){ha1.update(":").update(cred.authzid)}ha1=ha1.digest("hex");var ha2=createHash("md5").update("AUTHENTICATE:").update(uri);if(qop==="auth-int"||qop==="auth-conf"){ha2.update(":00000000000000000000000000000000")}ha2=ha2.digest("hex");var digest=createHash("md5").update(ha1).update(":").update(this._nonce).update(":").update(nc).update(":").update(cnonce).update(":").update(qop).update(":").update(ha2).digest("hex");str+=",response="+digest;if(this._charset==="utf-8"){str+=",charset=utf-8"}if(cred.authzid){str+='authzid="'+cred.authzid+'"'}return str};Mechanism.prototype.challenge=function(chal){var dtives=parse(chal);this._completed=!!dtives.rspauth;this._realm=dtives.realm;this._nonce=dtives.nonce;this._qop=(dtives.qop||"auth").split(",");this._stale=dtives.stale;this._maxbuf=parseInt(dtives.maxbuf)||65536;this._charset=dtives.charset;this._algo=dtives.algorithm;this._cipher=dtives.cipher;if(this._cipher){this._cipher.split(",")}return this};module.exports=Mechanism},{"create-hash":349,randombytes:361}],349:[function(require,module,exports){module.exports=require(97)},{"./md5":351,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/browser.js":97,buffer:5,inherits:352,ripemd160:353,"sha.js":355,stream:163}],350:[function(require,module,exports){module.exports=require(98)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/helpers.js":98,buffer:5}],351:[function(require,module,exports){module.exports=require(99)},{"./helpers":350,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/md5.js":99}],352:[function(require,module,exports){module.exports=require(146)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/inherits/inherits_browser.js":146}],353:[function(require,module,exports){module.exports=require(100)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/ripemd160/lib/ripemd160.js":100,buffer:5}],354:[function(require,module,exports){module.exports=require(101)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/hash.js":101,buffer:5}],355:[function(require,module,exports){module.exports=require(102)},{"./sha1":356,"./sha224":357,"./sha256":358,"./sha384":359,"./sha512":360,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/index.js":102}],356:[function(require,module,exports){module.exports=require(103)},{"./hash":354,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha1.js":103,buffer:5,inherits:352}],357:[function(require,module,exports){module.exports=require(104)},{"./hash":354,"./sha256":358,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha224.js":104,buffer:5,inherits:352}],358:[function(require,module,exports){module.exports=require(105)},{"./hash":354,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha256.js":105,buffer:5,inherits:352}],359:[function(require,module,exports){module.exports=require(106)},{"./hash":354,"./sha512":360,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha384.js":106,buffer:5,inherits:352}],360:[function(require,module,exports){module.exports=require(107)},{"./hash":354,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha512.js":107,buffer:5,inherits:352}],361:[function(require,module,exports){module.exports=require(144)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/randombytes/browser.js":144,_process:149,buffer:5}],362:[function(require,module,exports){(function(process){(function(){var async={};var root,previous_async;root=this;if(root!=null){previous_async=root.async}async.noConflict=function(){root.async=previous_async;return async};function only_once(fn){var called=false;return function(){if(called)throw new Error("Callback was already called.");called=true;fn.apply(root,arguments)}}var _toString=Object.prototype.toString;var _isArray=Array.isArray||function(obj){return _toString.call(obj)==="[object Array]"};var _each=function(arr,iterator){if(arr.forEach){return arr.forEach(iterator)}for(var i=0;i<arr.length;i+=1){iterator(arr[i],i,arr)}};var _map=function(arr,iterator){if(arr.map){return arr.map(iterator)}var results=[];_each(arr,function(x,i,a){results.push(iterator(x,i,a))});return results};var _reduce=function(arr,iterator,memo){if(arr.reduce){return arr.reduce(iterator,memo)}_each(arr,function(x,i,a){memo=iterator(memo,x,i,a)});return memo};var _keys=function(obj){if(Object.keys){return Object.keys(obj)}var keys=[];for(var k in obj){if(obj.hasOwnProperty(k)){keys.push(k)}}return keys};if(typeof process==="undefined"||!process.nextTick){if(typeof setImmediate==="function"){async.nextTick=function(fn){setImmediate(fn)};async.setImmediate=async.nextTick}else{async.nextTick=function(fn){setTimeout(fn,0)};async.setImmediate=async.nextTick}}else{async.nextTick=process.nextTick;if(typeof setImmediate!=="undefined"){async.setImmediate=function(fn){setImmediate(fn)}}else{async.setImmediate=async.nextTick}}async.each=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;_each(arr,function(x){iterator(x,only_once(done))});function done(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback()}}}};async.forEach=async.each;async.eachSeries=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;var iterate=function(){iterator(arr[completed],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback()}else{iterate()}}})};iterate()};async.forEachSeries=async.eachSeries;async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback])};async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){callback=callback||function(){};if(!arr.length||limit<=0){return callback()}var completed=0;var started=0;var running=0;(function replenish(){if(completed>=arr.length){return callback()}while(running<limit&&started<arr.length){started+=1;running+=1;iterator(arr[started-1],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;running-=1;if(completed>=arr.length){callback()}else{replenish()}}})}})()}};var doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args))}};var doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args))}};var doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args))}};var _asyncMap=function(eachfn,arr,iterator,callback){arr=_map(arr,function(x,i){return{index:i,value:x}});if(!callback){eachfn(arr,function(x,callback){iterator(x.value,function(err){callback(err)})})}else{var results=[];eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v;callback(err)})},function(err){callback(err,results)})}};async.map=doParallel(_asyncMap);async.mapSeries=doSeries(_asyncMap);async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback)};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap)};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v;callback(err)})},function(err){callback(err,memo)})};async.inject=async.reduce;async.foldl=async.reduce;async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x}).reverse();async.reduce(reversed,memo,iterator,callback)};async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.filter=doParallel(_filter);async.filterSeries=doSeries(_filter);async.select=async.filter;async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(!v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.reject=doParallel(_reject);async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){if(result){main_callback(x);main_callback=function(){}}else{callback()}})},function(err){main_callback()})};async.detect=doParallel(_detect);async.detectSeries=doSeries(_detect);async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(v){main_callback(true);main_callback=function(){}}callback()})},function(err){main_callback(false)})};async.any=async.some;async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(!v){main_callback(false);main_callback=function(){}}callback()})},function(err){main_callback(true)})};async.all=async.every;async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){if(err){callback(err)}else{callback(null,{value:x,criteria:criteria})}})},function(err,results){if(err){return callback(err)}else{var fn=function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0};callback(null,_map(results.sort(fn),function(x){return x.value}))}})};async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks);var remainingTasks=keys.length;if(!remainingTasks){return callback()}var results={};var listeners=[];var addListener=function(fn){listeners.unshift(fn)};var removeListener=function(fn){for(var i=0;i<listeners.length;i+=1){if(listeners[i]===fn){listeners.splice(i,1);return}}};var taskComplete=function(){remainingTasks--;_each(listeners.slice(0),function(fn){fn()})};addListener(function(){if(!remainingTasks){var theCallback=callback;callback=function(){};theCallback(null,results)}});_each(keys,function(k){var task=_isArray(tasks[k])?tasks[k]:[tasks[k]];var taskCallback=function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}if(err){var safeResults={};_each(_keys(results),function(rkey){safeResults[rkey]=results[rkey]});safeResults[k]=args;callback(err,safeResults);callback=function(){}}else{results[k]=args;async.setImmediate(taskComplete)}};var requires=task.slice(0,Math.abs(task.length-1))||[];var ready=function(){return _reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},true)&&!results.hasOwnProperty(k)};if(ready()){task[task.length-1](taskCallback,results)}else{var listener=function(){if(ready()){removeListener(listener);task[task.length-1](taskCallback,results)}};addListener(listener)}})};async.retry=function(times,task,callback){var DEFAULT_TIMES=5;var attempts=[];if(typeof times==="function"){callback=task;task=times;times=DEFAULT_TIMES}times=parseInt(times,10)||DEFAULT_TIMES;var wrappedTask=function(wrappedCallback,wrappedResults){var retryAttempt=function(task,finalAttempt){return function(seriesCallback){task(function(err,result){seriesCallback(!err||finalAttempt,{err:err,result:result})},wrappedResults)}};while(times){attempts.push(retryAttempt(task,!(times-=1)))}async.series(attempts,function(done,data){data=data[data.length-1];(wrappedCallback||callback)(data.err,data.result)})};return callback?wrappedTask():wrappedTask};async.waterfall=function(tasks,callback){callback=callback||function(){};if(!_isArray(tasks)){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}if(!tasks.length){return callback()}var wrapIterator=function(iterator){return function(err){if(err){callback.apply(null,arguments);callback=function(){}}else{var args=Array.prototype.slice.call(arguments,1);var next=iterator.next();if(next){args.push(wrapIterator(next))}else{args.push(callback)}async.setImmediate(function(){iterator.apply(null,args)})}}};wrapIterator(async.iterator(tasks))()};var _parallel=function(eachfn,tasks,callback){callback=callback||function(){};if(_isArray(tasks)){eachfn.map(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback)};async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback)};async.series=function(tasks,callback){callback=callback||function(){};if(_isArray(tasks)){async.mapSeries(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){if(tasks.length){tasks[index].apply(null,arguments)}return fn.next()};fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null};return fn};return makeCallback(0)};async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)))}};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]);cb(err)})},function(err){callback(err,r)})};async.concat=doParallel(_concat);async.concatSeries=doSeries(_concat);async.whilst=function(test,iterator,callback){if(test()){iterator(function(err){if(err){return callback(err)}async.whilst(test,iterator,callback)})}else{callback()}};async.doWhilst=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}var args=Array.prototype.slice.call(arguments,1);if(test.apply(null,args)){async.doWhilst(iterator,test,callback)}else{callback()}})};async.until=function(test,iterator,callback){if(!test()){iterator(function(err){if(err){return callback(err)}async.until(test,iterator,callback)})}else{callback()}};async.doUntil=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}var args=Array.prototype.slice.call(arguments,1);if(!test.apply(null,args)){async.doUntil(iterator,test,callback)}else{callback()}})};async.queue=function(worker,concurrency){if(concurrency===undefined){concurrency=1}function _insert(q,data,pos,callback){if(!q.started){q.started=true}if(!_isArray(data)){data=[data]}if(data.length==0){return async.setImmediate(function(){if(q.drain){q.drain()}})}_each(data,function(task){var item={data:task,callback:typeof callback==="function"?callback:null};if(pos){q.tasks.unshift(item)}else{q.tasks.push(item)}if(q.saturated&&q.tasks.length===q.concurrency){q.saturated()}async.setImmediate(q.process)})}var workers=0;var q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,started:false,paused:false,push:function(data,callback){_insert(q,data,false,callback)},kill:function(){q.drain=null;q.tasks=[]},unshift:function(data,callback){_insert(q,data,true,callback)},process:function(){if(!q.paused&&workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();if(q.empty&&q.tasks.length===0){q.empty()}workers+=1;var next=function(){workers-=1;if(task.callback){task.callback.apply(task,arguments)}if(q.drain&&q.tasks.length+workers===0){q.drain()}q.process()};var cb=only_once(next);worker(task.data,cb)}},length:function(){return q.tasks.length},running:function(){return workers},idle:function(){return q.tasks.length+workers===0},pause:function(){if(q.paused===true){return}q.paused=true;q.process()},resume:function(){if(q.paused===false){return}q.paused=false;q.process()}};return q};async.priorityQueue=function(worker,concurrency){function _compareTasks(a,b){return a.priority-b.priority}function _binarySearch(sequence,item,compare){var beg=-1,end=sequence.length-1;while(beg<end){var mid=beg+(end-beg+1>>>1);if(compare(item,sequence[mid])>=0){beg=mid}else{end=mid-1}}return beg}function _insert(q,data,priority,callback){if(!q.started){q.started=true}if(!_isArray(data)){data=[data]}if(data.length==0){return async.setImmediate(function(){if(q.drain){q.drain()}})}_each(data,function(task){var item={data:task,priority:priority,callback:typeof callback==="function"?callback:null};q.tasks.splice(_binarySearch(q.tasks,item,_compareTasks)+1,0,item);if(q.saturated&&q.tasks.length===q.concurrency){q.saturated()}async.setImmediate(q.process)})}var q=async.queue(worker,concurrency);q.push=function(data,priority,callback){_insert(q,data,priority,callback)};delete q.unshift;return q};async.cargo=function(worker,payload){var working=false,tasks=[];var cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,drained:true,push:function(data,callback){if(!_isArray(data)){data=[data]}_each(data,function(task){tasks.push({data:task,callback:typeof callback==="function"?callback:null});cargo.drained=false;if(cargo.saturated&&tasks.length===payload){cargo.saturated()}});async.setImmediate(cargo.process)},process:function process(){if(working)return;if(tasks.length===0){if(cargo.drain&&!cargo.drained)cargo.drain();cargo.drained=true;return}var ts=typeof payload==="number"?tasks.splice(0,payload):tasks.splice(0,tasks.length);var ds=_map(ts,function(task){return task.data});if(cargo.empty)cargo.empty();working=true;worker(ds,function(){working=false;var args=arguments;_each(ts,function(data){if(data.callback){data.callback.apply(null,args)}});process()})},length:function(){return tasks.length},running:function(){return working}};return cargo};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);if(typeof console!=="undefined"){if(err){if(console.error){console.error(err)}}else if(console[name]){_each(args,function(x){console[name](x)})}}}]))}};async.log=_console_fn("log");async.dir=_console_fn("dir");async.memoize=function(fn,hasher){var memo={};var queues={};hasher=hasher||function(x){return x};var memoized=function(){var args=Array.prototype.slice.call(arguments);var callback=args.pop();var key=hasher.apply(null,args);if(key in memo){async.nextTick(function(){callback.apply(null,memo[key])})}else if(key in queues){queues[key].push(callback)}else{queues[key]=[callback];fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++){q[i].apply(null,arguments)}}]))}};memoized.memo=memo;memoized.unmemoized=fn;return memoized};async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}};async.times=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.map(counter,iterator,callback)};async.timesSeries=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.mapSeries(counter,iterator,callback)};async.seq=function(){var fns=arguments;return function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0];var nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs)}]))},function(err,results){callback.apply(that,[err].concat(results))})}};async.compose=function(){return async.seq.apply(null,Array.prototype.reverse.call(arguments))};var _applyEach=function(eachfn,fns){var go=function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]))},callback)};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args)}else{return go}};async.applyEach=doParallel(_applyEach);async.applyEachSeries=doSeries(_applyEach);async.forever=function(fn,callback){function next(err){if(err){if(callback){return callback(err)}throw err}fn(next)}next()};if(typeof module!=="undefined"&&module.exports){module.exports=async}else if(typeof define!=="undefined"&&define.amd){define([],function(){return async})}else{root.async=async}})()}).call(this,require("_process"))},{_process:149}],363:[function(require,module,exports){(function(process,global){!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Promise=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof _dereq_=="function"&&_dereq_;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof _dereq_=="function"&&_dereq_;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){var SomePromiseArray=Promise._SomePromiseArray;function any(promises){var ret=new SomePromiseArray(promises);var promise=ret.promise();ret.setHowMany(1);ret.setUnwrap();ret.init();return promise}Promise.any=function(promises){return any(promises)};Promise.prototype.any=function(){return any(this)}}},{}],2:[function(_dereq_,module,exports){"use strict";var firstLineError;try{throw new Error}catch(e){firstLineError=e}var schedule=_dereq_("./schedule.js");var Queue=_dereq_("./queue.js");var _process=typeof process!=="undefined"?process:undefined;function Async(){this._isTickUsed=false;this._lateQueue=new Queue(16);this._normalQueue=new Queue(16);var self=this;this.drainQueues=function(){self._drainQueues()};this._schedule=schedule.isStatic?schedule(this.drainQueues):schedule}Async.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0};Async.prototype._withDomain=function(fn){if(_process!==undefined&&_process.domain!=null&&!fn.domain){fn=_process.domain.bind(fn)}return fn};Async.prototype.throwLater=function(fn,arg){if(arguments.length===1){arg=fn;fn=function(){throw arg}}fn=this._withDomain(fn);if(typeof setTimeout!=="undefined"){setTimeout(function(){fn(arg)},0)}else try{this._schedule(function(){fn(arg)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}};Async.prototype.invokeLater=function(fn,receiver,arg){fn=this._withDomain(fn);this._lateQueue.push(fn,receiver,arg);this._queueTick()};Async.prototype.invokeFirst=function(fn,receiver,arg){fn=this._withDomain(fn);this._normalQueue.unshift(fn,receiver,arg);this._queueTick()};Async.prototype.invoke=function(fn,receiver,arg){fn=this._withDomain(fn);this._normalQueue.push(fn,receiver,arg);this._queueTick()};Async.prototype.settlePromises=function(promise){this._normalQueue._pushOne(promise);this._queueTick()};Async.prototype._drainQueue=function(queue){while(queue.length()>0){var fn=queue.shift();if(typeof fn!=="function"){fn._settlePromises();continue}var receiver=queue.shift();var arg=queue.shift();fn.call(receiver,arg)}};Async.prototype._drainQueues=function(){this._drainQueue(this._normalQueue);this._reset();this._drainQueue(this._lateQueue)};Async.prototype._queueTick=function(){if(!this._isTickUsed){this._isTickUsed=true;this._schedule(this.drainQueues)}};Async.prototype._reset=function(){this._isTickUsed=false};module.exports=new Async;module.exports.firstLineError=firstLineError},{"./queue.js":28,"./schedule.js":31}],3:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise){function returnThis(){return this.value}function throwThis(){throw this.reason}function awaitBindingThenResolve(value){return this._then(returnThis,null,null,{value:value},undefined)}function awaitBindingThenReject(reason){return this._then(throwThis,throwThis,null,{reason:reason},undefined)}function setBinding(binding){this._setBoundTo(binding)}Promise.prototype.bind=function(thisArg){var maybePromise=tryConvertToPromise(thisArg);if(maybePromise instanceof Promise){if(maybePromise.isFulfilled()){thisArg=maybePromise.value()}else if(maybePromise.isRejected()){return Promise.reject(maybePromise.reason())}else{var ret=this.then();var parent=ret;ret=ret._then(awaitBindingThenResolve,awaitBindingThenReject,null,maybePromise,undefined);maybePromise._then(setBinding,ret._reject,null,ret,null);if(!ret._cancellable())ret._setPendingCancellationParent(parent);return ret}}var ret=this.then();ret._setBoundTo(thisArg);return ret};Promise.bind=function(thisArg,value){return Promise.resolve(value).bind(thisArg)
};Promise.prototype._setPendingCancellationParent=function(parent){this._settledValue=parent};Promise.prototype._pendingCancellationParent=function(){if(this.isPending()&&this._settledValue!==undefined){var ret=this._settledValue;ret.cancellable();this._settledValue=undefined;return ret}};Promise.prototype._setIsBound=function(){this._bitField=this._bitField|131072};Promise.prototype._unsetIsBound=function(){this._bitField=this._bitField&~131072};Promise.prototype._isBound=function(){return(this._bitField&131072)===131072};Promise.prototype._setIsMigratingBinding=function(){this._bitField=this._bitField|8388608};Promise.prototype._unsetIsMigratingBinding=function(){this._bitField=this._bitField&~8388608};Promise.prototype._isMigratingBinding=function(){return(this._bitField&8388608)===8388608};Promise.prototype._setBoundTo=function(obj){if(obj===undefined){if(this._isBound()){this._boundTo=undefined}this._unsetIsBound()}else{this._setIsBound();this._boundTo=obj}}}},{}],4:[function(_dereq_,module,exports){"use strict";var old;if(typeof Promise!=="undefined")old=Promise;function noConflict(){try{if(Promise===bluebird)Promise=old}catch(e){}return bluebird}var bluebird=_dereq_("./promise.js")();bluebird.noConflict=noConflict;module.exports=bluebird},{"./promise.js":23}],5:[function(_dereq_,module,exports){"use strict";var cr=Object.create;if(cr){var callerCache=cr(null);var getterCache=cr(null);callerCache[" size"]=getterCache[" size"]=0}module.exports=function(Promise){var util=_dereq_("./util.js");var canEvaluate=util.canEvaluate;var isIdentifier=util.isIdentifier;var getMethodCaller;var getGetter;if(!true){var makeMethodCaller=function(methodName){return new Function("ensureMethod","                                    \n        return function(obj) {                                               \n            'use strict'                                                     \n            var len = this.length;                                           \n            ensureMethod(obj, 'methodName');                                 \n            switch(len) {                                                    \n                case 1: return obj.methodName(this[0]);                      \n                case 2: return obj.methodName(this[0], this[1]);             \n                case 3: return obj.methodName(this[0], this[1], this[2]);    \n                case 0: return obj.methodName();                             \n                default:                                                     \n                    return obj.methodName.apply(obj, this);                  \n            }                                                                \n        };                                                                   \n        ".replace(/methodName/g,methodName))(ensureMethod)};var makeGetter=function(propertyName){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",propertyName))};var getCompiled=function(name,compiler,cache){var ret=cache[name];if(typeof ret!=="function"){if(!isIdentifier(name)){return null}ret=compiler(name);cache[name]=ret;cache[" size"]++;if(cache[" size"]>512){var keys=Object.keys(cache);for(var i=0;i<256;++i)delete cache[keys[i]];cache[" size"]=keys.length-256}}return ret};getMethodCaller=function(name){return getCompiled(name,makeMethodCaller,callerCache)};getGetter=function(name){return getCompiled(name,makeGetter,getterCache)}}function ensureMethod(obj,methodName){var fn;if(obj!=null)fn=obj[methodName];if(typeof fn!=="function"){var message="Object "+util.classString(obj)+" has no method '"+util.toString(methodName)+"'";throw new Promise.TypeError(message)}return fn}function caller(obj){var methodName=this.pop();var fn=ensureMethod(obj,methodName);return fn.apply(obj,this)}Promise.prototype.call=function(methodName){var $_len=arguments.length;var args=new Array($_len-1);for(var $_i=1;$_i<$_len;++$_i){args[$_i-1]=arguments[$_i]}if(!true){if(canEvaluate){var maybeCaller=getMethodCaller(methodName);if(maybeCaller!==null){return this._then(maybeCaller,undefined,undefined,args,undefined)}}}args.push(methodName);return this._then(caller,undefined,undefined,args,undefined)};function namedGetter(obj){return obj[this]}function indexedGetter(obj){var index=+this;if(index<0)index=Math.max(0,index+obj.length);return obj[index]}Promise.prototype.get=function(propertyName){var isIndex=typeof propertyName==="number";var getter;if(!isIndex){if(canEvaluate){var maybeGetter=getGetter(propertyName);getter=maybeGetter!==null?maybeGetter:namedGetter}else{getter=namedGetter}}else{getter=indexedGetter}return this._then(getter,undefined,undefined,propertyName,undefined)}}},{"./util.js":38}],6:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){var errors=_dereq_("./errors.js");var async=_dereq_("./async.js");var CancellationError=errors.CancellationError;Promise.prototype._cancel=function(reason){if(!this.isCancellable())return this;var parent;var promiseToReject=this;while((parent=promiseToReject._cancellationParent)!==undefined&&parent.isCancellable()){promiseToReject=parent}this._unsetCancellable();promiseToReject._target()._rejectCallback(reason,false,true)};Promise.prototype.cancel=function(reason){if(!this.isCancellable())return this;if(reason===undefined)reason=new CancellationError;async.invokeLater(this._cancel,this,reason);return this};Promise.prototype.cancellable=function(){if(this._cancellable())return this;this._setCancellable();this._cancellationParent=this._pendingCancellationParent();return this};Promise.prototype.uncancellable=function(){var ret=this.then();ret._unsetCancellable();return ret};Promise.prototype.fork=function(didFulfill,didReject,didProgress){var ret=this._then(didFulfill,didReject,didProgress,undefined,undefined);ret._setCancellable();ret._cancellationParent=undefined;return ret}}},{"./async.js":2,"./errors.js":13}],7:[function(_dereq_,module,exports){"use strict";module.exports=function(){var async=_dereq_("./async.js");var util=_dereq_("./util.js");var bluebirdFramePattern=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo|instrumented)/;var stackFramePattern=null;var formatStack=null;var indentStackFrames=false;var warn;function CapturedTrace(parent){this._parent=parent;var length=this._length=1+(parent===undefined?0:parent._length);captureStackTrace(this,CapturedTrace);if(length>32)this.uncycle()}util.inherits(CapturedTrace,Error);CapturedTrace.prototype.uncycle=function(){var length=this._length;if(length<2)return;var nodes=[];var stackToIndex={};for(var i=0,node=this;node!==undefined;++i){nodes.push(node);node=node._parent}length=this._length=i;for(var i=length-1;i>=0;--i){var stack=nodes[i].stack;if(stackToIndex[stack]===undefined){stackToIndex[stack]=i}}for(var i=0;i<length;++i){var currentStack=nodes[i].stack;var index=stackToIndex[currentStack];if(index!==undefined&&index!==i){if(index>0){nodes[index-1]._parent=undefined;nodes[index-1]._length=1}nodes[i]._parent=undefined;nodes[i]._length=1;var cycleEdgeNode=i>0?nodes[i-1]:this;if(index<length-1){cycleEdgeNode._parent=nodes[index+1];cycleEdgeNode._parent.uncycle();cycleEdgeNode._length=cycleEdgeNode._parent._length+1}else{cycleEdgeNode._parent=undefined;cycleEdgeNode._length=1}var currentChildLength=cycleEdgeNode._length+1;for(var j=i-2;j>=0;--j){nodes[j]._length=currentChildLength;currentChildLength++}return}}};CapturedTrace.prototype.parent=function(){return this._parent};CapturedTrace.prototype.hasParent=function(){return this._parent!==undefined};CapturedTrace.prototype.attachExtraTrace=function(error){if(error.__stackCleaned__)return;this.uncycle();var parsed=CapturedTrace.parseStackAndMessage(error);var message=parsed.message;var stacks=[parsed.stack];var trace=this;while(trace!==undefined){stacks.push(cleanStack(trace.stack.split("\n")));trace=trace._parent}removeCommonRoots(stacks);removeDuplicateOrEmptyJumps(stacks);error.stack=reconstructStack(message,stacks);error.__stackCleaned__=true};function reconstructStack(message,stacks){for(var i=0;i<stacks.length-1;++i){stacks[i].push("From previous event:");stacks[i]=stacks[i].join("\n")}if(i<stacks.length){stacks[i]=stacks[i].join("\n")}return message+"\n"+stacks.join("\n")}function removeDuplicateOrEmptyJumps(stacks){for(var i=0;i<stacks.length;++i){if(stacks[i].length===0||i+1<stacks.length&&stacks[i][0]===stacks[i+1][0]){stacks.splice(i,1);i--}}}function removeCommonRoots(stacks){var current=stacks[0];for(var i=1;i<stacks.length;++i){var prev=stacks[i];var currentLastIndex=current.length-1;var currentLastLine=current[currentLastIndex];var commonRootMeetPoint=-1;for(var j=prev.length-1;j>=0;--j){if(prev[j]===currentLastLine){commonRootMeetPoint=j;break}}for(var j=commonRootMeetPoint;j>=0;--j){var line=prev[j];if(current[currentLastIndex]===line){current.pop();currentLastIndex--}else{break}}current=prev}}function cleanStack(stack){var ret=[];for(var i=0;i<stack.length;++i){var line=stack[i];var isTraceLine=stackFramePattern.test(line)||"    (No stack trace)"===line;var isInternalFrame=isTraceLine&&shouldIgnore(line);if(isTraceLine&&!isInternalFrame){if(indentStackFrames&&line.charAt(0)!==" "){line="    "+line}ret.push(line)}}return ret}function stackFramesAsArray(error){var stack=error.stack.replace(/\s+$/g,"").split("\n");for(var i=0;i<stack.length;++i){var line=stack[i];if("    (No stack trace)"===line||stackFramePattern.test(line)){break}}if(i>0){stack=stack.slice(i)}return stack}CapturedTrace.parseStackAndMessage=function(error){var stack=error.stack;var message=error.toString();stack=typeof stack==="string"&&stack.length>0?stackFramesAsArray(error):["    (No stack trace)"];return{message:message,stack:cleanStack(stack)}};CapturedTrace.formatAndLogError=function(error,title){if(typeof console!=="undefined"){var message;if(typeof error==="object"||typeof error==="function"){var stack=error.stack;message=title+formatStack(stack,error)}else{message=title+String(error)}if(typeof warn==="function"){warn(message)}else if(typeof console.log==="function"||typeof console.log==="object"){console.log(message)}}};CapturedTrace.unhandledRejection=function(reason){CapturedTrace.formatAndLogError(reason,"^--- With additional stack trace: ")};CapturedTrace.isSupported=function(){return typeof captureStackTrace==="function"};CapturedTrace.fireRejectionEvent=function(name,localHandler,reason,promise){var localEventFired=false;try{if(typeof localHandler==="function"){localEventFired=true;if(name==="rejectionHandled"){localHandler(promise)}else{localHandler(reason,promise)}}}catch(e){async.throwLater(e)}var globalEventFired=false;try{globalEventFired=fireGlobalEvent(name,reason,promise)}catch(e){globalEventFired=true;async.throwLater(e)}var domEventFired=false;if(fireDomEvent){try{domEventFired=fireDomEvent(name.toLowerCase(),{reason:reason,promise:promise})}catch(e){domEventFired=true;async.throwLater(e)}}if(!globalEventFired&&!localEventFired&&!domEventFired&&name==="unhandledRejection"){CapturedTrace.formatAndLogError(reason,"Unhandled rejection ")}};function formatNonError(obj){var str;if(typeof obj==="function"){str="[function "+(obj.name||"anonymous")+"]"}else{str=obj.toString();var ruselessToString=/\[object [a-zA-Z0-9$_]+\]/;if(ruselessToString.test(str)){try{var newStr=JSON.stringify(obj);str=newStr}catch(e){}}if(str.length===0){str="(empty array)"}}return"(<"+snip(str)+">, no stack trace)"}function snip(str){var maxChars=41;if(str.length<maxChars){return str}return str.substr(0,maxChars-3)+"..."}var shouldIgnore=function(){return false};var parseLineInfoRegex=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function parseLineInfo(line){var matches=line.match(parseLineInfoRegex);if(matches){return{fileName:matches[1],line:parseInt(matches[2],10)}}}CapturedTrace.setBounds=function(firstLineError,lastLineError){if(!CapturedTrace.isSupported())return;var firstStackLines=firstLineError.stack.split("\n");var lastStackLines=lastLineError.stack.split("\n");var firstIndex=-1;var lastIndex=-1;var firstFileName;var lastFileName;for(var i=0;i<firstStackLines.length;++i){var result=parseLineInfo(firstStackLines[i]);if(result){firstFileName=result.fileName;firstIndex=result.line;break}}for(var i=0;i<lastStackLines.length;++i){var result=parseLineInfo(lastStackLines[i]);if(result){lastFileName=result.fileName;lastIndex=result.line;break}}if(firstIndex<0||lastIndex<0||!firstFileName||!lastFileName||firstFileName!==lastFileName||firstIndex>=lastIndex){return}shouldIgnore=function(line){if(bluebirdFramePattern.test(line))return true;var info=parseLineInfo(line);if(info){if(info.fileName===firstFileName&&(firstIndex<=info.line&&info.line<=lastIndex)){return true}}return false}};var captureStackTrace=function stackDetection(){var v8stackFramePattern=/^\s*at\s*/;var v8stackFormatter=function(stack,error){if(typeof stack==="string")return stack;if(error.name!==undefined&&error.message!==undefined){return error.toString()}return formatNonError(error)};if(typeof Error.stackTraceLimit==="number"&&typeof Error.captureStackTrace==="function"){Error.stackTraceLimit=Error.stackTraceLimit+6;stackFramePattern=v8stackFramePattern;formatStack=v8stackFormatter;var captureStackTrace=Error.captureStackTrace;shouldIgnore=function(line){return bluebirdFramePattern.test(line)};return function(receiver,ignoreUntil){Error.stackTraceLimit=Error.stackTraceLimit+6;captureStackTrace(receiver,ignoreUntil);Error.stackTraceLimit=Error.stackTraceLimit-6}}var err=new Error;if(typeof err.stack==="string"&&err.stack.split("\n")[0].indexOf("stackDetection@")>=0){stackFramePattern=/@/;formatStack=v8stackFormatter;indentStackFrames=true;return function captureStackTrace(o){o.stack=(new Error).stack}}var hasStackAfterThrow;try{throw new Error}catch(e){hasStackAfterThrow="stack"in e}if(!("stack"in err)&&hasStackAfterThrow){stackFramePattern=v8stackFramePattern;formatStack=v8stackFormatter;return function captureStackTrace(o){Error.stackTraceLimit=Error.stackTraceLimit+6;try{throw new Error}catch(e){o.stack=e.stack}Error.stackTraceLimit=Error.stackTraceLimit-6}}formatStack=function(stack,error){if(typeof stack==="string")return stack;if((typeof error==="object"||typeof error==="function")&&error.name!==undefined&&error.message!==undefined){return error.toString()}return formatNonError(error)};return null}([]);var fireDomEvent;var fireGlobalEvent=function(){if(util.isNode){return function(name,reason,promise){if(name==="rejectionHandled"){return process.emit(name,promise)}else{return process.emit(name,reason,promise)}}}else{var customEventWorks=false;var anyEventWorks=true;try{var ev=new self.CustomEvent("test");customEventWorks=ev instanceof CustomEvent}catch(e){}if(!customEventWorks){try{var event=document.createEvent("CustomEvent");event.initCustomEvent("testingtheevent",false,true,{});self.dispatchEvent(event)}catch(e){anyEventWorks=false}}if(anyEventWorks){fireDomEvent=function(type,detail){var event;if(customEventWorks){event=new self.CustomEvent(type,{detail:detail,bubbles:false,cancelable:true})}else if(self.dispatchEvent){event=document.createEvent("CustomEvent");event.initCustomEvent(type,false,true,detail)}return event?!self.dispatchEvent(event):false}}var toWindowMethodNameMap={};toWindowMethodNameMap["unhandledRejection"]=("on"+"unhandledRejection").toLowerCase();toWindowMethodNameMap["rejectionHandled"]=("on"+"rejectionHandled").toLowerCase();return function(name,reason,promise){var methodName=toWindowMethodNameMap[name];var method=self[methodName];if(!method)return false;if(name==="rejectionHandled"){method.call(self,promise)}else{method.call(self,reason,promise)}return true}}}();if(typeof console!=="undefined"&&typeof console.warn!=="undefined"){warn=function(message){console.warn(message)};if(util.isNode&&process.stderr.isTTY){warn=function(message){process.stderr.write("[31m"+message+"[39m\n")}}else if(!util.isNode&&typeof(new Error).stack==="string"){warn=function(message){console.warn("%c"+message,"color: red")}}}return CapturedTrace}},{"./async.js":2,"./util.js":38}],8:[function(_dereq_,module,exports){"use strict";module.exports=function(NEXT_FILTER){var util=_dereq_("./util.js");var errors=_dereq_("./errors.js");var tryCatch=util.tryCatch;var errorObj=util.errorObj;var keys=_dereq_("./es5.js").keys;var TypeError=errors.TypeError;function CatchFilter(instances,callback,promise){this._instances=instances;this._callback=callback;this._promise=promise}function safePredicate(predicate,e){var safeObject={};var retfilter=tryCatch(predicate).call(safeObject,e);if(retfilter===errorObj)return retfilter;var safeKeys=keys(safeObject);if(safeKeys.length){errorObj.e=new TypeError("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n");return errorObj}return retfilter}CatchFilter.prototype.doFilter=function(e){var cb=this._callback;var promise=this._promise;var boundTo=promise._boundTo;for(var i=0,len=this._instances.length;i<len;++i){var item=this._instances[i];var itemIsErrorType=item===Error||item!=null&&item.prototype instanceof Error;if(itemIsErrorType&&e instanceof item){var ret=tryCatch(cb).call(boundTo,e);if(ret===errorObj){NEXT_FILTER.e=ret.e;return NEXT_FILTER}return ret}else if(typeof item==="function"&&!itemIsErrorType){var shouldHandle=safePredicate(item,e);if(shouldHandle===errorObj){e=errorObj.e;break}else if(shouldHandle){var ret=tryCatch(cb).call(boundTo,e);if(ret===errorObj){NEXT_FILTER.e=ret.e;return NEXT_FILTER}return ret}}}NEXT_FILTER.e=e;return NEXT_FILTER};return CatchFilter}},{"./errors.js":13,"./es5.js":14,"./util.js":38}],9:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,CapturedTrace,isDebugging){var contextStack=[];function Context(){this._trace=new CapturedTrace(peekContext())}Context.prototype._pushContext=function(){if(!isDebugging())return;if(this._trace!==undefined){contextStack.push(this._trace)}};Context.prototype._popContext=function(){if(!isDebugging())return;if(this._trace!==undefined){contextStack.pop()}};function createContext(){if(isDebugging())return new Context}function peekContext(){var lastIndex=contextStack.length-1;if(lastIndex>=0){return contextStack[lastIndex]}return undefined}Promise.prototype._peekContext=peekContext;Promise.prototype._pushContext=Context.prototype._pushContext;Promise.prototype._popContext=Context.prototype._popContext;return createContext}},{}],10:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,CapturedTrace){var async=_dereq_("./async.js");var Warning=_dereq_("./errors.js").Warning;var util=_dereq_("./util.js");var canAttachTrace=util.canAttachTrace;var unhandledRejectionHandled;var possiblyUnhandledRejection;var debugging=false||util.isNode&&(!!process.env["BLUEBIRD_DEBUG"]||process.env["NODE_ENV"]==="development");Promise.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled();async.invokeLater(this._notifyUnhandledRejection,this,undefined)};Promise.prototype._notifyUnhandledRejectionIsHandled=function(){CapturedTrace.fireRejectionEvent("rejectionHandled",unhandledRejectionHandled,undefined,this)};Promise.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var reason=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified();CapturedTrace.fireRejectionEvent("unhandledRejection",possiblyUnhandledRejection,reason,this)}};Promise.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=this._bitField|524288};Promise.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&~524288};Promise.prototype._isUnhandledRejectionNotified=function(){return(this._bitField&524288)>0};Promise.prototype._setRejectionIsUnhandled=function(){this._bitField=this._bitField|2097152};Promise.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&~2097152;if(this._isUnhandledRejectionNotified()){this._unsetUnhandledRejectionIsNotified();this._notifyUnhandledRejectionIsHandled()}};Promise.prototype._isRejectionUnhandled=function(){return(this._bitField&2097152)>0};Promise.prototype._setCarriedStackTrace=function(capturedTrace){this._bitField=this._bitField|1048576;this._fulfillmentHandler0=capturedTrace};Promise.prototype._isCarryingStackTrace=function(){return(this._bitField&1048576)>0};Promise.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:undefined};Promise.prototype._captureStackTrace=function(){if(debugging){this._trace=new CapturedTrace(this._peekContext())}return this};Promise.prototype._attachExtraTrace=function(error,ignoreSelf){if(debugging&&canAttachTrace(error)){var trace=this._trace;if(trace!==undefined){if(ignoreSelf)trace=trace._parent}if(trace!==undefined){trace.attachExtraTrace(error)}else if(!error.__stackCleaned__){var parsed=CapturedTrace.parseStackAndMessage(error);error.stack=parsed.message+"\n"+parsed.stack.join("\n");error.__stackCleaned__=true}}};Promise.prototype._warn=function(message){var warning=new Warning(message);var ctx=this._peekContext();if(ctx){ctx.attachExtraTrace(warning)}else{var parsed=CapturedTrace.parseStackAndMessage(warning);warning.stack=parsed.message+"\n"+parsed.stack.join("\n")}CapturedTrace.formatAndLogError(warning,"")};Promise.onPossiblyUnhandledRejection=function(fn){possiblyUnhandledRejection=typeof fn==="function"?fn:undefined};Promise.onUnhandledRejectionHandled=function(fn){unhandledRejectionHandled=typeof fn==="function"?fn:undefined};Promise.longStackTraces=function(){if(async.haveItemsQueued()&&debugging===false){throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/DT1qyG\n")}debugging=CapturedTrace.isSupported()};Promise.hasLongStackTraces=function(){return debugging&&CapturedTrace.isSupported()};if(!CapturedTrace.isSupported()){Promise.longStackTraces=function(){};debugging=false}return function(){return debugging}}},{"./async.js":2,"./errors.js":13,"./util.js":38}],11:[function(_dereq_,module,exports){"use strict";var util=_dereq_("./util.js");var isPrimitive=util.isPrimitive;var wrapsPrimitiveReceiver=util.wrapsPrimitiveReceiver;module.exports=function(Promise){var returner=function(){return this};var thrower=function(){throw this};var wrapper=function(value,action){if(action===1){return function(){throw value}}else if(action===2){return function(){return value}}};Promise.prototype["return"]=Promise.prototype.thenReturn=function(value){if(wrapsPrimitiveReceiver&&isPrimitive(value)){return this._then(wrapper(value,2),undefined,undefined,undefined,undefined)}return this._then(returner,undefined,undefined,value,undefined)};Promise.prototype["throw"]=Promise.prototype.thenThrow=function(reason){if(wrapsPrimitiveReceiver&&isPrimitive(reason)){return this._then(wrapper(reason,1),undefined,undefined,undefined,undefined)}return this._then(thrower,undefined,undefined,reason,undefined)}}},{"./util.js":38}],12:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var PromiseReduce=Promise.reduce;Promise.prototype.each=function(fn){return PromiseReduce(this,fn,null,INTERNAL)};Promise.each=function(promises,fn){return PromiseReduce(promises,fn,null,INTERNAL)}}},{}],13:[function(_dereq_,module,exports){"use strict";var es5=_dereq_("./es5.js");var Objectfreeze=es5.freeze;var util=_dereq_("./util.js");var inherits=util.inherits;var notEnumerableProp=util.notEnumerableProp;function subError(nameProperty,defaultMessage){function SubError(message){if(!(this instanceof SubError))return new SubError(message);notEnumerableProp(this,"message",typeof message==="string"?message:defaultMessage);notEnumerableProp(this,"name",nameProperty);if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor)}else{Error.call(this)}}inherits(SubError,Error);return SubError}var _TypeError,_RangeError;var Warning=subError("Warning","warning");var CancellationError=subError("CancellationError","cancellation error");var TimeoutError=subError("TimeoutError","timeout error");var AggregateError=subError("AggregateError","aggregate error");try{_TypeError=TypeError;_RangeError=RangeError}catch(e){_TypeError=subError("TypeError","type error");_RangeError=subError("RangeError","range error")}var methods=("join pop push shift unshift slice filter forEach some "+"every map indexOf lastIndexOf reduce reduceRight sort reverse").split(" ");for(var i=0;i<methods.length;++i){if(typeof Array.prototype[methods[i]]==="function"){AggregateError.prototype[methods[i]]=Array.prototype[methods[i]]}}es5.defineProperty(AggregateError.prototype,"length",{value:0,configurable:false,writable:true,enumerable:true});AggregateError.prototype["isOperational"]=true;var level=0;AggregateError.prototype.toString=function(){var indent=Array(level*4+1).join(" ");var ret="\n"+indent+"AggregateError of:"+"\n";level++;indent=Array(level*4+1).join(" ");for(var i=0;i<this.length;++i){var str=this[i]===this?"[Circular AggregateError]":this[i]+"";var lines=str.split("\n");for(var j=0;j<lines.length;++j){lines[j]=indent+lines[j]}str=lines.join("\n");ret+=str+"\n"}level--;return ret};function OperationalError(message){if(!(this instanceof OperationalError))return new OperationalError(message);notEnumerableProp(this,"name","OperationalError");notEnumerableProp(this,"message",message);this.cause=message;this["isOperational"]=true;if(message instanceof Error){notEnumerableProp(this,"message",message.message);notEnumerableProp(this,"stack",message.stack)}else if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor)}}inherits(OperationalError,Error);var errorTypes=Error["__BluebirdErrorTypes__"];if(!errorTypes){errorTypes=Objectfreeze({CancellationError:CancellationError,TimeoutError:TimeoutError,OperationalError:OperationalError,RejectionError:OperationalError,AggregateError:AggregateError});notEnumerableProp(Error,"__BluebirdErrorTypes__",errorTypes)}module.exports={Error:Error,TypeError:_TypeError,RangeError:_RangeError,CancellationError:errorTypes.CancellationError,OperationalError:errorTypes.OperationalError,TimeoutError:errorTypes.TimeoutError,AggregateError:errorTypes.AggregateError,Warning:Warning}},{"./es5.js":14,"./util.js":38}],14:[function(_dereq_,module,exports){var isES5=function(){"use strict";return this===undefined}();if(isES5){module.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:isES5,propertyIsWritable:function(obj,prop){var descriptor=Object.getOwnPropertyDescriptor(obj,prop);return!!(!descriptor||descriptor.writable||descriptor.set)}}}else{var has={}.hasOwnProperty;var str={}.toString;var proto={}.constructor.prototype;var ObjectKeys=function(o){var ret=[];for(var key in o){if(has.call(o,key)){ret.push(key)}}return ret};var ObjectGetDescriptor=function(o,key){return{value:o[key]}};var ObjectDefineProperty=function(o,key,desc){o[key]=desc.value;return o};var ObjectFreeze=function(obj){return obj};var ObjectGetPrototypeOf=function(obj){try{return Object(obj).constructor.prototype}catch(e){return proto}};var ArrayIsArray=function(obj){try{return str.call(obj)==="[object Array]"}catch(e){return false}};module.exports={isArray:ArrayIsArray,keys:ObjectKeys,names:ObjectKeys,defineProperty:ObjectDefineProperty,getDescriptor:ObjectGetDescriptor,freeze:ObjectFreeze,getPrototypeOf:ObjectGetPrototypeOf,isES5:isES5,propertyIsWritable:function(){return true}}}},{}],15:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var PromiseMap=Promise.map;Promise.prototype.filter=function(fn,options){return PromiseMap(this,fn,options,INTERNAL)};Promise.filter=function(promises,fn,options){return PromiseMap(promises,fn,options,INTERNAL)}}},{}],16:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,NEXT_FILTER,tryConvertToPromise){var util=_dereq_("./util.js");var wrapsPrimitiveReceiver=util.wrapsPrimitiveReceiver;var isPrimitive=util.isPrimitive;var thrower=util.thrower;function returnThis(){return this}function throwThis(){throw this}function return$(r){return function(){return r}}function throw$(r){return function(){throw r}}function promisedFinally(ret,reasonOrValue,isFulfilled){var then;if(wrapsPrimitiveReceiver&&isPrimitive(reasonOrValue)){then=isFulfilled?return$(reasonOrValue):throw$(reasonOrValue)}else{then=isFulfilled?returnThis:throwThis}return ret._then(then,thrower,undefined,reasonOrValue,undefined)}function finallyHandler(reasonOrValue){var promise=this.promise;var handler=this.handler;var ret=promise._isBound()?handler.call(promise._boundTo):handler();if(ret!==undefined){var maybePromise=tryConvertToPromise(ret,promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();return promisedFinally(maybePromise,reasonOrValue,promise.isFulfilled())}}if(promise.isRejected()){NEXT_FILTER.e=reasonOrValue;return NEXT_FILTER}else{return reasonOrValue}}function tapHandler(value){var promise=this.promise;var handler=this.handler;var ret=promise._isBound()?handler.call(promise._boundTo,value):handler(value);if(ret!==undefined){var maybePromise=tryConvertToPromise(ret,promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();return promisedFinally(maybePromise,value,true)}}return value}Promise.prototype._passThroughHandler=function(handler,isFinally){if(typeof handler!=="function")return this.then();var promiseAndHandler={promise:this,handler:handler};return this._then(isFinally?finallyHandler:tapHandler,isFinally?finallyHandler:undefined,undefined,promiseAndHandler,undefined)};Promise.prototype.lastly=Promise.prototype["finally"]=function(handler){return this._passThroughHandler(handler,true)};Promise.prototype.tap=function(handler){return this._passThroughHandler(handler,false)}}},{"./util.js":38}],17:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,apiRejection,INTERNAL,tryConvertToPromise){var errors=_dereq_("./errors.js");var TypeError=errors.TypeError;var util=_dereq_("./util.js");var errorObj=util.errorObj;var tryCatch=util.tryCatch;var yieldHandlers=[];function promiseFromYieldHandler(value,yieldHandlers,traceParent){for(var i=0;i<yieldHandlers.length;++i){traceParent._pushContext();var result=tryCatch(yieldHandlers[i])(value);traceParent._popContext();if(result===errorObj){traceParent._pushContext();var ret=Promise.reject(errorObj.e);traceParent._popContext();return ret}var maybePromise=tryConvertToPromise(result,traceParent);if(maybePromise instanceof Promise)return maybePromise}return null}function PromiseSpawn(generatorFunction,receiver,yieldHandler,stack){var promise=this._promise=new Promise(INTERNAL);promise._captureStackTrace();this._stack=stack;this._generatorFunction=generatorFunction;this._receiver=receiver;this._generator=undefined;this._yieldHandlers=typeof yieldHandler==="function"?[yieldHandler].concat(yieldHandlers):yieldHandlers}PromiseSpawn.prototype.promise=function(){return this._promise};PromiseSpawn.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver);this._receiver=this._generatorFunction=undefined;this._next(undefined)};PromiseSpawn.prototype._continue=function(result){if(result===errorObj){return this._promise._rejectCallback(result.e,false,true)}var value=result.value;if(result.done===true){this._promise._resolveCallback(value)}else{var maybePromise=tryConvertToPromise(value,this._promise);if(!(maybePromise instanceof Promise)){maybePromise=promiseFromYieldHandler(maybePromise,this._yieldHandlers,this._promise);if(maybePromise===null){this._throw(new TypeError("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/4Y4pDk\n\n".replace("%s",value)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));
return}}maybePromise._then(this._next,this._throw,undefined,this,null)}};PromiseSpawn.prototype._throw=function(reason){this._promise._attachExtraTrace(reason);this._promise._pushContext();var result=tryCatch(this._generator["throw"]).call(this._generator,reason);this._promise._popContext();this._continue(result)};PromiseSpawn.prototype._next=function(value){this._promise._pushContext();var result=tryCatch(this._generator.next).call(this._generator,value);this._promise._popContext();this._continue(result)};Promise.coroutine=function(generatorFunction,options){if(typeof generatorFunction!=="function"){throw new TypeError("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n")}var yieldHandler=Object(options).yieldHandler;var PromiseSpawn$=PromiseSpawn;var stack=(new Error).stack;return function(){var generator=generatorFunction.apply(this,arguments);var spawn=new PromiseSpawn$(undefined,undefined,yieldHandler,stack);spawn._generator=generator;spawn._next(undefined);return spawn.promise()}};Promise.coroutine.addYieldHandler=function(fn){if(typeof fn!=="function")throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");yieldHandlers.push(fn)};Promise.spawn=function(generatorFunction){if(typeof generatorFunction!=="function"){return apiRejection("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n")}var spawn=new PromiseSpawn(generatorFunction,this);var ret=spawn.promise();spawn._run(Promise.spawn);return ret}}},{"./errors.js":13,"./util.js":38}],18:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,INTERNAL){var util=_dereq_("./util.js");var canEvaluate=util.canEvaluate;var tryCatch=util.tryCatch;var errorObj=util.errorObj;var reject;if(!true){if(canEvaluate){var thenCallback=function(i){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,i))};var caller=function(count){var values=[];for(var i=1;i<=count;++i)values.push("holder.p"+i);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,values.join(", ")))};var thenCallbacks=[];var callers=[undefined];for(var i=1;i<=5;++i){thenCallbacks.push(thenCallback(i));callers.push(caller(i))}var Holder=function(total,fn){this.p1=this.p2=this.p3=this.p4=this.p5=null;this.fn=fn;this.total=total;this.now=0};Holder.prototype.callers=callers;Holder.prototype.checkFulfillment=function(promise){var now=this.now;now++;var total=this.total;if(now>=total){var handler=this.callers[total];promise._pushContext();var ret=tryCatch(handler)(this);promise._popContext();if(ret===errorObj){promise._rejectCallback(ret.e,false,true)}else{promise._resolveCallback(ret)}}else{this.now=now}};var reject=function(reason){this._reject(reason)}}}Promise.join=function(){var last=arguments.length-1;var fn;if(last>0&&typeof arguments[last]==="function"){fn=arguments[last];if(!true){if(last<6&&canEvaluate){var ret=new Promise(INTERNAL);ret._captureStackTrace();var holder=new Holder(last,fn);var callbacks=thenCallbacks;for(var i=0;i<last;++i){var maybePromise=tryConvertToPromise(arguments[i],ret);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();if(maybePromise._isPending()){maybePromise._then(callbacks[i],reject,undefined,ret,holder)}else if(maybePromise._isFulfilled()){callbacks[i].call(ret,maybePromise._value(),holder)}else{ret._reject(maybePromise._reason())}}else{callbacks[i].call(ret,maybePromise,holder)}}return ret}}}var $_len=arguments.length;var args=new Array($_len);for(var $_i=0;$_i<$_len;++$_i){args[$_i]=arguments[$_i]}if(fn)args.pop();var ret=new PromiseArray(args).promise();return fn!==undefined?ret.spread(fn):ret}}},{"./util.js":38}],19:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL){var util=_dereq_("./util.js");var tryCatch=util.tryCatch;var errorObj=util.errorObj;var PENDING={};var EMPTY_ARRAY=[];function MappingPromiseArray(promises,fn,limit,_filter){this.constructor$(promises);this._promise._captureStackTrace();this._callback=fn;this._preservedValues=_filter===INTERNAL?new Array(this.length()):null;this._limit=limit;this._inFlight=0;this._queue=limit>=1?[]:EMPTY_ARRAY;this._init$(undefined,-2)}util.inherits(MappingPromiseArray,PromiseArray);MappingPromiseArray.prototype._init=function(){};MappingPromiseArray.prototype._promiseFulfilled=function(value,index){var values=this._values;var length=this.length();var preservedValues=this._preservedValues;var limit=this._limit;if(values[index]===PENDING){values[index]=value;if(limit>=1){this._inFlight--;this._drainQueue();if(this._isResolved())return}}else{if(limit>=1&&this._inFlight>=limit){values[index]=value;this._queue.push(index);return}if(preservedValues!==null)preservedValues[index]=value;var callback=this._callback;var receiver=this._promise._boundTo;this._promise._pushContext();var ret=tryCatch(callback).call(receiver,value,index,length);this._promise._popContext();if(ret===errorObj)return this._reject(ret.e);var maybePromise=tryConvertToPromise(ret,this._promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();if(maybePromise._isPending()){if(limit>=1)this._inFlight++;values[index]=PENDING;return maybePromise._proxyPromiseArray(this,index)}else if(maybePromise._isFulfilled()){ret=maybePromise._value()}else{return this._reject(maybePromise._reason())}}values[index]=ret}var totalResolved=++this._totalResolved;if(totalResolved>=length){if(preservedValues!==null){this._filter(values,preservedValues)}else{this._resolve(values)}}};MappingPromiseArray.prototype._drainQueue=function(){var queue=this._queue;var limit=this._limit;var values=this._values;while(queue.length>0&&this._inFlight<limit){if(this._isResolved())return;var index=queue.pop();this._promiseFulfilled(values[index],index)}};MappingPromiseArray.prototype._filter=function(booleans,values){var len=values.length;var ret=new Array(len);var j=0;for(var i=0;i<len;++i){if(booleans[i])ret[j++]=values[i]}ret.length=j;this._resolve(ret)};MappingPromiseArray.prototype.preservedValues=function(){return this._preservedValues};function map(promises,fn,options,_filter){var limit=typeof options==="object"&&options!==null?options.concurrency:0;limit=typeof limit==="number"&&isFinite(limit)&&limit>=1?limit:0;return new MappingPromiseArray(promises,fn,limit,_filter)}Promise.prototype.map=function(fn,options){if(typeof fn!=="function")return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return map(this,fn,options,null).promise()};Promise.map=function(promises,fn,options,_filter){if(typeof fn!=="function")return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return map(promises,fn,options,_filter).promise()}}},{"./util.js":38}],20:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){var util=_dereq_("./util.js");var tryCatch=util.tryCatch;Promise.method=function(fn){if(typeof fn!=="function"){throw new Promise.TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n")}return function(){var ret=new Promise(INTERNAL);ret._captureStackTrace();ret._pushContext();var value=tryCatch(fn).apply(this,arguments);ret._popContext();ret._resolveFromSyncValue(value);return ret}};Promise.attempt=Promise["try"]=function(fn,args,ctx){if(typeof fn!=="function"){return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n")}var ret=new Promise(INTERNAL);ret._captureStackTrace();ret._pushContext();var value=util.isArray(args)?tryCatch(fn).apply(ctx,args):tryCatch(fn).call(ctx,args);ret._popContext();ret._resolveFromSyncValue(value);return ret};Promise.prototype._resolveFromSyncValue=function(value){if(value===util.errorObj){this._rejectCallback(value.e,false,true)}else{this._resolveCallback(value,true)}}}},{"./util.js":38}],21:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){var util=_dereq_("./util.js");var async=_dereq_("./async.js");var tryCatch=util.tryCatch;var errorObj=util.errorObj;function spreadAdapter(val,nodeback){var promise=this;if(!util.isArray(val))return successAdapter.call(promise,val,nodeback);var ret=tryCatch(nodeback).apply(promise._boundTo,[null].concat(val));if(ret===errorObj){async.throwLater(ret.e)}}function successAdapter(val,nodeback){var promise=this;var receiver=promise._boundTo;var ret=val===undefined?tryCatch(nodeback).call(receiver,null):tryCatch(nodeback).call(receiver,null,val);if(ret===errorObj){async.throwLater(ret.e)}}function errorAdapter(reason,nodeback){var promise=this;if(!reason){var target=promise._target();var newReason=target._getCarriedStackTrace();newReason.cause=reason;reason=newReason}var ret=tryCatch(nodeback).call(promise._boundTo,reason);if(ret===errorObj){async.throwLater(ret.e)}}Promise.prototype.nodeify=function(nodeback,options){if(typeof nodeback=="function"){var adapter=successAdapter;if(options!==undefined&&Object(options).spread){adapter=spreadAdapter}this._then(adapter,errorAdapter,undefined,this,nodeback)}return this}}},{"./async.js":2,"./util.js":38}],22:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray){var util=_dereq_("./util.js");var async=_dereq_("./async.js");var tryCatch=util.tryCatch;var errorObj=util.errorObj;Promise.prototype.progressed=function(handler){return this._then(undefined,undefined,handler,undefined,undefined)};Promise.prototype._progress=function(progressValue){if(this._isFollowingOrFulfilledOrRejected())return;this._target()._progressUnchecked(progressValue)};Promise.prototype._progressHandlerAt=function(index){return index===0?this._progressHandler0:this[(index<<2)+index-5+2]};Promise.prototype._doProgressWith=function(progression){var progressValue=progression.value;var handler=progression.handler;var promise=progression.promise;var receiver=progression.receiver;var ret=tryCatch(handler).call(receiver,progressValue);if(ret===errorObj){if(ret.e!=null&&ret.e.name!=="StopProgressPropagation"){var trace=util.canAttachTrace(ret.e)?ret.e:new Error(util.toString(ret.e));promise._attachExtraTrace(trace);promise._progress(ret.e)}}else if(ret instanceof Promise){ret._then(promise._progress,null,null,promise,undefined)}else{promise._progress(ret)}};Promise.prototype._progressUnchecked=function(progressValue){var len=this._length();var progress=this._progress;for(var i=0;i<len;i++){var handler=this._progressHandlerAt(i);var promise=this._promiseAt(i);if(!(promise instanceof Promise)){var receiver=this._receiverAt(i);if(typeof handler==="function"){handler.call(receiver,progressValue,promise)}else if(receiver instanceof PromiseArray&&!receiver._isResolved()){receiver._promiseProgressed(progressValue,promise)}continue}if(typeof handler==="function"){async.invoke(this._doProgressWith,this,{handler:handler,promise:promise,receiver:this._receiverAt(i),value:progressValue})}else{async.invoke(progress,promise,progressValue)}}}}},{"./async.js":2,"./util.js":38}],23:[function(_dereq_,module,exports){"use strict";module.exports=function(){var makeSelfResolutionError=function(){return new TypeError("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")};var reflect=function(){return new Promise.PromiseInspection(this._target())};var apiRejection=function(msg){return Promise.reject(new TypeError(msg))};var util=_dereq_("./util.js");var async=_dereq_("./async.js");var errors=_dereq_("./errors.js");var TypeError=Promise.TypeError=errors.TypeError;Promise.RangeError=errors.RangeError;Promise.CancellationError=errors.CancellationError;Promise.TimeoutError=errors.TimeoutError;Promise.OperationalError=errors.OperationalError;Promise.RejectionError=errors.OperationalError;Promise.AggregateError=errors.AggregateError;var INTERNAL=function(){};var APPLY={};var NEXT_FILTER={e:null};var tryConvertToPromise=_dereq_("./thenables.js")(Promise,INTERNAL);var PromiseArray=_dereq_("./promise_array.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection);var CapturedTrace=_dereq_("./captured_trace.js")();var isDebugging=_dereq_("./debuggability.js")(Promise,CapturedTrace);var createContext=_dereq_("./context.js")(Promise,CapturedTrace,isDebugging);var CatchFilter=_dereq_("./catch_filter.js")(NEXT_FILTER);var PromiseResolver=_dereq_("./promise_resolver.js");var nodebackForPromise=PromiseResolver._nodebackForPromise;var errorObj=util.errorObj;var tryCatch=util.tryCatch;function Promise(resolver){if(typeof resolver!=="function"){throw new TypeError("the promise constructor requires a resolver function\n\n    See http://goo.gl/EC22Yn\n")}if(this.constructor!==Promise){throw new TypeError("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n")}this._bitField=0;this._fulfillmentHandler0=undefined;this._rejectionHandler0=undefined;this._progressHandler0=undefined;this._promise0=undefined;this._receiver0=undefined;this._settledValue=undefined;if(resolver!==INTERNAL)this._resolveFromResolver(resolver)}Promise.prototype.toString=function(){return"[object Promise]"};Promise.prototype.caught=Promise.prototype["catch"]=function(fn){var len=arguments.length;if(len>1){var catchInstances=new Array(len-1),j=0,i;for(i=0;i<len-1;++i){var item=arguments[i];if(typeof item==="function"){catchInstances[j++]=item}else{return Promise.reject(new TypeError("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"))}}catchInstances.length=j;fn=arguments[i];var catchFilter=new CatchFilter(catchInstances,fn,this);return this._then(undefined,catchFilter.doFilter,undefined,catchFilter,undefined)}return this._then(undefined,fn,undefined,undefined,undefined)};Promise.prototype.reflect=function(){return this._then(reflect,reflect,undefined,this,undefined)};Promise.prototype.then=function(didFulfill,didReject,didProgress){if(isDebugging()&&arguments.length>0&&typeof didFulfill!=="function"&&typeof didReject!=="function"){var msg=".then() only accepts functions but was passed: "+util.classString(didFulfill);if(arguments.length>1){msg+=", "+util.classString(didReject)}this._warn(msg)}return this._then(didFulfill,didReject,didProgress,undefined,undefined)};Promise.prototype.done=function(didFulfill,didReject,didProgress){var promise=this._then(didFulfill,didReject,didProgress,undefined,undefined);promise._setIsFinal()};Promise.prototype.spread=function(didFulfill,didReject){return this.all()._then(didFulfill,didReject,undefined,APPLY,undefined)};Promise.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()};Promise.prototype.toJSON=function(){var ret={isFulfilled:false,isRejected:false,fulfillmentValue:undefined,rejectionReason:undefined};if(this.isFulfilled()){ret.fulfillmentValue=this.value();ret.isFulfilled=true}else if(this.isRejected()){ret.rejectionReason=this.reason();ret.isRejected=true}return ret};Promise.prototype.all=function(){return new PromiseArray(this).promise()};Promise.prototype.error=function(fn){return this.caught(util.originatesFromRejection,fn)};Promise.is=function(val){return val instanceof Promise};Promise.fromNode=function(fn){var ret=new Promise(INTERNAL);var result=tryCatch(fn)(nodebackForPromise(ret));if(result===errorObj){ret._rejectCallback(result.e,true,true)}return ret};Promise.all=function(promises){return new PromiseArray(promises).promise()};Promise.defer=Promise.pending=function(){var promise=new Promise(INTERNAL);return new PromiseResolver(promise)};Promise.cast=function(obj){var ret=tryConvertToPromise(obj);if(!(ret instanceof Promise)){var val=ret;ret=new Promise(INTERNAL);ret._fulfillUnchecked(val)}return ret};Promise.resolve=Promise.fulfilled=Promise.cast;Promise.reject=Promise.rejected=function(reason){var ret=new Promise(INTERNAL);ret._captureStackTrace();ret._rejectCallback(reason,true);return ret};Promise.setScheduler=function(fn){if(typeof fn!=="function")throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var prev=async._schedule;async._schedule=fn;return prev};Promise.prototype._then=function(didFulfill,didReject,didProgress,receiver,internalData){var haveInternalData=internalData!==undefined;var ret=haveInternalData?internalData:new Promise(INTERNAL);if(!haveInternalData){ret._propagateFrom(this,4|1);ret._captureStackTrace()}var target=this._target();if(target!==this){if(!haveInternalData){ret._setIsMigrated();if(receiver===undefined){ret._setIsMigratingBinding();receiver=this}}}var callbackIndex=target._addCallbacks(didFulfill,didReject,didProgress,ret,receiver);if(target._isResolved()&&!target._isSettlePromisesQueued()){async.invoke(target._settlePromiseAtPostResolution,target,callbackIndex)}return ret};Promise.prototype._settlePromiseAtPostResolution=function(index){if(this._isRejectionUnhandled())this._unsetRejectionIsUnhandled();this._settlePromiseAt(index)};Promise.prototype._length=function(){return this._bitField&131071};Promise.prototype._isFollowingOrFulfilledOrRejected=function(){return(this._bitField&939524096)>0};Promise.prototype._isFollowing=function(){return(this._bitField&536870912)===536870912};Promise.prototype._setLength=function(len){this._bitField=this._bitField&-131072|len&131071};Promise.prototype._setFulfilled=function(){this._bitField=this._bitField|268435456};Promise.prototype._setRejected=function(){this._bitField=this._bitField|134217728};Promise.prototype._setFollowing=function(){this._bitField=this._bitField|536870912};Promise.prototype._setIsFinal=function(){this._bitField=this._bitField|33554432};Promise.prototype._isFinal=function(){return(this._bitField&33554432)>0};Promise.prototype._cancellable=function(){return(this._bitField&67108864)>0};Promise.prototype._setCancellable=function(){this._bitField=this._bitField|67108864};Promise.prototype._unsetCancellable=function(){this._bitField=this._bitField&~67108864};Promise.prototype._setIsMigrated=function(){this._bitField=this._bitField|4194304};Promise.prototype._unsetIsMigrated=function(){this._bitField=this._bitField&~4194304};Promise.prototype._isMigrated=function(){return(this._bitField&4194304)>0};Promise.prototype._receiverAt=function(index){var ret=index===0?this._receiver0:this[index*5-5+4];if(ret===undefined&&this._isBound()){return this._boundTo}return ret};Promise.prototype._promiseAt=function(index){return index===0?this._promise0:this[index*5-5+3]};Promise.prototype._fulfillmentHandlerAt=function(index){return index===0?this._fulfillmentHandler0:this[index*5-5+0]};Promise.prototype._rejectionHandlerAt=function(index){return index===0?this._rejectionHandler0:this[index*5-5+1]};Promise.prototype._migrateCallbacks=function(follower,index){var fulfill=follower._fulfillmentHandlerAt(index);var reject=follower._rejectionHandlerAt(index);var progress=follower._progressHandlerAt(index);var promise=follower._promiseAt(index);var receiver=follower._receiverAt(index);if(promise instanceof Promise){promise._setIsMigrated();if(receiver===undefined){receiver=follower;promise._setIsMigratingBinding()}}this._addCallbacks(fulfill,reject,progress,promise,receiver)};Promise.prototype._addCallbacks=function(fulfill,reject,progress,promise,receiver){var index=this._length();if(index>=131071-5){index=0;this._setLength(0)}if(index===0){this._promise0=promise;if(receiver!==undefined)this._receiver0=receiver;if(typeof fulfill==="function"&&!this._isCarryingStackTrace())this._fulfillmentHandler0=fulfill;if(typeof reject==="function")this._rejectionHandler0=reject;if(typeof progress==="function")this._progressHandler0=progress}else{var base=index*5-5;this[base+3]=promise;this[base+4]=receiver;if(typeof fulfill==="function")this[base+0]=fulfill;if(typeof reject==="function")this[base+1]=reject;if(typeof progress==="function")this[base+2]=progress}this._setLength(index+1);return index};Promise.prototype._setProxyHandlers=function(receiver,promiseSlotValue){var index=this._length();if(index>=131071-5){index=0;this._setLength(0)}if(index===0){this._promise0=promiseSlotValue;this._receiver0=receiver}else{var base=index*5-5;this[base+3]=promiseSlotValue;this[base+4]=receiver}this._setLength(index+1)};Promise.prototype._proxyPromiseArray=function(promiseArray,index){this._setProxyHandlers(promiseArray,index)};Promise.prototype._resolveCallback=function(value,shouldBind){if(this._isFollowingOrFulfilledOrRejected())return;if(value===this)return this._rejectCallback(makeSelfResolutionError(),false,true);var maybePromise=tryConvertToPromise(value,this);if(!(maybePromise instanceof Promise))return this._fulfill(value);var propagationFlags=1|(shouldBind?4:0);this._propagateFrom(maybePromise,propagationFlags);var promise=maybePromise._target();if(promise._isPending()){var len=this._length();for(var i=0;i<len;++i){promise._migrateCallbacks(this,i)}this._setFollowing();this._setLength(0);this._setFollowee(promise)}else if(promise._isFulfilled()){this._fulfillUnchecked(promise._value())}else{this._rejectUnchecked(promise._reason(),promise._getCarriedStackTrace())}};Promise.prototype._rejectCallback=function(reason,synchronous,shouldNotMarkOriginatingFromRejection){if(!shouldNotMarkOriginatingFromRejection){util.markAsOriginatingFromRejection(reason)}var trace=util.ensureErrorObject(reason);var hasStack=util.canAttachTrace(reason)&&typeof trace.stack==="string"&&trace.stack.length>0;this._attachExtraTrace(trace,synchronous?hasStack:false);this._reject(reason,trace===reason?undefined:trace)};Promise.prototype._resolveFromResolver=function(resolver){var promise=this;this._captureStackTrace();this._pushContext();var synchronous=true;var r=tryCatch(resolver)(function(value){if(promise===null)return;promise._resolveCallback(value);promise=null},function(reason){if(promise===null)return;promise._rejectCallback(reason,synchronous);promise=null});synchronous=false;this._popContext();if(r!==undefined&&r===errorObj&&promise!==null){promise._rejectCallback(r.e,true,true);promise=null}};Promise.prototype._settlePromiseFromHandler=function(handler,receiver,value,promise){if(promise._isRejected())return;promise._pushContext();var x;if(receiver===APPLY&&!this._isRejected()){x=tryCatch(handler).apply(this._boundTo,value)}else{x=tryCatch(handler).call(receiver,value)}promise._popContext();if(x===errorObj||x===promise||x===NEXT_FILTER){var err=x===promise?makeSelfResolutionError():x.e;promise._rejectCallback(err,false,true)}else{promise._resolveCallback(x)}};Promise.prototype._target=function(){var ret=this;while(ret._isFollowing())ret=ret._followee();return ret};Promise.prototype._followee=function(){return this._rejectionHandler0};Promise.prototype._setFollowee=function(promise){this._rejectionHandler0=promise};Promise.prototype._cleanValues=function(){if(this._cancellable()){this._cancellationParent=undefined}};Promise.prototype._propagateFrom=function(parent,flags){if((flags&1)>0&&parent._cancellable()){this._setCancellable();this._cancellationParent=parent}if((flags&4)>0&&parent._isBound()){this._setBoundTo(parent._boundTo)}};Promise.prototype._fulfill=function(value){if(this._isFollowingOrFulfilledOrRejected())return;this._fulfillUnchecked(value)};Promise.prototype._reject=function(reason,carriedStackTrace){if(this._isFollowingOrFulfilledOrRejected())return;this._rejectUnchecked(reason,carriedStackTrace)};Promise.prototype._settlePromiseAt=function(index){var promise=this._promiseAt(index);var isPromise=promise instanceof Promise;if(isPromise&&promise._isMigrated()){promise._unsetIsMigrated();return async.invoke(this._settlePromiseAt,this,index)}var handler=this._isFulfilled()?this._fulfillmentHandlerAt(index):this._rejectionHandlerAt(index);var carriedStackTrace=this._isCarryingStackTrace()?this._getCarriedStackTrace():undefined;var value=this._settledValue;var receiver=this._receiverAt(index);if(isPromise&&promise._isMigratingBinding()){promise._unsetIsMigratingBinding();receiver=receiver._boundTo}this._clearCallbackDataAtIndex(index);if(typeof handler==="function"){if(!isPromise){handler.call(receiver,value,promise)}else{this._settlePromiseFromHandler(handler,receiver,value,promise)}}else if(receiver instanceof PromiseArray){if(!receiver._isResolved()){if(this._isFulfilled()){receiver._promiseFulfilled(value,promise)}else{receiver._promiseRejected(value,promise)}}}else if(isPromise){if(this._isFulfilled()){promise._fulfill(value)}else{promise._reject(value,carriedStackTrace)}}if(index>=4&&(index&31)===4)async.invokeLater(this._setLength,this,0)};Promise.prototype._clearCallbackDataAtIndex=function(index){if(index===0){if(!this._isCarryingStackTrace()){this._fulfillmentHandler0=undefined}this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=undefined}else{var base=index*5-5;this[base+3]=this[base+4]=this[base+0]=this[base+1]=this[base+2]=undefined}};Promise.prototype._isSettlePromisesQueued=function(){return(this._bitField&-1073741824)===-1073741824};Promise.prototype._setSettlePromisesQueued=function(){this._bitField=this._bitField|-1073741824};Promise.prototype._unsetSettlePromisesQueued=function(){this._bitField=this._bitField&~-1073741824};Promise.prototype._queueSettlePromises=function(){async.settlePromises(this);this._setSettlePromisesQueued()};Promise.prototype._fulfillUnchecked=function(value){if(value===this){var err=makeSelfResolutionError();this._attachExtraTrace(err);return this._rejectUnchecked(err,undefined)}this._setFulfilled();this._settledValue=value;this._cleanValues();if(this._length()>0){this._queueSettlePromises()}};Promise.prototype._rejectUncheckedCheckError=function(reason){var trace=util.ensureErrorObject(reason);this._rejectUnchecked(reason,trace===reason?undefined:trace)};Promise.prototype._rejectUnchecked=function(reason,trace){if(reason===this){var err=makeSelfResolutionError();this._attachExtraTrace(err);return this._rejectUnchecked(err)}this._setRejected();this._settledValue=reason;this._cleanValues();if(this._isFinal()){async.throwLater(function(e){if("stack"in e){async.invokeFirst(CapturedTrace.unhandledRejection,undefined,e)}throw e},trace===undefined?reason:trace);return}if(trace!==undefined&&trace!==reason){this._setCarriedStackTrace(trace)}if(this._length()>0){this._queueSettlePromises()}else{this._ensurePossibleRejectionHandled()}};Promise.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();var len=this._length();for(var i=0;i<len;i++){this._settlePromiseAt(i)}};Promise._makeSelfResolutionError=makeSelfResolutionError;_dereq_("./method.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection);_dereq_("./bind.js")(Promise,INTERNAL,tryConvertToPromise);_dereq_("./finally.js")(Promise,NEXT_FILTER,tryConvertToPromise);_dereq_("./direct_resolve.js")(Promise);_dereq_("./synchronous_inspection.js")(Promise);_dereq_("./join.js")(Promise,PromiseArray,tryConvertToPromise,INTERNAL);Promise.Promise=Promise;_dereq_("./map.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL);_dereq_("./using.js")(Promise,apiRejection,tryConvertToPromise,createContext);_dereq_("./generators.js")(Promise,apiRejection,INTERNAL,tryConvertToPromise);_dereq_("./nodeify.js")(Promise);_dereq_("./cancel.js")(Promise);_dereq_("./promisify.js")(Promise,INTERNAL);_dereq_("./props.js")(Promise,PromiseArray,tryConvertToPromise,apiRejection);_dereq_("./race.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection);_dereq_("./reduce.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL);_dereq_("./settle.js")(Promise,PromiseArray);_dereq_("./call_get.js")(Promise);_dereq_("./some.js")(Promise,PromiseArray,apiRejection);_dereq_("./progress.js")(Promise,PromiseArray);_dereq_("./any.js")(Promise);_dereq_("./each.js")(Promise,INTERNAL);_dereq_("./timers.js")(Promise,INTERNAL);_dereq_("./filter.js")(Promise,INTERNAL);util.toFastProperties(Promise);util.toFastProperties(Promise.prototype);function fillTypes(value){var p=new Promise(INTERNAL);p._fulfillmentHandler0=value;p._rejectionHandler0=value;p._progressHandler0=value;p._promise0=value;p._receiver0=value;p._settledValue=value}fillTypes({a:1});fillTypes({b:2});fillTypes({c:3});fillTypes(1);fillTypes(function(){});fillTypes(undefined);fillTypes(false);fillTypes(new Promise(INTERNAL));CapturedTrace.setBounds(async.firstLineError,util.lastLineError);return Promise}},{"./any.js":1,"./async.js":2,"./bind.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./context.js":9,"./debuggability.js":10,"./direct_resolve.js":11,"./each.js":12,"./errors.js":13,"./filter.js":15,"./finally.js":16,"./generators.js":17,"./join.js":18,"./map.js":19,"./method.js":20,"./nodeify.js":21,"./progress.js":22,"./promise_array.js":24,"./promise_resolver.js":25,"./promisify.js":26,"./props.js":27,"./race.js":29,"./reduce.js":30,"./settle.js":32,"./some.js":33,"./synchronous_inspection.js":34,"./thenables.js":35,"./timers.js":36,"./using.js":37,"./util.js":38}],24:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){var util=_dereq_("./util.js");var isArray=util.isArray;function toResolutionValue(val){switch(val){case-2:return[];case-3:return{}}}function PromiseArray(values){var promise=this._promise=new Promise(INTERNAL);var parent;if(values instanceof Promise){parent=values;promise._propagateFrom(parent,1|4)}this._values=values;this._length=0;this._totalResolved=0;this._init(undefined,-2)}PromiseArray.prototype.length=function(){return this._length};PromiseArray.prototype.promise=function(){return this._promise};PromiseArray.prototype._init=function init(_,resolveValueIfEmpty){var values=tryConvertToPromise(this._values,this._promise);if(values instanceof Promise){values=values._target();this._values=values;if(values._isFulfilled()){values=values._value();if(!isArray(values)){var err=new Promise.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");this.__hardReject__(err);return}}else if(values._isPending()){values._then(init,this._reject,undefined,this,resolveValueIfEmpty);return}else{this._reject(values._reason());return}}else if(!isArray(values)){this._promise._reject(apiRejection("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n")._reason());return}if(values.length===0){if(resolveValueIfEmpty===-5){this._resolveEmptyArray()}else{this._resolve(toResolutionValue(resolveValueIfEmpty))}return}var len=this.getActualLength(values.length);this._length=len;this._values=this.shouldCopyValues()?new Array(len):this._values;var promise=this._promise;for(var i=0;i<len;++i){var isResolved=this._isResolved();var maybePromise=tryConvertToPromise(values[i],promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();if(isResolved){maybePromise._unsetRejectionIsUnhandled()}else if(maybePromise._isPending()){maybePromise._proxyPromiseArray(this,i)}else if(maybePromise._isFulfilled()){this._promiseFulfilled(maybePromise._value(),i)}else{this._promiseRejected(maybePromise._reason(),i)}}else if(!isResolved){this._promiseFulfilled(maybePromise,i)}}};PromiseArray.prototype._isResolved=function(){return this._values===null};PromiseArray.prototype._resolve=function(value){this._values=null;this._promise._fulfill(value)};PromiseArray.prototype.__hardReject__=PromiseArray.prototype._reject=function(reason){this._values=null;this._promise._rejectCallback(reason,false,true)};PromiseArray.prototype._promiseProgressed=function(progressValue,index){this._promise._progress({index:index,value:progressValue})
};PromiseArray.prototype._promiseFulfilled=function(value,index){this._values[index]=value;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){this._resolve(this._values)}};PromiseArray.prototype._promiseRejected=function(reason,index){this._totalResolved++;this._reject(reason)};PromiseArray.prototype.shouldCopyValues=function(){return true};PromiseArray.prototype.getActualLength=function(len){return len};return PromiseArray}},{"./util.js":38}],25:[function(_dereq_,module,exports){"use strict";var util=_dereq_("./util.js");var maybeWrapAsError=util.maybeWrapAsError;var errors=_dereq_("./errors.js");var TimeoutError=errors.TimeoutError;var OperationalError=errors.OperationalError;var haveGetters=util.haveGetters;var es5=_dereq_("./es5.js");function isUntypedError(obj){return obj instanceof Error&&es5.getPrototypeOf(obj)===Error.prototype}var rErrorKey=/^(?:name|message|stack|cause)$/;function wrapAsOperationalError(obj){var ret;if(isUntypedError(obj)){ret=new OperationalError(obj);ret.name=obj.name;ret.message=obj.message;ret.stack=obj.stack;var keys=es5.keys(obj);for(var i=0;i<keys.length;++i){var key=keys[i];if(!rErrorKey.test(key)){ret[key]=obj[key]}}return ret}util.markAsOriginatingFromRejection(obj);return obj}function nodebackForPromise(promise){return function(err,value){if(promise===null)return;if(err){var wrapped=wrapAsOperationalError(maybeWrapAsError(err));promise._attachExtraTrace(wrapped);promise._reject(wrapped)}else if(arguments.length>2){var $_len=arguments.length;var args=new Array($_len-1);for(var $_i=1;$_i<$_len;++$_i){args[$_i-1]=arguments[$_i]}promise._fulfill(args)}else{promise._fulfill(value)}promise=null}}var PromiseResolver;if(!haveGetters){PromiseResolver=function(promise){this.promise=promise;this.asCallback=nodebackForPromise(promise);this.callback=this.asCallback}}else{PromiseResolver=function(promise){this.promise=promise}}if(haveGetters){var prop={get:function(){return nodebackForPromise(this.promise)}};es5.defineProperty(PromiseResolver.prototype,"asCallback",prop);es5.defineProperty(PromiseResolver.prototype,"callback",prop)}PromiseResolver._nodebackForPromise=nodebackForPromise;PromiseResolver.prototype.toString=function(){return"[object PromiseResolver]"};PromiseResolver.prototype.resolve=PromiseResolver.prototype.fulfill=function(value){if(!(this instanceof PromiseResolver)){throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n")}this.promise._resolveCallback(value)};PromiseResolver.prototype.reject=function(reason){if(!(this instanceof PromiseResolver)){throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n")}this.promise._rejectCallback(reason)};PromiseResolver.prototype.progress=function(value){if(!(this instanceof PromiseResolver)){throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n")}this.promise._progress(value)};PromiseResolver.prototype.cancel=function(err){this.promise.cancel(err)};PromiseResolver.prototype.timeout=function(){this.reject(new TimeoutError("timeout"))};PromiseResolver.prototype.isResolved=function(){return this.promise.isResolved()};PromiseResolver.prototype.toJSON=function(){return this.promise.toJSON()};module.exports=PromiseResolver},{"./errors.js":13,"./es5.js":14,"./util.js":38}],26:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var THIS={};var util=_dereq_("./util.js");var nodebackForPromise=_dereq_("./promise_resolver.js")._nodebackForPromise;var withAppended=util.withAppended;var maybeWrapAsError=util.maybeWrapAsError;var canEvaluate=util.canEvaluate;var TypeError=_dereq_("./errors").TypeError;var defaultSuffix="Async";var defaultPromisified={__isPromisified__:true};var noCopyPropsPattern=/^(?:length|name|arguments|caller|prototype|__isPromisified__)$/;var defaultFilter=function(name,func){return util.isIdentifier(name)&&name.charAt(0)!=="_"&&!util.isClass(func)};function propsFilter(key){return!noCopyPropsPattern.test(key)}function isPromisified(fn){try{return fn.__isPromisified__===true}catch(e){return false}}function hasPromisified(obj,key,suffix){var val=util.getDataPropertyOrDefault(obj,key+suffix,defaultPromisified);return val?isPromisified(val):false}function checkValid(ret,suffix,suffixRegexp){for(var i=0;i<ret.length;i+=2){var key=ret[i];if(suffixRegexp.test(key)){var keyWithoutAsyncSuffix=key.replace(suffixRegexp,"");for(var j=0;j<ret.length;j+=2){if(ret[j]===keyWithoutAsyncSuffix){throw new TypeError("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/iWrZbw\n".replace("%s",suffix))}}}}}function promisifiableMethods(obj,suffix,suffixRegexp,filter){var keys=util.inheritedDataKeys(obj);var ret=[];for(var i=0;i<keys.length;++i){var key=keys[i];var value=obj[key];var passesDefaultFilter=filter===defaultFilter?true:defaultFilter(key,value,obj);if(typeof value==="function"&&!isPromisified(value)&&!hasPromisified(obj,key,suffix)&&filter(key,value,obj,passesDefaultFilter)){ret.push(key,value)}}checkValid(ret,suffix,suffixRegexp);return ret}var escapeIdentRegex=function(str){return str.replace(/([$])/,"\\$")};var makeNodePromisifiedEval;if(!true){var switchCaseArgumentOrder=function(likelyArgumentCount){var ret=[likelyArgumentCount];var min=Math.max(0,likelyArgumentCount-1-3);for(var i=likelyArgumentCount-1;i>=min;--i){ret.push(i)}for(var i=likelyArgumentCount+1;i<=3;++i){ret.push(i)}return ret};var argumentSequence=function(argumentCount){return util.filledRange(argumentCount,"_arg","")};var parameterDeclaration=function(parameterCount){return util.filledRange(Math.max(parameterCount,3),"_arg","")};var parameterCount=function(fn){if(typeof fn.length==="number"){return Math.max(Math.min(fn.length,1023+1),0)}return 0};makeNodePromisifiedEval=function(callback,receiver,originalName,fn){var newParameterCount=Math.max(0,parameterCount(fn)-1);var argumentOrder=switchCaseArgumentOrder(newParameterCount);var shouldProxyThis=typeof callback==="string"||receiver===THIS;function generateCallForArgumentCount(count){var args=argumentSequence(count).join(", ");var comma=count>0?", ":"";var ret;if(shouldProxyThis){ret="ret = callback.call(this, {{args}}, nodeback); break;\n"}else{ret=receiver===undefined?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n"}return ret.replace("{{args}}",args).replace(", ",comma)}function generateArgumentSwitchCase(){var ret="";for(var i=0;i<argumentOrder.length;++i){ret+="case "+argumentOrder[i]+":"+generateCallForArgumentCount(argumentOrder[i])}ret+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = nodeback;                                              \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",shouldProxyThis?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n");return ret}var getFunctionCode=typeof callback==="string"?"this != null ? this['"+callback+"'] : fn":"fn";return new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","INTERNAL","'use strict';                            \n        var ret = function (Parameters) {                                    \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            var nodeback = nodebackForPromise(promise);                      \n            var ret;                                                         \n            var callback = tryCatch([GetFunctionCode]);                      \n            switch(len) {                                                    \n                [CodeForSwitchCase]                                          \n            }                                                                \n            if (ret === errorObj) {                                          \n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        ret.__isPromisified__ = true;                                        \n        return ret;                                                          \n        ".replace("Parameters",parameterDeclaration(newParameterCount)).replace("[CodeForSwitchCase]",generateArgumentSwitchCase()).replace("[GetFunctionCode]",getFunctionCode))(Promise,fn,receiver,withAppended,maybeWrapAsError,nodebackForPromise,util.tryCatch,util.errorObj,INTERNAL)}}function makeNodePromisifiedClosure(callback,receiver,_,fn){var defaultThis=function(){return this}();var method=callback;if(typeof method==="string"){callback=fn}function promisified(){var _receiver=receiver;if(receiver===THIS)_receiver=this;var promise=new Promise(INTERNAL);promise._captureStackTrace();var cb=typeof method==="string"&&this!==defaultThis?this[method]:callback;var fn=nodebackForPromise(promise);try{cb.apply(_receiver,withAppended(arguments,fn))}catch(e){promise._rejectCallback(maybeWrapAsError(e),true,true)}return promise}promisified.__isPromisified__=true;return promisified}var makeNodePromisified=canEvaluate?makeNodePromisifiedEval:makeNodePromisifiedClosure;function promisifyAll(obj,suffix,filter,promisifier){var suffixRegexp=new RegExp(escapeIdentRegex(suffix)+"$");var methods=promisifiableMethods(obj,suffix,suffixRegexp,filter);for(var i=0,len=methods.length;i<len;i+=2){var key=methods[i];var fn=methods[i+1];var promisifiedKey=key+suffix;obj[promisifiedKey]=promisifier===makeNodePromisified?makeNodePromisified(key,THIS,key,fn,suffix):promisifier(fn,function(){return makeNodePromisified(key,THIS,key,fn,suffix)})}util.toFastProperties(obj);return obj}function promisify(callback,receiver){return makeNodePromisified(callback,receiver,undefined,callback)}Promise.promisify=function(fn,receiver){if(typeof fn!=="function"){throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n")}if(isPromisified(fn)){return fn}var ret=promisify(fn,arguments.length<2?THIS:receiver);util.copyDescriptors(fn,ret,propsFilter);return ret};Promise.promisifyAll=function(target,options){if(typeof target!=="function"&&typeof target!=="object"){throw new TypeError("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/9ITlV0\n")}options=Object(options);var suffix=options.suffix;if(typeof suffix!=="string")suffix=defaultSuffix;var filter=options.filter;if(typeof filter!=="function")filter=defaultFilter;var promisifier=options.promisifier;if(typeof promisifier!=="function")promisifier=makeNodePromisified;if(!util.isIdentifier(suffix)){throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/8FZo5V\n")}var keys=util.inheritedDataKeys(target);for(var i=0;i<keys.length;++i){var value=target[keys[i]];if(keys[i]!=="constructor"&&util.isClass(value)){promisifyAll(value.prototype,suffix,filter,promisifier);promisifyAll(value,suffix,filter,promisifier)}}return promisifyAll(target,suffix,filter,promisifier)}}},{"./errors":13,"./promise_resolver.js":25,"./util.js":38}],27:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,apiRejection){var util=_dereq_("./util.js");var isObject=util.isObject;var es5=_dereq_("./es5.js");function PropertiesPromiseArray(obj){var keys=es5.keys(obj);var len=keys.length;var values=new Array(len*2);for(var i=0;i<len;++i){var key=keys[i];values[i]=obj[key];values[i+len]=key}this.constructor$(values)}util.inherits(PropertiesPromiseArray,PromiseArray);PropertiesPromiseArray.prototype._init=function(){this._init$(undefined,-3)};PropertiesPromiseArray.prototype._promiseFulfilled=function(value,index){this._values[index]=value;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){var val={};var keyOffset=this.length();for(var i=0,len=this.length();i<len;++i){val[this._values[i+keyOffset]]=this._values[i]}this._resolve(val)}};PropertiesPromiseArray.prototype._promiseProgressed=function(value,index){this._promise._progress({key:this._values[index+this.length()],value:value})};PropertiesPromiseArray.prototype.shouldCopyValues=function(){return false};PropertiesPromiseArray.prototype.getActualLength=function(len){return len>>1};function props(promises){var ret;var castValue=tryConvertToPromise(promises);if(!isObject(castValue)){return apiRejection("cannot await properties of a non-object\n\n    See http://goo.gl/OsFKC8\n")}else if(castValue instanceof Promise){ret=castValue._then(Promise.props,undefined,undefined,undefined,undefined)}else{ret=new PropertiesPromiseArray(castValue).promise()}if(castValue instanceof Promise){ret._propagateFrom(castValue,4)}return ret}Promise.prototype.props=function(){return props(this)};Promise.props=function(promises){return props(promises)}}},{"./es5.js":14,"./util.js":38}],28:[function(_dereq_,module,exports){"use strict";function arrayMove(src,srcIndex,dst,dstIndex,len){for(var j=0;j<len;++j){dst[j+dstIndex]=src[j+srcIndex];src[j+srcIndex]=void 0}}function Queue(capacity){this._capacity=capacity;this._length=0;this._front=0}Queue.prototype._willBeOverCapacity=function(size){return this._capacity<size};Queue.prototype._pushOne=function(arg){var length=this.length();this._checkCapacity(length+1);var i=this._front+length&this._capacity-1;this[i]=arg;this._length=length+1};Queue.prototype._unshiftOne=function(value){var capacity=this._capacity;this._checkCapacity(this.length()+1);var front=this._front;var i=(front-1&capacity-1^capacity)-capacity;this[i]=value;this._front=i;this._length=this.length()+1};Queue.prototype.unshift=function(fn,receiver,arg){this._unshiftOne(arg);this._unshiftOne(receiver);this._unshiftOne(fn)};Queue.prototype.push=function(fn,receiver,arg){var length=this.length()+3;if(this._willBeOverCapacity(length)){this._pushOne(fn);this._pushOne(receiver);this._pushOne(arg);return}var j=this._front+length-3;this._checkCapacity(length);var wrapMask=this._capacity-1;this[j+0&wrapMask]=fn;this[j+1&wrapMask]=receiver;this[j+2&wrapMask]=arg;this._length=length};Queue.prototype.shift=function(){var front=this._front,ret=this[front];this[front]=undefined;this._front=front+1&this._capacity-1;this._length--;return ret};Queue.prototype.length=function(){return this._length};Queue.prototype._checkCapacity=function(size){if(this._capacity<size){this._resizeTo(this._capacity<<1)}};Queue.prototype._resizeTo=function(capacity){var oldCapacity=this._capacity;this._capacity=capacity;var front=this._front;var length=this._length;var moveItemsCount=front+length&oldCapacity-1;arrayMove(this,0,this,oldCapacity,moveItemsCount)};module.exports=Queue},{}],29:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){var isArray=_dereq_("./util.js").isArray;var raceLater=function(promise){return promise.then(function(array){return race(array,promise)})};function race(promises,parent){var maybePromise=tryConvertToPromise(promises);if(maybePromise instanceof Promise){return raceLater(maybePromise)}else if(!isArray(promises)){return apiRejection("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n")}var ret=new Promise(INTERNAL);if(parent!==undefined){ret._propagateFrom(parent,4|1)}var fulfill=ret._fulfill;var reject=ret._reject;for(var i=0,len=promises.length;i<len;++i){var val=promises[i];if(val===undefined&&!(i in promises)){continue}Promise.cast(val)._then(fulfill,reject,undefined,ret,null)}return ret}Promise.race=function(promises){return race(promises,undefined)};Promise.prototype.race=function(){return race(this,undefined)}}},{"./util.js":38}],30:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL){var util=_dereq_("./util.js");var tryCatch=util.tryCatch;var errorObj=util.errorObj;function ReductionPromiseArray(promises,fn,accum,_each){this.constructor$(promises);this._promise._captureStackTrace();this._preservedValues=_each===INTERNAL?[]:null;this._zerothIsAccum=accum===undefined;this._gotAccum=false;this._reducingIndex=this._zerothIsAccum?1:0;this._valuesPhase=undefined;var maybePromise=tryConvertToPromise(accum,this._promise);var rejected=false;var isPromise=maybePromise instanceof Promise;if(isPromise){maybePromise=maybePromise._target();if(maybePromise._isPending()){maybePromise._proxyPromiseArray(this,-1)}else if(maybePromise._isFulfilled()){accum=maybePromise._value();this._gotAccum=true}else{this._reject(maybePromise._reason());rejected=true}}if(!(isPromise||this._zerothIsAccum))this._gotAccum=true;this._callback=fn;this._accum=accum;if(!rejected)this._init$(undefined,-5)}util.inherits(ReductionPromiseArray,PromiseArray);ReductionPromiseArray.prototype._init=function(){};ReductionPromiseArray.prototype._resolveEmptyArray=function(){if(this._gotAccum||this._zerothIsAccum){this._resolve(this._preservedValues!==null?[]:this._accum)}};ReductionPromiseArray.prototype._promiseFulfilled=function(value,index){var values=this._values;values[index]=value;var length=this.length();var preservedValues=this._preservedValues;var isEach=preservedValues!==null;var gotAccum=this._gotAccum;var valuesPhase=this._valuesPhase;var valuesPhaseIndex;if(!valuesPhase){valuesPhase=this._valuesPhase=new Array(length);for(valuesPhaseIndex=0;valuesPhaseIndex<length;++valuesPhaseIndex){valuesPhase[valuesPhaseIndex]=0}}valuesPhaseIndex=valuesPhase[index];if(index===0&&this._zerothIsAccum){this._accum=value;this._gotAccum=gotAccum=true;valuesPhase[index]=valuesPhaseIndex===0?1:2}else if(index===-1){this._accum=value;this._gotAccum=gotAccum=true}else{if(valuesPhaseIndex===0){valuesPhase[index]=1}else{valuesPhase[index]=2;this._accum=value}}if(!gotAccum)return;var callback=this._callback;var receiver=this._promise._boundTo;var ret;for(var i=this._reducingIndex;i<length;++i){valuesPhaseIndex=valuesPhase[i];if(valuesPhaseIndex===2){this._reducingIndex=i+1;continue}if(valuesPhaseIndex!==1)return;value=values[i];this._promise._pushContext();if(isEach){preservedValues.push(value);ret=tryCatch(callback).call(receiver,value,i,length)}else{ret=tryCatch(callback).call(receiver,this._accum,value,i,length)}this._promise._popContext();if(ret===errorObj)return this._reject(ret.e);var maybePromise=tryConvertToPromise(ret,this._promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();if(maybePromise._isPending()){valuesPhase[i]=4;return maybePromise._proxyPromiseArray(this,i)}else if(maybePromise._isFulfilled()){ret=maybePromise._value()}else{return this._reject(maybePromise._reason())}}this._reducingIndex=i+1;this._accum=ret}this._resolve(isEach?preservedValues:this._accum)};function reduce(promises,fn,initialValue,_each){if(typeof fn!=="function")return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var array=new ReductionPromiseArray(promises,fn,initialValue,_each);return array.promise()}Promise.prototype.reduce=function(fn,initialValue){return reduce(this,fn,initialValue,null)};Promise.reduce=function(promises,fn,initialValue,_each){return reduce(promises,fn,initialValue,_each)}}},{"./util.js":38}],31:[function(_dereq_,module,exports){"use strict";var schedule;if(_dereq_("./util.js").isNode){var version=process.versions.node.split(".").map(Number);schedule=version[0]===0&&version[1]>10||version[0]>0?global.setImmediate:process.nextTick}else if(typeof MutationObserver!=="undefined"){schedule=function(fn){var div=document.createElement("div");var observer=new MutationObserver(fn);observer.observe(div,{attributes:true});return function(){div.classList.toggle("foo")}};schedule.isStatic=true}else if(typeof setTimeout!=="undefined"){schedule=function(fn){setTimeout(fn,0)}}else{schedule=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}}module.exports=schedule},{"./util.js":38}],32:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray){var PromiseInspection=Promise.PromiseInspection;var util=_dereq_("./util.js");function SettledPromiseArray(values){this.constructor$(values)}util.inherits(SettledPromiseArray,PromiseArray);SettledPromiseArray.prototype._promiseResolved=function(index,inspection){this._values[index]=inspection;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){this._resolve(this._values)}};SettledPromiseArray.prototype._promiseFulfilled=function(value,index){var ret=new PromiseInspection;ret._bitField=268435456;ret._settledValue=value;this._promiseResolved(index,ret)};SettledPromiseArray.prototype._promiseRejected=function(reason,index){var ret=new PromiseInspection;ret._bitField=134217728;ret._settledValue=reason;this._promiseResolved(index,ret)};Promise.settle=function(promises){return new SettledPromiseArray(promises).promise()};Promise.prototype.settle=function(){return new SettledPromiseArray(this).promise()}}},{"./util.js":38}],33:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection){var util=_dereq_("./util.js");var RangeError=_dereq_("./errors.js").RangeError;var AggregateError=_dereq_("./errors.js").AggregateError;var isArray=util.isArray;function SomePromiseArray(values){this.constructor$(values);this._howMany=0;this._unwrap=false;this._initialized=false}util.inherits(SomePromiseArray,PromiseArray);SomePromiseArray.prototype._init=function(){if(!this._initialized){return}if(this._howMany===0){this._resolve([]);return}this._init$(undefined,-5);var isArrayResolved=isArray(this._values);if(!this._isResolved()&&isArrayResolved&&this._howMany>this._canPossiblyFulfill()){this._reject(this._getRangeError(this.length()))}};SomePromiseArray.prototype.init=function(){this._initialized=true;this._init()};SomePromiseArray.prototype.setUnwrap=function(){this._unwrap=true};SomePromiseArray.prototype.howMany=function(){return this._howMany};SomePromiseArray.prototype.setHowMany=function(count){this._howMany=count};SomePromiseArray.prototype._promiseFulfilled=function(value){this._addFulfilled(value);if(this._fulfilled()===this.howMany()){this._values.length=this.howMany();if(this.howMany()===1&&this._unwrap){this._resolve(this._values[0])}else{this._resolve(this._values)}}};SomePromiseArray.prototype._promiseRejected=function(reason){this._addRejected(reason);if(this.howMany()>this._canPossiblyFulfill()){var e=new AggregateError;for(var i=this.length();i<this._values.length;++i){e.push(this._values[i])}this._reject(e)}};SomePromiseArray.prototype._fulfilled=function(){return this._totalResolved};SomePromiseArray.prototype._rejected=function(){return this._values.length-this.length()};SomePromiseArray.prototype._addRejected=function(reason){this._values.push(reason)};SomePromiseArray.prototype._addFulfilled=function(value){this._values[this._totalResolved++]=value};SomePromiseArray.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()};SomePromiseArray.prototype._getRangeError=function(count){var message="Input array must contain at least "+this._howMany+" items but contains only "+count+" items";return new RangeError(message)};SomePromiseArray.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))};function some(promises,howMany){if((howMany|0)!==howMany||howMany<0){return apiRejection("expecting a positive integer\n\n    See http://goo.gl/1wAmHx\n")}var ret=new SomePromiseArray(promises);var promise=ret.promise();ret.setHowMany(howMany);ret.init();return promise}Promise.some=function(promises,howMany){return some(promises,howMany)};Promise.prototype.some=function(howMany){return some(this,howMany)};Promise._SomePromiseArray=SomePromiseArray}},{"./errors.js":13,"./util.js":38}],34:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function PromiseInspection(promise){if(promise!==undefined){promise=promise._target();this._bitField=promise._bitField;this._settledValue=promise._settledValue}else{this._bitField=0;this._settledValue=undefined}}PromiseInspection.prototype.value=function(){if(!this.isFulfilled()){throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n")}return this._settledValue};PromiseInspection.prototype.error=PromiseInspection.prototype.reason=function(){if(!this.isRejected()){throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n")}return this._settledValue};PromiseInspection.prototype.isFulfilled=Promise.prototype._isFulfilled=function(){return(this._bitField&268435456)>0};PromiseInspection.prototype.isRejected=Promise.prototype._isRejected=function(){return(this._bitField&134217728)>0};PromiseInspection.prototype.isPending=Promise.prototype._isPending=function(){return(this._bitField&402653184)===0};PromiseInspection.prototype.isResolved=Promise.prototype._isResolved=function(){return(this._bitField&402653184)>0};Promise.prototype.isPending=function(){return this._target()._isPending()};Promise.prototype.isRejected=function(){return this._target()._isRejected()};Promise.prototype.isFulfilled=function(){return this._target()._isFulfilled()};Promise.prototype.isResolved=function(){return this._target()._isResolved()};Promise.prototype._value=function(){return this._settledValue};Promise.prototype._reason=function(){this._unsetRejectionIsUnhandled();return this._settledValue};Promise.prototype.value=function(){var target=this._target();if(!target.isFulfilled()){throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n")}return target._settledValue};Promise.prototype.reason=function(){var target=this._target();if(!target.isRejected()){throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n")}target._unsetRejectionIsUnhandled();return target._settledValue};Promise.PromiseInspection=PromiseInspection}},{}],35:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var util=_dereq_("./util.js");var errorObj=util.errorObj;var isObject=util.isObject;function tryConvertToPromise(obj,context){if(isObject(obj)){if(obj instanceof Promise){return obj}else if(isAnyBluebirdPromise(obj)){var ret=new Promise(INTERNAL);obj._then(ret._fulfillUnchecked,ret._rejectUncheckedCheckError,ret._progressUnchecked,ret,null);return ret}var then=util.tryCatch(getThen)(obj);if(then===errorObj){if(context)context._pushContext();var ret=Promise.reject(then.e);if(context)context._popContext();return ret}else if(typeof then==="function"){return doThenable(obj,then,context)}}return obj}function getThen(obj){return obj.then}var hasProp={}.hasOwnProperty;function isAnyBluebirdPromise(obj){return hasProp.call(obj,"_promise0")}function doThenable(x,then,context){var promise=new Promise(INTERNAL);var ret=promise;if(context)context._pushContext();promise._captureStackTrace();if(context)context._popContext();var synchronous=true;var result=util.tryCatch(then).call(x,resolveFromThenable,rejectFromThenable,progressFromThenable);synchronous=false;if(promise&&result===errorObj){promise._rejectCallback(result.e,true,true);promise=null}function resolveFromThenable(value){if(!promise)return;if(x===value){promise._rejectCallback(Promise._makeSelfResolutionError(),false,true)}else{promise._resolveCallback(value)}promise=null}function rejectFromThenable(reason){if(!promise)return;promise._rejectCallback(reason,synchronous,true);promise=null}function progressFromThenable(value){if(!promise)return;if(typeof promise._progress==="function"){promise._progress(value)}}return ret}return tryConvertToPromise}},{"./util.js":38}],36:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var util=_dereq_("./util.js");var TimeoutError=Promise.TimeoutError;var afterTimeout=function(promise,message){if(!promise.isPending())return;if(typeof message!=="string"){message="operation timed out"}var err=new TimeoutError(message);util.markAsOriginatingFromRejection(err);promise._attachExtraTrace(err);promise._cancel(err)};var afterValue=function(value){return delay(+this).thenReturn(value)};var delay=Promise.delay=function(value,ms){if(ms===undefined){ms=value;value=undefined;var ret=new Promise(INTERNAL);setTimeout(function(){ret._fulfill()},ms);return ret}ms=+ms;return Promise.resolve(value)._then(afterValue,null,null,ms,undefined)};Promise.prototype.delay=function(ms){return delay(this,ms)};function successClear(value){var handle=this;if(handle instanceof Number)handle=+handle;clearTimeout(handle);return value}function failureClear(reason){var handle=this;if(handle instanceof Number)handle=+handle;clearTimeout(handle);throw reason}Promise.prototype.timeout=function(ms,message){ms=+ms;var ret=this.then().cancellable();ret._cancellationParent=this;var handle=setTimeout(function timeoutTimeout(){afterTimeout(ret,message)},ms);return ret._then(successClear,failureClear,undefined,handle,undefined)}}},{"./util.js":38}],37:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,apiRejection,tryConvertToPromise,createContext){var TypeError=_dereq_("./errors.js").TypeError;var inherits=_dereq_("./util.js").inherits;var PromiseInspection=Promise.PromiseInspection;function inspectionMapper(inspections){var len=inspections.length;for(var i=0;i<len;++i){var inspection=inspections[i];if(inspection.isRejected()){return Promise.reject(inspection.error())}inspections[i]=inspection._settledValue}return inspections}function thrower(e){setTimeout(function(){throw e},0)}function castPreservingDisposable(thenable){var maybePromise=tryConvertToPromise(thenable);if(maybePromise!==thenable&&typeof thenable._isDisposable==="function"&&typeof thenable._getDisposer==="function"&&thenable._isDisposable()){maybePromise._setDisposable(thenable._getDisposer())}return maybePromise}function dispose(resources,inspection){var i=0;var len=resources.length;var ret=Promise.defer();function iterator(){if(i>=len)return ret.resolve();var maybePromise=castPreservingDisposable(resources[i++]);if(maybePromise instanceof Promise&&maybePromise._isDisposable()){try{maybePromise=tryConvertToPromise(maybePromise._getDisposer().tryDispose(inspection),resources.promise)}catch(e){return thrower(e)}if(maybePromise instanceof Promise){return maybePromise._then(iterator,thrower,null,null,null)}}iterator()}iterator();return ret.promise}function disposerSuccess(value){var inspection=new PromiseInspection;inspection._settledValue=value;inspection._bitField=268435456;return dispose(this,inspection).thenReturn(value)}function disposerFail(reason){var inspection=new PromiseInspection;inspection._settledValue=reason;
inspection._bitField=134217728;return dispose(this,inspection).thenThrow(reason)}function Disposer(data,promise,context){this._data=data;this._promise=promise;this._context=context}Disposer.prototype.data=function(){return this._data};Disposer.prototype.promise=function(){return this._promise};Disposer.prototype.resource=function(){if(this.promise().isFulfilled()){return this.promise().value()}return null};Disposer.prototype.tryDispose=function(inspection){var resource=this.resource();var context=this._context;if(context!==undefined)context._pushContext();var ret=resource!==null?this.doDispose(resource,inspection):null;if(context!==undefined)context._popContext();this._promise._unsetDisposable();this._data=null;return ret};Disposer.isDisposer=function(d){return d!=null&&typeof d.resource==="function"&&typeof d.tryDispose==="function"};function FunctionDisposer(fn,promise,context){this.constructor$(fn,promise,context)}inherits(FunctionDisposer,Disposer);FunctionDisposer.prototype.doDispose=function(resource,inspection){var fn=this.data();return fn.call(resource,resource,inspection)};function maybeUnwrapDisposer(value){if(Disposer.isDisposer(value)){this.resources[this.index]._setDisposable(value);return value.promise()}return value}Promise.using=function(){var len=arguments.length;if(len<2)return apiRejection("you must pass at least 2 arguments to Promise.using");var fn=arguments[len-1];if(typeof fn!=="function")return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");len--;var resources=new Array(len);for(var i=0;i<len;++i){var resource=arguments[i];if(Disposer.isDisposer(resource)){var disposer=resource;resource=resource.promise();resource._setDisposable(disposer)}else{var maybePromise=tryConvertToPromise(resource);if(maybePromise instanceof Promise){resource=maybePromise._then(maybeUnwrapDisposer,null,null,{resources:resources,index:i},undefined)}}resources[i]=resource}var promise=Promise.settle(resources).then(inspectionMapper).then(function(vals){promise._pushContext();var ret;try{ret=fn.apply(undefined,vals)}finally{promise._popContext()}return ret})._then(disposerSuccess,disposerFail,undefined,resources,undefined);resources.promise=promise;return promise};Promise.prototype._setDisposable=function(disposer){this._bitField=this._bitField|262144;this._disposer=disposer};Promise.prototype._isDisposable=function(){return(this._bitField&262144)>0};Promise.prototype._getDisposer=function(){return this._disposer};Promise.prototype._unsetDisposable=function(){this._bitField=this._bitField&~262144;this._disposer=undefined};Promise.prototype.disposer=function(fn){if(typeof fn==="function"){return new FunctionDisposer(fn,this,createContext())}throw new TypeError}}},{"./errors.js":13,"./util.js":38}],38:[function(_dereq_,module,exports){"use strict";var es5=_dereq_("./es5.js");var canEvaluate=typeof navigator=="undefined";var haveGetters=function(){try{var o={};es5.defineProperty(o,"f",{get:function(){return 3}});return o.f===3}catch(e){return false}}();var errorObj={e:{}};var tryCatchTarget;function tryCatcher(){try{return tryCatchTarget.apply(this,arguments)}catch(e){errorObj.e=e;return errorObj}}function tryCatch(fn){tryCatchTarget=fn;return tryCatcher}var inherits=function(Child,Parent){var hasProp={}.hasOwnProperty;function T(){this.constructor=Child;this.constructor$=Parent;for(var propertyName in Parent.prototype){if(hasProp.call(Parent.prototype,propertyName)&&propertyName.charAt(propertyName.length-1)!=="$"){this[propertyName+"$"]=Parent.prototype[propertyName]}}}T.prototype=Parent.prototype;Child.prototype=new T;return Child.prototype};function isPrimitive(val){return val==null||val===true||val===false||typeof val==="string"||typeof val==="number"}function isObject(value){return!isPrimitive(value)}function maybeWrapAsError(maybeError){if(!isPrimitive(maybeError))return maybeError;return new Error(safeToString(maybeError))}function withAppended(target,appendee){var len=target.length;var ret=new Array(len+1);var i;for(i=0;i<len;++i){ret[i]=target[i]}ret[i]=appendee;return ret}function getDataPropertyOrDefault(obj,key,defaultValue){if(es5.isES5){var desc=Object.getOwnPropertyDescriptor(obj,key);if(desc!=null){return desc.get==null&&desc.set==null?desc.value:defaultValue}}else{return{}.hasOwnProperty.call(obj,key)?obj[key]:undefined}}function notEnumerableProp(obj,name,value){if(isPrimitive(obj))return obj;var descriptor={value:value,configurable:true,enumerable:false,writable:true};es5.defineProperty(obj,name,descriptor);return obj}var wrapsPrimitiveReceiver=function(){return this!=="string"}.call("string");function thrower(r){throw r}var inheritedDataKeys=function(){if(es5.isES5){var oProto=Object.prototype;var getKeys=Object.getOwnPropertyNames;return function(obj){var ret=[];var visitedKeys=Object.create(null);while(obj!=null&&obj!==oProto){var keys;try{keys=getKeys(obj)}catch(e){return ret}for(var i=0;i<keys.length;++i){var key=keys[i];if(visitedKeys[key])continue;visitedKeys[key]=true;var desc=Object.getOwnPropertyDescriptor(obj,key);if(desc!=null&&desc.get==null&&desc.set==null){ret.push(key)}}obj=es5.getPrototypeOf(obj)}return ret}}else{return function(obj){var ret=[];for(var key in obj){ret.push(key)}return ret}}}();function isClass(fn){try{if(typeof fn==="function"){var keys=es5.names(fn.prototype);if(es5.isES5)return keys.length>1;return keys.length>0&&!(keys.length===1&&keys[0]==="constructor")}return false}catch(e){return false}}function toFastProperties(obj){function f(){}f.prototype=obj;return f;eval(obj)}var rident=/^[a-z$_][a-z$_0-9]*$/i;function isIdentifier(str){return rident.test(str)}function filledRange(count,prefix,suffix){var ret=new Array(count);for(var i=0;i<count;++i){ret[i]=prefix+i+suffix}return ret}function safeToString(obj){try{return obj+""}catch(e){return"[no string representation]"}}function markAsOriginatingFromRejection(e){try{notEnumerableProp(e,"isOperational",true)}catch(ignore){}}function originatesFromRejection(e){if(e==null)return false;return e instanceof Error["__BluebirdErrorTypes__"].OperationalError||e["isOperational"]===true}function canAttachTrace(obj){return obj instanceof Error&&es5.propertyIsWritable(obj,"stack")}var ensureErrorObject=function(){if(!("stack"in new Error)){return function(value){if(canAttachTrace(value))return value;try{throw new Error(safeToString(value))}catch(err){return err}}}else{return function(value){if(canAttachTrace(value))return value;return new Error(safeToString(value))}}}();function classString(obj){return{}.toString.call(obj)}function copyDescriptors(from,to,filter){var keys=es5.names(from);for(var i=0;i<keys.length;++i){var key=keys[i];if(filter(key)){es5.defineProperty(to,key,es5.getDescriptor(from,key))}}}var ret={isClass:isClass,isIdentifier:isIdentifier,inheritedDataKeys:inheritedDataKeys,getDataPropertyOrDefault:getDataPropertyOrDefault,thrower:thrower,isArray:es5.isArray,haveGetters:haveGetters,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,canEvaluate:canEvaluate,errorObj:errorObj,tryCatch:tryCatch,inherits:inherits,withAppended:withAppended,maybeWrapAsError:maybeWrapAsError,wrapsPrimitiveReceiver:wrapsPrimitiveReceiver,toFastProperties:toFastProperties,filledRange:filledRange,toString:safeToString,canAttachTrace:canAttachTrace,ensureErrorObject:ensureErrorObject,originatesFromRejection:originatesFromRejection,markAsOriginatingFromRejection:markAsOriginatingFromRejection,classString:classString,copyDescriptors:copyDescriptors,isNode:typeof process!=="undefined"&&classString(process).toLowerCase()==="[object process]"};try{throw new Error}catch(e){ret.lastLineError=e}module.exports=ret},{"./es5.js":14}]},{},[4])(4)});if(typeof window!=="undefined"&&window!==null){window.P=window.Promise}else if(typeof self!=="undefined"&&self!==null){self.P=self.Promise}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:149}],364:[function(require,module,exports){(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof exports==="object"){module.exports=factory()}else{root.returnExports=factory()}})(this,function(){var XHR=XMLHttpRequest;if(!XHR)throw new Error("missing XMLHttpRequest");request.log={trace:noop,debug:noop,info:noop,warn:noop,error:noop};var DEFAULT_TIMEOUT=3*60*1e3;function request(options,callback){if(typeof callback!=="function")throw new Error("Bad callback given: "+callback);if(!options)throw new Error("No options given");var options_onResponse=options.onResponse;if(typeof options==="string")options={uri:options};else options=JSON.parse(JSON.stringify(options));options.onResponse=options_onResponse;if(options.verbose)request.log=getLogger();if(options.url){options.uri=options.url;delete options.url}if(!options.uri&&options.uri!=="")throw new Error("options.uri is a required argument");if(typeof options.uri!="string")throw new Error("options.uri must be a string");var unsupported_options=["proxy","_redirectsFollowed","maxRedirects","followRedirect"];for(var i=0;i<unsupported_options.length;i++)if(options[unsupported_options[i]])throw new Error("options."+unsupported_options[i]+" is not supported");options.callback=callback;options.method=options.method||"GET";options.headers=options.headers||{};options.body=options.body||null;options.timeout=options.timeout||request.DEFAULT_TIMEOUT;if(options.headers.host)throw new Error("Options.headers.host is not supported");if(options.json){options.headers.accept=options.headers.accept||"application/json";if(options.method!=="GET")options.headers["content-type"]="application/json";if(typeof options.json!=="boolean")options.body=JSON.stringify(options.json);else if(typeof options.body!=="string")options.body=JSON.stringify(options.body)}var serialize=function(obj){var str=[];for(var p in obj)if(obj.hasOwnProperty(p)){str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]))}return str.join("&")};if(options.qs){var qs=typeof options.qs=="string"?options.qs:serialize(options.qs);if(options.uri.indexOf("?")!==-1){options.uri=options.uri+"&"+qs}else{options.uri=options.uri+"?"+qs}}var multipart=function(obj){var result={};result.boundry="-------------------------------"+Math.floor(Math.random()*1e9);var lines=[];for(var p in obj){if(obj.hasOwnProperty(p)){lines.push("--"+result.boundry+"\n"+'Content-Disposition: form-data; name="'+p+'"'+"\n"+"\n"+obj[p]+"\n")}}lines.push("--"+result.boundry+"--");result.body=lines.join("");result.length=result.body.length;result.type="multipart/form-data; boundary="+result.boundry;return result};if(options.form){if(typeof options.form=="string")throw"form name unsupported";if(options.method==="POST"){var encoding=(options.encoding||"application/x-www-form-urlencoded").toLowerCase();options.headers["content-type"]=encoding;switch(encoding){case"application/x-www-form-urlencoded":options.body=serialize(options.form).replace(/%20/g,"+");break;case"multipart/form-data":var multi=multipart(options.form);options.body=multi.body;options.headers["content-type"]=multi.type;break;default:throw new Error("unsupported encoding:"+encoding)}}}options.onResponse=options.onResponse||noop;if(options.onResponse===true){options.onResponse=callback;options.callback=noop}if(!options.headers.authorization&&options.auth)options.headers.authorization="Basic "+b64_enc(options.auth.username+":"+options.auth.password);return run_xhr(options)}var req_seq=0;function run_xhr(options){var xhr=new XHR,timed_out=false,is_cors=is_crossDomain(options.uri),supports_cors="withCredentials"in xhr;req_seq+=1;xhr.seq_id=req_seq;xhr.id=req_seq+": "+options.method+" "+options.uri;xhr._id=xhr.id;if(is_cors&&!supports_cors){var cors_err=new Error("Browser does not support cross-origin request: "+options.uri);cors_err.cors="unsupported";return options.callback(cors_err,xhr)}xhr.timeoutTimer=setTimeout(too_late,options.timeout);function too_late(){timed_out=true;var er=new Error("ETIMEDOUT");er.code="ETIMEDOUT";er.duration=options.timeout;request.log.error("Timeout",{id:xhr._id,milliseconds:options.timeout});return options.callback(er,xhr)}var did={response:false,loading:false,end:false};xhr.onreadystatechange=on_state_change;xhr.open(options.method,options.uri,true);if(is_cors)xhr.withCredentials=!!options.withCredentials;xhr.send(options.body);return xhr;function on_state_change(event){if(timed_out)return request.log.debug("Ignoring timed out state change",{state:xhr.readyState,id:xhr.id});request.log.debug("State change",{state:xhr.readyState,id:xhr.id,timed_out:timed_out});if(xhr.readyState===XHR.OPENED){request.log.debug("Request started",{id:xhr.id});for(var key in options.headers)xhr.setRequestHeader(key,options.headers[key])}else if(xhr.readyState===XHR.HEADERS_RECEIVED)on_response();else if(xhr.readyState===XHR.LOADING){on_response();on_loading()}else if(xhr.readyState===XHR.DONE){on_response();on_loading();on_end()}}function on_response(){if(did.response)return;did.response=true;request.log.debug("Got response",{id:xhr.id,status:xhr.status});clearTimeout(xhr.timeoutTimer);xhr.statusCode=xhr.status;if(is_cors&&xhr.statusCode==0){var cors_err=new Error("CORS request rejected: "+options.uri);cors_err.cors="rejected";did.loading=true;did.end=true;return options.callback(cors_err,xhr)}options.onResponse(null,xhr)}function on_loading(){if(did.loading)return;did.loading=true;request.log.debug("Response body loading",{id:xhr.id})}function on_end(){if(did.end)return;did.end=true;request.log.debug("Request done",{id:xhr.id});xhr.body=xhr.responseText;if(options.json){try{xhr.body=JSON.parse(xhr.responseText)}catch(er){return options.callback(er,xhr)}}options.callback(null,xhr,xhr.body)}}request.withCredentials=false;request.DEFAULT_TIMEOUT=DEFAULT_TIMEOUT;request.defaults=function(options,requester){var def=function(method){var d=function(params,callback){if(typeof params==="string")params={uri:params};else{params=JSON.parse(JSON.stringify(params))}for(var i in options){if(params[i]===undefined)params[i]=options[i]}return method(params,callback)};return d};var de=def(request);de.get=def(request.get);de.post=def(request.post);de.put=def(request.put);de.head=def(request.head);return de};var shortcuts=["get","put","post","head"];shortcuts.forEach(function(shortcut){var method=shortcut.toUpperCase();var func=shortcut.toLowerCase();request[func]=function(opts){if(typeof opts==="string")opts={method:method,uri:opts};else{opts=JSON.parse(JSON.stringify(opts));opts.method=method}var args=[opts].concat(Array.prototype.slice.apply(arguments,[1]));return request.apply(this,args)}});request.couch=function(options,callback){if(typeof options==="string")options={uri:options};options.json=true;if(options.body)options.json=options.body;delete options.body;callback=callback||noop;var xhr=request(options,couch_handler);return xhr;function couch_handler(er,resp,body){if(er)return callback(er,resp,body);if((resp.statusCode<200||resp.statusCode>299)&&body.error){er=new Error("CouchDB error: "+(body.error.reason||body.error.error));for(var key in body)er[key]=body[key];return callback(er,resp,body)}return callback(er,resp,body)}};function noop(){}function getLogger(){var logger={},levels=["trace","debug","info","warn","error"],level,i;for(i=0;i<levels.length;i++){level=levels[i];logger[level]=noop;if(typeof console!=="undefined"&&console&&console[level])logger[level]=formatted(console,level)}return logger}function formatted(obj,method){return formatted_logger;function formatted_logger(str,context){if(typeof context==="object")str+=" "+JSON.stringify(context);return obj[method].call(obj,str)}}function is_crossDomain(url){var rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;var ajaxLocation;try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}var ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],parts=rurl.exec(url.toLowerCase());var result=!!(parts&&(parts[1]!=ajaxLocParts[1]||parts[2]!=ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?80:443))!=(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?80:443))));return result}function b64_enc(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data){return data}do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&63;h2=bits>>12&63;h3=bits>>6&63;h4=bits&63;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4)}while(i<data.length);enc=tmp_arr.join("");switch(data.length%3){case 1:enc=enc.slice(0,-2)+"==";break;case 2:enc=enc.slice(0,-1)+"=";break}return enc}return request})},{}],365:[function(require,module,exports){"use strict";var BPromise=require("bluebird");var request=BPromise.promisify(require("request"));var JXT=require("jxt").createRegistry();JXT.use(require("./lib/xrd"));module.exports=function(opts,cb){if(typeof opts==="string"){opts={host:opts}}var config={ssl:true,json:true,xrd:true};for(var prop in opts){config[prop]=opts[prop]}var scheme=config.ssl?"https://":"http://";var getJSON=new BPromise(function(resolve,reject){request(scheme+config.host+"/.well-known/host-meta.json").spread(function(req,body){resolve(JSON.parse(body))}).catch(reject)});var getXRD=new BPromise(function(resolve,reject){request(scheme+config.host+"/.well-known/host-meta").spread(function(req,body){var xrd=JXT.parse(body);resolve(xrd.toJSON())}).catch(reject)});return new BPromise(function(resolve,reject){BPromise.some([getJSON,getXRD],1).spread(resolve).catch(function(){reject("no-host-meta")})}).nodeify(cb)}},{"./lib/xrd":366,bluebird:363,jxt:407,request:367}],366:[function(require,module,exports){"use strict";var jxt=require("jxt");var NS="http://docs.oasis-open.org/ns/xri/xrd-1.0";module.exports=function(registry){var Properties={get:function(){var results={};var props=jxt.find(this.xml,NS,"Property");for(var i=0,len=props.length;i<len;i++){var property=props[i];var type=jxt.getAttribute(property,"type");results[type]=property.textContent}return results}};var XRD=registry.define({name:"xrd",namespace:NS,element:"XRD",fields:{subject:jxt.subText(NS,"Subject"),expires:jxt.dateSub(NS,"Expires"),aliases:jxt.multiSubText(NS,"Alias"),properties:Properties}});var Link=registry.define({name:"_xrdlink",namespace:NS,element:"Link",fields:{rel:jxt.attribute("rel"),href:jxt.attribute("href"),type:jxt.attribute("type"),template:jxt.attribute("template"),titles:jxt.subLangText(NS,"Title","default"),properties:Properties}});registry.extend(XRD,Link,"links");return XRD}},{jxt:407}],367:[function(require,module,exports){var XHR=XMLHttpRequest;if(!XHR)throw new Error("missing XMLHttpRequest");module.exports=request;request.log={trace:noop,debug:noop,info:noop,warn:noop,error:noop};var DEFAULT_TIMEOUT=3*60*1e3;function request(options,callback){if(typeof callback!=="function")throw new Error("Bad callback given: "+callback);if(!options)throw new Error("No options given");var options_onResponse=options.onResponse;if(typeof options==="string")options={uri:options};else options=JSON.parse(JSON.stringify(options));options.onResponse=options_onResponse;if(options.verbose)request.log=getLogger();if(options.url){options.uri=options.url;delete options.url}if(!options.uri&&options.uri!=="")throw new Error("options.uri is a required argument");if(typeof options.uri!="string")throw new Error("options.uri must be a string");var unsupported_options=["proxy","_redirectsFollowed","maxRedirects","followRedirect"];for(var i=0;i<unsupported_options.length;i++)if(options[unsupported_options[i]])throw new Error("options."+unsupported_options[i]+" is not supported");options.callback=callback;options.method=options.method||"GET";options.headers=options.headers||{};options.body=options.body||null;options.timeout=options.timeout||request.DEFAULT_TIMEOUT;if(options.headers.host)throw new Error("Options.headers.host is not supported");if(options.json){options.headers.accept=options.headers.accept||"application/json";if(options.method!=="GET")options.headers["content-type"]="application/json";if(typeof options.json!=="boolean")options.body=JSON.stringify(options.json);else if(typeof options.body!=="string")options.body=JSON.stringify(options.body)}options.onResponse=options.onResponse||noop;if(options.onResponse===true){options.onResponse=callback;options.callback=noop}if(!options.headers.authorization&&options.auth)options.headers.authorization="Basic "+b64_enc(options.auth.username+":"+options.auth.password);return run_xhr(options)}var req_seq=0;function run_xhr(options){var xhr=new XHR,timed_out=false,is_cors=is_crossDomain(options.uri),supports_cors="withCredentials"in xhr;req_seq+=1;xhr.seq_id=req_seq;xhr.id=req_seq+": "+options.method+" "+options.uri;xhr._id=xhr.id;if(is_cors&&!supports_cors){var cors_err=new Error("Browser does not support cross-origin request: "+options.uri);cors_err.cors="unsupported";return options.callback(cors_err,xhr)}xhr.timeoutTimer=setTimeout(too_late,options.timeout);function too_late(){timed_out=true;var er=new Error("ETIMEDOUT");er.code="ETIMEDOUT";er.duration=options.timeout;request.log.error("Timeout",{id:xhr._id,milliseconds:options.timeout});return options.callback(er,xhr)}var did={response:false,loading:false,end:false};xhr.onreadystatechange=on_state_change;xhr.open(options.method,options.uri,true);if(is_cors)xhr.withCredentials=!!options.withCredentials;xhr.send(options.body);return xhr;function on_state_change(event){if(timed_out)return request.log.debug("Ignoring timed out state change",{state:xhr.readyState,id:xhr.id});request.log.debug("State change",{state:xhr.readyState,id:xhr.id,timed_out:timed_out});if(xhr.readyState===XHR.OPENED){request.log.debug("Request started",{id:xhr.id});for(var key in options.headers)xhr.setRequestHeader(key,options.headers[key])}else if(xhr.readyState===XHR.HEADERS_RECEIVED)on_response();else if(xhr.readyState===XHR.LOADING){on_response();on_loading()}else if(xhr.readyState===XHR.DONE){on_response();on_loading();on_end()}}function on_response(){if(did.response)return;did.response=true;request.log.debug("Got response",{id:xhr.id,status:xhr.status});clearTimeout(xhr.timeoutTimer);xhr.statusCode=xhr.status;if(is_cors&&xhr.statusCode==0){var cors_err=new Error("CORS request rejected: "+options.uri);cors_err.cors="rejected";did.loading=true;did.end=true;return options.callback(cors_err,xhr)}options.onResponse(null,xhr)}function on_loading(){if(did.loading)return;did.loading=true;request.log.debug("Response body loading",{id:xhr.id})}function on_end(){if(did.end)return;did.end=true;request.log.debug("Request done",{id:xhr.id});xhr.body=xhr.responseText;if(options.json){try{xhr.body=JSON.parse(xhr.responseText)}catch(er){return options.callback(er,xhr)}}options.callback(null,xhr,xhr.body)}}request.withCredentials=false;request.DEFAULT_TIMEOUT=DEFAULT_TIMEOUT;request.defaults=function(options,requester){var def=function(method){var d=function(params,callback){if(typeof params==="string")params={uri:params};else{params=JSON.parse(JSON.stringify(params))}for(var i in options){if(params[i]===undefined)params[i]=options[i]}return method(params,callback)};return d};var de=def(request);de.get=def(request.get);de.post=def(request.post);de.put=def(request.put);de.head=def(request.head);return de};var shortcuts=["get","put","post","head"];shortcuts.forEach(function(shortcut){var method=shortcut.toUpperCase();var func=shortcut.toLowerCase();request[func]=function(opts){if(typeof opts==="string")opts={method:method,uri:opts};else{opts=JSON.parse(JSON.stringify(opts));opts.method=method}var args=[opts].concat(Array.prototype.slice.apply(arguments,[1]));return request.apply(this,args)}});request.couch=function(options,callback){if(typeof options==="string")options={uri:options};options.json=true;if(options.body)options.json=options.body;delete options.body;callback=callback||noop;var xhr=request(options,couch_handler);return xhr;function couch_handler(er,resp,body){if(er)return callback(er,resp,body);if((resp.statusCode<200||resp.statusCode>299)&&body.error){er=new Error("CouchDB error: "+(body.error.reason||body.error.error));for(var key in body)er[key]=body[key];return callback(er,resp,body)}return callback(er,resp,body)}};function noop(){}function getLogger(){var logger={},levels=["trace","debug","info","warn","error"],level,i;for(i=0;i<levels.length;i++){level=levels[i];logger[level]=noop;if(typeof console!=="undefined"&&console&&console[level])logger[level]=formatted(console,level)}return logger}function formatted(obj,method){return formatted_logger;function formatted_logger(str,context){if(typeof context==="object")str+=" "+JSON.stringify(context);return obj[method].call(obj,str)}}function is_crossDomain(url){var rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;var ajaxLocation;try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}var ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],parts=rurl.exec(url.toLowerCase());var result=!!(parts&&(parts[1]!=ajaxLocParts[1]||parts[2]!=ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?80:443))!=(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?80:443))));return result}function b64_enc(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data){return data}do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&63;h2=bits>>12&63;h3=bits>>6&63;h4=bits&63;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4)}while(i<data.length);enc=tmp_arr.join("");switch(data.length%3){case 1:enc=enc.slice(0,-2)+"==";break;case 2:enc=enc.slice(0,-1)+"=";break}return enc}},{}],368:[function(require,module,exports){var createHash=require("create-hash");var createHmac=require("create-hmac");var getHashes=require("./lib/get-hashes");var mapping={md2:"md2",md5:"md5","sha-1":"sha1","sha-224":"sha224","sha-256":"sha256","sha-384":"sha384","sha-512":"sha512"};var names=Object.keys(mapping);exports.getHashes=function(){var result=[];var available=getHashes();for(var i=0,len=names.length;i<len;i++){if(available.indexOf(mapping[names[i]])>=0){result.push(names[i])}}return result};exports.createHash=function(algorithm){algorithm=algorithm.toLowerCase();if(mapping[algorithm]){algorithm=mapping[algorithm]}return createHash(algorithm)};exports.createHmac=function(algorithm,key){algorithm=algorithm.toLowerCase();if(mapping[algorithm]){algorithm=mapping[algorithm]}return createHmac(algorithm,key)}},{"./lib/get-hashes":369,"create-hash":370,"create-hmac":382}],369:[function(require,module,exports){var crypto=require("crypto");module.exports=function(){return crypto.getHashes()}},{crypto:9}],370:[function(require,module,exports){module.exports=require(97)},{"./md5":372,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/browser.js":97,buffer:5,inherits:373,ripemd160:374,"sha.js":376,stream:163}],371:[function(require,module,exports){module.exports=require(98)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/helpers.js":98,buffer:5}],372:[function(require,module,exports){module.exports=require(99)},{"./helpers":371,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/md5.js":99}],373:[function(require,module,exports){module.exports=require(146)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/inherits/inherits_browser.js":146}],374:[function(require,module,exports){module.exports=require(100)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/ripemd160/lib/ripemd160.js":100,buffer:5}],375:[function(require,module,exports){module.exports=require(101)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/hash.js":101,buffer:5}],376:[function(require,module,exports){module.exports=require(102)},{"./sha1":377,"./sha224":378,"./sha256":379,"./sha384":380,"./sha512":381,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/index.js":102}],377:[function(require,module,exports){module.exports=require(103)},{"./hash":375,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha1.js":103,buffer:5,inherits:373}],378:[function(require,module,exports){module.exports=require(104)},{"./hash":375,"./sha256":379,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha224.js":104,buffer:5,inherits:373}],379:[function(require,module,exports){module.exports=require(105)},{"./hash":375,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha256.js":105,buffer:5,inherits:373}],380:[function(require,module,exports){module.exports=require(106)},{"./hash":375,"./sha512":381,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha384.js":106,buffer:5,inherits:373}],381:[function(require,module,exports){module.exports=require(107)},{"./hash":375,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha512.js":107,buffer:5,inherits:373}],382:[function(require,module,exports){module.exports=require(108)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hmac/browser.js":108,buffer:5,"create-hash/browser":370,inherits:383,stream:163}],383:[function(require,module,exports){module.exports=require(146)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/inherits/inherits_browser.js":146}],384:[function(require,module,exports){var util=require("util");var intersect=require("intersect");var WildEmitter=require("wildemitter");var webrtc=require("webrtcsupport");var BaseSession=require("jingle-session");var MediaSession=require("jingle-media-session");var FileSession=require("jingle-filetransfer-session");function SessionManager(conf){WildEmitter.call(this);conf=conf||{};this.jid=conf.jid;this.selfID=conf.selfID||this.jid&&this.jid.full||this.jid||"";this.sessions={};this.peers={};this.prepareSession=conf.prepareSession||function(opts){if(opts.descriptionTypes.indexOf("rtp")>=0){return new MediaSession(opts)}if(opts.descriptionTypes.indexOf("filetransfer")>=0){return new FileSession(opts)}};this.screenSharingSupport=webrtc.screenSharing;this.capabilities=["urn:xmpp:jingle:1"];if(webrtc.support){this.capabilities=["urn:xmpp:jingle:1","urn:xmpp:jingle:apps:rtp:1","urn:xmpp:jingle:apps:rtp:audio","urn:xmpp:jingle:apps:rtp:video","urn:xmpp:jingle:apps:rtp:rtcb-fb:0","urn:xmpp:jingle:apps:rtp:rtp-hdrext:0","urn:xmpp:jingle:apps:rtp:ssma:0","urn:xmpp:jingle:apps:dtls:0","urn:xmpp:jingle:apps:grouping:0","urn:xmpp:jingle:apps:file-transfer:3","urn:xmpp:jingle:transports:ice-udp:1","urn:xmpp:jingle:transports.dtls-sctp:1","urn:ietf:rfc:3264","urn:ietf:rfc:5576","urn:ietf:rfc:5888"]}this.config={debug:false,peerConnectionConfig:{iceServers:conf.iceServers||[{url:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[{DtlsSrtpKeyAgreement:true},{RtpDataChannels:false}]},media:{audio:true,video:true}};
for(var item in conf){this.config[item]=conf[item]}this.iceServers=this.config.peerConnectionConfig.iceServers}util.inherits(SessionManager,WildEmitter);SessionManager.prototype.addICEServer=function(server){if(typeof server==="string"){server={url:server}}this.iceServers.push(server)};SessionManager.prototype.addSession=function(session){var self=this;var sid=session.sid;var peer=session.peerID;this.sessions[sid]=session;if(!this.peers[peer]){this.peers[peer]=[]}this.peers[peer].push(session);session.on("terminated",function(){var peers=self.peers[peer]||[];if(peers.length){peers.splice(peers.indexOf(session),1)}delete self.sessions[sid]});session.on("*",function(name,data,extraData,extraData2){if(name==="send"){var action=data.jingle&&data.jingle.action;if(session.isInitiator&&action==="session-initiate"){self.emit("outgoing",session)}}if(self.config.debug&&(name==="log:debug"||name==="log:error")){console.log("Jingle:",data,extraData,extraData2)}if(name.indexOf("change")===0){return}self.emit(name,data,extraData,extraData2)});this.emit("createdSession",session);return session};SessionManager.prototype.createMediaSession=function(peer,sid,stream){var session=new MediaSession({sid:sid,peer:peer,initiator:true,stream:stream,parent:this,iceServers:this.iceServers,constraints:this.config.peerConnectionConstraints});this.addSession(session);return session};SessionManager.prototype.createFileTransferSession=function(peer,sid){var session=new FileSession({sid:sid,peer:peer,initiator:true,parent:this});this.addSession(session);return session};SessionManager.prototype.endPeerSessions=function(peer,reason,silent){peer=peer.full||peer;var sessions=this.peers[peer]||[];delete this.peers[peer];sessions.forEach(function(session){session.end(reason||"gone",silent)})};SessionManager.prototype.endAllSessions=function(reason,silent){var self=this;Object.keys(this.peers).forEach(function(peer){self.endPeerSessions(peer,reason,silent)})};SessionManager.prototype._createIncomingSession=function(meta,req){var session;if(this.prepareSession){session=this.prepareSession(meta,req)}if(!session){session=new BaseSession(meta)}this.addSession(session);return session};SessionManager.prototype._sendError=function(to,id,data){if(!data.type){data.type="cancel"}this.emit("send",{to:to,id:id,type:"error",error:data})};SessionManager.prototype._log=function(level,message){this.emit("log:"+level,message)};SessionManager.prototype.process=function(req){var self=this;var sid=!!req.jingle?req.jingle.sid:null;var session=this.sessions[sid]||null;var rid=req.id;var sender=req.from.full||req.from;if(req.type==="error"){var isTieBreak=req.error&&req.error.jingleCondition==="tie-break";if(session&&session.pending&&isTieBreak){return session.end("alternative-session",true)}else{if(session){session.pendingAction=false}return this.emit("error",req)}}if(req.type==="result"){if(session){session.pendingAction=false}return}var action=req.jingle.action;var contents=req.jingle.contents||[];var descriptionTypes=contents.map(function(content){if(content.description){return content.description.descType}});var transportTypes=contents.map(function(content){if(content.transport){return content.transport.transType}});if(action!=="session-initiate"){if(!session){this._log("error","Unknown session",sid);return this._sendError(sender,rid,{condition:"item-not-found",jingleCondition:"unknown-session"})}if(session.peerID!==sender||session.ended){this._log("error","Session has ended, or action has wrong sender");return this._sendError(sender,rid,{condition:"item-not-found",jingleCondition:"unknown-session"})}if(action==="session-accept"&&!session.pending){this._log("error","Tried to accept session twice",sid);return this._sendError(sender,rid,{condition:"unexpected-request",jingleCondition:"out-of-order"})}if(action!=="session-terminate"&&action===session.pendingAction){this._log("error","Tie break during pending request");if(session.isInitiator){return this._sendError(sender,rid,{condition:"conflict",jingleCondition:"tie-break"})}}}else if(session){if(session.peerID!==sender){this._log("error","Duplicate sid from new sender");return this._sendError(sender,rid,{condition:"service-unavailable"})}if(session.pending){if(this.selfID>session.peerID){this._log("error","Tie break new session because of duplicate sids");return this._sendError(sender,rid,{condition:"conflict",jingleCondition:"tie-break"})}}else{this._log("error","Someone is doing this wrong");return this._sendError(sender,rid,{condition:"unexpected-request",jingleCondition:"out-of-order"})}}else if(this.peers[sender]&&this.peers[sender].length){for(var i=0,len=this.peers[sender].length;i<len;i++){var sess=this.peers[sender][i];if(sess&&sess.pending){if(intersect(descriptionTypes,sess.pendingDescriptionTypes).length){if(sess.sid>sid){this._log("info","Tie break");return this._sendError(sender,rid,{condition:"conflict",jingleCondition:"tie-break"})}}}}}if(action==="session-initiate"){if(!contents.length){return self._sendError(sender,rid,{condition:"bad-request"})}session=this._createIncomingSession({sid:sid,peer:req.from,peerID:sender,initiator:false,parent:this,descriptionTypes:descriptionTypes,transportTypes:transportTypes,iceServers:this.iceServers,constraints:this.peerConnectionConstraints},req)}session.process(action,req.jingle,function(err){if(err){self._log("error","Could not process request",req,err);self._sendError(sender,rid,err)}else{self.emit("send",{to:sender,id:rid,type:"result"});if(action==="session-initiate"){self.emit("incoming",session)}}})};module.exports=SessionManager},{intersect:386,"jingle-filetransfer-session":387,"jingle-media-session":396,"jingle-session":404,util:165,webrtcsupport:405,wildemitter:449}],385:[function(require,module,exports){var arr=[];var each=arr.forEach;var slice=arr.slice;module.exports=function(obj){each.call(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop]}}});return obj}},{}],386:[function(require,module,exports){module.exports=intersect;function intersect(a,b){var res=[];for(var i=0;i<a.length;i++){if(indexOf(b,a[i])>-1)res.push(a[i])}return res}intersect.big=function(a,b){var ret=[];var temp={};for(var i=0;i<b.length;i++){temp[b[i]]=true}for(var i=0;i<a.length;i++){if(temp[a[i]])ret.push(a[i])}return ret};function indexOf(arr,el){for(var i=0;i<arr.length;i++){if(arr[i]===el)return i}return-1}},{}],387:[function(require,module,exports){var util=require("util");var extend=require("extend-object");var BaseSession=require("jingle-session");var RTCPeerConnection=require("rtcpeerconnection");var FileTransfer=require("filetransfer");function FileTransferSession(opts){BaseSession.call(this,opts);var self=this;this.pc=new RTCPeerConnection({iceServers:opts.iceServers||[],useJingle:true},opts.constraints||{});this.pc.on("ice",this.onIceCandidate.bind(this));this.pc.on("iceConnectionStateChange",this.onIceStateChange.bind(this));this.pc.on("addChannel",this.onChannelAdded.bind(this));this.sender=new FileTransfer.Sender;this.sender.on("progress",function(sent,size){self._log("info","Send progress "+sent+"/"+size)});this.sender.on("sentFile",function(meta){self._log("info","Sent file",meta.name);var content=self.pc.localDescription.contents[0];delete content.transport;content.description={descType:"filetransfer",offer:{hash:{algo:meta.algo,value:meta.hash}}};self.send("description-info",{contents:[content]});self.emit("sentFile",self,meta)});this.receiver=new FileTransfer.Receiver;this.receiver.on("progress",function(received,size){self._log("info","Receive progress "+received+"/"+size)});this.receiver.on("receivedFile",function(file){self.receivedFile=file;self.maybeReceivedFile()})}util.inherits(FileTransferSession,BaseSession);FileTransferSession.prototype=extend(FileTransferSession.prototype,{start:function(file){var self=this;this.state="pending";this.pc.isInitiator=true;var sendChannel=this.pc.createDataChannel("filetransfer");sendChannel.onopen=function(){self.sender.send(file,sendChannel)};var constraints={mandatory:{OfferToReceiveAudio:false,OfferToReceiveVideo:false}};this.pc.offer(constraints,function(err,offer){if(err){self._log("error","Could not create WebRTC offer",err);return self.end("failed-application",true)}offer.jingle.contents[0].description={descType:"filetransfer",offer:{date:file.lastModifiedDate,name:file.name,size:file.size,hash:{algo:"sha-1",value:""}}};self.send("session-initiate",offer.jingle)})},accept:function(){var self=this;this._log("info","Accepted incoming session");this.state="active";this.pc.answer(function(err,answer){if(err){self._log("error","Could not create WebRTC answer",err);return self.end("failed-application")}answer.jingle.contents[0].name="data";self.send("session-accept",answer.jingle)})},end:function(reason,silent){this.pc.close();BaseSession.prototype.end.call(this,reason,silent)},maybeReceivedFile:function(){if(!this.receiver.metadata.hash.value){}else if(this.receiver.metadata.hash.value===this.receiver.metadata.actualhash){this._log("info","File hash matches");this.emit("receivedFile",this,this.receivedFile,this.receiver.metadata);this.end("success")}else{this._log("error","File hash does not match");this.end("media-error")}},onIceCandidate:function(candidate){this._log("info","Discovered new ICE candidate",candidate.jingle);candidate.jingle.contents[0].name="data";this.send("transport-info",candidate.jingle)},onIceStateChange:function(){switch(this.pc.iceConnectionState){case"checking":this.connectionState="connecting";break;case"completed":case"connected":this.connectionState="connected";break;case"disconnected":if(this.pc.signalingState==="stable"){this.connectionState="interrupted"}else{this.connectionState="disconnected"}break;case"failed":this.connectionState="failed";this.end("failed-transport");break;case"closed":this.connectionState="disconnected";break}},onChannelAdded:function(channel){this.receiver.receive(null,channel)},onSessionInitiate:function(changes,cb){var self=this;this._log("info","Initiating incoming session");this.state="pending";this.pc.isInitiator=false;var desc=changes.contents[0].description;this.receiver.metadata=desc.offer.toJSON();if(this.receiver.metadata.hash){this.receiver.config.hash=this.receiver.metadata.hash.algo}changes.contents[0].description={descType:"datachannel"};this.pc.handleOffer({type:"offer",jingle:changes},function(err){if(err){self._log("error","Could not create WebRTC answer");return cb({condition:"general-error"})}cb()})},onSessionAccept:function(changes,cb){var self=this;this.state="active";changes.contents[0].description={descType:"datachannel"};this.pc.handleAnswer({type:"answer",jingle:changes},function(err){if(err){self._log("error","Could not process WebRTC answer");return cb({condition:"general-error"})}self.emit("accepted",self);cb()})},onSessionTerminate:function(changes,cb){this._log("info","Terminating session");this.pc.close();BaseSession.prototype.end.call(this,changes.reason,true);cb()},onDescriptionInfo:function(info,cb){var hash=info.contents[0].description.offer.hash;this.receiver.metadata.hash=hash;if(this.receiver.metadata.actualhash){this.maybeReceivedFile()}cb()},onTransportInfo:function(changes,cb){this.pc.processIce(changes,function(){cb()})}});module.exports=FileTransferSession},{"extend-object":385,filetransfer:388,"jingle-session":404,rtcpeerconnection:395,util:165}],388:[function(require,module,exports){var async=require("async");var WildEmitter=require("wildemitter");var util=require("util");var hashes=require("iana-hashes");function Sender(opts){WildEmitter.call(this);var self=this;var options=opts||{};this.config={chunksize:16384,pacing:10,hash:"sha-1"};var item;for(item in options){this.config[item]=options[item]}this.file=null;this.channel=null;this.hash=null;this.processingQueue=async.queue(function(task,next){if(task.type=="chunk"){var reader=new window.FileReader;reader.onload=function(){return function(e){self.channel.send(e.target.result);self.hash.update(new Uint8Array(e.target.result));self.emit("progress",task.start,task.file.size);window.setTimeout(next,self.config.pacing)}}(task.file);var slice=task.file.slice(task.start,task.start+task.size);reader.readAsArrayBuffer(slice)}else if(task.type=="complete"){self.emit("sentFile",{hash:self.hash.digest("hex"),algo:self.config.hash});next()}})}util.inherits(Sender,WildEmitter);Sender.prototype.send=function(file,channel){this.file=file;this.hash=hashes.createHash(this.config.hash);this.channel=channel;for(var start=0;start<this.file.size;start+=this.config.chunksize){this.processingQueue.push({type:"chunk",file:file,start:start,size:this.config.chunksize})}this.processingQueue.push({type:"complete"})};function Receiver(opts){WildEmitter.call(this);var options=opts||{};this.config={hash:"sha-1"};var item;for(item in options){this.config[item]=options[item]}this.receiveBuffer=[];this.received=0;this.metadata={};this.channel=null;this.hash=null}util.inherits(Receiver,WildEmitter);Receiver.prototype.receive=function(metadata,channel){var self=this;if(metadata){this.metadata=metadata}this.hash=hashes.createHash(this.config.hash);this.channel=channel;channel.binaryType="arraybuffer";this.channel.onmessage=function(event){var len=event.data.byteLength;self.received+=len;self.receiveBuffer.push(event.data);self.hash.update(new Uint8Array(event.data));self.emit("progress",self.received,self.metadata.size);if(self.received==self.metadata.size){self.metadata.actualhash=self.hash.digest("hex");self.emit("receivedFile",new window.Blob(self.receiveBuffer),self.metadata);self.receiveBuffer=[]}else if(self.received>self.metadata.size){console.error("received more than expected, discarding...");self.receiveBuffer=[]}}};module.exports={};module.exports.support=window&&window.File&&window.FileReader&&window.Blob;module.exports.Sender=Sender;module.exports.Receiver=Receiver},{async:362,"iana-hashes":368,util:165,wildemitter:449}],389:[function(require,module,exports){var toSDP=require("./lib/tosdp");var toJSON=require("./lib/tojson");exports.toIncomingSDPOffer=function(session){return toSDP.toSessionSDP(session,{role:"responder",direction:"incoming"})};exports.toOutgoingSDPOffer=function(session){return toSDP.toSessionSDP(session,{role:"initiator",direction:"outgoing"})};exports.toIncomingSDPAnswer=function(session){return toSDP.toSessionSDP(session,{role:"initiator",direction:"incoming"})};exports.toOutgoingSDPAnswer=function(session){return toSDP.toSessionSDP(session,{role:"responder",direction:"outgoing"})};exports.toIncomingMediaSDPOffer=function(media){return toSDP.toMediaSDP(media,{role:"responder",direction:"incoming"})};exports.toOutgoingMediaSDPOffer=function(media){return toSDP.toMediaSDP(media,{role:"initiator",direction:"outgoing"})};exports.toIncomingMediaSDPAnswer=function(media){return toSDP.toMediaSDP(media,{role:"initiator",direction:"incoming"})};exports.toOutgoingMediaSDPAnswer=function(media){return toSDP.toMediaSDP(media,{role:"responder",direction:"outgoing"})};exports.toCandidateSDP=toSDP.toCandidateSDP;exports.toMediaSDP=toSDP.toMediaSDP;exports.toSessionSDP=toSDP.toSessionSDP;exports.toIncomingJSONOffer=function(sdp,creators){return toJSON.toSessionJSON(sdp,{role:"responder",direction:"incoming",creators:creators})};exports.toOutgoingJSONOffer=function(sdp,creators){return toJSON.toSessionJSON(sdp,{role:"initiator",direction:"outgoing",creators:creators})};exports.toIncomingJSONAnswer=function(sdp,creators){return toJSON.toSessionJSON(sdp,{role:"initiator",direction:"incoming",creators:creators})};exports.toOutgoingJSONAnswer=function(sdp,creators){return toJSON.toSessionJSON(sdp,{role:"responder",direction:"outgoing",creators:creators})};exports.toIncomingMediaJSONOffer=function(sdp,creator){return toJSON.toMediaJSON(sdp,{role:"responder",direction:"incoming",creator:creator})};exports.toOutgoingMediaJSONOffer=function(sdp,creator){return toJSON.toMediaJSON(sdp,{role:"initiator",direction:"outgoing",creator:creator})};exports.toIncomingMediaJSONAnswer=function(sdp,creator){return toJSON.toMediaJSON(sdp,{role:"initiator",direction:"incoming",creator:creator})};exports.toOutgoingMediaJSONAnswer=function(sdp,creator){return toJSON.toMediaJSON(sdp,{role:"responder",direction:"outgoing",creator:creator})};exports.toCandidateJSON=toJSON.toCandidateJSON;exports.toMediaJSON=toJSON.toMediaJSON;exports.toSessionJSON=toJSON.toSessionJSON},{"./lib/tojson":392,"./lib/tosdp":393}],390:[function(require,module,exports){exports.lines=function(sdp){return sdp.split("\r\n").filter(function(line){return line.length>0})};exports.findLine=function(prefix,mediaLines,sessionLines){var prefixLength=prefix.length;for(var i=0;i<mediaLines.length;i++){if(mediaLines[i].substr(0,prefixLength)===prefix){return mediaLines[i]}}if(!sessionLines){return false}for(var j=0;j<sessionLines.length;j++){if(sessionLines[j].substr(0,prefixLength)===prefix){return sessionLines[j]}}return false};exports.findLines=function(prefix,mediaLines,sessionLines){var results=[];var prefixLength=prefix.length;for(var i=0;i<mediaLines.length;i++){if(mediaLines[i].substr(0,prefixLength)===prefix){results.push(mediaLines[i])}}if(results.length||!sessionLines){return results}for(var j=0;j<sessionLines.length;j++){if(sessionLines[j].substr(0,prefixLength)===prefix){results.push(sessionLines[j])}}return results};exports.mline=function(line){var parts=line.substr(2).split(" ");var parsed={media:parts[0],port:parts[1],proto:parts[2],formats:[]};for(var i=3;i<parts.length;i++){if(parts[i]){parsed.formats.push(parts[i])}}return parsed};exports.rtpmap=function(line){var parts=line.substr(9).split(" ");var parsed={id:parts.shift()};parts=parts[0].split("/");parsed.name=parts[0];parsed.clockrate=parts[1];parsed.channels=parts.length==3?parts[2]:"1";return parsed};exports.sctpmap=function(line){var parts=line.substr(10).split(" ");var parsed={number:parts.shift(),protocol:parts.shift(),streams:parts.shift()};return parsed};exports.fmtp=function(line){var kv,key,value;var parts=line.substr(line.indexOf(" ")+1).split(";");var parsed=[];for(var i=0;i<parts.length;i++){kv=parts[i].split("=");key=kv[0].trim();value=kv[1];if(key&&value){parsed.push({key:key,value:value})}else if(key){parsed.push({key:"",value:key})}}return parsed};exports.crypto=function(line){var parts=line.substr(9).split(" ");var parsed={tag:parts[0],cipherSuite:parts[1],keyParams:parts[2],sessionParams:parts.slice(3).join(" ")};return parsed};exports.fingerprint=function(line){var parts=line.substr(14).split(" ");return{hash:parts[0],value:parts[1]}};exports.extmap=function(line){var parts=line.substr(9).split(" ");var parsed={};var idpart=parts.shift();var sp=idpart.indexOf("/");if(sp>=0){parsed.id=idpart.substr(0,sp);parsed.senders=idpart.substr(sp+1)}else{parsed.id=idpart;parsed.senders="sendrecv"}parsed.uri=parts.shift()||"";return parsed};exports.rtcpfb=function(line){var parts=line.substr(10).split(" ");var parsed={};parsed.id=parts.shift();parsed.type=parts.shift();if(parsed.type==="trr-int"){parsed.value=parts.shift()}else{parsed.subtype=parts.shift()||""}parsed.parameters=parts;return parsed};exports.candidate=function(line){var parts;if(line.indexOf("a=candidate:")===0){parts=line.substring(12).split(" ")}else{parts=line.substring(10).split(" ")}var candidate={foundation:parts[0],component:parts[1],protocol:parts[2].toLowerCase(),priority:parts[3],ip:parts[4],port:parts[5],type:parts[7],generation:"0"};for(var i=8;i<parts.length;i+=2){if(parts[i]==="raddr"){candidate.relAddr=parts[i+1]}else if(parts[i]==="rport"){candidate.relPort=parts[i+1]}else if(parts[i]==="generation"){candidate.generation=parts[i+1]}else if(parts[i]==="tcptype"){candidate.tcpType=parts[i+1]}}candidate.network="1";return candidate};exports.sourceGroups=function(lines){var parsed=[];for(var i=0;i<lines.length;i++){var parts=lines[i].substr(13).split(" ");parsed.push({semantics:parts.shift(),sources:parts})}return parsed};exports.sources=function(lines){var parsed=[];var sources={};for(var i=0;i<lines.length;i++){var parts=lines[i].substr(7).split(" ");var ssrc=parts.shift();if(!sources[ssrc]){var source={ssrc:ssrc,parameters:[]};parsed.push(source);sources[ssrc]=source}parts=parts.join(" ").split(":");var attribute=parts.shift();var value=parts.join(":")||null;sources[ssrc].parameters.push({key:attribute,value:value})}return parsed};exports.groups=function(lines){var parsed=[];var parts;for(var i=0;i<lines.length;i++){parts=lines[i].substr(8).split(" ");parsed.push({semantics:parts.shift(),contents:parts})}return parsed};exports.bandwidth=function(line){var parts=line.substr(2).split(":");var parsed={};parsed.type=parts.shift();parsed.bandwidth=parts.shift();return parsed}},{}],391:[function(require,module,exports){module.exports={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}}},{}],392:[function(require,module,exports){var SENDERS=require("./senders");var parsers=require("./parsers");var idCounter=Math.random();exports._setIdCounter=function(counter){idCounter=counter};exports.toSessionJSON=function(sdp,opts){var i;var creators=opts.creators||[];var role=opts.role||"initiator";var direction=opts.direction||"outgoing";var media=sdp.split("\r\nm=");for(i=1;i<media.length;i++){media[i]="m="+media[i];if(i!==media.length-1){media[i]+="\r\n"}}var session=media.shift()+"\r\n";var sessionLines=parsers.lines(session);var parsed={};var contents=[];for(i=0;i<media.length;i++){contents.push(exports.toMediaJSON(media[i],session,{role:role,direction:direction,creator:creators[i]||"initiator"}))}parsed.contents=contents;var groupLines=parsers.findLines("a=group:",sessionLines);if(groupLines.length){parsed.groups=parsers.groups(groupLines)}return parsed};exports.toMediaJSON=function(media,session,opts){var creator=opts.creator||"initiator";var role=opts.role||"initiator";var direction=opts.direction||"outgoing";var lines=parsers.lines(media);var sessionLines=parsers.lines(session);var mline=parsers.mline(lines[0]);var content={creator:creator,name:mline.media,description:{descType:"rtp",media:mline.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transType:"iceUdp",candidates:[],fingerprints:[]}};if(mline.media=="application"){content.description={descType:"datachannel"};content.transport.sctp=[]}var desc=content.description;var trans=content.transport;var mid=parsers.findLine("a=mid:",lines);if(mid){content.name=mid.substr(6)}if(parsers.findLine("a=sendrecv",lines,sessionLines)){content.senders="both"}else if(parsers.findLine("a=sendonly",lines,sessionLines)){content.senders=SENDERS[role][direction].sendonly}else if(parsers.findLine("a=recvonly",lines,sessionLines)){content.senders=SENDERS[role][direction].recvonly}else if(parsers.findLine("a=inactive",lines,sessionLines)){content.senders="none"}if(desc.descType=="rtp"){var bandwidth=parsers.findLine("b=",lines);if(bandwidth){desc.bandwidth=parsers.bandwidth(bandwidth)}var ssrc=parsers.findLine("a=ssrc:",lines);if(ssrc){desc.ssrc=ssrc.substr(7).split(" ")[0]}var rtpmapLines=parsers.findLines("a=rtpmap:",lines);rtpmapLines.forEach(function(line){var payload=parsers.rtpmap(line);payload.parameters=[];payload.feedback=[];var fmtpLines=parsers.findLines("a=fmtp:"+payload.id,lines);fmtpLines.forEach(function(line){payload.parameters=parsers.fmtp(line)});var fbLines=parsers.findLines("a=rtcp-fb:"+payload.id,lines);fbLines.forEach(function(line){payload.feedback.push(parsers.rtcpfb(line))});desc.payloads.push(payload)});var cryptoLines=parsers.findLines("a=crypto:",lines,sessionLines);cryptoLines.forEach(function(line){desc.encryption.push(parsers.crypto(line))});if(parsers.findLine("a=rtcp-mux",lines)){desc.mux=true}var fbLines=parsers.findLines("a=rtcp-fb:*",lines);fbLines.forEach(function(line){desc.feedback.push(parsers.rtcpfb(line))});var extLines=parsers.findLines("a=extmap:",lines);extLines.forEach(function(line){var ext=parsers.extmap(line);ext.senders=SENDERS[role][direction][ext.senders];desc.headerExtensions.push(ext)});var ssrcGroupLines=parsers.findLines("a=ssrc-group:",lines);desc.sourceGroups=parsers.sourceGroups(ssrcGroupLines||[]);var ssrcLines=parsers.findLines("a=ssrc:",lines);desc.sources=parsers.sources(ssrcLines||[]);if(parsers.findLine("a=x-google-flag:conference",lines,sessionLines)){desc.googConferenceFlag=true}}var fingerprintLines=parsers.findLines("a=fingerprint:",lines,sessionLines);var setup=parsers.findLine("a=setup:",lines,sessionLines);fingerprintLines.forEach(function(line){var fp=parsers.fingerprint(line);if(setup){fp.setup=setup.substr(8)}trans.fingerprints.push(fp)});var ufragLine=parsers.findLine("a=ice-ufrag:",lines,sessionLines);var pwdLine=parsers.findLine("a=ice-pwd:",lines,sessionLines);if(ufragLine&&pwdLine){trans.ufrag=ufragLine.substr(12);trans.pwd=pwdLine.substr(10);trans.candidates=[];var candidateLines=parsers.findLines("a=candidate:",lines,sessionLines);candidateLines.forEach(function(line){trans.candidates.push(exports.toCandidateJSON(line))})}if(desc.descType=="datachannel"){var sctpmapLines=parsers.findLines("a=sctpmap:",lines);sctpmapLines.forEach(function(line){var sctp=parsers.sctpmap(line);trans.sctp.push(sctp)})}return content};exports.toCandidateJSON=function(line){var candidate=parsers.candidate(line.split("\r\n")[0]);candidate.id=(idCounter++).toString(36).substr(0,12);return candidate}},{"./parsers":390,"./senders":391}],393:[function(require,module,exports){var SENDERS=require("./senders");exports.toSessionSDP=function(session,opts){var role=opts.role||"initiator";var direction=opts.direction||"outgoing";var sid=opts.sid||session.sid||Date.now();var time=opts.time||Date.now();var sdp=["v=0","o=- "+sid+" "+time+" IN IP4 0.0.0.0","s=-","t=0 0"];var groups=session.groups||[];groups.forEach(function(group){sdp.push("a=group:"+group.semantics+" "+group.contents.join(" "))});var contents=session.contents||[];contents.forEach(function(content){sdp.push(exports.toMediaSDP(content,opts))});return sdp.join("\r\n")+"\r\n"};exports.toMediaSDP=function(content,opts){var sdp=[];var role=opts.role||"initiator";var direction=opts.direction||"outgoing";var desc=content.description;var transport=content.transport;var payloads=desc.payloads||[];var fingerprints=transport&&transport.fingerprints||[];var mline=[];if(desc.descType=="datachannel"){mline.push("application");mline.push("1");mline.push("DTLS/SCTP");if(transport.sctp){transport.sctp.forEach(function(map){mline.push(map.number)})}}else{mline.push(desc.media);mline.push("1");if(desc.encryption&&desc.encryption.length>0||fingerprints.length>0){mline.push("RTP/SAVPF")}else{mline.push("RTP/AVPF")}payloads.forEach(function(payload){mline.push(payload.id)})}sdp.push("m="+mline.join(" "));sdp.push("c=IN IP4 0.0.0.0");if(desc.bandwidth&&desc.bandwidth.type&&desc.bandwidth.bandwidth){sdp.push("b="+desc.bandwidth.type+":"+desc.bandwidth.bandwidth)}if(desc.descType=="rtp"){sdp.push("a=rtcp:1 IN IP4 0.0.0.0")}if(transport){if(transport.ufrag){sdp.push("a=ice-ufrag:"+transport.ufrag)}if(transport.pwd){sdp.push("a=ice-pwd:"+transport.pwd)}var pushedSetup=false;fingerprints.forEach(function(fingerprint){sdp.push("a=fingerprint:"+fingerprint.hash+" "+fingerprint.value);if(fingerprint.setup&&!pushedSetup){sdp.push("a=setup:"+fingerprint.setup)}});if(transport.sctp){transport.sctp.forEach(function(map){sdp.push("a=sctpmap:"+map.number+" "+map.protocol+" "+map.streams)})}}if(desc.descType=="rtp"){sdp.push("a="+(SENDERS[role][direction][content.senders]||"sendrecv"))}sdp.push("a=mid:"+content.name);if(desc.mux){sdp.push("a=rtcp-mux")}var encryption=desc.encryption||[];encryption.forEach(function(crypto){sdp.push("a=crypto:"+crypto.tag+" "+crypto.cipherSuite+" "+crypto.keyParams+(crypto.sessionParams?" "+crypto.sessionParams:""))});if(desc.googConferenceFlag){sdp.push("a=x-google-flag:conference")}payloads.forEach(function(payload){var rtpmap="a=rtpmap:"+payload.id+" "+payload.name+"/"+payload.clockrate;if(payload.channels&&payload.channels!="1"){rtpmap+="/"+payload.channels}sdp.push(rtpmap);if(payload.parameters&&payload.parameters.length){var fmtp=["a=fmtp:"+payload.id];var parameters=[];payload.parameters.forEach(function(param){parameters.push((param.key?param.key+"=":"")+param.value)});fmtp.push(parameters.join(";"));sdp.push(fmtp.join(" "))}if(payload.feedback){payload.feedback.forEach(function(fb){if(fb.type==="trr-int"){sdp.push("a=rtcp-fb:"+payload.id+" trr-int "+fb.value?fb.value:"0")}else{sdp.push("a=rtcp-fb:"+payload.id+" "+fb.type+(fb.subtype?" "+fb.subtype:""))}})}});if(desc.feedback){desc.feedback.forEach(function(fb){if(fb.type==="trr-int"){sdp.push("a=rtcp-fb:* trr-int "+fb.value?fb.value:"0")}else{sdp.push("a=rtcp-fb:* "+fb.type+(fb.subtype?" "+fb.subtype:""))}})}var hdrExts=desc.headerExtensions||[];hdrExts.forEach(function(hdr){sdp.push("a=extmap:"+hdr.id+(hdr.senders?"/"+SENDERS[role][direction][hdr.senders]:"")+" "+hdr.uri)});var ssrcGroups=desc.sourceGroups||[];ssrcGroups.forEach(function(ssrcGroup){sdp.push("a=ssrc-group:"+ssrcGroup.semantics+" "+ssrcGroup.sources.join(" "))});var ssrcs=desc.sources||[];ssrcs.forEach(function(ssrc){for(var i=0;i<ssrc.parameters.length;i++){var param=ssrc.parameters[i];sdp.push("a=ssrc:"+(ssrc.ssrc||desc.ssrc)+" "+param.key+(param.value?":"+param.value:""))}});var candidates=transport.candidates||[];candidates.forEach(function(candidate){sdp.push(exports.toCandidateSDP(candidate))});return sdp.join("\r\n")};exports.toCandidateSDP=function(candidate){var sdp=[];sdp.push(candidate.foundation);sdp.push(candidate.component);sdp.push(candidate.protocol.toUpperCase());sdp.push(candidate.priority);sdp.push(candidate.ip);sdp.push(candidate.port);var type=candidate.type;sdp.push("typ");sdp.push(type);if(type==="srflx"||type==="prflx"||type==="relay"){if(candidate.relAddr&&candidate.relPort){sdp.push("raddr");sdp.push(candidate.relAddr);sdp.push("rport");sdp.push(candidate.relPort)}}if(candidate.tcpType&&candidate.protocol.toUpperCase()=="TCP"){sdp.push("tcptype");sdp.push(candidate.tcpType)}sdp.push("generation");sdp.push(candidate.generation||"0");return"a=candidate:"+sdp.join(" ")}},{"./senders":391}],394:[function(require,module,exports){var util=require("util");var webrtc=require("webrtcsupport");var WildEmitter=require("wildemitter");function dumpSDP(description){return{type:description.type,sdp:description.sdp}}function dumpStream(stream){var info={label:stream.id};if(stream.getAudioTracks().length){info.audio=stream.getAudioTracks().map(function(track){return track.id})}if(stream.getVideoTracks().length){info.video=stream.getVideoTracks().map(function(track){return track.id})}return info}function TraceablePeerConnection(config,constraints){var self=this;WildEmitter.call(this);this.peerconnection=new webrtc.PeerConnection(config,constraints);this.trace=function(what,info){self.emit("PeerConnectionTrace",{time:new Date,type:what,value:info||""})};this.onicecandidate=null;this.peerconnection.onicecandidate=function(event){self.trace("onicecandidate",event.candidate);if(self.onicecandidate!==null){self.onicecandidate(event)}};this.onaddstream=null;this.peerconnection.onaddstream=function(event){self.trace("onaddstream",dumpStream(event.stream));if(self.onaddstream!==null){self.onaddstream(event)}};this.onremovestream=null;this.peerconnection.onremovestream=function(event){self.trace("onremovestream",dumpStream(event.stream));if(self.onremovestream!==null){self.onremovestream(event)
}};this.onsignalingstatechange=null;this.peerconnection.onsignalingstatechange=function(event){self.trace("onsignalingstatechange",self.signalingState);if(self.onsignalingstatechange!==null){self.onsignalingstatechange(event)}};this.oniceconnectionstatechange=null;this.peerconnection.oniceconnectionstatechange=function(event){self.trace("oniceconnectionstatechange",self.iceConnectionState);if(self.oniceconnectionstatechange!==null){self.oniceconnectionstatechange(event)}};this.onnegotiationneeded=null;this.peerconnection.onnegotiationneeded=function(event){self.trace("onnegotiationneeded");if(self.onnegotiationneeded!==null){self.onnegotiationneeded(event)}};self.ondatachannel=null;this.peerconnection.ondatachannel=function(event){self.trace("ondatachannel",event);if(self.ondatachannel!==null){self.ondatachannel(event)}};this.getLocalStreams=this.peerconnection.getLocalStreams.bind(this.peerconnection);this.getRemoteStreams=this.peerconnection.getRemoteStreams.bind(this.peerconnection)}util.inherits(TraceablePeerConnection,WildEmitter);Object.defineProperty(TraceablePeerConnection.prototype,"signalingState",{get:function(){return this.peerconnection.signalingState}});Object.defineProperty(TraceablePeerConnection.prototype,"iceConnectionState",{get:function(){return this.peerconnection.iceConnectionState}});Object.defineProperty(TraceablePeerConnection.prototype,"localDescription",{get:function(){return this.peerconnection.localDescription}});Object.defineProperty(TraceablePeerConnection.prototype,"remoteDescription",{get:function(){return this.peerconnection.remoteDescription}});TraceablePeerConnection.prototype.addStream=function(stream){this.trace("addStream",dumpStream(stream));this.peerconnection.addStream(stream)};TraceablePeerConnection.prototype.removeStream=function(stream){this.trace("removeStream",dumpStream(stream));this.peerconnection.removeStream(stream)};TraceablePeerConnection.prototype.createDataChannel=function(label,opts){this.trace("createDataChannel",label,opts);return this.peerconnection.createDataChannel(label,opts)};TraceablePeerConnection.prototype.setLocalDescription=function(description,successCallback,failureCallback){var self=this;this.trace("setLocalDescription",dumpSDP(description));this.peerconnection.setLocalDescription(description,function(){self.trace("setLocalDescriptionOnSuccess");successCallback()},function(err){self.trace("setLocalDescriptionOnFailure",err);failureCallback(err)})};TraceablePeerConnection.prototype.setRemoteDescription=function(description,successCallback,failureCallback){var self=this;this.trace("setRemoteDescription",dumpSDP(description));this.peerconnection.setRemoteDescription(description,function(){self.trace("setRemoteDescriptionOnSuccess");successCallback()},function(err){self.trace("setRemoteDescriptionOnFailure",err);failureCallback(err)})};TraceablePeerConnection.prototype.close=function(){this.trace("stop");if(this.statsinterval!==null){window.clearInterval(this.statsinterval);this.statsinterval=null}if(this.peerconnection.signalingState!="closed"){this.peerconnection.close()}};TraceablePeerConnection.prototype.createOffer=function(successCallback,failureCallback,constraints){var self=this;this.trace("createOffer",constraints);this.peerconnection.createOffer(function(offer){self.trace("createOfferOnSuccess",dumpSDP(offer));successCallback(offer)},function(err){self.trace("createOfferOnFailure",err);failureCallback(err)},constraints)};TraceablePeerConnection.prototype.createAnswer=function(successCallback,failureCallback,constraints){var self=this;this.trace("createAnswer",constraints);this.peerconnection.createAnswer(function(answer){self.trace("createAnswerOnSuccess",dumpSDP(answer));successCallback(answer)},function(err){self.trace("createAnswerOnFailure",err);failureCallback(err)},constraints)};TraceablePeerConnection.prototype.addIceCandidate=function(candidate,successCallback,failureCallback){var self=this;this.trace("addIceCandidate",candidate);this.peerconnection.addIceCandidate(candidate,function(){if(successCallback)successCallback()},function(err){self.trace("addIceCandidateOnFailure",err);if(failureCallback)failureCallback(err)})};TraceablePeerConnection.prototype.getStats=function(callback,errback){if(navigator.mozGetUserMedia){this.peerconnection.getStats(null,callback,errback)}else{this.peerconnection.getStats(callback)}};module.exports=TraceablePeerConnection},{util:165,webrtcsupport:405,wildemitter:449}],395:[function(require,module,exports){var _=require("underscore");var util=require("util");var webrtc=require("webrtcsupport");var SJJ=require("sdp-jingle-json");var WildEmitter=require("wildemitter");var peerconn=require("traceablepeerconnection");function PeerConnection(config,constraints){var self=this;var item;WildEmitter.call(this);config=config||{};config.iceServers=config.iceServers||[];this.enableChromeNativeSimulcast=false;if(constraints&&constraints.optional&&webrtc.prefix==="webkit"&&navigator.appVersion.match(/Chromium\//)===null){constraints.optional.forEach(function(constraint,idx){if(constraint.enableChromeNativeSimulcast){self.enableChromeNativeSimulcast=true}})}this.enableMultiStreamHacks=false;if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint,idx){if(constraint.enableMultiStreamHacks){self.enableMultiStreamHacks=true}})}this.restrictBandwidth=0;if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint,idx){if(constraint.andyetRestrictBandwidth){self.restrictBandwidth=constraint.andyetRestrictBandwidth}})}this.batchIceCandidates=0;if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint,idx){if(constraint.andyetBatchIce){self.batchIceCandidates=constraint.andyetBatchIce}})}this.batchedIceCandidates=[];this.pc=new peerconn(config,constraints);this.getLocalStreams=this.pc.getLocalStreams.bind(this.pc);this.getRemoteStreams=this.pc.getRemoteStreams.bind(this.pc);this.addStream=this.pc.addStream.bind(this.pc);this.removeStream=this.pc.removeStream.bind(this.pc);this.pc.on("*",function(){self.emit.apply(self,arguments)});this.pc.onremovestream=this.emit.bind(this,"removeStream");this.pc.onaddstream=this.emit.bind(this,"addStream");this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded");this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange");this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange");this.pc.onicecandidate=this._onIce.bind(this);this.pc.ondatachannel=this._onDataChannel.bind(this);this.localDescription={contents:[]};this.remoteDescription={contents:[]};this.config={debug:false,ice:{},sid:"",isInitiator:true,sdpSessionID:Date.now(),useJingle:false};for(item in config){this.config[item]=config[item]}if(this.config.debug){this.on("*",function(eventName,event){var logger=config.logger||console;logger.log("PeerConnection event:",arguments)})}this.hadLocalStunCandidate=false;this.hadRemoteStunCandidate=false;this.hadLocalRelayCandidate=false;this.hadRemoteRelayCandidate=false;this.hadLocalIPv6Candidate=false;this.hadRemoteIPv6Candidate=false;this._remoteDataChannels=[];this._localDataChannels=[]}util.inherits(PeerConnection,WildEmitter);Object.defineProperty(PeerConnection.prototype,"signalingState",{get:function(){return this.pc.signalingState}});Object.defineProperty(PeerConnection.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}});PeerConnection.prototype._role=function(){return this.isInitiator?"initiator":"responder"};PeerConnection.prototype.addStream=function(stream){this.localStream=stream;this.pc.addStream(stream)};PeerConnection.prototype._checkLocalCandidate=function(candidate){var cand=SJJ.toCandidateJSON(candidate);if(cand.type=="srflx"){this.hadLocalStunCandidate=true}else if(cand.type=="relay"){this.hadLocalRelayCandidate=true}if(cand.ip.indexOf(":")!=-1){this.hadLocalIPv6Candidate=true}};PeerConnection.prototype._checkRemoteCandidate=function(candidate){var cand=SJJ.toCandidateJSON(candidate);if(cand.type=="srflx"){this.hadRemoteStunCandidate=true}else if(cand.type=="relay"){this.hadRemoteRelayCandidate=true}if(cand.ip.indexOf(":")!=-1){this.hadRemoteIPv6Candidate=true}};PeerConnection.prototype.processIce=function(update,cb){cb=cb||function(){};var self=this;if(this.pc.signalingState==="closed")return cb();if(update.contents||update.jingle&&update.jingle.contents){var contentNames=_.pluck(this.remoteDescription.contents,"name");var contents=update.contents||update.jingle.contents;contents.forEach(function(content){var transport=content.transport||{};var candidates=transport.candidates||[];var mline=contentNames.indexOf(content.name);var mid=content.name;candidates.forEach(function(candidate){var iceCandidate=SJJ.toCandidateSDP(candidate)+"\r\n";self.pc.addIceCandidate(new webrtc.IceCandidate({candidate:iceCandidate,sdpMLineIndex:mline,sdpMid:mid}),function(){},function(err){self.emit("error",err)});self._checkRemoteCandidate(iceCandidate)})})}else{if(update.candidate&&update.candidate.candidate.indexOf("a=")!==0){update.candidate.candidate="a="+update.candidate.candidate}self.pc.addIceCandidate(new webrtc.IceCandidate(update.candidate),function(){},function(err){self.emit("error",err)});self._checkRemoteCandidate(update.candidate.candidate)}cb()};PeerConnection.prototype.offer=function(constraints,cb){var self=this;var hasConstraints=arguments.length===2;var mediaConstraints=hasConstraints?constraints:{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true}};cb=hasConstraints?cb:constraints;cb=cb||function(){};if(this.pc.signalingState==="closed")return cb("Already closed");this.pc.createOffer(function(offer){self.pc.setLocalDescription(offer,function(){var jingle;var expandedOffer={type:"offer",sdp:offer.sdp};if(self.config.useJingle){jingle=SJJ.toSessionJSON(offer.sdp,{role:self._role(),direction:"outgoing"});jingle.sid=self.config.sid;self.localDescription=jingle;_.each(jingle.contents,function(content){var transport=content.transport||{};if(transport.ufrag){self.config.ice[content.name]={ufrag:transport.ufrag,pwd:transport.pwd}}});expandedOffer.jingle=jingle}expandedOffer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkLocalCandidate(line)}});self.emit("offer",expandedOffer);cb(null,expandedOffer)},function(err){self.emit("error",err);cb(err)})},function(err){self.emit("error",err);cb(err)},mediaConstraints)};PeerConnection.prototype.handleOffer=function(offer,cb){cb=cb||function(){};var self=this;offer.type="offer";if(offer.jingle){if(this.enableChromeNativeSimulcast){offer.jingle.contents.forEach(function(content){if(content.name==="video"){content.description.googConferenceFlag=true}})}offer.sdp=SJJ.toSessionSDP(offer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"incoming"});self.remoteDescription=offer.jingle}offer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkRemoteCandidate(line)}});self.pc.setRemoteDescription(new webrtc.SessionDescription(offer),function(){cb()},cb)};PeerConnection.prototype.answerAudioOnly=function(cb){var mediaConstraints={mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:false}};this._answer(mediaConstraints,cb)};PeerConnection.prototype.answerBroadcastOnly=function(cb){var mediaConstraints={mandatory:{OfferToReceiveAudio:false,OfferToReceiveVideo:false}};this._answer(mediaConstraints,cb)};PeerConnection.prototype.answer=function(constraints,cb){var self=this;var hasConstraints=arguments.length===2;var callback=hasConstraints?cb:constraints;var mediaConstraints=hasConstraints?constraints:{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true}};this._answer(mediaConstraints,callback)};PeerConnection.prototype.handleAnswer=function(answer,cb){cb=cb||function(){};var self=this;if(answer.jingle){answer.sdp=SJJ.toSessionSDP(answer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"incoming"});self.remoteDescription=answer.jingle}answer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkRemoteCandidate(line)}});self.pc.setRemoteDescription(new webrtc.SessionDescription(answer),function(){cb(null)},cb)};PeerConnection.prototype.close=function(){this.pc.close();this._localDataChannels=[];this._remoteDataChannels=[];this.emit("close")};PeerConnection.prototype._answer=function(constraints,cb){cb=cb||function(){};var self=this;if(!this.pc.remoteDescription){throw new Error("remoteDescription not set")}if(this.pc.signalingState==="closed")return cb("Already closed");self.pc.createAnswer(function(answer){var sim=[];var rtx=[];if(self.enableChromeNativeSimulcast){answer.jingle=SJJ.toSessionJSON(answer.sdp,{role:self._role(),direction:"outgoing"});if(answer.jingle.contents.length>=2&&answer.jingle.contents[1].name==="video"){var hasSimgroup=false;var groups=answer.jingle.contents[1].description.sourceGroups||[];var hasSim=false;groups.forEach(function(group){if(group.semantics=="SIM")hasSim=true});if(!hasSim&&answer.jingle.contents[1].description.sources.length){var newssrc=JSON.parse(JSON.stringify(answer.jingle.contents[1].description.sources[0]));newssrc.ssrc=""+Math.floor(Math.random()*4294967295);answer.jingle.contents[1].description.sources.push(newssrc);sim.push(answer.jingle.contents[1].description.sources[0].ssrc);sim.push(newssrc.ssrc);groups.push({semantics:"SIM",sources:sim});var rtxssrc=JSON.parse(JSON.stringify(newssrc));rtxssrc.ssrc=""+Math.floor(Math.random()*4294967295);answer.jingle.contents[1].description.sources.push(rtxssrc);groups.push({semantics:"FID",sources:[newssrc.ssrc,rtxssrc.ssrc]});answer.jingle.contents[1].description.sourceGroups=groups;answer.sdp=SJJ.toSessionSDP(answer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"outgoing"})}}}if(self.restrictBandwidth>0){answer.jingle=SJJ.toSessionJSON(answer.sdp,{role:self._role(),direction:"outgoing"});if(answer.jingle.contents.length>=2&&answer.jingle.contents[1].name==="video"){var content=answer.jingle.contents[1];var hasBw=content.description&&content.description.bandwidth;if(!hasBw){answer.jingle.contents[1].description.bandwidth={type:"AS",bandwidth:self.restrictBandwidth.toString()};answer.sdp=SJJ.toSessionSDP(answer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"outgoing"})}}}self.pc.setLocalDescription(answer,function(){var expandedAnswer={type:"answer",sdp:answer.sdp};if(self.config.useJingle){var jingle=SJJ.toSessionJSON(answer.sdp,{role:self._role(),direction:"outgoing"});jingle.sid=self.config.sid;self.localDescription=jingle;expandedAnswer.jingle=jingle}if(self.enableChromeNativeSimulcast){if(!expandedAnswer.jingle){expandedAnswer.jingle=SJJ.toSessionJSON(answer.sdp,{role:self._role(),direction:"outgoing"})}var groups=expandedAnswer.jingle.contents[1].description.sourceGroups||[];expandedAnswer.jingle.contents[1].description.sources.forEach(function(source,idx){source.parameters=source.parameters.map(function(parameter){if(parameter.key==="msid"){parameter.value+="-"+Math.floor(idx/2)}return parameter})});expandedAnswer.sdp=SJJ.toSessionSDP(expandedAnswer.jingle,{sid:self.sdpSessionID,role:self._role(),direction:"outgoing"})}expandedAnswer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkLocalCandidate(line)}});self.emit("answer",expandedAnswer);cb(null,expandedAnswer)},function(err){self.emit("error",err);cb(err)})},function(err){self.emit("error",err);cb(err)},constraints)};PeerConnection.prototype._onIce=function(event){var self=this;if(event.candidate){var ice=event.candidate;var expandedCandidate={candidate:event.candidate};this._checkLocalCandidate(ice.candidate);var cand=SJJ.toCandidateJSON(ice.candidate);if(self.config.useJingle){if(!ice.sdpMid){ice.sdpMid=self.localDescription.contents[ice.sdpMLineIndex].name}if(!self.config.ice[ice.sdpMid]){var jingle=SJJ.toSessionJSON(self.pc.localDescription.sdp,{role:self._role(),direction:"outgoing"});_.each(jingle.contents,function(content){var transport=content.transport||{};if(transport.ufrag){self.config.ice[content.name]={ufrag:transport.ufrag,pwd:transport.pwd}}})}expandedCandidate.jingle={contents:[{name:ice.sdpMid,creator:self._role(),transport:{transType:"iceUdp",ufrag:self.config.ice[ice.sdpMid].ufrag,pwd:self.config.ice[ice.sdpMid].pwd,candidates:[cand]}}]};if(self.batchIceCandidates>0){if(self.batchedIceCandidates.length===0){window.setTimeout(function(){var contents={};self.batchedIceCandidates.forEach(function(content){content=content.contents[0];if(!contents[content.name])contents[content.name]=content;contents[content.name].transport.candidates.push(content.transport.candidates[0])});var newCand={jingle:{contents:[]}};Object.keys(contents).forEach(function(name){newCand.jingle.contents.push(contents[name])});self.batchedIceCandidates=[];self.emit("ice",newCand)},self.batchIceCandidates)}self.batchedIceCandidates.push(expandedCandidate.jingle);return}}this.emit("ice",expandedCandidate)}else{this.emit("endOfCandidates")}};PeerConnection.prototype._onDataChannel=function(event){var channel=event.channel;this._remoteDataChannels.push(channel);this.emit("addChannel",channel)};PeerConnection.prototype.createDataChannel=function(name,opts){var channel=this.pc.createDataChannel(name,opts);this._localDataChannels.push(channel);return channel};PeerConnection.prototype.getStats=function(cb){if(webrtc.prefix==="moz"){this.pc.getStats(function(res){var items=[];for(var result in res){if(typeof res[result]==="object"){items.push(res[result])}}cb(null,items)},cb)}else{this.pc.getStats(function(res){var items=[];res.result().forEach(function(result){var item={};result.names().forEach(function(name){item[name]=result.stat(name)});item.id=result.id;item.type=result.type;item.timestamp=result.timestamp;items.push(item)});cb(null,items)})}};module.exports=PeerConnection},{"sdp-jingle-json":389,traceablepeerconnection:394,underscore:448,util:165,webrtcsupport:405,wildemitter:449}],396:[function(require,module,exports){var util=require("util");var extend=require("extend-object");var BaseSession=require("jingle-session");var RTCPeerConnection=require("rtcpeerconnection");function filterContentSources(content,stream){delete content.transport;delete content.description.payloads;if(content.description.sources){content.description.sources=content.description.sources.filter(function(source){return stream.id===source.parameters[1].value.split(" ")[0]})}}function filterUnusedLabels(content){var sources=content.description.sources||[];sources.forEach(function(source){source.parameters=source.parameters.filter(function(parameter){return!(parameter.key==="mslabel"||parameter.key==="label")})})}function MediaSession(opts){BaseSession.call(this,opts);this.pc=new RTCPeerConnection({iceServers:opts.iceServers||[],useJingle:true},opts.constraints||{});this.pc.on("ice",this.onIceCandidate.bind(this));this.pc.on("iceConnectionStateChange",this.onIceStateChange.bind(this));this.pc.on("addStream",this.onAddStream.bind(this));this.pc.on("removeStream",this.onRemoveStream.bind(this));this._ringing=false}util.inherits(MediaSession,BaseSession);Object.defineProperties(MediaSession.prototype,{ringing:{get:function(){return this._ringing},set:function(value){if(value!==this._ringing){this._ringing=value;this.emit("change:ringing",value)}}},streams:{get:function(){return this.pc.getRemoteStreams()}}});MediaSession.prototype=extend(MediaSession.prototype,{start:function(constraints,next){var self=this;this.state="pending";next=next||function(){};this.pc.isInitiator=true;this.pc.offer(constraints,function(err,offer){if(err){self._log("error","Could not create WebRTC offer",err);return self.end("failed-application",true)}if(constraints&&constraints.mandatory){offer.jingle.contents.forEach(function(content){var mediaType=content.description.media;if(!content.description||content.description.descType!=="rtp"){return}if(!constraints.mandatory.OfferToReceiveAudio&&mediaType==="audio"){content.senders="initiator"}if(!constraints.mandatory.OfferToReceiveVideo&&mediaType==="video"){content.senders="initiator"}})}offer.jingle.contents.forEach(filterUnusedLabels);self.send("session-initiate",offer.jingle);next()})},accept:function(next){var self=this;next=next||function(){};this._log("info","Accepted incoming session");this.state="active";this.pc.answer(function(err,answer){if(err){self._log("error","Could not create WebRTC answer",err);return self.end("failed-application")}answer.jingle.contents.forEach(filterUnusedLabels);self.send("session-accept",answer.jingle);next()})},end:function(reason,silent){var self=this;this.pc.close();this.streams.forEach(function(stream){self.onRemoveStream({stream:stream})});BaseSession.prototype.end.call(this,reason,silent)},ring:function(){this._log("info","Ringing on incoming session");this.ringing=true;this.send("session-info",{ringing:true})},mute:function(creator,name){this._log("info","Muting",name);this.send("session-info",{mute:{creator:creator,name:name}})},unmute:function(creator,name){this._log("info","Unmuting",name);this.send("session-info",{unmute:{creator:creator,name:name}})},hold:function(){this._log("info","Placing on hold");this.send("session-info",{hold:true})},resume:function(){this._log("info","Resuming from hold");this.send("session-info",{active:true})},addStream:function(stream,renegotiate,cb){var self=this;cb=cb||function(){};this.pc.addStream(stream);if(!renegotiate){return}this.pc.handleOffer({type:"offer",jingle:this.pc.remoteDescription},function(err){if(err){self._log("error","Could not create offer for adding new stream");return cb(err)}self.pc.answer(function(err,answer){if(err){self._log("error","Could not create answer for adding new stream");return cb(err)}answer.jingle.contents.forEach(function(content){filterContentSources(content,stream)});self.send("source-add",answer.jingle);cb()})})},addStream2:function(stream,cb){this.addStream(stream,true,cb)},removeStream:function(stream,renegotiate,cb){var self=this;cb=cb||function(){};if(!renegotiate){this.pc.removeStream(stream);return}var desc=this.pc.localDescription;desc.contents.forEach(function(content){filterContentSources(content,stream)});this.send("source-remove",desc);this.pc.removeStream(stream);this.pc.handleOffer({type:"offer",jingle:this.pc.remoteDescription},function(err){if(err){self._log("error","Could not process offer for removing stream");return cb(err)}self.pc.answer(function(err){if(err){self._log("error","Could not process answer for removing stream");return cb(err)}cb()})})},removeStream2:function(stream,cb){this.removeStream(stream,true,cb)},switchStream:function(oldStream,newStream,cb){var self=this;cb=cb||function(){};var desc=this.pc.localDescription;desc.contents.forEach(function(content){delete content.transport;delete content.description.payloads});this.pc.removeStream(oldStream);this.send("source-remove",desc);var audioTracks=oldStream.getAudioTracks();if(audioTracks.length){newStream.addTrack(audioTracks[0])}this.pc.addStream(newStream);this.pc.handleOffer({type:"offer",jingle:this.pc.remoteDescription},function(err){if(err){self._log("error","Could not process offer for switching streams");return cb(err)}self.pc.answer(function(err,answer){if(err){self._log("error","Could not process answer for switching streams");return cb(err)}answer.jingle.contents.forEach(function(content){delete content.transport;delete content.description.payloads});self.send("source-add",answer.jingle);cb()})})},onIceCandidate:function(candidate){this._log("info","Discovered new ICE candidate",candidate.jingle);this.send("transport-info",candidate.jingle)},onIceStateChange:function(){switch(this.pc.iceConnectionState){case"checking":this.connectionState="connecting";break;case"completed":case"connected":this.connectionState="connected";break;case"disconnected":if(this.pc.signalingState==="stable"){this.connectionState="interrupted"}else{this.connectionState="disconnected"}break;case"failed":this.connectionState="failed";this.end("failed-transport");break;case"closed":this.connectionState="disconnected";break}},onAddStream:function(event){this._log("info","Stream added");this.emit("peerStreamAdded",this,event.stream)},onRemoveStream:function(event){this._log("info","Stream removed");this.emit("peerStreamRemoved",this,event.stream)},onSessionInitiate:function(changes,cb){var self=this;this._log("info","Initiating incoming session");this.state="pending";this.pc.isInitiator=false;this.pc.handleOffer({type:"offer",jingle:changes},function(err){if(err){self._log("error","Could not create WebRTC answer");return cb({condition:"general-error"})}cb()})},onSessionAccept:function(changes,cb){var self=this;this.state="active";this.pc.handleAnswer({type:"answer",jingle:changes},function(err){if(err){self._log("error","Could not process WebRTC answer");return cb({condition:"general-error"})}self.emit("accepted",self);cb()})},onSessionTerminate:function(changes,cb){var self=this;this._log("info","Terminating session");this.pc.close();this.streams.forEach(function(stream){self.onRemoveStream({stream:stream})});BaseSession.prototype.end.call(this,changes.reason,true);cb()},onSessionInfo:function(info,cb){if(info.ringing){this._log("info","Outgoing session is ringing");this.ringing=true;this.emit("ringing",this);return cb()}if(info.hold){this._log("info","On hold");this.emit("hold",this);return cb()}if(info.active){this._log("info","Resuming from hold");this.emit("resumed",this);return cb()}if(info.mute){this._log("info","Muting",info.mute);this.emit("mute",this,info.mute);return cb()}if(info.unmute){this._log("info","Unmuting",info.unmute);this.emit("unmute",this,info.unmute);return cb()}cb()},onTransportInfo:function(changes,cb){this.pc.processIce(changes,function(){cb()})},onSourceAdd:function(changes,cb){var self=this;this._log("info","Adding new stream source");var newDesc=this.pc.remoteDescription;this.pc.remoteDescription.contents.forEach(function(content,idx){var desc=content.description;var ssrcs=desc.sources||[];var groups=desc.sourceGroups||[];changes.contents.forEach(function(newContent){if(content.name!==newContent.name){return}var newContentDesc=newContent.description;var newSSRCs=newContentDesc.sources||[];ssrcs=ssrcs.concat(newSSRCs);newDesc.contents[idx].description.sources=JSON.parse(JSON.stringify(ssrcs));var newGroups=newContentDesc.sourceGroups||[];groups=groups.concat(newGroups);newDesc.contents[idx].description.sourceGroups=JSON.parse(JSON.stringify(groups))})});this.pc.handleOffer({type:"offer",jingle:newDesc},function(err){if(err){self._log("error","Error adding new stream source");return cb({condition:"general-error"})}self.pc.answer(function(err){if(err){self._log("error","Error adding new stream source");return cb({condition:"general-error"})}cb()})})},onSourceRemove:function(changes,cb){var self=this;this._log("info","Removing stream source");var newDesc=this.pc.remoteDescription;this.pc.remoteDescription.contents.forEach(function(content,idx){var desc=content.description;var ssrcs=desc.sources||[];var groups=desc.sourceGroups||[];changes.contents.forEach(function(newContent){if(content.name!==newContent.name){return}var newContentDesc=newContent.description;var newSSRCs=newContentDesc.sources||[];var newGroups=newContentDesc.sourceGroups||[];var found,i,j,k;for(i=0;i<newSSRCs.length;i++){found=-1;for(j=0;j<ssrcs.length;j++){if(newSSRCs[i].ssrc===ssrcs[j].ssrc){found=j;break}}if(found>-1){ssrcs.splice(found,1);newDesc.contents[idx].description.sources=JSON.parse(JSON.stringify(ssrcs))}}for(i=0;i<newGroups.length;i++){found=-1;for(j=0;i<groups.length;j++){if(newGroups[i].semantics===groups[j].semantics&&newGroups[i].sources.length===groups[j].sources.length){var same=true;for(k=0;k<newGroups[i].sources.length;k++){if(newGroups[i].sources[k]!==groups[j].sources[k]){same=false;break}}if(same){found=j;break}}}if(found>-1){groups.splice(found,1);newDesc.contents[idx].description.sourceGroups=JSON.parse(JSON.stringify(groups))}}})});this.pc.handleOffer({type:"offer",jingle:newDesc},function(err){if(err){self._log("error","Error removing stream source");return cb({condition:"general-error"})}self.pc.answer(function(err){if(err){self._log("error","Error removing stream source");return cb({condition:"general-error"})}cb()})})}});module.exports=MediaSession},{"extend-object":385,"jingle-session":404,rtcpeerconnection:403,util:165}],397:[function(require,module,exports){module.exports=require(389)},{"./lib/tojson":400,"./lib/tosdp":401,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/index.js":389}],398:[function(require,module,exports){module.exports=require(390)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/parsers.js":390}],399:[function(require,module,exports){module.exports=require(391)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/senders.js":391}],400:[function(require,module,exports){module.exports=require(392)},{"./parsers":398,"./senders":399,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/tojson.js":392}],401:[function(require,module,exports){module.exports=require(393)},{"./senders":399,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/tosdp.js":393}],402:[function(require,module,exports){module.exports=require(394)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/traceablepeerconnection/index.js":394,util:165,webrtcsupport:405,wildemitter:449}],403:[function(require,module,exports){module.exports=require(395)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/rtcpeerconnection.js":395,"sdp-jingle-json":397,traceablepeerconnection:402,underscore:448,util:165,webrtcsupport:405,wildemitter:449}],404:[function(require,module,exports){var util=require("util");var async=require("async");var extend=require("extend-object");var WildEmitter=require("wildemitter");var ACTIONS={"content-accept":"onContentAccept","content-add":"onContentAdd","content-modify":"onConentModify","content-reject":"onContentReject","content-remove":"onContentRemove","description-info":"onDescriptionInfo","security-info":"onSecurityInfo","session-accept":"onSessionAccept","session-info":"onSessionInfo","session-initiate":"onSessionInitiate","session-terminate":"onSessionTerminate","transport-accept":"onTransportAccept","transport-info":"onTransportInfo","transport-reject":"onTransportReject","transport-replace":"onTransportReplace","source-add":"onSourceAdd","source-remove":"onSourceRemove"};function JingleSession(opts){WildEmitter.call(this);var self=this;this.sid=opts.sid||Date.now().toString();this.peer=opts.peer;this.peerID=opts.peerID||this.peer.full||this.peer;this.isInitiator=opts.initiator||false;this.parent=opts.parent;this.state="starting";this.connectionState="starting";this.pendingDescriptionTypes=opts.descriptionTypes||[];this.pendingAction=false;this.processingQueue=async.queue(function(task,next){if(self.ended){return next()}var action=task.action;var changes=task.changes;
var cb=task.cb;self._log("debug",action);if(!ACTIONS[action]){self._log("error","Invalid action: "+action);cb({condition:"bad-request"});return next()}self[ACTIONS[action]](changes,function(err,result){cb(err,result);return next()})})}util.inherits(JingleSession,WildEmitter);Object.keys(ACTIONS).forEach(function(action){var method=ACTIONS[action];JingleSession.prototype[method]=function(changes,cb){this._log("error","Unsupported action: "+action);cb()}});Object.defineProperties(JingleSession.prototype,{state:{get:function(){return this._sessionState},set:function(value){if(value!==this._sessionState){var prev=this._sessionState;this._log("info","Changing session state to: "+value);this._sessionState=value;this.emit("change:sessionState",this,value);this.emit("change:"+value,this,true);if(prev){this.emit("change:"+prev,this,false)}}}},connectionState:{get:function(){return this._connectionState},set:function(value){if(value!==this._connectionState){var prev=this._connectionState;this._log("info","Changing connection state to: "+value);this._connectionState=value;this.emit("change:connectionState",this,value);this.emit("change:"+value,this,true);if(prev){this.emit("change:"+prev,this,false)}}}},starting:{get:function(){return this._sessionState==="starting"}},pending:{get:function(){return this._sessionState==="pending"}},active:{get:function(){return this._sessionState==="active"}},ended:{get:function(){return this._sessionState==="ended"}},connected:{get:function(){return this._connectionState==="connected"}},connecting:{get:function(){return this._connectionState==="connecting"}},disconnected:{get:function(){return this._connectionState==="disconnected"}},interrupted:{get:function(){return this._connectionState==="interrupted"}}});JingleSession.prototype=extend(JingleSession.prototype,{_log:function(level,message){message=this.sid+": "+message;this.emit("log:"+level,message)},send:function(action,data){data=data||{};data.sid=this.sid;data.action=action;var requirePending={"session-inititate":true,"session-accept":true,"content-add":true,"content-remove":true,"content-reject":true,"content-accept":true,"content-modify":true,"transport-replace":true,"transport-reject":true,"transport-accept":true,"source-add":true,"source-remove":true};if(requirePending[action]){this.pendingAction=action}else{this.pendingAction=false}this.emit("send",{to:this.peer,type:"set",jingle:data})},process:function(action,changes,cb){this.processingQueue.push({action:action,changes:changes,cb:cb})},start:function(){this._log("error","Can not start base sessions");this.end("unsupported-applications",true)},accept:function(){this._log("error","Can not accept base sessions");this.end("unsupported-applications")},cancel:function(){this.end("cancel")},decline:function(){this.end("decline")},end:function(reason,silent){this.state="ended";this.processingQueue.kill();if(!reason){reason="success"}if(typeof reason==="string"){reason={condition:reason}}if(!silent){this.send("session-terminate",{reason:reason})}this.emit("terminated",this,reason)},onSessionTerminate:function(changes,cb){this.end(changes.reason,true);cb()},onSessionInfo:function(changes,cb){var okKeys={sid:true,action:true,initiator:true,responder:true};var unknownPayload=false;Object.keys(changes).forEach(function(key){if(!okKeys[key]){unknownPayload=true}});if(unknownPayload){cb({type:"modify",condition:"feature-not-implemented",jingleCondition:"unsupported-info"})}else{cb()}},onDescriptionInfo:function(changes,cb){cb({type:"modify",condition:"feature-not-implemented",jingleCondition:"unsupported-info"})},onTransportInfo:function(changes,cb){cb({type:"modify",condition:"feature-not-implemented",jingleCondition:"unsupported-info"})},onContentAdd:function(changes,cb){cb();this.send("content-reject",{reason:{condition:"failed-application",text:"content-add is not supported"}})},onTransportReplace:function(changes,cb){cb();this.send("transport-reject",{reason:{condition:"failed-application",text:"transport-replace is not supported"}})}});module.exports=JingleSession},{async:362,"extend-object":385,util:165,wildemitter:449}],405:[function(require,module,exports){var prefix;if(window.mozRTCPeerConnection||navigator.mozGetUserMedia){prefix="moz"}else if(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia){prefix="webkit"}var PC=window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var IceCandidate=window.mozRTCIceCandidate||window.RTCIceCandidate;var SessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription;var MediaStream=window.webkitMediaStream||window.MediaStream;var screenSharing=window.location.protocol==="https:"&&(window.navigator.userAgent.match("Chrome")&&parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10)>=26||window.navigator.userAgent.match("Firefox")&&parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)>=33);var AudioContext=window.AudioContext||window.webkitAudioContext;var supportVp8=document.createElement("video").canPlayType('video/webm; codecs="vp8", vorbis')==="probably";var getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;module.exports={support:!!PC&&supportVp8&&!!getUserMedia,supportRTCPeerConnection:!!PC,supportVp8:supportVp8,supportGetUserMedia:!!getUserMedia,supportDataChannel:!!(PC&&PC.prototype&&PC.prototype.createDataChannel),supportWebAudio:!!(AudioContext&&AudioContext.prototype.createMediaStreamSource),supportMediaStream:!!(MediaStream&&MediaStream.prototype.removeTrack),supportScreenSharing:!!screenSharing,prefix:prefix,AudioContext:AudioContext,PeerConnection:PC,SessionDescription:SessionDescription,IceCandidate:IceCandidate,MediaStream:MediaStream,getUserMedia:getUserMedia}},{}],406:[function(require,module,exports){"use strict";var JID=require("xmpp-jid").JID;module.exports=function(JXT){var types=JXT.utils;JXT.withIq=function(cb){this.withDefinition("iq","jabber:client",cb);this.withDefinition("iq","jabber:component:accept",cb)};JXT.withMessage=function(cb){this.withDefinition("message","jabber:client",cb);this.withDefinition("message","jabber:component:accept",cb)};JXT.withPresence=function(cb){this.withDefinition("presence","jabber:client",cb);this.withDefinition("presence","jabber:component:accept",cb)};JXT.withStreamFeatures=function(cb){this.withDefinition("features","http://etherx.jabber.org/streams",cb)};JXT.withStanzaError=function(cb){this.withDefinition("error","jabber:client",cb);this.withDefinition("error","jabber:component:accept",cb)};JXT.withDataForm=function(cb){this.withDefinition("x","jabber:x:data",cb)};JXT.withPubsubItem=function(cb){this.withDefinition("item","http://jabber.org/protocol/pubsub",cb);this.withDefinition("item","http://jabber.org/protocol/pubsub#event",cb)};JXT.getMessage=function(){return this.getDefinition("message","jabber:client")};JXT.getPresence=function(){return this.getDefinition("presence","jabber:client")};JXT.getIq=function(){return this.getDefinition("iq","jabber:client")};JXT.getStreamError=function(){return this.getDefinition("error","http://etherx.jabber.org/streams")};JXT.getComponentMessage=function(){return this.getDefinition("message","jabber:component:accept")};JXT.getComponentPresence=function(){return this.getDefinition("presence","jabber:component:accept")};JXT.getComponentIq=function(){return this.getDefinition("iq","jabber:component:accept")};JXT.utils.jidAttribute=function(attr,prepped){return{get:function(){var jid=new JID(types.getAttribute(this.xml,attr));if(prepped){jid.prepped=true}return jid},set:function(value){types.setAttribute(this.xml,attr,(value||"").toString())}}};JXT.utils.jidSub=function(NS,sub,prepped){return{get:function(){var jid=new JID(types.getSubText(this.xml,NS,sub));if(prepped){jid.prepped=true}return jid},set:function(value){types.setSubText(this.xml,NS,sub,(value||"").toString())}}};JXT.utils.tzoSub=types.field(function(xml,NS,sub,defaultVal){var split,hrs,min;var sign=-1;var formatted=types.getSubText(xml,NS,sub);if(!formatted){return defaultVal}if(formatted.charAt(0)==="-"){sign=1;formatted=formatted.slice(1)}split=formatted.split(":");hrs=parseInt(split[0],10);min=parseInt(split[1],10);return(hrs*60+min)*sign},function(xml,NS,sub,value){var hrs,min;var formatted="-";if(typeof value==="number"){if(value<0){value=-value;formatted="+"}hrs=value/60;min=value%60;formatted+=(hrs<10?"0":"")+hrs+":"+(min<10?"0":"")+min}else{formatted=value}types.setSubText(xml,NS,sub,formatted)})}},{"xmpp-jid":450}],407:[function(require,module,exports){"use strict";var ltx=require("ltx");var extend=require("extend-object");var uuid=require("node-uuid");var types=require("./lib/types");var helpers=require("./lib/helpers");var stanzaConstructor=require("./lib/stanza");function JXT(){this._LOOKUP={};this._LOOKUP_EXT={};this._TAGS={};this._CB_DEFINITION={};this._CB_TAG={};this._ID=uuid.v4();this.utils=extend({},types,helpers)}JXT.prototype.use=function(init){if(!init["__JXT_LOADED_"+this._ID]){init(this)}init["__JXT_LOADED_"+this._ID]=true;return this};JXT.prototype.getDefinition=function(el,ns,required){var JXTClass=this._LOOKUP[ns+"|"+el];if(required&&!JXTClass){throw new Error("Could not find definition for <"+el+' xmlns="'+ns+'" />')}return JXTClass};JXT.prototype.getExtensions=function(el,ns){return this._LOOKUP_EXT[ns+"|"+el]||{}};JXT.prototype.withDefinition=function(el,ns,cb){var name=ns+"|"+el;if(!this._CB_DEFINITION[name]){this._CB_DEFINITION[name]=[]}this._CB_DEFINITION[name].push(cb);if(this._LOOKUP[name]){cb(this._LOOKUP[name])}};JXT.prototype.withTag=function(tag,cb){if(!this._CB_TAG[tag]){this._CB_TAG[tag]=[]}this._CB_TAG[tag].push(cb);this.tagged(tag).forEach(function(stanza){cb(stanza)})};JXT.prototype.tagged=function(tag){return this._TAGS[tag]||[]};JXT.prototype.build=function(xml){var JXTClass=this._LOOKUP[xml.namespaceURI+"|"+xml.localName];if(JXTClass){return new JXTClass(null,xml)}};JXT.prototype.parse=function(str){var xml=ltx.parse(str);if(xml.nodeType!==1){return}var JXTClass=this.getDefinition(xml.localName,xml.namespaceURI);if(JXTClass){return new JXTClass(null,xml)}};JXT.prototype.extend=function(ParentJXT,ChildJXT,multiName){var parentName=ParentJXT.prototype._NS+"|"+ParentJXT.prototype._EL;var name=ChildJXT.prototype._name;var qName=ChildJXT.prototype._NS+"|"+ChildJXT.prototype._EL;this._LOOKUP[qName]=ChildJXT;if(!this._LOOKUP_EXT[qName]){this._LOOKUP_EXT[qName]={}}if(!this._LOOKUP_EXT[parentName]){this._LOOKUP_EXT[parentName]={}}this._LOOKUP_EXT[parentName][name]=ChildJXT;this.add(ParentJXT,name,types.extension(ChildJXT));if(multiName){this.add(ParentJXT,multiName,types.multiExtension(ChildJXT))}};JXT.prototype.add=function(ParentJXT,fieldName,field){field.enumerable=true;Object.defineProperty(ParentJXT.prototype,fieldName,field)};JXT.prototype.define=function(opts){var self=this;var Stanza=stanzaConstructor(this,opts);var ns=Stanza.prototype._NS;var el=Stanza.prototype._EL;var tags=Stanza.prototype._TAGS;var name=ns+"|"+el;this._LOOKUP[name]=Stanza;tags.forEach(function(tag){if(!self._TAGS[tag]){self._TAGS[tag]=[]}self._TAGS[tag].push(Stanza)});var fieldNames=Object.keys(opts.fields||{});fieldNames.forEach(function(fieldName){self.add(Stanza,fieldName,opts.fields[fieldName])});if(this._CB_DEFINITION[name]){this._CB_DEFINITION[name].forEach(function(handler){handler(Stanza)})}tags.forEach(function(tag){if(self._CB_TAG[tag]){self._CB_TAG[tag].forEach(function(handler){handler(Stanza)})}});return Stanza};JXT.createRegistry=function(){return new JXT};extend(JXT,helpers);extend(JXT,types);var globalJXT=new JXT;JXT.define=globalJXT.define.bind(globalJXT);JXT.extend=globalJXT.extend.bind(globalJXT);JXT.add=globalJXT.add.bind(globalJXT);JXT.parse=globalJXT.parse.bind(globalJXT);JXT.build=globalJXT.build.bind(globalJXT);JXT.getExtensions=globalJXT.getExtensions.bind(globalJXT);JXT.getDefinition=globalJXT.getDefinition.bind(globalJXT);JXT.withDefinition=globalJXT.withDefinition.bind(globalJXT);JXT.withTag=globalJXT.withTag.bind(globalJXT);JXT.tagged=globalJXT.tagged.bind(globalJXT);JXT.getGlobalJXT=function(){return globalJXT};module.exports=JXT},{"./lib/helpers":408,"./lib/stanza":409,"./lib/types":410,"extend-object":413,ltx:416,"node-uuid":420}],408:[function(require,module,exports){"use strict";var ltx=require("ltx");var XML_NS=exports.XML_NS="http://www.w3.org/XML/1998/namespace";exports.createElement=function(NS,name,parentNS){var el=new ltx.Element(name);if(!parentNS||parentNS!==NS){exports.setAttribute(el,"xmlns",NS)}return el};var find=exports.find=function(xml,NS,selector){var results=[];var children=xml.getElementsByTagName(selector);for(var i=0,len=children.length;i<len;i++){var child=children[i];if(child.namespaceURI===NS&&child.parentNode===xml){results.push(child)}}return results};exports.findOrCreate=function(xml,NS,selector){var existing=exports.find(xml,NS,selector);if(existing.length){return existing[0]}else{var created=exports.createElement(NS,selector,xml.namespaceURI);xml.appendChild(created);return created}};exports.getAttribute=function(xml,attr,defaultVal){return xml.getAttribute(attr)||defaultVal||""};exports.getAttributeNS=function(xml,NS,attr,defaultVal){return xml.getAttributeNS(NS,attr)||defaultVal||""};exports.setAttribute=function(xml,attr,value,force){if(value||force){xml.setAttribute(attr,value)}else{xml.removeAttribute(attr)}};exports.setAttributeNS=function(xml,NS,attr,value,force){if(value||force){xml.setAttributeNS(NS,attr,value)}else{xml.removeAttributeNS(NS,attr)}};exports.getBoolAttribute=function(xml,attr,defaultVal){var val=xml.getAttribute(attr)||defaultVal||"";return val==="true"||val==="1"};exports.setBoolAttribute=function(xml,attr,value){if(value){xml.setAttribute(attr,"1")}else{xml.removeAttribute(attr)}};exports.getSubAttribute=function(xml,NS,sub,attr,defaultVal){var subs=find(xml,NS,sub);if(!subs){return""}for(var i=0;i<subs.length;i++){return subs[i].getAttribute(attr)||defaultVal||""}return""};exports.setSubAttribute=function(xml,NS,sub,attr,value){var subs=find(xml,NS,sub);if(!subs.length){if(value){sub=exports.createElement(NS,sub,xml.namespaceURI);sub.setAttribute(attr,value);xml.appendChild(sub)}}else{for(var i=0;i<subs.length;i++){if(value){subs[i].setAttribute(attr,value);return}else{subs[i].removeAttribute(attr)}}}};exports.getBoolSubAttribute=function(xml,NS,sub,attr,defaultVal){var val=xml.getSubAttribute(NS,sub,attr)||defaultVal||"";return val==="true"||val==="1"};exports.setBoolSubAttribute=function(xml,NS,sub,attr,value){value=value?"1":"";exports.setSubAttribute(xml,NS,sub,attr,value)};exports.getText=function(xml){return xml.textContent};exports.setText=function(xml,value){xml.textContent=value};exports.getSubText=exports.getTextSub=function(xml,NS,element,defaultVal){var subs=find(xml,NS,element);defaultVal=defaultVal||"";if(!subs.length){return defaultVal}return subs[0].textContent||defaultVal};exports.setSubText=exports.setTextSub=function(xml,NS,element,value){var subs=find(xml,NS,element);if(subs.length){for(var i=0;i<subs.length;i++){xml.removeChild(subs[i])}}if(value){var sub=exports.createElement(NS,element,xml.namespaceURI);if(value!==true){sub.textContent=value}xml.appendChild(sub)}};exports.getMultiSubText=function(xml,NS,element,extractor){var subs=find(xml,NS,element);var results=[];extractor=extractor||function(sub){return sub.textContent||""};for(var i=0;i<subs.length;i++){results.push(extractor(subs[i]))}return results};exports.setMultiSubText=function(xml,NS,element,value,builder){var subs=find(xml,NS,element);var values=[];builder=builder||function(value){if(value){var sub=exports.createElement(NS,element,xml.namespaceURI);sub.textContent=value;xml.appendChild(sub)}};if(typeof value==="string"){values=(value||"").split("\n")}else{values=value}var i,len;for(i=0,len=subs.length;i<len;i++){xml.removeChild(subs[i])}for(i=0,len=values.length;i<len;i++){builder(values[i])}};exports.getMultiSubAttribute=function(xml,NS,element,attr){return exports.getMultiSubText(xml,NS,element,function(sub){return exports.getAttribute(sub,attr)})};exports.setMultiSubAttribute=function(xml,NS,element,attr,value){exports.setMultiSubText(xml,NS,element,value,function(val){var sub=exports.createElement(NS,element,xml.namespaceURI);exports.setAttribute(sub,attr,val);xml.appendChild(sub)})};exports.getSubLangText=function(xml,NS,element,defaultLang){var subs=find(xml,NS,element);if(!subs.length){return{}}var lang,sub;var results={};var langs=[];for(var i=0;i<subs.length;i++){sub=subs[i];lang=sub.getAttributeNS(XML_NS,"lang")||defaultLang;langs.push(lang);results[lang]=sub.textContent||""}return results};exports.setSubLangText=function(xml,NS,element,value,defaultLang){var sub,lang;var subs=find(xml,NS,element);if(subs.length){for(var i=0;i<subs.length;i++){xml.removeChild(subs[i])}}if(typeof value==="string"){sub=exports.createElement(NS,element,xml.namespaceURI);sub.textContent=value;xml.appendChild(sub)}else if(typeof value==="object"){for(lang in value){if(value.hasOwnProperty(lang)){sub=exports.createElement(NS,element,xml.namespaceURI);if(lang!==defaultLang){sub.setAttributeNS(XML_NS,"lang",lang)}sub.textContent=value[lang];xml.appendChild(sub)}}}};exports.getBoolSub=function(xml,NS,element){var subs=find(xml,NS,element);return!!subs.length};exports.setBoolSub=function(xml,NS,element,value){var subs=find(xml,NS,element);if(!subs.length){if(value){var sub=exports.createElement(NS,element,xml.namespaceURI);xml.appendChild(sub)}}else{for(var i=0;i<subs.length;i++){if(value){return}else{xml.removeChild(subs[i])}}}}},{ltx:416}],409:[function(require,module,exports){"use strict";var helpers=require("./helpers");var extend=require("extend-object");var EXCLUDE={constructor:true,parent:true,prototype:true,toJSON:true,toString:true,xml:true};module.exports=function(JXT,opts){function Stanza(data,xml,parent){var self=this;var parentNode=(xml||{}).parentNode||(parent||{}).xml;var parentNS=(parentNode||{}).namespaceURI;self.xml=xml||helpers.createElement(self._NS,self._EL,parentNS);Object.keys(self._PREFIXES).forEach(function(prefix){var namespace=self._PREFIXES[prefix];self.xml.setAttribute("xmlns:"+prefix,namespace)});self._extensions={};for(var i=0,len=self.xml.childNodes.length;i<len;i++){var child=self.xml.childNodes[i];var ChildJXT=JXT.getDefinition(child.localName,child.namespaceURI);if(ChildJXT!==undefined){var name=ChildJXT.prototype._name;self._extensions[name]=new ChildJXT(null,child);self._extensions[name].parent=self}}extend(self,data);if(opts.init){opts.init.apply(self,[data])}return self}Stanza.prototype._name=opts.name;Stanza.prototype._eventname=opts.eventName;Stanza.prototype._NS=opts.namespace;Stanza.prototype._EL=opts.element||opts.name;Stanza.prototype._PREFIXES=opts.prefixes||{};Stanza.prototype._TAGS=opts.tags||[];Stanza.prototype.toString=function(){return this.xml.toString()};Stanza.prototype.toJSON=function(){var prop;var result={};for(prop in this._extensions){if(this._extensions[prop].toJSON&&prop[0]!=="_"){result[prop]=this._extensions[prop].toJSON()}}for(prop in this){var allowedName=!EXCLUDE[prop]&&prop[0]!=="_";var isExtensionName=JXT.getExtensions(this._EL,this._NS)[prop];if(allowedName&&!isExtensionName){var val=this[prop];if(typeof val==="function"){continue}var type=Object.prototype.toString.call(val);if(type.indexOf("Object")>=0){if(Object.keys(val).length>0){result[prop]=val}}else if(type.indexOf("Array")>=0){if(val.length>0){var vals=[];for(var n in val){var nval=val[n];if(nval.toJSON!==undefined){vals.push(nval.toJSON())}else{vals.push(nval)}}result[prop]=vals}}else if(val!==undefined&&val!==false&&val!==""){result[prop]=val}}}return result};return Stanza}},{"./helpers":408,"extend-object":413}],410:[function(require,module,exports){"use strict";var fromB64=require("atob");var toB64=require("btoa");var helpers=require("./helpers");var extend=require("extend-object");var find=helpers.find;var createElement=helpers.createElement;var field=exports.field=function(getter,setter){return function(){var args=Array.prototype.slice.call(arguments);return{get:function(){return getter.apply(null,[this.xml].concat(args))},set:function(value){setter.apply(null,[this.xml].concat(args).concat([value]))}}}};exports.boolAttribute=field(helpers.getBoolAttribute,helpers.setBoolAttribute);exports.subAttribute=field(helpers.getSubAttribute,helpers.setSubAttribute);exports.boolSubAttribute=field(helpers.getSubBoolAttribute,helpers.setSubBoolAttribute);exports.text=field(helpers.getText,helpers.setText);exports.textSub=exports.subText=field(helpers.getSubText,helpers.setSubText);exports.multiTextSub=exports.multiSubText=field(helpers.getMultiSubText,helpers.setMultiSubText);exports.multiSubAttribute=field(helpers.getMultiSubAttribute,helpers.setMultiSubAttribute);exports.langTextSub=exports.subLangText=field(helpers.getSubLangText,helpers.setSubLangText);exports.boolSub=field(helpers.getBoolSub,helpers.setBoolSub);exports.langAttribute=field(function(xml){return xml.getAttributeNS(helpers.XML_NS,"lang")||""},function(xml,value){xml.setAttributeNS(helpers.XML_NS,"lang",value)});exports.b64Text=field(function(xml){if(xml.textContent&&xml.textContent!=="="){return fromB64(xml.textContent)}return""},function(xml,value){if(typeof value==="string"){xml.textContent=toB64(value)||"="}else{xml.textContent=""}});exports.dateAttribute=function(attr,now){return{get:function(){var data=helpers.getAttribute(this.xml,attr);if(data){return new Date(data)}if(now){return new Date(Date.now())}},set:function(value){if(!value){return}if(typeof value!=="string"){value=value.toISOString()}helpers.setAttribute(this.xml,attr,value)}}};exports.dateSub=function(NS,sub,now){return{get:function(){var data=helpers.getSubText(this.xml,NS,sub);if(data){return new Date(data)}if(now){return new Date(Date.now())}},set:function(value){if(!value){return}if(typeof value!=="string"){value=value.toISOString()}helpers.setSubText(this.xml,NS,sub,value)}}};exports.dateSubAttribute=function(NS,sub,attr,now){return{get:function(){var data=helpers.getSubAttribute(this.xml,NS,sub,attr);if(data){return new Date(data)}if(now){return new Date(Date.now())}},set:function(value){if(!value){return}if(typeof value!=="string"){value=value.toISOString()}helpers.setSubAttribute(this.xml,NS,sub,attr,value)}}};exports.numberAttribute=function(attr,isFloat,defaultVal){return{get:function(){var parse=isFloat?parseFloat:parseInt;var data=helpers.getAttribute(this.xml,attr,"");if(!data){return defaultVal}var parsed=parse(data,10);if(isNaN(parsed)){return defaultVal}return parsed},set:function(value){helpers.setAttribute(this.xml,attr,value.toString())}}};exports.numberSub=function(NS,sub,isFloat,defaultVal){return{get:function(){var parse=isFloat?parseFloat:parseInt;var data=helpers.getSubText(this.xml,NS,sub,"");if(!data){return defaultVal}var parsed=parse(data,10);if(isNaN(parsed)){return defaultVal}return parsed},set:function(value){helpers.setSubText(this.xml,NS,sub,value.toString())}}};exports.attribute=function(name,defaultVal){return{get:function(){return helpers.getAttribute(this.xml,name,defaultVal)},set:function(value){helpers.setAttribute(this.xml,name,value)}}};exports.attributeNS=function(NS,name,defaultVal){return{get:function(){return helpers.getAttributeNS(this.xml,NS,name,defaultVal)},set:function(value){helpers.setAttributeNS(this.xml,NS,name,value)}}};exports.extension=function(ChildJXT){return{get:function(){var self=this;var name=ChildJXT.prototype._name;if(!this._extensions[name]){var existing=find(this.xml,ChildJXT.prototype._NS,ChildJXT.prototype._EL);if(!existing.length){this._extensions[name]=new ChildJXT({},null,self);this.xml.appendChild(this._extensions[name].xml)}else{this._extensions[name]=new ChildJXT(null,existing[0],self)}this._extensions[name].parent=this}return this._extensions[name]},set:function(value){if(value){var child=this[ChildJXT.prototype._name];if(value===true){value={}}extend(child,value)}}}};exports.multiExtension=function(ChildJXT){return{get:function(){var self=this;var data=find(this.xml,ChildJXT.prototype._NS,ChildJXT.prototype._EL);var results=[];for(var i=0,len=data.length;i<len;i++){results.push(new ChildJXT({},data[i],self))}return results},set:function(value){value=value||[];var self=this;var existing=find(this.xml,ChildJXT.prototype._NS,ChildJXT.prototype._EL);var i,len;for(i=0,len=existing.length;i<len;i++){self.xml.removeChild(existing[i])}for(i=0,len=value.length;i<len;i++){var content=new ChildJXT(value[i],null,self);self.xml.appendChild(content.xml)}}}};exports.enumSub=function(NS,enumValues){return{get:function(){var self=this;var result=[];enumValues.forEach(function(enumVal){var exists=find(self.xml,NS,enumVal);if(exists.length){result.push(exists[0].nodeName)}});return result[0]||""},set:function(value){var self=this;enumValues.forEach(function(enumVal){var exists=find(self.xml,NS,enumVal);if(exists.length){self.xml.removeChild(exists[0])}});if(value){var condition=createElement(NS,value);this.xml.appendChild(condition)}}}};exports.subExtension=function(name,NS,sub,ChildJXT){return{get:function(){if(!this._extensions[name]){var wrapper=find(this.xml,NS,sub);if(!wrapper.length){wrapper=createElement(NS,sub,this._NS);this.xml.appendChild(wrapper)}else{wrapper=wrapper[0]}var existing=find(wrapper,ChildJXT.prototype._NS,ChildJXT.prototype._EL);if(!existing.length){this._extensions[name]=new ChildJXT({},null,{xml:wrapper});wrapper.appendChild(this._extensions[name].xml)}else{this._extensions[name]=new ChildJXT(null,existing[0],{xml:wrapper})}this._extensions[name].parent=this}return this._extensions[name]},set:function(value){var wrapper=find(this.xml,NS,sub);if(wrapper.length&&!value){this.xml.removeChild(wrapper[0])}if(value){var child=this[name];if(value===true){value={}}extend(child,value)}}}};exports.subMultiExtension=function(NS,sub,ChildJXT){return{get:function(){var self=this;var results=[];var existing=find(this.xml,NS,sub);if(!existing.length){return results}existing=existing[0];var data=find(existing,ChildJXT.prototype._NS,ChildJXT.prototype._EL);data.forEach(function(xml){results.push(new ChildJXT({},xml,self))});return results},set:function(values){var self=this;var existing=find(this.xml,NS,sub);if(existing.length){self.xml.removeChild(existing[0])}if(!values.length){return}existing=createElement(NS,sub,this._NS);values.forEach(function(value){var content=new ChildJXT(value,null,self);existing.appendChild(content.xml)});self.xml.appendChild(existing)}}}},{"./helpers":408,atob:411,btoa:412,"extend-object":413}],411:[function(require,module,exports){(function(Buffer){(function(){"use strict";function atob(str){return new Buffer(str,"base64").toString("binary")}module.exports=atob})()}).call(this,require("buffer").Buffer)},{buffer:5}],412:[function(require,module,exports){(function(Buffer){(function(){"use strict";function btoa(str){var buffer;if(str instanceof Buffer){buffer=str}else{buffer=new Buffer(str.toString(),"binary")}return buffer.toString("base64")}module.exports=btoa})()}).call(this,require("buffer").Buffer)},{buffer:5}],413:[function(require,module,exports){module.exports=require(385)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/stanza.io/node_modules/jingle/node_modules/extend-object/extend-object.js":385}],414:[function(require,module,exports){"use strict";var util=require("util"),Element=require("./element").Element;function DOMElement(name,attrs){Element.call(this,name,attrs);this.nodeType=1;this.nodeName=this.localName}util.inherits(DOMElement,Element);DOMElement.prototype._getElement=function(name,attrs){var element=new DOMElement(name,attrs);return element};Object.defineProperty(DOMElement.prototype,"localName",{get:function(){return this.getName()}});Object.defineProperty(DOMElement.prototype,"namespaceURI",{get:function(){return this.getNS()}});Object.defineProperty(DOMElement.prototype,"parentNode",{get:function(){return this.parent}});Object.defineProperty(DOMElement.prototype,"childNodes",{get:function(){return this.children}});Object.defineProperty(DOMElement.prototype,"textContent",{get:function(){return this.getText()},set:function(value){this.children.push(value)}});DOMElement.prototype.getElementsByTagName=function(name){return this.getChildren(name)};DOMElement.prototype.getAttribute=function(name){return this.getAttr(name)};DOMElement.prototype.setAttribute=function(name,value){this.attr(name,value)};DOMElement.prototype.getAttributeNS=function(ns,name){if(ns==="http://www.w3.org/XML/1998/namespace"){return this.getAttr(["xml",name].join(":"))}return this.getAttr(name,ns)};DOMElement.prototype.setAttributeNS=function(ns,name,value){var prefix;if(ns==="http://www.w3.org/XML/1998/namespace"){prefix="xml"}else{var nss=this.getXmlns();prefix=nss[ns]||""}if(prefix){this.attr([prefix,name].join(":"),value)}};DOMElement.prototype.removeAttribute=function(name){this.attr(name,null)};DOMElement.prototype.removeAttributeNS=function(ns,name){var prefix;if(ns==="http://www.w3.org/XML/1998/namespace"){prefix="xml"}else{var nss=this.getXmlns();prefix=nss[ns]||""}if(prefix){this.attr([prefix,name].join(":"),null)}};DOMElement.prototype.appendChild=function(el){this.cnode(el)};DOMElement.prototype.removeChild=function(el){this.remove(el)};module.exports=DOMElement},{"./element":415,util:165}],415:[function(require,module,exports){"use strict";function Element(name,attrs){this.name=name;this.parent=null;this.attrs=attrs||{};this.children=[]}Element.prototype.is=function(name,xmlns){return this.getName()===name&&(!xmlns||this.getNS()===xmlns)};Element.prototype.getName=function(){if(this.name.indexOf(":")>=0)return this.name.substr(this.name.indexOf(":")+1);else return this.name};Element.prototype.getNS=function(){if(this.name.indexOf(":")>=0){var prefix=this.name.substr(0,this.name.indexOf(":"));return this.findNS(prefix)}else{return this.findNS()}};Element.prototype.findNS=function(prefix){if(!prefix){if(this.attrs.xmlns)return this.attrs.xmlns;else if(this.parent)return this.parent.findNS()}else{var attr="xmlns:"+prefix;if(this.attrs[attr])return this.attrs[attr];else if(this.parent)return this.parent.findNS(prefix)}};Element.prototype.getXmlns=function(){var namespaces={};if(this.parent)namespaces=this.parent.getXmlns();for(var attr in this.attrs){var m=attr.match("xmlns:?(.*)");if(this.attrs.hasOwnProperty(attr)&&m){namespaces[this.attrs[attr]]=m[1]}}return namespaces};Element.prototype.getAttr=function(name,xmlns){if(!xmlns)return this.attrs[name];var namespaces=this.getXmlns();if(!namespaces[xmlns])return null;return this.attrs[[namespaces[xmlns],name].join(":")]};Element.prototype.getChild=function(name,xmlns){return this.getChildren(name,xmlns)[0]};Element.prototype.getChildren=function(name,xmlns){var result=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.getName&&child.getName()===name&&(!xmlns||child.getNS()===xmlns))result.push(child)}return result};Element.prototype.getChildByAttr=function(attr,val,xmlns,recursive){return this.getChildrenByAttr(attr,val,xmlns,recursive)[0]};Element.prototype.getChildrenByAttr=function(attr,val,xmlns,recursive){var result=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.attrs&&child.attrs[attr]===val&&(!xmlns||child.getNS()===xmlns))result.push(child);if(recursive&&child.getChildrenByAttr){result.push(child.getChildrenByAttr(attr,val,xmlns,true))}}if(recursive)result=[].concat.apply([],result);return result};Element.prototype.getChildrenByFilter=function(filter,recursive){var result=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];if(filter(child))result.push(child);if(recursive&&child.getChildrenByFilter){result.push(child.getChildrenByFilter(filter,true))}}if(recursive){result=[].concat.apply([],result)}return result};Element.prototype.getText=function(){var text="";for(var i=0;i<this.children.length;i++){var child=this.children[i];if(typeof child==="string"||typeof child==="number"){text+=child
}}return text};Element.prototype.getChildText=function(name,xmlns){var child=this.getChild(name,xmlns);return child?child.getText():null};Element.prototype.getChildElements=function(){return this.getChildrenByFilter(function(child){return child instanceof Element})};Element.prototype.root=function(){if(this.parent)return this.parent.root();else return this};Element.prototype.tree=Element.prototype.root;Element.prototype.up=function(){if(this.parent)return this.parent;else return this};Element.prototype._getElement=function(name,attrs){var element=new Element(name,attrs);return element};Element.prototype.c=function(name,attrs){return this.cnode(this._getElement(name,attrs))};Element.prototype.cnode=function(child){this.children.push(child);child.parent=this;return child};Element.prototype.t=function(text){this.children.push(text);return this};Element.prototype.remove=function(el,xmlns){var filter;if(typeof el==="string"){filter=function(child){return!(child.is&&child.is(el,xmlns))}}else{filter=function(child){return child!==el}}this.children=this.children.filter(filter);return this};Element.prototype.clone=function(){var clone=this._getElement(this.name,{});for(var k in this.attrs){if(this.attrs.hasOwnProperty(k))clone.attrs[k]=this.attrs[k]}for(var i=0;i<this.children.length;i++){var child=this.children[i];clone.cnode(child.clone?child.clone():child)}return clone};Element.prototype.text=function(val){if(val&&this.children.length===1){this.children[0]=val;return this}return this.getText()};Element.prototype.attr=function(attr,val){if(typeof val!=="undefined"||val===null){if(!this.attrs){this.attrs={}}this.attrs[attr]=val;return this}return this.attrs[attr]};Element.prototype.toString=function(){var s="";this.write(function(c){s+=c});return s};Element.prototype.toJSON=function(){return{name:this.name,attrs:this.attrs,children:this.children.map(function(child){return child&&child.toJSON?child.toJSON():child})}};Element.prototype._addChildren=function(writer){writer(">");for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child||child===0){if(child.write){child.write(writer)}else if(typeof child==="string"){writer(escapeXmlText(child))}else if(child.toString){writer(escapeXmlText(child.toString(10)))}}}writer("</");writer(this.name);writer(">")};Element.prototype.write=function(writer){writer("<");writer(this.name);for(var k in this.attrs){var v=this.attrs[k];if(v||v===""||v===0){writer(" ");writer(k);writer('="');if(typeof v!=="string"){v=v.toString(10)}writer(escapeXml(v));writer('"')}}if(this.children.length===0){writer("/>")}else{this._addChildren(writer)}};function escapeXml(s){return s.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/"/g,"&apos;")}function escapeXmlText(s){return s.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}exports.Element=Element;exports.escapeXml=escapeXml},{}],416:[function(require,module,exports){"use strict";var parse=require("./parse");parse.availableSaxParsers.push(parse.bestSaxParser=require("./sax/sax_ltx"));module.exports=require("./index")},{"./index":417,"./parse":418,"./sax/sax_ltx":419}],417:[function(require,module,exports){"use strict";var parse=require("./parse");exports.Element=require("./dom-element");exports.escapeXml=require("./element").escapeXml;exports.parse=parse.parse;exports.Parser=parse.Parser;exports.availableSaxParsers=parse.availableSaxParsers;exports.bestSaxParser=parse.bestSaxParser},{"./dom-element":414,"./element":415,"./parse":418}],418:[function(require,module,exports){"use strict";var events=require("events"),util=require("util"),DOMElement=require("./dom-element");exports.availableSaxParsers=[];exports.bestSaxParser=null;var saxParsers=["./sax/sax_expat.js","./sax/sax_ltx.js","./sax/sax_saxjs.js"];saxParsers.forEach(function(modName){var mod;try{mod=require(modName)}catch(e){}if(mod){exports.availableSaxParsers.push(mod);if(!exports.bestSaxParser){exports.bestSaxParser=mod}}});exports.Parser=function(saxParser){events.EventEmitter.call(this);var self=this;var ParserMod=saxParser||exports.bestSaxParser;if(!ParserMod){throw new Error("No SAX parser available")}this.parser=new ParserMod;var el;this.parser.addListener("startElement",function(name,attrs){var child=new DOMElement(name,attrs);if(!el){el=child}else{el=el.cnode(child)}});this.parser.addListener("endElement",function(name){if(!el){}else if(name===el.name){if(el.parent){el=el.parent}else if(!self.tree){self.tree=el;el=undefined}}});this.parser.addListener("text",function(str){if(el){el.t(str)}});this.parser.addListener("error",function(e){self.error=e;self.emit("error",e)})};util.inherits(exports.Parser,events.EventEmitter);exports.Parser.prototype.write=function(data){this.parser.write(data)};exports.Parser.prototype.end=function(data){this.parser.end(data);if(!this.error){if(this.tree){this.emit("tree",this.tree)}else{this.emit("error",new Error("Incomplete document"))}}};exports.parse=function(data,saxParser){var p=new exports.Parser(saxParser);var result=null,error=null;p.on("tree",function(tree){result=tree});p.on("error",function(e){error=e});p.write(data);p.end();if(error){throw error}else{return result}}},{"./dom-element":414,events:145,util:165}],419:[function(require,module,exports){"use strict";var util=require("util"),events=require("events");var STATE_TEXT=0,STATE_IGNORE_TAG=1,STATE_TAG_NAME=2,STATE_TAG=3,STATE_ATTR_NAME=4,STATE_ATTR_EQ=5,STATE_ATTR_QUOT=6,STATE_ATTR_VALUE=7;var SaxLtx=module.exports=function SaxLtx(){events.EventEmitter.call(this);var state=STATE_TEXT,remainder;var tagName,attrs,endTag,selfClosing,attrQuote;var recordStart=0;var attrName;this._handleTagOpening=function(endTag,tagName,attrs){if(!endTag){this.emit("startElement",tagName,attrs);if(selfClosing){this.emit("endElement",tagName)}}else{this.emit("endElement",tagName)}};this.write=function(data){if(typeof data!=="string"){data=data.toString()}var pos=0;if(remainder){data=remainder+data;pos+=remainder.length;remainder=null}function endRecording(){if(typeof recordStart==="number"){var recorded=data.slice(recordStart,pos);recordStart=undefined;return recorded}}for(;pos<data.length;pos++){var c=data.charCodeAt(pos);switch(state){case STATE_TEXT:if(c===60){var text=endRecording();if(text){this.emit("text",unescapeXml(text))}state=STATE_TAG_NAME;recordStart=pos+1;attrs={}}break;case STATE_TAG_NAME:if(c===47&&recordStart===pos){recordStart=pos+1;endTag=true}else if(c===33||c===63){recordStart=undefined;state=STATE_IGNORE_TAG}else if(c<=32||c===47||c===62){tagName=endRecording();pos--;state=STATE_TAG}break;case STATE_IGNORE_TAG:if(c===62){state=STATE_TEXT}break;case STATE_TAG:if(c===62){this._handleTagOpening(endTag,tagName,attrs);tagName=undefined;attrs=undefined;endTag=undefined;selfClosing=undefined;state=STATE_TEXT;recordStart=pos+1}else if(c===47){selfClosing=true}else if(c>32){recordStart=pos;state=STATE_ATTR_NAME}break;case STATE_ATTR_NAME:if(c<=32||c===61){attrName=endRecording();pos--;state=STATE_ATTR_EQ}break;case STATE_ATTR_EQ:if(c===61){state=STATE_ATTR_QUOT}break;case STATE_ATTR_QUOT:if(c===34||c===39){attrQuote=c;state=STATE_ATTR_VALUE;recordStart=pos+1}break;case STATE_ATTR_VALUE:if(c===attrQuote){var value=unescapeXml(endRecording());attrs[attrName]=value;attrName=undefined;state=STATE_TAG}break}}if(typeof recordStart==="number"&&recordStart<=data.length){remainder=data.slice(recordStart);recordStart=0}}};util.inherits(SaxLtx,events.EventEmitter);SaxLtx.prototype.end=function(data){if(data){this.write(data)}this.write=function(){}};function unescapeXml(s){return s.replace(/\&(amp|#38);/g,"&").replace(/\&(lt|#60);/g,"<").replace(/\&(gt|#62);/g,">").replace(/\&(quot|#34);/g,'"').replace(/\&(apos|#39);/g,"'").replace(/\&(nbsp|#160);/g,"\n")}},{events:145,util:165}],420:[function(require,module,exports){(function(){var _global=this;var _rng;if(typeof _global.require=="function"){try{var _rb=_global.require("crypto").randomBytes;_rng=_rb&&function(){return _rb(16)}}catch(e){}}if(!_rng&&_global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);_rng=function whatwgRNG(){crypto.getRandomValues(_rnds8);return _rnds8}}if(!_rng){var _rnds=new Array(16);_rng=function(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;_rnds[i]=r>>>((i&3)<<3)&255}return _rnds}}var BufferClass=typeof _global.Buffer=="function"?_global.Buffer:Array;var _byteToHex=[];var _hexToByte={};for(var i=0;i<256;i++){_byteToHex[i]=(i+256).toString(16).substr(1);_hexToByte[_byteToHex[i]]=i}function parse(s,buf,offset){var i=buf&&offset||0,ii=0;buf=buf||[];s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){if(ii<16){buf[i+ii++]=_hexToByte[oct]}});while(ii<16){buf[i+ii++]=0}return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}var _seedBytes=_rng();var _nodeId=[_seedBytes[0]|1,_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]];var _clockseq=(_seedBytes[6]<<8|_seedBytes[7])&16383;var _lastMSecs=0,_lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var clockseq=options.clockseq!=null?options.clockseq:_clockseq;var msecs=options.msecs!=null?options.msecs:(new Date).getTime();var nsecs=options.nsecs!=null?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq==null){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs==null){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;var node=options.node||_nodeId;for(var n=0;n<6;n++){b[i+n]=node[n]}return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new BufferClass(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||_rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;ii++){buf[i+ii]=rnds[ii]}}return buf||unparse(rnds)}var uuid=v4;uuid.v1=v1;uuid.v4=v4;uuid.parse=parse;uuid.unparse=unparse;uuid.BufferClass=BufferClass;if(typeof define==="function"&&define.amd){define(function(){return uuid})}else if(typeof module!="undefined"&&module.exports){module.exports=uuid}else{var _previousRoot=_global.uuid;uuid.noConflict=function(){_global.uuid=_previousRoot;return uuid};_global.uuid=uuid}}).call(this)},{}],421:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){factory(exports,module)}else if(typeof define==="function"&&define.amd){define(["exports","module"],factory)}})(this,function(exports,module){function Mechanism(){}Mechanism.prototype.name="ANONYMOUS";Mechanism.prototype.clientFirst=true;Mechanism.prototype.response=function(cred){return cred.trace||""};Mechanism.prototype.challenge=function(chal){};exports=module.exports=Mechanism})},{}],422:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){factory(exports,module,require("./lib/mechanism"))}else if(typeof define==="function"&&define.amd){define(["exports","module","./lib/mechanism"],factory)}})(this,function(exports,module,Mechanism){exports=module.exports=Mechanism;exports.Mechanism=Mechanism})},{"./lib/mechanism":421}],423:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){factory(exports,module)}else if(typeof define==="function"&&define.amd){define(["exports","module"],factory)}})(this,function(exports,module){function Mechanism(){}Mechanism.prototype.name="EXTERNAL";Mechanism.prototype.clientFirst=true;Mechanism.prototype.response=function(cred){return cred.authzid||""};Mechanism.prototype.challenge=function(chal){};exports=module.exports=Mechanism})},{}],424:[function(require,module,exports){arguments[4][422][0].apply(exports,arguments)},{"./lib/mechanism":423,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/stanza.io/node_modules/sasl-anonymous/main.js":422}],425:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){factory(exports,module)}else if(typeof define==="function"&&define.amd){define(["exports","module"],factory)}})(this,function(exports,module){function Mechanism(){}Mechanism.prototype.name="PLAIN";Mechanism.prototype.clientFirst=true;Mechanism.prototype.response=function(cred){var str="";str+=cred.authzid||"";str+="\x00";str+=cred.username;str+="\x00";str+=cred.password;return str};Mechanism.prototype.challenge=function(chal){return this};exports=module.exports=Mechanism})},{}],426:[function(require,module,exports){arguments[4][422][0].apply(exports,arguments)},{"./lib/mechanism":425,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/stanza.io/node_modules/sasl-anonymous/main.js":422}],427:[function(require,module,exports){(function(Buffer){var bitops=require("./lib/bitops");var utils=require("./lib/utils");var RESP={};function Mechanism(options){options=options||{};this._genNonce=options.genNonce||utils.genNonce;this._stage="initial"}Mechanism.Mechanism=Mechanism;Mechanism.prototype.name="SCRAM-SHA-1";Mechanism.prototype.clientFirst=true;Mechanism.prototype.response=function(cred){return RESP[this._stage](this,cred)};Mechanism.prototype.challenge=function(chal){var values=utils.parse(chal);this._salt=new Buffer(values.s||"","base64");this._iterationCount=parseInt(values.i,10);this._nonce=values.r;this._verifier=values.v;this._error=values.e;this._challenge=chal;return this};RESP.initial=function(mech,cred){mech._cnonce=mech._genNonce();var authzid="";if(cred.authzid){authzid="a="+utils.saslname(cred.authzid)}mech._gs2Header="n,"+authzid+",";var nonce="r="+mech._cnonce;var username="n="+utils.saslname(cred.username);mech._clientFirstMessageBare=username+","+nonce;var result=mech._gs2Header+mech._clientFirstMessageBare;mech._stage="challenge";return result};RESP.challenge=function(mech,cred){var gs2Header=new Buffer(mech._gs2Header).toString("base64");mech._clientFinalMessageWithoutProof="c="+gs2Header+",r="+mech._nonce;var saltedPassword,clientKey,serverKey;if(cred.clientKey&&cred.serverKey){clientKey=cred.clientKey;serverKey=cred.serverKey}else{saltedPassword=cred.saltedPassword||bitops.Hi(cred.password,mech._salt,mech._iterationCount);clientKey=bitops.HMAC(saltedPassword,"Client Key");serverKey=bitops.HMAC(saltedPassword,"Server Key")}var storedKey=bitops.H(clientKey);var authMessage=mech._clientFirstMessageBare+","+mech._challenge+","+mech._clientFinalMessageWithoutProof;var clientSignature=bitops.HMAC(storedKey,authMessage);var clientProof=bitops.XOR(clientKey,clientSignature).toString("base64");mech._serverSignature=bitops.HMAC(serverKey,authMessage);var result=mech._clientFinalMessageWithoutProof+",p="+clientProof;mech._stage="final";mech.cache={saltedPassword:saltedPassword,clientKey:clientKey,serverKey:serverKey};return result};RESP.final=function(){return""};module.exports=Mechanism}).call(this,require("buffer").Buffer)},{"./lib/bitops":428,"./lib/utils":429,buffer:5}],428:[function(require,module,exports){(function(Buffer){var createHash=require("create-hash");var createHmac=require("create-hmac");var xor=require("bitwise-xor");exports.XOR=xor;exports.H=function(text){return createHash("sha1").update(text).digest()};exports.HMAC=function(key,msg){return createHmac("sha1",key).update(msg).digest()};exports.Hi=function(text,salt,iterations){var ui1=exports.HMAC(text,Buffer.concat([salt,new Buffer([0,0,0,1],"binary")]));var ui=ui1;for(var i=0;i<iterations-1;i++){ui1=exports.HMAC(text,ui1);ui=exports.XOR(ui,ui1)}return ui}}).call(this,require("buffer").Buffer)},{"bitwise-xor":430,buffer:5,"create-hash":431,"create-hmac":443}],429:[function(require,module,exports){var randomBytes=require("randombytes");exports.parse=function(chal){var dtives={};var tokens=chal.split(/,(?=(?:[^"]|"[^"]*")*$)/);for(var i=0,len=tokens.length;i<len;i++){var dtiv=/(\w+)=["]?([^"]+)["]?$/.exec(tokens[i]);if(dtiv){dtives[dtiv[1]]=dtiv[2]}}return dtives};exports.saslname=function(name){var escaped=[];var curr="";for(var i=0;i<name.length;i++){curr=name[i];if(curr===","){escaped.push("=2C")}else if(curr==="="){escaped.push("=3D")}else{escaped.push(curr)}}return escaped.join("")};exports.genNonce=function(len){return randomBytes((len||32)/2).toString("hex")}},{randombytes:445}],430:[function(require,module,exports){(function(Buffer){module.exports=xor;function xor(a,b){if(!Buffer.isBuffer(a))a=new Buffer(a);if(!Buffer.isBuffer(b))b=new Buffer(b);var res=[];if(a.length>b.length){for(var i=0;i<b.length;i++){res.push(a[i]^b[i])}}else{for(var i=0;i<a.length;i++){res.push(a[i]^b[i])}}return new Buffer(res)}}).call(this,require("buffer").Buffer)},{buffer:5}],431:[function(require,module,exports){module.exports=require(97)},{"./md5":433,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/browser.js":97,buffer:5,inherits:434,ripemd160:435,"sha.js":437,stream:163}],432:[function(require,module,exports){module.exports=require(98)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/helpers.js":98,buffer:5}],433:[function(require,module,exports){module.exports=require(99)},{"./helpers":432,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/md5.js":99}],434:[function(require,module,exports){module.exports=require(146)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/inherits/inherits_browser.js":146}],435:[function(require,module,exports){module.exports=require(100)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/ripemd160/lib/ripemd160.js":100,buffer:5}],436:[function(require,module,exports){module.exports=require(101)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/hash.js":101,buffer:5}],437:[function(require,module,exports){module.exports=require(102)},{"./sha1":438,"./sha224":439,"./sha256":440,"./sha384":441,"./sha512":442,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/index.js":102}],438:[function(require,module,exports){module.exports=require(103)},{"./hash":436,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha1.js":103,buffer:5,inherits:434}],439:[function(require,module,exports){module.exports=require(104)},{"./hash":436,"./sha256":440,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha224.js":104,buffer:5,inherits:434}],440:[function(require,module,exports){module.exports=require(105)},{"./hash":436,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha256.js":105,buffer:5,inherits:434}],441:[function(require,module,exports){module.exports=require(106)},{"./hash":436,"./sha512":442,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha384.js":106,buffer:5,inherits:434}],442:[function(require,module,exports){module.exports=require(107)},{"./hash":436,"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hash/node_modules/sha.js/sha512.js":107,buffer:5,inherits:434}],443:[function(require,module,exports){module.exports=require(108)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/create-hmac/browser.js":108,buffer:5,"create-hash/browser":431,inherits:444,stream:163}],444:[function(require,module,exports){module.exports=require(146)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/inherits/inherits_browser.js":146}],445:[function(require,module,exports){module.exports=require(144)},{"/Users/dominiksteiner/Documents/workspace-broadsoft/webrtc/node_modules/browserify/node_modules/crypto-browserify/node_modules/randombytes/browser.js":144,_process:149,buffer:5}],446:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){factory(exports,module)}else if(typeof define==="function"&&define.amd){define(["exports","module"],factory)}})(this,function(exports,module){function Factory(){this._mechs=[]}Factory.prototype.use=function(name,mech){if(!mech){mech=name;name=mech.prototype.name}this._mechs.push({name:name,mech:mech});return this};Factory.prototype.create=function(mechs){for(var i=0,len=this._mechs.length;i<len;i++){for(var j=0,jlen=mechs.length;j<jlen;j++){var entry=this._mechs[i];if(entry.name==mechs[j]){return new entry.mech}}}return null};exports=module.exports=Factory})},{}],447:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){factory(exports,module,require("./lib/factory"))}else if(typeof define==="function"&&define.amd){define(["exports","module","./lib/factory"],factory)}})(this,function(exports,module,Factory){exports=module.exports=Factory;exports.Factory=Factory})},{"./lib/factory":446}],448:[function(require,module,exports){(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.6.0";var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return obj;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(var i=0,length=obj.length;i<length;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return}}else{var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker)return}}return obj};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))});return results};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator)}each(obj,function(value,index,list){if(!initial){memo=value;initial=true}else{memo=iterator.call(context,memo,value,index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator)}var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true}else{memo=iterator.call(context,memo,obj[index],index,list)}});if(!initial)throw new TypeError(reduceError);return memo};_.find=_.detect=function(obj,predicate,context){var result;any(obj,function(value,index,list){if(predicate.call(context,value,index,list)){result=value;return true}});return result};_.filter=_.select=function(obj,predicate,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(predicate,context);each(obj,function(value,index,list){if(predicate.call(context,value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,function(value,index,list){return!predicate.call(context,value,index,list)},context)};_.every=_.all=function(obj,predicate,context){predicate||(predicate=_.identity);var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(predicate,context);each(obj,function(value,index,list){if(!(result=result&&predicate.call(context,value,index,list)))return breaker});return!!result};var any=_.some=_.any=function(obj,predicate,context){predicate||(predicate=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(predicate,context);each(obj,function(value,index,list){if(result||(result=predicate.call(context,value,index,list)))return breaker});return!!result};_.contains=_.include=function(obj,target){if(obj==null)return false;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;return any(obj,function(value){return value===target})};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs))};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.max.apply(Math,obj)}var result=-Infinity,lastComputed=-Infinity;each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;if(computed>lastComputed){result=value;lastComputed=computed}});return result};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.min.apply(Math,obj)}var result=Infinity,lastComputed=Infinity;each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;if(computed<lastComputed){result=value;lastComputed=computed}});return result};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);shuffled[index-1]=shuffled[rand];shuffled[rand]=value});return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(obj.length!==+obj.length)obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};var lookupIterator=function(value){if(value==null)return _.identity;if(_.isFunction(value))return value;return _.property(value)};_.sortBy=function(obj,iterator,context){iterator=lookupIterator(iterator);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iterator,context){var result={};iterator=lookupIterator(iterator);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)});return result}};_.groupBy=group(function(result,key,value){_.has(result,key)?result[key].push(value):result[key]=[value]});_.indexBy=group(function(result,key,value){result[key]=value});_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1});_.sortedIndex=function(array,obj,iterator,context){iterator=lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return obj.length===+obj.length?obj.length:_.keys(obj).length};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];if(n<0)return[];return slice.call(array,0,n)};_.initial=function(array,n,guard){return slice.call(array,0,array.length-(n==null||guard?1:n))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return slice.call(array,Math.max(array.length-n,0))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){if(shallow&&_.every(input,_.isArray)){return concat.apply(output,input)}each(input,function(value){if(_.isArray(value)||_.isArguments(value)){shallow?push.apply(output,value):flatten(value,shallow,output)}else{output.push(value)}});return output};_.flatten=function(array,shallow){return flatten(array,shallow,[])};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.partition=function(array,predicate){var pass=[],fail=[];each(array,function(elem){(predicate(elem)?pass:fail).push(elem)});return[pass,fail]};_.uniq=_.unique=function(array,isSorted,iterator,context){if(_.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false}var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?!index||seen[seen.length-1]!==value:!_.contains(seen,value)){seen.push(value);results.push(array[index])}});return results};_.union=function(){return _.uniq(_.flatten(arguments,true))};_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.contains(other,item)})})};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){var length=_.max(_.pluck(arguments,"length").concat(0));var results=new Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(arguments,""+i)}return results};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,length=list.length;i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,length=array.length;if(isSorted){if(typeof isSorted=="number"){i=isSorted<0?Math.max(0,length+isSorted):isSorted}else{i=_.sortedIndex(array,item);
return array[i]===item?i:-1}}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<length;i++)if(array[i]===item)return i;return-1};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf){return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item)}var i=hasIndex?from:array.length;while(i--)if(array[i]===item)return i;return-1};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0}step=arguments[2]||1;var length=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(length);while(idx<length){range[idx++]=start;start+=step}return range};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self}};_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){var position=0;var args=boundArgs.slice();for(var i=0,length=args.length;i<length;i++){if(args[i]===_)args[i]=arguments[position++]}while(position<arguments.length)args.push(arguments[position++]);return func.apply(this,args)}};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length===0)throw new Error("bindAll must be passed function names");each(funcs,function(f){obj[f]=_.bind(obj[f],obj)});return obj};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))};_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;options||(options={});var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout){timeout=setTimeout(later,wait)}if(callNow){result=func.apply(context,args);context=args=null}return result}};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)]}return args[0]}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=new Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=new Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop]}}});return obj};_.pick=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj)copy[key]=obj[key]});return copy};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj){if(!_.contains(keys,key))copy[key]=obj[key]}return copy};_.defaults=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){if(obj[prop]===void 0)obj[prop]=source[prop]}}});return obj};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return false;var length=aStack.length;while(length--){if(aStack[length]==a)return bStack[length]==b}var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor"in a&&"constructor"in b)){return false}aStack.push(a);bStack.push(b);var size=0,result=true;if(className=="[object Array]"){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break}}}else{for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break}}if(result){for(key in b){if(_.has(b,key)&&!size--)break}result=!size}}aStack.pop();bStack.pop();return result};_.isEqual=function(a,b){return eq(a,b,[],[])};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=="[object Array]"};_.isObject=function(obj){return obj===Object(obj)};each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,"callee"))}}if(typeof/./!=="function"){_.isFunction=function(obj){return typeof obj==="function"}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.property=function(key){return function(obj){return obj[key]}};_.matches=function(attrs){return function(obj){if(obj===attrs)return true;for(var key in attrs){if(attrs[key]!==obj[key])return false}return true}};_.times=function(n,iterator,context){var accum=Array(Math.max(0,n));for(var i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){if(string==null)return"";return(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}});_.result=function(object,property){if(object==null)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]});if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}if(evaluate){source+="';\n"+evaluate+"\n__p+='"}index=offset+match.length;return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};template.source="function("+(settings.variable||"obj")+"){\n"+source+"}";return template};_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_);each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=="shift"||name=="splice")&&obj.length===0)delete obj[0];return result.call(this,obj)}});each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}});_.extend(_.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}});if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this)},{}],449:[function(require,module,exports){module.exports=WildEmitter;function WildEmitter(){this.callbacks={}}WildEmitter.prototype.on=function(event,groupName,fn){var hasGroup=arguments.length===3,group=hasGroup?arguments[1]:undefined,func=hasGroup?arguments[2]:arguments[1];func._groupName=group;(this.callbacks[event]=this.callbacks[event]||[]).push(func);return this};WildEmitter.prototype.once=function(event,groupName,fn){var self=this,hasGroup=arguments.length===3,group=hasGroup?arguments[1]:undefined,func=hasGroup?arguments[2]:arguments[1];function on(){self.off(event,on);func.apply(this,arguments)}this.on(event,group,on);return this};WildEmitter.prototype.releaseGroup=function(groupName){var item,i,len,handlers;for(item in this.callbacks){handlers=this.callbacks[item];for(i=0,len=handlers.length;i<len;i++){if(handlers[i]._groupName===groupName){handlers.splice(i,1);i--;len--}}}return this};WildEmitter.prototype.off=function(event,fn){var callbacks=this.callbacks[event],i;if(!callbacks)return this;if(arguments.length===1){delete this.callbacks[event];return this}i=callbacks.indexOf(fn);callbacks.splice(i,1);return this};WildEmitter.prototype.emit=function(event){var args=[].slice.call(arguments,1),callbacks=this.callbacks[event],specialCallbacks=this.getWildcardCallbacks(event),i,len,item,listeners;if(callbacks){listeners=callbacks.slice();for(i=0,len=listeners.length;i<len;++i){if(listeners[i]){listeners[i].apply(this,args)}else{break}}}if(specialCallbacks){len=specialCallbacks.length;listeners=specialCallbacks.slice();for(i=0,len=listeners.length;i<len;++i){if(listeners[i]){listeners[i].apply(this,[event].concat(args))}else{break}}}return this};WildEmitter.prototype.getWildcardCallbacks=function(eventName){var item,split,result=[];for(item in this.callbacks){split=item.split("*");if(item==="*"||split.length===2&&eventName.slice(0,split[0].length)===split[0]){result=result.concat(this.callbacks[item])}}return result}},{}],450:[function(require,module,exports){"use strict";var StringPrep=require("./lib/stringprep");function bareJID(local,domain){if(local){return local+"@"+domain}return domain}function fullJID(local,domain,resource){if(resource){return bareJID(local,domain)+"/"+resource}return bareJID(local,domain)}exports.prep=function(data){var local=data.local;var domain=data.domain;var resource=data.resource;var unescapedLocal=local;if(local){local=StringPrep.nodeprep(local);unescapedLocal=exports.unescape(local)}if(resource){resource=StringPrep.resourceprep(resource)}if(domain[domain.length-1]==="."){domain=domain.slice(0,domain.length-1)}domain=StringPrep.nameprep(domain.split(".").map(StringPrep.toUnicode).join("."));return{prepped:data.prepped||StringPrep.available,local:local,domain:domain,resource:resource,bare:bareJID(local,domain),full:fullJID(local,domain,resource),unescapedLocal:unescapedLocal,unescapedBare:bareJID(unescapedLocal,domain),unescapedFull:fullJID(unescapedLocal,domain,resource)}};exports.parse=function(jid,trusted){var local="";var domain="";var resource="";trusted=/^[\x00-\x7F]*$/.test(jid);var resourceStart=jid.indexOf("/");if(resourceStart>0){resource=jid.slice(resourceStart+1);jid=jid.slice(0,resourceStart)}var localEnd=jid.indexOf("@");if(localEnd>0){local=jid.slice(0,localEnd);jid=jid.slice(localEnd+1)}domain=jid;var preppedJID=exports.prep({local:local,domain:domain,resource:resource});preppedJID.prepped=preppedJID.prepped||trusted;return preppedJID};exports.equal=function(jid1,jid2,requirePrep){jid1=new exports.JID(jid1);jid2=new exports.JID(jid2);if(arguments.length===2){requirePrep=true}return jid1.local===jid2.local&&jid1.domain===jid2.domain&&jid1.resource===jid2.resource&&(requirePrep?jid1.prepped&&jid2.prepped:true)};exports.equalBare=function(jid1,jid2,requirePrep){jid1=new exports.JID(jid1);jid2=new exports.JID(jid2);if(arguments.length===2){requirePrep=true}return jid1.local===jid2.local&&jid1.domain===jid2.domain&&(requirePrep?jid1.prepped&&jid2.prepped:true)};exports.escape=function(val){return val.replace(/^\s+|\s+$/g,"").replace(/\\5c/g,"\\5c5c").replace(/\\20/g,"\\5c20").replace(/\\22/g,"\\5c22").replace(/\\26/g,"\\5c26").replace(/\\27/g,"\\5c27").replace(/\\2f/g,"\\5c2f").replace(/\\3a/g,"\\5c3a").replace(/\\3c/g,"\\5c3c").replace(/\\3e/g,"\\5c3e").replace(/\\40/g,"\\5c40").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")};exports.unescape=function(val){return val.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")};exports.create=function(local,domain,resource){return new exports.JID(local,domain,resource)};exports.JID=function JID(localOrJID,domain,resource){var parsed={};if(localOrJID&&!domain&&!resource){if(typeof localOrJID==="string"){parsed=exports.parse(localOrJID)}else if(localOrJID instanceof exports.JID){parsed=localOrJID}else{throw new Error("Invalid argument type")}}else if(domain){parsed=exports.prep({local:exports.escape(localOrJID),domain:domain,resource:resource})}else{parsed={}}this.local=parsed.local||"";this.domain=parsed.domain||"";this.resource=parsed.resource||"";this.bare=parsed.bare||"";this.full=parsed.full||"";this.unescapedLocal=parsed.unescapedLocal||"";this.unescapedBare=parsed.unescapedBare||"";this.unescapedFull=parsed.unescapedFull||"";this.prepped=parsed.prepped};exports.JID.prototype.toString=function(){return this.full};exports.JID.prototype.toJSON=function(){return this.full}},{"./lib/stringprep":451}],451:[function(require,module,exports){"use strict";var punycode=require("punycode");exports.available=false;exports.toUnicode=punycode.toUnicode;exports.nameprep=function(str){return str.toLowerCase()};exports.nodeprep=function(str){return str.toLowerCase()};exports.resourceprep=function(str){return str}},{punycode:150}],452:[function(require,module,exports){var C={WIDESCREEN:"widescreen",STANDARD:"standard",R_1280x720:"1280x720",R_640x360:"640x360",R_320x180:"320x180",R_960x720:"960x720",R_640x480:"640x480",R_320x240:"320x240",DEFAULT_DURATION:500,DEFAULT_INTER_TONE_GAP:200,EXPIRES:365,TEMPLATES:"$TEMPLATES$",CSS:"$CSS$",MEDIA:"$MEDIA$",FONTS:"$FONTS$",STYLES:{iconHightlightColor:"#00adef",infoMessageColor:"#999999",successMessageColor:"#00FF00",warningMessageColor:"#FFFF00",alertMessageColor:"#FF0000",statsColor:"#999999",timerColor:"#FFFFFF"}};C.DEFAULT_RESOLUTION_ENCODING=C.R_640x480;C.DEFAULT_RESOLUTION_DISPLAY=C.R_640x480;C.RESOLUTION_TYPES={standard:C.STANDARD,widescreen:C.WIDESCREEN};C.STANDARD_RESOLUTIONS={"960 x 720":C.R_960x720,"640 x 480":C.R_640x480,"320 x 240":C.R_320x240};C.WIDESCREEN_RESOLUTIONS={"1280 x 720":C.R_1280x720,"640 x 360":C.R_640x360,"320 x 180":C.R_320x180};module.exports=C},{}],453:[function(require,module,exports){module.exports=DateFormat;var C={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],mthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};C.zeroPad=function(number){return("0"+number).substr(-2,2)};C.dateMarkers={d:["getDate",function(v){return C.zeroPad(v)}],m:["getMonth",function(v){return C.zeroPad(v+1)}],n:["getMonth",function(v){return C.mthNames[v]}],w:["getDay",function(v){return C.dayNames[v]}],y:["getFullYear"],H:["getHours",function(v){return C.zeroPad(v)}],M:["getMinutes",function(v){return C.zeroPad(v)}],S:["getSeconds",function(v){return C.zeroPad(v)}],i:["toISOString"]};DateFormat.C=C;function DateFormat(fstr){this.formatString=fstr}DateFormat.prototype={format:function(date){var dateTxt=this.formatString.replace(/%(.)/g,function(m,p){var dateMarker=C.dateMarkers[p];var method=dateMarker[0];var rv=date[method]();if(dateMarker[1]!==null){rv=dateMarker[1](rv)}return rv});return dateTxt}}},{}],454:[function(require,module,exports){module.exports=Icon;function Icon(element,sound){this.element=element;this.sound=sound;this.disabled=false}Icon.prototype={css:function(name){return this.element.css(name)},attr:function(name){return this.element.attr(name)},disable:function(){this.disabled=true},enable:function(){this.disabled=false},onClick:function(handler){var self=this;this.element.bind("click",function(e){e.preventDefault();if(self.disabled){return}self.sound.playClick();handler(e)})}}},{}],455:[function(require,module,exports){var adapter=require("./adapter");var Utils={clone:function(obj){return JSON.parse(JSON.stringify(obj))},rstring:function(){return Math.random().toString().slice(2,8)},dataURItoBlob:function(dataURI){var byteString=atob(dataURI.split(",")[1]);var mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0];var ab=new ArrayBuffer(byteString.length);var ia=new Uint8Array(ab);for(var i=0;i<byteString.length;i++){ia[i]=byteString.charCodeAt(i)}var blob=new Blob([ab],{type:mimeString});return blob},camelize:function(str){return str.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(match,index){if(+match===0)return"";return index==0?match.toLowerCase():match.toUpperCase()})},format:function(seconds){var hrs=Math.floor(seconds/3600);seconds%=3600;var mns=Math.floor(seconds/60);seconds%=60;var formatedDuration=(hrs<10?"0":"")+hrs+":"+(mns<10?"0":"")+mns+":"+(seconds<10?"0":"")+seconds;return formatedDuration},formatDateTime:function(dateStr){var date=new Date(dateStr);var strDate=date.getMonth()+1+"/"+date.getDate();var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var strTime=hours+":"+minutes+" "+ampm;return strDate+" - "+strTime},getSearchVariable:function(variable){if(typeof location==="undefined"){return false}var search=decodeURIComponent($(location).attr("search").substring(1));var vars=search.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]===variable){return pair[1]}}return false},containsKey:function(object,value){return $.inArray(value,$.map(object,function(key){return key}))!==-1},containsValue:function(object,value){return $.inArray(value,$.map(object,function(key,value){return value}))!==-1},addSelectOptions:function(options,selector){$.each(options,function(key,value){$(selector).append($("<option>",{value:value}).text(key))})},randomUserid:function(){var chars="0123456789abcdef";var string_length=10;var userid="";for(var i=0;i<string_length;i++){var rnum=Math.floor(Math.random()*chars.length);userid+=chars.substring(rnum,rnum+1)}return userid},whiteboardCompabilityCheck:function(){var isChrome=this.isChrome();if(!isChrome){return"Chrome is required for whiteboard feature, please go to:<br>"+"<a href='http://chrome.google.com'>http://chrome.google.com</a>"}var major=this.majorVersion();if(isChrome&&major<34){return"Your version of Chrome must be upgraded to at least version 34 in order to be able to use the whiteboard<br>"+"Please go to: <a href='http://chrome.google.com'>http://chrome.google.com</a> or <a href='https://www.google.com/intl/en/chrome/browser/canary.html'>https://www.google.com/intl/en/chrome/browser/canary.html</a>"}},compatibilityCheck:function(configuration){var isChrome=this.isChrome();var isFirefox=this.isFirefox();if(!isChrome&&!isFirefox){return"Chrome or Firefox is required, please go to:<br>"+"<a href='http://chrome.google.com'>http://chrome.google.com</a> or <a href='http:www.mozilla.org'>http://www.mozilla.org</a>"}var major=this.majorVersion();if(isChrome&&major<25){return"Your version of Chrome must be upgraded to at least version 25<br>"+"Please go to: <a href='http://chrome.google.com'>http://chrome.google.com</a>"}else{if(isFirefox&&major<22){return"Your version of Firefox must be upgraded to at least version 22y<br>"+"Please go to: <a href='http://www.mozilla.org'>http://www.mozilla.org</a>"}configuration.enableStats=false}},isValidUsPstn:function(pstn){pstn=pstn.replace(/-/g,"").replace(/\(/g,"").replace(/\)/g,"");return pstn.match(/^1?\d{10}$/)!==null},majorVersion:function(){return adapter.webrtcDetectedVersion},isChrome:function(){return adapter.webrtcDetectedBrowser==="chrome"},isFirefox:function(){return adapter.webrtcDetectedBrowser==="firefox"},rebindListeners:function(type,elements,listener){for(var i=0;i<elements.length;i++){this.rebindListener(type,elements[i],listener)}},rebindListener:function(type,element,listener){element.off(type);element.on(type,listener)},colorNameToHex:function(color){if(!color){return false}var colors={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"transparent"};if(typeof colors[color.toLowerCase()]!=="undefined"){return colors[color.toLowerCase()]}return this.isHexColor(color)?color.indexOf("#")!==-1?color:"#"+color:false},isHexColor:function(color){return/(^#?[0-9A-F]{6}$)|(^#?[0-9A-F]{3}$)/i.test(color)},parseDTMFTones:function(destination){if(!destination){return null}var dtmfMatch=destination.match(/,[0-9A-D#*,]+/,"");return dtmfMatch?dtmfMatch[0]:null}};module.exports=Utils},{"./adapter":457}],456:[function(require,module,exports){var ExSIP=require("exsip");var jQuery=jquery=$=require("jquery");require("jquery.cookie");var Client=require("./views/client");var Constants=require("./Constants");var Utils=require("./Utils");var ClientConfig=require("../js/client-config.js.default");var WebRTC={Client:Client,Utils:Utils,C:Constants,Sound:require("./models/sound")};module.exports=WebRTC;Object.defineProperties(WebRTC,{version:{get:function(){return"<%= pkg.version %>"}},name:{get:function(){return"<%= pkg.title %>"}}});var currentScript=$("script").last();$(document).ready(function(){window.BroadSoftWebRTC=window.BroadSoftWebRTC||{};window.BroadSoftWebRTC.clients=[];if(!currentScript.text()){return}var configData=JSON.parse(currentScript.text());console.log("script config : ",configData);var clientConfig=Utils.clone(ClientConfig);var options=$.extend({},clientConfig,configData);console.log("options : ",options);options.id=options.id||window.BroadSoftWebRTC.clients.length===0&&"default"||Utils.rstring();var client=require("./factory")(Client)(options);client.appendTo(currentScript.parent());var styleData=currentScript.data();if(styleData){client.updateCss(styleData)}client.src=currentScript[0].src;currentScript.remove();window.BroadSoftWebRTC.clients.push(client)});(function($){$.isBlank=function(obj){return!obj||$.trim(obj)===""}})(jQuery);if(typeof String.prototype.endsWith!=="function"){String.prototype.endsWith=function(suffix){return this.indexOf(suffix,this.length-suffix.length)!==-1}}},{"../js/client-config.js.default":1,"./Constants":452,"./Utils":455,"./factory":459,"./models/sound":467,"./views/client":471,exsip:202,jquery:230,"jquery.cookie":229}],457:[function(require,module,exports){"use strict";var RTCPeerConnection=null;var getUserMedia=null;var attachMediaStream=null;var reattachMediaStream=null;var webrtcDetectedBrowser=null;var webrtcDetectedVersion=null;function trace(text){if(text[text.length-1]==="\n"){text=text.substring(0,text.length-1)}if(window.performance){var now=(window.performance.now()/1e3).toFixed(3);console.log(now+": "+text)}else{console.log(text)}}if(typeof navigator!=="undefined"&&navigator.mozGetUserMedia){console.log("This appears to be Firefox");webrtcDetectedBrowser="firefox";webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10);RTCPeerConnection=function(pcConfig,pcConstraints){if(pcConfig&&pcConfig.iceServers){for(var i=0;i<pcConfig.iceServers.length;i++){if(pcConfig.iceServers[i].hasOwnProperty("urls")){pcConfig.iceServers[i].url=pcConfig.iceServers[i].urls;delete pcConfig.iceServers[i].urls}}}return new mozRTCPeerConnection(pcConfig,pcConstraints)};window.RTCSessionDescription=mozRTCSessionDescription;window.RTCIceCandidate=mozRTCIceCandidate;getUserMedia=navigator.mozGetUserMedia.bind(navigator);navigator.getUserMedia=getUserMedia;MediaStreamTrack.getSources=function(successCb){setTimeout(function(){var infos=[{kind:"audio",id:"default",label:"",facing:""},{kind:"video",id:"default",label:"",facing:""}];successCb(infos)},0)};window.createIceServer=function(url,username,password){var iceServer=null;var urlParts=url.split(":");if(urlParts[0].indexOf("stun")===0){iceServer={url:url}}else if(urlParts[0].indexOf("turn")===0){if(webrtcDetectedVersion<27){var turnUrlParts=url.split("?");if(turnUrlParts.length===1||turnUrlParts[1].indexOf("transport=udp")===0){iceServer={url:turnUrlParts[0],credential:password,username:username}}}else{iceServer={url:url,credential:password,username:username}}}return iceServer};window.createIceServers=function(urls,username,password){var iceServers=[];for(var i=0;i<urls.length;i++){var iceServer=window.createIceServer(urls[i],username,password);if(iceServer!==null){iceServers.push(iceServer)}}return iceServers};attachMediaStream=function(element,stream){console.log("Attaching media stream");element.mozSrcObject=stream};reattachMediaStream=function(to,from){console.log("Reattaching media stream");to.mozSrcObject=from.mozSrcObject}}else if(typeof navigator!=="undefined"&&navigator.webkitGetUserMedia){console.log("This appears to be Chrome");webrtcDetectedBrowser="chrome";var result=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(result!==null){webrtcDetectedVersion=parseInt(result[2],10)}else{webrtcDetectedVersion=999}window.createIceServer=function(url,username,password){var iceServer=null;var urlParts=url.split(":");if(urlParts[0].indexOf("stun")===0){iceServer={url:url}}else if(urlParts[0].indexOf("turn")===0){iceServer={url:url,credential:password,username:username}}return iceServer};window.createIceServers=function(urls,username,password){return{urls:urls,credential:password,username:username}
};RTCPeerConnection=function(pcConfig,pcConstraints){return new webkitRTCPeerConnection(pcConfig,pcConstraints)};getUserMedia=navigator.webkitGetUserMedia.bind(navigator);navigator.getUserMedia=getUserMedia;attachMediaStream=function(element,stream){if(typeof element.srcObject!=="undefined"){element.srcObject=stream}else if(typeof element.mozSrcObject!=="undefined"){element.mozSrcObject=stream}else if(typeof element.src!=="undefined"){element.src=URL.createObjectURL(stream)}else{console.log("Error attaching stream to element.")}};reattachMediaStream=function(to,from){to.src=from.src}}else{console.log("Browser does not appear to be WebRTC-capable")}function requestUserMedia(constraints){return new Promise(function(resolve,reject){var onSuccess=function(stream){resolve(stream)};var onError=function(error){reject(error)};try{getUserMedia(constraints,onSuccess,onError)}catch(e){reject(e)}})}if(typeof module!=="undefined"){module.exports={RTCPeerConnection:RTCPeerConnection,getUserMedia:getUserMedia,attachMediaStream:attachMediaStream,reattachMediaStream:reattachMediaStream,webrtcDetectedBrowser:webrtcDetectedBrowser,webrtcDetectedVersion:webrtcDetectedVersion,requestUserMedia:requestUserMedia,trace:trace}}},{}],458:[function(require,module,exports){module.exports=CookieProp;var Prop=require("./prop");var C=require("./Constants");var Utils=require("./Utils");var $=require("jquery");function CookieProp(obj,prop,cookie,expires){var self={};self.__proto__=Prop(obj,prop);var superSet=self.__proto__.__set;cookie=cookie||Utils.camelize(obj._name+" "+self._name);expires=expires||C.EXPIRES;self.__proto__.__init=function(){if(prop.value){obj[self._name]=prop.value()}else{obj[self._name]=$.cookie(cookie)}};self.__proto__.__set=function(value){superSet(value);if(value){$.cookie(cookie,value,{expires:expires})}else{$.removeCookie(cookie)}};return self}},{"./Constants":452,"./Utils":455,"./prop":469,jquery:230}],459:[function(require,module,exports){(function(global){var $=require("jquery");var templates=require("../js/templates");require("./prop");require("./cookieprop");module.exports=Factory;function Factory(constructor){return function(options){require("./models/callcontrol");require("./models/configuration");require("./models/debug");require("./models/eventbus");require("./models/settings");require("./models/sipstack");require("./models/smsprovider");require("./models/sound");require("./models/xmpp");require("./views/authentication");require("./views/client");require("./views/connectionstatus");require("./views/dialpad");require("./views/fileshare");require("./views/history");require("./views/incomingcall");require("./views/messages");require("./views/popup");require("./views/reinvite");require("./views/settings");require("./views/sms");require("./views/stats");require("./views/timer");require("./views/transfer");require("./views/video");require("./views/videobar");require("./views/whiteboard");require("./views/xmpp");global.instances=global.instances||{};var name=functionName(constructor);var id=getId(options,name);if(!global.instances[id]){options=$.extend({},options);var constructorArgs=args(options,constructor);var object=create(constructor,constructorArgs);object._name=name;global.instances[id]=object;if(name.match(/view$/)){var viewName=name.replace("view","");options=options[viewName]||{};object.view=$(options.view||templates[viewName]());(object.elements||[]).forEach(function(element){object[element]=object.view.find(options[element]||"."+element)})}else{Object.keys(object.props||{}).forEach(function(name){var prop=$.extend({name:name},object.props[name]);var type=prop.type||object.props._type||"";require("./"+type+"prop")(object,prop).define()})}constructorArgs.forEach(function(arg){arg._init&&arg._init()});object.init&&object.init(options);object.listeners&&object.listeners()}return global.instances[id]}}var STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;var ARGUMENT_NAMES=/([^\s,]+)/g;var __slice=[].slice;function getId(options,name){var id=options;if(typeof options==="object"){id=options.id}id=id||"default";id=name+"_"+id;return id}function extend(){var consumer=arguments[0],providers=__slice.call(arguments,1),key,i,provider;for(i=0;i<providers.length;++i){provider=providers[i];for(key in provider){if(provider.hasOwnProperty(key)){consumer[key]=provider[key]}}}return consumer}function delegateFunction(toProvider,options){var _toProvider;return function(){_toProvider=_toProvider||toProvider(options);return _toProvider.apply(this,arguments)}}function delegate(toProvider,options,methods,props,receiver){receiver=receiver||{};methods=methods||Object.getOwnPropertyNames(toProvider);var _toProvider;methods.forEach(function(method){receiver[method]=function(){_toProvider=_toProvider||toProvider(options);return _toProvider[method].apply(receiver,arguments)}});props.forEach(function(prop){Object.defineProperty(receiver,prop,{writeable:false,get:function(){_toProvider=_toProvider||toProvider(options);return _toProvider[prop]},set:function(value){_toProvider=_toProvider||toProvider(options);_toProvider[prop]=value}})});receiver._init=function(){_toProvider=_toProvider||toProvider(options)};return receiver}function args(options,constructor){var names=argNames(constructor)||[];return names.map(function(argName){if(argName==="options"){return options}var path;if(argName.match(/view$/i)){path="./views/"+argName.replace(/view$/i,"")}else{if(argName==="debug"){options.name=name}path="./models/"+argName}var arg;var argConstructor=require(path);var obj=argConstructor();if(typeof obj==="function"){arg=delegateFunction(Factory(require(path)),options)}else{var methods=Object.getOwnPropertyNames(obj);var props=obj.elements||Object.keys(obj.props||{});arg=delegate(Factory(require(path)),options,methods,props);arg._name=argName}return arg})}function argNames(fun){var fnStr=fun.toString().replace(STRIP_COMMENTS,"");var result=fnStr.slice(fnStr.indexOf("(")+1,fnStr.indexOf(")")).match(ARGUMENT_NAMES);if(result===null)result=[];return result}function functionName(fun){var ret=fun.toString();ret=ret.substr("function ".length);ret=ret.substr(0,ret.indexOf("("));return ret.toLowerCase()}function create(constructor,argArray){var args=[null].concat(argArray);var factoryFunction=constructor.bind.apply(constructor,args);return new factoryFunction}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../js/templates":2,"./cookieprop":458,"./models/callcontrol":460,"./models/configuration":461,"./models/debug":462,"./models/eventbus":463,"./models/settings":464,"./models/sipstack":465,"./models/smsprovider":466,"./models/sound":467,"./models/xmpp":468,"./prop":469,"./views/authentication":470,"./views/client":471,"./views/connectionstatus":472,"./views/dialpad":473,"./views/fileshare":474,"./views/history":475,"./views/incomingcall":476,"./views/messages":477,"./views/popup":478,"./views/reinvite":479,"./views/settings":480,"./views/sms":481,"./views/stats":482,"./views/timer":483,"./views/transfer":484,"./views/video":485,"./views/videobar":486,"./views/whiteboard":487,"./views/xmpp":488,jquery:230}],460:[function(require,module,exports){module.exports=CallControl;var $=require("jquery");function CallControl(options,eventbus,configuration,sipstack,debug){var self={};self.listeners=function(){eventbus.on("userMediaUpdated",function(e){if(configuration.destination){self.callUri(configuration.destination)}})};self.formatDestination=function(destination,domainTo){if(destination.indexOf("@")===-1){destination=destination+"@"+domainTo}var domain=destination.substring(destination.indexOf("@"));if(domain.indexOf(".")===-1){destination=destination+"."+domainTo}return destination.replace(/,[0-9A-D#*,]+/,"")};self.isValidDestination=function(destination,allowOutside,domainTo){if(!allowOutside&&!new RegExp("[.||@]"+domainTo).test(destination)){return false}return true};self.validateDestination=function(destination){if(!self.isValidDestination(destination,configuration.allowOutside,configuration.domainTo)){eventbus.emit("message",{text:configuration.messageOutsideDomain,level:"alert"});return false}if(destination.indexOf("sip:")===-1){destination="sip:"+destination}return self.formatDestination(destination,configuration.domainTo)};self.callUri=function(destinationToValidate){if(sipstack.getCallState()!==sipstack.C.STATE_CONNECTED){debug("Already in call with state : "+sipstack.getCallState());return}if(destinationToValidate===""){eventbus.message(configuration.messageEmptyDestination,"alert");return}var destination=self.validateDestination(destinationToValidate);if(!destination){debug("destination is not valid : "+destinationToValidate);return}debug("calling destination : "+destination);eventbus.message(configuration.messageCall,"success");eventbus.calling(destination);sipstack.call(destination)};return self}},{jquery:230}],461:[function(require,module,exports){module.exports=Configuration;var Flags={enableHD:1,enableCallControl:2,enableCallTimer:4,enableCallHistory:8,enableFullScreen:16,enableSelfView:32,enableCallStats:64,enableDialpad:128,enableMute:256,enableMessages:512,enableRegistrationIcon:1024,enableConnectionIcon:2048,enableWindowDrag:4096,enableSettings:8192,enableAutoAnswer:16384,enableAutoAcceptReInvite:32768,enableConnectLocalMedia:65536,enableTransfer:131072,enableHold:262144,enableIms:524288};Configuration.Flags=Flags;var Utils=require("../Utils");var WebRTC_C=require("../Constants");var ExSIP=require("exsip");var jQuery=$=require("jquery");if(typeof document==="undefined"){document={}}function Configuration(options,eventbus,debug,settings){var self={};options=options||{};jQuery.extend(self,options);var screenshare=false;var offerToReceiveVideo=true;var bodyBackgroundColor=$("body").css("backgroundColor");self.props={messageEnded:{value:function(){return options.messageEnded}},messageResume:{value:function(){return options.messageResume}},messageHold:{value:function(){return options.messageHold}},messageStarted:{value:function(){return options.messageStarted}},messageConnectionFailed:{value:function(){return options.messageConnectionFailed}},messageProgress:{value:function(){return options.messageProgress}},messageRegistrationFailed:{value:function(){return options.messageRegistrationFailed}},messageRegistered:{value:function(){return options.messageRegistered}},messageUnregistered:{value:function(){return options.messageUnregistered}},messageConnected:{value:function(){return options.messageConnected}},enableConnectLocalMedia:{value:function(){return options.enableConnectLocalMedia}},allowOutside:{value:function(){return options.allowOutside}},domainFrom:{value:function(){debug("domainFrom : "+options.domainFrom);return options.domainFrom}},domainTo:{value:function(){return options.domainTo}},destination:{value:function(){return options.destination||Utils.getSearchVariable("destination")}},networkUserId:{value:function(){return options.networkUserId||Utils.getSearchVariable("networkUserId")}},hd:{value:function(){return Utils.getSearchVariable("hd")==="true"||$.cookie("settingHD")}},audioOnly:{value:function(){return Utils.getSearchVariable("audioOnly")==="true"}},sipDisplayName:{value:function(){var name=options.displayName||Utils.getSearchVariable("name")||$.cookie("settingDisplayName");if(name){name=name.replace(/%20/g," ")}return name}},maxCallLength:{value:function(){return Utils.getSearchVariable("maxCallLength")}},size:{value:function(){return Utils.getSearchVariable("size")||$.cookie("settingsize")||1}},color:{value:function(){return Utils.colorNameToHex(Utils.getSearchVariable("color"))||$.cookie("settingColor")}},enableMessages:{value:function(){return!!!Utils.getSearchVariable("disableMessages")}},features:{value:function(){var features=Utils.getSearchVariable("features");if(features){self.setClientConfigFlags(parseInt(features,10))}}}};self.init=function(options){debug("configuration options : "+ExSIP.Utils.toString(options));debug("configuration : "+ExSIP.Utils.toString(self))};self.listeners=function(audioOnly){eventbus.on("screenshare",function(e){self.screenshare=e.enabled});eventbus.on("started",function(e){delete self.destination})};self.setAudioOnlyOfferAndRec=function(audioOnly){self.audioOnly=audioOnly;offerToReceiveVideo=!audioOnly;sipstack.updateUserMedia()};self.setAudioOnly=function(audioOnly){self.audioOnly=audioOnly;offerToReceiveVideo=true;sipstack.updateUserMedia()};self.getClientConfigFlags=function(){var flags=0;for(var flag in Flags){var value=Flags[flag];if(self[flag]){flags|=value}}return flags};self.setClientConfigFlags=function(flags){for(var flag in Flags){var value=Flags[flag];if(flags&value){self[flag]=true}else{self[flag]=false}}};self.isAudioOnlyView=function(){var views=self.getViews();return views.indexOf("audioOnly")!==-1};self.getViews=function(){var view=Utils.getSearchVariable("view");var views=[];if(self.view){$.merge(views,self.view.split(" "))}if(view){$.merge(views,view.split(" "))}return $.unique(views)};self.getBackgroundColor=function(){return self.color||self.bodyBackgroundColor};self.getPassword=function(){return $.cookie("settingPassword")};self.isAutoAnswer=function(){return settings.autoAnswer};self.getDTMFOptions=function(){return{duration:WebRTC_C.DEFAULT_DURATION,interToneGap:WebRTC_C.DEFAULT_INTER_TONE_GAP}};self.getExSIPOptions=function(){var options={mediaConstraints:{audio:true,video:self.getVideoConstraints()},createOfferConstraints:{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:!self.isAudioOnlyView()&&offerToReceiveVideo}}};return options};self.getMediaConstraints=function(){if(self.screenshare){return{video:{mandatory:{chromeMediaSource:"screen"}}}}else{return{audio:true,video:self.getVideoConstraints()}}};self.getVideoConstraints=function(){if(self.isAudioOnlyView()||self.audioOnly){return false}else{var constraints=self.getResolutionConstraints();return constraints?constraints:true}};self.getResolutionConstraints=function(){if(self.hd===true){return{mandatory:{minWidth:1280,minHeight:720}}}else{var width=settings.getResolutionEncodingWidth();var height=settings.getResolutionEncodingHeight();if(width&&height){if(height<=480){return{mandatory:{maxWidth:width,maxHeight:height}}}else{return{mandatory:{minWidth:width,minHeight:height}}}}else{return false}}};self.getExSIPConfig=function(data){data=data||{};var userid=data.userId||$.cookie("settingUserId")||self.networkUserId||Utils.randomUserid();var sip_uri=encodeURI(userid);if(sip_uri.indexOf("@")===-1){sip_uri=sip_uri+"@"+self.domainFrom}var config={uri:sip_uri,authorization_user:data.authenticationUserId||$.cookie("settingAuthenticationUserId")||userid,ws_servers:self.websocketsServers,stun_servers:"stun:"+self.stunServer+":"+self.stunPort,trace_sip:self.debug,enable_ims:self.enableIms,p_asserted_identity:self.pAssertedIdentity,enable_datachannel:self.enableWhiteboard||self.enableFileShare};if(self.sipDisplayName){config.display_name=self.sipDisplayName}if($.cookie("settingUserId")||self.register){config.register=true;config.password=data.password||$.cookie("settingPassword")}else{config.register=false}return config};self.getRtcMediaHandlerOptions=function(){var options={reuseLocalMedia:self.enableConnectLocalMedia,videoBandwidth:settings.getBandwidth(),disableICE:self.disableICE,RTCConstraints:{optional:[],mandatory:{}}};return options};self.isHD=function(){return self.enableHD===true&&self.hd===true};self.isWidescreen=function(){return self.isHD()||settings.resolutionType===WebRTC_C.WIDESCREEN};self.setResolutionDisplay=function(resolutionDisplay){self.hd=false;settings.setResolutionDisplay(resolutionDisplay);eventbus.viewChanged(self)};self.getResolutionDisplay=function(){return self.isHD()?WebRTC_C.R_1280x720:settings.getResolutionDisplay()};return self}},{"../Constants":452,"../Utils":455,exsip:202,jquery:230}],462:[function(require,module,exports){module.exports=Debug;var stacktrace=require("stacktrace-js");var debug=require("debug");var enabled={};function Debug(options){options=options||{};var id=options&&options.id||options||"";if(options.debug){enabled[id]="*:"+id}else{delete enabled[id]}updateEnabled();return function(msg){var prefix=(options.name||caller())+":"+id;debug(prefix)(msg)}}var caller=function(){var list=stacktrace();for(var i=list.length-1;i>=0;i--){var match=null;if(match=list[i].match(/([A-Z]\S*).*@/g)){if(match!=="Object"){return match}}}return stacktrace().pop().match("(.*)@").pop()};var updateEnabled=function(){var values=[];Object.keys(enabled).forEach(function(key){values.push(enabled[key])});debug.enable(values.join(","))}},{debug:168,"stacktrace-js":231}],463:[function(require,module,exports){module.exports=EventBus;var ee=require("event-emitter");function EventBus(){var self={};var emitter=ee({});self.on=function(type,listener){emitter.on(type,listener)};self.once=function(type,listener){emitter.once(type,listener)};self.emit=function(type,obj){emitter.emit(type,obj)};self.message=function(text,level){self.emit("message",{text:text,level:level})};self.viewChanged=function(view){self.emit("viewChanged",{visible:view.visible,view:view._name.replace(/view$/i,"")})};self.calling=function(destination){self.emit("calling",{destination:destination})};self.modifier=function(which){self.emit("modifier",{which:which})};self.screenshare=function(enabled){self.emit("screenshare",{enabled:enabled})};self.signIn=function(){self.emit("signIn")};self.signOut=function(){self.emit("signOut")};return self}},{"event-emitter":175}],464:[function(require,module,exports){module.exports=Settings;var WebRTC_C=require("../Constants");var Utils=require("../Utils");function Settings(options,configuration,settingsView,eventbus,debug){var self={};self.view=settingsView;var updatePageColor=function(){var color=configuration.getBackgroundColor();debug("updating page color : "+color);$("body").css("backgroundColor",color||"")};var isStarted=false;self.changed=false;self.init=function(options){updatePageColor()};self.listeners=function(){eventbus.on("ended",function(){isStarted=false;if(self.changed){self.reload()}});eventbus.on("started",function(){isStarted=true})};self.getBandwidth=function(){var height=self.getResolutionEncodingHeight();if(height<=240){return self.bandwidthLow}else if(height<=480){return self.bandwidthMed}else if(height<=720){return self.bandwidthHigh}};self.reload=function(){location.reload(0)};self.getResolutionDisplay=function(){debug("+++++++++++++"+$.cookie("settingResolutionDisplay"));return self.getResolution("resolutionDisplayStandard","resolutionDisplayWidescreen")};self.getResolutionEncoding=function(){return self.getResolution("resolutionEncodingStandard","resolutionEncodingWidescreen")};self.getResolutionEncodingWidth=function(){var resolution=self.getResolutionEncoding();if(!$.isBlank(resolution)){var resolutions=resolution.split("x");return parseInt(resolutions[0],10)}};self.getResolutionEncodingHeight=function(){var resolution=self.getResolutionEncoding();if(!$.isBlank(resolution)){var resolutions=resolution.split("x");return parseInt(resolutions[1],10)}};self.getResolution=function(resolutionStandard,resolutionWidescreen){if(self.resolutionType===WebRTC_C.STANDARD){return self[resolutionStandard]}else if(self.resolutionType===WebRTC_C.WIDESCREEN){return self[resolutionWidescreen]}else{return false}};self.setResolutionDisplay=function(resolution){self.setResolution(resolution,"resolutionDisplayStandard","resolutionDisplayWidescreen")};self.setResolutionEncoding=function(resolution){self.setResolution(resolution,"resolutionEncodingStandard","resolutionEncodingWidescreen")};self.setResolution=function(resolution,resolutionStandard,resolutionWidescreen){if(Utils.containsKey(WebRTC_C.STANDARD_RESOLUTIONS,resolution)){self.resolutionType=WebRTC_C.STANDARD;self[resolutionStandard]=resolution}else if(Utils.containsKey(WebRTC_C.WIDESCREEN_RESOLUTIONS,resolution)){self.resolutionType=WebRTC_C.WIDESCREEN;self[resolutionWidescreen]=resolution}else{debug("no resolution type for "+resolution)}settingsView.updateResolutionSelectVisibility()};self.changed=function(){if(!isStarted){self.reload()}else{self.changed=true}};self.save=function(){self.persist();view.hide();self.changed()};self.signIn=function(){self.persist();eventbus.signIn();view.enableRegistration(false)};self.signOut=function(){eventbus.signOut();self.clearConfigurationCookies();view.enableRegistration(false)};self.resetLayout=function(){self.resolutionEncoding=WebRTC_C.DEFAULT_RESOLUTION_ENCODING;self.resolutionDisplay=WebRTC_C.DEFAULT_RESOLUTION_DISPLAY;eventbus.viewChanged(self)};self.clearConfigurationCookies=function(){$.removeCookie("settingDisplayName");$.removeCookie("settingUserid");$.removeCookie("settingAuthenticationUserid");$.removeCookie("settingPassword")};self.clearConfiguration=function(){self.displayName=null;self.userid=null;self.authenticationUserid=null;self.password=null};self.clear=function(){for(var name in self.props){self[name]=null}};self.persist=function(){for(var name in self.props){self[name]=self[name]}};self.props={_type:"cookie",userid:true,password:true,authenticationUserid:true,resolutionType:true,displayName:{value:function(){return configuration.sipDisplayName||$.cookie("settingDisplayName")}},selfViewDisabled:{value:function(){return $.cookie("selfViewDisable")==="true"}},hd:{value:function(){return $.cookie("hd")==="true"}},bandwidthLow:{value:function(){return configuration.bandwidthLow||$.cookie("settingBandwidthLow")}},bandwidthMed:{value:function(){return configuration.bandwidthMed||$.cookie("settingBandwidthMed")}},bandwidthHigh:{value:function(){return configuration.bandwidthHigh||$.cookie("settingBandwidthHigh")}},color:{value:function(){return configuration.getBackgroundColor()},"default":"#ffffff"},resolutionDisplayStandard:true,resolutionDisplayWidescreen:true,resolutionEncodingStandard:true,resolutionEncodingWidescreen:true,resolutionDisplay:{get:function(){return self.getResolution("resolutionDisplayStandard","resolutionDisplayWidescreen")},set:function(resolution){self.setResolution(resolution,"resolutionDisplayStandard","resolutionDisplayWidescreen")},value:function(){debug("+++++++++++++ : "+configuration.displayResolution);debug("+++++++++++++ : "+$.cookie("settingResolutionDisplay"));return configuration.displayResolution||$.cookie("settingResolutionDisplay")||WebRTC_C.DEFAULT_RESOLUTION_DISPLAY}},resolutionEncoding:{get:function(){return self.getResolution("resolutionEncodingStandard","resolutionEncodingWidescreen")},set:function(resolution){self.setResolution(resolution,"resolutionEncodingStandard","resolutionEncodingWidescreen")},value:function(){return configuration.encodingResolution||$.cookie("settingResolutionEncoding")||WebRTC_C.DEFAULT_RESOLUTION_ENCODING}},size:{value:function(){return configuration.size||$.cookie("size")}},autoAnswer:{value:function(){return $.cookie("autoAnswer")==="true"}},windowPosition:{get:function(){return".localVideo"+"-"+self.localVideoTop.val()+"-"+self.localVideoLeft.val()+"|"+".callHistory"+"-"+self.callHistoryTop.val()+"-"+self.callHistoryLeft.val()+"|"+".callStats"+"-"+self.callStatsTop.val()+"-"+self.callStatsLeft.val()},set:function(val){}}};return self}},{"../Constants":452,"../Utils":455}],465:[function(require,module,exports){module.exports=SIPStack;var ExSIP=require("exsip");function SIPStack(options,eventbus,debug,configuration,settings){var self={};self.ua=null;self.activeSession=null;var sessions=[];var C=self.C={STATE_CONNECTED:"connected",STATE_DISCONNECTED:"disconnected",STATE_CALLING:"calling",STATE_STARTED:"started",STATE_HELD:"held"};var setActiveSession=function(session){debug("setting active session to "+session.id);self.activeSession=session};self.listeners=function(){eventbus.on("signOut",function(e){self.unregister()});eventbus.on("signIn",function(e){self.init()});eventbus.on("connected",function(e){self.updateUserMedia()});eventbus.on("resumed",function(e){setActiveSession(e.sender)});eventbus.on("started",function(e){setActiveSession(e.sender);var dtmfTones=Utils.parseDTMFTones(configuration.destination);if(dtmfTones&&e.data&&!e.data.isReconnect){debug("DTMF tones found in destination - sending DTMF tones : "+dtmfTones);self.sendDTMF(dtmfTones)}});eventbus.on("authenticate",function(e){self.init(e)})};self.getLocalStreams=function(){return self.activeSession?self.activeSession.getLocalStreams():null};self.getRemoteStreams=function(){return self.activeSession?self.activeSession.getRemoteStreams():null};self.getSessionId=function(){return self.activeSession.id.replace(/\./g,"")};self.terminateSession=function(session){session=session||self.activeSession;if(!session){return}var index=sessions.indexOf(session);if(index!==-1){sessions.splice(index,index+1)}if(session.status!==ExSIP.RTCSession.C.STATUS_TERMINATED){session.terminate()}if(session===self.activeSession){debug("clearing active session");self.activeSession=null}eventbus.viewChanged(self)};self.terminateSessions=function(){var allSessions=[];allSessions=allSessions.concat(sessions);for(var i=0;i<allSessions.length;i++){self.terminateSession(allSessions[i])}};self.holdAndAnswer=function(session){var firstSession=self.activeSession;session.on("ended",function(){eventbus.emit("message",{text:"Resuming with "+firstSession.remote_identity.uri.user,level:"normal"});debug("incoming call ended - unholding first call");firstSession.unhold(function(){debug("unhold first call successful")})});self.activeSession.hold(function(){debug("hold successful - answering incoming call");self.answer(session)})};self.answer=function(session){session.answer(configuration.getExSIPOptions())};self.hold=function(successCallback,failureCallback){if(self.activeSession){self.activeSession.hold(successCallback,failureCallback)}};self.unhold=function(successCallback,failureCallback){if(self.activeSession){self.activeSession.unhold(successCallback,failureCallback)}};self.reconnectUserMedia=function(successCallback,failureCallback){var onUserMediaUpdateSuccess=function(localMedia){debug("reconnect user media successful");if(self.activeSession){self.activeSession.changeSession({localMedia:localMedia},function(){debug("session changed successfully");if(successCallback){successCallback(localMedia)}},failureCallback)}else if(successCallback){successCallback(localMedia)}};self.updateUserMedia(onUserMediaUpdateSuccess,failureCallback)};self.call=function(destination){var session=self.ua.call(destination,configuration.getExSIPOptions());session.on("failed",function(e){eventbus.emit("failed",e.data)});eventbus.emit("calling",session)};self.sendDTMF=function(digit){self.activeSession.sendDTMF(digit,configuration.getDTMFOptions())};self.isStarted=function(){return self.getCallState()===C.STATE_STARTED};self.unregister=function(){return self.ua&&self.ua.unregister()};self.register=function(){return self.ua&&self.ua.register()};self.isRegistered=function(){return self.ua&&self.ua.isRegistered()};self.sendData=function(data){if(self.activeSession){self.activeSession.sendData(data)}};self.transfer=function(transferTarget,isAttended){if(isAttended){self.ua.attendedTransfer(transferTarget,self.activeSession)}else{self.ua.transfer(transferTarget,self.activeSession)}};self.updateRtcMediaHandlerOptions=function(){if(typeof self.ua==="undefined"){return}self.ua.setRtcMediaHandlerOptions(configuration.getRtcMediaHandlerOptions())};self.getCallState=function(){if(sessions.length>0){if(sessions.length===1&&!sessions[0].isStarted()){return C.STATE_CALLING}else{if(self.activeSession&&self.activeSession.isHeld()){return C.STATE_STARTED+" "+C.STATE_HELD}else{return C.STATE_STARTED}}}else{if(self.ua&&self.ua.isConnected&&self.ua.isConnected()){return C.STATE_CONNECTED}else{return C.STATE_DISCONNECTED}}};self.updateUserMedia=function(userMediaCallback,failureCallback){debug("updateUserMedia : "+configuration.disabled+", "+configuration.enableConnectLocalMedia+", "+self.activeSession);if(!configuration.disabled&&(configuration.enableConnectLocalMedia||self.activeSession)){var options=configuration.getExSIPOptions();debug("updating user media ...");self.ua.getUserMedia(options,function(localStream){eventbus.emit("userMediaUpdated",localStream);if(self.activeSession){debug("changing active session ...");self.activeSession.changeSession({localMedia:localStream,createOfferConstraints:options.createOfferConstraints},function(){debug("change session succeeded")},function(){debug("change session failed")})}if(userMediaCallback){userMediaCallback(localStream)}},function(e){eventbus.emit("message",{text:configuration.messageGetUserMedia||"Get User Media Failed",level:"alert"});if(failureCallback){failureCallback(e)}},true)}};self.incomingReInvite=function(e){if(configuration.enableAutoAcceptReInvite){debug("auto accepting reInvite");e.data.session.acceptReInvite()}else{console.log("@@@@@@@@@@@@@ emit reinvite : ",e.data);eventbus.emit("reInvite",e.data)}};self.incomingCall=function(evt){var session=evt.data.session;if(!self.activeSession&&configuration.isAutoAnswer()){session.answer(configuration.getExSIPOptions())}else{eventbus.emit("incomingCall",evt)}};self.init=function(data){try{if(self.ua){debug("stopping existing UA");self.ua.stop()}if(configuration.disabled){debug("sipstack disabled");return}self.ua=new ExSIP.UA(configuration.getExSIPConfig(data));self.updateRtcMediaHandlerOptions();self.ua.start();self.ua.on("connected",function(e){eventbus.viewChanged(self);var hasListeners=require("event-emitter/has-listeners");debug("$$$$$$$$$$ connected : "+hasListeners(eventbus,"connected"));eventbus.emit("connected",e)});self.ua.on("disconnected",function(e){eventbus.viewChanged(self);eventbus.emit("disconnected",e)});self.ua.on("onReInvite",function(e){debug("incoming onReInvite event");self.incomingReInvite(e)});self.ua.on("newRTCSession",function(e){var session=e.data.session;sessions.push(session);eventbus.viewChanged(self);session.on("progress",function(e){eventbus.emit("progress",e)});session.on("failed",function(e){eventbus.emit("failed",e)});session.on("started",function(e){eventbus.viewChanged(self);eventbus.emit("started",e)});session.on("resumed",function(e){eventbus.viewChanged(self);eventbus.emit("resumed",e)});session.on("held",function(e){eventbus.viewChanged(self);eventbus.emit("held",e)});session.on("ended",function(e){eventbus.emit("ended",e)});session.on("newDTMF",function(e){eventbus.emit("newDTMF",e)});session.on("dataSent",function(e){eventbus.emit("dataSent",e)});session.on("dataReceived",function(e){eventbus.emit("dataReceived",e)});if(e.data.session.direction==="incoming"){self.incomingCall(e)}else{if(!self.activeSession){debug("new active session : "+session.id);self.activeSession=session}}});self.ua.on("registered",function(){eventbus.emit("registered")});self.ua.on("unregistered",function(){eventbus.emit("unregistered")});self.ua.on("registrationFailed",function(e){eventbus.emit("registrationFailed",e)})}catch(e){debug(e.stack);debug("could not init sip stack")}};return self}},{"event-emitter/has-listeners":174,exsip:202}],466:[function(require,module,exports){module.exports=SMSProvider;var ExSIP=require("exsip");function SMSProvider(eventbus,debug){var self={};self.send=function(type,restSuffix,jsonData,successCallback,failureCallback,isJsonp){var url="http://"+ClientConfig.smsHost+"/"+ClientConfig.smsUser+"/"+restSuffix;if(self.sessionid){url+=";jsessionid="+self.sessionid}debug("Request to "+url+" : "+ExSIP.Utils.toString(jsonData));$.ajax({crossDomain:true,contentType:type==="GET"?"text/plain":"text/plain",dataType:isJsonp?"jsonp":"json",type:type,url:url,data:type==="GET"?jsonData:JSON.stringify(jsonData)}).done(function(msg){if(msg.status==="empty"||msg.status==="success"||msg.status.code==="0000001"){debug("Response successful : "+ExSIP.Utils.toString(msg));if(successCallback){successCallback(msg)}}else{debug("Response failed : "+ExSIP.Utils.toString(msg));if(failureCallback){failureCallback(msg.status.message)
}}}).fail(function(jqXHR,textStatus){debug("Response error : "+textStatus);if(failureCallback){failureCallback(textStatus)}})};self.getUpdate=function(onNotification,onFailure){var onSuccess=function(msg){debug("received notification : "+ExSIP.Utils.toString(msg));onNotification(msg.notifications)};var data={fid:self.name,platform:"fmc"};self.send("GET","getUpdate",data,onSuccess,onFailure,false)};self.sendSMS=function(desttnarray,body,onFailure){var onSuccess=function(msg){debug("sent msg "+msg+" to "+desttnarray);eventbus.emit("smsSent",{desttnarray:desttnarray,body:body})};var data={desttnarray:desttnarray,body:body};self.send("POST","ua/msg/sms/send",data,onSuccess,onFailure)};self.remove=function(mids,onSuccess,onFailure){var data={mids:mids};self.send("POST","ua/msg/sms/delete",data,function(){debug("Deleted msgs : "+mids);if(onSuccess){onSuccess()}},onFailure)};self.readAll=function(onFailure){var onSuccess=function(msg){debug("Read all mgs : "+ExSIP.Utils.toString(msg.messages));eventbus.emit("smsReadAll",{messages:msg.messages})};var data=null;self.send("GET","ua/msg/sms/all",data,onSuccess,onFailure)};self.login=function(name,password,onFailure){var onSuccess=function(msg){self.sessionid=msg.sessionid;self.name=name;debug("Logged in "+name+" : "+msg.sessionid);eventbus.emit("smsLoggedIn")};var data={spcode:ClientConfig.smsSpcode,password:password,name:name,platform:"fmc"};self.send("POST","ua/login",data,onSuccess,onFailure)};return self}},{exsip:202}],467:[function(require,module,exports){(function(__dirname){module.exports=Sound;var $=require("jquery");function Sound(options,eventbus,configuration,sipstack){var self={};var soundOut;var soundOutDTMF;var muted=false;self.init=function(){soundOut=$("<audio>",{volume:configuration.volumeClick}).appendTo($("body"));soundOutDTMF=$("<audio>",{volume:configuration.volumeDTMF}).appendTo($("body"))};self.listeners=function(){eventbus.on("progress",function(e){self.playDtmfRingback()});eventbus.on("failed",function(e){self.pause()});eventbus.on("resumed",function(){self.pause();self.updateLocalAudio()});eventbus.on("started",function(){self.pause();self.updateLocalAudio()});eventbus.on("userMediaUpdated",function(){self.updateLocalAudio()});eventbus.on("newDTMF",function(e){var digit=e.data.tone;debug("DTMF sent : "+digit);if(!digit){return}var file=null;if(digit==="*"){file="star"}else if(digit==="#"){file="pound"}else{file=digit}self.playDtmfTone(file)})};self.setMuted=function(m){muted=m;eventbus.viewChanged(self);self.updateLocalAudio()};self.updateLocalAudio=function(){self.enableLocalAudio(!muted)};self.enableLocalAudio=function(enabled){var localStreams=sipstack.getLocalStreams();if(!localStreams||localStreams.length===0){return}var localMedia=localStreams[0];var localAudio=localMedia.getAudioTracks()[0];localAudio.enabled=enabled};self.pause=function(){soundOut.trigger("pause");soundOutDTMF.trigger("pause")};self.playDtmfRingback=function(){self.playDtmf("dtmf-ringback",{loop:true})};self.playRingtone=function(){self.play("ringtone",{loop:true})};self.playDtmfTone=function(tone){self.playDtmf("dtmf-"+tone)};self.playClick=function(){self.play("click")};self.play=function(media,options){self.playTone(soundOut,media,options)};self.playTone=function(audioSource,media,options){if(audioSource.attr("src")===media&&!audioSource[0].paused){return}options=options||{};var media=fs.readFileSync(__dirname+"/../../media/"+media+".ogg","base64");audioSource.attr("src",media);if(options.loop){audioSource.attr("loop","true")}else{audioSource.attr("loop","")}audioSource.trigger("play")};self.playDtmf=function(media,options){self.playTone(soundOutDTMF,media,options)};return self}}).call(this,"/src/models")},{jquery:230}],468:[function(require,module,exports){module.exports=XMPP;var XMPP=require("stanza.io");function XMPP(options,debug,eventbus){var self={};var client;self.login=function(jid,password){client=XMPP.createClient({jid:jid,password:password,transport:"bosh",boshURL:"broadsoft.com"});return client};self.init=function(){};self.listeners=function(){var self=this;eventbus.on("started",function(){});eventbus.on("ended",function(){})};return self}},{"stanza.io":232}],469:[function(require,module,exports){module.exports=Prop;function Prop(obj,prop){var self={};self._name=prop.name||prop;var internal;var data=obj.view&&obj.view[self._name]||function(value){if(arguments.length===1){internal=value}else{return internal}};self.__get=function(){if(data.val){return data.val()}else if(data.prop){return data.prop("checked")}else{return data()}};self.__init=function(){if(prop.value){obj[self._name]=prop.value()}};self.__set=function(value){if(prop.default&&!value){value=prop.default}if(data.val){data.val(value)}else if(data.prop){data.prop("checked",value)}else{data(value)}};self.define=function(){Object.defineProperty(obj,self._name,{writeable:false,get:prop.get||self.__get,set:prop.set||self.__set});self.__init()};return self}},{}],470:[function(require,module,exports){module.exports=AuthenticationView;var $=require("jquery");var PopupView=require("./popup");function AuthenticationView(options,eventbus,settings,configuration,debug){var self={};self.__proto__=PopupView(options,self,eventbus);self.elements=["ok","userid","authUserid","password","alert"];self.listeners=function(){eventbus.on("registrationFailed",function(e){var statusCode=e.data.response.status_code;debug("registration failed : "+statusCode+", "+settings.userid+", "+settings.password);if(statusCode===403&&settings.userid&&!settings.password||configuration.register){self.setVisible(true)}});eventbus.on("viewChanged",function(e){if(e.view==="authentication"&&e.visible){self.authUserid.val(settings.authenticationUserid);self.userid.val(settings.userid)}});self.ok.bind("click",function(){var userId=self.userid.val();if(!userId){self.alert.text("Invalid User ID").fadeIn(10).fadeOut(4e3);return}var authUserId=self.authUserid.val();var password=self.password.val();self.setVisible(false);eventbus.emit("authenticate",{userId:userId,authenticationUserId:authUserId,password:password});eventbus.once("registered",function(){if(authUserId&&settings.userid!==authUserId){settings.authenticationUserid=authUserId}settings.userid=userId;settings.password=password})});self.view.bind("keypress",function(e){if(e.which===13){self.ok.click()}})};return self}},{"./popup":478,jquery:230}],471:[function(require,module,exports){module.exports=ClientView;var styles='.bdsft-reset{font-size:14px;font:normal normal 14px Open Sans,Arial,sans-serif}.bdsft-reset div,.bdsft-reset span,.bdsft-reset applet,.bdsft-reset object,.bdsft-reset iframe,.bdsft-reset h1,.bdsft-reset h2,.bdsft-reset h3,.bdsft-reset h4,.bdsft-reset h5,.bdsft-reset h6,.bdsft-reset p,.bdsft-reset blockquote,.bdsft-reset pre,.bdsft-reset a,.bdsft-reset abbr,.bdsft-reset acronym,.bdsft-reset address,.bdsft-reset big,.bdsft-reset cite,.bdsft-reset code,.bdsft-reset del,.bdsft-reset dfn,.bdsft-reset em,.bdsft-reset img,.bdsft-reset ins,.bdsft-reset kbd,.bdsft-reset q,.bdsft-reset s,.bdsft-reset samp,.bdsft-reset small,.bdsft-reset strike,.bdsft-reset strong,.bdsft-reset sub,.bdsft-reset sup,.bdsft-reset tt,.bdsft-reset var,.bdsft-reset b,.bdsft-reset u,.bdsft-reset i,.bdsft-reset center,.bdsft-reset dl,.bdsft-reset dt,.bdsft-reset dd,.bdsft-reset ol,.bdsft-reset ul,.bdsft-reset li,.bdsft-reset fieldset,.bdsft-reset form,.bdsft-reset div.form,.bdsft-reset label,.bdsft-reset legend,.bdsft-reset table,.bdsft-reset caption,.bdsft-reset tbody,.bdsft-reset tfoot,.bdsft-reset thead,.bdsft-reset tr,.bdsft-reset th,.bdsft-reset td,.bdsft-reset article,.bdsft-reset aside,.bdsft-reset canvas,.bdsft-reset details,.bdsft-reset figcaption,.bdsft-reset figure,.bdsft-reset footer,.bdsft-reset header,.bdsft-reset hgroup,.bdsft-reset menu,.bdsft-reset nav,.bdsft-reset section,.bdsft-reset summary,.bdsft-reset time,.bdsft-reset mark,.bdsft-reset audio,.bdsft-reset video,.bdsft-reset button,.bdsft-reset textarea,.bdsft-reset input{font-size:100%;font:normal normal 100% Open Sans,Arial,sans-serif}.bdsft-reset,.bdsft-reset div,.bdsft-reset span,.bdsft-reset applet,.bdsft-reset object,.bdsft-reset iframe,.bdsft-reset h1,.bdsft-reset h2,.bdsft-reset h3,.bdsft-reset h4,.bdsft-reset h5,.bdsft-reset h6,.bdsft-reset p,.bdsft-reset blockquote,.bdsft-reset pre,.bdsft-reset a,.bdsft-reset abbr,.bdsft-reset acronym,.bdsft-reset address,.bdsft-reset big,.bdsft-reset cite,.bdsft-reset code,.bdsft-reset del,.bdsft-reset dfn,.bdsft-reset em,.bdsft-reset img,.bdsft-reset ins,.bdsft-reset kbd,.bdsft-reset q,.bdsft-reset s,.bdsft-reset samp,.bdsft-reset small,.bdsft-reset strike,.bdsft-reset strong,.bdsft-reset sub,.bdsft-reset sup,.bdsft-reset tt,.bdsft-reset var,.bdsft-reset b,.bdsft-reset u,.bdsft-reset i,.bdsft-reset center,.bdsft-reset dl,.bdsft-reset dt,.bdsft-reset dd,.bdsft-reset ol,.bdsft-reset ul,.bdsft-reset li,.bdsft-reset fieldset,.bdsft-reset form,.bdsft-reset div.form,.bdsft-reset label,.bdsft-reset legend,.bdsft-reset table,.bdsft-reset caption,.bdsft-reset tbody,.bdsft-reset tfoot,.bdsft-reset thead,.bdsft-reset tr,.bdsft-reset th,.bdsft-reset td,.bdsft-reset article,.bdsft-reset aside,.bdsft-reset canvas,.bdsft-reset details,.bdsft-reset figcaption,.bdsft-reset figure,.bdsft-reset footer,.bdsft-reset header,.bdsft-reset hgroup,.bdsft-reset menu,.bdsft-reset nav,.bdsft-reset section,.bdsft-reset summary,.bdsft-reset time,.bdsft-reset mark,.bdsft-reset audio,.bdsft-reset video,.bdsft-reset button,.bdsft-reset textarea,.bdsft-reset input{font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal;alignment-adjust:auto;alignment-baseline:baseline;-webkit-animation:none 0 ease 0 1 normal;-moz-animation:none 0 ease 0 1 normal;-ms-animation:none 0 ease 0 1 normal;animation:none 0 ease 0 1 normal;-webkit-animation-play-state:running;-moz-play-state:running;-ms-animation-play-state:running;animation-play-state:running;appearance:normal;azimuth:center;backface-visibility:visible;background:none 0 0 auto repeat scroll padding-box transparent;background-color:transparent;background-image:none;baseline-shift:baseline;binding:none;bleed:6pt;bookmark-label:content();bookmark-level:none;bookmark-state:open;bookmark-target:none;border:0 none transparent;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;bottom:auto;box-align:stretch;box-decoration-break:slice;box-direction:normal;box-flex:0;box-flex-group:1;box-lines:single;box-ordinal-group:1;box-orient:inline-axis;box-pack:start;-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;break-after:auto;break-before:auto;break-inside:auto;caption-side:top;clear:none;clip:auto;color:inherit;color-profile:auto;-webkit-column-count:auto;-webkit-column-fill:balance;-webkit-column-gap:normal;-webkit-column-rule:medium medium #1f1f1f;-webkit-column-span:1;-webkit-column-width:auto;-webkit-columns:auto auto;-moz-column-count:auto;-moz-column-fill:balance;-moz-column-gap:normal;-moz-column-rule:medium medium #1f1f1f;-moz-column-span:1;-moz-column-width:auto;-moz-columns:auto auto;column-count:auto;column-fill:balance;column-gap:normal;column-rule:medium medium #1f1f1f;column-span:1;column-width:auto;columns:auto auto;content:normal;counter-increment:none;counter-reset:none;crop:auto;cursor:auto;direction:ltr;display:inline;dominant-baseline:auto;drop-initial-after-adjust:text-after-edge;drop-initial-after-align:baseline;drop-initial-before-adjust:text-before-edge;drop-initial-before-align:caps-height;drop-initial-size:auto;drop-initial-value:initial;elevation:level;empty-cells:show;fit:fill;fit-position:0;float:none;float-offset:0;grid-columns:none;grid-rows:none;hanging-punctuation:none;height:auto;hyphenate-after:auto;hyphenate-before:auto;hyphenate-character:auto;hyphenate-lines:no-limit;hyphenate-resource:none;hyphens:manual;icon:auto;image-orientation:auto;image-rendering:auto;image-resolution:normal;inline-box-align:last;left:auto;line-height:inherit;line-stacking:inline-line-height exclude-ruby consider-shifts;list-style:disc outside none;margin:0;marks:none;marquee-direction:forward;marquee-loop:1;marquee-play-count:1;marquee-speed:normal;marquee-style:scroll;max-height:none;max-width:none;min-height:0;min-width:0;move-to:normal;nav-down:auto;nav-index:auto;nav-left:auto;nav-right:auto;nav-up:auto;opacity:1;orphans:2;outline:invert none medium;outline-offset:0;overflow:visible;overflow-style:auto;padding:0;page:auto;page-break-after:auto;page-break-before:auto;page-break-inside:auto;page-policy:start;perspective:none;perspective-origin:50% 50%;position:static;presentation-level:0;punctuation-trim:none;quotes:none;rendering-intent:auto;resize:none;right:auto;rotation:0;rotation-point:50% 50%;ruby-align:auto;ruby-overhang:none;ruby-position:before;ruby-span:none;size:auto;string-set:none;table-layout:auto;top:auto;-webkit-transform:none;-moz-transform:none;transform:none;-webkit-transform-origin:50% 50%;-moz-transform-origin:50% 50%;-o-transform-origin:50% 50%;transform-origin:50% 50% 0;transform-style:flat;-webkit-transition:all 0 ease 0;-moz-transition:all 0 ease 0;-o-transition:all 0 ease 0;transition:all 0 ease 0;unicode-bidi:normal;vertical-align:baseline;white-space:normal;white-space-collapse:collapse;widows:2;width:auto;word-break:normal;word-spacing:normal;word-wrap:normal;z-index:auto;text-align:start}.bdsft-reset address,.bdsft-reset blockquote,.bdsft-reset dd,.bdsft-reset div,.bdsft-reset dl,.bdsft-reset dt,.bdsft-reset fieldset,.bdsft-reset form,.bdsft-reset div.form,.bdsft-reset frame,.bdsft-reset frameset,.bdsft-reset h1,.bdsft-reset h2,.bdsft-reset h3,.bdsft-reset h4,.bdsft-reset h5,.bdsft-reset h6,.bdsft-reset noframes,.bdsft-reset ol,.bdsft-reset p,.bdsft-reset ul,.bdsft-reset center,.bdsft-reset dir,.bdsft-reset hr,.bdsft-reset menu,.bdsft-reset pre,.bdsft-reset article,.bdsft-reset aside,.bdsft-reset canvas,.bdsft-reset details,.bdsft-reset figcaption,.bdsft-reset figure,.bdsft-reset footer,.bdsft-reset header,.bdsft-reset hgroup,.bdsft-reset nav,.bdsft-reset section,.bdsft-reset summary{display:block}.bdsft-reset li{display:list-item}.bdsft-reset table{display:table}.bdsft-reset tr{display:table-row}.bdsft-reset thead{display:table-header-group}.bdsft-reset tbody{display:table-row-group}.bdsft-reset tfoot{display:table-footer-group}.bdsft-reset col{display:table-column}.bdsft-reset colgroup{display:table-column-group}.bdsft-reset td,.bdsft-reset th{display:table-cell}.bdsft-reset caption{display:table-caption}.bdsft-reset input,.bdsft-reset select{display:inline-block}.bdsft-reset b,.bdsft-reset strong,.bdsft-reset strong>*{font-weight:bold}.bdsft-reset textarea,.bdsft-reset input{cursor:text}.bdsft-reset textarea .bdsft-reset textarea::-webkit-input-placeholder,.bdsft-reset input .bdsft-reset textarea::-webkit-input-placeholder,.bdsft-reset textarea .bdsft-reset input::-webkit-input-placeholder,.bdsft-reset input .bdsft-reset input::-webkit-input-placeholder{background-color:inherit;color:inherit;font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-size:100%;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;font:normal normal 100% Open Sans,Arial,sans-serif;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal}.bdsft-reset textarea .bdsft-reset textarea:-moz-placeholder,.bdsft-reset input .bdsft-reset textarea:-moz-placeholder,.bdsft-reset textarea .bdsft-reset input:-moz-placeholder,.bdsft-reset input .bdsft-reset input:-moz-placeholder{background-color:inherit;color:inherit;font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-size:100%;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;font:normal normal 100% Open Sans,Arial,sans-serif;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal}.bdsft-reset textarea .bdsft-reset textarea::-moz-placeholder,.bdsft-reset input .bdsft-reset textarea::-moz-placeholder,.bdsft-reset textarea .bdsft-reset input::-moz-placeholder,.bdsft-reset input .bdsft-reset input::-moz-placeholder{background-color:inherit;color:inherit;font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-size:100%;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;font:normal normal 100% Open Sans,Arial,sans-serif;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal}.bdsft-reset textarea .bdsft-reset textarea:-ms-input-placeholder,.bdsft-reset input .bdsft-reset textarea:-ms-input-placeholder,.bdsft-reset textarea .bdsft-reset input:-ms-input-placeholder,.bdsft-reset input .bdsft-reset input:-ms-input-placeholder{background-color:inherit;color:inherit;font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-size:100%;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;font:normal normal 100% Open Sans,Arial,sans-serif;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal}.bdsft-reset input[type=checkbox],.bdsft-reset input[type=radio]{cursor:default}.bdsft-reset a,.bdsft-reset a *,.bdsft-reset a span,.bdsft-reset button,.bdsft-reset button *,.bdsft-reset button span,.bdsft-reset input[type=submit],.bdsft-reset input[type=reset]{cursor:pointer}.bdsft-reset a:link,.bdsft-reset a:visited,.bdsft-reset a:hover,.bdsft-reset a:active{color:inherit;background:transparent;text-shadow:none}.bdsft-reset button::-moz-focus-inner{border:0;padding:0}.bdsft-reset *[class^=\'bdsft-icon\']{font-family:FontAwesome!important}body{background-color:#fff;margin:0;font-family:\'Open Sans\',Arial,sans-serif;-webkit-font-smoothing:antialiased!important}.button:active{color:#04aff0;background:-webkit-gradient(linear,left top,right bottom,from(#7cdd07),to(#faa51a));background:linear-gradient(to bottom left,#7cdd07,#faa51a)}.button:hover{box-shadow:0 0 10px #999}.popup{display:none;background:#333;padding:10px;border:2px solid #ddd;float:left;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;box-shadow:0 0 10px #999;border-radius:3px;font-size:14px;line-height:18px;z-index:100}.popup .actions{text-align:right}.popup .title{font-weight:bold;font-size:16px;color:#fff}.ui-widget-content.ui-dialog{display:none;color:#999;font-size:22px;background:#333;padding:10px;border:2px solid #ddd;box-shadow:0 0 10px #999;border-radius:3px;z-index:99}.no-close .ui-dialog-titlebar-close{display:none}.unsupported{position:absolute;top:240px;left:30px;width:600px;background-color:#191414;text-align:center;display:none;color:#fff;z-index:10}#screen_sharing_unsupported{position:relative;top:0;left:0;margin:10px;background:#f00}#screen_sharing_unsupported{display:none}#screen_sharing_unsupported span{text-decoration:underline}.historyRowSample{display:none}.default-color{color:#2ba6cb}[id$="sample"]{display:none!important}#javascript_disabled{display:block;background-color:#fff;color:#000}a.disabled{pointer-events:none;cursor:default;background-color:#999;opacity:.5}.main{position:relative;top:0;left:0;width:100%}.main:-webkit-full-screen-ancestor:not(iframe){position:absolute!important;top:0;left:0;right:0;bottom:0;width:100%;height:100%}.client{position:relative;top:0;left:0}.client.r1280x720{width:1280px}.client.r960x720{width:960px}.client .table{display:table;width:100%}.client .fixed{table-layout:fixed}.client .collapse{border-collapse:collapse}.client .cell{display:table-cell}.client .heading{display:table-row;font-weight:bold}.client .row{display:table-row;margin:0}.client .group{display:table-row-group}.client .fadeable{opacity:0;display:block;z-index:-1;backface-visibility:hidden}.client::-webkit-scrollbar{width:8px}.client::-webkit-scrollbar-track,.client::-webkit-scrollbar-thumb{background:#272727}.client::-webkit-scrollbar-track:window-inactive,.client::-webkit-scrollbar-thumb:window-inactive{background:#272727}.client.view-centered{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);backface-visibility:hidden}.client.r640x360,.client.r640x480{width:640px}.client.r320x180,.client.r320x240{width:320px}.full-screen-expanded.client{width:100%!important;height:100%!important}.full-screen-expanded .main{height:100%}.client .row:before,.client .row:after{display:none}.client.view-audioOnly{display:inline-block;width:auto}.callHistory{display:none;position:absolute;width:200px;height:258px;right:auto;left:200px;bottom:40px;top:auto;background:#292929;overflow:hidden;background-color:#292929;border-radius:0;border:1px solid #3c3c3c;box-shadow:none;color:#999;z-index:200;padding:0}.callHistory .rowSpace{padding:.5em}.callHistory .actions{margin-top:12px}.callHistory .content{padding:16px 0 10px 0;height:68%;width:200px;overflow:auto;margin-bottom:10px}.callHistory .content .history-row:hover,.callHistory .content .history-row.active{background:#353535}.callHistory .content .history-row{cursor:pointer;position:relative}.callHistory .content .history-row .row{display:block;margin:0;position:relative;height:46px}.callHistory .content .history-row .hist-direction{position:absolute;color:#3da005;left:3px;font-family:arial;font-size:18px;top:6px}.callHistory .content .history-row .icon-arrow-down-thick{color:#e9651d}.callHistory .content .history-row .hist-destination{position:absolute;color:#b3b3b3;left:25px;font-family:arial;font-size:18px;text-decoration:none;top:6px}.callHistory .content .history-row .hist-date{position:absolute;color:#b3b3b3;left:26px;font-family:arial;font-size:10px;top:29px}.callHistory .content .history-row .hist-length{position:absolute;color:#b3b3b3;left:104px;font-family:arial;font-size:10px;top:29px}.callHistory .content .history-row .hist-details-arrow{position:absolute;right:8px;font-size:16px;top:14px}.callHistory .historyClose a{color:#04aff0;font-size:14px;font-weight:700;text-decoration:none;margin-left:8px}.callHistory .historyClose a:hover{color:#017ead}.callHistory .callHistoryDetails{background:#fff;width:194px;height:auto;clear:both;top:0;bottom:-1;left:201px;right:auto;box-shadow:none;border-radius:0;background:#292929;border:1px solid #3c3c3c;border-top:0;overflow:auto}.callHistory .callHistoryDetails .callLink{text-align:left;background:#6f6f6f;float:left;padding:6px 10px 6px 10px;text-decoration:none;font-weight:bold;color:#fff!important;border-radius:50px;font-size:14px!important}.callHistory .callHistoryDetails .historyDetailsClose{text-align:right;margin-top:10px;text-align:right;margin-top:10px;display:inline-block!important;height:26px;margin-top:0}.callHistory .callHistoryDetails .historyDetailsClose .icon-ok{margin:0}.callHistory .callHistoryDetails .historyDetailsClose a{text-decoration:none;outline-color:rgba(0,0,0,0);color:#aaa;font-size:18px}.callHistory .callHistoryDetails .table{font-size:13px;padding-left:8px}.callHistory .callHistoryDetails .table #history-dt-close-container{text-align:right}.callHistory .classHistoryActions{padding-top:2px}.callHistory .historyClear a{text-decoration:none;color:#fff;font-size:14px;font-weight:700;background:#6f6f6f;border-radius:20px;padding:5px 10px;margin-left:15px}.callHistory .historyClear a:hover{background:#4e4e4e}.stats{display:none;position:absolute;top:10px;left:660px;width:400px;top:auto;bottom:40px;right:0;left:auto;background-color:#292929;border-radius:0;border:1px solid #3c3c3c;box-shadow:none;color:#999;z-index:200;padding:10px}.stats .statsVideo{position:absolute;white-space:pre-wrap;color:#0082ff;left:10px;font-family:arial;font-size:18px;text-decoration:none}.stats .statsAudio{position:absolute;white-space:pre-wrap;color:#0082ff;left:260px;float:left;font-family:arial;font-size:18px;text-decoration:none}.stats a{color:#2ba6cb}.stats .spacer{height:15px}.stats .statsDelay{display:none}.stats-table-container,.stats-graph-sub-container{display:none}.stats0-selected .kiloBitsSentPerSecond-video,.stats1-selected .kiloBitsSentPerSecond-audio,.stats2-selected .kiloBitsReceivedPerSecond-video,.stats3-selected .kiloBitsReceivedPerSecond-audio,.stats4-selected .packetsLost-video,.stats5-selected .packetsLostPer-video,.stats6-selected .packetsLost-audio,.stats7-selected .packetsLostPer-audio,.stats8-selected .googFrameRateSent-video,.stats9-selected .googFrameRateReceived-video,.stats10-selected .audioOutputLevel-audio,.stats11-selected .audioInputLevel-audio,.stats12-selected .googFrameWidthReceived-video,.stats13-selected .googFrameHeightReceived-video,.stats14-selected .googFrameWidthSent-video,.stats15-selected .googFrameHeightSent-video,.stats16-selected .googRtt-audio,.stats17-selected .googJitterReceived-audio{display:block}.callStats{color:<%= statsColor %>}.stats-graph-sub-container canvas{width:100%}.statsContainer{margin-bottom:18px}.dialpad{padding:15px;background:#292929;border:1px solid #3c3c3c;display:none;position:absolute;bottom:40px;right:auto;width:170px;top:auto;left:0;letter-spacing:5px;z-index:100;box-sizing:content-box;height:228px;padding-left:14px}.dialpad button{color:#333;opacity:.8;font-family:arial;font-size:20px;width:30px;border-color:#000;border-width:1px;border-radius:4px;border-spacing:5em;font-weight:bold;line-height:33px;margin:.1em;border-top-style:outset;cursor:pointer;color:#b3b3b3;background:0;border-radius:0;font-weight:normal;padding:0;margin:0;border:0;width:50px}.dialpad button:active{color:#04aff0;background:-webkit-gradient(linear,left top,left bottom,from(#f47a20),to(#faa51a));background:linear-gradient(to left bottom,#f47a20,#faa51a)}.dialpad button:hover{box-shadow:1px 1px 20px #999;background:#3a3a3a;box-shadow:none}.dialpad button:focus{outline:0}.dialpad button span{display:block;font-size:8px;text-align:center;font-weight:bold;margin-top:-13px;color:#2d7b99}.dialpad .btn-star{font-size:30px;vertical-align:middle}.dialpad .historyButton{font-size:16px!important;padding-top:5px;padding-bottom:5px;outline:0;position:absolute;right:4px;top:5px;width:25px}.dialpad .historyButton.active{color:#04aff0}.dialpad .dialpad-control-bar{margin-top:6px}.dialpad .dialpad-control-bar .main-button{background:#3da005;border-radius:14px;width:70px;padding:5px;margin:0 auto}.dialpad .dialpad-control-bar a{color:#fff;text-decoration:none;text-align:center;width:100%;display:inline-block;font-size:14px;font-weight:700;letter-spacing:1}.dialpad .dialpad-control-bar a span{margin-right:5px}.view-audioOnly .dialpad{top:45px}.callControl{display:none;position:relative;left:0;top:0;height:75px;color:#666;font-family:arial;font-size:18px;font-weight:bold;height:auto;display:block}.callControl .destination::-webkit-input-placeholder{color:#04aff0;font-style:italic;padding-left:5px;font-weight:400}.callControl hr{border:0;border-bottom:1px solid #3c3c3c}.callControl input{background:#333;border:1px solid #3c3c3c;color:#d3d3d3;font-family:arial;font-size:18px;padding:0;border-radius:0;width:171px;line-height:30px;padding-left:8px;padding-right:35px}.callControl input:focus{outline:0}.transferPopup{color:#fff;width:280px;height:60px}.transferTarget{width:200px}.call{display:none;position:absolute;z-index:10;top:25px;left:265px;display:block;position:static;top:auto;left:auto}.client:not(.connected) .call{transition:all 1s linear;opacity:0;z-index:-1}.enable-call-control .callControl{transition:all 1s linear;opacity:1;z-index:20}.callPopup{padding:0;background:#292929;border:1px solid #3c3c3c;box-shadow:none;width:220px;border-radius:0;height:168px}.callPopup span{color:#999;font-size:22px}.callPopup .incomingCallTitle{display:block;padding:8px;font-size:18px;font-weight:bold;background:#3c3c3c;margin-bottom:18px;color:#e4e4e4}.callPopup .acceptIncomingCall{background:#3da005;border:0;border-radius:20px;padding:5px 10px;font-size:14px;color:#fff;margin-left:12px}.callPopup #rejectIncomingCallContainer{text-align:right}.callPopup #rejectIncomingCallContainer button{background:#f00;border:0;border-radius:20px;padding:5px 10px;font-size:14px;color:#fff;margin-right:12px}.holdAndAnswerButton,.dropAndAnswerButton,.acceptIncomingCall{display:none}.started .holdAndAnswerButton,.started .dropAndAnswerButton,.client:not(.started) .acceptIncomingCall{display:inline-block}.callPopup{width:170px;height:137px}.incomingCallName,.incomingCallUser{display:block;margin-left:10px;margin-bottom:18px}.incomingcall-shown .callPopup{transition:all 1s linear;opacity:1;z-index:100}.reInvitePopup{width:170px;height:137px;transition:all 1s linear;opacity:0;z-index:-1}.reinvite-shown .reInvitePopup{transition:all 1s linear;opacity:1;z-index:100}.reinvite-hidden .reInvitePopup{transition:all 1s linear;opacity:0;z-index:-1}.video{position:relative;top:0;left:0;width:100%;height:auto}.video:-webkit-full-screen{position:absolute;height:100%;border:0;z-index:1}.video .remote{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#191414;border-radius:4px;border:2px solid #ddd;box-shadow:0 0 10px #000;border-radius:0;border:0;box-shadow:0 0 1px rgba(0,0,0,0.05);background:#000;background:-moz-linear-gradient(top,#181818 0,#494949 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,#181818),color-stop(100%,#494949));background:-webkit-linear-gradient(top,#181818 0,#494949 100%);background:-o-linear-gradient(top,#181818 0,#494949 100%);background:-ms-linear-gradient(top,#181818 0,#494949 100%);background:linear-gradient(to bottom,#181818 0,#494949 100%);overflow:hidden}.video .localVideo{position:absolute;top:auto;left:0;bottom:0;right:auto;width:25%;height:25%;background-color:transparent;z-index:99}.video .localVideo video{border-radius:0;box-shadow:none;background:#292929;border:1px solid #3c3c3c;cursor:move;width:100%;height:100%;position:absolute}.video .localVideo .inner{margin:5px;position:absolute;top:0;bottom:0;right:0;left:0}.full-screen-expanded .video{padding-bottom:0;bottom:40px;position:absolute;height:auto!important}.widescreen .video{padding-bottom:56.25%}.standard .video{padding-bottom:75%}:-webkit-full-screen .remote{z-index:1}:-webkit-full-screen .localVideo{z-index:2}:-webkit-full-screen .remote,:-webkit-full-screen .localVideo{border:0;border-radius:0}.started .watermark-icon{display:none;transform:none;box-shadow:0 0 1px rgba(0,0,0,0.05)}.started .remote{box-shadow:0 0 1px rgba(0,0,0,0.1)}.connected .watermark-icon{box-shadow:0 0 1px rgba(0,0,0,0.05)}.selfView-bl .localVideo{top:auto;bottom:0;left:0;right:auto}.selfView-tl .localVideo{top:0;bottom:auto;left:0;right:auto}.selfView-tr .localVideo{top:0;bottom:auto;left:auto!important;right:0}.selfView-br .localVideo{top:auto;bottom:0;left:auto!important;right:0}.selfView-1x .localVideo{width:25%;height:25%}.selfView-2x .localVideo{width:50%;height:50%}.view-audioOnly .video{display:none!important}.settingsPopup{display:none;padding:2px;position:absolute;line-height:28px;z-index:99;border:1px solid #3c3c3c;background:#292929;border-radius:0;box-shadow:none;bottom:40px;right:0;top:auto;left:auto;width:304px!important;font-size:14px;height:276px;overflow:hidden}.settingsPopup span{color:#999;font-size:20px;font-size:14px}.settingsPopup [type="checkbox"]{width:18;height:18;vertical-align:middle}.settingsPopup .short{width:36px}.settingsPopup input{background:#333;border:1px solid #414141;color:#eee;padding-left:5px;line-height:22px;font-size:13px;margin-left:14px}.settingsPopup select{margin-left:14px}.settingsPopup .tabs span{margin-right:5px;color:#fff}.settingsPopup .btn{background:#04aff0;color:#fff;padding:5px 10px;text-decoration:none;border-radius:20px;margin-left:9px;margin-top:15px;font-weight:700;text-align:center}.settingsPopup .btn:hover{background:#017ead}.settingsPopup .clear{display:inline-block;color:#04aff0;margin-left:10px;text-decoration:none;font-weight:700}.settingsPopup .clear:hover{color:#017ead}.settingsPopup .save{display:inline-block}.settingsPopup .resolutionSubType{display:none}.settingsPopup .tabs{width:250px;padding-left:0}.settingsPopup .tabs li{list-style:none;display:inline}.settingsPopup .tabs a{padding:5px 10px;display:inline-block;background:#494949;color:#fff;text-decoration:none}.settingsPopup .tabs a.active{background:#04aff0;color:#fff}.settingsPopup .tabs ~div p,.settingsPopup .tabs ~div h3{margin-bottom:15px;color:#999;font-size:14px}.tabs .settingsPopup ~ div{padding:10px;margin-bottom:10px}.enable-mute.unmuted.started .muteAudioIcon,.enable-mute.muted.started .unmuteAudioIcon,.enable-full-screen.full-screen-contracted .fullScreenExpand,.enable-full-screen.full-screen-expanded .fullScreenContract,.enable-self-view.self-view-enabled .selfViewDisable,.enable-self-view.self-view-disabled .selfViewEnable,.enable-self-view.self-view-enabled .localVideo,.enable-dialpad.dialpad-shown .dialpadIconHide,.enable-dialpad.dialpad-hidden .dialpadIconShow,.enable-call-control.connected .call,.enable-transfer.started .transfer,.enable-timer.started .timer,.client:not(.held).enable-hold.started .hold,.enable-hold.started.held .resume,.enable-screen-sharing.screen-sharing-off .shareScreen,.enable-screen-sharing.screen-sharing .stopShareScreen,.enable-file-share.started .file_share,.enable-settings .settings{transition:all 1s linear;opacity:1;z-index:20}.enable-transfer.started.transfer-visible .transferPopup,.enable-dialpad.dialpad-shown .dialpad,.enable-sms.sms-shown .sms,.enable-settings.settings-shown .settingsPopup{transition:all 1s linear;opacity:1;z-index:100}.enable-screen-sharing.screen-sharing .shareScreen,.enable-screen-sharing.screen-sharing-off .stopShareScreen,.enable-mute.connected .muteAudioIcon,.enable-mute.disconnected .muteAudioIcon,.enable-mute.connected .unmuteAudioIcon,.enable-mute.disconnected .unmuteAudioIcon,.enable-mute.muted .muteAudioIcon,.enable-mute.unmuted .unmuteAudioIcon,.enable-full-screen.full-screen-expanded .fullScreenExpand,.enable-full-screen.full-screen-contracted .fullScreenContract,.enable-self-view.self-view-disabled .selfViewDisable,.enable-self-view.self-view-enabled .selfViewEnable,.enable-self-view.self-view-disabled .localVideo,.enable-dialpad.dialpad-hidden .dialpadIconHide,.enable-dialpad.dialpad-shown .dialpadIconShow,.enable-dialpad.dialpad-hidden .dialpad,.enable-sms.sms-hidden .sms,.enable-stats.stats-hidden .stats,.enable-transfer.connected .transfer,.enable-transfer.disconnected .transfer,.enable-transfer.transfer-hidden .transferPopup,.enable-settings.settings-hidden .settingsPopup{transition:all 1s linear;opacity:0;z-index:-1}.enable-file-share .fileshare-container{display:table}.settings{margin-top:12px!important}.settings .icon-settings{margin:0;font-size:18px;color:#fff}.client:not(.enable-mute) .cell-muteAudio,.client:not(.enable-transfer) .cell-transfer,.client:not(.enable-hold) .cell-hold,.client:not(.enable-timer) .cell-timer,.client:not(.enable-full-screen) .cell-fullScreen,.client:not(.enable-self-view) .cell-selfView,.client:not(.enable-settings) .cell-settings,.client:not(.enable-dialpad) .cell-dialpad,.client:not(.enable-shareScreen) .cell-shareScreen,.client:not(.enable-call-control) .callControl{display:none!important}.whiteboard{display:none;position:absolute;top:40px;left:378px}.whiteboard .canvas{border-radius:4px;border:2px solid #ddd;box-shadow:0 0 10px #999;background-color:#fff}.whiteboard .tools{padding-bottom:10px}.whiteboard .tools a{border:1px solid #000;height:30px;line-height:30px;padding:0 10px;vertical-align:middle;text-align:center;text-decoration:none;display:inline-block;color:#000;font-weight:bold}.whiteboard .tools a.selected{border-color:#f00;border-width:3px}#whiteboard_unsupported{position:relative;top:0;left:0;margin:10px;background:#f00}@font-face{font-family:\'Exario-Icon-Fonts\';src:url("../fonts/Exario-Icon-Fonts.eot?") format("embedded-opentype")}@font-face{font-family:\'Exario-Icon-Fonts\';src:url("data:application/font-woff;base64,d09GRgABAAAAACxIAAsAAAAAK/wAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAABCAAAAGAAAABgCCL8u2NtYXAAAAFoAAAAVAAAAFTmQODcZ2FzcAAAAbwAAAAIAAAACAAAABBnbHlmAAABxAAAJwwAACcM1Zkoz2hlYWQAACjQAAAANgAAADYBntqxaGhlYQAAKQgAAAAkAAAAJAPkAhRobXR4AAApLAAAANAAAADQYQAFvmxvY2EAACn8AAAAagAAAGrdaNOKbWF4cAAAKmgAAAAgAAAAIABCALduYW1lAAAqiAAAAZ8AAAGfRUsFcXBvc3QAACwoAAAAIAAAACAAAwAAAAMCAAGQAAUAAAFMAWYAAABHAUwBZgAAAPUAGQCEAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAQAAA5gUB4P/g/+AB4AAgAAAAAQAAAAAAAAAAAAAAIAAAAAAAAgAAAAMAAAAUAAMAAQAAABQABABAAAAADAAIAAIABAABACDgLeYF//3//wAAAAAAIOAA5gT//f//AAH/4yAEGi4AAwABAAAAAAAAAAAAAAAAAAEAAf//AA8AAQAAAAAAAAAAAAIAADc5AQAAAAABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAg/+ABxwHgABAAAAU+AScuAQcVJzcVNhYXFgYHAX0VEw0OVlTAwGRyERInNSAnWicnMgJ/wMB8Ak08O4k5AAEAOf/gAeAB4AAQAAABNRcHNSYGBwYWFy4BNz4BFwEgwMBUVg4NExU1JxIRcmQBZHzAwH8CMicnWic5iTs8TQIAAAAADQAA/+ACAAHgAAMABwALABMAGwAfACMAJwArADMANwA7AEMAABMhFSEHMxUjETMVIwM1IzUjFTM1AxUzNTM1MzUHMxUjETMVIwEzFSMjMxUjNxUzFTMVMzUDMxUjOwEVIzcVIxUjFTM1gAEA/wAgICAgICAgIGBgICAgICAgICABYCAgICAgICAgIIAgICAgIEAgIGABQMAgIAFAIP6gICBgIAHgYCAgIEAg/sAgAYAgIIAgICBg/oAgICAgICBgAAAAAA0AAP/gAgAB4AADAAsADwAXABsAHwAjACsALwAzADcAPwBDAAA3MxUjNRUzFTMVMzUHMxUjExUjFSMVMzUnMxUjOwEVIxchFSEBNSM1IxUzNSczFSM3MxUjETMVIycVMzUzNTM1BzMVIyAgICAgIIAgIGAgIGCAICAgICBgAQD/AAFAICBgICAgICAgICBgICAgICAgICBgICAgYGAgAeAgICBgICAgYMABACAgYCBAIEAg/kAggGAgICBAIAAAAAQAKwALAcABtQAKAA8AFAAZAAABFSMVIxUjFSERIwMjNTMVMyMRMxEzIxEzEQErVlVVAZWVQEBAVUBAVUBAAbVVVVaqAar+gKurAQD/AAFW/qoAAAMAKwALAcABtQAKAA8AFAAAARUjFSMVIxUhESMTIxEzETMjETMRAStWVVUBlZUVQEBVQEABtVVVVqoBqv6AAQD/AAFW/qoAAAIAKwALAcABtQAKAA8AAAEVIxUjFSMVIREjEyMRMxEBK1ZVVQGVlWpAQAG1VVVWqgGq/oABVv6qAAAAAAEAKwALAcABtQAKAAABFSMVIxUjFSERIwErVlVVAZWVAbVVVVaqAaoAAAAABAAr//UBwAHLABsAKQAuAEkAAAEHIyIGBw4BHQEUFhceATsBFzoBMREqASMqASMDIyImPQE0Njc+ATsBFRcnNTcRExUeARceARUUBgcOAQcVPgE3PgE1NCYnLgEnARBVVQ4VCAgICAgIFQ5VVRAgCAsFBQsIZUUJCAICAgYFRWpVVVYQEQQEAQEEBBEQGCAKCgkJCgogGAHLawwJChkNew0YCAkKawHW/sAMCXsECgMEBapWVqpW/qoBFi0DDAgIEgsKEwgIDAMsAxMODiMTEyMODhMEAAAAAwAr//UB0wHLAAoAMwA4AAAlFScHHwEWNhU1BwcwNDE1NDY3PgE3FxU3NTcVNzUGJgcmBicHJw4BBw4BHQEUFhceARc3BycBFwEBK0geC1YQHyrAAQICBwRFFVYqCAsEBQsIVlUNFggHCQECAQQCISIeAYoe/nbGkEccAWoBAQH8KygCfAMLAgUEAQFCFC9VLipFAQEBAQEBbAEBCwoJGgx8BAsDBggEIo0fAYod/nQAAAAAAwARAEECAAGAADQARQBOAAABIyIGDwE1NCYnLgEjISIGBw4BHQEUFhceATMhMjY3PgE9ARceATsBMjY3PgE9ATQmJy4BIwEiJj0BNDYzITIWHQEUBiMhJSMnMSc1NzMVAeEOBgsEKggGBhEK/tsKEQYHBwcHBhEKASUKEQYGCCoECwYOBgwEBAUFBAQMBv5fBwkJBwElBwkJB/7bAaEPPhBODwFxBAQnEgkQBgYHBwYGEAnoCRAGBQcHBQYQCRInBAQEBAQLBugGCwQEBP7tCAboBgkJBugGCA46D1dI6AACAAD/4AIAAeAAOQBzAAABJy4BIyIGDwEOARUUFh8BHgEXNy4BLwEuATU0Nj8BPgEzMhYfAR4BFRQGDwEeARceAQc3PgE1NCYnBy4BJwceAR8BHgEVFAYPAQ4BIyImLwEuATU0Nj8BLgEnLgE3Bw4BFRQWHwEeATMyNj8BPgE1NCYvAQHdAhItFxctEW4REhIRAgMHAygEBgMCCgkJCm0JGQwNGAkCCgoKCjEDBQIBAgFNERISEaEDBwMoBAYDAgoJCQptCRkMDRgJAgoKCgoxAwUCAQIBTRESEhECEi0XFy0RbhESEhECAbsCERISEW0SLRcXLRICAgYCKAIFAwIJGA0NGAltCgoKCgIJGA0MGQkyCBAICBEJTREtFxctEp0CBgIoAgUDAgkYDQ0YCW0KCgoKAgkYDQwZCTIIEAgIEQlNES0XFy0SAhESEhFtEi0XFy0SAgAAAAQAAwAAAf8BwgA8AE0AhACPAAATPgEXHgEXFjY3PgE3PgEnLgEnJjY3PgEjIiYHDgEHDgEHDgEHBhYHBiYHDgEHBhQXMBYXHgE3PgE3NiY3FyYiDwEGFB8BHgE/AT4BLwElJgYHDgEHDgEHBiYnLgE1JjY3PgE3NiYHDgEHBhQVDgEPARc3PgE3PgEXFjY3PgE3PgE3NCYnAQYUHwEWNj8BJwdQCREICREKAwUCASQCAQICAg0EEiMZGioKCzsGDRoNDRYIFBIBBgEKCw8HAw4CAwIhAgIKAwMOAQIBCJICBQMlAgLUBAsEGQQBA9MBGwEIAgMRBQIIBgcQCwsIAQUBBBICAQQHBzsGAwEHCyIiKwMMBwYPCA8ZCQoOBQUEAQEB/kkEBBgEDAR9JoMBMAcCAwQQCwMEAQIgAQEEAwIQBhclDg0PAQEBCwgHEAUOEAEFFAoJBAUDCgMCBwMkAwICAwMLAQIXBg4DAiACBgLyBAEEFQMMBPRnCgEEBBsIBAkDAwEICA0FBgkEBx8DAgoDAx8YDBcLCxYKJCgoBAcCAgICAwIEBQ8KCBkNDBYE/qIECwQYBAIFeyx/AAQAAgAcAgEBlQBcAHIAhQCNAAA3LgEvATcnLgEnJjQ1PAE3PgE3PgE3NgQXHgEfATc+ATEyFh8BBxU3PgE3PgE3NjIXHgEXFhQdAQcOAQcOASMiJicuAScuATEwBhUUBgcOAQcGIisBBw4BMTAmJzE3PgEnJiQHDgEHDgEXFRceATMyNjcxFzI2NzY0PQEHDgEHBhYzMjY3MTc1Iw8BFzM1DQIEAgMiBwIGAQMDAgcEBQoHCgEvBQMHAgcVCQ0BBQMHLwYDDggJCwMGGAYFDAEBAwMFBAUGCwkIAwIQCgkOAQUFBA4JBEtNlBYJDgMCy28qAgT+0AQCAwECAQEFAgQBAVxAlgIDAQKHOFEBAyJiRz8CdhJMAU0SIAIFAgMcBwMIAwchW1siBgUJBAMFAQIBAgEEAgQRCAoFAwgoHAUDDQYJCQECAgINBQJKMXgHBAUCAwEBAQEOCAkMBwUKEAYGCAIBEwcLAgK/XCUBAgECAQMCAyhTeQQCAkw2gAQCAyRLbXEuRAECAQEBgXVHWkl1AAAAAQAA/+AB4AHAADYAACUOAQcOASMiJicuAScuAScuATU0Njc+ATc2JicuASMiBjEUFhceARceARceATMwNjU0JicuAQcBYAwOBgYODAwYDAwYDAwXCQkLCwkJFwwMEhISKgwYSBYTEi4XF0QkJUQYYB8VFSsMoAwXCQkLCwkJFwwMGAwMGAwMDgYGDgwMKxUVH2AYRCUkRBcXLhITFkgYDCoSEhIMAAAAAQAAAGECAAFAAFYAACUeARcOAQcOAScuASc+ATc2NCcuAScuASMiBgcOAQcOARceAQcWBgcGJicuATcmNjU+ATc+ATcyIjM+ATc+ATMjMiIzIjIxMzIWFx4BFyIyIx4BFx4BFQH9AgEBAQMGBzIZHCgBAQUDAQkHFgsOGxAOHQwNFAkHAgMBBwEBKhobMAkEBQEBAwIEBQMOCAEBAQ0mGBtDLgECAQIBAgEsRRkaJA8BAQEKDAUDBsAKGAsLEwUJCAICExIJDwgHEAkJCQMCAQECAwkJCRAHCA8JEhMCAggJBRMLCxgKBw8HCBEKDRcJCQoKCQkXDQoRCAcPBwAAAAkAAP/gAeABwAAEAAkADgATABgAHQAiACcALAAAJRUzNSMjFTM1IyMVMzUjJRUzNSMjFTM1IyMVMzUjJRUzNSMjFTM1IyMVMzUjAYBgYMBgYMBgYAGAYGDAYGDAYGABgGBgwGBgwGBgQGBgYGBgYMBgYGBgYGDAYGBgYGBgAAAAAgAA/+ACAAHgABgAHwAAASIGBw4BFRQWFx4BMzI2Nz4BNTQmJy4BIwMnNxc3FwcBADVdIyMoKCMjXTU1XSMjKCgjI101MGovO7kX0AHgKCMjXTU1XSMjKCgjI101NV0jIyj+YIoxS5cX8AAABwAg/+AB4AHgAEIAUQBgAG8AfgCNALQAAAUhIiY9ASMiJj0BNDY7ATUjIiY9ATQ2OwE1IyImPQE0NjsBNSMiJj0BNDY7ATUjIiY9ATQ2OwE1NDYzITIWFREUBiMBIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMlNCYnLgEnPgE3IzI2PQE0JisBIgYdARQWMyMeARcOAQcOAR0BMzUB0P6gBwkwBwkJBzAwBwkJBzAwBwkJBzAwBwkJBzAwBwkJBzAJBwFgBwkJB/6QIAcJCQcgBwkJByAHCQkHIAcJCQcgBwkJByAHCQkHIAcJCQcgBwkJByAHCQkHIAcJCQcBIAwLCh0RAgICBwcJCQcgBwkJBwcCAgIRHQoLDMAgCQcQCQcgBwkgCQcgBwkgCQcgBwkgCQcgBwkgCQcgBwkQBwkJB/4gBwkB0AkHBwkJBwcJYAkHBwkJBwcJYAkHBwkJBwcJYAkHBwkJBwcJYAkHBwkJBwcJYgoPBAUGAQEDAQkHYAcJCQdgBwkBAwEBBgUFDgoSEgAEACD/4AHgAeAABAAJAA4AJwAAEzMRIxE7AREjETsBESMRJRUzERQWFx4BMyEyNjc+ATURMzUjNSMVI4BAQGBAQGBAQP7gIAsJCRcMAQAMFwkJCyCAwIABQP7gASD+4AEg/uABIGBA/sAMFwkJCwsJCRcMAUBAQEAAAAAABAADACAB+wGgAGIAewCUAK0AACUyNjc+ATU0JicuASMiBgcOAQcuAScuAScuAScuASczHgEXHgEzMjY3PgE1NCYnLgEjIgYHDgEHIy4BJy4BIyIGBw4BFRQWFx4BMzI2Nz4BNx4BFx4BFx4BFx4BFx4BFx4BMxEyFhceARUUBgcOASMiJicuATU0Njc+ATMFNDY3PgEzMhYXHgEVFAYHDgEjIiYnLgE1BTQ2Nz4BMzIWFx4BFRQGBw4BIyImJy4BNQGzDxoKCgsLCgoaDwsUCAkNBBYcCQoMBwMHBAQLB3sEDggJFAsPGgoKCwsKChoPCxQJCA4E5AQNCQgVCw8aCgkMDAkKGg8LFAkIDgQWHAkJDQYHEQ8QMCYEDQkIFQsJDwYFBwcFBg8JCA8GBgYGBgYPCP5vBgYFEAgJDwYFBwcFBg8JCBAFBgYBaAYGBg8ICQ8GBQcHBQYPCQgPBgYGIAsKChoPDxoKCgsGBgUQCQIQDQ0iFAoWCgsVCgoQBgYGCwoKGg8PGgoKCwYGBhAJCRAGBgYLCgoaDw8aCgoLBgYFEAkCEA0NIhQVLhQUHQQJEQYFBwFiBwYFDwkJDwUGBwcGBQ8JCQ8FBgcqCQ8FBgcHBgUPCQkPBQYHBwYFDwnwCQ8FBgcHBgUPCQkPBQYHBwYFDwkAAAAAAgB4ADMBiAGaABoANQAAASIGBw4BFREUFhceATMyNjc+ATURNCYnLgEjIyIGBw4BFREUFhceATMyNjc+ATURNCYnLgEjAVoKEQYGBwcGBhEKCREGBggIBgYRCbQJEQYGCAgGBhEJChEGBgcHBgYRCgGaBAMEDQr+3AkNBAQDAwQEDQkBJAoNBAMEBAMEDQr+3AkNBAQDAwQEDQkBJAoNBAMEAAABALMATwGzAX4AFQAAJScuAQcOARURFBYXFjY/ARQ2NTQmNQGr2wYKBAQFBQQECgbbCAj0iAMCAwELB/74BwsBBAMCiQEJBAcHAQAAAQAg/+ABxwHgABAAAAU+AScuAQcVJzcVNhYXFgYHAX0VEw0OVlTAwGRyERInNSAnWicnMgJ/wMB8Ak08O4k5AAEAOf/gAeAB4AAQAAABNRcHNSYGBwYWFy4BNz4BFwEgwMBUVg4NExU1JxIRcmQBZHzAwH8CMicnWic5iTs8TQIAAAAADQAA/+ACAAHgAAMABwALABMAGwAfACMAJwArADMANwA7AEMAABMhFSEHMxUjETMVIwM1IzUjFTM1AxUzNTM1MzUHMxUjETMVIwEzFSMjMxUjNxUzFTMVMzUDMxUjOwEVIzcVIxUjFTM1gAEA/wAgICAgICAgIGBgICAgICAgICABYCAgICAgICAgIIAgICAgIEAgIGABQMAgIAFAIP6gICBgIAHgYCAgIEAg/sAgAYAgIIAgICBg/oAgICAgICBgAAAAAA0AAP/gAgAB4AADAAsADwAXABsAHwAjACsALwAzADcAPwBDAAA3MxUjNRUzFTMVMzUHMxUjExUjFSMVMzUnMxUjOwEVIxchFSEBNSM1IxUzNSczFSM3MxUjETMVIycVMzUzNTM1BzMVIyAgICAgIIAgIGAgIGCAICAgICBgAQD/AAFAICBgICAgICAgICBgICAgICAgICBgICAgYGAgAeAgICBgICAgYMABACAgYCBAIEAg/kAggGAgICBAIAAAAAQAKwALAcABtQAKAA8AFAAZAAABFSMVIxUjFSERIwMjNTMVMyMRMxEzIxEzEQErVlVVAZWVQEBAVUBAVUBAAbVVVVaqAar+gKurAQD/AAFW/qoAAAMAKwALAcABtQAKAA8AFAAAARUjFSMVIxUhESMTIxEzETMjETMRAStWVVUBlZUVQEBVQEABtVVVVqoBqv6AAQD/AAFW/qoAAAIAKwALAcABtQAKAA8AAAEVIxUjFSMVIREjEyMRMxEBK1ZVVQGVlWpAQAG1VVVWqgGq/oABVv6qAAAAAAEAKwALAcABtQAKAAABFSMVIxUjFSERIwErVlVVAZWVAbVVVVaqAaoAAAAABAAr//UBwAHLABsAKQAuAEkAAAEHIyIGBw4BHQEUFhceATsBFzoBMREqASMqASMDIyImPQE0Njc+ATsBFRcnNTcRExUeARceARUUBgcOAQcVPgE3PgE1NCYnLgEnARBVVQ4VCAgICAgIFQ5VVRAgCAsFBQsIZUUJCAICAgYFRWpVVVYQEQQEAQEEBBEQGCAKCgkJCgogGAHLawwJChkNew0YCAkKawHW/sAMCXsECgMEBapWVqpW/qoBFi0DDAgIEgsKEwgIDAMsAxMODiMTEyMODhMEAAAAAwAr//UB0wHLAAoAMwA4AAAlFScHHwEWNhU1BwcwNDE1NDY3PgE3FxU3NTcVNzUGJgcmBicHJw4BBw4BHQEUFhceARc3BycBFwEBK0geC1YQHyrAAQICBwRFFVYqCAsEBQsIVlUNFggHCQECAQQCISIeAYoe/nbGkEccAWoBAQH8KygCfAMLAgUEAQFCFC9VLipFAQEBAQEBbAEBCwoJGgx8BAsDBggEIo0fAYod/nQAAAAAAwARAEECAAGAADQARQBOAAABIyIGDwE1NCYnLgEjISIGBw4BHQEUFhceATMhMjY3PgE9ARceATsBMjY3PgE9ATQmJy4BIwEiJj0BNDYzITIWHQEUBiMhJSMnMSc1NzMVAeEOBgsEKggGBhEK/tsKEQYHBwcHBhEKASUKEQYGCCoECwYOBgwEBAUFBAQMBv5fBwkJBwElBwkJB/7bAaEPPhBODwFxBAQnEgkQBgYHBwYGEAnoCRAGBQcHBQYQCRInBAQEBAQLBugGCwQEBP7tCAboBgkJBugGCA46D1dI6AACAAD/4AIAAeAAOQBzAAABJy4BIyIGDwEOARUUFh8BHgEXNy4BLwEuATU0Nj8BPgEzMhYfAR4BFRQGDwEeARceAQc3PgE1NCYnBy4BJwceAR8BHgEVFAYPAQ4BIyImLwEuATU0Nj8BLgEnLgE3Bw4BFRQWHwEeATMyNj8BPgE1NCYvAQHdAhItFxctEW4REhIRAgMHAygEBgMCCgkJCm0JGQwNGAkCCgoKCjEDBQIBAgFNERISEaEDBwMoBAYDAgoJCQptCRkMDRgJAgoKCgoxAwUCAQIBTRESEhECEi0XFy0RbhESEhECAbsCERISEW0SLRcXLRICAgYCKAIFAwIJGA0NGAltCgoKCgIJGA0MGQkyCBAICBEJTREtFxctEp0CBgIoAgUDAgkYDQ0YCW0KCgoKAgkYDQwZCTIIEAgIEQlNES0XFy0SAhESEhFtEi0XFy0SAgAAAAQAAwAAAf8BwgA8AE0AhACPAAATPgEXHgEXFjY3PgE3PgEnLgEnJjY3PgEjIiYHDgEHDgEHDgEHBhYHBiYHDgEHBhQXMBYXHgE3PgE3NiY3FyYiDwEGFB8BHgE/AT4BLwElJgYHDgEHDgEHBiYnLgE1JjY3PgE3NiYHDgEHBhQVDgEPARc3PgE3PgEXFjY3PgE3PgE3NCYnAQYUHwEWNj8BJwdQCREICREKAwUCASQCAQICAg0EEiMZGioKCzsGDRoNDRYIFBIBBgEKCw8HAw4CAwIhAgIKAwMOAQIBCJICBQMlAgLUBAsEGQQBA9MBGwEIAgMRBQIIBgcQCwsIAQUBBBICAQQHBzsGAwEHCyIiKwMMBwYPCA8ZCQoOBQUEAQEB/kkEBBgEDAR9JoMBMAcCAwQQCwMEAQIgAQEEAwIQBhclDg0PAQEBCwgHEAUOEAEFFAoJBAUDCgMCBwMkAwICAwMLAQIXBg4DAiACBgLyBAEEFQMMBPRnCgEEBBsIBAkDAwEICA0FBgkEBx8DAgoDAx8YDBcLCxYKJCgoBAcCAgICAwIEBQ8KCBkNDBYE/qIECwQYBAIFeyx/AAQAAgAcAgEBlQBcAHIAhQCNAAA3LgEvATcnLgEnJjQ1PAE3PgE3PgE3NgQXHgEfATc+ATEyFh8BBxU3PgE3PgE3NjIXHgEXFhQdAQcOAQcOASMiJicuAScuATEwBhUUBgcOAQcGIisBBw4BMTAmJzE3PgEnJiQHDgEHDgEXFRceATMyNjcxFzI2NzY0PQEHDgEHBhYzMjY3MTc1Iw8BFzM1DQIEAgMiBwIGAQMDAgcEBQoHCgEvBQMHAgcVCQ0BBQMHLwYDDggJCwMGGAYFDAEBAwMFBAUGCwkIAwIQCgkOAQUFBA4JBEtNlBYJDgMCy28qAgT+0AQCAwECAQEFAgQBAVxAlgIDAQKHOFEBAyJiRz8CdhJMAU0SIAIFAgMcBwMIAwchW1siBgUJBAMFAQIBAgEEAgQRCAoFAwgoHAUDDQYJCQECAgINBQJKMXgHBAUCAwEBAQEOCAkMBwUKEAYGCAIBEwcLAgK/XCUBAgECAQMCAyhTeQQCAkw2gAQCAyRLbXEuRAECAQEBgXVHWkl1AAAAAQAA/+AB4AHAADYAACUOAQcOASMiJicuAScuAScuATU0Njc+ATc2JicuASMiBjEUFhceARceARceATMwNjU0JicuAQcBYAwOBgYODAwYDAwYDAwXCQkLCwkJFwwMEhISKgwYSBYTEi4XF0QkJUQYYB8VFSsMoAwXCQkLCwkJFwwMGAwMGAwMDgYGDgwMKxUVH2AYRCUkRBcXLhITFkgYDCoSEhIMAAAAAQAAAGECAAFAAFYAACUeARcOAQcOAScuASc+ATc2NCcuAScuASMiBgcOAQcOARceAQcWBgcGJicuATcmNjU+ATc+ATcyIjM+ATc+ATMjMiIzIjIxMzIWFx4BFyIyIx4BFx4BFQH9AgEBAQMGBzIZHCgBAQUDAQkHFgsOGxAOHQwNFAkHAgMBBwEBKhobMAkEBQEBAwIEBQMOCAEBAQ0mGBtDLgECAQIBAgEsRRkaJA8BAQEKDAUDBsAKGAsLEwUJCAICExIJDwgHEAkJCQMCAQECAwkJCRAHCA8JEhMCAggJBRMLCxgKBw8HCBEKDRcJCQoKCQkXDQoRCAcPBwAAAAkAAP/gAeABwAAEAAkADgATABgAHQAiACcALAAAJRUzNSMjFTM1IyMVMzUjJRUzNSMjFTM1IyMVMzUjJRUzNSMjFTM1IyMVMzUjAYBgYMBgYMBgYAGAYGDAYGDAYGABgGBgwGBgwGBgQGBgYGBgYMBgYGBgYGDAYGBgYGBgAAAAAgAA/+ACAAHgABgAHwAAASIGBw4BFRQWFx4BMzI2Nz4BNTQmJy4BIwMnNxc3FwcBADVdIyMoKCMjXTU1XSMjKCgjI101MGovO7kX0AHgKCMjXTU1XSMjKCgjI101NV0jIyj+YIoxS5cX8AAABwAg/+AB4AHgAEIAUQBgAG8AfgCNALQAAAUhIiY9ASMiJj0BNDY7ATUjIiY9ATQ2OwE1IyImPQE0NjsBNSMiJj0BNDY7ATUjIiY9ATQ2OwE1NDYzITIWFREUBiMBIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMVIyIGFRQWOwEyNjU0JiMlNCYnLgEnPgE3IzI2PQE0JisBIgYdARQWMyMeARcOAQcOAR0BMzUB0P6gBwkwBwkJBzAwBwkJBzAwBwkJBzAwBwkJBzAwBwkJBzAJBwFgBwkJB/6QIAcJCQcgBwkJByAHCQkHIAcJCQcgBwkJByAHCQkHIAcJCQcgBwkJByAHCQkHIAcJCQcBIAwLCh0RAgICBwcJCQcgBwkJBwcCAgIRHQoLDMAgCQcQCQcgBwkgCQcgBwkgCQcgBwkgCQcgBwkgCQcgBwkQBwkJB/4gBwkB0AkHBwkJBwcJYAkHBwkJBwcJYAkHBwkJBwcJYAkHBwkJBwcJYAkHBwkJBwcJYgoPBAUGAQEDAQkHYAcJCQdgBwkBAwEBBgUFDgoSEgAEACD/4AHgAeAABAAJAA4AJwAAEzMRIxE7AREjETsBESMRJRUzERQWFx4BMyEyNjc+ATURMzUjNSMVI4BAQGBAQGBAQP7gIAsJCRcMAQAMFwkJCyCAwIABQP7gASD+4AEg/uABIGBA/sAMFwkJCwsJCRcMAUBAQEAAAAAABAADACAB+wGgAGIAewCUAK0AACUyNjc+ATU0JicuASMiBgcOAQcuAScuAScuAScuASczHgEXHgEzMjY3PgE1NCYnLgEjIgYHDgEHIy4BJy4BIyIGBw4BFRQWFx4BMzI2Nz4BNx4BFx4BFx4BFx4BFx4BFx4BMxEyFhceARUUBgcOASMiJicuATU0Njc+ATMFNDY3PgEzMhYXHgEVFAYHDgEjIiYnLgE1BTQ2Nz4BMzIWFx4BFRQGBw4BIyImJy4BNQGzDxoKCgsLCgoaDwsUCAkNBBYcCQoMBwMHBAQLB3sEDggJFAsPGgoKCwsKChoPCxQJCA4E5AQNCQgVCw8aCgkMDAkKGg8LFAkIDgQWHAkJDQYHEQ8QMCYEDQkIFQsJDwYFBwcFBg8JCA8GBgYGBgYPCP5vBgYFEAgJDwYFBwcFBg8JCBAFBgYBaAYGBg8ICQ8GBQcHBQYPCQgPBgYGIAsKChoPDxoKCgsGBgUQCQIQDQ0iFAoWCgsVCgoQBgYGCwoKGg8PGgoKCwYGBhAJCRAGBgYLCgoaDw8aCgoLBgYFEAkCEA0NIhQVLhQUHQQJEQYFBwFiBwYFDwkJDwUGBwcGBQ8JCQ8FBgcqCQ8FBgcHBgUPCQkPBQYHBwYFDwnwCQ8FBgcHBgUPCQkPBQYHBwYFDwkAAAAAAgB4ADMBiAGaABoANQAAASIGBw4BFREUFhceATMyNjc+ATURNCYnLgEjIyIGBw4BFREUFhceATMyNjc+ATURNCYnLgEjAVoKEQYGBwcGBhEKCREGBggIBgYRCbQJEQYGCAgGBhEJChEGBgcHBgYRCgGaBAMEDQr+3AkNBAQDAwQEDQkBJAoNBAMEBAMEDQr+3AkNBAQDAwQEDQkBJAoNBAMEAAABALMATwGzAX4AFQAAJScuAQcOARURFBYXFjY/ARQ2NTQmNQGr2wYKBAQFBQQECgbbCAj0iAMCAwELB/74BwsBBAMCiQEJBAcHAQAAAwAAAEACAAGAABgAWwB0AAABIgYHDgEHHgEXHgEzMjY3PgE3LgEnLgEjFx4BFx4BFw4BBw4BBw4BBw4BIyImJy4BJy4BJy4BJz4BNz4BNz4BNw4BBw4BFRQWFx4BMzI2Nz4BNTQmJy4BJx4BFwcUBgcOASMiJicuATU0Njc+ATMyFhceARUBACpNISE1EhI1ISFNKipNISE1EhI1ISFNKn4MFAoJEQcHEQkKFAwOHhAQIRERIRAQHg4MFAoJEQcHEQkKFAwBAwICAwEBARQREi4bGy4SERQBAQEDAgIDAX4IBgcRCgoRBwYICAYHEQoKEQcGCAGAFxUVOyQkOxUVFxcVFTskJDsVFRdVBxEJChULCxUKCREHCQ4FBAUFBAUOCQcRCQoVCwsVCgkRBwECAQULBQYLBhsuEhEUFBESLhsGCwYFCwUBAgEYChEHBggIBgcRCgoRBwYICAYHEQoAAAUAAAAAAgAB4AAsAEAAWgBuAIsAAAEeARceARcOAQcOAQcuAScuASc3HgEXNhY3FjY3PgE3PgE3PgE3LgEnLgEnNwcGJgcmIic3FhQXBhYHFgYHDgEHEw8BLgEjLgEnDgEHDgEHHgEXHgEXBx8BAScFHgEXHgEXBy4BJy4BJz4BNz4BFwc+ATc+ATcwNjMOARUGFAceARceARcHLgEnLgEnAaQPGgwLFQcRNiAiTCsLGAoMFQwoBg0FCAwHECIPER0PCxUJChAICA8KCBUKIqMFCAUDCQOcAgIBAgEBFRATLRzhHG0LFAwKGAorTCIgNhEHFQoMGRBcARoBxgH+8QgRBQgHAjcIEAQHBQEBBwcGEgmYBhIICxMNBAEBBAIBAQMEAgsFHAsTCgcRBgFMChkMDx0RIzwUFhYBAQEDAQYDKAMBAgECAQEGAwYNCgYSCAsUDAoVCAsPCCLIAQIBAgKcAwkDBQgFGi8REhMBAV4BbQMGAwEBARYWFDwjER0ODBkKWxoBAcYanAEFBwQQCDcCBwgFEQgLEAgFCQFiChYJChAIAwQMBAcKBwoWCQsRCRwGEQgKEwwAAQAAAAEAAKNDYFZfDzz1AAsCAAAAAADQP0z6AAAAANA/TPoAAP/gAgEB4AAAAAgAAgAAAAAAAAABAAAB4P/gAAACAAAA//8CAQABAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAEAAAACAAAgAgAAOQIAAAACAAAAAgAAKwIAACsCAAArAgAAKwIAACsCAAArAgAAEQIAAAACAAADAgAAAgIAAAACAAAAAgAAAAIAAAACAAAgAgAAIAIAAAMCAAB4AgAAswIAACACAAA5AgAAAAIAAAACAAArAgAAKwIAACsCAAArAgAAKwIAACsCAAARAgAAAAIAAAMCAAACAgAAAAIAAAACAAAAAgAAAAIAACACAAAgAgAAAwIAAHgCAACzAgAAAAIAAAAAAAAAAAoAFAAeAD4AYADCASIBTAFwAY4BpAIQAmoC2gOGBGQFLgWCBgIGQgZ4B1oHmAiUCOYJDAksCU4JsAoQCjoKXgp8CpIK/gtYC8gMdA1SDhwOcA7wDzAPZhBIEIYRghHUEfoSqhOGAAAAAQAAADQAtQANAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABACIAAAABAAAAAAACAA4AjQABAAAAAAADACIAOAABAAAAAAAEACIAmwABAAAAAAAFABYAIgABAAAAAAAGABEAWgABAAAAAAAKADQAvQADAAEECQABACIAAAADAAEECQACAA4AjQADAAEECQADACIAOAADAAEECQAEACIAmwADAAEECQAFABYAIgADAAEECQAGACIAawADAAEECQAKADQAvQBFAHgAYQByAGkAbwAtAEkAYwBvAG4ALQBGAG8AbgB0AHMAVgBlAHIAcwBpAG8AbgAgADEALgAwAEUAeABhAHIAaQBvAC0ASQBjAG8AbgAtAEYAbwBuAHQAc0V4YXJpby1JY29uLUZvbnRzAEUAeABhAHIAaQBvAC0ASQBjAG8AbgAtAEYAbwBuAHQAcwBSAGUAZwB1AGwAYQByAEUAeABhAHIAaQBvAC0ASQBjAG8AbgAtAEYAbwBuAHQAcwBGAG8AbgB0ACAAZwBlAG4AZQByAGEAdABlAGQAIABiAHkAIABJAGMAbwBNAG8AbwBuAC4AAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=") format("woff"),url("data:application/x-font-ttf;base64,AAEAAAALAIAAAwAwT1MvMggi/LsAAAC8AAAAYGNtYXDmQODcAAABHAAAAFRnYXNwAAAAEAAAAXAAAAAIZ2x5ZjoCSh4AAAF4AAAnRGhlYWT/pwt9AAAovAAAADZoaGVhA+QCFAAAKPQAAAAkaG10eGEABp4AACkYAAAA0GxvY2HiFtguAAAp6AAAAGptYXhwAEIBBQAAKlQAAAAgbmFtZVNJ8lkAACp0AAABk3Bvc3QAAwAAAAAsCAAAACAAAwIAAZAABQAAAUwBZgAAAEcBTAFmAAAA9QAZAIQAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAADmBQHg/+D/4AHgACAAAAABAAAAAAAAAAAAAAAgAAAAAAACAAAAAwAAABQAAwABAAAAFAAEAEAAAAAMAAgAAgAEAAEAIOAt5gX//f//AAAAAAAg4ADmBP/9//8AAf/jIAQaLgADAAEAAAAAAAAAAAAAAAAAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABACD/4AF9AeAADgAABT4BLgEHFSc3FTYeAQYHAX0VExtWVMDAZHIjJzUgJ1pOMgJ/wMB8Ak13iTkAAAABAIP/4AHgAeAADgAAATUXBzUmDgEWFy4BPgEXASDAwFRWGxMVNScjcmQBZHzAwH8CMk5aJzmJd00CAAANAAD/4AIAAeAAAwAHAAsAEwAbAB8AIwAnACsAMwA3ADsAQwAAEyEVIQczFSMRMxUjAzUjNSMVMzUDFTM1MzUzNQczFSMRMxUjATMVIyMzFSM3FTMVMxUzNQMzFSM7ARUjNxUjFSMVMzWAAQD/ACAgICAgICAgYGAgICAgICAgIAFgICAgICAgICAggCAgICAgQCAgYAFAwCAgAUAg/qAgIGAgAeBgICAgQCD+wCABgCAggCAgIGD+gCAgICAgIGAAAAAADQAA/+ACAAHgAAMACwAPABcAGwAfACMAKwAvADMANwA/AEMAADczFSM1FTMVMxUzNQczFSMTFSMVIxUzNSczFSM7ARUjFyEVIQE1IzUjFTM1JzMVIzczFSMRMxUjJxUzNTM1MzUHMxUjICAgICAggCAgYCAgYIAgICAgIGABAP8AAUAgIGAgICAgICAgIGAgICAgICAgIGAgICBgYCAB4CAgIGAgICBgwAEAICBgIEAgQCD+QCCAYCAgIEAgAAAABAArAAsBwAG1AAoADwAUABkAAAEVIxUjFSMVIREjAyM1MxUzIxEzETMjETMRAStWVVUBlZVAQEBVQEBVQEABtVVVVqoBqv6Aq6sBAP8AAVb+qgAAAwArAAsBwAG1AAoADwAUAAABFSMVIxUjFSERIxMjETMRMyMRMxEBK1ZVVQGVlRVAQFVAQAG1VVVWqgGq/oABAP8AAVb+qgAAAgArAAsBwAG1AAoADwAAARUjFSMVIxUhESMTIxEzEQErVlVVAZWVakBAAbVVVVaqAar+gAFW/qoAAAAAAQArAAsBwAG1AAoAAAEVIxUjFSMVIREjAStWVVUBlZUBtVVVVqoBqgAAAAAEACv/9QHAAcsAGgApAC4ARQAAAQcjIg4CHQEUHgI7ARc6AzERKgMjAyMiLgI9ATQ+AjsBFRcnNTcRExUeAxUUDgIHFT4DNTQuAicBEFVVDhUQCAgQFQ5VVQgRDgkICwoLCGVFBQYEAgIEBgVFalVVVhARCAEBCBEQGCAUCQkUIBgBy2sMExkNew0YEQprAdb+wAMGCAR7BAoHBapWVqpW/qoBFi0DDBASCwoTEAwDLAMTHCMTEyMcEwQAAAMAK//1AdMBywAMADMAOAAAJRUnBx8BFjYWNhU1BwcUNDA0FTU0PgIXNxU3NTcVNzUmBiYGJwcnDgMdARQeAhc3BycBFwEBK0geC1YIEQ0JKsABBAcERRVWKggLCQsIVlUNFg8JAQMEAiEiHgGKHv52xpBHHAFqAQEBAQH8KygBAgIBfAMLBgYBAUQWLVcwLEMBAQEBAWwBAQsUGA56BgkKCAQijR8Bih3+dAADABEAQQIAAYAAMgBLAFQAAAEjIg4CDwE1NC4CIyEiDgIdARQeAjMhMj4CPQEXHgM7ATI+Aj0BNC4CIwEiLgI9ATQ+AjMhMh4CHQEUDgIjISUjJzEnNTczFQHhDgMGBQUCKggMEQr+2woRDQcHDREKASUKEQwIKgIFBQYDDgYMCAUFCAwG/l8EBQQDAwQFBAElBAUEAwMEBQT+2wGhDz4QTg8BcQECAwInEgkQDAcHDBAJ6AkQCwcHCxAJEicCAwIBBAgLBugGCwgE/u0CBAUD6AMGBAICBAYD6AMFBAIOOg9XSOgAAAAAAgAjAAMB3QG9ADYAbQAAAScuASIGDwEOARQWHwEeAxc3LgMvAS4BNDY/AT4BMhYfAR4BFAYPAR4DBzc+ATQmJwcuAycHHgMfAR4BFAYPAQ4BIiYvAS4BNDY/AS4DNwcOARQWHwEeATI2PwE+ATQmLwEB3QISLS4tEW4REhIRAgIDAwMCKAIDBAMBAgoJCQptCRkZGAkCCgoKCjEDBQMCAU0REhIRoQIDAwMCKAIDBAMBAgoJCQptCRkZGAkCCgoKCjEDBQMCAU0REhIRAhItLi0RbhESEhECAbsCERISEW0SLS4tEgIBAwIDASgBAgIDAgIJGBoYCW0KCgoKAgkYGRkJMggQERAJTREtLi0SnQEDAgMBKAECAgMCAgkYGhgJbQoKCgoCCRgZGQkyCBAQEQlNES0uLRICERISEW0SLS4tEgIABAADAAAB/QHCAFUAbgCpALgAABM+AR4BFxYyPgEzND4CMzQ+ATQnLgMnJj4CIyImKgEHDgMHDgMjDgMHDgEqAQcOAwcOARQWFzAeAhceAjY3PgMzNjQ+ATcXLgEiBg8BDgEUFh8BHgI2PwE+ATQmLwElNCYiBgcOAwcOAiYnLgI2Nz4DNzYuAgcOAwcGFA4BDwEXNz4DFxY+Ajc+AiYnAQ4BFBYfAR4BPgE/AScHUAkREREKAgIDAgEMDgwBAQEBAQUFBgISIzMqCgUXGRQDDRoaFggKDwkEAQMBAgQFBgkIBgQBBgYFAQECAQELDAsBAQQEBAICBQYEAQEBAwSSAQIDAwElAQEBAdQCBQUFAhkCAwIB0wEbAwQDAQIGBwgCAggNEAsLCAEFAQIHCAYBAQECBAQDFhcVAwMBBwsiIisDDA0PCA8ZEw4FBQQBAQH+SQICAgIYAgUGBQJ9JoMBMAcCBxALAgICAQsMCwEBAgICAQUHCAMXJRsPAQEBCw8QBQcLCAUDCAkKBQQDAwIEBAUBAQMDAwILDgwCAQIBAQIBBQUEAQcKCgMOAgEBASABAgMDAfICAgECAhUCBAYFAvRnBQQCAgIKCwwEBAkGAQgIDQsJBAQMDQoCAQQEAQECCQ8UDAwXFhYKJCgoBAcEAgIDAgkPCggZGRUF/qICBQUFAhgCAQEDAnssfwAEAAIAHAIBAZUAhgCoAMUAzQAANy4DLwE3Jy4DJy4BPAE1PAI2Nz4DNz4BHgEXMh4CHwE3PgMxMh4CHwEHFTc+Azc+Azc+ATIWFx4DFRQWHAEdAQcOAwcOAiIjKgImJy4DJy4DMTAUBhQVFA4CByIGKgErAQcOAzEwLgInMTc+AyMuASoBBw4DFQ4CFBcVFx4DMTI+AjcxFzI+AjU+ATwBPQEHDgMxBh4BMjM6ATYyNzE3NSMPARczNQ0BAgICAQMiBwEDAgIBAQICAQIHCQoHBWJ0YAMBBAMDAQcVBAgGBAEBAwICBy8GAgUGCAQECAUFAQMKCgoDAgYGBAEDAgICBAICBAQGBgQGBQMCAQUICQUECAcEAQUJDgkCFCc4J5QWBQgGBAECAQHLNz4eBQECYHNhAgECAQIBAQEBBQECAgIBGSo5IJYBAgECAQGHHDIlFwIEGDYxIzMhEAF2EkwBTRIgAQMCAgEDHAcBBAQEAQQHGDIuLjIYCAMFCQcFAQEBAQEBAgICAQQRBAYFAwEDAgIIKBwFAQUGBwMFBgQDAQEBAQEBBAYGAwEVIiwZeAcCAwMCAQIBAQEBAQQGCAQECAUEAgQEAgoQDAgCARMEBgUDAQEBAb8uNBkHAQEBAQECAQECCBowKnkEAQEBARUjLxuAAQICAQEIGCsmbXEXKSATAQEBAQGBdUdaSXUAAAABAAD/4AHgAcAAMgAAJQ4DIyIuAicuAzU0PgI3Ni4CIyIOAjEUHgIXHgMzMD4CNTQuAgcBYAwODA4MDBgYGAwMFxILCxIXDAwSJCoMDCEeFRYlLhcXRElEGB4kHh8qKwygDBcSCwsSFwwMGBgYDAwODA4MDCsqHx4kHhhESUQXFy4lFhUeIQwMKiQSDAAAAAABAAMAcAH9AUAAUgAAJR4CBgcOAS4BJz4CJicuAyMiDgIHBhQeAQcWDgEmJy4CNjU+AzciMiIyIz4DMyMyMDIwMyIyIjIjMzIeAhcyIjIiMx4DFQH9AgEBBQQJMDYoAQEFBQIHCRQaGxAOHRgWBwkDBwEBKjQyBwYDAQMCBAkMCgEBAQEBDyQ0Qy4BAQEBAQIBAgEBLEUyJg0BAQEBAQgOBwbAChgWEwUJCAQTEgkPDxAJCQkFAQEFCQkJEA8PCRITBAgJBRMWGAoHDw8RCg0XEgoKEhcNChEPDwcACQAA/+AB4AHAAAQACQAOABMAGAAdACIAJwAsAAAlFTM1IyMVMzUjIxUzNSMlFTM1IyMVMzUjIxUzNSMlFTM1IyMVMzUjIxUzNSMBgGBgwGBgwGBgAYBgYMBgYMBgYAGAYGDAYGDAYGBAYGBgYGBgwGBgYGBgYMBgYGBgYGAAAAACAAD/4AIAAeAAFAAbAAABIg4CFRQeAjMyPgI1NC4CIwMnNxc3FwcBADVdRigoRl01NV1GKChGXTUwai87uRfQAeAoRl01NV1GKChGXTU1XUYo/mCKMUuXF/AAAAcAIP/gAeAB4ABeAHUAjACjALoA0QECAAAFISIuAj0BIyIuAj0BND4COwE1IyIuAj0BND4COwE1IyIuAj0BND4COwE1IyIuAj0BND4COwE1IyIuAj0BND4COwE1ND4CMyEyHgIVERQOAiMBIyIOAhUUHgI7ATI+AjU0LgIjFSMiDgIVFB4COwEyPgI1NC4CIxUjIg4CFRQeAjsBMj4CNTQuAiMVIyIOAhUUHgI7ATI+AjU0LgIjFSMiDgIVFB4COwEyPgI1NC4CIyU0LgInPgM3IzI+Aj0BNC4CKwEiDgIdARQeAjMjHgMXDgMdATM1AdD+oAMGBAMwAwYEAwMEBgMwMAMGBAMDBAYDMDADBgQDAwQGAzAwAwYEAwMEBgMwMAMGBAMDBAYDMAMEBgMBYAMGBAMDBAYD/pAgAwYEAwMEBgMgAwYEAwMEBgMgAwYEAwMEBgMgAwYEAwMEBgMgAwYEAwMEBgMgAwYEAwMEBgMgAwYEAwMEBgMgAwYEAwMEBgMgAwYEAwMEBgMgAwYEAwMEBgMBIAwVHREBAQIBAQcDBgQDAwQGAyADBgQDAwQGAwcBAQIBAREdFQzAIAMEBgMQAwQGAyADBgQDIAMEBgMgAwYEAyADBAYDIAMGBAMgAwQGAyADBgQDIAMEBgMgAwYEAxADBgQDAwQGA/4gAwYEAwHQAwQGAwMGBAMDBAYDAwYEA2ADBAYDAwYEAwMEBgMDBgQDYAMEBgMDBgQDAwQGAwMGBANgAwQGAwMGBAMDBAYDAwYEA2ADBAYDAwYEAwMEBgMDBgQDYgoPCQYBAQEBAQEDBAYDYAMGBAMDBAYDYAMGBAMBAQEBAQEGCg4KEhIAAAAABAAg/+AB4AHgAAQACQAOACUAABMzESMROwERIxE7AREjESUVMxEUHgIzITI+AjURMzUjNSMVI4BAQGBAQGBAQP7gIAsSFwwBAAwXEgsggMCAAUD+4AEg/uABIP7gASBgQP7ADBcSCwsSFwwBQEBAQAAAAAAEAAMAIAH7AaAAUgBnAHwAkQAAJTI+AjU0LgIjIg4CBy4DJy4DJzMeAzMyPgI1NC4CIyIOAgcjLgMjIg4CFRQeAjMyPgI3HgMXHgMXHgMzETIeAhUUDgIjIi4CNTQ+AjMFND4CMzIeAhUUDgIjIi4CNQU0PgIzMh4CFRQOAiMiLgI1AbMPGhQLCxQaDwsUEQ0EFhwTDAcDBwgLB3sEDhEUCw8aFAsLFBoPCxQRDgTkBA0RFQsPGhMMDBMaDwsUEQ4EFhwSDQYHER8wJgQNERULCQ8LBwcLDwkIDwwGBgwPCP5vBgsQCAkPCwcHCw8JCBALBgFoBgwPCAkPCwcHCw8JCA8MBiALFBoPDxoUCwYLEAkCEBoiFAoWFRUKChAMBgsUGg8PGhQLBgwQCQkQDAYLFBoPDxoUCwYLEAkCEBoiFBUuKB0ECRELBwFiBwsPCQkPCwcHCw8JCQ8LByoJDwsHBwsPCQkPCwcHCw8J8AkPCwcHCw8JCQ8LBwcLDwkAAAACAHgAMwGIAZoAFgAtAAABIg4CFREUHgIzMj4CNRE0LgIjIyIOAhURFB4CMzI+AjURNC4CIwFaChEMBwcMEQoJEQwICAwRCbQJEQwICAwRCQoRDAcHDBEKAZoEBw0K/twJDQgDAwgNCQEkCg0HBAQHDQr+3AkNCAMDCA0JASQKDQcEAAABALMAUQGzAXsAFwAAJScuAQ4BFREUHgE2PwEUPgI1NC4CNQGr2wYKCAUFCAoG2wMDAgIDA/SIAwIFCQn++gkJBgMCiQEDAwYBBAQFAQEAAAEAIP/gAX0B4AAOAAAFPgEuAQcVJzcVNh4BBgcBfRUTG1ZUwMBkciMnNSAnWk4yAn/AwHwCTXeJOQAAAAEAg//gAeAB4AAOAAABNRcHNSYOARYXLgE+ARcBIMDAVFYbExU1JyNyZAFkfMDAfwIyTlonOYl3TQIAAA0AAP/gAgAB4AADAAcACwATABsAHwAjACcAKwAzADcAOwBDAAATIRUhBzMVIxEzFSMDNSM1IxUzNQMVMzUzNTM1BzMVIxEzFSMBMxUjIzMVIzcVMxUzFTM1AzMVIzsBFSM3FSMVIxUzNYABAP8AICAgICAgICBgYCAgICAgICAgAWAgICAgICAgICCAICAgICBAICBgAUDAICABQCD+oCAgYCAB4GAgICBAIP7AIAGAICCAICAgYP6AICAgICAgYAAAAAANAAD/4AIAAeAAAwALAA8AFwAbAB8AIwArAC8AMwA3AD8AQwAANzMVIzUVMxUzFTM1BzMVIxMVIxUjFTM1JzMVIzsBFSMXIRUhATUjNSMVMzUnMxUjNzMVIxEzFSMnFTM1MzUzNQczFSMgICAgICCAICBgICBggCAgICAgYAEA/wABQCAgYCAgICAgICAgYCAgICAgICAgYCAgIGBgIAHgICAgYCAgIGDAAQAgIGAgQCBAIP5AIIBgICAgQCAAAAAEACsACwHAAbUACgAPABQAGQAAARUjFSMVIxUhESMDIzUzFTMjETMRMyMRMxEBK1ZVVQGVlUBAQFVAQFVAQAG1VVVWqgGq/oCrqwEA/wABVv6qAAADACsACwHAAbUACgAPABQAAAEVIxUjFSMVIREjEyMRMxEzIxEzEQErVlVVAZWVFUBAVUBAAbVVVVaqAar+gAEA/wABVv6qAAACACsACwHAAbUACgAPAAABFSMVIxUjFSERIxMjETMRAStWVVUBlZVqQEABtVVVVqoBqv6AAVb+qgAAAAABACsACwHAAbUACgAAARUjFSMVIxUhESMBK1ZVVQGVlQG1VVVWqgGqAAAAAAQAK//1AcABywAaACkALgBFAAABByMiDgIdARQeAjsBFzoDMREqAyMDIyIuAj0BND4COwEVFyc1NxETFR4DFRQOAgcVPgM1NC4CJwEQVVUOFRAICBAVDlVVCBEOCQgLCgsIZUUFBgQCAgQGBUVqVVVWEBEIAQEIERAYIBQJCRQgGAHLawwTGQ17DRgRCmsB1v7AAwYIBHsECgcFqlZWqlb+qgEWLQMMEBILChMQDAMsAxMcIxMTIxwTBAAAAwAr//UB0wHLAAwAMwA4AAAlFScHHwEWNhY2FTUHBxQ0MDQVNTQ+Ahc3FTc1NxU3NSYGJgYnBycOAx0BFB4CFzcHJwEXAQErSB4LVggRDQkqwAEEBwRFFVYqCAsJCwhWVQ0WDwkBAwQCISIeAYoe/nbGkEccAWoBAQEBAfwrKAECAgF8AwsGBgEBRBYtVzAsQwEBAQEBbAEBCxQYDnoGCQoIBCKNHwGKHf50AAMAEQBBAgABgAAyAEsAVAAAASMiDgIPATU0LgIjISIOAh0BFB4CMyEyPgI9ARceAzsBMj4CPQE0LgIjASIuAj0BND4CMyEyHgIdARQOAiMhJSMnMSc1NzMVAeEOAwYFBQIqCAwRCv7bChENBwcNEQoBJQoRDAgqAgUFBgMOBgwIBQUIDAb+XwQFBAMDBAUEASUEBQQDAwQFBP7bAaEPPhBODwFxAQIDAicSCRAMBwcMEAnoCRALBwcLEAkSJwIDAgEECAsG6AYLCAT+7QIEBQPoAwYEAgIEBgPoAwUEAg46D1dI6AAAAAACACMAAwHdAb0ANgBtAAABJy4BIgYPAQ4BFBYfAR4DFzcuAy8BLgE0Nj8BPgEyFh8BHgEUBg8BHgMHNz4BNCYnBy4DJwceAx8BHgEUBg8BDgEiJi8BLgE0Nj8BLgM3Bw4BFBYfAR4BMjY/AT4BNCYvAQHdAhItLi0RbhESEhECAgMDAwIoAgMEAwECCgkJCm0JGRkYCQIKCgoKMQMFAwIBTRESEhGhAgMDAwIoAgMEAwECCgkJCm0JGRkYCQIKCgoKMQMFAwIBTRESEhECEi0uLRFuERISEQIBuwIREhIRbRItLi0SAgEDAgMBKAECAgMCAgkYGhgJbQoKCgoCCRgZGQkyCBAQEQlNES0uLRKdAQMCAwEoAQICAwICCRgaGAltCgoKCgIJGBkZCTIIEBARCU0RLS4tEgIREhIRbRItLi0SAgAEAAMAAAH9AcIAVQBuAKkAuAAAEz4BHgEXFjI+ATM0PgIzND4BNCcuAycmPgIjIiYqAQcOAwcOAyMOAwcOASoBBw4DBw4BFBYXMB4CFx4CNjc+AzM2ND4BNxcuASIGDwEOARQWHwEeAjY/AT4BNCYvASU0JiIGBw4DBw4CJicuAjY3PgM3Ni4CBw4DBwYUDgEPARc3PgMXFj4CNz4CJicBDgEUFh8BHgE+AT8BJwdQCREREQoCAgMCAQwODAEBAQEBBQUGAhIjMyoKBRcZFAMNGhoWCAoPCQQBAwECBAUGCQgGBAEGBgUBAQIBAQsMCwEBBAQEAgIFBgQBAQEDBJIBAgMDASUBAQEB1AIFBQUCGQIDAgHTARsDBAMBAgYHCAICCA0QCwsIAQUBAgcIBgEBAQIEBAMWFxUDAwEHCyIiKwMMDQ8IDxkTDgUFBAEBAf5JAgICAhgCBQYFAn0mgwEwBwIHEAsCAgIBCwwLAQECAgIBBQcIAxclGw8BAQELDxAFBwsIBQMICQoFBAMDAgQEBQEBAwMDAgsODAIBAgEBAgEFBQQBBwoKAw4CAQEBIAECAwMB8gICAQICFQIEBgUC9GcFBAICAgoLDAQECQYBCAgNCwkEBAwNCgIBBAQBAQIJDxQMDBcWFgokKCgEBwQCAgMCCQ8KCBkZFgT+ogIFBQUCGAIBAQMCeyx/AAQAAgAcAgEBlQCGAKgAxQDNAAA3LgMvATcnLgMnLgE8ATU8AjY3PgM3PgEeARcyHgIfATc+AzEyHgIfAQcVNz4DNz4DNz4BMhYXHgMVFBYcAR0BBw4DBw4CIiMqAiYnLgMnLgMxMBQGFBUUDgIHIgYqASsBBw4DMTAuAicxNz4DIy4BKgEHDgMVDgIUFxUXHgMxMj4CNzEXMj4CNT4BPAE9AQcOAzEGHgEyMzoBNjI3MTc1Iw8BFzM1DQECAgIBAyIHAQMCAgEBAgIBAgcJCgcFYnRgAwEEAwMBBxUECAYEAQEDAgIHLwYCBQYIBAQIBQUBAwoKCgMCBgYEAQMCAgIEAgIEBAYGBAYFAwIBBQgJBQQIBwQBBQkOCQIUJzgnlBYFCAYEAQIBAcs3Ph4FAQJgc2ECAQIBAgEBAQEFAQICAgEZKjkglgECAQIBAYccMiUXAgQYNjEjMyEQAXYSTAFNEiABAwICAQMcBwEEBAQBBAcYMi4uMhgIAwUJBwUBAQEBAQECAQMBBBEEBgUDAQMCAggoHAUBBQYHAwUGBAMBAQEBAQEEBgYDARUiLBl4BwIDAwIBAgEBAQEBBAYIBAQIBQQCBAQCChAMCAIBEwQGBQMBAQEBvy40GQcBAQEBAQIBAQIIGjAqeQQBAQEBFSMvG4ABAgIBAQgYKyZtcRcpIBMBAQEBAYF1R1pJdQAAAAEAAP/gAeABwAAyAAAlDgMjIi4CJy4DNTQ+Ajc2LgIjIg4CMRQeAhceAzMwPgI1NC4CBwFgDA4MDgwMGBgYDAwXEgsLEhcMDBIkKgwMIR4VFiUuFxdESUQYHiQeHyorDKAMFxILCxIXDAwYGBgMDA4MDgwMKyofHiQeGERJRBcXLiUWFR4hDAwqJBIMAAAAAAEAAwBwAf0BQABSAAAlHgIGBw4BLgEnPgImJy4DIyIOAgcGFB4BBxYOASYnLgI2NT4DNyIyIjIjPgMzIzIwMjAzIjIiMiMzMh4CFzIiMiIzHgMVAf0CAQEFBAkwNigBAQUFAgcJFBobEA4dGBYHCQMHAQEqNDIHBgMBAwIECQwKAQEBAQEPJDRDLgEBAQEBAgECAQEsRTImDQEBAQEBCA4HBsAKGBYTBQkIBBMSCQ8PEAkJCQUBAQUJCQkQDw8JEhMECAkFExYYCgcPDxEKDRcSCgoSFw0KEQ8PBwAJAAD/4AHgAcAABAAJAA4AEwAYAB0AIgAnACwAACUVMzUjIxUzNSMjFTM1IyUVMzUjIxUzNSMjFTM1IyUVMzUjIxUzNSMjFTM1IwGAYGDAYGDAYGABgGBgwGBgwGBgAYBgYMBgYMBgYEBgYGBgYGDAYGBgYGBgwGBgYGBgYAAAAAIAAP/gAgAB4AAUABsAAAEiDgIVFB4CMzI+AjU0LgIjAyc3FzcXBwEANV1GKChGXTU1XUYoKEZdNTBqLzu5F9AB4ChGXTU1XUYoKEZdNTVdRij+YIoxS5cX8AAABwAg/+AB4AHgAF4AdQCMAKMAugDRAQIAAAUhIi4CPQEjIi4CPQE0PgI7ATUjIi4CPQE0PgI7ATUjIi4CPQE0PgI7ATUjIi4CPQE0PgI7ATUjIi4CPQE0PgI7ATU0PgIzITIeAhURFA4CIwEjIg4CFRQeAjsBMj4CNTQuAiMVIyIOAhUUHgI7ATI+AjU0LgIjFSMiDgIVFB4COwEyPgI1NC4CIxUjIg4CFRQeAjsBMj4CNTQuAiMVIyIOAhUUHgI7ATI+AjU0LgIjJTQuAic+AzcjMj4CPQE0LgIrASIOAh0BFB4CMyMeAxcOAx0BMzUB0P6gAwYEAzADBgQDAwQGAzAwAwYEAwMEBgMwMAMGBAMDBAYDMDADBgQDAwQGAzAwAwYEAwMEBgMwAwQGAwFgAwYEAwMEBgP+kCADBgQDAwQGAyADBgQDAwQGAyADBgQDAwQGAyADBgQDAwQGAyADBgQDAwQGAyADBgQDAwQGAyADBgQDAwQGAyADBgQDAwQGAyADBgQDAwQGAyADBgQDAwQGAwEgDBUdEQEBAgEBBwMGBAMDBAYDIAMGBAMDBAYDBwEBAgEBER0VDMAgAwQGAxADBAYDIAMGBAMgAwQGAyADBgQDIAMEBgMgAwYEAyADBAYDIAMGBAMgAwQGAyADBgQDEAMGBAMDBAYD/iADBgQDAdADBAYDAwYEAwMEBgMDBgQDYAMEBgMDBgQDAwQGAwMGBANgAwQGAwMGBAMDBAYDAwYEA2ADBAYDAwYEAwMEBgMDBgQDYAMEBgMDBgQDAwQGAwMGBANiCg8JBgEBAQEBAQMEBgNgAwYEAwMEBgNgAwYEAwEBAQEBAQYKDgoSEgAAAAAEACD/4AHgAeAABAAJAA4AJQAAEzMRIxE7AREjETsBESMRJRUzERQeAjMhMj4CNREzNSM1IxUjgEBAYEBAYEBA/uAgCxIXDAEADBcSCyCAwIABQP7gASD+4AEg/uABIGBA/sAMFxILCxIXDAFAQEBAAAAAAAQAAwAgAfsBoABSAGcAfACRAAAlMj4CNTQuAiMiDgIHLgMnLgMnMx4DMzI+AjU0LgIjIg4CByMuAyMiDgIVFB4CMzI+AjceAxceAxceAzMRMh4CFRQOAiMiLgI1ND4CMwU0PgIzMh4CFRQOAiMiLgI1BTQ+AjMyHgIVFA4CIyIuAjUBsw8aFAsLFBoPCxQRDQQWHBMMBwMHCAsHewQOERQLDxoUCwsUGg8LFBEOBOQEDREVCw8aEwwMExoPCxQRDgQWHBINBgcRHzAmBA0RFQsJDwsHBwsPCQgPDAYGDA8I/m8GCxAICQ8LBwcLDwkIEAsGAWgGDA8ICQ8LBwcLDwkIDwwGIAsUGg8PGhQLBgsQCQIQGiIUChYVFQoKEAwGCxQaDw8aFAsGDBAJCRAMBgsUGg8PGhQLBgsQCQIQGiIUFS4oHQQJEQsHAWIHCw8JCQ8LBwcLDwkJDwsHKgkPCwcHCw8JCQ8LBwcLDwnwCQ8LBwcLDwkJDwsHBwsPCQAAAAIAeAAzAYgBmgAWAC0AAAEiDgIVERQeAjMyPgI1ETQuAiMjIg4CFREUHgIzMj4CNRE0LgIjAVoKEQwHBwwRCgkRDAgIDBEJtAkRDAgIDBEJChEMBwcMEQoBmgQHDQr+3AkNCAMDCA0JASQKDQcEBAcNCv7cCQ0IAwMIDQkBJAoNBwQAAAEAswBRAbMBewAXAAAlJy4BDgEVERQeATY/ARQ+AjU0LgI1AavbBgoIBQUICgbbAwMCAgMD9IgDAgUJCf76CQkGAwKJAQMDBgEEBAUBAQAAAwAAAEACAAGAABQAUQBmAAABIg4CBx4DMzI+AjcuAyMXHgMXDgMHDgMjIi4CJy4DJz4DNz4BMjY3DgMVFB4CMzI+AjU0LgInHgEyFhcHFA4CIyIuAjU0PgIzMh4CFQEAKk1CNRISNUJNKipNQjUSEjVCTSp+DBQTEQcHERMUDA4eICERESEgHg4MFBMRBwcRExQMAQEBAgECAwIBFCMuGxsuIxQBAgMCAQIBAQF+CA0RCgoRDQgIDREKChENCAGAFyo7JCQ7KhcXKjskJDsqF1UHERMVCwsVExEHCQ4JBQUJDgkHERMVCwsVExEHAQEBAQULCwsGGy4jFBQjLhsGCwsLBQEBAQEYChENCAgNEQoKEQ0ICA0RCgAAAAAFAAAAAAIAAeAAJQA2AE0AXgB5AAABHgMXDgMHLgMnNx4BMhY3Fj4CNz4DNy4DJzcHJiImIic3FhQWFBcOAwcTDwEuAwcmDgIHHgMXDwE3ATcFNh4CFwcuAzcmPgIXBz4DNzYwNjI3DgIUBx4DFwcuAycBpA8aGBMJEzRDTCsLGBUXCiYICw4MBxAiHx8NDRMUEAgIDxMTDCSlAwoHCQOcAgIBARMkLRzhHG0LFBcWDClOQTYRBxUVGw5aARwBxAH+7woPDgcCNwgQCgcBAQkMEgmYBhISFQsCAgECAwIDAQEDBwkHHgkVEBEGAUwKGRofDyU6KxYBAQEFBAUmAQMCAQEGCA8ICBAUFAwKFRIRBiTKAQICnAMJBwoDHC0kEwEBXgFtAwYCAwEBGCk8IxEdGxcMWRwBAcQcngEHChAINwIHDg8KCRIMCQFiChYSEgYCAQIGCgwKBwoWExMHHggPExMMAAEAAAAAAAC5BtUEXw889QALAgAAAAAAz0PlYAAAAADPQ+VgAAD/4AIBAeAAAAAIAAIAAAAAAAAAAQAAAeD/4AAAAgAAAP//AgEAAQAAAAAAAAAAAAAAAAAAADQAAAAAAAAAAAAAAAABAAAAAgAAIAIAAIMCAAAAAgAAAAIAACsCAAArAgAAKwIAACsCAAArAgAAKwIAABECAAAjAgAAAwIAAAICAAAAAgAAAwIAAAACAAAAAgAAIAIAACACAAADAgAAeAIAALMCAAAgAgAAgwIAAAACAAAAAgAAKwIAACsCAAArAgAAKwIAACsCAAArAgAAEQIAACMCAAADAgAAAgIAAAACAAADAgAAAAIAAAACAAAgAgAAIAIAAAMCAAB4AgAAswIAAAACAAAAAAAAAAAKABQAHgA8AFoAvAEcAUYBagGIAZ4B/AJSAsYDaARuBXYFvgYsBmwGmgfcCBYI1gkYCUAJXgl8Cd4KPgpoCowKqgrACx4LdAvoDIoNkA6YDuAPTg+OD7wQ/hE4EfgSOhJiEvATogAAAAEAAAA0AQMADQAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAOAK4AAQAAAAAAAQAiAAAAAQAAAAAAAgAOAI0AAQAAAAAAAwAiADgAAQAAAAAABAAiAJsAAQAAAAAABQAWACIAAQAAAAAABgARAFoAAQAAAAAACgAoAL0AAwABBAkAAQAiAAAAAwABBAkAAgAOAI0AAwABBAkAAwAiADgAAwABBAkABAAiAJsAAwABBAkABQAWACIAAwABBAkABgAiAGsAAwABBAkACgAoAL0ARQB4AGEAcgBpAG8ALQBJAGMAbwBuAC0ARgBvAG4AdABzAFYAZQByAHMAaQBvAG4AIAAxAC4AMABFAHgAYQByAGkAbwAtAEkAYwBvAG4ALQBGAG8AbgB0AHNFeGFyaW8tSWNvbi1Gb250cwBFAHgAYQByAGkAbwAtAEkAYwBvAG4ALQBGAG8AbgB0AHMAUgBlAGcAdQBsAGEAcgBFAHgAYQByAGkAbwAtAEkAYwBvAG4ALQBGAG8AbgB0AHMARwBlAG4AZQByAGEAdABlAGQAIABiAHkAIABJAGMAbwBNAG8AbwBuAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA") format("truetype"),url("../fonts/Exario-Icon-Fonts.svg#Exario-Icon-Fonts") format("svg");font-weight:normal;font-style:normal}@font-face{font-family:\'bsl_icons\';src:url("../fonts/bsl_icons.eot?") format("embedded-opentype")}@font-face{font-family:\'bsl_icons\';src:url("data:application/font-woff;base64,d09GRk9UVE8AACYcAAoAAAAAJdQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABDRkYgAAAA9AAAIRQAACEUOV3yhE9TLzIAACIIAAAAYAAAAGAOkhLWY21hcAAAImgAAAEkAAABJCRZIRxnYXNwAAAjjAAAAAgAAAAIAAAAEGhlYWQAACOUAAAANgAAADYCFTuzaGhlYQAAI8wAAAAkAAAAJAgCBC9obXR4AAAj8AAAALgAAAC4oWYIlm1heHAAACSoAAAABgAAAAYALlAAbmFtZQAAJLAAAAFLAAABS8VkKhxwb3N0AAAl/AAAACAAAAAgAAMAAAEABAQAAQEBCmJzbF9pY29ucwABAgABADr4HAL4GwP4GAQeCgAJd/+Lix4KAAl3/4uLDAeLS/rU+lQFHQAAAXIPHQAAAXcRHQAAAAkdAAAhCxIALwEBChMVFxofJCkuMzg9QkdMUVZbYGVqb3R5foOIjZKXnKGmq7C1ur/Eyc7T2N3i5+xic2xfaWNvbnNic2xfaWNvbnN1MHUxdTIwdUU2MDB1RTYwMXVFNjAydUU2MkN1RTYzNHVFNkJCdUU2QzB1RTZDMXVFNkMydUU2QzN1RTZEOHVFNkQ5dUU2REF1RTZEQnVFNkRDdUVEM0J1RUVCM3VGMTYydUYxNjN1RjE2N3VGMTcwdUYxNzF1RjE3MnVGMTdGdUYxODZ1RjFCOXVGMUZFdUYyQzd1RjJDOXVGMkNGdUYyRDR1RjM0QnVGMzcxdUYzQTR1RjQ1Q3VGNDY1dUY0Nzd1RjRCQnVGNUE0dUY1QTV1RjVBQnVGNUFDAAACAYkALAAuAgABAAQABwAKAA0AgwEcA6wEAgR1BJQFdgYUBnQGngbgBwQHNwexCA0KzQ1YDsUQahFlEcUSpRSCFQAWcRfQGDMYpxlCGbQaIRq/G0kb6BxLHKcdIR1bHaQd5x5vHzT+lA7+lA7+lA78lA76jfgUFZNUkT9ybmJb+5mLi+uLu7arYrtiukOMOos6i0OKYlxiW7Zri1uLK/uZi2K7cqiR15PCCJGwmrO9vouLi4uLi9bR9wXE94aMCIuLBYyLjYuMi4yLjYuMiwiLiwX3hor3BVLWRYuLi4uLi71YmmORZggO+jr38hVV6Kv3C+nBCCb3QwVvemmBZ4sgizTji/cACPtdiwWLaoJpemxVLvsMay7BCCb7QgWoeqRznWzBLmr7Cy5VCPD7QgWom6yVrov2i+I0jPsACPddiwWLrJOtnanB6PcLq+lVCO/3QwVum3OjeaoI/Dr7ARX7B4sv54v3B4v3B+fn9weL9weL5y+L+weL+wcvL/sHiwgO97n3ghWL+wIFi3yFfoGAgIB+hnyLCPtLiwV8i36QgJaAloaYi5oIi/cCBYuakJiWlpaVmJGaiwj3S4sFmouYhZaBlYCRfot8CIv3uBWL+wEFi3uFfoGBgIB+hnyLCPtLiwV8i36QgJaAlYaYi5sIi/cBBYubkJeWlpaWmJCaiwj3S4sFmouYhpaAlYCRf4t7CPgB+7gVi/sCBYt8hn6AgIGAfoZ7iwj7SosFe4t+kIGWgJaGmIuaCIv3AgWLmpCYlpaVlZiRm4sI90qLBZuLmIWVgZaAkH6LfAj8AfjdFYv7AgWLfIV+gYCAgX6FfIsI+0uLBXyLfpGAlYCWhpiLmgiL9wIFi5qQmJaWlpWYkZqLCPdLiwWai5iFloGVgJF+i3wI+AH7uRWL+wEFi3uGfoCBgYB+hnuLCPtKiwV7i36QgZaAlYaYi5sIi/cBBYubkJeWlpWWmJCbiwj3SosFm4uYhpWAloCQf4t7CPgC+7gVi/sCBYt8hn6AgICAfoZ8iwj7S4sFfIt+kICWgZaFmIuaCIv3AgWLmpGYlZaWlZiRmosI90uLBZqLmIWWgZaAkH6LfAj8AvjdFYv7AgWLfIZ+gICBgX6Fe4sI+0qLBXuLfpGBlYCWhpiLmgiL9wIFi5qQmJaWlZWYkZuLCPdKiwWbi5iFlYGWgJB+i3wI+AL7uRWL+wEFi3uGfoCBgIB+hnyLCPtLiwV8i36QgJaBlYWYi5sIi/cBBYubkZeVlpaWmJCaiwj3S4sFmouYhpaAloCQf4t7CIv3uRWL+wIFi3yGfoCAgIF+hXyLCPtLiwV8i36RgJWBloWYi5oIi/cCBYuakZiVlpaVmJGaiwj3S4sFmouYhZaBloCQfot8CA75VPfUFUtLi0tLi0uLS8tLy0vLS8uLy4vLy4vLy8vL+1T3VEuLS4v7FPtUi4uL+xT3GPuX9xD7EfcR+xD3l/sY9xSLCIuL91T3FIvLi8v7VPdUS0sIDvkn92cV+2f3Zov3r/cUi4v7efdB+0IF+4H5JxX7r4v7eft5i/uvi/uv93n7efevi/evi/d593mL96+L96/7efd5+6+LCIv+FBX7aIv7QPdAi/doi/do90D3QPdoi/doi/dA+0CL+2iL+2j7QPtA+2iLCA73FPnUFffUi4v9lPvUiwX4VPmUFffUi4v9lPvUiwUOy/oOsRV/i36QgpR4noupnp7j47v3CIv3EIv3EFv3CDPjeJ6LqZ6enp6pi5549SHF+yCL+yqL+ypR+yAhIQiCgn6Gf4sI+z7lFX6Lf5CClXidi6qenfcX9xeL92r7F/cXeJ2Lqp6dnZ6qi5143Tq4+wGL+weL+wde+wE5OoKBf4Z/iwj7P+YVf4t+kIKUeJ6LqZ6e3NyL9xg63Hiei6menp6eqYueePcK+wuL+1T7CvsLgoJ+hn+LCPso+SoVpaWggotnCIv90AWLZ3aCcaUI+4X3hfs0i4v4FPc0i/eF94UFDvlk9xQVfot/kIKVeJ2Lqp6d9xf3F4v3avsX9xd4nYuqnp2dnqqLnXjdOrj7AYv7B4v7B177ATk6goF/hn+LCPs/5hV/i36QgpR4noupnp7c3Iv3GDrceJ6LqZ6enp6pi5549wr7C4v7VPsK+wuCgn6Gf4sI+yj5KhWlpaCCi2cIi/3QBYtndoJxpQj7hfeF+zSLi/gU9zSL94X3hQUO+Ln3bxV/i36QgpR4noupnp7c3Iv3GDrceJ6LqZ6enp6pi5549wr7C4v7VPsK+wuCgn6Gf4sI+yj5KhWlpaCCi2cIi/3QBYtndoJxpQj7hfeF+zSLi/gU9zSL94X3hQUO+CX6BRWlpaCCi2cIi/3QBYtndoJxpQj7hfeF+zSLi/gU9zSL94X3hQUOi/pUFYv+lPqUi4v6lP6UiwX6VP5UFf4Ui4v6FPoUi4v+FAX7VPl0FfvU+9T7VPdU+xT7FPfU+9T4VPhU+xT3FAUOi/pUFYv+lPqUi4v6lP6UiwX6VP5UFf4Ui4v6FPoUi4v+FAUOi/pUFYv+lPqUi4v6lP6UiwX6VP5UFf4Ui4v6FPoUi4v+FAX9VPlUFfiUi4v8lPyUiwUO+JT6VBX7r4v7eft5i/uvi/uv93n7efevi/evi/d593mL96+L96/7efd5+6+LCIv+FBX7aIv7QPdAi/doi/do90D3QPdoi/doi/dA+0CL+2iL+2j7QPtA+2iLCPtU+BQVi/Xh4fWL9YvhNYshiyE1NSGLIYs14Yv1CA74lPpUFfuvi/t5+3mL+6+L+6/3eft596+L96+L93n3eYv3r4v3r/t593n7r4sIi/4UFftoi/tA90CL92iL92j3QPdA92iL92iL90D7QIv7aIv7aPtA+0D7aIsIDvoL92UV+xyLBXiLe5J+mH6YhJuLngiL0AWLnpKbmJiYmJuSnosI9xyLBZ6LnISYfph+knuLeAiLRgWLeIR7fn5+fnqEeIsIi/elFfsciwV4i3uSfph+mISbi54Ii9AFi56Sm5iYmJibkp6LCPcciwWei5yEmH6YfpJ7i3gIi0YFi3iEe35+fn56hHiLCIv3pRX7HIsFeIt7kn6YfpiEm4ueCIvQBYuekpuYmJiYm5Keiwj3HIsFnouchJh+mH6Se4t4CItGBYt4hHt+fn5+eoR4iwj76f3HFfsciwV4i3qSfph+mISbi54Ii9AFi56Sm5iYmJickp6LCPcciwWei5uEmH6YfpJ7i3gIi0YFi3iEe35+fn57hHiLCIv3pRX7HIsFeIt6kn6YfpiEm4ueCIvQBYuekpuYmJiYnJKeiwj3HIsFnoubhJh+mH6Se4t4CItGBYt4hHt+fn5+e4R4iwiL96UV+xyLBXiLepJ+mH6YhJuLngiL0AWLnpKbmJiYmJySnosI9xyLBZ6Lm4SYfph+knuLeAiLRgWLeIR7fn5+fnuEeIsIi/elFfsciwV4i3qSfph+mISbi54Ii9AFi56Sm5iYmJickp6LCPcciwWei5uEmH6YfpJ7i3gIi0YFi3iEe35+fn57hHiLCPvp/LYV+x2LBXiLe5J+mH6YhJuLngiL0AWLnpKbmJiYmJuSnosI9x2LBZ6Lm4SYfph+knuLeAiLRgWLeIR7fn5+fnuEeIsIi/elFfsdiwV4i3uSfph+mISbi54Ii9AFi56Sm5iYmJibkp6LCPcdiwWei5uEmH6YfpJ7i3gIi0YFi3iEe35+fn57hHiLCIv3pRX7HYsFeIt7kn6YfpiEm4ueCIvQBYuekpuYmJiYm5Keiwj3HYsFnoubhJh+mH6Se4t4CItGBYt4hHt+fn5+e4R4iwgO+lRLFfsUiwV6i3yRfph+mIWai5wIi/cUBYuckZqYmJiYmpGciwj3FIsFnIuahZh+mH6RfIt6CIv7FAWLeYV8f39+fnyFeYsIi/gUFfsUiwV6i3yRfph+l4Wai50Ii/cUBYudkZqYmJiXmpGciwj3FIsFnIuahZh/mH6RfIt5CIv7FAWLeYV8f39+fnyFeYsIi/gUFfsUiwV6i3yRfph+mIWai5wIi/cUBYudkZqYmJiXmpGciwj3FIsFnIuahZh/mH6RfIt5CIv7FAWLeoV8f35+fnyFeYsI/BT9lBX7FIsFeYt8kX+YfpiFmoucCIv3FAWLnJGamJiYmJqRnIsI9xSLBZ2LmoWYfpd+kXyLegiL+xQFi3mFfH9/fn58hXmLCIv4FBX7FIsFeYt8kX+YfpeFmoudCIv3FAWLnZGamJiYl5qRnIsI9xSLBZ2LmoWYf5d+kXyLeQiL+xQFi3mFfH9/fn58hXmLCIv4FBX7FIsFeYt8kX+YfpiFmoucCIv3FAWLnZGamJiYl5qRnIsI9xSLBZ2LmoWYf5d+kXyLeQiL+xQFi3qFfH9+fn58hXmLCPwU/ZQV+xSLBXqLfJF+mH6YhZqLnAiL9xQFi5yRmpiYmJiakZyLCPcUiwWci5qFmH6YfpF8i3oIi/sUBYt5hXx/f35+fIV5iwiL+BQV+xSLBXqLfJF+mH6XhZqLnQiL9xQFi52RmpiYmJeakZyLCPcUiwWci5qFmH+YfpF8i3kIi/sUBYt5hXx/f35+fIV5iwiL+BQV+xSLBXqLfJF+mH6YhZqLnAiL9xQFi52RmpiYmJeakZyLCPcUiwWci5qFmH+YfpF8i3kIi/sUBYt6hXx/fn5+fIV5iwgO9yb3FBWL+wIFi4aKh4eHiIiGiYaLCPsCiwWGi4eNh46Ij4mPi5AIi/cCBYuQjZCOjo+Pj4yQiwj3AosFkIuQio6Hj4iMhouGCPdw1BWL+0sFi4aJh4iHh4iHiYWLCPsBiwWFi4eNiI6Hj4mPi5AIi/dLBYuQjZCPjo6Pj4yRiwj3AYsFkYuPio+HjoiNhouGCPdv9yYVi/vdBYuGiYeIh4iIhomGiwj7AosFhouGjYiOiI+Jj4uQCIv33QWLkY2Pjo+OjpCNkIsI9wKLBZCLkImOiI6HjYeLhQj3cPdwFYv8uQWLhomHh4eIiIeJhYsI+wGLBYWLh42HjoiPiY+LkAiL+LkFi5CNkI6Oj46PjZGLCPcBiwWRi4+JjoiPiI2Gi4YI92/3uBWL/d0Fi4aJh4iHh4iHiYaLCPsCiwWGi4aNiI6Hj4qPi5AIi/ndBYuRjI+Pj46OkI2Qiwj3AosFkIuPiY+IjoeNh4uFCA77Jvjd+EsVi7N9rm6nb6homWOLYotpfW5ub299aItji2KZaaduqG+tfbSLs4uumaenqKiZrYu0CPe5yRWL+xMFi4eJhoiHiIeHiIeLCCF7BYR2g3qEfZh4n3Cnao+GjYeLhouGiYaHh4F9eHdwcG9wen2Ci4eLho2Fjgg8yQV7gnmEeYWFV4ZohniIgISGgIsI+xOLBYaLho2HjoeOiY+LkAh79AV4kXqSe5MIO04Fh4iGiYaLhYuGjYePW7dsq3yfiI+KkIuQi4+NkI6PkJOVl5mdmJyWmJKVgJ6DnoaeCCOaBYaMh42Ij4iPiZCLkAiL9xIFi5CNj46Qjo+OjY+MCPabBZCdkpyVnXygdqZyqYeQiZCLj4uPjY+OkJWZnp+np6amnZmUi5CLj4mQhwjaTgWck5yTnZCRv5GvkJ6OlZGRlosI9xOLBZGLj4mPiI+IjYeMhgibIQWehZyEmoMI3MgFj4+PjZGLkIuQiY+HvV6qapl4jYiNhouGi4eJhoiHhYOCfn16fXqBfYSClXiTeJF5CPN7BZCKj4mOh46HjYaLhggO+yb4lPkUFYv7lAWLhomGiIiHh4eKhosI+0uLBYaLhoyIj4eOipCLkAiLsAWLkIyPj4+OjpCNkIsI9xSLi/ddBYuQjZCOjo6PkIyQiwiwiwWQi4+Kj4eOiI2Gi4YI94L7XRWLw32/b7tvumWxXKdbp1eZU4tSi1d9XG9bb2Zlb1xvW31Xi1OLUplXp1ynW7Bmu28Ium+/fcSLw4u/mbunuqexsKe7p7qZv4vECPcUixWLO3dCZEhkR1VWSGRIZEF3PIs7i0KfSLJHslbAZM9kznfUi9uL2p/Vss6yzsDBz7IIzrLUn9uL2ovVd85kzmTBVbJIskifQYs8CA783fhL+YIVi/0CBYuBh4OEg4SEgoeBi4GLg4+Ekgj7U/dT+ymLBYGLgo6EkoSTh5OLlQiL93AFi5SPlJKSkpOUjpWLCPcpi/dT91IFkpOTjpWLlYuUiJKDkoSPg4uBCA78AvhL+YIVi/0CBYuBh4OEg4SEgoeBi4GLg4+Ekgj7U/dT+ymLBYGLgo6EkoSTh5OLlQiL93AFi5SPlJKSkpOUjpWLCPcpi/dT91IFkpOTjpWLlYuUiJKDkoSPg4uBCPdv+8sVi26DcHtye3J1eXGBh4mGioWLgouCjoSSg5KIlIuVi5ONkpCRj5CRkJGPko+Rj5KQCJGQkZKPk5CUjZaLmIuYiZaGk4eUhZKFkISPhZCEj4WPhZCHkIaRiZGLk4uWjpOTkgiSkpSPlIuRi5CKj4mlgaF5m3KbcpNwi24IDkL4S/mCFYv9AgWLgYeDhIOEhIKHgYuBi4OPhJII+1P3U/spiwWBi4KOhJKEk4eTi5UIi/dwBYuUj5SSkpKTlI6Viwj3KYv3U/dSBZKTk46Vi5WLlIiSg5KEj4OLgQj3b/vLFYtug3B7cntydXlxgYeJhoqFi4KLgo6EkoOSiJSLlYuTjZKQkY+QkZCRj5KPkY+SkAiRkJGSj5OQlI2Wi5iLmImWhpOHlIWShZCEj4WQhI+Fj4WQh5CGkYmRi5OLlo6Tk5IIkpKUj5SLkYuQio+JpYGheZtym3KTcItuCPcnixWLUXpVa1lrWmBnVXWGiYeKhouBi4KOhJOEkoeUi5SLmpKXmpKhlpmUk5CnoKGlm6oIm6qSrIuui66ErHuqe6p1pW+fg5F9lHWWfJKElouai5WPlJKSkpKUj5WLkIuPipCJCMF1tmerWatanFWLUQj3JosVizNzO1pBW0JLVTpohoqGioaLgYuDjoSSg5OIk4uVi5mSlpqUjoyPjZGOkY2PjY6NCJyUm5WZlbmusLalv6a/mMKLxYvFfsJwv3G/ZrZdrn2Ve5R6lYiMh42FjoWNh42IjQh8lISWi5mLlI6Uk5KSk5OOlYuQi5CKkIncactVu0G8QqM6izQIDvqU+YIVi/0CBYt7hIB8hIaJhoqGi4GLg4+Ekgj7e/d7iywFi117ZWtqa2tke16LCPwmiwVdi2Sba6trrHuxi7kIi/gmBYu4m7Krq6urspy5iwj4JosFuIuyeqtrq2ubZIteCIst93v3eQWSk5OOlYuQi5CKkImahZKAi3sIDkL5ufgWFYv7KAWLXXpla2pra2R7XosI/G+LBV2LZJtrq2use7GLuQiL+G8Fi7ibsqurq6yym7mLCPcliwWQi5CJjoePiI2Gi4aLgYaFgYltgXKAdn6HiYiLiYsIS4sFcYt2gnl5eXmCdYtyCIv8bwWLcpR1nXmdeaCCpYsI+G+LBaSLoZSdnZydlKGLpAiL9w4Fi5KPkZKPlZCWkpWUkZGRjJOIk4iPhYuECPcb968V+2/7bwWEg4KIgYuGi4eMho18kYOWi5sIi/cCMIsF+w+LN3JgWV1XfTGc+xSMgoiFgoeIiomKiYuFi4aOh5CHkIeRh5KHkYOYgZ+AnoGeg54Ig52EoYSkhaSHoougi56MnIybjZuNnY+dj52RnJGakpqUm5ablpuYmZqXmpedl6CWCKCWo5Slk6aSqZGuj62PsI60iwjmi4v3AQWLm5OXmpGQjY+MkIuVi5OHk4QI92/7bwWSg4+Di4GLgYeChIQIDvtv+bn3hhWLgYl+h3qHeod+h4KDeHR3ZHVneGiBaIuBi4GMgYyBjICOf45/j4KNhY6FjYCPfJAIfJGCjoeNZphpm26dWqlZtFe/V79ivm27eal7rH2wio+IlIWahZuIlYiRiZGJlIeXCIiXiJaKlYqVipWLlYuula6er6CyoKKek5SPmI+cj5uPmY2Vi5CLj4qOipKJlXyYcQiQg5CBk36SfZF/koCRgZGAkIKMiY+HkIORg4+EjoWNho2Fi4aLg4WCgH+AgICBfoEIfoF/gYCBgYCFgouEi4iMh42GjYWNiIyIjIiOh4+Ej4WNh4uKqFetXrBmsGa4ar9uCIyKj4mRh5GHkIiOio2Kj4mQiZGJj4qOi5KLlJGWlpWVlZeVmJSYlpeWlZeWlJGTiwiQi5GJkImRiJGHk4WThpCIjYmUhpWFloWWhZeEmYSYg5WGkoemfZqBjYSMiYyHi4UIDv0m9+j4JhWLhomHh4cI+577ngWHh4eJhouGi4eNh48IbqcFh4+JkIuQi5CNj4+PCPd193T7dfd1BYePiY+LkIuQjY+PjwioqAWPj4+MkIuQi4+Kj4cI9577nwWPiI2Gi4YIDviU+fQV+3qL+077Tov7eov7evdO+073eov3eov3TvdOi/d6i/d6+073Tvt6iwj3fPu+FfvD+8MFg4N/i4OTCIWRi4v7O/c8BYOTi5eTkwi0tAWTk5eLk4MI9wr7C/eM94wFk5OXi5ODCLRiBZODi3+DgwgO+JSrFft6i/tO906L93qL93r3TvdO93qL93qL9077Tov7eov7evtO+077eosI91P4rRWTk4uYg5MIYLUFg5N/i4ODCPsM+wz7DfcMBYOTf4uDgwhgYQWEg4t+koMI9w37DPsN+wwFhIOLfpKDCLZhBZODl4uTkwj3DfcM9wz7DAWTg5eLk5MItrUFk5OLmIOTCPsN9wz3DfcMBQ74hPnkFft6i/tO+06L+3qL+3r3TvtO93qL93qL9073Tov3eov3evtO9077eosIi/0gFXCLdqGLpYuloKGmi6WLoXWLcYtxdXVxiwi792QVi3F1dXGLcIt2oYulCIv3dAWLpqCgpouli6F2i3AIi/t0BQ76ZvctFfwl+UIFaqxVi2lqCPwl/UIFamqLVKxqCPoviwWsrIvCaqwI/Ib4TBWLpaChpouli6F1i3EIi/t0BYtwdXZxi3CLdqCLpgiL93QFu/xFFXGLdaGLpYumoaCli6aLoHaLcItxdnVwiwgO95T41BX3FIuL9xT7FIuL+xQF91SLFfcUi4v3FPsUi4v7FAX3VPcUFYv7FPcUi4v3FPsUiwX8FPvUFfcUi4v3FPsUi4v7FAX3VIsV9xSLi/cU+xSLi/sUBfdUixX3FIuL9xT7FIuL+xQF/BT7VBX3FIuL9xT7FIuL+xQF91SLFfcUi4v3FPsUi4v7FAX3VIsV9xSLi/cU+xSLi/sUBQ75k6wVi8n3FIuL9xTNi4v7UvtWiwX3FPl0FfsUi4vJ91aLi/tSSYuL9xQF/bL7FBVJi4v3UvdWi4tN+xSLi/sUBcnJFfk2i4v8sv02i4v4sgXN/HQV+LKLi/g2/LKLi/w2Bcv39RX4NIuL+7T8NIuL97QF+1T8dRX3FIuLTftWi4v3Us2Li/sUBQ74lPn0Fft6i/tO+06L+3qL+3r3TvtO93qL93qL9073Tov3eov3evtO9077eosIzPzNFWxca2ZVi2eRe6aTpgjR93gFjJGIkYaNho2BhIOCCGFYBYqUjJmLkKq6v7Gui6yHm3GFbQhF+3oFioaOhpCJkImWkpOVCLW9BYyCiX2LhQiC978VcYt1nouoi6ehnqWLpYuheItvi251eHGLCA74yPEV/C+Li/lh+C+Li/st8YuL9y0Fi8RduVKLCPwtiwVSi11di1IIi/1hBYtTuV3Eiwj4LYsFxIu5uYvDCIvyJYuLJAX4LffhFftg91yL+w/8YYuL+y74YYuL+w73YPdbBQ74lPoPFfuCi/tU+1WL+4GL+4L3VPtU94KL94KL91T3VIv3gov3gftU91X7gosI5PxCFfcw+zEzM/sx9zD7MfswM+P3MPcx+zD3MOPk9zH7Mfcx9zHjM/sw+zEFDvjT+gUV+3iL+037S4b7dwj7Eov3UPtm91D3ZvsmiwWR9z33Hvcc9z6L90GL9yH7IYv7Qov7Qvsh+yH7QYtFi0uiV7EIQz4F0lPlauyL93uL90/3UIv3fIv3fPtP91D7e4sIZvtXFYv7hPct+y6+vvsZ9xmL92ZEiwUO+Bn3shV9fYt0mX6ZfaGLmZkI91j3XAWZmYuhfZkI+1j3XAV9mXWLfX19fYt1mX0I9zX7Q/s1+0MFDviU+bcV+6b7pQVqaYtVrGqtasGLrKwIz8+L+8kFi1yxZLqLuouxsou6CIv3yc9HBZx6oIOhi6GLoZOcnKysi8FqrQj7pvelBQ75pvh4FWmsVYtqaghHR4v3yQWLumWyXItci2Vki1wIi/vJR88FaqxVi2lqamqLVaxpCPem+6X3pvelBayti8FqrAgO+JT5lBX7UYv7LPsti/tQi/tR9yz7LfdRi/dRi/cs9y2L91GL91D7LPct+1GLCPcy/EsVnHqLcHp7g4KAh4CLgIuAj4OUCCnsKSoFg4KAh4CLgIuAj4OUepuLppycCO3tKe0FepuLppycnJyli5x6CO0p7e0FnJyli5x6nHqLcHp7CCkp7SkFDviU+b8V+2iL+0D7QYv7Z4v7aPdA+0D3aIv3aIv3QPdAi/doi/dn+0D3QftoiwiL/T8V+zmL+xr3Gov3OYv3OPca9xr3OYv3OYv3Gvsai/s4i/s5+xr7Gvs5iwip978V9wX3BQWTk4uYg5SDk32Lg4MI+wX7BfsF9wUFg5N9i4ODg4KLfpODCPcF+wX7BfsFBYOCi36Tg4+GkYmQi5CLkY2PkAj3BfcF9wX7BQWPhpGJkIuQi5GNj5CTk4uYg5QI+wX3BQUO+pQU+pQViwwKAAMEAAGQAAUAAAKZAswAAACPApkCzAAAAesAMwEJAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAQAAA9awDwP/A/8ADwABAAAAAAQAAAAAAAAAAAAAAIAAAAAAAAgAAAAMAAAAUAAMAAQAAABQABAEQAAAAQABAAAUAAAABACDmAuYs5jTmu+bD5tztO+6z8WPxZ/Fy8X/xhvG58f7yx/LJ8s/y1PNL83HzpPRc9GX0d/S79aX1rP/9//8AAAAAACDmAOYs5jTmu+bA5tjtO+6z8WLxZ/Fw8X/xhvG58f7yx/LJ8s/y1PNL83HzpPRc9GX0d/S79aT1q//9//8AAf/jGgQZ2xnUGU4ZShk2EtgRYQ6zDrAOqA6cDpYOZA4gDVgNVw1SDU4M2AyzDIELygvCC7ELbgqGCoEAAwABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAH//wAPAAEAAAABAADEwEP4Xw889QALBAAAAAAAz1r7mwAAAADPWvubAAD/wARAA8AAAAAIAAIAAAAAAAAAAQAAA8D/wAAABEAAAAAABEAAAQAAAAAAAAAAAAAAAAAAAC4AAAAAAAAAAAAAAAACAAAABAAABwQAABIEAAAABAAAAAQAAAAEAACABEAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAA24AAANuAAABtwAAApIAAAO3AAAEAAAAA7cAAAMlAAABbgAHBAAAYAQAAGAEAABQBAAANwQAAQAEAAAfBAAAYAQAADMEAABSBAAAHwQAAYUEAADuBAAA7gQAAKsEAACAAABQAAAuAAAAAAAOAK4AAQAAAAAAAQASAAAAAQAAAAAAAgAOAFUAAQAAAAAAAwASACgAAQAAAAAABAASAGMAAQAAAAAABQAWABIAAQAAAAAABgAJADoAAQAAAAAACgAoAHUAAwABBAkAAQASAAAAAwABBAkAAgAOAFUAAwABBAkAAwASACgAAwABBAkABAASAGMAAwABBAkABQAWABIAAwABBAkABgASAEMAAwABBAkACgAoAHUAYgBzAGwAXwBpAGMAbwBuAHMAVgBlAHIAcwBpAG8AbgAgADEALgAwAGIAcwBsAF8AaQBjAG8AbgBzYnNsX2ljb25zAGIAcwBsAF8AaQBjAG8AbgBzAFIAZQBnAHUAbABhAHIAYgBzAGwAXwBpAGMAbwBuAHMARwBlAG4AZQByAGEAdABlAGQAIABiAHkAIABJAGMAbwBNAG8AbwBuAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA") format("woff"),url("data:application/x-font-ttf;base64,AAEAAAALAIAAAwAwT1MvMg6SEtYAAAC8AAAAYGNtYXAkWSEcAAABHAAAASRnYXNwAAAAEAAAAkAAAAAIZ2x5Zv50/xoAAAJIAAAiwGhlYWQCFTuzAAAlCAAAADZoaGVhCAIELwAAJUAAAAAkaG10eKFmCJYAACVkAAAAuGxvY2HI4sDWAAAmHAAAAF5tYXhwADkA1AAAJnwAAAAgbmFtZcVkKhwAACacAAABS3Bvc3QAAwAAAAAn6AAAACAAAwQAAZAABQAAApkCzAAAAI8CmQLMAAAB6wAzAQkAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAAD1rAPA/8D/wAPAAEAAAAABAAAAAAAAAAAAAAAgAAAAAAACAAAAAwAAABQAAwABAAAAFAAEARAAAABAAEAABQAAAAEAIOYC5izmNOa75sPm3O077rPxY/Fn8XLxf/GG8bnx/vLH8snyz/LU80vzcfOk9Fz0ZfR39Lv1pfWs//3//wAAAAAAIOYA5izmNOa75sDm2O077rPxYvFn8XDxf/GG8bnx/vLH8snyz/LU80vzcfOk9Fz0ZfR39Lv1pPWr//3//wAB/+MaBBnbGdQZThlKGTYS2BFhDrMOsA6oDpwOlg5kDiANWA1XDVINTgzYDLMMgQvKC8ILsQtuCoYKgQADAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAf//AA8AAQAAAAAAAAAAAAIAADc5AQAAAAABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAHAOAD+QKAAFIAAAEeAQ4BBw4BLgE1ND4BJicuAyMiDgIHDgEeARUUDgEmJy4CNjc+Azc4AzE+AzMxOgIwMzIwOgEzMTIeAhc4AzEeAxcD+QMEAQgJEGJpUwwIAw8PKjI5Hh45MioPDwMIDFNpYhAJCAEEAwIJEBkTHElmiFsBAQEBAQEBAVuIZkkcExkQCQIBgBUvLCYKEhEJJiQSHx4fEhITCQICCRMSEh8eHxIkJgkREgomLC8VDh0gIhMaLiMVFSMuGhMiIB0OAAAAAAIAEv/AA+4DwABCAFcAAAEuAT4BNycOAyMiLgI1IxQOAgcOAiYnBx4DFx4BDgEHFz4DMzIeAhUzND4CNz4CFhc3LgMnBSIuAjU0PgIzMh4CFRQOAiMDphQJEy8jZQoYGBoOKEc1HskDBwoGFT5ITSNlCxQSEAcUCRQuI2ULFxgaDShHNR/JAwcKBhQ+SUwkZAsUEhAG/lorSzkgIDlLKytLOSAgOUsrAV4jTEk+FK8HCgYEHzVHKQ0ZGBkLIy4TCRSuBhASFAwjTEg/FK4GCgYEHzVHKAwZGRgLIy4TCRSvBg8SFAxtIDlLKytLOSAgOUsrK0s5IAAACQAAAEkEAANuABQAKQA+AFMAaAB9AJIApwC8AAAlFRQHBisBIicmPQE0NzY7ATIXFhURFRQHBisBIicmPQE0NzY7ATIXFhUBFRQHBisBIicmPQE0NzY7ATIXFhUBFRQHBisBIicmPQE0NzY7ATIXFhUBFRQHBisBIicmPQE0NzY7ATIXFhUBFRQHBisBIicmPQE0NzY7ATIXFhUBFRQHBisBIicmPQE0NzY7ATIXFhUBFRQHBisBIicmPQE0NzY7ATIXFhURFRQHBisBIicmPQE0NzY7ATIXFhUBJRAQF7cXEBAQEBe3FxAQEBAXtxcQEBAQF7cXEBABbRAQF7YXEBAQEBe2FxAQ/pMQEBe3FxAQEBAXtxcQEAFtEBAXthcQEBAQF7YXEBABbhAQF7cXEBAQEBe3FxAQ/pIQEBe2FxAQEBAXthcQEAFuEBAXtxcQEBAQF7cXEBAQEBe3FxAQEBAXtxcQEO5uFxAQEBAXbhcQEBAQFwEkbRcQEBAQF20XEBAQEBf+3G4XEBAQEBduFxAQEBAXAkluFxAQEBAXbhcQEBAQF/7bbRcQEBAQF20XEBAQEBf+3G4XEBAQEBduFxAQEBAXAkluFxAQEBAXbhcQEBAQF/7bbRcQEBAQF20XEBAQEBcBJW4XEBAQEBduFxAQEBAXAAAAAQAA/8ADwAOAADIAAAEOAyMiLgInLgM1ND4CNzYuAiMiDgIxFB4CFx4DMzA+AjU0LgIHAsAYHBgcGBgwMDAYGC4kFhYkLhgYJEhUGBhCPCotSVsvL4eRiTA8SDw+VFYYAUAYLiQWFiQuGBgwMDAYGBwYHBgYVlQ+PEg8MImRhy8vW0ktKjxCGBhUSCQYAAAAAwAA/8AEAAPAAAUAGgAvAAAlJxE3FRcDJg4CFRQeAhc+AzU0LgIHEQYuAjU0PgI3HgMVFA4CJwKT04Ct7Wq7i1BQi7tqaruLUFCLu2pQi2k8PGmLUFCLaTw8aYtQ09MBGgHmrQKSAVGKvGlruoxPAQFPjLprabyKUQH8gQE9aIxPUYpqOwEBO2qKUU+MaD0BAAAAAAIAgABAA4ADQAADAAcAABMhESEBIREhgAFA/sABwAFA/sADQP0AAwD9AAAABAAAAA8EQANxAC0AVgB6AIsAACUiLgInLgE0Njc+AzU0LgInLgE0Njc+ATIWFx4DFRQOAgcOAyMnIi4CJy4BNDY3PgE0JicuATQ2Nz4BMhYXHgMVFA4CBw4DIyciLgInLgE0Njc+ATQmJy4BNDY3PgEyFhceARQGBw4DIwM+AR4BFREUDgEmLwEjETM3A3oFCQgIBAcHBwchMyISEiIzIQcHBwcHEhISByg9KRYWKT0oBAgICQWqBQkJCAMHBwcHMTExMQcHBwcHERMRBx8vIBERIC8fAwgJCQSrBQkICAQHBwcHHh8fHgcHBwcHEhISBywtLSwECAgJBZQKEQ0HBw0RCvGgoPEmAgMGAwcSEhIHIUxTWi4uWlNMIQcSEhIHBwcHByhbZWw4OGxlWygDBgMCWgIEBQQHERMRBzJ7gnsyBxETEQcHCAgHHkdNVCsrVE1HHgQFBAJbAgMGAwcSEhIHHk1QTR4HEhISBwcHBwcscXRxLAMGAwIClgoHBhAO/MQOEAYHCvEBgPEAAwAAAA8DcANxACgATABdAAAlIi4CJy4BNDY3PgE0JicuATQ2Nz4BMhYXHgMVFA4CBw4DIyciLgInLgE0Njc+ATQmJy4BNDY3PgEyFhceARQGBw4DIwM+AR4BFREUDgEmLwEjETM3AtAFCQkIAwcHBwcxMTExBwcHBwcRExEHHy8gEREgLx8DCAkJBKsFCQgIBAcHBwceHx8eBwcHBwcSEhIHLC0tLAQICAkFlAoRDQcHDREK8aCg8YACBAUEBxETEQcye4J7MgcRExEHBwgIBx5HTVQrK1RNRx4EBQQCWwIDBgMHEhISBx5NUE0eBxISEgcHBwcHLHF0cSwDBgMCApYKBwYQDvzEDhAGBwrxAYDxAAAAAgAAAA8CRwNxACMANAAAJSIuAicuATQ2Nz4BNCYnLgE0Njc+ATIWFx4BFAYHDgMjAz4BHgEVERQOASYvASMRMzcCJQUJCAgEBwcHBx4fHx4HBwcHBxISEgcsLS0sBAgICQWUChENBwcNEQrxoKDx2wIDBgMHEhISBx5NUE0eBxISEgcHBwcHLHF0cSwDBgMCApYKBwYQDvzEDhAGBwrxAYDxAAABAAAADwHAA3EAEAAAAT4BHgEVERQOASYvASMRMzcBkQoRDQcHDREK8aCg8QNxCgcGEA78xA4QBgcK8QGA8QAAAwAA/8AEAAPAAAQACQAQAAATESERIQEhESERAwEnBwkBJwAEAPwAA8D8gAOAwP7AwIABQAHAgAPA/AAEAPxAA4D8gALg/sDAgP7AAcCAAAACAAD/wAQAA8AABAAJAAATESERIQEhESERAAQA/AADwPyAA4ADwPwABAD8QAOA/IAAAAAAAwAA/8AEAAPAAAQACQANAAATESERIQEhESERASERIQAEAPwAA8D8gAOA/UACAP4AA8D8AAQA/EADgPyAAsD+AAAAAAADAAD/wAQAA8AAFAApAD4AAAEiDgIVFB4CMzI+AjU0LgIjESIuAjU0PgIzMh4CFRQOAiMDND4CMzIeAhUUDgIjIi4CNQIAaruLUFCLu2pqu4tQUIu7alCLaTw8aYtQUItpPDxpi1DAHjRGKChGNB4eNEYoKEY0HgPAUIu7amq7i1BQi7tqaruLUPyAPGmLUFCLaTw8aYtQUItpPAGAKEY0Hh40RigoRjQeHjRGKAAAAAIAAP/ABAADwAAUACkAAAEiDgIVFB4CMzI+AjU0LgIjESIuAjU0PgIzMh4CFRQOAiMCAGq7i1BQi7tqaruLUFCLu2pQi2k8PGmLUFCLaTw8aYtQA8BQi7tqaruLUFCLu2pqu4tQ/IA8aYtQUItpPDxpi1BQi2k8AAoAAP/AA7wDwAAUACkAPgBTAGgAfQCSAKcAvADRAAAlIyInJj0BNDc2OwEyFxYdARQHBiMRIyInJj0BNDc2OwEyFxYdARQHBiMRIyInJj0BNDc2OwEyFxYdARQHBiMBIyInJj0BNDc2OwEyFxYdARQHBiMRIyInJj0BNDc2OwEyFxYdARQHBiMRIyInJj0BNDc2OwEyFxYdARQHBiMRIyInJj0BNDc2OwEyFxYdARQHBiMBIyInJj0BNDc2OwEyFxYdARQHBiMRIyInJj0BNDc2OwEyFxYdARQHBiMRIyInJj0BNDc2OwEyFxYdARQHBiMDd4gcFBQUFByIHRQUFBQdiBwUFBQUHIgdFBQUFB2IHBQUFBQciB0UFBQUHf6riB0UFBQUHYgcFBQUFByIHRQUFBQdiBwUFBQUHIgdFBQUFB2IHBQUFBQciB0UFBQUHYgcFBQUFBz+q4kcFBQUFByJHBQUFBQciRwUFBQUHIkcFBQUFByJHBQUFBQciRwUFBQUHNEUFBxFHBQUFBQcRRwUFAERFBQcRRwUFBQUHEUcFBQBERQUHEUcFBQUFBxFHBQU/M0UFBxFHBQUFBQcRRwUFAERFBQcRRwUFBQUHEUcFBQBERQUHEUcFBQUFBxFHBQUAREUFBxFHBQUFBQcRRwUFP3eFBQcRRwUFBQUHEUcFBQBERQUHEUcFBQUFBxFHBQUAREUFBxFHBQUFBQcRRwUFAAACQAA/8AEAAPAABQAKQA+AFMAaAB9AJIApwC8AAAFIyInJj0BNDc2OwEyFxYdARQHBiMRIyInJj0BNDc2OwEyFxYdARQHBiMRIyInJj0BNDc2FzcWFxYdARQHBgcBByYnJj0BNDc2Nxc2FxYHFwYHBicDJwYnJjcnNjc2FzcWFxYdARQHBgcRByYnJj0BNDc2OwEyFxYHFwYHBiMBIyInJjcnNjc2OwEyFxYXBxYHBiMTIyInJic3Jjc2OwEyFxYHFwYHBiMDIyInJjcnNjc2FzcWFxYXBxYHBgcDwIAaExMTExqAGhMTEhMbgBoTExMTGoAaExMSExuAGhMTExMagBoTExITG/6AgBsSExMTGoAbEhMBAQERFBoBfxwRFAEBARIUGYEaExISExuAGxITExMagBsSEwEBAREUGv5/fxsSFAEBARIUGYEZFBIBAQETEhwBgRkUEgEBARQSG38bEhQBAQERFBoBfxsSFAEBARIUGYEZFBIBAQETEhxAExMagBoTExMTGoAbEhMBgBITGoEaExISExuAGxITAYATExqAGxITAQEBERQagRkUEgH9AQEBEhQZgRkUEgEBARQSG38cERQBAX8BARMSG4AbEhMBAQERFBqBGhMSAQGBAQESFBmBGhMSEhMbgBoTE/0AExMagBoTExMTGoAbEhMBgBITGoEaExISExuAGxITAYATExqAGxITAQEBERQagRkUEgEAAAAFAAAAAAQAA24AFAApAD4AUwBoAAA3FRQHBisBIicmPQE0NzY7ATIXFhU3FRQHBisBIicmPQE0NzY7ATIXFhU3ERQHBisBIicmNRE0NzY7ATIXFhU3ERQHBisBIicmNRE0NzY7ATIXFhUTERQHBisBIicmNRE0NzY7ATIXFhWSBQUIbggFBQUFCG4IBQXcBQYIbQgFBgYFCG0IBgXbBQUIbggFBQUFCG4IBQXcBgUIbQgGBQUGCG0IBQbbBQUIbggFBQUFCG4IBQWAbggFBQUFCG4IBQUFBQhJtwgFBQUFCLcIBQUFBQiS/rcIBQUFBQgBSQgGBQUGCNz92wgFBQUFCAIlCAUFBQUIAST8twgFBQUFCANJCAYFBQYIAAIAAAAAA24DbgAQAIMAAAE0JyYHJgcGFRQXFhc2NzY1JRUUBwYPAQYHFhcWFRQHBgcGJwYvAQYHBgcGBycGJyY1JyYnBwYnBicmJyY1NDc2NzY3Ji8BJicmPQE0NzY/ATY3JicmNTQ3Njc2FzYfATY3Njc2Nxc2FxYfARYXNzYXNhcWFxYVFAcGBwYHFh8BFhcWFQJJKys8PSsqKis9PCsrASUFBAdqCwsUKQYGDykpDQcITxkbCQcEEX8IBgYQHBhQBggIB0gWBAUIFRQLEAhoCAQFBQQGawgOFyYGBQ8qKQ0HB08ZGwkIBBB/CAYGARAcF1EGCAgGShUEBQgVFQoPCWgIBAUBtz0qLAEBLCo9PCwpAQEpLDw/gAYHBQIPIBQeMQgGCQUWJyoBAQY9DApMHg8BAQEGBAhoCgs8BgEBB0EfBQkFCAsbGQ8cHQ4CBQcHfwYIBQIPGxohLQgGBwYWKCoBAQc8DAlNHg8BAQEGBAhpCgs8BwEBB0MeBAkGBwsbGQ8cHA8CBQcHAAMAAAAAA24DbgAaADMATAAAAREUBwYrASInJj0BNDc2OwE1NDc2OwEyFxYVFzQnJicmIyIHBgcGFRQXFhcWMzI3Njc2NTMUBwYHBiMiJyYnJjU0NzY3NjMyFxYXFhUCAAUFCLcIBQUFBQiABQUIJQgFBe4qKkdIVFVHSCkqKilIR1VUSEcqKoA7O2Vld3hkZTs7OztlZHh3ZWU7OwKA/wAIBQUFBQglCAUFyQgFBQUFCMlUSEcqKioqR0hUVUdIKSoqKUhHVXhkZTs7OztlZHh3ZWU7Ozs7ZWV3AAABAAAAWwG3AxIAGgAAAREUBwYjIi8BIyInJj0BNDc2OwE3NjMyFxYVAbcLCw8PCr+VDwsLCwsPlb8KDw8LCwLu/ZIPCwsLvwoLD9wOCwu+CwsKDwACAAAAWwKSAxIAGgBDAAABERQHBiMiLwEjIicmPQE0NzY7ATc2MzIXFhUTFAcGBwYjIicmNTQ3Njc2NzY3NjU0JyYnJicmJyY1NDc2MzIXFhcWFQG3CwsPDwq/lQ8LCwsLD5W/Cg8PCwvbGBgoBgkOCwsHBwkKCgkHBwcHCQoKCQcHCwsOCQYoGBgC7v2SDwsLC78KCw/cDgsLvgsLCg/+ySwlJRADCgsPDAkIBgYHBw0NFBMNDgcHBgYICAwQCgsDDyYmKwAAAAQAAAAhA7cDTQAaAEMAaACVAAABERQHBiMiLwEjIicmPQE0NzY7ATc2MzIXFhUTFAcGBwYjIicmNTQ3Njc2NzY3NjU0JyYnJicmJyY1NDc2MzIXFhcWFTMUBwYHBiMiJyY1NDc2NzY3NjU0JyYnJicmNTQ3NjMyFxYXFhUzFAcGBwYjIicmNTQ3Njc2NzY3Njc2NTQnJicmJyYnJicmNTQ3NjMyFxYXFhUBtwsLDw8Kv5UPCwsLCw+VvwoPDwsL2xgYKAYJDgsLBwcJCgoJBwcHBwkKCgkHBwsLDgkGKBgYkzExUAcHDwsLFiAMKhgXFxgqDCAWCwsPBwdQMTGSSUh5BwgPCgsWBAkJBBoVRicoKCdGFRoECQkEFgsKDwgHeUhJAu79kg8LCwu/CgsP3A4LC74LCwoP/sksJSUQAwoLDwwJCAYGBwcNDRQTDQ4HBwYGCAgMEAoLAw8mJitYSkohAwsLDhcLEQgfLy41NC8vHgkRCxYPCwsDIkpKV4RubjQCCgsPFQ0CBAQCDg80Tk1YV05ONA8OAgQEAg0VDgsLAzRuboMAAAABAAAASQQAAyUAJAAAAREUBwYjIi8BFRQHBiMhIicmNRE0NzYzITIXFh0BNzYzMhcWFQQAFggHDwrnMDBE/m5EMTAwMUQBkkQwMOcKDwcIFgLu/ZIYCgML519EMTAwMUQBkkQwMTEwRF7lCwMJGAAAAgAAAEkDtwO3ADIAbwAAARUUBwYjISInJjURNDc2OwEyFxYVFAcGBwYrASIHBhURFBcWMyEyNzY9ATQ3Njc2FxYVEwcGIyInJj0BIyIHBhcWBwYjIicmJyYnJicmJyY1NDc2NzY3Njc2NzY3Njc2NzY7ATU0NzYzMh8BFhUUBwMlMTBE/iVEMTAwMUSRCAUGDywgBgNAJhsbGxsmAdsmGxoLEA8JCwyH2wsPBwcXW7lBRBkCDQUCCQYGBgYQEQwMCgoCAgYGCgoRERYXHyAnKDQzPVsXBwcPC9sLCwGClEQxMDAxRAHbRDAxBgUIDwMPEwIbGyb+JSYbGxsbJnoLBgcOCQUFCwEb2wsDCRhuS07ADQYCCAgKCR4dHBsmJSAcGBgcGxcXGBcTExARCwsGB20YCgML2wsPDwsAAAEAAABJAyUDbgBwAAAlFAcGBwYHBiMiJyYnJicmJyYnJicmJyYnJicmJyYnJicmJyY1NDc2NzY3NjMyFxYXFhcWFxYXFhcWFxYVFAcGBwYHBhUUFxYXFhcWFRYXFhcWFxYXFhcWMzI3Njc2NzYzMhcWFxYXFhcWFxYXFhcWFQMlBgYGDDo2NBAODxISCQkXFwU4LElOTi0cFAEJCAQDBQUCAh0gHQ4ZGQ8IBAoUBwsKCgkIAggJBAQREBMTERADAwICBgYsODhOAQoKBAQHCAULEBAODhERDAgICAwMAw4QERQUCigEAvIPGRkOHSAdAgIFBQQDCAkCFBstTk5JLDgFFxcJCRISDw8PNTU6DAYGBgIDKAsUFBEQDgIMDAkICAsSEQ4OEBALBQcIBAQKCgFOODgrAQYGAgIDAxEQExMQEQQECQgCCAkJCwsGFAsECAAAAAABAAcAdQFUAq8AGgAAARQHAQYjIi8BJjU0PwEnJjU0PwE2MzIXARYVAVQG/vYGBwgFHQYG4eEGBh0FCAcGAQoGAZIHBv72BgYcBggHBuDhBgcHBh0FBf71BQgAAAIAYAAgA6ADYAAUADYAAAEiDgIVFB4CMzI+AjU0LgIjEwEOASImLwExJy4BNDY/AT4BMhYfATc+ATIWHwEeARQGBwIAVphxQUFxmFZWmHFBQXGYVuj+0QMHCAcDBqcDAwMDKQMHCAcDdvgDBwgHAykDAwMDA2BBcZhWVphxQUFxmFZWmHFB/tb+0QMDAwMGqAMHBwgDKQMDAwN3+AMDAwMpAwcIBwMAAAIAYAAgA6ADYAAUAEkAACUiLgI1ND4CMzIeAhUUDgIjEz4BNCYvAS4BIgYPAScuASIGDwEOARQWHwEHDgEUFh8BHgEyNj8BFx4BMjY/AT4BNCYvATcCAFaYcUFBcZhWVphxQUFxmFa/AwMDAysDBwgHA3h5AwcIBwMrAwICA3l5AwICAysDBwgHA3l4AwcIBwMrAwMDA3l5IEFxmFZWmHFBQXGYVlaYcUECGQMIBwgDKgMDAwN4eAMDAwMqAwgHCAN4eAMIBwgDKgMDAwN4eAMDAwMqAwgHCAN4eAADAFAAEAOQA1AAFAApAEAAAAEiDgIVFB4CMzI+AjU0LgIjESIuAjU0PgIzMh4CFRQOAiM3FA4CIyIuAj0BND4CMzIeAh0BAfBWmHFBQXGYVlaYcUFBcZhWChENCAgNEQoKEQ0ICA0RCjAIDREKChENCAgNEQoKEQ0IA1BBcZhWVphxQUFxmFZWmHFB/XQIDREKChENCAgNEQoKEQ0I0AoRDQgIDREK4AoRDQgIDREK4AAAAAADADcAIAPSA0cAEgApAD4AACUBLgEiBgcBDgEUFhchPgE0JicBND4CMzIeAh0BFA4CIyIuAj0BEyIuAjU0PgIzMh4CFRQOAiMD0v5vDCAhHw3+bwwNDQwDmwwNDQz+DgcNEgoKEQ0ICA0RCgoSDQcwChENCAgNEQoKEQ0ICA0RCpkCrgwNDQz9Ug0fIR8NDR8hHw0BuAoRDQgIDREK4AoSDQcHDRIK4P5PCA0RCgoSDQcHDRIKChENCAAAAAkBAADAAwACwAAEAAkADgATABgAHQAiACcALAAAATM1IxU7ATUjFTcVMzUjATM1IxU7ATUjFTsBNSMVBTM1IxU7ATUjFTsBNSMVAQCAgMCAgMCAgP6AgIDAgIDAgID+gICAwICAwICAAkCAgICAgICA/sCAgICAgIDAgICAgICAAAAAAAcAHwAhA8EDPwAGAA0AFAAZAB4AIwAqAAAlNTM1MxUjEyM1MxUjNQUjNTMVIxU3IREhERMhESEREyERIREDMxUjNTMVAv+AQsKAgMJC/OJCwoA+AqL9XkICHv3iQAGg/mDAgMJCIT6AvgLgPr6AgL4+gD794gIe/iABov5eAWH+4AEg/h8+voAAAAAAAwBgACADoANgABQASwBgAAABIg4CFRQeAjMyPgI1NC4CIxMOAyMuAz8BPAEuAScmDgIPASY8ATY1PgMzHgMPARwBHgEXMj4CPwEcAgYVAyIuAjU0PgIzMh4CFRQOAiMCAFaYcUFBcZhWVphxQUFxmFZBDBgcIRQOEwsDA0YCAwICBQYHAyoBAQseIB8ODBILBAJGAgMCAgUHBwMqAQkKEQ0ICA0RCgoRDQgIDREKA2BBcZhWVphxQUFxmFZWmHFB/ccSHhcNAwsQEwvkAwQDAwEBAgQGAzMDCAgHAhIfFw0CChAVC+YCAwQCAQEEBgQyAwkIBwIBKwcMEgsKEgwHBwwSCgsSDAcAAgAzAAADzQOaACAAKAAAJSETIRczNy4DIyEiDgIHEwYeAjMhMj4CJzcjFwEnByEHIQc3AjT+ZAEBmgFlAQEQHCUW/mgXJB0PAQEBERsmFQGaFCcaEgEBZwEBmMsB/jQBAc4BzWYCzZmZFSYbEREbJhX9MxUlHBAQHCUVZ2cBTch7mnrHAAAAAAIAUgAfA64DewAUACEAAAEiDgIVFB4CMzI+AjU0LgIjExcHJwcnNyc3FzcXBwIAWZ10RER0nVlZnXRERHSdWVmcWJ2dWJycWJ2dWJwDe0R0nVlZnXVDQ3WdWVmddET+Up1YnJxYnZxZnZ1YnQAAAAACAB8AKQPhA3EALQA0AAABIg4CByMXNyM+AzMyHgIXDgMjIi4CJwceAzMyPgInNi4CIwcfATcnNyMCP1WXcEQBf727kQE0VHE/QnFWMQEBMVZxQhkzLiwTSRw7QkQmVZpxQgEBQnGaVSYBmDSGAUgDcUBvllXS0kBvUjAyVXNBQXNWMQgQFw5NFSEXDEJymVdXmXJCw/CaM4XSAAABAYUA7AJ7Aq4AHQAAAQ4BFBYXHgEyNj8BPgE0Ji8BLgEiBgcOARQWHwEHAYUFBQUFBQ0ODQXEBQUFBcQFDQ4NBQUFBQWhoQEeBQ0ODQUGBQUGyAUNDg0FyAUFBQUFDQ4NBa+vAAAAAAEA7gBSAxIDIwApAAAJAQ4BFBYXHgI2PwERFB4CNxY+AjURFx4DNxY+Ajc+ATQmJwECAP7uDA0NDA0fISAMRA0XHxISHxcNRAYPDxAICRAPDgcMDQ0M/u4DI/7uDCAgIQsNDAEOC0X+yhEgFg8BAQ8WIBEBNkUFCwUEAQEEBQsFDR8iHg4BEAABAO4AWgMSAysAJAAAAS4BDgEPARMuAycOAxcDJy4CBgcOAR4BFwkBPgEuAScDEgwgICELRQEBDBgeExEgFg4BAUMNHyIeDgsOAQwNAREBEwsOAQwNAeQMDQELDkMBNBMeGA0BAQ0YHhP+zEMOCwENDA0fIh4O/vABEA4eIh4OAAIAqwBVA1UDAAAUAE8AAAEiDgIVFB4CMzI+AjU0LgIjEx4BFAYHDgMjIi4CLwEHDgMjIi4CJy4BNDY/AScuATQ2Nz4BMhYfATc+ATIWFx4BFAYPARcCAEd8XTU1XXxHR3xdNTVdfEeeBgcHBgMHCAgEBAgIBwNiYgMHCAgEBAgIBwMGBwcGYmIGBwcGBhAQEAZiYgYQEBAGBgcHBmJiAwA2XH1GR3xdNjZdfEdGfVw2/kkGEBEPBgQEAwICAwQEYWEEBAMCAgMEBAYPERAGYmIGDxEQBgYGBgZiYgYGBgYGEBEPBmJiAAADAIAAKwOAAysAFAApAGQAAAEiDgIVFB4CMzI+AjU0LgIjESIuAjU0PgIzMh4CFRQOAiMTNz4BNCYnLgEiBg8BJy4BIgYHDgEUFh8BBw4BFBYXHgMzMj4CPwEXHgMzMj4CNz4BNCYvAQIAT4xpPDxpjE9PjGk8PGmMTz5tUS8vUW0+Pm1RLy9RbT4ecQMDAwMDCAgIA3FxAwgICAMDAwMDcXEDAwMDAQQEBAICBAQEAXFxAQQEBAICBAQEAQMDAwNxAys9aIxPUIxoPDxojFBPjGg9/VUvUW0+PW1RLy9RbT0+bVEvAStxAwgICAMDAwMDcXEDAwMDAwgICANxcQMICAgDAgICAQECAgJxcQICAgEBAgICAwgICANxAAEAAAABAABndDKIXw889QALBAAAAAAAz1r7mwAAAADPWvubAAD/wARAA8AAAAAIAAIAAAAAAAAAAQAAA8D/wAAABEAAAAAABEAAAQAAAAAAAAAAAAAAAAAAAC4AAAAAAAAAAAAAAAACAAAABAAABwQAABIEAAAABAAAAAQAAAAEAACABEAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAA24AAANuAAABtwAAApIAAAO3AAAEAAAAA7cAAAMlAAABbgAHBAAAYAQAAGAEAABQBAAANwQAAQAEAAAfBAAAYAQAADMEAABSBAAAHwQAAYUEAADuBAAA7gQAAKsEAACAAAAAAAAKABQAHgCGAQIB/gJGApACpgNsA/YESARoBJAEqgTMBSQFYAZyB4QIEgjYCUYJcAnUCqgK4At+DCgMVgyqDRgNcg3QDhIOWA7cDyAPWA+mD9oQHhBeENIRYAAAAAEAAAAuANIACgAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAOAK4AAQAAAAAAAQASAAAAAQAAAAAAAgAOAFUAAQAAAAAAAwASACgAAQAAAAAABAASAGMAAQAAAAAABQAWABIAAQAAAAAABgAJADoAAQAAAAAACgAoAHUAAwABBAkAAQASAAAAAwABBAkAAgAOAFUAAwABBAkAAwASACgAAwABBAkABAASAGMAAwABBAkABQAWABIAAwABBAkABgASAEMAAwABBAkACgAoAHUAYgBzAGwAXwBpAGMAbwBuAHMAVgBlAHIAcwBpAG8AbgAgADEALgAwAGIAcwBsAF8AaQBjAG8AbgBzYnNsX2ljb25zAGIAcwBsAF8AaQBjAG8AbgBzAFIAZQBnAHUAbABhAHIAYgBzAGwAXwBpAGMAbwBuAHMARwBlAG4AZQByAGEAdABlAGQAIABiAHkAIABJAGMAbwBNAG8AbwBuAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA") format("truetype"),url("../fonts/bsl_icons.svg#bsl_icons") format("svg");font-weight:normal;font-style:normal}.client [class^="icon-"],.client [class*=" icon-"]{font-family:\'bsl_icons\';speak:none;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon{cursor:pointer}.icon a{speak:none;text-decoration:none;margin:0 .35em 0 0}.icon a:before{color:#fff}.icon-trash:before{content:"\\e013";color:#f00}.icon-screen-sharing:before{content:"\\e604"}.icon-screen-sharing-off:before{content:"\\e605"}.icon-link:before{content:"\\e00b"}.icon-dialpadShow:before,.icon-dialpadShow:hover:before,.icon-dialpadHide:before,.icon-dialpadHide:hover:before{content:"\\ed3b"}.icon-hangup:before,.icon-hangup:hover:before{content:"\\e600"}.icon-clock:before{content:"\\e634"}.client .icon-cog:before,.icon-settings:before,.icon-settings:hover:before{content:"\\e601"}.icon-resume:before,.icon-resume:hover:before,.icon-hold:before,.icon-hold:hover:before{content:"\\e6bb"}.icon-unmuteAudio:before,.icon-unmuteAudio:hover:before{content:"\\e6c1"}.icon-muteAudio:before,.icon-muteAudio:hover:before{content:"\\e6c3"}.icon-arrow-up-thick:before{content:"\\f5a4"}.icon-arrow-down-thick:before{content:"\\f5a5"}.icon-cancel3:before{content:"\\f2c9"}.icon-fullScreenContract:before,.icon-fullScreenContract:hover:before,.icon-fullScreenExpand:before,.icon-fullScreenExpand:hover:before{content:"\\f371"}.icon-th:before{content:"\\e602"}.icon-selfViewEnable:before,.icon-selfViewEnable:hover:before,.icon-selfViewDisable:before,.icon-selfViewDisable:hover:before{content:"\\f17f"}.icon-transfer:before,.icon-transfer:hover:before{content:"\\f186"}.icon-angle-right:before{content:"\\f1fe"}.icon-call:before{content:"\\e00e";color:#3b9e3b}.icon-hangup:before{content:"\\e00f";color:#f00}.view-conference .icon-hangup:before,.view-conference .icon-hangup:hover:before{color:#fff!important}.view-conference .selfViewDisable,.view-conference .selfViewEnable{text-align:right!important}.view-conference .fullScreenExpand,.view-conference .fullScreenContract{text-align:left!important}.view-audioOnly .fullScreenExpand,.view-audioOnly .fullScreenContract,.view-audioOnly .selfViewDisable,.view-audioOnly .selfViewEnable,.view-audioOnly .cell-fullScreen,.view-audioOnly .cell-selfView{display:none!important}.selfViewEnable a,.dialpadIconHide a,.unmuteAudio a,.fullScreenContract a{color:#04aff0!important}.watermark-icon{position:absolute;top:50%;left:50%;backface-visibility:hidden;transform:translate(-50%,-50%);color:rgba(255,255,255,0.08);z-index:1;font-size:265px;text-align:center;width:100%}.started .hangup,.calling .hangup{transition:all 1s linear;opacity:1;z-index:20}.connected .hangup,.disconnected .hangup,.client.held .hold,.client:not(.started) .hold,.client:not(.held) .resume,.client:not(.started) .resume{transition:all 1s linear;opacity:0;z-index:-1}.icon-highlightable:hover{color:<%= iconHightlightColor %>}.icon a:hover,.icon span:hover,.videoBar a:hover{color:<%= iconHightlightColor %>}.connection-status{display:none;position:absolute;top:13px}.connectedIcon{right:5px}.registeredIcon{right:40px}.quality{display:none;position:absolute;z-index:10;top:13px;left:15px}.icon-quality:before{color:#0f0;opacity:.4}.icon-quality1:before{content:"\\e007"}.icon-quality2:before{content:"\\e006"}.icon-quality3:before{content:"\\e005"}.icon-quality4:before{content:"\\e004"}.view-audioOnly .quality1,.view-audioOnly .quality2,.view-audioOnly .quality3,.view-audioOnly .quality4{display:none!important}.videoBar{display:none;position:relative;top:0;left:0;width:100%;height:40px;background:#000;background-image:-ms-linear-gradient(center top,#404040,#000);background-image:linear-gradient(to bottom,#404040,#000);background-image:-webkit-linear-gradient(#404040,#000);background-image:-moz-linear-gradient(top,#404040,#000);border-radius:4px;border:2px solid #ddd;box-shadow:0 0 10px #000;margin-top:5px;background-image:none;border-radius:0;border:0;box-shadow:none;margin-top:0;background:#292929;border-top:1px solid #3c3c3c}.videoBar .icon{z-index:10;margin:0 2.5px;position:absolute}.videoBar .table{height:100%;margin:6px;margin:0}.videoBar .cell{position:relative;top:0;left:0;width:35px;width:36px}.videoBar .cell .icon{width:100%;text-align:center;margin-top:10px;margin-right:0;margin-left:0}.videoBar .cell .icon a{margin:0}.videoBar .cell:first-child{padding:0}.videoBar span{color:#808080}.videoBar .unmuteAudio{margin-top:-1px}.videoBar .leftSpacer{width:8px}.videoBar .cell-hangup{width:42px}.videoBar .subtitle{display:none}.videoBar .cellTimer{position:relative;top:0;left:0;width:auto}.videoBar .rightSpacer{width:8px}.full-screen-expanded .videoBar{top:auto!important;bottom:0;position:absolute}.hangup,.fullScreen,.selfView,.muteAudioIcon,.dialpadIcon,.messages{top:0;left:0}#videoBar #settings{width:auto;background-color:transparent}.view-audioOnly .videoBar{display:inline-block;width:auto}.view-audioOnly .videoBar .table{table-layout:auto;width:auto}.view-audioOnly .cell-hangup{width:35px!important}.view-conference .cell-hangup{width:30px!important;top:2px}.view-conference .videoBar .cell .hangup{margin-top:0;width:140px;background-color:#f00;border-radius:5px;margin-left:10px;height:36px;line-height:14px}.view-conference .hangup .subtitle{display:block!important;font-size:14px;color:#fff}.videoBar .icon,.videoBar a{font-size:20px;color:#808080;text-decoration:none}.videoBar .hold,.videoBar .resume{margin-top:-1px}.sms{display:none;position:absolute;top:10px;right:10px}.sms .view{padding:10px;border-radius:4px;border:2px solid #ddd;box-shadow:0 0 10px #999}.sms .loginForm{width:250px}.sms .sendForm{width:600px;display:none}.sms .sendBody{width:339px}.sms .inbox{width:600px;display:none}.sms .inbox .inner{max-height:250px;overflow:auto}.sms .inbox .cell{padding:5px}.sms .inbox .from{width:100px}.sms .inbox .status{width:50px}.sms .inbox .time{width:135px}.sms .inbox .body{word-wrap:break-word}.sms .inbox .body>div{display:none}.sms .inbox .inboxItem.image .body .image span{margin-right:5px}.sms .inbox .actions{width:15px}.sms .inbox .icon-trash{font-size:15px}.sms .status{display:none;text-align:right}.sms .status .statusContent{text-align:right;border:1px solid #c3c3c3;background-color:#e3e2e2;font-size:70%;padding:1px 3px;border-top:0;margin-right:15px;border-bottom-right-radius:4px;border-bottom-left-radius:4px}.sms .status.error{color:#f00}.sms .inbox .inboxItem.text .body .text,.sms .inbox .inboxItem.image .body .image,.sms .inbox .inboxItem.video .body .video,.sms .inbox .inboxItem.audio .body .audio{display:block}.sms .inbox .inboxItem.audio .body .audio audio,.sms .inbox .inboxItem.video .body .video video{width:100%}.inbox .inboxContent{display:table-row-group}authPopup{width:210px;height:200px}authPopup span{color:#999;font-size:14px;line-height:18px}authPopup input{background:#666;border-bottom:1px solid #333;border-left:1px solid #000;border-right:1px solid #333;border-top:1px solid #000;color:#fff;border-radius:3px;font-family:arial;font-size:16px;padding:6px 6px 4px;width:200px}authPopup button{border-color:#999;border-width:1px;border-radius:4px;color:#333;cursor:pointer;padding:6px 6px 4px;margin-top:10px;font-size:12px;width:200px}authPopup .alert{font-size:20px;text-align:center;color:#f00}.sign-in,.sign-out{display:none}.client:not(.registered) .sign-in,.client.registered .sign-out{display:block}.client:not(.disconnected).auth-visible .authPopup{transition:all 1s linear;opacity:1;z-index:100}.client.disconnected .authPopup,.client.auth-hidden .authPopup{transition:all 1s linear;opacity:0;z-index:-1}.timer{display:none;position:absolute;top:3px;left:0;width:100%;text-align:center;font-family:arial;font-size:16px;top:11px}.timer{color:<%= timerColor %>}.view-audioOnly .timer{position:relative;margin-right:10px}.client:not(.started) .timer{transition:all 1s linear;opacity:0;z-index:-1}.messages{position:absolute;font-family:arial;text-align:left;width:auto;font-size:12px;bottom:auto;top:10px;left:10px}.view-audioOnly .messages{left:10px!important;top:48px!important;font-weight:bold;font-size:14px}.normal{color:<%= infoMessageColor %>}.success{color:<%= successMessageColor %>}.warning{color:<%= successMessageColor %>}.alert{color:<%= alertMessageColor %>}.client .fileshare-container{display:none}.client:not(.started) .file_share{transition:all 1s linear;opacity:0;z-index:-1}.enable-xmpp.xmpp-shown .xmpp{transition:all 1s linear;opacity:1;z-index:100}.enable-xmpp.xmpp-hidden .xmpp{transition:all 1s linear;opacity:0;z-index:-1}';
var ejs=require("ejs");var $=jQuery=require("jquery");var Icon=require("../Icon");var WebRTC_C=require("../Constants");var Utils=require("../Utils");var ExSIP=require("exsip");require("../models/eventbus");var ClientConfig=require("../../js/client-config.js.default");function ClientView(options,eventbus,debug,configuration,videoView,videobarView,sound,callcontrol,sipstack,transferview,authenticationview,xmppView,incomingcallView,reinviteView,messagesView,settings){var self={};self.elements=["client","main","errorPopup"];options=options||Utils.clone(ClientConfig);self.visibilities={};self.appendTo=function(parent){parent.append(self.view)};self.updateCss=function(styleData){self.styleData=styleData||{};var cssData=$.extend({},WebRTC_C.STYLES,WebRTC_C.FONTS,self.styleData);var cssStr=ejs.render(styles,cssData);if($("#webrtc_css").length===0){$("<style type='text/css' id='webrtc_css'>"+cssStr+"</style>").appendTo("head")}else{$("#webrtc_css").text(cssStr)}};self.init=function(options){var unsupported=Utils.compatibilityCheck(configuration);if(unsupported){$("#unsupported").html(unsupported).show()}var whiteboardUnsupported=Utils.whiteboardCompabilityCheck();if(whiteboardUnsupported){$("#whiteboard_unsupported").html(whiteboardUnsupported).show()}self.updateCss();self.updateClientClass();$.cookie.raw=true;sipstack.init();if(!configuration.enableConnectLocalMedia&&configuration.destination){eventbus.once("connected",function(e){callcontrol.callUri(configuration.destination)})}};self.showErrorPopup=function(error){window.alert(error)};self.setClientConfig=function(clientConfig){var connectionChanged=configuration.websocketsServers[0].ws_uri!==clientConfig.websocketsServers[0].ws_uri;jQuery.extend(options,clientConfig);jQuery.extend(configuration,options);self.updateClientClass();if(connectionChanged){sipstack.init()}};self.listeners=function(){$(document).unbind("keypress").bind("keypress",function(e){});$(document).unbind("keydown").bind("keydown",function(event){var isModifier=event.altKey;if(isModifier){if(transferview.targetInput.is(event.target)){return}eventbus.modifier(event.which)}});eventbus.on("viewChanged",function(e){self.visibilities[e.view]=e.visible;self.updateClientClass()});eventbus.on("failed",function(e){var error=e.data.cause;if(error==="User Denied Media Access"){self.showErrorPopup("WebRTC was not able to access your microphone/camera!")}});eventbus.on("registrationFailed",function(e){self.updateClientClass()});eventbus.on("registered",function(e){self.updateClientClass()});eventbus.on("unregistered",function(e){self.updateClientClass()})};self.asScript=function(){var script='<script src="'+self.src+'" ';var dataStrs=Object.keys(self.styleData).filter(function(key){var value=self.styleData[key];var defaultValue=WebRTC_C.STYLES[key];return!!value&&value!==defaultValue}).map(function(key){var value=self.styleData[key];return"data-"+key.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+"='"+value+"'"});script+=dataStrs.join(" ");var config=$.extend({},options);Object.keys(config).forEach(function(key){var value=config[key];var defaultValue=ClientConfig[key];if(!value&&!defaultValue){delete config[key];return}if(Array.isArray(value)){value=JSON.stringify(value);defaultValue=JSON.stringify(defaultValue)}else{value=value+"";defaultValue=defaultValue+""}if(value===defaultValue){delete config[key]}});script+=">\n"+JSON.stringify(config,undefined,2)+"\n</script>";return script};self.updateClientClass=function(){var classes=["client"];classes.push("r"+configuration.getResolutionDisplay());classes.push(configuration.isWidescreen()?"widescreen":"standard");var callState=sipstack.getCallState();if(callState){classes.push(callState)}if(sipstack.isRegistered()){classes.push("registered")}if(configuration.enableMute){classes.push("enable-mute")}if(configuration.enableShareScreen){classes.push("enable-shareScreen")}if(configuration.enableCallControl){classes.push("enable-call-control")}if(configuration.enableTransfer){classes.push("enable-transfer")}if(configuration.enableHold){classes.push("enable-hold")}if(configuration.enableCallTimer){classes.push("enable-timer")}if(configuration.enableSettings){classes.push("enable-settings")}if(configuration.enableFullScreen){classes.push("enable-full-screen")}if(configuration.enableSelfView){classes.push("enable-self-view")}if(configuration.enableDialpad){classes.push("enable-dialpad")}if(configuration.enableSMS){classes.push("enable-sms")}if(configuration.enableStats){classes.push("enable-stats")}if(configuration.enableXMPP){classes.push("enable-xmpp")}var views=configuration.getViews();if(views&&views.length>0){views.map(function(view){classes.push("view-"+view)})}if(configuration.enableScreenSharing){classes.push("enable-screen-sharing")}if(configuration.enableFileShare){classes.push("enable-file-share")}if(configuration.selfViewSize){classes.push("selfView-"+configuration.selfViewSize)}if(configuration.selfViewLocation){classes.push("selfView-"+configuration.selfViewLocation)}if(sound.muted){classes.push("muted")}else{classes.push("unmuted")}if(self.selfViewEnabled){classes.push("self-view-enabled")}else{classes.push("self-view-disabled")}Object.keys(self.visibilities).forEach(function(view){classes.push(view+"-"+(self.visibilities[view]?"shown":"hidden"))});if(self.fullScreen){classes.push("full-screen-expanded")}else{classes.push("full-screen-contracted")}if(self.isScreenSharing){classes.push("screen-sharing")}else{classes.push("screen-sharing-off")}if(transferview.visible){classes.push("transfer-visible")}else{classes.push("transfer-hidden")}if(authenticationview.visible){classes.push("auth-visible")}else{classes.push("auth-hidden")}self.client.attr("class",classes.join(" "))};return self}exports.constructor=ClientView},{"../../js/client-config.js.default":1,"../Constants":452,"../Icon":454,"../Utils":455,"../models/eventbus":463,ejs:171,exsip:202,jquery:230}],472:[function(require,module,exports){module.exports=ConnectionStatusView;var Utils=require("../Utils");var ExSIP=require("exsip");function ConnectionStatusView(options,eventbus,configuration){var self={};self.elements=["connectedIcon","registeredIcon"];self.listeners=function(){eventbus.on("disconnected",function(e){if(configuration.enableConnectionIcon){self.connectedIcon.removeClass("success");self.connectedIcon.addClass("alert").fadeIn(100)}});eventbus.on("connected",function(e){if(configuration.enableConnectionIcon){self.connectedIcon.removeClass("alert");self.connectedIcon.addClass("success").fadeIn(10).fadeOut(3e3)}});eventbus.on("registrationFailed",function(e){if(configuration.enableRegistrationIcon){self.registeredIcon.addClass("alert").fadeIn(100)}});eventbus.on("registered",function(e){if(configuration.enableRegistrationIcon){self.registeredIcon.removeClass("alert");self.registeredIcon.addClass("success").fadeIn(10).fadeOut(3e3)}})};return self}},{"../Utils":455,exsip:202}],473:[function(require,module,exports){module.exports=DialpadView;var PopupView=require("./popup");function DialpadView(options,eventbus,callcontrol,historyView,videobarView){var self={};self.__proto__=PopupView(options,self,eventbus);self.elements=["historyButton","destination","call","keys"];self.listeners=function(){window.onbeforeunload=function(e){self.endCall({rtcSession:"all"});return null};eventbus.on("disconnected",function(e){videobarView.endCall()});eventbus.on("failed",function(e){videobarView.endCall({rtcSession:e.sender})});self.keys.bind("click",function(e){e.preventDefault();self.destination.val(self.destination.val()+e.firstChild.nodeValue);self.processDigitInput(e.target.textContent)});eventbus.on("ended",function(e){videobarView.endCall({rtcSession:e.sender})});self.destination.keypress(function(e){if(e.keyCode===13){e.preventDefault();callcontrol.callUri(self.destination.val())}});self.historyButton.bind("click",function(e){e.preventDefault();historyView.toggle()});self.call.bind("click",function(e){e.preventDefault();sound.playClick();callcontrol.callUri(self.destination.val())});eventbus.on("calling",function(e){self.destination.val(e.destination)});eventbus.on("viewChanged",function(e){if(e.view==="dialpad"&&e.visible){self.destination.focus()}});eventbus.on("viewChanged",function(e){if(e.view==="history"){if(e.visible){self.historyButton.removeClass("active")}else{self.historyButton.addClass("active")}}else if(e.view==="settings"&&e.visible){self.hide()}});$(document).bind("keydown",function(event){if(self.visible){var doPrevent=false;if(event.keyCode===8){var d=event.srcElement||event.target;if(d.tagName.toUpperCase()==="INPUT"&&(d.type.toUpperCase()==="TEXT"||d.type.toUpperCase()==="PASSWORD"||d.type.toUpperCase()==="FILE"||d.type.toUpperCase()==="EMAIL")||d.tagName.toUpperCase()==="TEXTAREA"){doPrevent=d.readOnly||d.disabled}else{doPrevent=true;self.destination.trigger("keydown",event);self.destination.putCursorAtEnd()}}if(doPrevent){event.preventDefault();return}}var digit=String.fromCharCode(event.which);self.processDigitInput(digit,event)})};self.pressDTMF=function(digit){if(digit.length!==1){return}if(sipstack.isStarted()){self.destination.val(self.destination.val()+digit);sound.playClick();sipstack.sendDTMF(digit)}};self.processDigitInput=function(digit,event){if(!sipstack.isStarted()&&self.visible){if(event&&self.destination.is(event.target)){return}self.destination.val(self.destination.val()+digit);self.destination.putCursorAtEnd()}else if(digit.match(/^[0-9A-D#*,]+$/i)){self.pressDTMF(digit)}};return self}},{"./popup":478}],474:[function(require,module,exports){module.exports=FileShareView;var Utils=require("../Utils");function FileShareView(options,sipstack,eventbus,debug){var self={};var C=self.C={ACTION_REQUEST:"request",ACTION_REPLY:"reply",ACTION_SEND:"send",ACTION_RECEIVED:"received"};var requests={};var handleFileSelect=function(evt){var file=evt.target.files[0];if(file){var reader=new FileReader;reader.onload=$.proxy(requestSend,self);reader.readAsDataURL(file)}else{alert("Failed to load file")}};var process=function(action,fileName,data){if(action===C.ACTION_REQUEST){var accept=window.confirm("User wants to share the file "+fileName+" with you. Do you want to receive it?");replyRequest(accept,fileName)}else if(action===C.ACTION_REPLY){if(data==="true"){var fileData=requests[fileName];sendFile(fileData,fileName)}else{updateStatus("rejected request for "+fileName);delete requests[fileName]}}else if(action===C.ACTION_SEND){receivedFile(data,fileName)}else if(action===C.ACTION_RECEIVED){updateStatus(fileName+" transferred successfully");delete requests[fileName]}};var requestSend=function(e){var data=e.target.result;var file=self.file.val();var fileNameStr=fileName(file);requests[fileNameStr]=data;updateStatus("requesting sending file "+fileNameStr+" ...");send(C.ACTION_REQUEST,fileNameStr)};var replyRequest=function(accept,fileName){if(accept){updateStatus("receiving file "+fileName+" ...")}send(C.ACTION_REPLY,fileName,accept)};var receivedFile=function(data,fileName){updateStatus("received file "+fileName);var blob=Utils.dataURItoBlob(data);window.saveAs(blob,fileName);send(C.ACTION_RECEIVED,fileName)};var sendFile=function(data,fileName){updateStatus("sending file "+fileName+" ...");send(C.ACTION_SEND,fileName,data)};var send=function(action,fileName,data){var dataString="fileshare:"+action+":"+fileName;if(data){dataString+=":"+data}sipstack.sendData(dataString)};var updateStatus=function(status){debug(status);self.status.text(status)};var fileName=function(file){return file.split("\\").pop()};self.elements=["file","status"];self.listeners=function(){self.file.on("change",$.proxy(handleFileSelect,self));eventbus.on("dataReceived",function(e){var data=e.data,match;var regex=/^fileshare:([^:]*):([^:]*):?/;if(!!(match=data.match(regex))){var fileName=match.pop();var action=match.pop();data=data.replace(regex,"");process(action,fileName,data)}})};return self}},{"../Utils":455}],475:[function(require,module,exports){module.exports=HistoryView;var Utils=require("../Utils");var PopupView=require("./popup");function Page(number,callsValue){var self={};self.callsAsString=function(){return self.calls.map(function(call){return call.toString()}).join("~")};self.parseCalls=function(callsValue){var calls=[];if(callsValue.trim().length>0){var callsArray=callsValue.split("~");for(var i=0;i<callsArray.length;i++){calls.push(new Call(callsArray[i]))}}return calls};self.calls=self.parseCalls(callsValue);self.number=number;return self}function Call(value){var self={};var values=value?value.split("|"):[];self.startTime=values[0];self.destination=values[1];self.direction=values[2];self.resolutionIn=values[3];self.resolutionOut=values[4];self.bitrateIn=values[5];self.bitrateOut=values[6];self.frameRateIn=values[7];self.frameRateOut=values[8];self.audioLostPer=values[9];self.videoLostPer=values[10];self.jitter=values[11];self.length=values[12];self.startDate=function(){var date=new Date;date.setTime(self.startTime);return date.toLocaleString()};self.destinationWithoutSip=function(){return self.destination.replace(/sip:([^@]+)@.+/,"$1")};self.toString=function(){var values=[self.startTime,self.destination,self.direction,self.resolutionIn,self.resolutionOut,self.bitrateIn,self.bitrateOut,self.frameRateIn,self.frameRateOut,self.audioLostPer,self.videoLostPer,self.jitter,self.length];return values.join("|")};return self}function HistoryView(options,sound,statsView,sipstack,configuration,eventbus,callcontrol){var self={};self.__proto__=PopupView(options,self,eventbus);var pagePrefix="page_";var pageNumber=0;var callsPerPage=10;var maxPages=25;var rows=[];var callDetailsHandler=function(call){return function(e){e.preventDefault();self.resolutionIn.text(call.resolutionIn);self.resolutionOut.text(call.resolutionOut);self.bitrateIn.text(call.bitrateIn);self.bitrateOut.text(call.bitrateOut);self.frameRateIn.text(call.frameRateIn);self.frameRateOut.text(call.frameRateOut);self.audioLostPer.text(call.audioLostPer);self.videoLostPer.text(call.videoLostPer);self.jitter.text(call.jitter);self.callLink.attr("data-destination",call.destinationWithoutSip());self.callLink.text("Call "+call.destinationWithoutSip());self.callHistoryDetails.fadeIn(100);self.callHistory.css({width:"416px"});$(".history-row").removeClass("active");$(self).addClass("active")}};var createCall=function(rtcSession){var call=new Call;var start=rtcSession.start_time;call.startTime=new Date(start).getTime();call.destination=rtcSession.remote_identity.uri;if(rtcSession.direction==="outgoing"){call.direction="up"}else{call.direction="down"}call.resolutionIn=stats.getValue("video","googFrameWidthReceived")+"x"+stats.getValue("video","googFrameHeightReceived");call.resolutionOut=stats.getValue("video","googFrameWidthSent")+"x"+stats.getValue("video","googFrameHeightSent");call.bitrateIn=stats.getAvg("video","kiloBitsReceivedPerSecond");call.bitrateOut=stats.getAvg("video","kiloBitsSentPerSecond");call.frameRateIn=stats.getAvg("video","googFrameRateReceived");call.frameRateOut=stats.getAvg("video","googFrameRateSent");call.audioLostPer=stats.getAvg("audio","packetsLostPer");call.videoLostPer=stats.getAvg("video","packetsLostPer");call.jitter=stats.getAvg("audio","googJitterReceived");call.length=Utils.format(Math.round(Math.abs((rtcSession.end_time-start)/1e3)));return call};var updateButtonsVisibility=function(){var pages=self.pages();var pagesCount=pages?pages.length-1:0;if(self.pageNumber<pagesCount){self.historyForward.show()}else{self.historyForward.hide()}if(self.pageNumber>0){self.historyBack.show()}else{self.historyBack.hide()}};var updateContent=function(){self.content.html("");self.rows=[];updateButtonsVisibility();var calls=self.getAllCalls();var startPos=self.callsPerPage*self.pageNumber;for(var i=startPos;i<startPos+self.callsPerPage&&i<calls.length;i++){var row=self.historyRowSample.clone();row.attr("id","");row.attr("class","history-row");var call=calls[i];row.bind("click",callDetailsHandler(call));row.find(".historyCall").text(self.pageNumber*10+i+1);row.find(".hist-destination").text(call.destinationWithoutSip());row.find(".hist-direction").append("<i class='icon-arrow-"+call.direction+"-thick'></i>");row.find(".hist-date").text(Utils.formatDateTime(call.startDate()));row.find(".hist-length").text(call.length);self.rows.push(row);row.appendTo(self.content)}};self.elements=["content","historyForward","historyBack","callHistoryDetails","historyDetailsClose","resolutionIn","resolutionOut","bitrateIn","bitrateOut","frameRateIn","frameRateOut","audioLostPer","videoLostPer","jitter","historyClear","callLink","historyRowSample","historyClose"];self.pages=function(){var pages=[];for(var i=0;i<localStorage.length;i++){var key=localStorage.key(i);var regex=new RegExp(pagePrefix+"(.*)","g");var match=regex.exec(key);if(match!==null&&match.length>1){var value=localStorage.getItem(key);var page=new Page(parseInt(match[1],10),value);pages.push(page)}}pages.sort(function(page1,page2){return page2.number-page1.number});return pages};self.getAllCalls=function(){var pages=self.pages();var calls=[];for(var i=0;i<pages.length;i++){calls=calls.concat(pages[i].calls)}return calls};self.setPageNumber=function(pageNumber){self.pageNumber=pageNumber;updateContent()};self.listeners=function(){eventbus.on("ended",function(e){self.persistCall(e.sender)});eventbus.on("modifier",function(e){if(e.which===72){self.show()}});eventbus.on("viewChanged",function(e){if(e.view==="history"&&e.visible){updateContent()}else if(e.view==="settings"&&e.visible){self.hide()}else if(e.view==="dialpad"&&!e.visible){self.hide()}});self.historyForward.bind("click",function(e){e.preventDefault();sound.playClick();self.setPageNumber(self.pageNumber+1)});self.historyBack.bind("click",function(e){e.preventDefault();sound.playClick();self.setPageNumber(self.pageNumber-1)});self.historyClose.bind("click",function(e){e.preventDefault();sound.playClick();self.hide()});self.historyDetailsClose.bind("click",function(e){e.preventDefault();self.callHistoryDetails.fadeOut(100);self.callHistory.css({width:"200px"})});self.callLink.bind("click",function(e){e.preventDefault();if(sipstack.getCallState()===sipstack.C.STATE_CONNECTED){sound.playClick();var destination=self.callLink.attr("data-destination");callcontrol.callUri(destination);self.callHistory.css({width:"200px"});self.callHistory.fadeOut(100)}self.callHistoryDetails.hide()});self.historyClear.bind("click",function(e){e.preventDefault();sound.playClick();var pages=self.pages();for(var i=0;i<pages.length;i++){localStorage.removeItem(pagePrefix+pages[i].number)}self.setPageNumber(0)})};self.persistPage=function(page){var key=pagePrefix+page.number;var value=page.callsAsString();localStorage[key]=value};self.persistCall=function(rtcSession){if(!configuration.enableCallHistory){return}var pages=self.pages();var page=null;if(pages.length>0){page=pages[0]}else{page=new Page(0,"")}if(page.calls.length>=self.callsPerPage){if(page.number+1>=self.maxPages){for(var i=0;i<pages.length;i++){var lastPageCall=pages[i].calls.pop();if(i+1<pages.length){pages[i+1].calls.unshift(lastPageCall)}self.persistPage(pages[i])}}else{page=new Page(page.number+1,"")}}var call=createCall(rtcSession);page.calls.unshift(call);self.persistPage(page);updateContent()};return self}},{"../Utils":455,"./popup":478}],476:[function(require,module,exports){module.exports=IncomingCallView;var Utils=require("../Utils");var ExSIP=require("exsip");var PopupView=require("./popup");function IncomingCallView(options,eventbus,sound,sipstack){var self={};self.__proto__=PopupView(options,self,eventbus);self.elements=["incomingCallName","incomingCallUser","acceptIncomingCall","rejectIncomingCall","holdAndAnswerButton","dropAndAnswerButton"];self.incomingCallHandler=function(source,session){self.hide();sound.pause();if(source.is(self.acceptIncomingCall)){sipstack.answer(session)}else if(source.is(self.dropAndAnswerButton)){sipstack.terminateSession();sipstack.answer(session)}else if(source.is(self.holdAndAnswerButton)){sipstack.holdAndAnswer(session)}else if(source.is(self.rejectIncomingCall)){sipstack.terminateSession(session)}};self.listeners=function(){eventbus.on("failed",function(e){var error=e.data.cause;if(error===ExSIP.C.causes.CANCELED){self.hide()}});eventbus.on("incomingCall",function(evt){var incomingCallName=evt.data.request.from.display_name;var incomingCallUser=evt.data.request.from.uri.user;eventbus.message("Incoming Call","success");self.show();self.incomingCallName.text(incomingCallName);self.incomingCallUser.text(incomingCallUser);Utils.rebindListeners("click",[self.rejectIncomingCall,self.acceptIncomingCall,self.holdAndAnswerButton,self.dropAndAnswerButton],function(e){e.preventDefault();self.incomingCallHandler($(this),evt.data.session)});sound.playRingtone()})};return self}},{"../Utils":455,"./popup":478,exsip:202}],477:[function(require,module,exports){module.exports=MessagesView;var Utils=require("../Utils");var ExSIP=require("exsip");function MessagesView(options,eventbus,configuration){var self={};self.elements=["alert","success","warning","normal"];self.message=function(text,level){if(!configuration.enableMessages){return}console.log("message : "+text,level);var messageEl=self[level];messageEl.stop(true,true).fadeOut();messageEl.text(text).fadeIn(10).fadeOut(1e4)};self.getRemoteUser=function(rtcSession){return rtcSession.remote_identity.uri.user||rtcSession.remote_identity.uri.host};self.listeners=function(){eventbus.on("ended",function(e){self.message(configuration.messageEnded.replace("{0}",self.getRemoteUser(e.sender)),"normal")});eventbus.on("resumed",function(e){self.message(configuration.messageResume.replace("{0}",self.getRemoteUser(e.sender)),"success")});eventbus.on("started",function(e){if(e.data&&!e.data.isReconnect){self.message(configuration.messageStarted.replace("{0}",self.getRemoteUser(e.sender)),"success")}});eventbus.on("held",function(e){self.message(configuration.messageHold.replace("{0}",self.getRemoteUser(e.sender)),"success")});eventbus.on("disconnected",function(e){var msg=configuration.messageConnectionFailed;if(e.data&&e.data.reason){msg=e.data.reason}if(e.data&&e.data.retryAfter){msg+=" - Retrying in "+e.data.retryAfter+" seconds"}self.message(msg,"alert")});eventbus.on("failed",function(e){var error=e.data.cause;self.message(error,"alert")});eventbus.on("progress",function(e){self.message(configuration.messageProgress,"normal")});eventbus.on("message",function(e){self.message(e.text,e.level)});eventbus.on("registrationFailed",function(e){var msg=statusCode;if(statusCode===403){msg="403 Authentication Failure"}self.message(configuration.messageRegistrationFailed.replace("{0}",msg),"alert")});eventbus.on("registered",function(e){self.message(configuration.messageRegistered,"success")});eventbus.on("unregistered",function(e){self.message(configuration.messageUnregistered||"Unregistered","success")});eventbus.on("connected",function(e){self.message(configuration.messageConnected,"success")})};return self}},{"../Utils":455,exsip:202}],478:[function(require,module,exports){(function(global){module.exports=PopupView;var $=require("jquery");function PopupView(options,parent,eventbus){var self={};var attached=false;self.visible=false;self.show=function(){self.setVisible(true)};self.hide=function(){self.setVisible(false)};self.toggle=function(){self.setVisible(!self.visible)};self.setVisible=function(visible){if(!attached){parent.view.appendTo(global.instances["clientview_"+options.id].client);attached=true}self.visible=visible;eventbus.viewChanged(parent)};return self}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{jquery:230}],479:[function(require,module,exports){module.exports=ReinviteView;var PopupView=require("./popup");function ReinviteView(options,eventbus){var self={};self.__proto__=PopupView(options,self,eventbus);self.elements=["incomingCallName","incomingCallUser","acceptReInviteCall","rejectReInviteCall","title"];self.listeners=function(){eventbus.on("reInvite",function(e){self.show();var incomingCallName=e.request.from.display_name;var incomingCallUser=e.request.from.uri.user;var title=e.audioAdd?"Adding Audio":"Adding Video";eventbus.message(title,"success");self.incomingCallName.text(incomingCallName);self.incomingCallUser.text(incomingCallUser);self.title.text(title);self.acceptReInviteCall.off("click");self.acceptReInviteCall.on("click",function(){self.hide();e.session.acceptReInvite()});self.rejectReInviteCall.off("click");self.rejectReInviteCall.on("click",function(){self.hide();e.session.rejectReInvite()})})};return self}},{"./popup":478}],480:[function(require,module,exports){module.exports=SettingsView;var WebRTC_C=require("../Constants");var Utils=require("../Utils");var PopupView=require("./popup");function SettingsView(options,settings,configuration,sipstack,eventbus,debug,sound){var self={};self.__proto__=PopupView(options,self,eventbus);var updateRowVisibility=function(){self.autoAnswerRow.toggle(configuration.enableAutoAnswer);self.selfViewDisableRow.toggle(!configuration.hasOwnProperty("enableSelfView"));self.hdRow.toggle(!configuration.hasOwnProperty("enableHD"));self.resolutionRow.toggle(!configuration.hasOwnProperty("displayResolution")||!configuration.hasOwnProperty("encodingResolution"));self.resolutionDisplayRow.toggle(!configuration.hasOwnProperty("displayResolution"));self.resolutionEncodingRow.toggle(!configuration.hasOwnProperty("encodingResolution"));self.resolutionTypeRow.toggle(!configuration.hasOwnProperty("displayResolution")&&!configuration.hasOwnProperty("encodingResolution"));self.bandwidthLow.toggle(!configuration.hasOwnProperty("bandwidthLow"));self.bandwidthMed.toggle(!configuration.hasOwnProperty("bandwidthMed"));self.bandwidthHigh.toggle(!configuration.hasOwnProperty("bandwidthHigh"));self.bandwidthRow.toggle(!configuration.hasOwnProperty("bandwidthLow")||!configuration.hasOwnProperty("bandwidthMed")||!configuration.hasOwnProperty("bandwidthHigh"));self.displayNameRow.toggle(!configuration.hasOwnProperty("displayName"))};self.elements=["localVideoTop","localVideoLeft","userid","password","save","authenticationUserid","signIn","signOut","displayName","resolutionType","resolutionDisplayWidescreen","resolutionDisplayStandard","resolutionEncodingWidescreen","resolutionEncodingStandard","bandwidthLow","bandwidthMed","bandwidthHigh","displayNameRow","useridRow","selfViewDisableRow","hdRow","autoAnswerRow","resolutionTypeRow","resolutionDisplayRow","resolutionEncodingRow","resolutionRow","bandwidthRow","callHistoryTop","callHistoryLeft","callStatsTop","callStatsLeft","selfViewDisable","hd","size","autoAnswer","configure","layout","clear","tabs"];self.init=function(options){Utils.addSelectOptions(WebRTC_C.RESOLUTION_TYPES,self.resolutionType);Utils.addSelectOptions(WebRTC_C.STANDARD_RESOLUTIONS,self.resolutionDisplayStandard);Utils.addSelectOptions(WebRTC_C.WIDESCREEN_RESOLUTIONS,self.resolutionDisplayWidescreen);Utils.addSelectOptions(WebRTC_C.STANDARD_RESOLUTIONS,self.resolutionEncodingStandard);Utils.addSelectOptions(WebRTC_C.WIDESCREEN_RESOLUTIONS,self.resolutionEncodingWidescreen);settings.setResolutionDisplay(WebRTC_C.DEFAULT_RESOLUTION_DISPLAY);settings.setResolutionEncoding(WebRTC_C.DEFAULT_RESOLUTION_ENCODING);updateRowVisibility()};self.listeners=function(){eventbus.on("viewChanged",function(e){if(e.view==="dialpad"&&e.visible){self.hide()}});eventbus.on("registered",function(){self.enableRegistration(true)});eventbus.on("unregistered",function(){self.enableRegistration(true)});eventbus.on("registrationFailed",function(){self.enableRegistration(true)});self.clear.on("click",function(e){e.preventDefault();settings.resetLayout();eventbus.emit("message",{text:"Settings reset"})});self.signOut.on("click",function(e){e.preventDefault();sound.playClick();settings.signOut()});self.save.bind("click",function(e){e.preventDefault();sound.playClick();settings.save()});self.signIn.bind("click",function(e){e.preventDefault();sound.playClick();settings.signIn()});self.bandwidthLow.bind("blur",function(){sipstack.updateRtcMediaHandlerOptions()});self.bandwidthMed.bind("blur",function(){sipstack.updateRtcMediaHandlerOptions()});self.bandwidthHigh.bind("blur",function(){sipstack.updateRtcMediaHandlerOptions()});self.resolutionType.bind("change",function(){self.updateResolutionSelectVisibility();eventbus.viewChanged(self);sipstack.updateRtcMediaHandlerOptions();sipstack.updateUserMedia()});self.resolutionDisplayWidescreen.bind("change",function(){eventbus.viewChanged(self)});self.resolutionDisplayStandard.bind("change",function(){eventbus.viewChanged(self)});self.resolutionEncodingWidescreen.bind("change",function(){sipstack.updateRtcMediaHandlerOptions();sipstack.updateUserMedia()});self.resolutionEncodingStandard.bind("change",function(){sipstack.updateRtcMediaHandlerOptions();sipstack.updateUserMedia()});self.tabs.each(function(){var $active,$content,$links=$(this).find("a");$active=$($links.filter('[href="'+location.hash+'"]')[0]||$links[0]);$active.addClass("active");$content=$($active[0].hash);$links.not($active).each(function(){$(this.hash).hide()});$(this).on("click","a",function(e){$active.removeClass("active");$content.hide();$active=$(this);$content=$(self.hash);$active.addClass("active");$content.show();e.preventDefault()})})};self.updateResolutionSelectVisibility=function(){var resolutionType=self.resolutionType.val();self.resolutionDisplayStandard.toggle(resolutionType===WebRTC_C.STANDARD);self.resolutionEncodingStandard.toggle(resolutionType===WebRTC_C.STANDARD);self.resolutionDisplayWidescreen.toggle(resolutionType===WebRTC_C.WIDESCREEN);self.resolutionEncodingWidescreen.toggle(resolutionType===WebRTC_C.WIDESCREEN)};self.enableRegistration=function(enable){self.signIn.removeClass("disabled");self.signOut.removeClass("disabled");if(!enable){self.signIn.addClass("disabled");self.signOut.addClass("disabled")}};return self}},{"../Constants":452,"../Utils":455,"./popup":478}],481:[function(require,module,exports){module.exports=SMSView;var DateFormat=require("../DateFormat");var Utils=require("../Utils");function InboxItem(sms,message){var self={};self.cloned=sms.inboxItemSample.clone(false);self.cloned.removeClass("inboxItemSample");self.cloned.attr("id",message.mid);self.from=self.cloned.find(".from");self.status=self.cloned.find(".status");self.time=self.cloned.find(".time");self.bodyText=self.cloned.find(".body .text");self.bodyImageLink=self.cloned.find(".body .image a");self.bodyImageText=self.cloned.find(".body .image span");self.bodyImageThumbnail=self.cloned.find(".body .image img");self.bodyVideo=self.cloned.find(".body .video video");self.bodyAudio=self.cloned.find(".body .audio audio");self.removeLink=self.cloned.find(".icon-trash");self.dateFormat=new DateFormat("%m/%d/%y %H:%M:%S");self.listeners=function(){self.removeLink.bind("click",function(){sms.remove(message,self)});eventbus.on("modifier",function(e){if(e.which===84){self.show()}})};self.enableActions=function(enable){self.removeLink.attr("disabled",!enable)};self.updateContent=function(message){var messageType=self.getMessageType(message);self.cloned.addClass(messageType);self.from.text(message.tn);self.status.text(sms.getStatusAsString(message.status));self.time.text(self.dateFormat.format(new Date(message.time)));var body=message.body.trim();if(messageType==="image"){self.bodyImageLink.attr("href",message.mmscontentlocation);self.bodyImageText.text(body);if(message.mmscontentthumbnail){self.bodyImageThumbnail.attr("src","data:"+message.mmscontentsubtype+";base64,"+message.mmscontentthumbnail)}}else if(messageType==="video"){self.bodyVideo.attr("src",message.mmscontentlocation);self.bodyVideo.text(body)}else if(messageType==="audio"){self.bodyAudio.attr("src",message.mmscontentlocation);self.bodyAudio.text(body)}else{self.bodyText.html(body)}};self.getMessageType=function(message){if(message.mmscontentsubtype&&message.mmscontentsubtype.indexOf("image/")!==-1){return"image"
}else if(message.mmscontentsubtype&&message.mmscontentsubtype.indexOf("video/")!==-1){return"video"}else if(message.mmscontentsubtype&&message.mmscontentsubtype.indexOf("audio/")!==-1){return"audio"}else{return"text"}};self.remove=function(){self.cloned.remove()};self.appendTo=function(element){self.cloned.appendTo(element)};self.listeners();self.updateContent(message);return self}function SMSView(options,eventbus,debug,smsprovider,sound){var self={};self.__proto__=PopupView(options,self,eventbus);self.elements=["status","statusContent","inbox","inboxContent","loginForm","loginLink","name","password","sendForm","sendTo","sendBody","sendButton"];self.inboxItems=[];self.getStatusAsString=function(status){if(status==="N"){return"New"}else if(status==="U"){return"Unread"}else if(status==="R"){return"Read"}else if(status==="L"){return"Locked"}else if(status==="D"){return"Deleted"}else{throw new Error("Unsupported status : "+status)}};self.listeners=function(){eventbus.on("smsLoggedIn",function(){self.onLoggedIn()});eventbus.on("smsSent",function(){self.status.hide();self.sendBody.val("");self.sendTo.val("");self.sendButton.attr("disabled",false)});eventbus.on("smsReadAll",function(e){self.status.hide();var messages=e.messages;messages=messages.sort(function(a,b){return b.time-a.time});var incomingMessages=$.grep(messages,function(n){return n.dir==="I"});self.updateInbox(incomingMessages)});self.loginLink.bind("click",function(e){e.preventDefault();self.login(self.name.val(),self.password.val())});self.password.bind("keypress",function(e){if(e.keyCode===13){e.preventDefault();self.login(self.name.val(),self.password.val())}});self.sendButton.bind("click",function(e){e.preventDefault();self.sendSMS()});self.sendBody.bind("keypress",function(e){if(e.keyCode===13){e.preventDefault();self.sendSMS()}})};self.remove=function(message,inboxItem){sound.playClick();if(!window.confirm("Do you really want to delete SMS from "+message.tn+"?")){return}self.info("Deleting SMS...");if(inboxItem){inboxItem.enableActions(false)}smsprovider.remove([message.mid],function(){self.status.hide();inboxItem.remove()},function(msg){self.error("Deleting SMS failed : "+msg);inboxItem.enableActions(true)})};self.login=function(name,password){sound.playClick();self.info("Logging in...");smsprovider.login(name,password,function(msg){self.error("Logging failed : "+msg)})};self.onNotification=function(notifications){var needsRead=false;if(!notifications){return}for(var i=0;i<notifications.length;i++){if(notifications[i].action==="new-rec"||notifications[i].action==="update"||notifications[i].action==="delete"){needsRead=true;break}}if(needsRead){smsprovider.readAll(function(msg){self.error("Fetching SMS failed : "+msg)})}};self.enableUpdate=function(enable){self.enableUpdate=enable;self.triggerUpdate()};self.triggerUpdate=function(){if(self.enableUpdate&&!self.pendingUpdate){debug("triggering getUpdate");self.pendingUpdate=true;smsprovider.getUpdate(function(notifications){self.pendingUpdate=false;self.onNotification(notifications);self.triggerUpdate()},function(){self.pendingUpdate=false;self.error("Technical problems connecting to server - auto refresh disabled")})}};self.sendSMS=function(){sound.playClick();var msg=self.validateSendForm();if(msg!==""){self.error(msg);return}self.info("Sending SMS...");self.sendButton.attr("disabled",true);smsprovider.sendSMS([self.sendTo.val()],self.sendBody.val(),function(msg){self.sendButton.attr("disabled",false);self.error("Sending SMS failed : "+msg)})};self.validateSendForm=function(){var to=self.sendTo.val();var msgs=[];if(to===""){msgs.push("Please enter a phone number to send to")}else if(!Utils.isValidUsPstn(to)){msgs.push(to+" not a valid US phone number")}var body=self.sendBody.val();if(body===""){msgs.push("Please enter a text to send")}return msgs.join("\n")};self.onLoggedIn=function(){self.loginForm.hide();self.inbox.show();self.sendForm.show();self.enableUpdate(true);smsprovider.readAll(function(msg){self.error("Fetching SMS failed : "+msg)});self.info("Fetching SMS...")};self.updateInbox=function(messages){self.inboxContent.html("");self.inboxItems=[];for(var i=0;i<messages.length;i++){var inboxItem=new InboxItem(this,messages[i]);inboxItem.appendTo(self.inboxContent);self.inboxItems.push(inboxItem)}};self.setStatus=function(msg,type){self.status.show();self.status.attr("class",type);self.statusContent.text(msg)};self.error=function(msg){self.setStatus(msg,"error")};self.info=function(msg){self.setStatus(msg,"info")};return self}},{"../DateFormat":453,"../Utils":455}],482:[function(require,module,exports){module.exports=StatsView;var PopupView=require("./popup");function StatsView(options,eventbus,configuration,sipstack){var self={};self.__proto__=PopupView(options,self,eventbus);self.elements=["statsVar","statsContainer"];self.getReportById=function(reports,id){for(var i=0;i<reports.length;i++){if(reports[i].id===id){return reports[i]}}return null};self.processStats=function(){var peerConnection=sipstack.activeSession.rtcMediaHandler.peerConnection;peerConnection.getStats(function(stats){var results=stats.result();var reports=[];for(var i=0;i<results.length;++i){var res=results[i];var report=self.getReportById(reports,res.id);if(!report){report={};report.type=res.type;report.id=res.id}var names=res.names();var values=[];for(var j=0;j<names.length;j++){var name=names[j];if(!name){continue}var value=res.stat(name);values.push(name);values.push(value)}var valueObj={};valueObj.timestamp=res.timestamp;valueObj.values=values;report.stats=valueObj;reports.push(report)}var data={lid:1,pid:self.sipstack.getSessionId(),reports:reports};addStats(data)})};self.getDataSerie=function(type,label,sessionId){var dataSeries=getDataSeriesByLabel(sessionId||this.sipstack.getSessionId(),type,label);var result;for(var i=0;i<dataSeries.length;i++){var dataSerie=dataSeries[i];if(!result||dataSerie.getAvg()>result.getAvg()){result=dataSerie}}return result};self.getStatValues=function(type,label,sessionId){var dataSerie=this.getDataSerie(type,label,sessionId);return dataSerie?dataSerie.dataPoints_.map(function(e){return e.value}):null};self.getStatAvg=function(type,label,sessionId){var dataSerie=this.getDataSerie(type,label,sessionId);return dataSerie?dataSerie.getAvg():null};self.setSelected=function(id,parentSelector,selected){if(arguments.length===2){selected=true}var className=id.replace(/\d+/g,"");var classes=jQuery.grep($(parentSelector).attr("class").split(" "),function(n){return n.indexOf(className)===-1});if(selected){classes.push(id+"-selected");if(id!==className){classes.push(className+"-selected")}}var classNames=classes.join(" ");$(parentSelector).attr("class",classNames)};self.getValue=function(type,name){return $('[data-type="'+type+'"][data-var="'+name+'"]').text()};self.getAvg=function(type,name){return Math.round($('[data-type="'+type+'"][data-var="'+name+'"]').attr("data-avg")*100)/100};self.listeners=function(){self.statsVar.click(function(){var index=self.statsVar.index($(this)[0]);self.setSelected("stats"+index,this.callStats)});eventbus.on("modifier",function(e){if(e.which===83){self.show()}});eventbus.on("started",function(e){self.statsContainer.attr("id",sipstack.getSessionId()+"-1")})};return self}},{"./popup":478}],483:[function(require,module,exports){module.exports=TimerView;var Utils=require("../Utils");function TimerView(options,debug,eventbus,statsView,configuration){var self={};self.callTimer=null;self.startTime=null;self.elements=["text"];self.init=function(){self.updateText()};self.listeners=function(){eventbus.on("started",function(e){if(e.data&&!e.data.isReconnect){self.start()}})};self.start=function(){if(self.callTimer){debug("timer "+self.callTimer+" already running");return}var timer=self.runningTimer();self.callTimer=setInterval(timer,1e3);debug("started timer interval : "+self.callTimer)},self.stop=function(){self.startTime=null;clearInterval(self.callTimer);debug("cleared timer interval : "+self.callTimer);self.callTimer=null;self.updateText()},self.getSeconds=function(){return Math.round(((new Date).getTime()-(self.startTime||(new Date).getTime()))/1e3)},self.updateText=function(){var secs=self.getSeconds();self.text.text(Utils.format(secs))},self.runningTimer=function(){self.startTime=(new Date).getTime();return function(){var secs=self.getSeconds();if(self.configuration.maxCallLength&&secs>=self.configuration.maxCallLength){self.client.terminateSessions();self.client.endCall();return}self.updateText();if(self.configuration.enableCallStats&&Utils.isChrome()){self.statsView.processStats()}}};return self}},{"../Utils":455}],484:[function(require,module,exports){module.exports=TransferView;var PopupView=require("./popup");function TransferView(options,sound,sipstack,eventbus,configuration,callcontrol){var self={};self.__proto__=PopupView(options,self,eventbus);self.elements=["accept","reject","targetInput","typeAttended"];self.listeners=function(){eventbus.on("viewChanged",function(e){if(e.view==="transfer"&&e.visible){self.targetInput.focus()}});self.accept.bind("click",function(e){e.preventDefault();sound.playClick();var targetInput=self.targetInput.val();if($.isBlank(targetInput)){eventbus.emit("message",{text:configuration.messageOutsideDomain,level:"alert"});return}targetInput=callcontrol.validateDestination(targetInput);if(targetInput){self.setVisible(false);sipstack.transfer(targetInput,self.typeAttended.is(":checked"))}});self.reject.bind("click",function(e){e.preventDefault();sound.playClick();self.setVisible(false)})};return self}},{"./popup":478}],485:[function(require,module,exports){module.exports=VideoView;require("jquery-ui/draggable");function VideoView(options,sipstack,eventbus,debug,settings,configuration,historyView){var self={};self.elements=["local","remote","localVideo"];var validateUserMediaResolution=function(){var encodingWidth=settings.getResolutionEncodingWidth();var encodingHeight=settings.getResolutionEncodingHeight();var videoWidth=self.localWidth();var videoHeight=self.localHeight();debug("validating video resolution "+videoWidth+","+videoHeight+" to match selected encoding "+encodingWidth+","+encodingHeight);if(!videoWidth&&!videoHeight){return}if(encodingWidth!==videoWidth||encodingHeight!==videoHeight){var msg="Video resolution "+videoWidth+","+videoHeight+" does not match selected encoding "+encodingWidth+","+encodingHeight;debug(msg)}};self.init=function(){if(configuration.enableWindowDrag){$(function(){self.localVideo.draggable({snap:".remoteVideo,.videoBar",containment:".main",snapTolerance:200,stop:function(event,ui){self.settings.updateViewPositions()}})})}};self.listeners=function(){self.view.bind("click",function(e){historyView.hide()});self.local.bind("playing",function(){validateUserMediaResolution()});eventbus.on("userMediaUpdated",function(e){self.updateStreams([e&&e.localStream],[])});eventbus.on("resumed",function(e){self.updateSessionStreams(e.sender)});eventbus.on("started",function(e){self.updateSessionStreams(e.sender)})};self.updateSessionStreams=function(){self.updateStreams(sipstack.getLocalStreams(),sipstack.getRemoteStreams())};self.updateStreams=function(localStreams,remoteStreams){debug("updating video streams");self.setVideoStream(self.local[0],localStreams);self.setVideoStream(self.remote[0],remoteStreams)};self.localWidth=function(){return self.local[0].videoWidth};self.localHeight=function(){return self.local[0].videoHeight};self.setVideoStream=function(video,streams){var hasStream=streams&&streams.length>0&&typeof streams[0]!=="undefined"&&!streams[0].ended;if(video&&video.mozSrcObject!==undefined){if(hasStream){video.mozSrcObject=streams[0];video.play()}else{video.mozSrcObject=null}}else if(video){if(hasStream){video.src=window.URL&&window.URL.createObjectURL(streams[0])||streams[0]}else{video.src=""}}};return self}},{"jquery-ui/draggable":226}],486:[function(require,module,exports){module.exports=VideoBarView;var Icon=require("../Icon");var events;function VideoBarView(options,eventbus,sound,sipstack,transferView,settingsView,dialpadView,timerView,videoView,configuration){var self={};self.fullScreen=false;self.selfViewEnabled=true;self.isScreenSharing=false;self.elements=["transfer","settings","dialpadIconShow","dialpadIconHide","cellTimer","hangup","fullScreenExpand","fullScreenContract","muteAudioIcon","unmuteAudioIcon","selfViewEnable","selfViewDisable","shareScreen","stopShareScreen","hold","resume"];var toggleView=function(e,popup){e.preventDefault();sound.playClick();popup.toggle()};self.endCall=function(options){options=options||{};var rtcSession=options.rtcSession;if(rtcSession==="all"){sipstack.terminateSessions()}else if(rtcSession){sipstack.terminateSession(rtcSession)}else{sipstack.terminateSession()}sound.pause();videoView.updateSessionStreams();timerView.stop();self.checkEndCallURL()};self.checkEndCallURL=function(){if(configuration.endCallURL&&!configuration.disabled){window.location=configuration.endCallURL}};self.enableScreenSharing=function(enabled){self.isScreenSharing=enabled;eventbus.screenshare(enabled);eventbus.viewChanged(self);if(enabled){var onShareScreenSuccess=function(localMedia){localMedia.onended=function(){self.enableScreenSharing(false)}};var onShareScreenFailure=function(e){if(e){self.screenSharingUnsupported.show()}self.enableScreenSharing(false)};sipstack.reconnectUserMedia(onShareScreenSuccess,onShareScreenFailure)}else{sipstack.reconnectUserMedia()}};self.holdCall=function(){self.hold.disable();var enable=function(){self.hold.enable()};sipstack.hold(enable,enable)};self.resumeCall=function(){self.resume.disable();var enable=function(){self.resume.enable()};sipstack.unhold(enable,enable)};self.hideSelfView=function(){self.selfViewEnabled=false;eventbus.viewChanged(self)};self.stopFullScreen=function(){if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}self.fullScreen=false;eventbus.viewChanged(self)};self.showSelfView=function(){self.selfViewEnabled=true;eventbus.viewChanged(self)};self.updateFullScreen=function(){self.fullScreen=document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen;self.updateClientClass()};self.showFullScreen=function(){if(self.client[0].webkitRequestFullScreen){self.client[0].webkitRequestFullScreen()}self.fullScreen=true;eventbus.viewChanged(self)};self.muteAudio=function(){sound.setMuted(true)};self.unmuteAudio=function(){sound.setMuted(false)};self.listeners=function(){self.hold=new Icon(self.hold,sound);self.resume=new Icon(self.resume,sound);self.transfer.bind("click",function(e){toggleView(e,transferView)});self.settings.bind("click",function(e){toggleView(e,settingsView)});self.dialpadIconShow.bind("click",function(e){toggleView(e,dialpadView)});self.dialpadIconHide.bind("click",function(e){toggleView(e,dialpadView)});self.shareScreen.bind("click",function(e){e.preventDefault();sound.playClick();self.enableScreenSharing(true)});self.stopShareScreen.bind("click",function(e){e.preventDefault();sound.playClick();self.enableScreenSharing(false)});self.hangup.bind("click",function(e){e.preventDefault();sound.playClick();self.endCall();if(self.fullScreen){self.fullScreenContract.click()}});self.fullScreenExpand.bind("click",function(e){e.preventDefault();sound.playClick();self.showFullScreen()});self.fullScreenContract.bind("click",function(e){e.preventDefault();sound.playClick();self.stopFullScreen()});$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(e){self.updateFullScreen()});self.selfViewDisable.bind("click",function(e){e.preventDefault();sound.playClick();self.hideSelfView()});self.selfViewEnable.bind("click",function(e){e.preventDefault();sound.playClick();self.showSelfView()});self.hold.onClick(function(e){self.holdCall()});self.resume.onClick(function(e){self.resumeCall()});self.muteAudioIcon.bind("click",function(e){e.preventDefault();sound.playClick();self.muteAudio()});self.unmuteAudioIcon.bind("click",function(e){e.preventDefault();sound.playClick();self.unmuteAudio()})};return self}},{"../Icon":454}],487:[function(require,module,exports){module.exports=WhiteboardView;function WhiteboardView(options,eventbus,sipstack){var self={};self.__proto__=PopupView(options,self,eventbus);self.elements=["canvas","tools"];if(self.canvas[0]&&self.canvas[0].getContext){self.context=self.canvas[0].getContext("2d")}self.color="#000";self.size=5;self.tool="marker";self.action=[];self.listeners=function(){self.initCanvas();eventbus.on("modifier",function(e){if(e.which===87){self.show()}});eventbus.on("dataReceived",function(e){var data=e.data;var regex=/^whiteboard:/;if(data.match(regex)){data=data.replace(regex,"");var img=new Image;img.onload=function(){self.clear();self.context.drawImage(img,0,0)};img.src=data}});self.updateToolsSelection()};self.initCanvas=function(){$.each(["#f00","#ff0","#0f0","#0ff","#00f","#f0f","#000","#fff"],function(){self.tools.append("<a href='.canvas' onclick='javascript:;' data-color='"+this+"' style='width: 10px; background: "+this+";'></a> ")});$.each([3,5,10,15],function(){self.tools.append("<a href='.canvas' onclick='javascript:;' data-size='"+this+"' style='background: #ccc'>"+this+"</a> ")});self.canvas.bind("click mousedown mouseup mousemove mouseleave mouseout touchstart touchmove touchend touchcancel",jQuery.proxy(this,"onEvent"));$("body").delegate('a[href=".'+self.canvas.attr("class")+'"]',"click",function(){var $canvas,$this,key,sketch,_i,_len,_ref;$this=$(this);$canvas=$($self.attr("href"));sketch=$canvas.data("sketch");_ref=["color","size","tool"];for(_i=0,_len=_ref.length;_i<_len;_i++){key=_ref[_i];var value=$self.attr("data-"+key);if(value){if(key==="size"){value=+value}self[key]=value}}self.updateToolsSelection();return false})};self.updateToolsSelection=function(){$.each(self.tools.find("a"),function(){var selected=$(this).data("color")===self.color||$(this).data("tool")===self.tool||+$(this).data("size")===self.size;if(selected){$(this).attr("class","selected")}else{$(this).attr("class","")}})};self.sendData=function(){var data=self.canvas[0].toDataURL();sipstack.sendData("whiteboard:"+data)};self.clear=function(){self.context.save();self.context.setTransform(1,0,0,1,0,0);self.context.clearRect(0,0,self.canvas[0].width,self.canvas[0].height);self.context.restore()};self.onEvent=function(e){if(e.originalEvent&&e.originalEvent.targetTouches){e.pageX=e.originalEvent.targetTouches[0].pageX;e.pageY=e.originalEvent.targetTouches[0].pageY}switch(e.type){case"mousedown":case"touchstart":self.painting=true;self.action={tool:self.tool,color:self.color,size:parseFloat(self.size),eventbus:[]};break}if(self.painting){self.action.eventbus.push({x:e.pageX-self.canvas.offset().left,y:e.pageY-self.canvas.offset().top,event:e.type});if(self.tool==="marker"){self.draw(self.action)}else if(self.tool==="eraser"){self.erase(self.action)}}switch(e.type){case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":self.painting=false;self.action=null;self.sendData()}e.preventDefault();return false};self.erase=function(action){var oldcomposite;oldcomposite=self.context.globalCompositeOperation;self.context.globalCompositeOperation="copy";action.color="rgba(0,0,0,0)";self.draw(action);self.context.globalCompositeOperation=oldcomposite;return self.context.globalCompositeOperation};self.draw=function(action){var event,previous,_i,_len,_ref;self.context.lineJoin="round";self.context.lineCap="round";self.context.beginPath();self.context.moveTo(action.eventbus[0].x,action.eventbus[0].y);_ref=action.eventbus;for(_i=0,_len=_ref.length;_i<_len;_i++){event=_ref[_i];self.context.lineTo(event.x,event.y);previous=event}self.context.strokeStyle=action.color;self.context.lineWidth=action.size;return self.context.stroke()}}},{}],488:[function(require,module,exports){module.exports=XMPPView;var PopupView=require("./popup");var $=require("jquery");function XMPPView(options,debug,eventbus,configuration,sound,xmpp){var self={};self.__proto__=PopupView(options,self,eventbus);self.elements=["content","name","password","login","messages"];self.init=function(){};self.listeners=function(){self.login.on("click",function(e){sound.playClick();xmpp.login(name.val(),password.val())});eventbus.on("modifier",function(e){if(e.which===88){self.show()}});eventbus.on("xmppmessages",function(e){})};return self}},{"./popup":478,jquery:230}]},{},[456]);